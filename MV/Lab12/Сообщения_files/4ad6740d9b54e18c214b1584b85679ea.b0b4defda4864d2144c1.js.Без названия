(window.webpackJsonp=window.webpackJsonp||[]).push([["bundles/4ad6740d9b54e18c214b1584b85679ea"],{"7GuL":function(e,a,t){"use strict";t.r(a),t.d(a,"ATTACH_DATA_DONUT_DURATION",(function(){return i.ATTACH_DATA_DONUT_DURATION})),t.d(a,"MEDIA_TYPE_DONUT_DURATION",(function(){return i.MEDIA_TYPE_DONUT_DURATION})),t.d(a,"POST_PARAM_DONUT_DURATION",(function(){return i.POST_PARAM_DONUT_DURATION})),t.d(a,"getDonutPostParams",(function(){return p})),t.d(a,"getPostParamsFromDurationMedia",(function(){return _})),t.d(a,"fieldValueIsDonutOnlyPost",(function(){return l})),t.d(a,"updatePostponedPostDonatorIcon",(function(){return u}));var i=t("q4CX"),o=t("v+DW"),n=t("tI7G"),r=t("zxIV"),d=t("t7n3"),s=t("CxPP"),l=function(e,a,t){var i=Object(n.getDonutOnlyFieldEl)(e),r=i&&1===Object(o.isChecked)(i)&&!i.hasAttribute("disabled");return Object(s.isDonutPostSettingVisible)(a,t)&&r?1:0},c=function(e){var a=e[5]&&e[5][i.ATTACH_DATA_DONUT_DURATION];return void 0!==a?a:void 0},_=function(e){var a,t=c(e);return void 0!==t?((a={})[i.POST_PARAM_DONUT_DURATION]=t,a):{}},p=function(e,a){var t;if(!e||!a)return{};var o=a.findChosenMedia(i.MEDIA_TYPE_DONUT_DURATION),n=(o?c(o):void 0)||i.DONUT_DURATION_DEFAULT;return(t={})[i.POST_PARAM_DONUT_DURATION]=n,t.mark_as_ads=0,t},u=function(e,a){if(e instanceof Element){var t=!!(null==a?void 0:a[i.WALL_SAVE_RESPONSE_IS_MARKED_AS_DONUT]),o=e.querySelector('[data-section-ref="donut-post-donator-icon"]');if(t){var s=e.querySelector(".post_date"),l=Object(d.getTemplate)("postDonatorIcon");s&&l&&Object(n.appendChildOrUpdate)(s,Object(r.se)(l),o)}else null==o||o.remove()}}},BxOC:function(e,a,t){"use strict";t.r(a),t.d(a,"post",(function(){return o})),t.d(a,"plainget",(function(){return n})),t.d(a,"plaingetCancelable",(function(){return r}));t("VRzm"),t("Btvt");var i=t("cGUQ");function o(e,a,t){return a&&(a.im_v=3),new Promise((i,o)=>{ajax.post(e,a,{timeout:t,onDone(){i.apply(null,[[...arguments]])},onFail(){return o.apply(null,arguments),!0}})})}function n(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r(e,a,t),o=i.request;return o}function r(e,a){var t,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function n(){t.abort()}t=window.XDomainRequest?new XDomainRequest:ajax._getreq();var r=new Promise((n,r)=>{var d,s=Date.now(),l=o.timeout||60,c=Object(i.toQueryString)(a);if(window.XDomainRequest)t.open("get",`${e}?${c}`),t.ontimeout=function(e){r([e,{}])},t.onerror=function(e){r([e,{}])},t.onload=function(){n([t.responseText,{}])},setTimeout((function(){t.send()}),0);else{t.onreadystatechange=function(){4==t.readyState&&(clearInterval(d),t.status>=200&&t.status<300?n([t.responseText,t]):r([t.responseText,t]))};try{t.open("GET",`${e}?${c}`,!0)}catch(e){return r([e,t])}t.send()}d=setInterval((function(){Date.now()-s>1e3*l&&(window.browser.safari&&t.abort(),r(["",{}]),clearInterval(d))}),1e3)});return{request:r,cancel:n}}},CxPP:function(e,a,t){"use strict";t.r(a),t.d(a,"isDonutPostSettingVisible",(function(){return n}));var i=t("v+DW"),o=t("zxIV"),n=function(e,a){var t=function(e){if(!(e instanceof Element)||"submit_post_box"!==e.id)return!0;var a=parseInt(Object(o.domData)(e,"from-oid"))||void 0;return!!a&&a<0}(e),n=function(e){var a,t=null===(a=null==e?void 0:e.markAsAdsGetCheckboxEl)||void 0===a?void 0:a.call(e);return!t||!!!Object(i.isChecked)(t)}(a);return t&&n}},YIAi:function(e,a,t){"use strict";t.r(a),t.d(a,"VISIBILITY_ACCESS_OPTIONS",(function(){return i}));var i={PUBLIC:0,ONLY_FRIENDS:1,ONLY_DONUT:2}},"oK+H":function(e,a,t){"use strict";t.r(a),t.d(a,"createPostTooltip",(function(){return n}));var i=t("zxIV"),o=t("k487"),n=(e,a,t)=>{var n=a||"",r=e+n,d=Object(i.ge)(r),s=Object(i.geByClass1)("post_action_tt_content",d),l=Object(i.geByClass1)("post_action_btn_layout",d),c=s.children;window.radioBtns["post_settings_btn"+e+n]={val:!1,els:c};var _=[-12*(window.vk.rtl?-1:1),7],p=new o.default(l,{appendTo:d,forceSide:"bottom",autoShow:!1,cls:"eltt_fancy eltt_fancy_actions",noOverflow:!1,centerShift:0,offset:_,content:s,align:"left",onFirstTimeShow:()=>{Object(i.show)(s)}});cur[e+n]=p,cur.destroy.push((function(){p&&p.destroy()})),t&&(cur[e+n+"_onChange"]=t)}},q4CX:function(e,a,t){"use strict";t.r(a),t.d(a,"POST_PARAM_DONUT_DURATION",(function(){return i})),t.d(a,"ATTACH_DATA_DONUT_DURATION",(function(){return o})),t.d(a,"ATTACH_DATA_DONUT_ONLY",(function(){return n})),t.d(a,"MEDIA_TYPE_DONUT_DURATION",(function(){return r})),t.d(a,"DONUT_DURATION_DEFAULT",(function(){return d})),t.d(a,"WALL_SAVE_RESPONSE_IS_MARKED_AS_DONUT",(function(){return s}));var i="donut_duration",o="donut_duration",n="donut_only",r="donut_duration",d=-1,s="is_marked_as_donut"},tI7G:function(e,a,t){"use strict";t.r(a),t.d(a,"isDonutDurationFinite",(function(){return n})),t.d(a,"domInsertChildAfterOtherChild",(function(){return r})),t.d(a,"getDonutOnlyFieldEl",(function(){return d})),t.d(a,"appendChildOrUpdate",(function(){return s}));var i=t("zxIV"),o=t("q4CX"),n=function(e){return e>0},r=function(e,a,t){a?Object(i.domInsertAfter)(t,a):e&&(e.firstChild?Object(i.domInsertBefore)(t,e.firstChild):t&&e.appendChild(t))},d=function(e){return e instanceof Element?Object(i.domQuery1)('[name="'+o.ATTACH_DATA_DONUT_ONLY+'"]',e):null},s=function(e,a,t){t?Object(i.domReplaceEl)(t,a):e.appendChild(a)}},te1c:function(e,a,t){"use strict";t.r(a),t.d(a,"MEDIA_SELECTOR_GROUP",(function(){return M})),t.d(a,"MediaSelector",(function(){return R}));t("HEwt"),t("rE2o"),t("ioFf"),t("rGqo"),t("VRzm"),t("Vd3H"),t("a1Th"),t("Btvt"),t("KKXr"),t("Oyvg"),t("SRfc"),t("91GP"),t("pIFo");var i=t("v+DW"),o=t("Egk5"),n=t("EasH"),r=t("FWc3"),d=t("BxOC"),s=t("wetz"),l=t("t7n3"),c=t("/PiP"),_=t("W9Tc"),p=t("7GuL"),u=t("YIAi"),h=t("zxIV"),g=t("jE6c"),m=t("oK+H"),v=t("HLtZ"),b=t("q4CX"),f=t("tI7G"),w=t("CxPP"),k=e=>{var a=e.addMedia,t=e.actionsEl,i=e.onMediaChange;if(!Object(h.ge)("post_donut_duration_btn"+a.lnkId))if(t){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.silent;y({actionsEl:t,addMedia:a,onMediaChange:o?()=>{}:i})},n=Object(h.se)(Object(l.getTemplate)("donut_duration_select",{link_id:a.lnkId})),r=Object(h.geByClass1)("post_available",t);Object(f.domInsertChildAfterOtherChild)(t,r,n),Object(m.createPostTooltip)("post_donut_duration_btn",a.lnkId,()=>{o()});var d=a.findChosenMedia(b.MEDIA_TYPE_DONUT_DURATION);if(void 0!==d){var s=a.chosenMediaToObject(d).data;T(a,s[b.ATTACH_DATA_DONUT_DURATION])}a.donutUpdateVisibility(),o({silent:!0})}else Object(v.logError)(new Error("donutDurationInitSelector: no actionsEl provided"))},y=e=>{var a=e.actionsEl,t=e.addMedia,o=e.onMediaChange;if(a){var n=+Object(i.radioval)("post_settings_btnpost_donut_duration_btn"+t.lnkId);Object(f.isDonutDurationFinite)(n)?t.addOrUpdateChosenMedia(b.MEDIA_TYPE_DONUT_DURATION,"",{[b.ATTACH_DATA_DONUT_DURATION]:n}):C(t),T(t,n),o&&o()}},C=e=>{e.unchooseMediaForType(b.MEDIA_TYPE_DONUT_DURATION)},T=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.DONUT_DURATION_DEFAULT,t=Object(h.ge)("post_donut_duration_btn"+e.lnkId);if(t){var o=Object(h.geByClass1)("post_action_btn_text",t),n=Object(h.ge)("donut_duration"+a+e.lnkId),r=Object(f.isDonutDurationFinite)(a),d=r?Object(h.val)(n):Object(h.domData)(o,"empty");o.innerHTML=d,o.setAttribute("aria-label",Object(g.replaceEntities)(d)),Object(h.toggleClass)(t,"on",r);var s="post_donut_duration_btn";Object(i.radiobtn)(n,a,"post_settings_btn"+s+e.lnkId)}},A=(e,a,t)=>{if(t&&a){var i=Object(h.geByClass1)("post_available",a),o=Object(h.ge)("post_donut_duration_btn"+t.lnkId),n=!!Object(f.getDonutOnlyFieldEl)(a);i&&o&&n&&Object(h.toggleClass)(a,"post_actions_btns--donut-actions-hidden",!e)}},x=t("nqXl");function D(e,a){return function(e){if(Array.isArray(e))return e}(e)||function(e,a){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],i=!0,o=!1,n=void 0;try{for(var r,d=e[Symbol.iterator]();!(i=(r=d.next()).done)&&(t.push(r.value),!a||t.length!==a);i=!0);}catch(e){o=!0,n=e}finally{try{i||null==d.return||d.return()}finally{if(o)throw n}}return t}(e,a)||function(e,a){if(!e)return;if("string"==typeof e)return I(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return I(e,a)}(e,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var M="group",S=p.MEDIA_TYPE_DONUT_DURATION,P="anonymous",B="poll_fixed",$="poll_closed",O="poll_background_id",E="poll_photo_id",L="poll_until",N="poll_is_multiple",U="poll_disable_unvote",j=/^invite\/[a-z0-9]{7}$|/,R=function(e,a,t,m,v,b){var f,y=[],I=(m=m||{}).mediaHandlers||{},R=m.from;each(t||[],(function(a,t){var o=t[0],d=t[1],s=t[2];if(d){var l=!1,c=!1,_=m.toId||cur.postTo,p={to_id:_,blockPersonal:m.blockPersonal};switch(p.mail_add=m.mail?1:"",p.from=m.from,o){case"graffiti":l=showBox.pbind("al_wall.php",{act:"canvas_draw_box",flash:browser.flash},{cache:1,dark:1});break;case"photos_list":l=showBox.pbind("al_photos.php",extend(p,{act:"choose_photo"}),{cache:1,stat:[jsc("web/photos.js"),"photos.css",jsc("web/upload.js")],dark:1});break;case"photo":l=I.photo?I.photo.pbind(m):showBox.pbind("al_photos.php",extend(p,{act:"choose_photo",max_files:m.limit||10,no_album_select:~(m.disabledTypes||[]).indexOf("album")?1:""}),{cache:1,stat:[jsc("web/photos.js"),"photos.css",jsc("web/upload.js")],dark:1});break;case"video":var u=extend(p,{act:"a_choose_video_box",max_files:m.limit||10});l=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||showBox("al_video.php",u,{cache:1,dark:1})};break;case"audio":l=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||stManager.add([jsc("web/audio.js"),jsc("web/indexer.js"),jsc("web/auto_list.js"),jsc("web/grid_sorter.js"),"audio.css"],(function(){var a=!1;each(f.chosenMedias||[],(function(){"audio_playlist"===this[0]&&(a=!0)})),cur.audioAttachOriginalOwnerId=!1,cur.audioAttachSwitchOwnerId=!1;var t=vk.id,i=parseInt((""+p.to_id||"").replace(/^board/,"-")),o=domClosest("_submit_post_box",e);domData(o,"from-oid")<0||"im"===cur.module&&cur.gid?(t=i,cur.audioAttachOriginalOwnerId=i,cur.audioAttachSwitchOwnerId=vk.id):cur.hasGroupAudioAccess&&(cur.audioAttachOriginalOwnerId=vk.id,cur.audioAttachSwitchOwnerId=i),AudioPage.showAttachBox(t,{canPlaylistAttach:!a&&!cur.editor,onAudioChoose:AudioUtils.onAudioChoose,onPlaylistChoose:AudioUtils.onPlaylistChoose})}))};break;case"poll":l=()=>f.chooseMedia("poll","",s);break;case"doc":l=I.doc?I.doc.pbind(m):showBox.pbind("docs.php",Object.assign(p,m.docParams,{act:"a_choose_doc_box"}),{stat:["docs.css"]});break;case"map":l=showBox.pbind("al_places.php",extend(p,{act:"a_choose_place_box"}),{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"note":l=showWiki.pbind({note:"new"},!0,!1,{queue:1});break;case"postpone":l=e=>{if(b){if(hasClass(e.target,"_close"))return f.unchooseMedia(f.postponeInd),void cancelEvent(e);var a=()=>{cur["postPostponeTT"+f.lnkId].show(),triggerEvent(geByClass1("datepicker_control",cur["postPostponeTT"+f.lnkId]._ttel),"mousedown",!1,!0);var e=!f.postponeDate;f.postponeDate=val("postpone_date"+f.lnkId),e&&f.chooseMedia("postpone",f.postponeDate,s)};f.postponeDatepicker?"DP_PLACEHOLDER"!==f.postponeDatepicker&&a():(cur.postponedLastDate&&(s.date=intval(cur.postponedLastDate)+3600),f.postponeDatepicker="DP_PLACEHOLDER",f.setupPostpone(s,null,a))}else f.chooseMedia("postpone",d,s)};break;case S:c=!0,l=()=>{};break;case"mark_as_ads":l=()=>f.chooseMedia("mark_as_ads",d,s);break;case"share":l=function(e){e=e||{},window.onShareChooseUrlBoxInit=function(){var e=geByClass1("share_url_input",curBox().bodyNode);addEvent(e,"keydown",(function(e){if(e.which==KEY.ENTER)return t(curBox().btns.ok[0],e),!1}))};var a=showBox("share.php",{act:"choose_url_box"},{dark:1}),t=function(t,o){var n=geByClass1("share_url_input",a.bodyNode),r=val(n);Object(i.lockButton)(t),disable(n,!0),hide("share_url_error"),f.chooseMedia("share",d,extend(s,{url:r,draft:!0,onSuccess:function(){disable(n,!1),Object(i.unlockButton)(t),a.hide(),e.videoId&&window.AdsEdit&&window.AdsEdit.showSnippetVideo&&window.AdsEdit.showSnippetVideo(e.videoId)},onError:function(e){var a="";e&&e!==getLang("global_unknown_error")&&-1===e.indexOf("ERR_PAGE_GET_FAILED")&&(a=e+" "),disable(n,!1),Object(i.unlockButton)(t),ge("share_url_error").innerHTML=a+getLang("global_share_link_failed"),show("share_url_error")}}))};a.removeButtons(),a.addButton(getLang("global_continue"),t)};break;case"pretty_cards":l=function(e){e&&e.replace_owner_id&&(s.editor.owner_id=e.replace_owner_id),f.chooseMedia("pretty_cards",d,s)};break;case"gift":l=function(){var e=(e=m.peer<2e9?m.peer:0)||cur.peer;m.giftBoxPrepare&&m.giftBoxPrepare(e),showBox("al_gifts.php",{act:"get_gift_box",mid:e,fr:e==vk.id?1:0,ref:"media_selector"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1})};break;case"money":l=function(){var e=cur.peer;_>-2e9&&_<0&&(p.owner_id=_),showBox("al_payments.php",extend(p,{act:"money_transfer_box",to_id:e}),{onFail:function(e){return curBox()&&curBox().hide(),setTimeout(Object(n.showFastBox)(getLang("global_error"),e).hide,2e3),!0}})};break;case"market":_==vk.id?(l=showBox.pbind("al_market.php",extend(p,{act:"a_choose_user_product_box"}),{cache:1}),s.tt_words&&(cur.checkMessageHandler=function(e){if(!cur.marketIntroShown&&(e=" "+e+" ").match(new RegExp("\\s("+s.tt_words.join("|")+")\\s","i"))){var a=getSize(f.menu.moreWrap);Object(r.showTooltip)(f.menu.moreWrap,{text:s.tt_text,dir:"left",slideX:15,width:230,shift:[-a[0]-5,-a[1]/2],hasover:1}),cur.marketIntroShown=!0}})):l=showBox.pbind("al_market.php",extend(p,{act:"a_choose_product_box"}),{cache:1});break;case"article":l=()=>openArticleEditor(_);break;case"podcast":l=function(){stManager.add([jsc("web/podcast.js")],(function(){Podcast.select()}))}}(l||c)&&y.push([o,d,l])}})),a=ge(a||"media_preview"),v=!1!==v&&ge(v||"post_settings_btn"),b=!1!==b&&ge(b||"post_actions_btns");var z=m.limit||10,q=z>1,H=m.editable&&(!browser.msie||parseInt(browser.version)>8),F=m.sortable&&(!browser.msie||parseInt(browser.version)>8),W=!!b,V=function(e,a,t){if(!(e=ge(e)))return!1;t=t||{},window.__addMediaIndex||(window.__addMediaIndex=0);var i=++__addMediaIndex;e.innerHTML='<div class="media_selector clear_fix"></div>';var n,r=domByClass(e,"media_selector"),d=[],s={id:i,menuNode:r,types:a,lastTypes:a,_onInitHandlers:[],activate:function(e){s.touched=!0===e,t.onActivate&&t.onActivate()},show:function(){if(n&&(clearTimeout(n),n=0),s.moreWrap&&!hasClass(s.moreWrap,"shown")){t.forceToUp||replaceClass(s.moreWrap,"to_up","to_down");var e=domByClass(s.moreWrap,"_more_items");(getClientRectOffsetY(e)>0||t.forceToUp)&&replaceClass(s.moreWrap,"to_down","to_up"),setTimeout(addClass.pbind(s.moreWrap,"shown"),0)}},hide:function(e){function a(a){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e){if(!n){var a=function(){n=0,s.moreWrap&&removeClass(s.moreWrap,"shown")};if(e){var t=domByClass(s.moreWrap,"_more_items");hide(t),a(),setTimeout(show.pbind(t),0)}else n=setTimeout(a,300)}})),setOptions:function(e){extend(t,e)},setItems:function(e){for(window.tooltips&&tooltips.destroyAll(r);r.firstChild;)re(r.firstChild);var a=void 0!==t.hideAfterCount?t.hideAfterCount:4,i=void 0!==t.maxShown?t.maxShown:3,n=!1,l=t.hideItem,_=(l||e.length>a)&&(!browser.mobile||t.ignoreMobile),p=t.hideLabel||getLang("global_media_selector_more");function u(e,a,i,o,n,r){var l=ce("a",{innerHTML:o?a:'<span class="blind_label">'+a+"</span>",className:"ms_item ms_item_"+e+" _type_"+e});if(!o&&s.moreWrap?domInsertBefore(l,s.moreWrap):(o||n).appendChild(l),l.setAttribute("tabindex",0),!o){l.setAttribute("data-title",a),l.setAttribute("aria-label",a),l.setAttribute("role","link");var c=function(){showTitle(this,!1,r||!1,{noZIndex:!0})};addEvent(l,"mouseover",c),d.push((function(){removeEvent(l,"mouseover",c)}))}if(i&&!cur.viewAsBox){var _=function(){return s.activate(),s.hide(!0),t.onItemClick&&!t.onItemClick(e)||i(),!1};addEvent(l,"click",_),d.push((function(){removeEvent(l,"click",_)}))}}s.moreWrap=!1,s.lastTypes=e,each(e,(function(e,a){var h=a[0],g=a[1],m=a[2];if("article"!=h){if("postpone"===h&&W&&!s.postponeBtn){var v=getLang("wall_publication_now");s.postponeBtn=se(`<div class="post_action_btn has_cross" id="post_postpone_btn${s.id}">\n                <div class="post_action_btn_layout">\n                  <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(v)}">${v}</span>\n                  <span class="post_action_image_btn _close" role="button" title="${replaceEntities(getLang("wall_post_timer_reset"))}"></span>\n                  <div class="post_action_tt_content _postpone" id="post_postpone_tt_content${s.id}" onclick="cancelEvent(event)"></div>\n                </div>\n               </div>`),t.actionsEl.appendChild(s.postponeBtn);var b="post_postpone_btn"+s.id,w=ge(b),y=geByClass1("post_action_tt_content",w),C=geByClass1("post_action_btn_layout",w),T=[-4*(vk.rtl?-1:1),4],A=new ElementTooltip(C,{appendTo:domPN(w),forceSide:"bottom",autoShow:!1,customShow:!0,cls:"_postpone timer_in_tt",noOverflow:!1,centerShift:0,offset:T,content:y,noHideOnClick:!0,align:"left",onShow:()=>{f.activeState=!0},onHide:()=>{f.activeState=!1,setTimeout(()=>{f.postponeDatepicker&&f.postponeDatepicker.hide()},ElementTooltip.FADE_SPEED)},onFirstTimeShow:function(){show(y)}});return cur["postPostponeTT"+s.id]=A,cur.destroy.push((function(){A&&A.destroy()})),addEvent(s.postponeBtn,"click",m),void d.push((function(){removeEvent(s.postponeBtn,"click",m)}))}if(h!==S){if(_&&(l?h==l:e==i)){var x=r.appendChild(ce("div",{className:"ms_items_more_wrap"})),D=function(e){s.fromKeyboard=Object(o.checkKeyboardEvent)(e),"mouseover"==e.type&&(s.touched||s.fromKeyboard)||(s.fromKeyboard&&hasClass(s.moreWrap,"shown")?s.hide():s.show())},I=function(){s.fromKeyboard||s.hide()};addEvent(x,"mouseover click",D),addEvent(x,"mouseout",I),d.push((function(){removeEvent(x,"mouseover click",D),removeEvent(x,"mouseout",I)})),t.vectorIcon&&(p='<span class="blind_label">'+p+"</span>",addClass(x,"ms_items_more_wrap_vector"));var M=x.appendChild(ce("a",{className:"ms_item_more",innerHTML:'<span class="ms_item_more_label">'+p+"</span>"}));M.setAttribute("tabindex",0),M.setAttribute("role","button");var P=ce("div",{className:"ms_items_more_helper"});n=ce("div",{className:"ms_items_more _more_items"}),P.appendChild(n),x.appendChild(P),s.moreWrap=x}u(h,g,m,n,r)}else s.enqueueOnAddMediaInit(k)}else Object(c.isArticleEditorAvailable)()&&u(h,g,m,!1,r,[6,8])}))},enqueueOnAddMediaInit(e){s._onInitHandlers.push(e)},onAddMediaInit(e){s._onInitHandlers.forEach(a=>{a(e)}),s._onInitHandlers=[]}};a&&s.setItems(a),browser.msie&&(removeEvent(e,"MSPointerDown"),addEvent(e,"MSPointerDown",s.activate.pbind(!0)));removeEvent(e,"mouseover"),addEvent(e,"mouseover click",s.activate),t.global||cur.destroy.push((function(){removeEvent(e,"mouseover click",s.activate)}));t.forceToUp&&addClass(geByClass1("ms_items_more_wrap",r),"to_up");return s.handlersToClean=d,s}(e,y,{onActivate:function(){cur.attachCount=f.attachCount,cur.chooseMedia=f.chooseMedia,cur.getFrom=f.getFrom,cur.hasChosenMedia=f.hasChosenMedia,cur.lastAddMedia=f,cur.onMediaUploadStarted=m.onMediaUploadStarted,cur.showMediaProgress=f.showMediaProgress,cur.unchooseMedia=f.unchooseMedia,cur.updateChosenMedia=f.updateChosenMedia},onItemClick:function(e){return!(q&&f.attachCount()>=z&&"postpone"!==e&&"mark_as_ads"!==e&&"copyright"!==e)||(vk.widget?showBox("blank.php",{code:1900,limit:z}):Object(n.showFastBox)(getLang("global_error"),getLang("attachments_limit",z)),!1)},hideAfterCount:m.hideAfterCount,topOffset:m.topOffset,forceUp:m.forceUp,global:m.global,maxShown:m.maxShown,forceToUp:m.forceToUp,vectorIcon:m.vectorIcon,ignoreMobile:m.ignoreMobile,actionsEl:b,hideLabel:m.hideLabel});if(V){var G=intval(V.id);if(q){a.innerHTML=`<div id="page_pics_preview${G}" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview${G}" class="page_pics_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview${G}" class="page_docs_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview${G}" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview${G}" class="page_docs_preview media_preview clear_fix"></div><div id="page_adocs_preview${G}" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview${G}" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview${G}" class="page_docs_preview media_preview _page_ppdocs_preview clear_fix"></div><div id="page_progress_preview${G}" class="page_progress_preview media_preview clear_fix"></div>`;var Y=domFC(a),K=domNS(Y),X=domNS(K),Q=domNS(X),Z=domNS(Q),J=domNS(Z),ee=domNS(J),ae=domNS(ee),te=domNS(ae);removeClass(a,"media_preview"),removeClass(Z,"vk_mini_app_preview"),addClass(a,"multi_media_preview")}else addClass(a,"med_no_attach"),show(a);return W&&(ae=ge("post_postpone_tt_content"+G)),(f={_addMediaLink:e,lnkId:G,menu:V,types:y,phLists:{},handlers:{},postponeIsTooltip:W,chosenMedias:[],limit:z,_showAddMedia:function(){V.show()},_hideAddMedia:function(e){V.hide(e)},hasRestrictingAttach:function(){return geByClass1("medadd_c_story",X)},getFrom:()=>R,updateChosenMedia:function(e,a,t){f.chooseMedia(e,a,t,null,null,null,!0)},addOrUpdateChosenMedia(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];var i=a[0],o=a[1];return(f.hasChosenMedia(i,o)?f.updateChosenMedia.bind(f):f.chooseMedia.bind(f))(...a)},hasChosenMedia:function(e,a){var t=!1;return each(f.chosenMedias,(function(){if(this[0]===e&&this[1]===a)return t=!0,!1})),t},chooseMedia:function(t,i,o,n,r,d,s){if(!cur.articleEditorLayer||"article"===t||"poll"===t){if(vk.widget&&(i=clean(i)),"postpone"===t&&W){if(hasClass(f.menu.postponeBtn,"on"))return!1;addClass(f.menu.postponeBtn,"on")}if(m.poster&&m.poster.isOpen()&&"postpone"!==t&&t!==S&&"copyright"!==t&&m.poster.closeEditor(),f.onChange&&!1===f.onChange(t,i,o,n))return void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),!1;if("note"===t&&(cur.pbNoteAdded=!1),inArray(t,m.disabledTypes||[]))return!1;if((f.attachCount()>=z&&void 0===o.upload_ind&&"postpone"!==t&&t!==S&&"mark_as_ads"!==t||f.hasRestrictingAttach())&&"copyright"!==t){if(q)return!1;f.unchooseMedia()}var c=!1,u={},h=null;if(q&&(each(f.chosenMedias,(function(e){if(h=e,this[0]==t&&this[1]==i)return c=!0,!1;u[this[0]]=u[this[0]]?u[this[0]]+1:1})),c&&!s||s&&!c))return!1;var g,v,b="",w="",k=!1,y=X,C="",A="",I=!1;switch(t){case"graffiti":if(u.pretty_cards)return!1;isObject(o)||(o={thumb:o||""}),b=`<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="${(o=He(o)).thumb}" /></div>`,y=k=ee;break;case"photos_list":if(vk.widget||u.pretty_cards)return!1;hide(this._addMediaLink),vkImage().src=o[1],(P=o[3].replace(/^{|}$/g,""))&&(P+=","),P+='"queue":1',b=`<div${m.nocl?"":` onclick="return showPhoto('${o[4]}', '${o[2]}', '${P.replace(/"/g,"&quot;")});"`} class="fl_l page_preview_photo"><img class="page_preview_photo" src="${o[1]}" /></div>`,y=k=Y;break;case"photo":if(u.pretty_cards)return!1;isObject(o)||(o={thumb_m:o[0]||"",thumb_s:o[1]||"",list:o[2]||"",view_opts:o[3]||"",upload_ind:o.upload_ind||void 0}),o=He(o),vkImage().src=o.thumb_m;var P=o.view_opts.replace(/^{|}$/g,"");if(vk.widget&&(P=P.replace(/&quot;/g,'"')),P&&(P+=","),P+='"queue":1',f.phLists[i]=o.list,H){if(!o.editable)return!1;if(!m.nocl){var B="{"+P+"}";B=JSON.parse(B),o.editable.click=f.showPhoto.pbind(i,o.list,B)}}b=`<div ${m.nocl?"":` onclick="return cur.addMedia[${f.lnkId}].showPhoto('${i}', '${o.list}', {${P.replace(/"/g,"&quot;")}});"`} class="fl_l page_preview_photo${d?" page_preview_ph_graff":""}"><img class="page_preview_photo" src="${o.thumb_m}" /></div>`,k=1,y=Y;break;case"video":if(isEmpty(o)||u.pretty_cards)return!1;if(isObject(o)||(o={thumb:o||""}),H){if(!o.editable)return!1;m.nocl||(o.editable.click=showVideo.pbind(i,o.list_id,{queue:1,autoplay:1}))}(o=He(o)).preview&&!vk.widget?(b=o.preview,o.editable.preview=b):b=`\n              <div ${m.nocl?"":`onclick="return showVideo('${i}', '${o.list_id}', {queue:1,autoplay:1});"`} class="fl_l page_preview_video">\n                <img class="page_preview_video" src="${o.thumb}" />\n              </div>\n            `,k=1,y=Y,v=o.list_id;break;case"article":if(vk.widget||u.article||u.page||u.pretty_cards||!o)return!1;b='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+getLang("global_article")+"</div>",w=o.snippet_html,i=o.url,o.rev&&(i+="?rev="+o.rev),y=Z;break;case"audio":if(u.pretty_cards)return!1;o=He(o),b=Page.addAudioPreview(clean(i),o),C=` id="pam${G}_audio${clean(i)}"`;break;case"audio_playlist":if(u.audio_playlist)return!1;(o=He(o)).id=intval(o.id),o.ownerId=intval(o.ownerId),vk.widget&&o.authorHref&&!o.authorHref.match(/^(https?:\/\/|\/)/)&&(o.authorHref="https://"+o.authorHref),vk.widget&&o.coverUrl&&!o.coverUrl.match(/^(https?:\/\/|\/)/)&&(o.coverUrl="https://"+o.coverUrl);var $=o.coverUrl?`background-image:url('${o.coverUrl}'); background-size: cover;`:"",O="";O=o.authorHref?`<a href="${o.authorHref}" onclick="return nav.go(this)">${o.authorName}</a>`:o.authorName;var E="'"+(o.accessHash||"")+"'";w='<div class="audio_pl_attach_preview _audio_pl _audio_pl_'+o.ownerId+"_"+o.id+' clear_fix"><div class="audio_pl_attach_preview__play" onclick="return getAudioPlayer().playPlaylist('+o.ownerId+", "+o.id+", "+E+')"></div><div class="audio_pl_attach_preview__cover" style="'+$+'">'+(o.gridCovers||"")+'</div><div class="audio_pl_attach_preview__title">'+o.title+'</div><div class="audio_pl_attach_preview__info_line">'+O+"</div></div>",b='<span class="medadd_h">'+getLang("global_audio_playlist")+"</span>",y=Z;break;case"artist":if(u.artist)return!1;var L=o.coverUrl?`background-image:url('${o.coverUrl}');`:"",N="",U="";o.blockId&&(N=`<div class="audio_artist_snippet__play" onclick="return getAudioPlayer().playBlock('${o.ownerId}', 'artist${o.blockId}', '', '', 'artist')">${getLang("audio_listen_snippet")}</div>`,U="_audio_pl _audio_pl_${data.ownerId}_artist${data.blockId}"),w=`<div class="audio_artist_attach_preview _audio_artist ${U} clear_fix">\n              <div class="audio_artist_snippet__cover" style="${L}"></div>\n              <div class="audio_artist_snippet__info">\n                ${N}\n                <div class="audio_artist_snippet__title">${o.title}</div>\n                <div class="audio_artist_snippet__subtitle">${getLang("global_artist")}</div>\n              </div>\n            </div>`,b='<span class="medadd_h">'+getLang("global_artist")+"</span>",y=Z;break;case"doc":if(vk.widget||u.pretty_cards)return!1;if(o.editable){var j="stopEvent(event);";(o=He(o)).hasBox&&(o.editable.click=e=>{Page.showGifBox(o.id,o.ownerId,intval(o.postId),intval(o.postOwnerId),o.hash,e)},j=`Page.showGifBox(${intval(o.id)}, ${intval(o.ownerId)}, ${intval(o.postId)}, ${intval(o.postOwnerId)}, '${o.hash}', event);`),A+=" page_preview_doc_as_photo_wrap";var R=D(o.editable.sizes.m||o.editable.sizes.s,1)[0];b=`<a href="${o.editable.href}" onclick="${m.nocl?"":j}" class="page_preview_doc_as_photo" target="_blank" rel="noopener" style="background-image: url('${R}');"><img class="page_preview_doc_as_photo" src="${R}" />${o.editable.label}</a>`,k=1,y=Y}else o.thumb&&o.thumb_s?(b="gif"==o.ext?'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+o.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+o.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint doc_gif">'+o.title+"</div>":'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+o.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+o.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint">'+o.title+"</div>",w='</a><div class="pam_bg"></div>',y=k=K,C=' id="pam'+G+"_doc"+i+'"'):(b="",w='<div class="page_doc_row"><a target="_blank" rel="noopener" href="'+o.href+'" class="page_doc_icon page_doc_icon'+intval(o.type)+'"></a><a target="_blank" href="'+o.href+'" class="page_doc_title">'+o.title+'</a><div class="page_doc_description_row"><div class="page_doc_size">'+o.size_str+"</div></div></div>",C=' id="pam'+G+"_doc"+i+'"');break;case"story":if(vk.widget||u.pretty_cards)return!1;b='<div class="medadd_c_story"><a target="_blank" rel="noopener" '+o.attr+'"><div class="medadd_c_story_thumb fl_l" style="background-image:url('+o.thumb+')"></div></a><div class="medadd_c_story_info fl_l"><a class="medadd_c_story_title" target="_blank" '+o.attr+'">'+o.title+'</a><div class="medadd_c_story_desc">'+o.date_string+"</div></div>",hide(e);break;case"narrative":if(u.narrative)return!1;b='<span class="medadd_h">'+getLang("global_type_narrative")+"</span>",w=o.snippet_html;break;case"mask":if(vk.widget||u.pretty_cards)return!1;b='<div class="medadd_c_mask"><div class="medadd_c_story_thumb fl_l" style="background-image:url(/images/landings/vkmasks/masksSnippet_2x.png)"></div></a><div class="medadd_c_story_info fl_l"><div class="medadd_c_story_title">'+o.share.title+'</div><div class="medadd_c_story_desc">'+o.share.desc+"</div></div>";break;case"share":if(u.share||u.page||u.pretty_cards||u.market||!o.lang)return!1;if(isArray(o)&&(o={domain:o[0],url:o[1],initialPattern:o[2],title:o[3],description:o[4],images:[o[5]],user_id:o[6],photo_id:o[7]}),I=o.is_vk_mini_app,o.draft){var te={onSuccess:o.onSuccess,onError:o.onError};return f.checkURL(o.url,void 0,{},te),!1}if(!o.title&&!(cur.options.share||{}).allow_preview_empty_links)return(o.onError||function(){})(),!1;if(I?(o.title=Object(l.unclean)((o.title||"").replace(/\n/g,"\\n")),o.description=Object(l.unclean)((o.description||"").replace(/\n/g,"\\n"))):(o.title=Object(l.unclean)((o.title||"").replace(/<br>/g,"\n")),o.description=Object(l.unclean)((o.description||"").replace(/<br>/g,"\n")),o.description_short=Object(l.unclean)((o.description_short||"").replace(/<br>/g,"\n")),o.description_narrow=Object(l.unclean)((o.description_narrow||"").replace(/<br>/g,"\n"))),cur.options=cur.options||{},cur.options.share&&cur.options.share.max_title_len&&(o.title=(o.title||"").substr(0,cur.options.share.max_title_len)),cur.options.share&&cur.options.share.max_desc_len&&(o.description=(o.description||"").substr(0,cur.options.share.max_desc_len),o.description_short=(o.description_short||"").substr(0,cur.options.share.max_desc_len),o.description_narrow=(o.description_narrow||"").substr(0,cur.options.share.max_desc_len)),o.media=o.media||i,o.lang&&(cur.lang=extend(cur.lang||{},o.lang)),o=He(o),b='<a target="_blank" rel="noopener" href="/away.php?to='+encodeURIComponent(o.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(Object(l.unclean)(o.is_vk_mini_app?o.lang.global_vk_mini_app:o.lang.profile_choose_link))+"</a>",I&&addClass(Z,"vk_mini_app_preview"),!o.prometheus&&o.map_data){var ie=Fe(Z),oe="";oe=o.map_data[3]?o.map_data[3].replace("size=0,0","size="+ie.width+","+ie.height):"/maps?lat="+floatval(o.map_data[0])+"&lng="+floatval(o.map_data[1])+"&z=11&"+(window.isRetina()?"w="+2*ie.width+"&h="+2*ie.height:"w="+ie.width+"&h="+ie.height);var ne="";Object(_.partConfigEnabled)("maps_no_referrer")&&(ne='referrerpolicy="no-referrer"'),b+=`<div class="medadd_c_share_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(o.map_data[0])}, long: ${floatval(o.map_data[1])}, provider: ${intval(o.map_data[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" ${ne} width="${ie.width}" height="${ie.height}" src="${oe}" /></a></div>`}if(f.shareData=extend(f.shareData||{},o,{imagesStyles:[""]}),y=Z,(o.onSuccess||function(){})(),(cur.options.share||{}).button_exclusive&&o.shareButtons)hide(e),(de=ge("signed"))&&disable(de);hide(domByClass(V.menuNode,"_type_share")),hide(domByClass(V.menuNode,"_type_market"));break;case"pretty_cards":if(u.share||u.pretty_cards||vk.widget)return!1;var de;b='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+o.lang.global_wall_pretty_cards+"</div>",(de=ge("signed"))&&disable(de),hide(domByClass(V.menuNode,"_type_pretty_cards")),hide(e),y=Z;break;case"poll":if(!o.lang||vk.vidget||u.poll||!Q||u.pretty_cards)return!1;hide(domByClass(V.menuNode,"_type_poll")),y=Q;break;case"map":if(vk.widget||u.pretty_cards)return!1;var le=Fe(ee);ne="";Object(_.partConfigEnabled)("maps_no_referrer")&&(ne='referrerpolicy="no-referrer"'),b=`<span class="medadd_h medadd_h_link inl_bl">${clean(Object(l.unclean)(o[4]))}</span><div class="fl_l medadd_c_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(o[0])}, long: ${floatval(o[1])}, provider: ${intval(o[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" ${ne} width="${le.width}" height="${le.height}" src="/maps?lat=${floatval(o[0])}&lng=${floatval(o[1])}&z=11&w=${le.width}&h=${le.height}" /></a></div>`,y=k=ee,hide(domByClass(V.menuNode,"_type_map"));break;case"page":if(u.share||u.page||!o.lang||vk.widget||u.pretty_cards)return!1;var _e=o.media.split("_");b='<a href="/page'+o.media+'" onclick="return showWiki({oid: '+_e[0]+", id: "+_e[1]+'}, false, event, {queue: 1})" class="medadd_h medadd_h_page inl_bl">'+o.lang.profile_choose_page+"</a>",y=Z;break;case"album":if(vk.widget||u.pretty_cards)return!1;if(o.is_private_album){extend(o.editable,{title:o.title,size:0}),k=1,y=Y;break}if(o.thumb.match(/^\/images\//)&&(o.thumb=""),H){if(!o.editable)return!1;extend(o.editable,{title:o.title,size:o.count,click:!m.nocl&&nav.change.pbind({z:"album"+i})})}var pe=o.thumb;vkImage().src=pe,b=`<a class="${"fl_l page_album_link"+(pe?"":" page_album_nocover")}" ${g=m.nocl?"":' href="/album'+i+'" onclick="return nav.change({z: \'album'+i+"'}, event)\""}>\n              ${pe?`<div class="page_album_thumb_wrap"><img class="page_album_thumb" src="${pe}"/></div>`:""}\n              <div class="page_album_title">\n                <div class="page_album_size">${o.count}</div>\n                <div class="page_album_title_text">${o.title}</div>\n              </div>\n            </a>`,k=1,y=Y;break;case"note":if(!o.lang||vk.widget||u.pretty_cards)return!1;b="<a onclick=\"showWiki({w: 'note"+o.raw+'\', edit: 1}, true, event, {queue: 1})" class="medadd_h medadd_h_note inl_bl">'+o.lang.profile_choose_note+"</a>",w='<div class="medadd_c medadd_c_note"><a onclick="showWiki({w: \'note'+o.raw+'\', edit: 1}, true, event, {queue: 1})" id="share_note_title'+o.raw+'">'+o.title+"</a></div>",y=Z;break;case"market":if(vk.widget||u.pretty_cards||u.share||u.market)return!1;b='<div class="medadd_c_market"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_market_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_market_info fl_l"><a class="medadd_c_market_title" target="_blank" href="'+o.href+'">'+o.title+'</a><div class="medadd_c_market_price">'+o.price+"</div></div>",hide(domByClass(V.menuNode,"_type_market"));break;case"market_album":if(vk.widget||u.pretty_cards)return!1;if(o.is_private_album){extend(o.editable,{title:o.title,msize:""}),k=1,y=Y;break}if(H){if(!o.editable)return!1;extend(o.editable,{title:o.title,msize:langNumeric(o.count,o.lang.profile_X_market_items),click:!1})}_e=i.split("_");vkImage().src=o.thumb,g=m.nocl?"":' href="/market'+_e[0]+"?section=album_"+_e[1]+'"',b=`<a class="${"fl_l page_preview_album wall_album_cover_wrap wall_market_album_cover"+(o.thumb?"":" page_album_nocover")}" ${g}>\n              ${o.thumb?`<img class="wall_album_cover" src="${o.thumb}"/>`:""}\n              <div class="wall_album_caption">\n                <div class="wall_album_title_wrap clear_fix">\n                  <div class="wall_album_count fl_r">${o.count}</div>\n                  <div class="wall_album_title">${o.title}</div>\n                </div>\n              </div>\n            </a>`,k=1,y=Y;break;case"copyright":if(vk.widget)return!1;f.copyrightCreate(o);break;case"postpone":if(vk.widget)return!1;var ue="";if(cur.editingPost&&!q)i=intval(i),o.date=i||intval(cur.editingPost[7]),ge("wpe_save").innerHTML=getLang("global_save"),ue=getLang("global_save");else if(cur.editingPost&&"wpe_media_preview"==a.id){i=intval(i),o.date=i||intval(cur.editingPost[7]);var he=geByClass1("medadd_c_timersett",ae);if(he){var me=domPN(he);he=me.innerHTML,re(me)}else he="";ge("wpe_save").innerHTML=getLang("global_save"),ue=getLang("global_save")}else{o.draft?o.date=intval(i):cur.postponedLastDate&&(o.date=intval(cur.postponedLastDate)+3600);var ve=ge("official");if(!(Pe=gpeByClass("_submit_post_box",ve))&&m.poster&&domClosest("poster",ve)&&(Pe=ge("submit_post_box")),ve&&Pe){var be=domData(Pe,"from-oid"),fe=domData(Pe,"oid");be==vk.id&&fe&&wall.setReplyAsGroup(ve,{from:fe}),disable(ve);var we=window.data(ve,"tt");if(we&&we.rdBtns){var ke=we.rdBtns[1],ye=we.rdBtnsGroup,Ce=domData(ke,"as");radiobtn(ke,Ce,ye)}}(ke=ge("send_post"))&&(ke.innerHTML=o.lang.profile_wall_postpone_btn,ue=o.lang.profile_wall_postpone_btn)}W?(f.updatePostponeBtnText(!1,o.date),f.postponeDate=o.date):b=`<div class="medadd_h medadd_h_timer inl_bl">${o.lang.profile_choose_timer}<span id="postpone_preview${G}"></span></div>`,!f.postponeDatepicker&&W&&f.setupPostpone(o,he),m.poster&&m.poster.changeBtnText(ue);var Te=Math.round((new Date).getTime()/1e3);intval(o.date)<Te&&(o.date=Te+3600),hide(domByClass(V.menuNode,"_type_postpone")),y=ae;break;case S:if(vk.widget)return!1;T(f,o[p.ATTACH_DATA_DONUT_DURATION]);break;case"mark_as_ads":if(vk.widget)return!1;b='<div class="medadd_h medadd_h_mark_as_ads inl_bl">'+o.lang.global_ads_wall_post_mark_as_ads_action+"</div>",hide(domByClass(V.menuNode,"_type_mark_as_ads")),y=ae;break;case"wall":if(vk.widget||u.pretty_cards)return!1;b='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+o.href+'">'+o.author+'</a><div class="medadd_c_wall_type">'+o.lang.title+"</div></div>",C=' id="pam'+G+"_wall"+i+'"',hide(e);break;case"wall_reply":if(vk.widget||u.pretty_cards)return!1;b='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+o.href+'">'+o.author+'</a><div class="medadd_c_wall_type">'+o.lang.title+"</div></div>",C=' id="pam'+G+"_wall_reply"+i+'"',hide(e);break;case"podcast":if(vk.widget||u.pretty_cards)return!1;var Ae="_im_media_preview"===domPN(y).id,xe=!Ae&&cur.editingPost&&"wpe_media_preview"===domPN(y).id;if(Ae)b='<div class="medadd_c_podcast"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_podcast_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_podcast_info fl_l"><a class="medadd_c_podcast_title" target="_blank" href="'+o.href+'">'+o.title+'</a><div class="medadd_c_podcast_type">'+o.lang.title+"</div></div>";else{var De=!1;each(f.chosenMedias||[],(function(e,a){isArray(a)&&"podcast"===a[0]&&(cur.addMedia[f.lnkId].unchooseMedia(e),De=!0)})),De&&f.onChange&&f.onChange(t,i,o,n),b='<div class="podcast_preview_title">'+getLang("audio_podcast_attach_media")+"</div>";var Ie=o.audio[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o.audio[AudioUtils.AUDIO_ITEM_INDEX_ID];cur.podcastEditData={audioId:Ie,ref:"post",onCreate:function(e,a){f.chooseMedia("podcast",e[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[AudioUtils.AUDIO_ITEM_INDEX_ID],{audio:e,coverUrl:a})}};var Me="<span class=\"podcast_snippet__edit\" onclick=\"cur.chooseMedia = cur.podcastEditData.chooseMedia; stManager.add([jsc('web/podcast.js')], function() { Podcast.edit('"+Ie+"'); });\"></span>";b+='<div class="podcast_snippet_loading" id="podcast_loading'+i[0]+'"></div>',stManager.add([jsc("web/podcast.js")],(function(){domReplaceEl(ge("podcast_loading"+i[0]),Podcast.drawSnippet(o.audio,o.coverUrl,Me))}),!0)}if(y=J,(o.onSuccess||function(){})(),hide(domByClass(V.menuNode,"_type_podcast")),!Ae&&!xe){var Se=ge("official"),Pe=Se&&gpeByClass("_submit_post_box",Se);if(Se&&Pe)(be=domData(Pe,"from-oid"))!==(fe=domData(Pe,"oid"))&&(A=" attach_disabled")}break;case M:if(vk.widget||u.pretty_cards||u[M])return!1;var Be="",$e=Number(o.type);if($e===x.GROUPS_CLASS_EVENT&&(Be=o.private?getTemplate("event_snippet_private_info"):""),!(b=getTemplate("event_snippet",extend({bottom:Be},o))))return(o.onError||function(){})(),!1;b='<div class="event_preview_title">'+($e===x.GROUPS_CLASS_EVENT?getLang("events_media_type"):getLang("groups_media_type_community"))+"</div>"+b,y=Z,(o.onSuccess||function(){})()}if(q){var Oe=f.chosenMedias,Ee=c?h:Oe.length,Le="";if(H&&1===k)Le=!1;else if("photos_list"===t)Le=se('<div class="page_preview_'+t+"_wrap"+A+'" style="position: relative">'+b+'<div class="page_photos_count">'+i.split(",").length+"</div></div>");else if("postpone"==t&&W||"copyright"===t||t===S)Le=!1;else{var Ne=null;"share"===t&&o.map_data&&(Ne="map"),Le=se('<div class="page_preview_'+(Ne||t)+"_wrap"+A+(I?" page_preview_vk_mini_app":"")+'"'+(m.nocl?' style="cursor: default"':"")+C+'><div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+f.lnkId+"].unchooseMedia("+Ee+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+b+w+"</div>")}if(addClass(Le,k?"fl_l":"clear_fix"),void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),m.toggleLnk&&!c){var Ue=f.attachCount()+1<z;toggle(e,Ue),m.onToggleBlock&&m.onToggleBlock(Ue)}H&&1===k?(addClass(y,"editable_thumbs_wrap"),y=domLC(y)&&hasClass(domLC(y),"editable_thumbs")?domLC(y):y.appendChild(ce("div",{id:"thumbs_edit"+G,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css",jsc("web/thumbs_edit.js")],()=>{if(Oe[Ee]&&(Oe[Ee].type===t||Oe[Ee].media!==i)){if(m.toggleLnk&&!c){var n=f.attachCount()+1<z;toggle(e,n),m.onToggleBlock&&m.onToggleBlock(n)}o.editable.remove=f.unchooseMedia.pbind(Ee),show(domPN(y));var r=ThumbsEdit.convert(t,i,o.editable);domData(y,"te-inited")?c?ThumbsEdit.updateMedia(y,t,i,o):ThumbsEdit.addMedia(y,r):ThumbsEdit.init(y,[r],{width:m.teWidth,height:m.teHeight,force:!0,onMove:m.onAddMediaChange,onUpdate:m.onChangedSize,deferred:!0}),toggleClass(a,"media_preview_has_medias",f.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),m.onChangedSize&&m.onChangedSize()}},!0)):(("postpone"!=t&&"copyright"!=t&&t!==S||!W)&&(show(y),c?y.replaceChild(Le,Oe[h][2]):y.appendChild(Le)),F&&(y==X?stManager.add([jsc("web/sorter.js")],(function(){var e=getXY(X),a=getSize(X),t=function(){X.sorter?sorter.added(X):y.childNodes.length>1&&sorter.init(X,{onReorder:m.onAddMediaChange})};e[0]||e[1]||a[0]||a[1]?t():cur.sorterClbk=t,m.onChangedSize&&m.onChangedSize()}),!0):y==K&&stManager.add([jsc("web/qsorter.js")],(function(){K.qsorter?qsorter.added(K):y.childNodes.length>1&&qsorter.init(K,f.qsorterOpts()),m.onChangedSize&&m.onChangedSize()}),!0)),m.onChangedSize&&m.onChangedSize()),c?Oe[h]=[t,i,Le,n,v,o]:Oe.push([t,i,Le,n,v,o])}else{Ee=0;if("postpone"===t?Ee=1:"mark_as_ads"===t&&(Ee=2),"postpone"==t&&W||"copyright"===t||t===S)Le=!1;else{var je=(!1===k?"page_docs_preview":"page_pics_preview")+(Ee?"":" post_thumbed_media");je+=k?" fl_l":" clear_fix";var Re=null;"share"===t&&o.map_data&&(Re="map"),Le=se(`\n            <div class="${je}">\n              <div class="${"page_preview_"+(Re||t)+"_wrap"} ${A}" ${(m.nocl?'style="cursor: default"':"")+C}>\n                ${b}\n                <div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="${getLang("dont_attach")}" aria-label="${getLang("dont_attach")}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[${f.lnkId}].unchooseMedia(${Ee}); return cancelEvent(event);">\n                  <div class="page_media_x" nosorthandle="1"></div>\n                </div>\n                ${w}\n              </div>\n            </div>`)}void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),"postpone"!==t&&t!==S&&"mark_as_ads"!==t&&"copyright"!==t&&(f.chosenMedia=[t,i],f.chosenMedia[5]=o,f.chosenMediaData=o),f.singleAdded(Le,t)}"share"==t?!o.title||n||o.url?o.video?(cur.shareShowImg=0,f.bigLink=!0,f.showExternalPreview()):f.showExternalPreview():(cur.shareShowImg=0,f.showPreview(!0),f.shareData.images=!1):"page"==t?o.nopreview||(cur.shareShowImg=0,f.shareData=extend(f.shareData||{},o,{images:!1}),f.showPreview()):"poll"===t?f.pollCreate(o):"postpone"==t?W?f.postponeInd=Ee:f.setupPostpone(o,he):"mark_as_ads"==t?f.markAsAds=1:"pretty_cards"==t&&f.createPrettyCards(o),toggleClass(a,"media_preview_has_medias",f.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),m.onChangedSize&&m.onChangedSize();var ze=window.event;return ze&&"click"==ze.type&&(ze.ctrlKey||ze.metaKey||ze.shiftKey)&&f.attachCount()+1<=z&&(r=!0),cur.fileApiUploadStarted&&void 0!==o.upload_ind||cur.preventBoxHideWithSharedBox||cur.preventBoxHide||!0===r||inArray(t,["poll","share","page","postpone","mark_as_ads","pretty_cards","copyright"])||boxQueue.hideLast(),cur.lastPostMsg=!1,m.onMediaAdd&&m.onMediaAdd(),getAudioPlayer().updateCurrentPlaying(),cur.onMediaChanged&&cur.onMediaChanged(f.chosenMedias),m.onMediaChanged&&m.onMediaChanged(),void 0!==o.upload_ind&&delete o.upload_ind,!1}function qe(e,a){return isString(e)?e=clean(Object(l.unclean)(Object(l.unclean)(e))):(isObject(e)||isArray(e))&&(e=He(e,a)),e}function He(e,a){if(!vk.widget)return e;if((a=positive(a))>5)return e;if(isArray(e))e.forEach((function(t,i){e[i]=qe(t,a+1)}));else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&(e[t]=qe(e[t],a+1));return e}function Fe(e){var a=340,t=127;return"im"!==cur.module&&(a=Math.min(parseInt(e.parentElement.offsetWidth),510)||480,t=Math.min(a/2,200),(hasClass(e.parentElement,"reply_media_preview")||"wpe_media_preview"===e.parentElement.id)&&t>120&&(t=120)),{width:a,height:t}}},unchooseMedia:function(t,i){if(f.onChange&&!1===f.onChange(!1,t))return!1;if(q){if(cur.checkURLDomainRequest&&cur.checkURLDomainRequest.abort(),clearTimeout(cur.showLoaderTimeout),clearInterval(cur.shareImgInterval),clearTimeout(cur.shareImgInterval2),clearTimeout(cur.imgLoadTimeout),clearTimeout(cur.checkURLDomainTO),void 0===t){if(window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+G),each(f.chosenMedias,(function(e,a){!a||void 0===e||i&&!inArray(a[0],i)||f.unchooseMedia(e)})),f.urlsCancelled=[],m.onChangedSize){m.onChangedSize();var o=setInterval(m.onChangedSize,50);setTimeout(clearTimeout.bind(null,o),500)}return void(f.copyrightToggle&&f.copyrightToggle(!0))}var n=f.chosenMedias;if(n[t]){var r;switch("podcast"===n[t][0]&&(r=cur.editingPost&&!cur.editingPost[3].reply&&"wpe_media_preview"===gpeByClass("multi_media_preview",n[t][2]).id),n[t][2]?((b=geByClass1("page_media_x_wrap",n[t][2],"div"))&&b.tt&&b.tt.el&&b.tt.destroy(),domPN(n[t][2])==X&&X.sorter?(each(X.sorter.elems,(function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})})),X.sorter.destroy(),re(n[t][2]),X.childNodes.length>1&&sorter.init(X,{onReorder:m.onAddMediaChange})):domPN(n[t][2])==K&&K.qsorter?(each(K.qsorter.elems,(function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})})),K.qsorter.destroy(),re(n[t][2]),K.childNodes.length>1&&qsorter.init(K,f.qsorterOpts())):re(n[t][2])):"photo"!=n[t][0]&&"video"!=n[t][0]&&"album"!=n[t][0]||window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+G,n[t][0]+n[t][1]),n[t][0]){case"page":case"share":f.shareData={},re(f.sharePreview),hide("medadd_c_linkimg_loader"),delete f.sharePreview,show(domByClass(V.menuNode,"_type_share")),show(e),(d=ge("signed"))&&disable(d,!isChecked("official")),show(domByClass(V.menuNode,"_type_market"));break;case"pretty_cards":var d;re(f.prettyCardGallery.el),delete f.prettyCardGallery,(d=ge("signed"))&&disable(d,!isChecked("official")),show(domByClass(V.menuNode,"_type_pretty_cards")),show(e);break;case"poll":re(f.pollPreview),delete f.pollPreview,show(domByClass(V.menuNode,"_type_poll"));break;case"map":show(domByClass(V.menuNode,"_type_map"));break;case"podcast":var s=!0;if(r)+cur.editingPost[0].split("_")[0]!==cur.oid&&(s=!1);else{var l=(c=ge("official"))&&gpeByClass("_submit_post_box",c);if(c&&l)domData(l,"from-oid")!==domData(l,"oid")&&(s=!1)}toggle(domByClass(V.menuNode,"_type_podcast"),s);break;case"market":show(e),show(domByClass(V.menuNode,"_type_market"));break;case"wall":case"wall_reply":case"story":case"narrative":show(e);break;case"postpone":var c,_=geByClass1("medadd_c_timersett",f.postponePreview);cur.editingPost&&_&&!W?re(domFC(f.postponePreview)):(ae.innerHTML="",f.postponeDatepicker=null,f.postponeDate=null),f.postponePreview=!1,(c=ge("official"))&&disable(c,!1);var p=m.poster,u="";if(cur.editingPost)if(cur.editingPost[6]&&intval(cur.editingPost[6].getAttribute("data-suggest"))){u=getLang("wall_publish_suggest");var h=ge("wpe_save");h&&(h.innerHTML=u)}else{u=getLang("wall_publish_now");var g=ge("wpe_save");g&&(g.innerHTML=u)}else u=getLang("wall_send"),ge("send_post").innerHTML=u;p&&p.changeBtnText(u),W?(removeClass(f.menu.postponeBtn,"on"),f.updatePostponeBtnText(!0)):show(domByClass(V.menuNode,"_type_postpone"));break;case S:T(f);break;case"mark_as_ads":show(domByClass(V.menuNode,"_type_mark_as_ads")),f.markAsAds=!1;break;case"copyright":f.copyrightRemove()}n[t]=!1}if(m.toggleLnk){s=f.attachCount()<z;toggle(e,s),m.onToggleBlock&&m.onToggleBlock(s)}toggle(Y,!!(H?geByClass1("thumb_wrap",Y):domFC(Y))),toggle(K,!!domFC(K)),toggle(X,!!domFC(X)),toggle(Q,!!domFC(Q)),toggle(Z,!!domFC(Z)),toggle(J,!!domFC(J)),toggle(ee,!!domFC(ee)),W||toggle(ae,!!domFC(ae)),toggle(te,!!domFC(te))}else{var v,b;if(null==t&&(t=0),(b=geByClass("page_media_x_wrap",a,"div")[t])&&b.tt&&b.tt.el&&b.tt.destroy(),1==t){if(W)ae.innerHTML="",f.postponeDatepicker=null,f.postponeDate=null,removeClass(f.menu.postponeBtn,"on"),f.updatePostponeBtnText(!0);else if(f.postponePreview){show(geByClass1("add_media_type_"+G+"_postpone",V.menuNode,"a"));var w=domPN(f.postponePreview);window.tooltips&&tooltips.destroyAll(w),re(w),f.postponePreview=!1;var k=V.lastTypes;each(V.types,(function(e,a){"postpone"===a[0]&&k.push(a)})),V.setItems(k)}}else if(2==t&&f.markAsAds){f.markAsAds=!1;var y=geByClass1("page_preview_mark_as_ads_wrap",a);window.tooltips&&y&&tooltips.destroyAll(y),re(y);k=V.lastTypes;each(V.types,(function(e,a){"mark_as_ads"===a[0]&&k.push(a)})),V.setItems(k)}else if(3===t)f.copyrightRemove();else{if(f.postponePreview||f.markAsAds){w=f.postponePreview&&domPN(f.postponePreview),y=f.markAsAds&&domPN(geByClass1("page_preview_mark_as_ads_wrap",a));for(var C=[],A=0;A<a.childNodes.length;A++){var x=a.childNodes[A];"DIV"==x.nodeName&&x!=w&&x!=y&&C.push(x)}each(C,(function(e,a){re(a)}));k=[];each(V.types,(function(e,a){"postpone"===a[0]&&f.postponePreview||"mark_as_ads"===a[0]&&f.markAsAds||k.push(a)})),V.setItems(k)}else val(a,""),addClass(a,"med_no_attach"),V.setItems(V.types);f.chosenMedia&&(f.chosenMedia=!1,f.chosenMediaData=!1),(v=f.shareData)&&(v.url&&f.urlsCancelled.push(v.url),v.initialPattern&&f.urlsCancelled.push(v.initialPattern),f.shareData={}),each([f.sharePreview,f.pollPreview],(function(){re(this)})),f.sharePreview=f.pollPreview=!1}m.toggleLnk&&show(e)}if(toggleClass(a,"media_preview_has_medias",f.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),f.copyrightToggle&&f.copyrightToggle(!0),cur.onMediaChanged&&cur.onMediaChanged(n),m.onMediaChanged&&m.onMediaChanged(),cur.lastPostMsg=!1,f.onChange&&f.onChange(!1),m.onChangedSize){m.onChangedSize();o=setInterval(m.onChangedSize,50);setTimeout(clearTimeout.bind(null,o),500)}},findChosenMedia:e=>f.chosenMedias.find(a=>a[0]===e),findChosenMediaAllIndices(e){return a=f.chosenMedias,t=a=>a[0]===e,a.reduce((function(e,a,i){return t(a)?e.concat(i):e}),[]);var a,t},chosenMediaToObject(e){var a=D(e,6);return{type:a[0],media:a[1],data:a[5]}},unchooseMediaForType(e){f.findChosenMediaAllIndices(e).forEach(e=>{f.unchooseMedia(e)})},singleAdded:function(t,i){if("copyright"!==i){if("postpone"===i){if(W)return;a.appendChild(t)}else if("mark_as_ads"===i)f.postponePreview?a.insertBefore(t,domLC(a)):a.appendChild(t);else{if(i===S)return;domFC(a)?a.insertBefore(t,domFC(a)):a.appendChild(t)}removeClass(a,"med_no_attach");var o=[];each(V.lastTypes,(function(e,a){("postpone"!==a[0]||!f.postponePreview&&"postpone"!==i)&&("mark_as_ads"!==a[0]||!f.markAsAds&&"mark_as_ads"!==i)&&(inArray(i,["postpone","mark_as_ads"])||inArray(a[0],["postpone","mark_as_ads"]))&&o.push(a)})),V.setItems(o),m.toggleLnk&&!o.length&&hide(e)}},getMedias:function(e){if(q){var a=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+G):[],t={},i=f.chosenMedias||[],o=[],n=function(e,a,i){if(i[0]+i[1]==e)return o.push(i),t[e]=!0,!1};return each(a,(function(e,a){each(i,n.pbind(a[0]+a[1]))})),each(K.childNodes,(function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(i,n.pbind(t[1]+t[2]))})),each(X.childNodes,(function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(i,n.pbind(t[1]+t[2]))})),each(i,(function(e,a){a&&isArray(a)&&a.length&&!t[a[0]+a[1]]&&o.push(a)})),o}return(i=f.chosenMedia)?[e?i:i[0]+i[1]]:[]},showPhoto:function(e){function a(a,t,i,o){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e,a,t,i){for(var o in!cur.pvData||cur.pvShown&&cur.pvListId==a||delete cur.pvData[a],ajaxCache)o.toString().match(/^\/al_photos\.php\#act=show&draft_photos/)&&delete ajaxCache[o];var n=f.getMedias(),r=[];return each(n,(function(e,a){a&&"photo"==a[0]&&r.push(a[1]+"/"+(f.phLists[a[1]]||""))})),t.additional={},t.additional.open_pe=intval(cur.openEditor),cur.openEditor||(t.additional.draft_photos=r.join(";")),delete cur.openEditor,showPhoto(e,a,extend(t,{queue:1}),i)})),showMediaProgress:function(a,t,i){if(f.onProgress&&!1===f.onProgress(a,t,i))return!1;var o=i.loaded/i.total,n=intval(100*o),r=(i.fileName||i.name||"").replace(/[&<>"']/g,""),d=r?t+"_"+r:t,s=r?r.length>33?r.substr(0,30)+"...":r:"",l=ge("upload"+d+"_progress");if(l){show(l);u=geByClass1("ui_progress_bar",l);setStyle(u,{width:n+"%"})}else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[d]=G;var c=`\n          <div class="fl_l">\n            <div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">\n              <div id="upload${d}_progress" class="page_attach_progress ui_progress">\n                <div class="ui_progress_back"></div>\n                <div class="ui_progress_bar"></div>\n              </div>\n            </div>\n          </div>\n          ${s?'<div class="attach_label fl_l">'+s+"</div>":""}\n          <div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200);showTooltip(this, {text: '${getLang("dont_attach")}', shift: [16, 8, 8], black: 1})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="Upload.terminateUpload(${t}, '${r||t}', this);"></div>\n          `;if(q){if(te.appendChild(ce("div",{id:"upload"+d+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"},{marginTop:"6px"})),show(te),m.toggleLnk){var _=f.attachCount()<z;toggle(e,_),m.onToggleBlock&&m.onToggleBlock(_)}}else{var p=ce("div",{id:"upload"+d+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"});f.chosenMedia="progress",f.singleAdded(p,"progress")}m.onChangedSize&&m.onChangedSize(),l=ge("upload"+d+"_progress");var u=geByClass1("ui_progress_bar",l);n?setStyle(u,{width:n+"%"}):(setStyle(u,{width:"1px"}),hide(l))}},hasVisibleRows:function(){var e=!1;return each(geByClass("media_preview",a),(function(){if(isVisible(this))return e=!0,!1})),e},attachCount:function(){if(f.attachedCount)return f.attachedCount();if(!a)return 0;if(!q)return a.childNodes.length-(f.postponePreview?1:0)-(f.markAsAds?1:0);var e=(H&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+G]||{}).previews||[]:Y.childNodes).length+K.childNodes.length+ee.childNodes.length+X.childNodes.length/(X.sorter?2:1)+te.childNodes.length;return f.sharePreview&&++e,f.pollPreview&&++e,e},pollCreate:function(e){var a=e.poll_html;if(cur.addMedia[G].pollInputData=e,Q)if(a){var t=`<div class="medadd_c" id="poll_dummy${G}">${a}</div>`;f.pollPreview=Q.appendChild(domFC(cf(t)))}else stManager.add(["ui_controls.css","ui_controls.js","datepicker.css",window.jsc("web/datepicker.js")],()=>{var a=e.poll_question_length,t=e.question,i=e.lang,o=e[P],n=e.answers,r=e[B],d=e[$],s=e[O],c=e[E],_=e[L],p=e[N],u=e.poll_is_board,h=e.poll_is_edit,g=e.poll_is_not_posted,v=e.poll_backgrounds,b=e.poll_answers_limit||10,w=e.poll_no_animate_opening||e.question,k=e[U],y=`\n          <div class="medadd_h medadd_h_poll inl_bl">\n            ${i.question}\n            <span class="medadd_poll_question_warning"></span>\n          </div>\n          <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" oninput="cur.addMedia[%lnkid%].pollChangeQuestion(this)" maxlength="${a}" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_question${u&&h?" disabled":""}"${u&&h?' readonly="readonly"':""} id="create_poll_question%lnkid%" value="%question%" />\n          <div class="medadd_h">${i.answers}</div>\n          <div class="medadd_poll_answers" id="create_poll_answers%lnkid%">\n            %answers%\n          </div>\n          ${u&&h?"":`<div class="medadd_poll_answer_add_wrap" id="create_poll_add%lnkid%">\n            <div class="medadd_poll_answer_add fakeinput dark" onclick="cur.addMedia[%lnkid%].pollAnswerAdd()">${i.answer_add}</div>\n          </div>`}\n          %backgrounds%\n          %settings%\n          <div class="checkbox medadd_datepicker_checkbox medadd_poll_cb%classuntil%" id="create_poll_until%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.until}</div>\n          <div class="medadd_datepicker">\n            <input type="text" class="medadd_datepicker_date dark" id="create_poll_untildate%lnkid%"/><div class="medadd_datepicker_at datepicker_at">${i.at}</div><input type="text" class="medadd_datepicker_time dark" id="create_poll_untiltime%lnkid%"/>\n          </div>\n          ${u?`\n          <div class="checkbox medadd_poll_cb%classonmain%" id="create_poll_onmain%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.add_to_main}</div>\n          `:""}\n          ${u&&h?`\n          <div class="checkbox medadd_poll_cb%classclosed%" id="create_poll_closed%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.close}</div>\n          `:""}\n        `,C=`\n          <div class="medadd_h">${i.settings}</div>\n          ${h&&!g||u?"":`<div class="checkbox medadd_poll_cb%classanon%" id="create_poll_anonymous%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.anonymous}</div>`}\n          ${h?"":`<div class="checkbox medadd_poll_cb%classmulty%" id="create_poll_multy%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.multy}</div>`}\n          ${h?"":`<div class="checkbox medadd_poll_cb%classdisableunvote%" id="create_poll_disable_unvote%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.disable_unvote}</div>`}\n        `,T=`\n          <div class="medadd_poll_answer_wrap">\n            <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_answer${u&&h?" disabled":""}"${u&&h?' readonly="readonly"':""} %attrs%/>\n            <div class="page_media_x_wrap medadd_poll_answer_remove" data-title="${i.answer_remove}" aria-label="${i.answer_remove}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[%lnkid%].pollAnswerRemove(this)">\n              <div class="page_media_x"></div>\n            </div>\n          </div>\n        `,A=`\n          <div class="medadd_h">${i.background}</div>\n          <div class="medadd_poll_backgrounds_wrap" id="create_poll_backgrounds_wrap%lnkid%">\n            <div class="medadd_poll_backgrounds_arrow_prev" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('prev')"></div>\n            <div class="medadd_poll_backgrounds_arrow_next" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('next')"></div>\n            <div class="medadd_poll_backgrounds" id="create_poll_backgrounds%lnkid%">\n              %backgrounds%\n            </div>\n          </div>\n        `;cur.addMedia[G].answersLimit=b,cur.addMedia[G].tplAnswer=T;var x="";u||(x+=cur.addMedia[G].pollBackgroundGetHtml(),v&&v.forEach(e=>{x+=cur.addMedia[G].pollBackgroundGetHtml(e)}),x+=rs('\n          <div class="medadd_poll_background medadd_poll_background_uploader" onclick="cur.addMedia[%lnkid%].pollBackgroundUpload(this);">\n            <div class="medadd_poll_background_preview"></div>\n          </div>\n        ',{lnkid:G}),x=rs(A,{lnkid:G,backgrounds:x}));var I="";if(!n||isArray(n)&&!n.length){var M=[];for(var S in e)if(e.hasOwnProperty(S)){var j="answers".length+1;if("answers["===S.substr(0,j)){var R=intval(S.slice(j,-1));M.push([R,e[S]])}}M.length?(n=[],M.sort((e,a)=>e[0]<0&&a[0]<0?e[0]<a[0]:e[0]>=0&&a[0]>=0?e[0]>a[0]:a[0]<0).forEach(e=>{n.push([e[0]<0?e[0]:0,e[1]])})):n=[[0,""],[0,""]]}n.forEach((e,a)=>{var t=D(e,2),i=t[0],o=t[1];I+=rs(T,{attrs:(i?` id="create_poll_ans${i}"`:"")+(o?` value="${clean(Object(l.unclean)(o))}"`:""),lnkid:G})}),f.pollPreview=Q.appendChild(ce("div",{className:"medadd_c medadd_poll",innerHTML:rs(y,{lnkid:G,question:t?clean(Object(l.unclean)(t)):"",classuntil:_?" on":"",settings:rs(C,{lnkid:G,classanon:o?" on":"",classmulty:p?" on":"",classdisableunvote:k?" on":""}),backgrounds:x,answers:I,classonmain:r?" on":"",classclosed:d?" on":""})})),n.length==b&&hide("create_poll_add"+G);var z="create_poll_untildate"+G,q=new Datepicker(z,{time:"create_poll_untiltime"+G,width:157,noPast:!0,activePeriod:2592e6,minStep:1,date:_||Math.round(((new Date).getTime()+864e5)/1e3),onUpdate:()=>{var e=new Date,a=new Date(1e3*positive(val(z)));a.getTime()>=e.getTime()+2592e6&&(q.timePicker.hourDD.val(e.getHours()),a.getMinutes()>e.getMinutes()&&q.timePicker.minDD.val(e.getMinutes()),q.setDate(a.getFullYear(),a.getMonth()+1,a.getDate(),!0,e.getHours(),e.getMinutes())),cur.addMedia[G].pollChanged()}});if(cur.addMedia[G].pollBackgroundsPos=0,cur.addMedia[G].pollBackgroundSelect(c?-c:intval(s)),cur.addMedia[G].pollChangeQuestion(ge("create_poll_question"+G)),w)elfocus("create_poll_question"+G),m.onChangedSize&&m.onChangedSize(),cur.addMedia[G].pollUpdateArrows();else{f.pollPreview.style.position="absolute",f.pollPreview.style.visibility="hidden";var H=f.pollPreview.offsetHeight;f.pollPreview.style.height=0,f.pollPreview.style.position="",f.pollPreview.style.visibility="",animate(f.pollPreview,{height:H},m.mail?0:200,()=>{f.pollPreview.style.height="",elfocus("create_poll_question"+G),m.onChangedSize&&m.onChangedSize(),cur.addMedia[G].pollUpdateArrows()})}var F=ge("create_poll_backgrounds_wrap"+G);function W(){addEvent(F,browserFeatures.wheelEvent,cur.addMedia[G].pollMouseWheel)}function V(){removeEvent(F,browserFeatures.wheelEvent,cur.addMedia[G].pollMouseWheel)}addEvent(F,"mouseenter",W),addEvent(F,"mouseleave",V),cur.destroy.push((function(){removeEvent(F,browserFeatures.wheelEvent,cur.addMedia[G].pollMouseWheel),removeEvent(F,"mouseenter",W),removeEvent(F,"mouseleave",V)}))})},pollMouseWheel:function(e){cancelEvent(e);var a=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;cur.addMedia[G].pollBackgroundsPaging(a,!0)},pollBackgroundsPaging:function(e,a){var t=ge("create_poll_backgrounds_wrap"+G),i=ge("create_poll_backgrounds"+G),o=t.offsetWidth,n=cur.addMedia[G].pollBackgroundsPos;isNumeric(e)?n+=e:"next"===e?n+=o:n-=o,cur.addMedia[G].pollBackgroundsPos=Math.max(0,Math.min(n,i.scrollWidth-o)),a?removeClass(i,"animated"):addClass(i,"animated"),setStyle(i,"transform","translateX("+cur.addMedia[G].pollBackgroundsPos*(vk.rtl?1:-1)+"px)"),cur.addMedia[G].pollUpdateArrows()},pollUpdateArrows:function(){var e=ge("create_poll_backgrounds_wrap"+G),a=ge("create_poll_backgrounds"+G);if(e){var t=e.offsetWidth,i=a.scrollWidth-t;toggleClass(e,"medadd_poll_backgrounds_arrow_prev_disabled",0===cur.addMedia[G].pollBackgroundsPos),toggleClass(e,"medadd_poll_backgrounds_arrow_next_disabled",cur.addMedia[G].pollBackgroundsPos===i||i<=0)}},pollUntilGet:function(){var e=isChecked("create_poll_until"+G)?positive(val("create_poll_untildate"+G)):0;return Math.min(e,(new Date).getTime()+2592e6)},pollBackgroundChange:function(e,a){var t=gpeByClass("medadd_poll_backgrounds",e),i=geByClass1("medadd_poll_background_radio",e);geByClass("medadd_poll_background_radio",t).forEach(e=>{checkbox(e,e===i)}),cur.addMedia[G].pollChanged()},pollAnswerAdd:function(){var e=ge("create_poll_answers"+G),a=geByClass("medadd_poll_answer_wrap",e).length,t=cur.addMedia[G].answersLimit;if(a<t){var i=cf(rs(cur.addMedia[G].tplAnswer,{lnkid:G}));e.appendChild(i);var o=geByClass("medadd_poll_answer",e).pop();elfocus(o)}m.onChangedSize&&m.onChangedSize(),toggle("create_poll_add"+G,a<t-1)},pollAnswerRemove:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),m.onChangedSize&&m.onChangedSize(),cur.addMedia[G].pollChanged(),show("create_poll_add"+G)},pollKeydown:function(e,a){if((a=a||window.event)&&(10==a.keyCode||a.keyCode==KEY.ENTER||a.keyCode==KEY.TAB)){var t=hasClass(e,"medadd_poll_question"),i=a.shiftKey;if(t&&i)return;var o=t?domFC(domNS(domNS(e))):(i?domPS:domNS)(domPN(e));return o?elfocus(geByTag1("input",o)):i?elfocus(geByClass1("medadd_poll_question",domPN(domPN(domPN(e))))):this.pollAnswerAdd(),cancelEvent(a)}},pollKeyup:function(e,a){(!(a=a||window.event)||10!=a.keyCode&&a.keyCode!=KEY.ENTER&&a.keyCode!=KEY.TAB)&&(cur.addMedia[G].pollChangedTimeout&&clearTimeout(cur.addMedia[G].pollChangedTimeout),cur.addMedia[G].pollChangedTimeout=setTimeout(()=>cur.addMedia[G].pollChanged(),100))},pollBackgroundGetHtml:function(e){var a="",t=D(e||[0],1)[0];if(t<0){var i=D(e,5),o=i[1],n=i[2],r=i[3],d=i[4];a=`\n          <div class="medadd_poll_background" onclick="cur.addMedia[${G}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview">\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n              <div class="medadd_poll_background_photo" style="background: rgb(${n}, ${r}, ${d});">\n                <div class="medadd_poll_background_photo_holder">\n                  <div class="medadd_poll_background_photo_gradient" style="background: linear-gradient(0, rgba(${n}, ${r}, ${d}, 1) 0, rgba(${n}, ${r}, ${d}, 0) 50%)"></div>\n                  <img src="${o}" class="medadd_poll_background_photo_img"/>\n                </div>\n              </div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}" data-photo-r="${n}" data-photo-g="${r}" data-photo-b="${d}" data-photo-url="${o}"></div>\n          </div>\n        `}else{var s="",l="";if(t){var c=D(e,2)[1];if("gradient"===c){var _=D(e,4),p=_[2],u=_[3],h=[];u.forEach(e=>{var a=D(e,2),t=a[0],i=a[1];h.push(`#${i} ${Math.round(100*t)}%`)}),s=`background: linear-gradient(${p-90}deg, ${h.join(",")});"`}else if("tile"===c){var g=D(e,5),m=g[2],v=g[3];s=`background: url(${g[4]}) top center;background-size: ${m}px ${v}px;"`}}else l=" medadd_poll_background_default";a=`\n          <div class="medadd_poll_background${l}" onclick="cur.addMedia[${G}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview"${s?` style="${s}"`:""}>\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}"></div>\n          </div>\n        `}return a},pollBackgroundAdd:function(e){var a=ge("create_poll_backgrounds"+G),t=geByClass1("medadd_poll_background_uploader",a),i=cf(cur.addMedia[G].pollBackgroundGetHtml(e));i=domFC(i),a.insertBefore(i,t)},pollBackgroundSelect:function(e){var a=ge("create_poll_backgrounds"+G);if(a){var t=domQuery1(`.radiobtn[data-id="${e}"]`,a)||domQuery1('.radiobtn[data-id="0"]',a);if(t){var i=domPN(t);cur.addMedia[G].pollBackgroundsPos=(i.offsetLeft-a.offsetWidth/2+i.offsetWidth/2)*(vk.rtl?-1:1),cur.addMedia[G].pollBackgroundsPaging(0,!0),cur.addMedia[G].pollBackgroundChange(i)}}},pollBackgroundGet:function(){var e=domQuery1(`#create_poll_backgrounds${G} .radiobtn.on`);return intval(domData(e,"id"))},pollBackgroundUploaded:function(e,a,t){var i=-intval(e);cur.addMedia[G].pollBackgroundAdd([i,clean(a),intval(t.r),intval(t.g),intval(t.b)]),cur.addMedia[G].pollBackgroundSelect(i)},pollBackgroundUpload:function(){var e=cur.addMedia[G].pollInputData;showBox("al_page.php",{act:"owner_photo_box",oid:e&&e.poll_owner_id||(m.mail?cur.gid?-cur.gid:vk.id:cur.oid||vk.id),lnk_id:G,is_voting:1},{stat:["owner_photo.css",jsc("web/owner_photo.js")]})},pollChanged:function(){m.onMediaChange&&m.onMediaChange()},pollBackgroundsGet:function(){var e=cur.addMedia[G].pollInputData,a=[];e&&e.poll_backgrounds&&e.poll_backgrounds.forEach(e=>{D(e,1)[0]>0&&a.push(e)});var t=ge("create_poll_backgrounds"+G);return geByClass("radiobtn",t).forEach((function(e){var t=intval(domData(e,"id"));t&&t<0&&a.push([t,domData(e,"photo-url"),intval(domData(e,"photo-r")),intval(domData(e,"photo-g")),intval(domData(e,"photo-b"))])})),a},pollData:function(e,a){var t=cur.addMedia[G],o={};if(t&&ge("create_poll_question"+G)){for(var n=ge("create_poll_answers"+G),r=!1,d=0,s=domFC(n);s;s=domNS(s)){var l=trim(val(domFC(s)));if(l){var c=-intval((domFC(s).id.match(/^create_poll_ans(\d+)$/)||[0,-d++])[1]);o[`answers[${c}]`]=l,r=!0}}if(!r)return domFC(n)||t.pollAnswerAdd(),!0!==e&&Object(i.notaBene)(domFC(domFC(n))),!1;var _=trim(val("create_poll_question"+G));if(!_)return!0!==e&&Object(i.notaBene)("create_poll_question"+G),!1;o.question=_,o[L]=t.pollUntilGet();var p=t.pollBackgroundGet();if(p<0?(o[E]=-p,o[O]=0):p>=0&&(o[E]=0,o[O]=p),o[P]=isChecked("create_poll_anonymous"+G)?1:0,o[B]=isChecked("create_poll_onmain"+G)?1:0,o[$]=isChecked("create_poll_closed"+G)?1:0,o[N]=isChecked("create_poll_multy"+G)?1:0,o[U]=isChecked("create_poll_disable_unvote"+G)?1:0,t.pollInputData&&a){o.poll_backgrounds=t.pollBackgroundsGet();var u=["poll_is_board","poll_is_edit","poll_id","poll_answers_limit"];m.mail&&u.push("lang"),u.forEach(e=>{t.pollInputData[e]&&(o[e]=t.pollInputData[e])}),m.mail&&(o.poll_is_edited=0,o["answers[0]"]||o.question!=t.pollInputData.question?o.poll_is_edited=1:[P,B,$,N,L,E,O,U].forEach(e=>{intval(o[e])!==intval(t.pollInputData[e])&&(o.poll_is_edited=1)}),o.poll_is_edited||t.pollInputData.answers.forEach(e=>{var a=D(e,2),t=a[0],i=a[1];void 0!==o[`answers[${-t}]`]&&o[`answers[${-t}]`]==i||(o.poll_is_edited=1)}))}}else t&&ge("poll_dummy"+G)&&t.pollInputData&&t.pollInputData.poll_id&&(o.poll_id=t.pollInputData.poll_id);return o},pollChangeQuestion:function(e){var a=cur.addMedia[G].pollInputData,t=a.poll_question_length-e.value.length,i=geByClass1("medadd_poll_question_warning");i.innerHTML=t<=20?langNumeric(t,a.lang.question_length):""},markAsAdsInit(){var e=this.markAsAdsGetCheckboxEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].markAsAdsChanged();`)},markAsAdsGetCheckboxEl:()=>!!v&&v.querySelector(".Post__markAsAdsButton"),markAsAdsData(e){var a=!!e&&{},t=this.markAsAds||isChecked(this.markAsAdsGetCheckboxEl());return!t&&this.chosenMedias&&(t=this.chosenMedias.some(e=>{if(isArray(e)&&"mark_as_ads"===D(e,1)[0])return!0})),(t||e)&&(a={mark_as_ads:t?1:0}),a},markAsAdsChanged(){var e=this.markAsAdsGetCheckboxEl();if(e&&!hasClass(e,"disabled")){checkbox(e),Wall&&Wall.togglePostMarkAsAds(e,e.dataset.muteId);var a=this.markAsAdsData(!0).mark_as_ads;f.copyrightToggle&&f.copyrightToggle(!a),f.donutUpdateVisibility(),m.onMediaChange&&m.onMediaChange()}},copyrightInit(){var e=this.copyrightGetBtnEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].copyrightShowBox();`),this.markAsAdsData(!0).mark_as_ads&&this.copyrightToggle(!1)},copyrightToggle(e){var a=document.querySelector("#post_copyright_btn"+this.lnkId);toggle(a,e);var t=this.copyrightGetBtnEl();t&&(e?(this.copyrightData(!0).copyright?(val(t,getLang("wall_post_copyright_edit_button")),t.classList.add("Post__copyrightButton--added")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added")),t.classList.remove("Post__copyrightButton--disabled")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added"),t.classList.add("Post__copyrightButton--disabled")))},copyrightGetBtnEl:()=>!!v&&v.querySelector(".Post__copyrightButton"),copyrightCreate(e){if(this.copyrightInputData=e,b&&e&&e.copyright){var a="post_copyright_btn"+this.lnkId,t=document.querySelector("#"+a);if(!t){var i=getLang("wall_post_copyright_source_text");t=cf(`<div class="post_action_btn on" id="${a}" onclick="cur.addMedia[${this.lnkId}].copyrightShowBox();">\n              <div class="post_action_btn_layout">\n                <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(i)}">${i}</span>\n              </div>\n             </div>`),b.appendChild(t)}}this.copyrightChanged()},copyrightRemove(){var e=document.querySelector("#post_copyright_btn"+this.lnkId);e&&e.parentNode.removeChild(e),this.copyrightInputData&&(this.copyrightInputData.copyright=""),this.copyrightChanged()},copyrightUnchoose(){this.chosenMedias&&this.chosenMedias.forEach((e,a)=>{isArray(e)&&"copyright"===e[0]&&this.unchooseMedia(a)}),this.multi||this.copyrightRemove()},copyrightBoxAccept(e){var a=e.btns.ok[0],t=document.querySelector(".PostCopyrightBox__input"),o=document.querySelector(".PostCopyrightBox__error");if(hide(o),!Object(i.isButtonLocked)(a)){var n=val(t);if(!n)return Object(i.notaBene)(t);ajax.post("al_wall.php",{act:"copyright_check_link",link:n},{onDone:()=>{this.copyrightInputData||(this.copyrightInputData={}),this.copyrightInputData.copyright=n,this.chooseMedia("copyright","",this.copyrightInputData),e.hide()},onFail:e=>(val(o,e),show(o),!0),showProgress:()=>Object(i.lockButton)(a),hideProgress:()=>Object(i.unlockButton)(a)})}},copyrightBoxDecline(e,a){a&&this.copyrightUnchoose(),e.hide()},copyrightShowBox(){showBox("al_wall.php",{act:"copyright_box"},{cache:!0,onDone:e=>{cur.postCopyrightFeatureTT&&cur.postCopyrightFeatureTT.hide();var a=this.copyrightData(!0);e.removeButtons(),a.copyright?(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text_edit")}),e.setButtons(getLang("wall_post_copyright_edit_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText(`<a onclick="cur.addMedia[${this.lnkId}].copyrightBoxDecline(curBox(), true);">${getLang("global_delete")}</a>`)):(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text")}),e.setButtons(getLang("wall_post_copyright_add_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText("")),e.show();var t=document.querySelector(".PostCopyrightBox__input");val(t,a.copyright?Object(l.unclean)(a.copyright):""),addEvent(t,"keypress",a=>Object(s.onEnter)(()=>{this.copyrightBoxAccept(e)},a)),t.focus()}})},copyrightChanged(){var e=this.markAsAdsData(!0).mark_as_ads;this.copyrightToggle(!e),m.onMediaChange&&m.onMediaChange()},copyrightData(e){var a=!!e&&{};return(this.copyrightInputData&&this.copyrightInputData.copyright||e)&&(a={copyright:this.copyrightInputData&&this.copyrightInputData.copyright||""}),a},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,a,t){if(!(cur.noCheckMessageURLs||f.chosenMedia||f.urlAttachmentLoading&&f.urlAttachmentLoading[0]>vkNow()-1e4||f.attachCount()>=z)){if(cur.checkMessageHandler&&Object(g.isFunction)(cur.checkMessageHandler)&&cur.checkMessageHandler(e),cur.reply_to&&cur.reply_to[0]){var i=Wall.getReplyName(cur.reply_to[0]);if(i=i&&isArray(i)&&i[1]?i[1]:""){var o=extractUrls(i,a);for(var n in o)if(o.hasOwnProperty(n)){var r=o[n].url;r.match(/^https?:\/\//)||(r="http://"+r),inArray(r,f.urlsCancelled)||f.urlsCancelled.push(r)}}}var d=extractUrls(e,a).map((function(e){var a=e.url,t=e.query,i=e.domain,o=a,n={};a.match(/^https?:\/\//)||(a="http://"+a);var r=inArray(a,f.urlsCancelled)||inArray(o,f.urlsCancelled),d=!0,s=!1;r||i.match(/(^|\.|\/\/)(vkontakte\.ru|vk\.com)/i)&&(d=!!t.match(/(#photo|^\/(photo|video|album|page|audio|doc|mask|poll|podcast)|z=(album|photo|video|audio_playlist|podcast)|w=(page|product|poll))(-?\d+_)?\d+|app\d+(?:_-\d+)?|\.(jpg|png|gif)$|artist\/([^\/]+).*$|market-?\d+\?section=album_\d+|^\/stickers\/.+$|\?w\=story(\d+)_(\d+)$|stor(y|ies)(\d+)_(\d+)$|^(\/dev)?\/(blog|press)\/.+$|^\/jobs\?w=job\d+$|^\/landings\/.+$|^\/messenger$|^\/fellowship$|^\/talents$|^\/bestgames2016$|^\/play_safe_at_home$|^\/services$|^\/vk_apps_contest$|^\/home(\/.+)?$|^\/miniapps_2019$|^\/data_protection(\?section=(rules|requests|principles))?$|^\/safety(\?section=(social|parents|youth|tips|health))?$|^\/ads(\/([a-zA-Z0-9\_]+))?$|^http:\/\/instagram\.com\/p\/.+/),t.match(j)&&(d=!0),t.match(/narrative(-?\d+_\d+)/)&&(d=!0),t.match(/^(\/@[._a-zA-Z0-9-]+)([\?|\&]rev=[_a-z0-9]+|[\?|\&]anchor=[-a-zа-я0-9]+)*$/)&&(delete(n=nav.fromStr(a))[0],d=!0),!d&&t.match(/music\/album\/(-?\d+_\d+)(_[a-z0-9]+)?/)&&(d=!0,s=!1),!d&&t.match(/[a-zA-Z0-9_\.-]{2,32}/)&&(d=!0,s=!0));return e.url=a,e.canceled=r,e.valid=d,e.initialUrl=o,e.params=n,e.needsCheckDomain=s,e})).filter((function(e){return!e.canceled&&e.valid})).sort((function(e,a){return e.needsCheckDomain-a.needsCheckDomain}));if(d.length){var s=d[0];s.needsCheckDomain?f.checkURLDomain(s.query,s.initialUrl,t):f.checkURL(s.initialUrl,t,s.params)}}},checkURLDomain:function(e,a,t){cur.checkURLDomainTO&&clearTimeout(cur.checkURLDomainTO),cur.checkURLDomainTO=setTimeout(function(e,a,t){cur.checkURLDomainRequest=ajax.post("share.php",{act:"id_by_link",url:e,to_mail:m.mail},{onDone:function(e,i){(e||i)&&f.checkURL(a,t)},onFail:function(){return!0}})}.pbind(e,a,t),100)},clearCheckURL:function(){clearTimeout(cur.checkURLTO),re(f.urlAttachmentLoading[2]),q?toggle(te,te.childNodes>0):toggleClass(a,"med_no_attach",!a.childNodes),f.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})},onCheckURLDone:function(e,a,t){var i="";a=a||{},f.urlAttachmentLoading&&(i=f.urlAttachmentLoading[1],f.clearCheckURL()),e?f.chooseMedia(t[0],t[1],extend({},t[2],a),i,!0):((m.onCheckURLDone||function(){})(e,t),(a.onError||function(){})(t))},cancelCheckUrl:function(){re(f.checkURLForm)},_getShareTimeHash:function(){var e=cur.share_timehash||((cur.options||{}).share||{}).timehash||"",a=Math.floor(Date.now()/1e3),t=-1;return e&&(t=parseInt(e.split("_",1)[0])+36e3),t-a<60?Object(d.post)("share.php?act=renew_url_attachment_hash",{act:"renew_url_attachment_hash",hash:e}).then((function(e){var a=e[0];return cur.share_timehash=a,a})):Promise.resolve(e)},checkURL:function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e?this._getShareTimeHash().then((function(o){f.urlsCancelled.push(e),f.urlAttachmentLoading=[vkNow(),e],re(f.checkURLForm),f.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+G+'"></iframe>'}),utilsNode.appendChild(f.checkURLForm);var n=f.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+G}));each(extend({hash:o,allowed_share_buttons:((cur.options||{}).share||{}).allowed_buttons||"",index:G,url:e,to_mail:m.mail?1:"",from:cur.module},t),(function(e,a){n.appendChild(ce("input",{type:"hidden",name:e,value:a}))})),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=f.onCheckURLDone.pbind(!0,i),window.onUploadFail=f.onCheckURLDone.pbind(!1,i),a&&(cur.checkURLTO=setTimeout((function(){f.urlAttachmentLoading.length>0&&f.clearCheckURL()}),a)),n.submit()})):(i.onError||function(){})()},addPreview:function(e,a){var t=a?" medadd_c_link_hidden":"";return f.sharePreview=Z.appendChild(ce("div",{className:"medadd_c medadd_c_link"+t,innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="medadd_c_linkprg">'+getProgressHtml("","medadd_c_linkprg_inner")+"</div>":"")+"</div>"}))},shareImgUrl:function(e){var a=f.shareData;if(isArray(a.preview_images)&&a.preview_images[e])return a.preview_images[e];if(a.images_proxy&&a.images_proxy[e])return a.images_proxy_url+a.images_proxy[e];if(a.images){var t=a.images[e];return isArray(t)&&(t=t[0]?t[0]:""),t}return""},initSnippetVideoFunctions:function(){cur.selectSnippetVideo=function(){var e={to_id:m.toId||cur.postTo,act:"a_choose_video_box",snippet_video:1};showBox("al_video.php",e,{cache:1,dark:1})},cur.chooseSnippetVideo=function(e,a){var t=f.shareData,i=e.split("_");t.video_owner_id=i[0],t.video_id=i[1],t.video_full_id=e,t.video=a;for(var o=!1,n=0,r=Object.keys(a.editable.sizes);n<r.length;n++){var d=r[n];(o&&a.editable.sizes[d][1]>a.editable.sizes[o][1]||!o)&&(o=d)}if(o){var s=a.editable.sizes[o];t.images[t.images.length-1]=[s[0],i[0],i[1],"video",a.editable.duration],cur.shareShowNext(0,1)}f.showVideoSnippetPreview()}},showPreview:function(e){var t,i,o=f.shareData,n=f.sharePreview||f.addPreview(),r=domFC(n);o.is_product?addClass(r,"medadd_c_link_product"):removeClass(r,"medadd_c_link_product"),toggleClass(r,"medadd_c_link_special",!!o.prometheus),"comment"!==m.from||o.is_vk_mini_app||(o.images=[]),!o.prometheus&&o.images&&(t=o.images[cur.shareShowImg],i=!(!f.bigLink&&!o.big_link||o.force_small_link));var d=!(!cur.options.share||!cur.options.share.allow_snippet_video),s=o.video&&d,c="",_={};if(o.failed)c=getLang("page_not_loaded");else if(o.prometheus)c="im"===cur.module?'<a target="_blank" href="'+o.url+'">'+o.title+"</a>":getTemplate("prometheus_snippet",{author_img:o.prometheus_author_image_url}),e=!0;else if(o.template){var p=o.template;p&&(c=getTemplate(p,o))}else{var u="",h=clean(f.shareImgUrl(cur.shareShowImg));if(d&&f.initSnippetVideoFunctions(),!h&&o.is_vk_mini_app&&o.images&&o.images[cur.shareShowImg]&&(h=o.images[cur.shareShowImg]),o.images&&o.images[cur.shareShowImg]&&h){var g=o.images[cur.shareShowImg];if(o.images.length>0){var v=!(!cur.options.share||!cur.options.share.allow_custom_photo),b=v&&!(cur.options.share&&cur.options.share.require_image),w="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",k="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_video")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",y="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_remove_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",C=isArray(g)&&1==g.length,T=C&&!d,A=C&&d,x=o.media&&"_"!=o.media&&v?'<div class="medadd_c_linkimg_controls">  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_l">'+(o.images.length>1?'    <div class="medadd_c_linkimg_controls_btn_arrows_group">      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_left" onclick="cur.shareShowNext(true);"></div>      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_right" onclick="cur.shareShowNext();"></div>    </div>':"")+'    <div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload" '+w+" onclick=\"Page.ownerPhoto('"+o.media+"');\"></div>"+(d?'<div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload_video" '+k+' onclick="cur.selectSnippetVideo();"></div>':"")+"  </div>"+(b?'  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_r">    <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_remove" '+y+' onclick="window.tooltips && window.tooltips.hide(this); cur.removeLinkImage(this)"></div>  </div>':"")+"</div>":"",D=(t?"":"display: none")+";background-image:url("+h+")";o.image_ratio>0&&(D+=";height: 0px; padding-top: "+100*o.image_ratio+"%;min-height: 0px;");var I="video"===g[3];u='<div class="medadd_c_linkimg_container '+(Z&&Z.offsetWidth>550?"medadd_c_linkimg_container_wide":"")+'" style="'+D+'">'+u+(I?'<div class="medadd_c_linkimg_container_video_overlay"></div>':"")+(I?'<div class="video_thumb_label"><span class="video_thumb_label_item"></span><span class="video_thumb_label_item">'+g[4]+"</span></div>":"")+(T?'<div class="medadd_c_linkimg_button"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+"</button></div>":"")+(A?'<div class="medadd_c_linkimg_button"><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+'</button></div><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark medadd_c_linkimg_video_button" onclick="cur.selectSnippetVideo();">'+getLang("global_link_choose_own_video")+"</button></div></div>":"")+x+'<div id="medadd_c_linkimg_loader" class="medadd_c_linkimg_loader">'+getProgressHtml("","inv medadd_c_linkimg_loader_inner")+"</div></div>"}}var M="";o.microdata&&o.microdata_preview_html&&(M=o.microdata_preview_html),_={title:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_title")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_title},description:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_desc")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_desc},url:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_url")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_url}};var S=o.shareButtons,P=S&&S.length&&S[0],B=o.button_text||P&&P[1],$=o.button_text_lang||P&&P[2],O=o.button_action||P&&P[0];if(S&&S.length&&$===B)for(var E=0;E<S.length;++E)if(S[E][0]===O&&S[E][2]===B){B=S[E][1];break}var L=!1;S&&S.length&&(L=S.length>1||$===B||P[0]!==O||P[1]!==B);var N=!!S&&S.length,U=cur.options.share&&cur.options.share.allow_remove_button&&!s;c=u+'<div class="medadd_c_linkwrap '+(u?"":"no_photo")+'"><div class="medadd_c_linkwrap_block">'+(o.title||_.title.editable?'<div class="medadd_c_linkhead '+(_.title.editable?"medadd_inline_editable":"")+'">'+(_.title.editable?'<div class="medadd_inline_editable_icon"></div>':"")+'<span class="medadd_inline_edit_target" data-max-length="'+(cur.options.share&&cur.options.share.max_title_len?cur.options.share.max_title_len:0)+'" data-field="title">'+(clean(o.title).replace(/\n/g,"<br>")||_.title.placeholder)+"</span></div>":"")+(M?'<div class="medadd_c_linkmicrodata">'+M+"</div>":"")+(o.domain||_.url.editable?`<div class="page_media_link_url medadd_c_linkaddr ${_.url.editable?"medadd_inline_editable":""}">${_.url.editable?'<div class="medadd_inline_editable_icon"></div>':""}<span class="medadd_inline_edit_target" data-max-length="2000" data-field="url" data-display-field="domain">${o.domain||"Url..."}</div>`:"")+"</div>"+($&&N?'<div class="medadd_c_linkwrap_block medadd_c_linkwrap_block_button">'+(U?'<div class="hide_icon medadd_c_linkbtn_remove" onclick="cur.shareRemoveButton();" onmouseover="showTooltip(this, {text: \''+getLang("global_share_button_remove_tooltip")+"', black: 1, shift: [15, 10, 0]})\"></div>":"")+'<div class="wall_postlink_preview_btn medadd_c_linkbtn"><a onclick="cur.toggleShareButton(this);return false;" onmouseout="Page.actionsDropdownHide(domNS(this), 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" class="flat_button"><span onmouseover="Page.actionsDropdownUnhide()" class="'+(L?"page_actions_dd_label":"")+' wall_postlink_preview_btn_label" data-field="button_text">'+$+"</span></a></div></div>":"")+'</div><div class="clear_fix"></div>'}if(i?addClass(r,"medadd_c_linkimg_big"):removeClass(r,"medadd_c_linkimg_big"),e)cur.preventShareAnim&&(cur.preventShareAnim.stop(),clearInterval(cur.animateUpdateInterval),m.onChangedSize&&m.onChangedSize()),val(r,c),r.style.height="auto",shortCurrency();else{show(Z);var j=a.appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon '+(i?"medadd_c_linkimg_big":"")+'">'+c+"</div>"},{position:"absolute",width:getSize(n)[0]-10,visibility:"hidden"})),R=getSize(j)[1];re(j),setStyle(r,{height:"0"}),setStyle(n,{overflow:"hidden"}),val(r,c),shortCurrency(),cur.animateUpdateInterval=setInterval((function(){m.onChangedSize&&m.onChangedSize()}),100),cur.preventShareAnim=animate(r,{height:R},200,(function(){setStyle(r,{height:"auto",display:""}),setStyle(n,{overflow:""}),clearInterval(cur.animateUpdateInterval),m.onChangedSize&&m.onChangedSize()})),re(geByClass1("medadd_c_linkprg",Z))}function z(e){var a=new RegExp(/^([\w-]*:\/\/)|(tel:).*$/),t=new RegExp(/^(?:tel:)?(\+7|8)(\d{3})(\d{3})(\d{2})(\d{2})$/),i=new RegExp(/^(([a-zа-я0-9]|[a-zа-я0-9][a-zа-я0-9\-]*[a-zа-я0-9])\.)*([a-zа-я0-9]|[a-zа-я0-9][a-zа-я0-9\-]*[a-zа-я0-9])$/i),o=new RegExp(/^([\w-]*:\/\/)?([a-zа-я0-9\-]+(?:[\-\.]{1}[a-zа-я0-9\-]+)*\.[a-zа-я0-9\-]{2,22})(:[0-9]{1,5})?([\/\?\#].*)?$/i);if(!e||e.inlineEdit)return!1;var n=getSize(e),r=gpeByClass("medadd_inline_editable",e);e.inlineEdit=!0,addClass(r,"medadd_inline_editing"),removeClass(r,"medadd_inline_invalid");var d=ce("textarea",{className:"medadd_inline_edit"},{width:n[0],height:n[1]}),s=parseInt(e.getAttribute("data-max-length"));s&&d.setAttribute("maxlength",s);var c=e.getAttribute("data-field"),p=e.getAttribute("data-display-field");val(d,Object(l.unclean)(f.shareData[c])),val(e,""),e.appendChild(d);var u=ce("span",{className:"medadd_inline_edit_target"},{opacity:0,zIndex:-1,width:n[0],height:"auto",wordWrap:"break-all",position:"absolute"});r.appendChild(u);var h=n[1];if(elfocus(d),"url"===c){var g=f.shareData[c];t.test(g)&&val(d,Object(l.unclean)(g.replace("tel:",""))),d.onkeydown=function(e){32!==e.which&&32!==e.keyCode||e.preventDefault(),13!==e.which&&13!==e.keyCode||(e.preventDefault(),d.blur())},d.oninput=function(){var e=this;cur.editingPostUrlCleanTimeout&&clearTimeout(cur.editingPostUrlCleanTimeout),cur.editingPostUrlCleanTimeout=setTimeout((function(){e.value=e.value.replace(/[\n ]/g,"")}))}}d.onblur=function(){if(d.oninput=null,removeClass(r,"medadd_inline_editing"),re(u),clearTimeout(cur.editingPostUrlCleanTimeout),f.shareData[c]=val(d),"url"===c&&f.shareData[c])try{var n=f.shareData[c];if(t.test(n.replace(/[\h\s(\)-]/g,"")))n=n.replace(/[\h\s\(\)-]/g,""),f.shareData.domain=n.replace(t,"+7 ($2) $3-$4-$5"),f.shareData[c]=n.replace(t,"tel:+7$2$3$4$5");else{a.test(n)||(n="https://"+n);var s=new URL(n);if(!s.host||!i.test(s.host)||!o.test(n))throw new Error("Invalid url");if(t.test(Object(l.unclean)(f.shareData.domain).replace(/[\h\s\(\)-]/g,""))||i.test(f.shareData.domain)||f.shareData.domain===getLang("global_link_invalid_url")||f.shareData.domain===getLang("global_link_edit_url")){var h=n.match(o);f.shareData[c]=n.replace(o,"$1"+h[2].toLowerCase()+"$3$4"),f.shareData.domain=h[2].toLowerCase()}}}catch(e){addClass(r,"medadd_inline_invalid"),f.shareData.domain=getLang("global_link_invalid_url")}var g;"url"!==c||f.shareData[c]||(f.shareData.domain=getLang("global_link_edit_url")),g=p&&f.shareData[p]?f.shareData[p]:val(d),val(e,clean(g).replace(/\n/g,"<br>")||_[c].placeholder),e.inlineEdit=!1};var m=function(){var e=clean(val(d)+" M").replace(/\n/g,"<br>");val(u,e);var a=getSize(u);h!=a[1]&&(h=a[1],animate(d,{height:a[1]},200))};addEvent(d,"click keyup change",m),setTimeout(m,0)}if(_.title&&_.title.editable){var q=geByClass1("medadd_c_linkhead",r),H=geByClass1("medadd_inline_edit_target",q);q&&H&&(q.onclick=z.bind(this,H))}if(_.description&&_.description.editable){var F=geByClass1("medadd_inline_edit_target",geByClass1("medadd_c_linkdsc",r));F&&(F.onclick=z.bind(this,F))}if(_.url&&_.url.editable){var W=geByClass1("medadd_c_linkaddr",r),V=geByClass1("medadd_inline_edit_target",W);W&&V&&(W.onclick=z.bind(this,V)),m.linkTooltip&&!cur.linkTooltip&&W&&(cur.linkTooltip=new ElementTooltip(m.linkTooltip.el(W),m.linkTooltip.opts),m.linkTooltip.timeout?setTimeout(()=>cur.linkTooltip.show(),m.linkTooltip.timeout):cur.linkTooltip.show())}if(N&&(f.shareData.button_text=B,f.shareData.button_text_lang=$,f.shareData.button_action=O,L)){var G=domPN(geByClass1("wall_postlink_preview_btn_label",r)),Y=[],K=0,X=0,Q=[];for(var E in S)if(S.hasOwnProperty(E)){var J=S[E];J[0]==O&&J[1]==B&&(K=X),Y.push([X++,J[1]]),Q.push('<a class="page_actions_item" tabindex="0" role="link" onclick="cur.updateShareButton(this);Page.actionsDropdownHide(domPN(domPN(this)), 1, cur.setActiveShareButton.pbind(false));return false;" data-button-text="'+J[1]+'" data-button-text-lang="'+J[2]+'" data-button-action="'+J[0]+'">'+J[2]+"</a>")}G.setAttribute("data-items",JSON.stringify(Y)),G.setAttribute("data-value",K);var ee=['<div class="page_actions_wrap medadd_c_linkbtn_actions_wrap unshown" onmouseout="Page.actionsDropdownHide(this, 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" onmouseup="setTimeout(function() { Page.actionsDropdownUnhide(); }, 5)">','<div class="page_actions_inner">',Q.join(""),"</div>","</div>"].join("");domPN(G).appendChild(se(ee)),ls.get("share_button_text_tooltip_shown")||cur.buttonTextTooltip||setTimeout((function(){cur.closeButtonTextTooltip=function(){cur.buttonTextTooltip.hide(),ls.set("share_button_text_tooltip_shown",1)};var e=geByClass1("wall_postlink_preview_btn_label",r),a=domCA(e,".box_layout");cur.buttonTextTooltip=new ElementTooltip(e,{autoShow:!1,appendTo:a||geByTag1("body"),content:'<div class="feature_intro_tt_hide" onclick="cur.closeButtonTextTooltip();"></div>'+getLang("global_share_button_text_tooltip"),forceSide:"left",cls:"feature_intro_tt",offset:[-10,0,0],onHide:function(){cur.buttonTextTooltip.destroy()}}),cur.buttonTextTooltip.show(),addEvent(e,"mouseover",(function(){cur.buttonTextTooltip&&cur.buttonTextTooltip.hide()}))}),1e3)}},showVideoSnippetPreview:function(){if(!(!cur.options.share||!cur.options.share.allow_snippet_video)){var e=f.shareData,a=e.video,t=e.video_owner_id,i=e.video_id;a&&isObject(a)&&t&&i&&a.editable&&(f.initSnippetButtonFunctions(),f.showPreview())}},initSnippetButtonFunctions:function(){cur.shareRemoveButton=function(){var a=f.sharePreview;window.tooltips&&tooltips.destroyAll(a),re(geByClass1("medadd_c_linkwrap_block_button",a)),f.shareData.button_text="",f.shareData.button_text_lang="",f.shareData.button_action="",show(domByClass(e,"media_selector"))},cur.updateShareButton=function(e){var a=e.getAttribute("data-button-text"),t=e.getAttribute("data-button-text-lang"),i=e.getAttribute("data-button-action");f.shareData.button_text=a,f.shareData.button_text_lang=t,f.shareData.button_action=i;var o=f.sharePreview;return val(geByClass1("page_actions_header_inner",o),t),val(geByClass1("wall_postlink_preview_btn_label",o),t),!1},cur.setActiveShareButton=function(e){var a=f.sharePreview;(e?addClass:removeClass)(domPN(geByClass1("wall_postlink_preview_btn_label",a)),"active")},cur.toggleShareButton=function(e){hasClass(e,"active")?(Page.actionsDropdownHide(domNS(e),1),cur.setActiveShareButton(!1)):(Page.actionsDropdown(domNS(e)),cur.setActiveShareButton(!0))}},showExternalPreview:function(){var e=f.shareData;e.images||(e.images=[]);var a,t=[],i=[],o={};each(e.images,(function(a,n){o[n]||(o[n]=!0,t.push(n),e.images_proxy&&i.push(e.images_proxy[a]))})),e.uniqueImagesCount=t.length,e.images=t,e.images_proxy=i;var n=!(!cur.options.share||!cur.options.share.allow_snippet_video);if(a=Z&&Z.offsetWidth>550?isRetina()?"/images/post_snippet_image_placeholder_w_2x.png":"/images/post_snippet_image_placeholder_w.png":n?isRetina()?"/images/post_snippet_image_video_placeholder_2x.png":"/images/post_snippet_image_video_placeholder.png":isRetina()?"/images/post_snippet_image_placeholder_2x.png":"/images/post_snippet_image_placeholder.png",e.placeholder_inserted||(e.images.push([(cur.options.share||{}).allow_custom_photo?a:""]),e.placeholder_inserted=!0),!e.images||!e.images.length)return cur.shareShowImg=0,void f.showPreview();cur.shareShowImg=0,cur.shareShowImg--,f.addPreview(!0,!!e.map_data),e.imagesStyles={};var r=!1;cur.shareSetOwnPhoto=function(a){curBox()&&curBox().hide(),f.bigLink=!0,e.images[e.images.length-1]=[a.photo_url,a.user_id,a.photo_id],cur.shareShowNext(0,1)},cur.shareClearOwnPhoto=function(){e.images[e.images.length-1]=[],cur.shareShowNext(0,0,1)},cur.removeLinkImage=function(e){var a=gpeByClass("medadd_c_linkcon",e);addClass(a,"no_photo"),removeClass(a,"medadd_c_linkimg_big"),re(gpeByClass("medadd_c_linkimg_container",e)),setStyle(a,"height",""),f.shareData.noPhoto=!0},f.initSnippetButtonFunctions(),cur.shareShowNext=function(t,i,o){var n=vkImage();cur.prevShareShowDir=t,o||(i?cur.shareShowImg=e.images.length-1:t?cur.shareShowImg-=1:cur.shareShowImg+=1);var d=isArray(e.images[e.images.length-1])&&!!e.images[e.images.length-1][0];if(!d&&cur.shareShowImg>e.images.length-2)cur.shareShowImg=0;else if(cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(!d&&cur.shareShowImg<0)cur.shareShowImg=e.images.length-2;else if(cur.shareShowImg<0)cur.shareShowImg=e.images.length-1;else if(0==cur.shareShowImg)for(var s=1;s<e.images.length-1;s++){vkImage().src=f.shareImgUrl(s)}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return f.showPreview(r),void(r=!0);var l=f.shareImgUrl(cur.shareShowImg);l&&(n.src=l),e.video=0,isArray(e.images[cur.shareShowImg])&&e.images[cur.shareShowImg][1]&&e.images[cur.shareShowImg][2]?"video"===e.images[cur.shareShowImg][3]?(e.video=1,e.video_owner_id=e.images[cur.shareShowImg][1],e.video_id=e.images[cur.shareShowImg][2]):(e.user_id=e.images[cur.shareShowImg][1],e.photo_id=e.images[cur.shareShowImg][2],e.share_own_image=!0):(e.user_id=void 0,e.photo_id=void 0,e.share_own_image=!1);var c=null;l&&(cur.imgLoadTimeout=c=setTimeout((function(){!0!==cur.shareImgInterval&&(isArray(e.images[cur.shareShowImg])||(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),cur.shareShowNext()))}),5e3));var _=setTimeout((function(){show("medadd_c_linkimg_loader"),_=null,m.onChangedSize&&m.onChangedSize()}),100);cur.showLoaderTimeout=_;var p=function(){if(n.width||n.height||!l){var t=n.width,i=n.height,o="",d="";if(c&&(clearTimeout(c),c=null),_&&(clearTimeout(_),_=null),hide("medadd_c_linkimg_loader"),clearInterval(cur.shareImgInterval),!isArray(e.images[cur.shareShowImg])&&(t<150||i<67)){if(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext.pbind(0,0,1),0)}else{var s=t>=532&&i>=235,p=(s||!!e.big_link)&&!e.force_small_link;if(cur.options.share&&cur.options.share.force_big_link&&!s){e.images.splice(cur.shareShowImg,1),e.images_proxy.splice(cur.shareShowImg,1);var u=(cur.options.share||{}).allow_custom_photo||(cur.options.share||{}).require_image;return 0==e.images.length&&u&&e.images.push([u?a:""]),cur.prevShareShowDir||cur.shareShowImg--,void cur.shareShowNext(cur.prevShareShowDir)}f.bigLink=p,p?o="width: 100%;":(t>150&&(i=150*i/t,t=150),o="width: "+t+"px; height: "+i+"px;")}e.images.length>1&&(d=""),e.imagesStyles[cur.shareShowImg]='style="'+o+'"'+d,f.showPreview(r),r=!0,m.onAddMediaChange&&m.onAddMediaChange("share",e.media,e)}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(p,300),cur.shareImgInterval2=setTimeout(p,0)},cur.shareShowNext()},uploadShare:function(e){var a=f.shareData,t=f.sharePreview,i=t.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+G+'"></iframe>'})),o=i.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+G})),n=a.images[cur.shareShowImg];each({act:"a_photo",url:a.url,index:G,image:n,extra:a.extra||0,hash:vk.ip_h},(function(e,a){o.appendChild(ce("input",{type:"hidden",name:e,value:a}))})),window.onUploadDone=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),f.shareData=extend(f.shareData,{user_id:o.user_id,photo_id:o.photo_id,photo_url:n}),setTimeout(e,0)},window.onUploadFail=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),f.shareData.share_upload_failed=1,setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),o.submit()},setupPostpone:function(e,t,i){var o;o=q||ae?ae:domPN(geByClass1("page_preview_postpone_wrap",a));var n=cur.editingPost&&"wpe_media_preview"==domPN(o).id,r=n||!q?"":"1px",d=!1,s=`<div class="clear_fix">\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_date${G}" value="${e.date||""}" /></div>\n        <div class="fl_l datepicker_item medadd_c_timerat">${e.lang.profile_wall_postpone_at}</div>\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_time${G}"/></div></div>`,l=void 0!==e.friends_only||e.donut_is_available;cur.editingPost&&l?(s+='<div class="medadd_c_timersett">',f.visibilityAddSelect(e),d=!0):cur.editingPost&&t&&(s+=t,d=!0),W||(f.postponePreview=o.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(d?" medadd_c_nofixed":"")+(W?" timer_in_tt":""),innerHTML:s}))),W&&(f.postponeSubmitWrapper=se(`<div><input type="hidden" id="postpone_date${G}" value="${e.date||""}"><input type="hidden" id="postpone_time${G}"></div>`),o.appendChild(f.postponeSubmitWrapper)),W||(f.postponePreview.style.height=r);var c="datepicker-inline-container_"+G,_=`<button class='flat_button reset_time_btn secondary' onclick='cur.addMedia[${G}].onResetPostponeBtnClick()'>${getLang("wall_post_timer_reset")}</button>`,p=`<td class="cal_clear" id="${c}" colspan="7">${_}</td>`;stManager.add(["ui_controls.css","ui_controls.js","datepicker.css",window.jsc("web/datepicker.js")],(function(){f.postponeDatepicker=new Datepicker("postpone_date"+G,{time:"postpone_time"+G,width:155,noPast:!0,minStep:1,sideTop:cur.oid<0,sideTopOffset:10,inlineTime:W,inlineTimeContainerId:c,inlineTimeContainerIdx:G,addRows:W?"<tr>"+p+"</tr>":null,addRowsM:W?'<tr><td class="cal_clear" colspan="7"></td></tr>':null,onUpdate:function(e,a){var t=[...arguments];m.onMediaChange&&m.onMediaChange.apply(m,t),f.postponeDate=val("postpone_date"+f.lnkId),W&&f.updatePostponeBtnText()},hideAnotherMonth:!1}),n||!q||W||animate(f.postponePreview,{height:33},200,(function(){f.postponePreview.style.height=""})),f.menu.postponeBtn&&f.updatePostponeBtnText(),Object(g.isFunction)(i)&&i()}))},getPostponeDateString:function(e){if(val("postpone_date"+f.lnkId)||e){e=(e=e||+val("postpone_date"+f.lnkId))+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=getLang("datepicker_dateFormat");"dateFormat"===a&&(a="{day} {month} {year}");var t=new Date(1e3*e),i=t.getDate(),o=t.getMonth()+1,n=t.getFullYear();return a.replace("{day}",i).replace("{month}",winToUtf(getLang("Month"+o+"_of"))).replace("{year}",n)+` ${getLang("profile_wall_postpone_at")} `+`${t.getHours()}:${("0"+t.getMinutes()).slice(-2)}`}},onResetPostponeBtnClick(){cur["postPostponeTT"+f.lnkId].hide(),null!=f.postponeInd&&setTimeout(()=>{f.unchooseMedia(f.postponeInd)},ElementTooltip.FADE_SPEED),cancelEvent(event)},resetPostpone:function(e){if(e){e=e+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=new Date(1e3*e);if(a){var t=a.getDate(),i=a.getMonth()+1,o=a.getFullYear(),n=a.getHours(),r=a.getMinutes();f.postponeDatepicker.timePicker.hourDD.val(n),f.postponeDatepicker.timePicker.minDD.val(r),f.postponeDatepicker.setDate(o,i,t,null,n,r)}}},updatePostponeBtnText:function(e,a){if(W){var t=geByClass1("post_action_btn_text",f.menu.postponeBtn),i="";if(e)i=getLang("wall_publication_now");else{var o=f.getPostponeDateString(a);if(!o)return;i=o}t.innerHTML=i,t.setAttribute("aria-label",replaceEntities(i))}},createPrettyCards:function(e){cur.lang=extend(cur.lang||{},e.lang||{});var a=se(e.editor.container_html);Z.appendChild(a),f.prettyCardGallery=new PrettyCardGallery(a,e.editor,e.pretty_cards)},visibilityAddSelect:function(e){var a,t=!1;e.donut_only?(t=!0,a="name_donut_only"):e.friends_only?(t=!0,a="name_friends_only"):a="name_no_friends_only";var i=se(getTemplate("visibility_access",{link_id:G}));toggleClass(i,"on",t);var o=geByClass1(a,i),n=geByClass1("post_action_btn_text",i),r=val(o);if(val(n,r),attr(n,"aria-label",r),i){var d=geByClass1("post_action_btn",b);d?b.insertBefore(i,d):b.appendChild(i),Wall.createPostTooltip("post_visibility_btn",G),f.donutUpdateVisibility()}var s=+domData(o,"value");radiobtn(o,s,"post_settings_btnpost_visibility_btn"+G);var l=ge("post_donut_duration_btn"+G);l&&toggleClass(l,"visible",e.donut_only)},onPostVisibilityAccessChange(e){((e,a)=>{a!==u.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT&&C(e);var t=Object(h.ge)("post_donut_duration_btn"+e.lnkId);if(t){var o=a===u.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT,n=e.markAsAdsGetCheckboxEl();Object(h.toggleClass)(t,"visible",o),n&&Object(i.disable)(n,o)}})(f,e)},donutUpdateVisibility(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;!function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;A(Object(w.isDonutPostSettingVisible)(t,a),e,a)}(b,f,e)},destroy:function(){(X||{}).sorter&&X.sorter.destroy();for(var t=0;t<V.handlersToClean.length;t++)V.handlersToClean[t]();(K||{}).qsorter&&K.qsorter.destroy(),removeClass(a,"media_preview_has_medias"),a&&(a.innerHTML=""),show(e)},qsorterOpts:function(){return{xsize:Math.floor(K.offsetWidth/135),width:135,height:102,onReorder:m.onAddMediaChange,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),K.qsorter&&(K.qsorter.destroy(),window.qsorter.init(K,f.qsorterOpts()))}}).copyrightInit(),f.markAsAdsInit(),f.menu.onAddMediaInit({actionsEl:b,addMedia:f,onMediaChange:m.onMediaChange}),cur.addMedia||(cur.addMedia={}),cur.addMedia[G]=f,m.onAddMediaChange&&(f.onChange=m.onAddMediaChange),f}}}}]);try{stManager.done("cmodules/bundles/4ad6740d9b54e18c214b1584b85679ea.b0b4defda4864d2144c1.js")}catch(e){}