!function(e){function _(_){for(var o,r,l=_[0],s=_[1],n=_[2],c=0,p=[];c<l.length;c++)r=l[c],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);for(d&&d(_);p.length;)p.shift()();return i.push.apply(i,n||[]),t()}function t(){for(var e,_=0;_<i.length;_++){for(var t=i[_],o=!0,l=1;l<t.length;l++){var s=t[l];0!==a[s]&&(o=!1)}o&&(i.splice(_--,1),e=r(r.s=t[0]))}return e}var o={},a={"web/photoview":0},i=[];function r(_){if(o[_])return o[_].exports;var t=o[_]={i:_,l:!1,exports:{}};return e[_].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=o,r.d=function(e,_,t){r.o(e,_)||Object.defineProperty(e,_,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,_){if(1&_&&(e=r(e)),8&_)return e;if(4&_&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&_&&"string"!=typeof e)for(var o in e)r.d(t,o,function(_){return e[_]}.bind(null,o));return t},r.n=function(e){var _=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(_,"a",_),_},r.o=function(e,_){return Object.prototype.hasOwnProperty.call(e,_)},r.p="/js/cmodules/";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=_,l=l.slice();for(var n=0;n<l.length;n++)_(l[n]);var d=s;i.push([218,"bundles/common","bundles/b0203713c9b55abc70d41e4f64d46e60","bundles/637aa6036536cb04f3a1f378656a0595"]),t()}({"1OKH":function(e,_,t){"use strict";t.r(_),t.d(_,"photos",(function(){return l}));t("SRfc"),t("KKXr"),t("pIFo");var o=t("zxIV"),a=t("v+DW"),i=t("EasH"),r=t("DM2o"),l={LOAD_TYPE_PHOTOS:"photos",LOAD_TYPE_ALBUMS:"albums",LOAD_TYPE_TAGGED:"tagged",MAX_DESC_INPUT_HEIGHT:600,changeAlbumPhoto(e){showBox("al_photos.php",{act:"change_thumb_box",album:e})},onMouseOverEditRow(e){var _=Object(o.geByClass1)("photos_photo_edit_row_desc_placeholder",e),t=Object(o.geByClass1)("photos_photo_edit_row_desc_input",e);Object(o.setTitle)(_,!1,Object(o.val)(t))},editInitSorter(){var e=Object(o.ge)("photos_container_photos");cur.photosEditSorter=new GridSorter(e,"photos_photo_edit_row_thumb",{onReorder:l.reorderPhotos})},updateEditHeaderPos(){void 0===cur.photosEditHeaderEl&&(cur.photosEditHeaderEl=Object(o.geByClass1)("photos_edit_selection_header")),cur.photosEditHeaderEl&&(cur.photosEditHeaderElOffset=cur.photosEditHeaderElOffset||Object(o.getXY)(cur.photosEditHeaderEl)[1]-Object(o.getSize)(Object(o.ge)("page_header_cont"))[1],scrollGetY()>=cur.photosEditHeaderElOffset?Object(o.hasClass)(cur.photosEditHeaderEl,"photos_header_fixed")||(Object(o.addClass)(cur.photosEditHeaderEl,"photos_header_fixed"),Object(o.setStyle)(cur.photosEditHeaderEl,{width:Object(o.getSize)(Object(o.ge)("page_body"))[0]}),Object(o.setStyle)(Object(o.domNS)(cur.photosEditHeaderEl),{"margin-top":Object(o.getSize)(cur.photosEditHeaderEl)[1]+"px"})):(Object(o.removeClass)(cur.photosEditHeaderEl,"photos_header_fixed"),Object(o.setStyle)(cur.photosEditHeaderEl,{width:""}),Object(o.setStyle)(Object(o.domNS)(cur.photosEditHeaderEl),{"margin-top":0})))},_editGetSelectedCount(){var e=Object(o.geByClass)("photos_edit_selected").length;if(cur.photoEditSelectedAll){var _=Object(o.geByClass)("photos_photo_edit_row").length;e=e<_?cur.count-_+e:cur.count}return e},editSelectAll(e){cur.photoEditSelectedAll=!e,each(Object(o.geByClass)("photos_photo_edit_row"),(function(){Object(o.toggleClass)(this,"photos_edit_selected",cur.photoEditSelectedAll)})),l._editUpdateSelectedCounter()},_editUpdateSelectedCounter(){var e,_=l._editGetSelectedCount();e=_?getLang("photos_edit_selected_count").replace("{total}",cur.count).replace("{count}",_):langNumeric(cur.count,cur.lang.photos_edit_selected_count_initial,!0),Object(o.val)(Object(o.ge)("photos_edit_selected_label"),e);var t=Object(o.ge)("photos_edit_selected_actions");Object(o.toggleClass)(t,"photos_selected",!!_),Object(o.geByClass)("photos_edit_selected_action",t).forEach((function(e){Object(o.toggleClass)(e,"link_lock",!_)}));var a=Object(o.ge)("photos_select_all_toggle");cur.photosEditSelectedHalf=_>=cur.count/2,cur.photosEditSelectedHalf?Object(o.val)(a,getLang("photos_edit_deselect_all")):Object(o.val)(a,getLang("photos_edit_select_all"))},selectEditPhoto(e,_){var t=Object(o.gpeByClass)("photos_photo_edit_row",_),a=Object(o.toggleClass)(t,"photos_edit_selected");if(e.shiftKey&&cur.photoEditPrevSelectedRowEl&&cur.photoEditPrevSelectedRowEl!=t)for(var i=Object(o.gpeByClass)("photos_edit_photos_container",_),r=Object(o.domFC)(i),s=0;s<2&&r;)r!=cur.photoEditPrevSelectedRowEl&&r!=t||s++,s&&Object(o.toggleClass)(r,"photos_edit_selected",a),r=Object(o.domNS)(r);return cur.photoEditPrevSelectedRowEl=t,l._editUpdateSelectedCounter(),cancelEvent(e),!1},startEditPhotoDescription(e,_){l.stopEditPhotoDescription();var t=Object(o.gpeByClass)("photos_edit_photos_container",_),a=Object(o.hasClass)(_,"photos_photo_edit_row")?_:Object(o.gpeByClass)("photos_photo_edit_row",_),i=Object(o.geByClass1)("photos_photo_edit_row_desc_cont",a),r=Object(o.geByClass1)("photos_photo_edit_row_desc_placeholder",a),s=Object(o.geByClass1)("photos_photo_edit_row_desc_input",a);function n(e,_,t,a){var i=clean(Object(o.val)(t)).split("\n").join("<br>")+"&nbsp;",r=Object(o.ce)("div",{innerHTML:i,className:"photos_photo_edit_row_desc_input"},{width:Object(o.getSize)(_)[0],display:"block",visibility:"hidden"});e.appendChild(r);var s=Object(o.getSize)(r)[1]+(browser.msie?10:0);Object(o.setStyle)(t,{height:Math.min(l.MAX_DESC_INPUT_HEIGHT,Math.round(s))}),Object(o.re)(r)}Object(o.val)(s,s.getAttribute("data-orig-desc")),n(i,r,s),Object(o.show)(s),addEvent(document,"click",l.stopEditPhotoDescription),removeEvent(s,"input"),addEvent(s,"input",n.pbind(i,r,s)),s.select(),Object(o.addClass)(t,"photos_desc_editing"),Object(o.addClass)(a,"photos_row_desc_editing"),e&&cancelEvent(e)},onEditPhotoDescriptionKeyPress(e){switch(e.keyCode){case 27:l.stopEditPhotoDescription(null,!0);break;case 9:l.stopEditPhotoDescription(null,!1);var _=Object(o.gpeByClass)("photos_photo_edit_row",e.currentTarget);(_=Object(o.domNS)(_))&&l.startEditPhotoDescription(null,_),cancelEvent(e)}},stopEditPhotoDescription(e,_){var t;e&&Object(o.hasClass)(e.target,"photos_photo_edit_row_desc_input")||(removeEvent(document,"click",l.stopEditPhotoDescription),each(Object(o.geByClass)("photos_row_desc_editing"),(function(){t=this,Object(o.removeClass)(t,"photos_row_desc_editing");var e=Object(o.geByClass1)("photos_photo_edit_row_desc_placeholder",t),a=Object(o.geByClass1)("photos_photo_edit_row_desc_input",t),i=t.getAttribute("data-id"),r=t.getAttribute("data-edit-hash"),l="";_?l=a.getAttribute("data-orig-desc"):((l=trim(Object(o.val)(a)))!=a.getAttribute("data-orig-desc")&&ajax.post("al_photos.php",{act:"save_desc",photo:i,hash:r,text:l,edit:1},{}),a.setAttribute("data-orig-desc",l),e.titleSet=!1);Object(o.val)(e,clean(l)||getLang("photos_add_description_placeholder")),Object(o.toggleClass)(e,"photos_edit_has_desc",!!l),Object(o.hide)(a)})),Object(o.removeClass)(Object(o.gpeByClass)("photos_edit_photos_container",t),"photos_desc_editing"))},updatePeriods(){cur.periods=Object(o.geByClass)("photos_period_delimiter",Object(o.ge)("photos_all_block"))},destroyPeriod(){cur.fixedPeriod&&(Object(o.re)(cur.fixedPeriod),cur.fixedPeriod=!1,cur.fixedPeriodEl=!1)},fixPeriod(){if(Object(o.ge)("photos_albums_block")&&(l.headerHeight=l.headerHeight||Object(o.getSize)(Object(o.ge)("page_header_cont"))[1],cur.periods&&cur.periods.length)){var e=vk.staticheader?Math.max(scrollGetY(),l.headerHeight):scrollGetY()+l.headerHeight,_=!1,t=!1,a=Object(o.getSize)(cur.periods[0])[1];for(var i in cur.periods)if(cur.periods.hasOwnProperty(i)){if(Object(o.getXY)(cur.periods[i])[1]>=e)break;_=cur.periods[i];var r=intval(i)+1;t=!!cur.periods[r]&&Object(o.getXY)(cur.periods[r])[1]-e}if(_&&!cur.fileApiUploadStarted){if(_==cur.fixedPeriodEl)setTimeout((function(){Object(o.setStyle)(cur.fixedPeriod,{left:Object(o.getXY)(_)[0]+"px"})}));else{if(cur.fixedPeriod)cur.fixedPeriod.innerHTML=_.innerHTML;else{var s=cur.fixedPeriod=Object(o.ce)("div",{innerHTML:_.innerHTML,className:"photos_period_delimiter_fixed"},{left:Object(o.getXY)(_)[0]+"px"});Object(o.ge)("page_body").appendChild(cur.fixedPeriod),(cur._back?cur._back.hide:cur.destroy).push((function(){Object(o.re)(s)}))}cur.fixedPeriodEl=_}var n=!1!==t?t-a:0;n>=0&&(n=0),cur.fixedPeriodTop!==n&&(Object(o.setStyle)(cur.fixedPeriod,{top:n+"px"}),cur.fixedPeriodTop=n)}else!_&&cur.fixedPeriod&&(Object(o.re)(cur.fixedPeriod),cur.fixedPeriod=!1,cur.fixedPeriodEl=!1)}},scrollResize(){if(!browser.mobile&&!cur.pvShown){var e=document.documentElement,_=window.innerHeight||e.clientHeight||bodyNode.clientHeight,t=scrollGetY(),a=Object(o.ge)("ui_photos_load_more"),i=Object(o.ge)("ui_albums_load_more"),r=Object(o.ge)("ui_tagged_load_more"),s=.8*_;Object(o.isVisible)(a)&&a.offsetTop-(t+_)<s&&l.load(),Object(o.isVisible)(i)&&cur.showAllAlbums&&i.offsetTop-(t+_)<s&&l.load(l.LOAD_TYPE_ALBUMS),Object(o.isVisible)(r)&&cur.showAllTagged&&r.offsetTop-(t+_)<s&&l.load(l.LOAD_TYPE_TAGGED),cur.fixPeriods&&l.fixPeriod(),l.updateEditHeaderPos()}},initScroll(){cur.module="photos",l.scrollnode=browser.msie6?pageNode:window,addEvent(l.scrollnode,"scroll",l.scrollResize),addEvent(window,"resize",l.scrollResize),removeEvent(window,"load",l.initScroll),cur.destroy.push((function(){removeEvent(l.scrollnode,"scroll",l.scrollResize),removeEvent(window,"resize",l.scrollResize)}))},recache(e,_){if(cur.loading)return cur.loading=1,void setTimeout(l.recache.pbind(e,_),100);for(var t=cur.offset;ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+t+"&part=1"];t+=20){var o=ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+t+"&part=1"];o[0]+=_,ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+(t+_)+"&part=1"]=o,delete ajaxCache["/"+nav.objLoc[0]+"#act="+nav.objLoc.act+"&offset="+t+"&part=1"]}cur.offset+=_},loaded(e,_,t,a){var i,r,s,n,d,c;switch(a||(cur.loading=0),a=a||l.LOAD_TYPE_PHOTOS){case l.LOAD_TYPE_TAGGED:cur.taggedOffset=e,s=cur.moreFromTagged,d=cur.moreTaggedOpts,n=cur.taggedOffset;break;case l.LOAD_TYPE_ALBUMS:cur.albumsOffset=e,s=cur.moreFromAlbums,d=cur.moreAlbumsOpts,n=cur.albumsOffset,c=cur.albumsCount;break;default:cur.offset=e,s=cur.moreFrom,d=cur.moreOpts,n=cur.offset,c=cur.count}i=Object(o.ge)("photos_container_"+a),r=Object(o.ge)("ui_"+a+"_load_more");for(var p=Object(o.ce)("div",{innerHTML:trim(_)});p.firstChild;){if(Object(o.hasClass)(p.firstChild,"photos_period_delimiter")){var u=p.firstChild.getAttribute("data-year");if(Object(o.geByClass1)("photos_period_delimiter_"+u)){Object(o.re)(p.firstChild);continue}}cur.photoEditSelectedAll&&Object(o.addClass)(p.firstChild,"photos_edit_selected"),i.appendChild(p.firstChild)}t&&extend(cur.privacy,t),a==l.LOAD_TYPE_PHOTOS&&l.updatePeriods(),e>=c||!_?Object(o.hide)(r):a!=l.LOAD_TYPE_PHOTOS&&(cur.loading=1,ajax.post(s,extend({offset:n,part:1},d||{}),{cache:1,onDone:function(){2==cur.loading?l.loaded.apply(window,arguments):cur.loading=!1},onFail:function(){return cur.loading=0,!0}}))},load(e){var _,t,i,r;switch(e=e||l.LOAD_TYPE_PHOTOS){case l.LOAD_TYPE_PHOTOS:_=Object(o.ge)("ui_photos_load_more"),t=cur.moreFrom,i=cur.moreOpts,r=cur.offset;break;case l.LOAD_TYPE_TAGGED:_=Object(o.ge)("ui_tagged_load_more"),t=cur.moreFromTagged,i=cur.moreTaggedOpts,r=cur.taggedOffset;break;case l.LOAD_TYPE_ALBUMS:_=Object(o.ge)("ui_albums_load_more"),t=cur.moreFromAlbums,i=cur.moreAlbumsOpts,r=cur.albumsOffset}t&&Object(o.isVisible)(_)&&!Object(a.isButtonLocked)(_)&&(cur.loading?cur.loading=2:(e==l.LOAD_TYPE_PHOTOS&&i&&(cur.loading=1),ajax.post(t,extend({offset:r,part:1},i||{}),{onDone:l.loaded,onFail:function(){return cur.loading=0,!0},showProgress:function(){Object(a.lockButton)(_)},hideProgress:function(){Object(a.unlockButton)(_)},cache:1})))},loadMoreButtonClick(e){switch(e){case l.LOAD_TYPE_ALBUMS:cur.showAllAlbums=!0;break;case l.LOAD_TYPE_TAGGED:cur.showAllTagged=!0}this.load(e)},reorderAlbums(e,_,t){var o=e.id.replace("album",""),a=(_&&_.id||"").replace("album",""),i=(t&&t.id||"").replace("album","");ajax.post("al_photos.php",{act:"reorder_albums",album:o,before:a,after:i,hash:cur.reorderHash})},reorderPhotos(e,_,t){var a="edit"==nav.objLoc.act?"photo_edit_row_":"photo_row_",i=e.id.replace(a,""),r=(_&&_.id||"").replace(a,""),l=(t&&t.id||"").replace(a,""),s=Object(o.domData)(Object(o.ge)("photos_container_photos"),"rev");s=s?"1"===s?1:"":nav.objLoc.rev,ajax.post("al_photos.php",{act:"reorder_photos",photo:i,before:r,after:l,rev:s,hash:cur.reorderHash})},privacy(e){if("photos_move"==e){var _=Privacy.getValue(e);return(_=(_=_.split("_"))[2])!=cur.album.split("_")[1]&&l.movePhoto(_),!0}var t=e.match(/^album(\d+)/);if(t){var a=Object(o.ge)("album"+vk.id+"_"+t[1]);if(a){if(a.helper){var i=Object(o.getSize)(a);if(i[0]!=a.w||i[1]!=a.h){Object(o.setStyle)(a.helper,{width:i[0],height:i[1]-Object(o.ge)("photos_container").sorter.dh}),extend(a,{x:a.x-a.w/2+i[0]/2,w:i[0],y:a.y-a.h/2+i[1]/2,h:i[1]});for(var r=a.nextSibling;r&&r.nextSibling;r=r.nextSibling.nextSibling)Object(o.setStyle)(r.nextSibling,{left:r.offsetLeft,top:r.offsetTop})}}clearTimeout(cur["privacy_timer_"+e]),cur["privacy_timer_"+e]=setTimeout(ajax.post.pbind("al_friends.php",{act:"save_privacy",key:e,val:Privacy.getValue(e),hash:cur.privacyHash}),500)}}},deleteAlbum(e,_){Object(i.showFastBox)({title:getLang("photos_deleting_album"),dark:1,bodyStyle:"padding: 20px;"},getLang("photos_sure_del_album"),getLang("global_delete"),(function(t){ajax.post("al_photos.php",{act:"delete_album",album:e,hash:_},{showProgress:a.lockButton.pbind(t),hideProgress:a.unlockButton.pbind(t)})}),getLang("global_cancel"))},showSaved(e,_){var t=Object(o.ge)(e),a=function(){setTimeout(animate.pbind(t,{backgroundColor:_,borderLeftColor:"#D8DFEA",borderRightColor:"#D8DFEA",borderTopColor:"#D8DFEA",borderBottomColor:"#D8DFEA"},1e3),1e3)};Object(o.isVisible)(t)?animate(t,{backgroundColor:"#E7F1F9",borderLeftColor:"#4C96D4",borderRightColor:"#4C96D4",borderTopColor:"#4C96D4",borderBottomColor:"#4C96D4"},200,a):(Object(o.show)(t),a())},saveAlbum(e){var _={act:"save_album",album:cur.album,hash:cur.albumhash,title:Object(o.ge)("album_title").value,desc:Object(o.ge)("album_description").value,enable_hintach:isChecked("hintach_enabled_for_album")};if(!_.title)return Object(a.notaBene)("album_title");var t=cur.album.replace(vk.id+"_","");cur.privacy["album"+t]?extend(_,{view:Privacy.getValue("album"+t),comm:Privacy.getValue("albumcomm"+t)}):Object(o.ge)("album_only_check")&&extend(_,{main:isChecked("album_main_check"),only:isChecked("album_only_check"),comm:isChecked("album_comments_check")}),ajax.post("al_photos.php",_,{onDone:function(){var e=Object(o.ge)("album_main_check");e&&isChecked(e)&&(Object(o.addClass)(e,"on"),Object(o.addClass)(e,"disabled"),Object(o.hide)("album_delete_action"));var _=Object(o.ge)("photos_changes_saved");Object(o.setStyle)(_,{opacity:1}),setTimeout((function(){Object(o.setStyle)(_,{opacity:0})}),1500)},showProgress:a.lockButton.pbind(e),hideProgress:a.unlockButton.pbind(e)})},savePhotos(){for(var e={act:"save_photos",album:cur.album,hash:cur.albumhash},_=Object(o.ge)("photos_container"),t=0,a=_.firstChild;a;a=a.nextSibling)if(a.firstChild&&Object(o.isVisible)(a.firstChild)){var i=a.id.replace("photo_edit_row","");e["photo_id"+t]=i,e["photo_desc"+t]=Object(o.ge)("photo_caption"+i).value,++t}ajax.post("al_photos.php",e,{onDone:function(){for(var e=_.firstChild;e;e=e.nextSibling)if(e.firstChild&&Object(o.isVisible)(e.firstChild)){var t=e.id.replace("photo_edit_row","");Object(o.ge)("photo_save_result"+t).innerHTML=getLang("photos_privacy_description")}cur.descs=!1,scrollToTop(200),l.showSaved("photos_saved_msg","#F3F8FC"),Object(o.ge)("photos_container").sorter&&sorter.update(Object(o.ge)("photos_container").sorter.elems[0])},progress:"photos_save_progress"})},deleteSelectedPhotos(e){var _=[];each(Object(o.geByClass)("photos_edit_selected"),(function(){_.push(this.getAttribute("data-id"))}));var t=intval(l._editGetSelectedCount()>_.length),a=cur.album.split("_");showBox("/al_photos.php",{act:"delete_selected_box",Photo_ids:t?"":_.join(","),owner_id:a[0],album_id:a[1],all:t},{onDone(){var _=curBox();_.removeButtons(),_.addButton(getLang("photos_del_selected_box_yes"),_=>{Object(o.show)("photos_del_box_progress"),Object(o.hide)("photos_del_box_text"),Object(o.re)(_);var t=Object(o.ge)("photos_del_box_progress_text");l.doEditBatchProcess({act:"delete_photos",hash:e,owner_id:a[0],album_id:a[1]},cur.editDeletePhotosArray,Object(o.ge)("photos_del_box_progress_wrap"),"photos_del_selected_title_progress",(function(e,_,a,i,r){Object(o.val)(t,getLang("photos_del_selected_box_text_progress").replace("{count}",i).replace("{total}",r)),cur.count=Math.max(cur.count-e,0),each(a,(function(e,_){Object(o.re)("photo_edit_row_"+_),cur.count=Math.max(cur.count,0)})),l._editUpdateSelectedCounter()}),(function(){var e=curBox();(e&&e.hide(),0==cur.count)?nav.reload():Object(o.geByClass)("photos_photo_edit_row").length<40&&l.load()}))}),_.addButton(getLang("box_cancel"),(function(){_.hide(),cur.editDeletePhotosArray=!1}),"no")}})},doEditBatchProcess(e,_,t,a,i,r){var l=_.split(","),s=l.length,n=cur.editPhotosMaxChunkSize||50,d=Math.ceil(s/n),c=Object(o.geByClass1)("photos_progress_bar",Object(o.ge)(t))||Object(o.geByClass1)("ui_progress_bar",Object(o.ge)(t)),p=0,u=document.title,b=curBox();i(0,!1,[],0,s),function _(t){if(!b.isVisible())return r(p),void Object(o.setDocumentTitle)(u);var h=l.slice(t*n,(t+1)*n);ajax.post("/al_photos.php",extend({photos:h.join(",")},e),{onDone:function(e,l,n){p+=e,t++,Object(o.setStyle)(c,{width:100*t/d+"%"});var b=getLang(a).replace("{count}",p).replace("{total}",s);Object(o.setDocumentTitle)(b),i(e,l,h,p,s,n),t<d?_(t):setTimeout((function(){Object(o.setDocumentTitle)(u),r(p,l)}),200)}})}(0)},_showProgressPanel(e){var _=Object(o.se)('<div class="photo_mask_progress _photo_mask_progress"><div class="round_spinner"></div></div>');return e.appendChild(_),_},_hideProgressPanel(e){Object(o.re)(Object(o.geByClass1)("_photo_mask_progress",e))},deletePhoto(e,_,t,a){var i;if(""===e&&t&&(i=Object(o.gpeByClass)("photos_photo_edit_row",t),e=Object(o.attr)(i,"data-id"),_=Object(o.attr)(i,"data-edit-hash")),i=i||Object(o.ge)("photo_edit_row_"+e)){var r=l._showProgressPanel(i);return Object(o.addClass)(i,"photos_deleted"),ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:_,edit:1},{onDone:function(e){Object(o.re)(r),i.appendChild(Object(o.se)(e)),l.recache(cur.offset,-1),cur.count-=1,l._editUpdateSelectedCounter(),cur.count<2&&Object(o.hide)("album_thumb_action"),Object(o.ge)("photos_go_to_album_cont")&&!cur.count&&Object(o.hide)("photos_go_to_album_cont"),cur.photoAddUpdate&&cur.photoAddUpdate(i),cur.introTooltipHide&&cur.introTooltipHide(!0)}}),cancelEvent(a)}},restorePhoto(e,_,t){var a=Object(o.ge)("photo_edit_row_"+_);if(a&&Object(o.hasClass)(a,"photos_deleted")){var i=l._showProgressPanel(a);Object(o.re)(Object(o.geByClass1)("photos_restore",a)),ajax.post("al_photos.php",{act:"restore_photo",photo:_,hash:t,edit:1},{onDone:function(){Object(o.re)(i),Object(o.removeClass)(a,"photos_deleted"),l.recache(cur.offset,1),cur.count+=1,l._editUpdateSelectedCounter(),cur.count>1&&Object(o.show)("album_thumb_action"),Object(o.ge)("photos_go_to_album_cont")&&cur.count&&Object(o.show)("photos_go_to_album_cont"),cur.photoAddUpdate&&cur.photoAddUpdate(a)},progress:"photo_restore_progress"+_})}},toggleMoveToAlbumMode(e,_){var t=Object(o.ge)("photos_move_box_search"),a=Object(o.ge)("pv_move_to_album_cont"),i=Object(o.ge)("photos_box_edit_data"),r=curBox(),s=Object(o.geByClass1)("box_title",r.titleWrap);if(e){Object(o.hide)(t),Object(o.hide)(a),Object(o.show)(i),r.setOptions({width:500});var n=getLang("photos_move_to_new_album_title");cur.noAlbums||(n+=`\n          <span class="divider">|</span>\n          <a onclick="return photos.toggleMoveToAlbumMode(false, event)" href="" class="toggle">\n            ${getLang("photos_move_to_another_album_toggle")}\n          </a>\n        `),Object(o.val)(s,n),r.removeButtons().addButton(getLang("photos_create_album_and_move"),cur.saveNewAlbum).addButton(getLang("global_cancel"),r.hide,"no"),cur.onNewAlbumDone=function(e){curBox().hide(),l.movePhotosBox(cur.editPhotosArray.split(","),!1,(function(){setTimeout((function(){var _=Object(o.ge)("album"+e);l.doMovePhotos(!1,_)}))}))}}else Object(o.show)(t),Object(o.show)(a),Object(o.hide)(i),r.setOptions({width:795}),Object(o.val)(s,getLang("photos_move_box_title")+'<span class="divider">|</span><a onclick="return photos.toggleMoveToAlbumMode(true, event)" href="" class="toggle">'+getLang("photos_move_to_new_album")+"</a>"),r.removeButtons().addButton(getLang("global_cancel"),r.hide);return cancelEvent(_)},showMove(e,_,t){var a=cur.moveddc,i=Object(o.ge)("photos_move_link"+e);cur.privacyPhotoMove?Privacy.show(i,t,"photos_move"):(cur.zIndexUpdated&&(l.hideMove(),cur.noZIndexUpdate=!0),Object(o.ge)("photo_edit_row"+e)&&(cur.zIndexUpdated=e,Object(o.setStyle)(Object(o.ge)("photo_edit_row"+e),{zIndex:150})),l.hideMove()),extend(cur,{movelnk:i,moveph:e,movehash:_}),cur.privacyPhotoMove||(i.parentNode.replaceChild(a,i),cur.movedd.focus(),cur.movedd.showDefaultList(),addEvent(document,"click",l.hideMove))},hideMove(){if(cur.noZIndexUpdate)delete cur.noZIndexUpdate;else if(!cur.privacyPhotoMove){if(cur.movelnk)try{cur.moveddc.parentNode.replaceChild(cur.movelnk,cur.moveddc),cur.movelnk=!1,cur.movedd.clear(),cur.zIndexUpdated&&Object(o.ge)("photo_edit_row"+cur.zIndexUpdated)&&(Object(o.setStyle)(Object(o.ge)("photo_edit_row"+cur.zIndexUpdated),{zIndex:100}),delete cur.zIndexUpdated)}catch(e){}removeEvent(document,"click",l.hideMove)}},movePhoto(e,_,t){e=intval(e);var a=o.show.pbind("photo_return_progress"+_),r=o.hide.pbind("photo_return_progress"+_);if(!_){if(!e||e==cur.album.split("_")[1])return l.hideMove();_=cur.moveph,t=cur.movehash,a=function(){Object(o.hide)("photo_delete_link"+_),Object(o.show)("photo_edit_progress"+_)},r=function(){Object(o.hide)("photo_edit_progress"+_),Object(o.show)("photo_delete_link"+_)}}ajax.post("al_photos.php",{act:"move_photo",album:e,photo:_,hash:t},{onDone:function(t){var a=Object(o.ge)("photo_edit_row"+_);if(a&&a.firstChild){if(e==cur.album.split("_")[1]){if(Object(o.isVisible)(a.firstChild))return;a.removeChild(a.firstChild.nextSibling),Object(o.show)(a.firstChild),l.recache(cur.offset,1),++cur.count,cur.count>1&&Object(o.show)("album_thumb_action")}else{if(!Object(o.isVisible)(a.firstChild))return;l.hideMove(),Object(o.hide)(a.firstChild),a.appendChild(Object(o.ce)("div",{innerHTML:t})),l.recache(cur.offset,-1),--cur.count,cur.count<2&&Object(o.hide)("album_thumb_action")}cur.photoAddUpdate&&cur.photoAddUpdate(a),cur.introTooltipHide&&cur.introTooltipHide(!0),Object(o.ge)("photos_go_to_album_cont")&&Object(o.toggle)("photos_go_to_album_cont",!!cur.count)}},onFail:function(e){if(l.hideMove(),e)return setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},e).hide,2e3),!0},showProgress:a,hideProgress:r})},updateThumbs(e,_){var t=Object(o.ge)("photos_add_img"+cur.peEditPhoto);t&&(t.src=e)},editPhoto(e,_,t){cur.peEditPhoto=e,showBox("al_photos.php",{act:"edit_photo",photo:e,webgl:1,stat:["ui_controls.css","ui_controls.js"]},{dark:1})},backupDesc(e){cur.descs||(cur.descs={}),cur.descs[e]=trim(Object(o.ge)("photo_caption"+e).value)},saveDesc(e,_){var t=Object(o.ge)("photo_caption"+e).value,a=cur.descs[e];delete cur.descs[e],trim(t)!=a&&ajax.post("al_photos.php",{act:"save_desc",photo:e,hash:_,text:t,edit:1},{onDone:function(_){Object(o.ge)("photo_save_result"+e).innerHTML=_},onFail:function(_){return Object(o.ge)("photo_save_result"+e).innerHTML='<div class="photo_save_error">'+_+"</div>",!0},showProgress:function(){Object(o.ge)("photo_save_result"+e).innerHTML=getLang("photos_privacy_description"),Object(o.show)("photo_save_progress"+e)},hideProgress:function(){Object(o.hide)("photo_save_progress"+e)}})},genFile:(e,_,t)=>Object(o.ce)("div",{innerHTML:`\n        <a class="photo_file_cancel" id="photo_cancel${e}" onclick="${_}">${t}</a>\n        <div class="photo_file_button">\n          <div class="file_button_gray">\n            <div class="file_button" id="photo_file_button${e}">${getLang("photos_choose_file")}</div>\n          </div>\n        </div>\n      `}),initFile(e){FileButton.init("photo_file_button"+e,{name:"photo",id:"photo_file"+e,accept:"image/jpeg,image/png,image/gif",onchange:l.fileSelected})},addFile(){var e=cur.files.length,_=l.genFile(e,"photos.fileCancel("+e+")",getLang("global_cancel"));extend(_,{className:"photo_upload_file",id:"photo_upload_row"+e}),Object(o.ge)("photo_upload_files").appendChild(_),l.initFile(e),cur.files.push({})},filesLoad(){for(var e=0,_=0;e<cur.files.length;++e){if(Object(o.ge)("photo_file"+e).value)break}if(e!=cur.files.length){cur.allcont=utilsNode.appendChild(Object(o.ce)("div",{innerHTML:`\n        <iframe name="photo_frame_all"></iframe>\n        <form target="photo_frame_all" id="photo_form_all" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var t=Object(o.ge)("photo_form_all"),a=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:"photos.filesDone",onfail:"photos.filesFail"});for(_ in a)a.hasOwnProperty(_)&&t.appendChild(Object(o.ce)("input",{name:_,value:a[_]}));for(e=0,_=0;e<cur.files.length;++e){var i=Object(o.ge)("photo_file"+e);i.value&&(i.name="file"+_,t.appendChild(i),++_)}t.submit()}},fileSelected(){var e=intval(this.id.replace("photo_file",""));if(cur.files[e].deleting||!cur.files[e].cont&&!cur.files[e].id){cur["fileDone"+e]=l.fileDone.pbind(e),cur["fileFail"+e]=l.fileFail.pbind(e),cur.files[e].cont=utilsNode.appendChild(Object(o.ce)("div",{innerHTML:`\n        <iframe name="photo_frame${e}"></iframe>\n        <form target="photo_frame${e}" id="photo_form${e}" method="POST" action="${cur.url}" enctype="multipart/form-data"></form>\n      `}));var _=Object(o.ge)("photo_form"+e),t=extend(cur.fields,{act:"do_add",al:1,from_host:locHost,ondone:"cur.fileDone"+e,onfail:"cur.fileFail"+e});for(var i in t)t.hasOwnProperty(i)&&_.appendChild(Object(o.ce)("input",{name:i,value:t[i]}));_.appendChild(this),_.submit();var r=Object(o.ge)("photo_file_button"+e);Object(a.lockButton)(r),setTimeout((function(){r.innerHTML=r.innerHTML}),0),Object(o.show)("photo_cancel"+e),Object(o.ge)("photo_cancel"+e).innerHTML=getLang("global_cancel"),e==cur.files.length-1&&l.addFile()}},fileDone(e,_){Object(o.hide)("photo_cancel"+e);for(var t="",a=e+1;a<cur.files.length;++a)if(cur.files[a].id&&!cur.files[a].deleting){t=cur.files[a].id;break}setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",before:t,context:1},AjaxConvert.fromQueryString(_)),{onDone:function(_,t){if(!_)return l.fileFail(e,0);cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont),extend(cur.files[e],{id:_,deleting:!1,cont:!1}),Object(o.ge)("photo_upload_row"+e).innerHTML=t,autosizeSetup("photo_caption"+_,{minHeight:30}),Object(o.show)("photo_delete"+_)},onFail:function(_){if(_)return setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},_).hide,3e3),l.fileCancel(e),!0}}),0)},fileCancel(e,_){if(cur.files[e].cont&&(cur.files[e].cont.innerHTML="",utilsNode.removeChild(cur.files[e].cont)),!_){var t=Object(o.ge)("photo_file_button"+e);Object(a.unlockButton)(t),t.innerHTML=getLang("photos_choose_file"),cur.files[e]={},l.initFile(e),Object(o.hide)("photo_cancel"+e)}},fileFail(e,_){l.fileCancel(e)},fileDelete(e,_){for(var t=0;t<cur.files.length&&cur.files[t].id!=e;)++t;if(t!=cur.files.length&&!cur.files[t].deleting){cur.files[t].deleting=!0,ajax.post("al_photos.php",{act:"delete_photo",photo:e,hash:_,edit:2},{onFail:function(){cur.files[t].deleting=!1}});var a=Object(o.ge)("photo_edit_row"+e);a.parentNode.insertBefore(l.genFile(t,"photos.fileRestore('"+e+"', '"+_+"')",getLang("global_restore")),a),Object(o.hide)(a),l.initFile(t),Object(o.show)("photo_cancel"+t)}},fileRestore(e,_){for(var t=0,a="";t<cur.files.length&&cur.files[t].id!=e;)++t;if(t!=cur.files.length&&cur.files[t].deleting&&-1!==cur.files[t].deleting){if(cur.files[t].cont)return l.fileCancel(t);for(var i=t+1;i<cur.files.length;++i)if(cur.files[i].id&&!cur.files[i].deleting){a=cur.files[i].id;break}cur.files[t].deleting=-1,ajax.post("al_photos.php",{act:"restore_photo",photo:e,hash:_,before:a,edit:2},{onDone:function(){cur.files[t].deleting=!1}});var r=Object(o.ge)("photo_edit_row"+e);Object(o.show)(r),Object(o.re)(r.previousSibling)}},filesDone(e){setTimeout(ajax.post.pbind("al_photos.php",extend({act:"done_add",context:2},AjaxConvert.fromQueryString(e))),0)},filesFail(){for(var e=0;e<cur.files.length;++e)l.fileCancel(e);cur.allcont.innerHTML="",utilsNode.removeChild(cur.allcont),cur.allcont=!1},chooseFlash(){if(browser.flash<10)return animate(Object(o.ge)("photo_flash_needed"),{backgroundColor:"#FFEFE8",borderBottomColor:"#E89B88",borderLeftColor:"#E89B88",borderRightColor:"#E89B88",borderTopColor:"#E89B88"},100,()=>{animate(Object(o.ge)("photo_flash_needed"),{backgroundColor:"#FFFFFF",borderBottomColor:"#CCCCCC",borderLeftColor:"#CCCCCC",borderRightColor:"#CCCCCC",borderTopColor:"#CCCCCC"},500)});cur.photoCheckFails=0,Object(o.show)("photo_flash_upload"),Object(o.hide)("photo_default_upload"),Object(o.hide)("photo_upload_unavailable")},chooseDefault(){cur.photoCheckFails=0,Object(o.show)("photo_default_upload"),Object(o.hide)("photo_flash_upload"),cur.serverChecked?(Object(o.show)("photo_upload_files"),Object(o.hide)("photo_default_check")):(Object(o.hide)("photo_upload_files"),Object(o.show)("photo_default_check"),cur.checkUpload())},flashWidth:()=>-1==_ua.indexOf("Mac")||-1==_ua.indexOf("Opera")&&-1==_ua.indexOf("Firefox")?"600":"601",activeTab(e){for(var _=Object(o.domPN)(Object(o.domPN)(e)),t=Object(o.domFC)(_);t;t=Object(o.domNS)(t))Object(o.removeClass)(t,"active_link");Object(o.addClass)(Object(o.domPN)(e),"active_link")},checkHtml5Uploader(){var e=window.XMLHttpRequest||window.XDomainRequest,_=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;return e&&(window.FormData||window.FileReader&&(window.XMLHttpRequest&&XMLHttpRequest.sendAsBinary||window.ArrayBuffer&&window.Uint8Array&&_))},upload:(e,_)=>_&&(2==_.button||_.ctrlKey)?(l.checkHtml5Uploader()&&(e.href+="&html5=1"),!0):!(void 0!==cur.uplId&&window.Upload&&Upload.checked&&Upload.checked[cur.uplId]&&l.checkHtml5Uploader())||(Object(o.ge)("photos_upload_input").click(),!1),uploadLink:(e,_)=>(l.checkHtml5Uploader()&&(e.href+="&html5=1"),nav.go(e,_)),onUploadSelect(e){if(Object(o.ge)("photos_upload_area")){window.filesToUpload=e;var _=Object(o.ge)("photos_upload_area").innerHTML;Object(o.ge)("photos_upload_area").innerHTML='<img src="/images/upload.gif">',nav.go(Object(o.ge)("photos_upload_area").href+"&html5=1",!1,{onFail:function(e){return Object(o.ge)("photos_upload_area").innerHTML=_,setTimeout(Object(i.showFastBox)({title:getLang("global_error"),dark:1,bodyStyle:"padding: 20px;"},e).hide,3e3),!0}})}},thumbOver(e,_,t){cur.hideTO&&cur.hideTO[_]&&clearTimeout(cur.hideTO[_]);var a=Object(o.geByClass1)("description",e),i=Object(o.geByClass1)("photo_album_title",e),r=Object(o.getSize)(a)[1];animate(i,{marginTop:163-(r?r+7:0)},{duration:200,transition:Fx.Transitions.easeOutCirc});var l=Object(o.geByClass1)("photo_album_info_back",e),s=Object(o.geByClass1)("photo_album_info_cont",e);if(l&&s)if(!l.over||t){var n=t?.6:.5,d=t?1:.8;t&&(l.over=1),animate(l,{opacity:n},{duration:200,transition:Fx.Transitions.easeOutCirc}),animate(s,{opacity:d},{duration:200,transition:Fx.Transitions.easeOutCirc})}else l.over=0},thumbOut(e,_,t){var a=Object(o.geByClass1)("photo_album_info_back",e),i=Object(o.geByClass1)("photo_album_info_cont",e),r=()=>{if(t){var _=Object(o.geByClass1)("photo_album_title",e);animate(_,{marginTop:163},200)}if(a&&i){var r=t?0:.8;animate(a,{opacity:t?0:.5},200),animate(i,{opacity:r},200)}};t?(cur.hideTO=cur.hideTO||{},cur.hideTO[_]=setTimeout(r,150)):r()},openEditor:(e,_)=>(stManager.add([jsc("web/photoview.js"),"photoview.css"],(function(){var _=Object(o.gpeByClass)("photos_photo_edit_row",e);cur.onPESave=function(e){curBox().hide(),Object(o.setStyle)(Object(o.geByClass1)("photos_photo_edit_row_thumb",_),"background-image","url('"+e+"')"),cur.onPESave=!1,bodyNode.style.overflow="auto"};var t=_.getAttribute("data-id");Photoview.openEditor(t,cur.savedThumbs?cur.savedThumbs[t]:_.getAttribute("data-thumb"))})),cancelEvent(_)),addToAlbum(){cur.isPhotoUpload=!0,l.movePhotosBox(cur.savedPhotos||[],!1)},movePhotosBox(e,_,t,a){var i=[],r=!1;isArray(e)?i=e:(""===e&&_&&(e=Object(o.gpeByClass)("photos_photo_edit_row",_).getAttribute("data-id")),e?i.push(e):each(Object(o.geByClass)("photos_edit_selected"),(function(){i.push(this.getAttribute("data-id"))})),r=intval(l._editGetSelectedCount()>i.length));var s=cur.album?cur.album.split("_"):[vk.id];return showBox("/al_photos.php",{act:"a_move_to_album_box",photo_ids:r?"":i.join(","),owner_id:s[0],from_album_id:s[1],all:r},{onDone:t}),cancelEvent(a)},cancelMove(e,_,t,a,i,r,s){var n=Object(o.gpeByClass)("photos_photo_edit_row",_);Object(o.re)(Object(o.geByClass1)("photos_cancel_move",n)),l._showProgressPanel(n),ajax.post("al_photos.php",{act:"move_photos",photos:t,to_album_id:a,from_album_id:i,hash:s,owner_id:r},{onDone:function(){l._hideProgressPanel(n),cur.count++,l._editUpdateSelectedCounter()}}),cancelEvent(e)},doMovePhotos(e,_,t){var a=Object(o.domClosest)("_photos_album",_),i=Object(o.domData)(a,"aid"),r=Object(o.domData)(a,"from-aid"),s=Object(o.domData)(a,"owner-id"),n=Object(o.domData)(a,"move-hash"),d=Object(o.domData)(a,"from"),c=Object(o.geByClass1)("photos_album_counter",_),p=Object(o.geByClass1)("photos_album_thumb",_),u=Object(o.ge)("pv_move_to_album_progress");p.insertBefore(u,p.children[0]),Object(o.show)(u),Object(o.addClass)(_,"photos_in_progress"),Object(o.addClass)(Object(o.gpeByClass)("photos_container_albums",_),"photos_inactive"),l.doEditBatchProcess({act:"move_photos",to_album_id:i,from_album_id:r,owner_id:s,hash:n,from:d},cur.editPhotosArray,Object(o.ge)("pv_move_to_album_progress"),"photos_move_in_progress_title",(function(e,_,a,n,d,p){cur.count=Math.max(cur.count-e,0),Object(o.val)(c,+Object(o.val)(c)+e),each(a,(function(e,_){var a=Object(o.ge)("photo_edit_row_"+_);if(!cur.isPhotoUpload)if(a&&!t){var l="return photos.cancelMove(event, this, '"+_+"', "+r+", "+i+", "+s+", '"+p+"')",n=Object(o.se)('<div class="photos_cancel_move"><a href="" onclick="'+l+'">'+getLang("global_cancel")+"</a></div>");a.appendChild(n)}else Object(o.re)(a);cur.count=Math.max(cur.count,0)})),l._editUpdateSelectedCounter()}),(function(e,_){var a=curBox();a&&a.hide();var i=langNumeric(e,cur.lang.photos_x_photos_moved_no_cancel);(i=i.replace("{album}",_),showDoneBox(i),cur.pvShown&&cur.pvCurPhoto&&(cur.pvCurPhoto.album=_,Object(o.geByClass1)("pv_album_name").innerHTML=_),t||cur.isPhotoUpload)&&(0==cur.count?nav.reload():Object(o.geByClass)("photos_photo_edit_row").length<40&&l.load())})),e&&cancelEvent(e)},publishPhotos(e){if(cur.savedPhotos){cur.savingPhotos=!0;var _={act:"post",type:"photos_upload",to_id:vk.id,attach1_type:"photos_list",attach1:(cur.savedPhotos||[]).join(","),hash:cur.post_hash};ajax.post("/al_wall.php",_,{showProgress:a.lockButton.pbind(e),onDone:function(){delete cur._back,nav.go("/al_profile.php"),showBackLink()}})}return!1},registerDragZone(e){addEvent(document,"dragenter dragover",(function(_){if(l.checkHtml5Uploader())return setTimeout((function(){clearTimeout(cur.dragTimer),delete cur.dragTimer}),0),e.on(_),cancelEvent(_)})),addEvent(document,"dragleave",(function(_){cur.dragTimer&&(clearTimeout(cur.dragTimer),delete cur.dragTimer),cur.dragTimer=setTimeout((function(){e.un(_)}),100),cancelEvent(_)})),addEvent(document,"drop",(function(_){return e.un(_,!0),e.drop(_.dataTransfer.files),cancelEvent(_)})),cur.destroy.push((function(){removeEvent(document,"dragenter dragover"),removeEvent(document,"dragleave"),removeEvent(document,"drop")}))},openWebcamPhoto(){showBox("al_photos.php",{act:"webcam_photo",oid:cur.oid},{params:{dark:1}}).setOptions({width:644})},initWebcam(e,_){cur.lang=extend(cur.lang||{},_),e.setOptions({hideButtons:!0,width:644,bodyStyle:"padding:0px;border:0px;"}),l.cameraInit()},cameraInit(){var e=["ajx=1"];for(var _ in Upload.vars[cur.uplId])Upload.vars[cur.uplId].hasOwnProperty(_)&&e.push(_+"="+Upload.vars[cur.uplId][_]);var t=Upload.uploadUrls[cur.uplId]+(Upload.uploadUrls[cur.uplId].match(/\?/)?"&":"?")+e.join("&"),a={s_noCamera:getLang("profile_no_camera"),s_noAccess:getLang("profile_no_camera_access"),s_setAccess:getLang("profile_set_camera_access"),s_capture:getLang("profile_capture_image"),s_videoMode:getLang("profile_to_video_mode"),upload_url:t,saveClbk:"photos.cameraPhotoDone",hideClbk:"photos.uploadReturn",overClbk:"photos.cameraBtnOver",outClbk:"photos.cameraBtnOut",downClbk:"photos.cameraBtnDown",upClbk:"photos.cameraBtnUp",showSaveClbk:"photos.showCameraSaveBtn",hideSaveClbk:"photos.hideCameraSaveBtn",hideCaptureClbk:"photos.hideCameraCaptureBtn",progressClbk:"photos.cameraSaveProgress",getBtnsPos:"photos.updateCameraButtonsPos",jpgQuality:"95"};for(var i in a)a.hasOwnProperty(i)&&(a[i]=winToUtf(a[i]));return e={allownetworking:"true",wmode:"transparent"},this.addWebcamPhotoControls=Object(o.geByClass1)("add_webcam_photo_controls"),Object(o.hide)("camera_button_no"),renderFlash("webcam_photo",{url:"/swf/CaptureImg.swf",id:"flash_camera",width:604,height:480,preventhide:1,style:"visibility: visible",version:9},e,a),Object(r.statlogsValueEvent)("webcam_stat","click_open"),!1},cameraPhotoDone(e){Object(r.statlogsValueEvent)("webcam_stat","capture"),delete this.addWebcamPhotoControls,e=JSON.parse(e.replace(/\\"/g,'"')),ajax.post("al_photos.php",extend({act:"choose_uploaded",from_webcam:1},e),{onDone:function(e,_){l.showEditView(e,_)}})},updateCameraButtonsPos(){var e=this.addWebcamPhotoControls,_=[],t=Object(o.getXY)(e);Object(o.setStyle)(this.addWebcamPhotoControls,{visibility:"visible"});var a=function(e,a){if(Object(o.isVisible)(a.parentNode)){var i=Object(o.getXY)(a),r=Object(o.getSize)(a);_.push([i[0]-t[0],i[1]-t[1],r[0]+2,r[1]+2])}};each(Object(o.geByTag)("button",e),a),each(Object(o.geByClass)("button",e),a),1==_.length&&_.push([999,999,1,1]),Object(o.ge)("flash_camera").setButtonsPos&&Object(o.ge)("flash_camera").setButtonsPos(_)},showCameraSaveBtn(){Object(o.show)("camera_button_no"),Object(o.ge)("camera_button_yes").innerHTML=getLang("profile_oph_camera_save"),Object(o.ge)("camera_button_no").innerHTML=getLang("profile_to_video_mode"),this.updateCameraButtonsPos()},hideCameraSaveBtn(e){Object(o.hide)("camera_button_no");var _=Object(o.ge)("camera_button_no");Object(o.ge)("camera_button_yes").innerHTML=getLang("profile_capture_image"),_&&(_.innerHTML=getLang("profile_oph_camera_back")),e||this.updateCameraButtonsPos()},hideCameraCaptureBtn(){Object(o.hide)(Object(o.ge)("camera_button_no").parentNode),Object(o.ge)("camera_button_yes").innerHTML=getLang("profile_no_camera_back"),this.updateCameraButtonsPos()},cameraSaveProgress(e){var _=Object(o.ge)("camera_button_yes");_&&(e?Object(a.lockButton)(_):Object(a.unlockButton)(_))},cameraBtnOver(e){var _=Object(o.geByClass1)(e,this.addWebcamPhotoControls);_&&Object(o.addClass)(_,"hover")},cameraBtnOut(e){var _=Object(o.geByClass1)(e,this.addWebcamPhotoControls);_&&(Object(o.removeClass)(_,"hover"),Object(o.removeClass)(_,"active"))},cameraBtnDown(e){var _=Object(o.geByClass1)(e,this.addWebcamPhotoControls);_&&Object(o.addClass)(_,"active")},cameraBtnUp(e){var _=Object(o.geByClass1)(e,this.addWebcamPhotoControls);_&&Object(o.removeClass)(_,"active")},uploadReturn(){curBox().hide(),delete this.addWebcamPhotoControls},showEditView(e,_){cur.webcamPhotoMedia=e,cur.pvPhoto=null,cur.uploadPhotoData=_,stManager.add([jsc("web/photoview.js")],(function(){cur.fromWebcam=!0,Photoview.openEditor(e,_.editable.sizes.x[0])}))},onFiltersSave(){cur.imMedia?cur.imMedia.chooseMedia("photo",cur.webcamPhotoMedia,extend(cur.uploadPhotoData,{upload_ind:cur.imUploadInd+"_selfie"})):cur.chooseMedia("photo",cur.webcamPhotoMedia,extend(cur.uploadPhotoData,{upload_ind:cur.uplId+"_selfie"})),delete cur.webcamPhotoMedia,delete cur.uploadPhotoData},returnToWebcam(){curBox().hide(),this.openWebcamPhoto()}}},218:function(e,_,t){e.exports=t("TkEv")},"7GuL":function(e,_,t){"use strict";t.r(_),t.d(_,"ATTACH_DATA_DONUT_DURATION",(function(){return o.ATTACH_DATA_DONUT_DURATION})),t.d(_,"MEDIA_TYPE_DONUT_DURATION",(function(){return o.MEDIA_TYPE_DONUT_DURATION})),t.d(_,"POST_PARAM_DONUT_DURATION",(function(){return o.POST_PARAM_DONUT_DURATION})),t.d(_,"getDonutPostParams",(function(){return p})),t.d(_,"getPostParamsFromDurationMedia",(function(){return c})),t.d(_,"fieldValueIsDonutOnlyPost",(function(){return n})),t.d(_,"updatePostponedPostDonatorIcon",(function(){return u}));var o=t("q4CX"),a=t("v+DW"),i=t("tI7G"),r=t("zxIV"),l=t("t7n3"),s=t("CxPP"),n=function(e,_,t){var o=Object(i.getDonutOnlyFieldEl)(e),r=o&&1===Object(a.isChecked)(o)&&!o.hasAttribute("disabled");return Object(s.isDonutPostSettingVisible)(_,t)&&r?1:0},d=function(e){var _=e[5]&&e[5][o.ATTACH_DATA_DONUT_DURATION];return void 0!==_?_:void 0},c=function(e){var _,t=d(e);return void 0!==t?((_={})[o.POST_PARAM_DONUT_DURATION]=t,_):{}},p=function(e,_){var t;if(!e||!_)return{};var a=_.findChosenMedia(o.MEDIA_TYPE_DONUT_DURATION),i=(a?d(a):void 0)||o.DONUT_DURATION_DEFAULT;return(t={})[o.POST_PARAM_DONUT_DURATION]=i,t.mark_as_ads=0,t},u=function(e,_){if(e instanceof Element){var t=!!(null==_?void 0:_[o.WALL_SAVE_RESPONSE_IS_MARKED_AS_DONUT]),a=e.querySelector('[data-section-ref="donut-post-donator-icon"]');if(t){var s=e.querySelector(".post_date"),n=Object(l.getTemplate)("postDonatorIcon");s&&n&&Object(i.appendChildOrUpdate)(s,Object(r.se)(n),a)}else null==a||a.remove()}}},BxOC:function(e,_,t){"use strict";t.r(_),t.d(_,"post",(function(){return a})),t.d(_,"plainget",(function(){return i})),t.d(_,"plaingetCancelable",(function(){return r}));t("VRzm"),t("Btvt");var o=t("cGUQ");function a(e,_,t){return _&&(_.im_v=3),new Promise((o,a)=>{ajax.post(e,_,{timeout:t,onDone(){o.apply(null,[[...arguments]])},onFail(){return a.apply(null,arguments),!0}})})}function i(e,_){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r(e,_,t),a=o.request;return a}function r(e,_){var t,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){t.abort()}t=window.XDomainRequest?new XDomainRequest:ajax._getreq();var r=new Promise((i,r)=>{var l,s=Date.now(),n=a.timeout||60,d=Object(o.toQueryString)(_);if(window.XDomainRequest)t.open("get",`${e}?${d}`),t.ontimeout=function(e){r([e,{}])},t.onerror=function(e){r([e,{}])},t.onload=function(){i([t.responseText,{}])},setTimeout((function(){t.send()}),0);else{t.onreadystatechange=function(){4==t.readyState&&(clearInterval(l),t.status>=200&&t.status<300?i([t.responseText,t]):r([t.responseText,t]))};try{t.open("GET",`${e}?${d}`,!0)}catch(e){return r([e,t])}t.send()}l=setInterval((function(){Date.now()-s>1e3*n&&(window.browser.safari&&t.abort(),r(["",{}]),clearInterval(l))}),1e3)});return{request:r,cancel:i}}},CxPP:function(e,_,t){"use strict";t.r(_),t.d(_,"isDonutPostSettingVisible",(function(){return i}));var o=t("v+DW"),a=t("zxIV"),i=function(e,_){var t=function(e){if(!(e instanceof Element)||"submit_post_box"!==e.id)return!0;var _=parseInt(Object(a.domData)(e,"from-oid"))||void 0;return!!_&&_<0}(e),i=function(e){var _,t=null===(_=null==e?void 0:e.markAsAdsGetCheckboxEl)||void 0===_?void 0:_.call(e);return!t||!!!Object(o.isChecked)(t)}(_);return t&&i}},DfBR:function(e,_,t){"use strict";t.r(_),t.d(_,"getNavigableTabs",(function(){return a})),t.d(_,"showHiddenNavigableTabs",(function(){return i}));var o=t("zxIV"),a=function(e){var _=document.querySelector("#wall_tabs");return _?Array.from(_.querySelectorAll(".ui_tab")).filter((function(_){var t=_.parentNode;return null!==t&&t!==e&&!Object(o.hasClass)(t,"unshown")&&!Object(o.matchesSelector)(t,'[data-ui-tab="no_posts"]')})):[]},i=function(){var e=document.querySelector("#wall_tabs"),_=null==e?void 0:e.querySelector(".page_wall_no_posts");null==_||_.remove(),Object(o.removeClass)(document.querySelector("#wall_tabs"),"page_tabs_hidden")}},J1I5:function(e,_,t){"use strict";t.r(_),t.d(_,"Phototag",(function(){return a}));var o=t("yTQ2"),a={startTag(){if(!cur.pvTagger&&cur.pvPhoto.firstChild&&(!cur.pvTaggerTooltip&&window.layer?cur.pvTaggerTooltip=new o.default(layer,{closeOnClick:!1,resetDropdownOnShow:!1,onUserSelected:a.addTag,onEscapePressed:a.stopTag}):cur.pvTaggerTooltip.resetFriendsDropdown(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photos_select_tag_area"),`<button class="flat_button" onclick="Phototag.stopTag()">${getLang("global_done")}</button>`),Photoview.toggleNavControls(""),Photoview.toggleOnPhotoControls(!1),layerWrap.scrollTop=0,cur.pvTagger="loading",cur.pvTagger)){var e={minw:30,minh:30,onStart(){cur.pvPhotoTags&&cur.pvPhotoTags.pauseTooltips(),cur.pvTaggerTooltip.hide()},onFinish:a.showFriends};Photoview.updatePhotoDimensions(),cur.pvTagger=window.photoTagger(cur.pvPhoto.firstChild,extend(e,{zstart:50})),cur.pvPhotoTags&&cur.pvPhotoTags.hideAllSuggestedAreas()}},stopTag(){cur.pvTagger&&"loading"!=cur.pvTagger?(Photoview.toggleTopInfoPanel(!1),hide(cur.pvFriends),cur.pvTaggerTooltip&&cur.pvTaggerTooltip.hide(),cur.pvListId&&cur.pvData[cur.pvListId].length>1&&Photoview.toggleNavControls("left close right"),Photoview.toggleOnPhotoControls(!0),cur.pvTagger.destroy(),cur.pvTagger=!1,Photoview.updatePhotoDimensions(),cur.pvPhotoTags&&cur.pvPhotoTags.reload()):cur.pvTagger=!1},addTag(e,_){if(!cur.pvTagger||"loading"==cur.pvTagger)return!1;var t=cur.pvTagger.result();if(!e&&!_||!t[2])return!1;var o=cur.pvListId,a=cur.pvIndex,i=cur.pvData[o][a],r=getSize(cur.pvPhoto.firstChild),l=t[0]/r[0]*100,s=t[1]/r[1]*100,n=(t[0]+t[2])/r[0]*100,d=(t[1]+t[3])/r[1]*100;return ajax.post("al_photos.php",{act:"add_tag",mid:e,photo:i.id,name:_,hash:i.hash,x:l,y:s,x2:n,y2:d},{onDone(e,_,t){i.tags=e,i.tagged=_,i.tagshtml=t,cur.pvListId==o&&cur.pvIndex==a&&(re(Photoview.actionInfo()),Photoview.setTags(t),(!i.taginfo&&i.actions.tag&&e[0]<cur.pvMaxTags?show:hide)(cur.pvTagLink),cur.pvTaggerTooltip.hide(),cur.pvTagger.reset(),cur.pvPhotoTags.renderTagAreas(),cur.pvTaggerTooltip.resetFriendsDropdown())},onFail:cur.pvPhotoTags.handleTagRequestFail}),!1},showFriends(){if(cur.pvTagger&&"loading"!=cur.pvTagger){var e=cur.pvTagger.result(),_=e[0],t=e[1],o=e[2],a=e[3],i=getXYRect(cur.pvPhoto.firstChild,!0),r=i.left+_,l=i.top+t,s=i.left+_+o,n=i.top+t+a;cur.pvTaggerTooltip.hide(),cur.pvPhotoTags&&cur.pvPhotoTags.resumeTooltips(),cur.pvTaggerTooltip.show({left:r,top:l,right:s,bottom:n},{},!0)}}}},Nk8j:function(e,_,t){"use strict";function o(e){var _=cur.pvListId,t=cur.pvIndex;if(cur.pvData&&_&&!isNaN(t)){var o=cur.pvData[_][t];return e?o[e]:o}return!1}function a(e,_){var t=cur.pvListId,o=cur.pvIndex;return!(!cur.pvData||!t||isNaN(o))&&(cur.pvData[t][o][e]=_,cur.pvData[t][o])}function i(){return cur.pvIndexedFriends}function r(e,_){cur.pvIndexedFriends=new vkIndexer(e,e=>e[1],_)}t.r(_),t.d(_,"getPhotoData",(function(){return o})),t.d(_,"setPhotoData",(function(){return a})),t.d(_,"getIndexedFriends",(function(){return i})),t.d(_,"setIndexedFriends",(function(){return r}))},TkEv:function(e,_,t){"use strict";t.r(_);var o=t("iX+u");window.Photoview=o.Photoview;try{stManager.done(jsc("web/photoview.js"))}catch(e){}},WX8S:function(e,_,t){"use strict";t.r(_),t.d(_,"FullscreenPV",(function(){return a}));t("SRfc");var o=t("zxIV"),a={init(){if(cur.pvCanvas&&!cur.pvFSControls){var e=positive(getCookie("remixfsss")),_=Math.min(positive(getCookie("remixfsdt"))||5,15);cur.pvFSControls=cur.pvCanvas.appendChild(Object(o.ce)("div",{id:"pv_fs_controls",innerHTML:`\n<div id="pv_fs_topright" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_num"></div>\n      </td>\n      <td>\n        <div id="pv_fs_close" onclick="Photoview.fullscreenStop()">\n          <div id="pv_fs_close_btn"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_bottomleft" class="pv_fs_controls">\n  <table cellspacing="0" cellpadding="0">\n    <tr>\n      <td>\n        <div id="pv_fs_slide_check" onclick="FullscreenPV.startSlide()">\n          <div class="pv_fs_slide_check_icon"></div>${getLang("photos_slideshow")}\n        </div>\n      </td>\n      <td>\n        <div id="pv_fs_slide_speed_wrap">\n          <div id="pv_fs_slide_about"></div>\n          <div id="pv_fs_slide_speed" onmousedown="FullscreenPV.startSlideEdit(event)">\n            <div id="pv_fs_slide_speed_back"></div>\n            <div id="pv_fs_slide_speed_line">\n              <div id="pv_fs_slide_speed_ctrl"></div>\n            </div>\n          </div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n\n<div id="pv_fs_left_wrap" class="pv_fs_controls">\n  <div id="pv_fs_left"></div>\n</div>\n\n<div id="pv_fs_right_wrap" class="pv_fs_controls">\n  <div id="pv_fs_right"></div>\n</div>\n`,onmouseover:a.over,onmouseout:a.out})),extend(cur,{pvFSInfo:Object(o.ge)("pv_fs_num"),pvFSSlideCheck:Object(o.ge)("pv_fs_slide_check"),pvFSSlideSpeedWrap:Object(o.ge)("pv_fs_slide_speed_wrap"),pvFSSlideLine:Object(o.ge)("pv_fs_slide_speed_line"),pvFSSlideAbout:Object(o.ge)("pv_fs_slide_about"),pvFSSlideCont:Object(o.ge)("pv_fs_bottomleft"),pvFSSlideDelta:_,pvFSLeft:Object(o.ge)("pv_fs_left"),pvFSRight:Object(o.ge)("pv_fs_right")}),cur.pvFSSlideLine.style.width=Math.floor(100*(_-1)/14)+"%",Object(o.val)(cur.pvFSSlideAbout,getLang("photos_seconds",_)),e&&Object(o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),addEvent(cur.pvCanvas,"mousemove",a.showControls),addEvent(cur.pvCanvas,"mousedown",a.onClick),addEvent(cur.pvCanvas,"mouseup",a.endSlideEdit),a.showControls(!0),cur.pvPhoto.blur(),a.updateInfo()}},over(e){var _=e||window.event,t=_.target||_.srcElement||document;cur.pvFSOver=!t.id.match(/^pv_fs_(left|right)(_wrap)?$/)},out(){cur.pvFSOver=!1},onClick:e=>(__afterFocus||e&&(2==e.button||3==e.which)||Object(o.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSLeftShown?Photoview.show(cur.pvListId,cur.pvIndex-1):cur.pvFSRightShown&&Photoview.show(cur.pvListId,cur.pvIndex+1)),!!e&&cancelEvent(e)),showControls(e){var _,t,i=cur.pvFSrX=e.pageX,r=cur.pvFSrY=e.pageY;cur.pvFSSlideEdit&&a.updateSlide(),void 0!==cur.pvFSX&&void 0!==cur.pvFSY&&Math.abs(i-cur.pvFSX)+Math.abs(r-cur.pvFSY)<4||(cur.pvFSControlsTimer||(Object(o.removeClass)(cur.pvCanvas,"pv_fs_nocursor"),clearTimeout(cur.pvFSHideControlsTimer),Object(o.show)(cur.pvFSControls),Object(o.addClass)(cur.pvFSControls,"pv_fs_shown")),clearTimeout(cur.pvFSControlsTimer),cur.pvFSOver||cur.pvFSSlideEdit||(cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)),(_=!cur.pvFSOver&&(i<100||cur.pvFSWidth&&i<(cur.pvScrWidth-cur.pvFSWidth)/2))&&!cur.pvFSLeftShown?Object(o.addClass)(cur.pvFSLeft,"pv_fs_over"):!_&&cur.pvFSLeftShown&&Object(o.removeClass)(cur.pvFSLeft,"pv_fs_over"),cur.pvFSLeftShown=_,(t=!cur.pvFSOver&&!_)&&!cur.pvFSRightShown?Object(o.addClass)(cur.pvFSRight,"pv_fs_over"):!t&&cur.pvFSRightShown&&Object(o.removeClass)(cur.pvFSRight,"pv_fs_over"),cur.pvFSRightShown=t,cur.pvFSX=i,cur.pvFSY=r)},hideControls(){Object(o.addClass)(cur.pvCanvas,"pv_fs_nocursor"),Object(o.removeClass)(cur.pvFSControls,"pv_fs_shown"),clearTimeout(cur.pvFSHideControlsTimer),cur.pvFSHideControlsTimer=setTimeout(o.hide.pbind(cur.pvFSControls),300),cur.pvFSControlsTimer=!1},startSlide(){Object(o.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")?(clearTimeout(cur.pvFSTimer),Object(o.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),setCookie("remixfsss",0)):(Object(o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_on"),a.slide(),setCookie("remixfsss",1),clearTimeout(cur.hideAboutTO),cur.hideAboutTO=setTimeout((function(){Object(o.removeClass)(cur.pvFSSlideAbout,"highlighted")}),3e3),Object(o.addClass)(cur.pvFSSlideAbout,"highlighted"))},updateSlide(){var e=Math.floor(15*Math.max(Math.min((vk.rtl?cur.pvFSrLeft+cur.pvFSrWidth-cur.pvFSrX:cur.pvFSrX-cur.pvFSrLeft)/cur.pvFSrWidth,.99),0))+1;cur.pvFSSlideDelta!=e&&(setCookie("remixfsdt",cur.pvFSSlideDelta=e),cur.pvFSSlideLine.style.width=Math.floor(100*(e-1)/14)+"%",Object(o.val)(cur.pvFSSlideAbout,getLang("photos_seconds",e)))},startSlideEdit(e){if(cur.pvFSrX&&cur.pvFSrY)return extend(cur,{pvFSSlideEdit:!0,pvFSrLeft:Object(o.getXY)(Object(o.domPN)(cur.pvFSSlideLine))[0],pvFSrWidth:Object(o.getSize)(Object(o.domPN)(cur.pvFSSlideLine))[0]}),Object(o.addClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.updateSlide(),clearTimeout(cur.pvFSTimer),cancelEvent(e||window.event)},endSlideEdit(){cur.pvFSSlideEdit&&(cur.pvFSSlideEdit=!1,Object(o.removeClass)(cur.pvFSSlideCont,"pv_fs_slide_edit"),a.slide(),cur.pvFSOver||(clearTimeout(cur.pvFSControlsTimer),cur.pvFSControlsTimer=setTimeout(a.hideControls,3e3)))},slide(){clearTimeout(cur.pvFSTimer),!Object(o.hasClass)(cur.pvFSSlideCont,"pv_fs_slide_on")||cur.pvFSSlideEdit||Object(o.hasClass)(cur.pvCanvas,"pv_fs_one")||(cur.pvFSTimer=setTimeout((function(){cur.pvSlideNeedAnimation=!0,Photoview.show(cur.pvListId,cur.pvIndex+1)}),1e3*cur.pvFSSlideDelta))},updateInfo(){var e=((cur.pvData||{})[cur.pvListId]||[]).length,_=cur.pvIndex+1;Object(o.val)(cur.pvFSInfo,_+" / "+e),Object(o.toggle)(cur.pvFSInfo,e>1),(e>1?o.removeClass:o.addClass)(cur.pvCanvas,"pv_fs_one")}};window.FullscreenPV=a},YIAi:function(e,_,t){"use strict";t.r(_),t.d(_,"VISIBILITY_ACCESS_OPTIONS",(function(){return o}));var o={PUBLIC:0,ONLY_FRIENDS:1,ONLY_DONUT:2}},ZD4m:function(e,_,t){"use strict";function o(e){var _=e.getBoundingClientRect();return{left:_.left,top:_.top}}function a(){var e=document.documentElement;return{width:e.clientWidth,height:e.clientHeight}}function i(e){var _=e.getBoundingClientRect(),t=_.width,o=_.height;return t&&o?{width:t,height:o}:{width:e.offsetWidth,height:e.offsetHeight}}t.r(_),t.d(_,"getElementOffset",(function(){return o})),t.d(_,"getViewportSize",(function(){return a})),t.d(_,"getElementSize",(function(){return i})),t.d(_,"getJsonDataValue",(function(){return r}));var r=function(e,_){var t=e.getAttribute(_);if(t)try{return JSON.parse(t)}catch(e){return}}},"g/In":function(e,_,t){"use strict";t.r(_);t("HEwt"),t("a1Th"),t("Btvt"),t("rGqo"),t("rE2o"),t("ioFf"),t("KKXr");var o=t("zxIV"),a=t("EasH"),i=t("4+be"),r=t("yTQ2"),l=t("Nk8j");function s(e,_){return function(e){if(Array.isArray(e))return e}(e)||function(e,_){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(t.push(r.value),!_||t.length!==_);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return t}(e,_)||function(e,_){if(!e)return;if("string"==typeof e)return n(e,_);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n(e,_)}(e,_)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,_){(null==_||_>e.length)&&(_=e.length);for(var t=0,o=new Array(_);t<_;t++)o[t]=e[t];return o}_.default=class{constructor(e,_){this.imageNode=e,this.containerNode=_,this.activeAreaId=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this._handleImageMouseMove=this._handleImageMouseMove.bind(this),this._handleAreaClick=this._handleAreaClick.bind(this),this._removeActiveAreaAfterTimeout=this._removeActiveAreaAfterTimeout.bind(this),this._queueCheckUpdates=this._queueCheckUpdates.bind(this),this._queueReceiveUpdates=this._queueReceiveUpdates.bind(this),this._userSelectedCallback=this._userSelectedCallback.bind(this),this._handleSuggestionDeclined=this._handleSuggestionDeclined.bind(this),this._updatePhotoView=this._updatePhotoView.bind(this),this.deleteTag=this.deleteTag.bind(this),this._init(),this._queueCheckUpdates()}_init(){this.photoTooltip=new r.default(window.layer,{onMouseLeave:this._removeActiveAreaAfterTimeout,onUserSelected:this._userSelectedCallback,onDeleteClicked:this.deleteTag,onEscapePressed:this._removeActiveAreaAfterTimeout,onSuggestionDeclined:this._handleSuggestionDeclined}),this.photoView=window.Photoview,this.areasContainer=ce("div",{className:"photo_tags_suggested_areas_list"}),this.containerNode.innerHTML="",this.containerNode.appendChild(this.areasContainer),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.imageNode,"mouseenter",this.showAllSuggestedAreas.bind(this)),addEvent(this.areasContainer,"mouseleave",this._removeActiveAreaAfterTimeout),addEvent(this.areasContainer,"click",this._handleAreaClick),this.renderTagAreas()}_handleImageMouseMove(e){if(!this.areasHidden){var _=getXY(e.target),t=Math.round(100*(e.pageX-_[0])/e.target.offsetWidth),o=Math.round(100*(e.pageY-_[1])/e.target.offsetHeight);for(var a in clearTimeout(this.areasTimeOut),this.areasTimeOut=setTimeout(()=>{this.photoTooltip.isActive||this.activeAreaId||this.hideAllSuggestedAreas()},700),this.showAllSuggestedAreas(),this.areas)if(this.areas.hasOwnProperty(a)){var i=this.areas[a],r=i.x,l=i.y,s=i.x2,n=i.y2;if(t>parseInt(r)&&t<parseInt(s)&&o>parseInt(l)&&o<parseInt(n)){if(a===this.activeAreaId)return void(this.tagAreaFound=!0);if(this.tagAreaFound=this.showTagArea(a),this.tagAreaFound)return}}this.tagAreaFound=!1,this._removeActiveAreaAfterTimeout()}}_handleAreaClick(e){cancelEvent(e),this.photoTooltip.showAndFocusFriendsList(e)}showTagArea(e){var _=this.areas[e];return!(!_||_.isDeleted)&&(null!==this.activeAreaId&&this.areas[this.activeAreaId]&&removeClass(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=e,addClass(this.areas[e].ele,"active"),this.showTooltip(e),this.showAllSuggestedAreas(),!0)}hideTagArea(){clearTimeout(this.waitTimeout),null!==this.activeAreaId&&this.areas[this.activeAreaId]&&removeClass(this.areas[this.activeAreaId].ele,"active"),this.activeAreaId=null,this.photoTooltip.hide(),this.hideAllSuggestedAreas()}_removeActiveAreaAfterTimeout(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.activeAreaId&&!this.waitToRemove&&(this.waitToRemove=!0,clearTimeout(this.waitTimeout),this.waitTimeout=setTimeout(()=>{!this.photoTooltip.isActive&&!this.tagAreaFound&&!this.photoTooltip.interaction&&this.hideTagArea(),this.waitToRemove=!1},e))}showTooltip(e){if(!this.tooltipsPaused){var _=this.areas[e].ele,t=this._getTooltipOptions(e);if(_){var a=Object(o.getXYRect)(_,!0),i=a.top,r=a.right,l=a.bottom,s=a.left;this.photoTooltip.show({top:i,right:r,bottom:l,left:s},t)}}}showAllSuggestedAreas(){addClass(this.areasContainer,"visible_all"),removeClass(this.areasContainer,"area_hover"),this.activeAreaId&&addClass(this.areasContainer,"area_hover")}hideAllSuggestedAreas(){removeClass(this.areasContainer,"visible_all")}pauseTooltips(){this.hideTagArea(),this.tooltipsPaused=!0}resumeTooltips(){this.tooltipsPaused=!1}_createTagElement(e,_,t,o){var a=cur.pvPhWidth,i=cur.pvPhHeight/a,r=t-e,l=o-_,s=ce("div",{className:"photo_tags_suggested_area"},{left:e+"%",marginTop:i*_+"%",width:r+"%"}),n=ce("div",{},{paddingBottom:100*i*(l/r)+"%"});return s.appendChild(n),s}renderTagAreas(){this.areas={},this.areasContainer.innerHTML="";var e=Object(l.getPhotoData)("tags"),_=Object(l.getPhotoData)("suggested_tags");for(var t in cur.postTo&&cur.postTo<0&&(_=[]),e)if("0"!==t&&e.hasOwnProperty(t)){var o=s(e[t],7),a=o[0],i=o[1],r=o[2],n=o[3],d=o[4],c=o[5],p=o[6],u=this._createTagElement(a,i,r,n);this.areas[t]={ele:u,x:a,y:i,x2:r,y2:n,userName:d,userHref:c,canDeleteTag:Boolean(p),confirmedTag:!1},this.areasContainer.appendChild(u)}for(var b in _)if(b&&_.hasOwnProperty(b)){var h=s(_[b],7),m=h[0],v=h[1],g=h[2],E=h[3],w=h[4],O=h[5],P=h[6],D=this._createTagElement(m,v,g,E),f=void 0;w&&(f="/id"+w),this.areas[b]={ele:D,x:m,y:v,x2:g,y2:E,userHref:f,suggestedUserId:w,suggestedUserName:O,usersList:P,confirmedTag:!1},this.areasContainer.appendChild(D)}}_userSelectedCallback(e,_){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=Object(l.getPhotoData)("tags"),a=Object(l.getPhotoData)("suggested_tags"),i=this.activeAreaId,r=this.areas[i],s=r.x,n=r.y,d=r.x2,c=r.y2,p="/id"+e,u=cur.pvAskForAutoTag&&t,b=clean(_);o[i]=[s,n,d,c,b,p,!0],delete a[i];var h={suggestedUserId:!1,suggestedUserName:!1,usersList:[],userId:e,userName:b,userHref:p,canDeleteTag:!0},m=this.activeAreaId;this._confirmSuggestedTag(i,e,_,()=>{this.activeAreaId=m,this.areas[m]=extend(r,h),this.photoTooltip.updateState(h),this.showTagArea(m),this._removeActiveAreaAfterTimeout(1e3),u&&(cur.pvAskForAutoTag=!1,this.showSettingsBox())})}showSettingsBox(){showBox("/al_photos.php",{act:"show_autotag_settings"},{params:{containerClass:"autotag_settings_box",grey:!0,width:450}})}deleteTag(e){e||(e=this.activeAreaId,this.photoView.deleteTag(e)),this.hideTagArea();var _=this.areas[e];e&&_&&(_=extend(_,{isDeleted:!0}),addClass(_.ele,"deleted"))}_getTooltipOptions(e){var _=this.areas[e],t=_.suggestedUserId,o=_.suggestedUserName;return{suggestedUserId:t,userName:_.userName,userHref:_.userHref,suggestedUserName:o,usersList:_.usersList,canDeleteTag:_.canDeleteTag}}_handleSuggestionDeclined(){var e=this.activeAreaId,_=this.areas[e];if(_){var t=Object(l.getPhotoData)("suggested_tags");this.areas[e]=extend(_,{suggestedUserId:!1,suggestedUserName:!1,userHref:null}),this.showTagArea(e),t&&t[e]&&(t[e][4]=0);var o=Object(l.getPhotoData)("id"),a=Object(l.getPhotoData)("hash");ajax.post("al_photos.php",{act:"decline_suggested_tag",tag:e,photo:o,hash:a},{onFail:this.handleTagRequestFail})}}_confirmSuggestedTag(e,_,t,o){var a=Object(l.getPhotoData)("id"),i=Object(l.getPhotoData)("hash");ajax.post("al_photos.php",{act:"confirm_suggested_tag",tag:e,tagged_id:_,name:t,photo:a,hash:i},{onDone:(e,_,t)=>{this._updatePhotoView(e,_,t),o()},onFail:this.handleTagRequestFail})}handleTagRequestFail(e){var _=Object(i.getLang)("global_error");return setTimeout(Object(a.showFastBox)(_,e).hide,3e3),!0}unMount(){removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),removeEvent(this.areasContainer,"click",this._handleAreaClick),this.containerNode.innerHTML=""}hideAreas(){this.areasHidden=!0,hide(this.areasContainer),this.photoTooltip.hide()}showAreas(){this.areasHidden=!1,show(this.areasContainer),removeEvent(this.imageNode,"mousemove",this._handleImageMouseMove),addEvent(this.imageNode,"mousemove",this._handleImageMouseMove)}reload(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.hideTagArea(),this.resumeTooltips(),this.renderTagAreas(),e&&(this.imageNode=e),this.activeAreaId=null,this.waitToRemove=null,this.tagAreaFound=!1,this.areasHidden=!1,this.tooltipsPaused=!1,this.showAreas()}_queueCheckUpdates(){cur.pvTagsQueueParams&&window.Notifier&&Notifier.addKey(cur.pvTagsQueueParams,this._queueReceiveUpdates)}_updatePhotoView(e,_,t){Object(l.setPhotoData)("tags",e),Object(l.setPhotoData)("tagged",_),Object(l.setPhotoData)("tagshtml",t),this.photoView.setTags(t)}_queueReceiveUpdates(e,_){_.events&&_.events.forEach(e=>{var _=e.split("<!>"),t=_[1],o=_[2],a=JSON.parse(o),i=JSON.parse(_[3]),r=JSON.parse(_[4]),s=_[5];if(Object(l.getPhotoData)("id")===t)Object(l.setPhotoData)("suggested_tags",a),this._updatePhotoView(i,r,s),this.renderTagAreas();else if(cur.pvData){var n=function(e){if(cur.pvData.hasOwnProperty(e)){var _=cur.pvData[e];_.length&&_.forEach((_,o)=>{if(_.id&&_.id===t){var l=cur.pvData[e][o];l.suggested_tags=a,l.tags=i,l.tagged=r,l.tagshtml=s}})}};for(var d in cur.pvData)n(d)}})}}},hzb7:function(e,_,t){"use strict";t.r(_),t.d(_,"getPostTopicSelectorParams",(function(){return m})),t.d(_,"isPostTopicEditingEnabled",(function(){return g})),t.d(_,"isPostTopicSettingEnabled",(function(){return v})),t.d(_,"topicUISelectorHide",(function(){return h})),t.d(_,"initPostTopicCreatingSelector",(function(){return D})),t.d(_,"initPostTopicEditingSelector",(function(){return f}));var o,a=t("k487"),i=t("zxIV"),r=t("Egk5"),l=t("t7n3");!function(e){e.topicId="topic_id"}(o||(o={}));var s=function(){return(s=Object.assign||function(e){for(var _,t=1,o=arguments.length;t<o;t++)for(var a in _=arguments[t])Object.prototype.hasOwnProperty.call(_,a)&&(e[a]=_[a]);return e}).apply(this,arguments)},n=new Map,d=function(e,_){return function(e,_){return n.set(e,_)}(e,{actionParams:void 0,selector:_})},c=function(e,_){!function(e,_){var t=n.get(e);void 0!==t&&n.set(e,_(t))}(e,(function(e){return s(s({},e),{actionParams:_})}))},p=function(e,_){var t;c(e,((t={})[o.topicId]=_,t))},u=function(e){return"post_discover_category_btn"+e},b=function(e,_){var t,o,a=(t={link_id:String(_)},(o=Object(l.getTemplate)("postCategorySelect",t))?Object(i.se)(o):null);if(e instanceof HTMLElement&&a instanceof HTMLElement)return e.appendChild(a),a},h=function(e){var _,t;null===(t=null===(_=function(e){return n.get(e)}(e))||void 0===_?void 0:_.selector)||void 0===t||t.tooltipHide()},m=function(e){var _,t,a=null===(t=function(e){var _;return null===(_=n.get(e))||void 0===_?void 0:_.actionParams}(e))||void 0===t?void 0:t[o.topicId];return void 0!==a&&-1!==a?((_={})[o.topicId]=a,_):void 0},v=function(e){return!0===(null==e?void 0:e.wallPostTopicSettingEnabled)},g=function(e){return void 0!==e.topic_options},E=t("jE6c"),w=t("ZD4m"),O=function(){function e(e,_,t,o){var l=this;this.btnEl=e,this.containerEl=_,this.options=t,this.selectorContentEl=o,this.onOptionClickWrapper=function(){for(var e=[],_=0;_<arguments.length;_++)e[_]=arguments[_];l.tooltip.hide();var t=e[0].currentTarget;if(t instanceof HTMLElement){var o=Object(w.getJsonDataValue)(t,"data-click-params");o&&l.selectTopicId(o.value)}},this.linkId=this.options.linkId,this.radioBtnId=u(this.options.linkId),window.radioBtns[this.radioBtnId]={val:!1,els:o.children},this.tooltip=new a.default(e,{appendTo:_,forceSide:"bottom",autoShow:!1,cls:"eltt_fancy eltt_fancy_actions",noOverflow:!1,centerShift:0,offset:[-12*(window.vk.rtl?-1:1),7],content:o,align:"left",onFirstTimeShow:function(){Object(i.show)(o)}}),Object(i.domQuery)('[data-onclick="togglePostTopic"]',_).forEach((function(e){Object(r.addEvent)(e,"click",l.onOptionClickWrapper)}))}return e.create=function(_,t){var o=b(_,t.linkId);if(o){var a=this.getSelectorContentEl(o),r=Object(i.domQuery1)(".post_action_btn_layout",o);if(a&&r)return new e(r,o,t,a)}},e.getSelectorContentEl=function(e){return Object(i.domQuery1)(".post_action_tt_content",e)},e.prototype.destroy=function(){this.tooltip.destroy(),delete window.radioBtns[this.radioBtnId]},e.prototype.tooltipHide=function(){this.tooltip.hide()},e.prototype.selectTopicId=function(e){this.options.selectTopicId(this.linkId,e),this.updateViewForSelectedTopic({isTopicSelected:-1!==e,topicId:e})},e.prototype.clearSelection=function(){this.selectTopicId(-1)},e.prototype.updateViewForSelectedTopic=function(_){var t=_.isTopicSelected,o=_.topicId,a=e.getSelectOptionEl(this.containerEl,o),r=a&&Object(w.getJsonDataValue)(a,"data-click-params"),l=Object(i.domQuery1)(".post_action_btn_text",this.containerEl);if(a&&r&&l){var s=r.label;window.radiobtn(a,void 0,u(this.options.linkId));var n=l.getAttribute("data-empty")||"",d=t?s:n;l.innerHTML=d,l.setAttribute("aria-label",Object(E.replaceEntities)(d)),Object(i.toggleClass)(this.containerEl,"on",t)}},e.getSelectOptionEl=function(e,_){return Object(i.domQuery1)('[data-value="'+_+'"]',e)},e}(),P=function(e,_,t){var a=O.create(_,{linkId:e,selectTopicId:p});if(a)return d(e,a),a.selectTopicId(t[o.topicId]),{clearSelection:function(){a.clearSelection()},onDestroy:function(){a.destroy()}}},D=function(e,_){var t;return P(e,_,((t={})[o.topicId]=-1,t))},f=function(e,_,t){var a,i;return P(e,_,((a={})[o.topicId]=null!==(i=t[o.topicId])&&void 0!==i?i:-1,a))}},"iX+u":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Photoview",(function(){return Photoview}));var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("HEwt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ioFf"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("91GP"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("pIFo"),_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("1OKH"),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("WX8S"),_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("J1I5"),_photo_tags__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("g/In"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("98sY"),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("/PiP"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("zxIV"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("Egk5"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("t7n3"),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("zmTt"),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("qwyz"),_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("FThC"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("FWc3"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("7jxN");function _slicedToArray(e,_){return _arrayWithHoles(e)||_iterableToArrayLimit(e,_)||_unsupportedIterableToArray(e,_)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var t=0,o=new Array(_);t<_;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,_){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(t.push(r.value),!_||t.length!==_);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Photoview={MIN_WIDTH:600,MIN_HEIGHT:450,PE_MIN_WIDTH:750,PE_MIN_HEIGHT:500,SIDE_COLUMN_WIDTH:310,SIDE_MIN_GAP:40,VERTICAL_MIN_GAP:15,BOTTOM_BAR_HEIGHT:52,SIDE_NAV_PANELS_MAX_WIDTH:120,SIDE_NAV_PANELS_MIN_WIDTH:25,LEFT_RIGHT_NAV_RATIO:.25,blank:"/images/blank.gif",blankf:()=>{},cacheSize:3,allSizes:["x","y","z","w"],PE_V1:1,PE_V2:2,PE_V3:4,_getViewedPhotoFullId(){var e=cur.pvListId,_=cur.pvIndex;return cur.pvData[e][_].id},changeThumbs(e,_,t){if(e){var o=[ge("photo_row"+cur.filterPhoto),ge("photos_add_thumb"+cur.filterPhoto)],a=geByClass("page_post_thumb_wrap");for(var i in a.push.apply(a,geByClass("page_preview_photo")),a.push.apply(a,geByClass("im_preview_photo")),a.push.apply(a,geByClass("photo")),a.push.apply(a,geByClass("page_square_photo")),a.push.apply(a,geByClass("photos_row")),a)if(a.hasOwnProperty(i)){var r=a[i].getAttribute("onclick");if(!r){var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(a[i]);r=!!l&&l.getAttribute("onclick")}r&&-1!=r.indexOf(`'${cur.filterPhoto}'`)&&o.push(a[i])}for(var s in o)if(o[s]){if(hasClass(o[s],"page_square_photo")||o[s].style.backgroundImage){setStyle(o[s],{backgroundImage:`url('${e}')`});continue}var n=geByTag1("img",o[s]);n&&(n.src=e,setStyle(n,{height:"auto"}))}if(cur.pvNoTemp||(cur.pvNoTemp={}),cur.pvNoTemp[cur.filterPhoto]=!0,window.ThumbsEdit&&_){var d=ThumbsEdit.cache();for(var c in d)if(d.hasOwnProperty(c)){var p=d[c].previews||[],u=!1;for(var b in p)p.hasOwnProperty(b)&&"photo"==p[b].type&&p[b].photo.id=="photo"+t&&(p[b].photo.sizes=_,u=!0);u&&ThumbsEdit.refresh(c)}}}},openStickersEditor(e){cur.pvEditorMode||(e||(e=cur.pvCurPhoto),Photoview.stopTagger(),cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas(),Photoview.toggleNavControls(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvLikeFSWrap),Photoview.hideTag(!0),cur.pvEditorMode=!0,cur.pvEditorSaved=!1,Photoview.updatePhotoDimensions(),stManager.add([jsc("web/spe.js"),"photo_editor.css"],()=>{SPE.init(e,(_,t,o,a)=>{var i=_.id!=e.id;if(cur.pvEditorSaved=!0,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit){if(_&&t&&window.ThumbsEdit&&o){var r=ThumbsEdit.cache();for(var l in r)if(r.hasOwnProperty(l)){var s=l.replace("thumbs_edit",""),n=cur.addMedia[s],d=r[l].previews||[],c=!1;for(var p in d)if(d.hasOwnProperty(p)&&"photo"==d[p].type&&d[p].photo.id=="photo"+e.id){var u=d[p].photo;if(i){u.id="photo"+_.id,u.pid=_.id.split("_")[1];var b=n.getMedias();each(b,(function(){if("photo"==this[0]&&this[1]==e.id)return this[1]=_.id,!1}))}d[p].click=n.showPhoto.pbind(_.id,_.list,parseJSON(a)),d[p].itemId=u.pid,u.sizes=o,c=!0}c&&(ThumbsEdit.refresh(l),n.onChange&&n.onChange())}}return Photoview.changeThumbs(t,o,_.id),Photoview.hide(0)}if(cur.pvListId){var h=cur.pvListId,m=cur.pvData[h],v=cur.pvIndex;if(!m)return nav.reload();var g=m[v];if(i){var E=extend({},_);v=++cur.pvIndex,m.splice(v,0,E),g=E,cur.pvCommsLikes[g.id]=[g.comments,0,vkNow(),!1],delete g.comments,delete g.likes}var w=cur.pvShown&&h==cur.pvListId&&v==cur.pvIndex;_&&t&&!i&&(Photoview.changeThumbs(t,o,e.id),delete g.x_,delete g.x_src,delete g.y_,delete g.y_src,delete g.z_,delete g.z_src,extend(g,_)),g.peType=Photoview.PE_V3,w&&(cur.pvCurData=Photoview.genData(g,Photoview.getPhotoSize()),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto).src=Photoview.blank,setTimeout(Photoview.show.pbind(cur.pvListId,cur.pvIndex),0))}},()=>{if(delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&cur.pvPhotoTags.reload(),e.closeOnPEEdit)return Photoview.hide(0);show(cur.pvLikeFSWrap),Photoview.toggleNavControls(["left","right","close"]),setTimeout(Photoview.updatePhotoDimensions,1)})}))},genUrl:(e,_)=>_?(_.match(/\.[a-z]{3}$/i)||(_+=".jpg"),_.match(/https?:\/\//i)?_:(e||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+_):"",genData(e,_){for(var t,o,a="x"==_?3:"y"==_?2:"z"==_?1:0,i=["w","z","y","x"].slice(a),r=0;r<4-a;++r){var l=i[r];if(t=e[l+"_"])break;if(o=e[l+"_src"])break}return t||(t=[o]),{src:Photoview.genUrl(e.base,t[0]),width:t[2]&&t[1],height:t[1]&&t[2]}},actionInfo:()=>ge("pv_action_info")||domPN(cur.pvTags).insertBefore(ce("div",{id:"pv_action_info",className:"pv_right_block"}),cur.pvTags),locNav(e,_,t,o){if(cur.pvListId=="newtag"+vk.id+(t.rev?"/rev":"")&&t[0]=="albums"+vk.id&&"added"==t.act)return Photoview.hide(o.hist),!1;if((t=nav.toStr(t)).replace("?rev=1","/rev")==cur.pvListId&&cur.pvShown)return Photoview.hide(o.hist),!1;var a=t.match(/^photo(-?\d+_\d+)\??((all=1|newtag=\d+)(&rev=1)?|(rev=1&)?tag=\d+|rev=1)?$/);if(a){var i=cur.pvListId;i&&cur.pvShown||(i="added"==nav.objLoc.act?"newtag"+vk.id+(nav.objLoc.rev?"/rev":""):nav.strLoc.replace("?rev=1","/rev"));var r=cur.pvData[i];if(r)for(var l=0,s=r.length;l<s;++l)if(r[l]&&r[l].id==a[1])return Photoview.show(i,l,!1,cur.pvRoot),!1}},updateLocNav(){if(cur.pvRoot){for(var e=0,_=cur.nav.length;e<_;++e)if(cur.nav[e]==Photoview.locNav)return;cur.nav.push(Photoview.locNav)}else for(var t=0,o=cur.nav.length;t<o;++t)cur.nav[t]==Photoview.locNav&&(cur.nav.splice(t,1),--t,--o)},toggleOnPhotoControls(e){e=!!e,toggle(cur.pvFSWrap,e)},checkLayerVisibility(){if(cur.pvShown)return!0;debugLog("layerqueue.hide from photoview"),layerQueue.hide(),addEvent(window,"resize",Photoview.onResize),addEvent(document,"keydown",Photoview.onKeyDown),addEvent(layerWrap,"click",Photoview.onLayerClick),boxQueue.hideAll(),setStyle(layerBG,{opacity:""}),layers.show(),layers.fullhide=Photoview.hide},emojiShowTT:(e,_)=>void 0!==cur.pvEmoji&&Emoji.ttShow(cur.pvEmoji,e,_),emojiHideTT:(e,_)=>void 0!==cur.pvEmoji&&Emoji.ttHide(cur.pvEmoji,e,_),onImageWrapMouseDown(e){if(2!=e.button&&!cur.pvEditorMode){if(e.target.closest(".pv_attach_product_badge"))return!1;if(cur.pvAttachedProducts.isProcess)return Photoview.attachProductPoint(e),!1;if(!cur.pvTagger&&!1===Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(e)){var _=cur.pvIndex;return Photoview.updateNavBtnsLeftThreshold(),e.pageX<cur.pvLeftBtnAmount?_-=1:_+=1,cur.pvPointerPosition=[e.pageX,e.pageY],Photoview.show(!1,_,e)}}},onImageWrapMouseLeave(){removeClass(cur.pvNavBtnLeft,"pv_nav_btn_show"),removeClass(cur.pvNavBtnRight,"pv_nav_btn_show"),removeClass(cur.pvImageAreaWrap,"pv_init_hover"),Photoview.updateNavBtnsLeftThreshold(!0)},onImageWrapMouseMove(e){Photoview.updateNavBtnsLeftThreshold(),toggleClass(cur.pvNavBtnLeft,"pv_nav_btn_show",e.pageX<cur.pvLeftBtnAmount),toggleClass(cur.pvNavBtnRight,"pv_nav_btn_show",e.pageX>cur.pvLeftBtnAmount)},toggleLightModeClass(e){e=!!e&&cur.pvIsLightMode,toggleClass(cur.pvBox,"pv_light_mode",!!e),e=!!e&&cur.pvShowBottomActions,toggleClass(cur.pvBox,"pv_show_bottom_actions",!!e)},isPhotosList:()=>!!(cur.pvVideoTagsShown||cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown),createLayer(){cur.pvLayerCreated=!0,delete cur.pvLeftBtnAmount,addClass(layerWrap,"pv_layer_wrap"),addClass(layerBG,"pv_layer");var e=Photoview.isPhotosList(),_=nav.objLoc[0].match(/^faq(\d)+$/),t=nav.objLoc[0].match(/^bug(\d)+$/),o=cur.translationBoxOpened;cur.pvIsLightMode=t||0==nav.objLoc[0].indexOf("blog/")||_||inArray(nav.objLoc[0],["blog","about","support","helpdesk","tutorial","market","bugs","translation","restore2"])||o,cur.pvShowBottomActions=!cur.pvIsLightMode||_||inArray(nav.objLoc[0],["helpdesk","support"]);var a=cur.pvAlbumsShown?cur.pvAlbumsData[cur.pvAlbumsShown].html:"",i=cur.pvVideoTagsShown?cur.pvVideoTagsData.html:"",r=e?"display: none":"",l=e?"":"display: none",s=cur.pvAlbumsShown?"":"display: none",n=cur.pvVideoTagsShown?"":"display: none",d=cur.pvAlbumShown?cur.pvAlbumData[cur.pvAlbumShown].html:"",c=cur.pvAlbumShown?"":"display: none";cur.pvPhotoTagShown&&(d=cur.pvPhotoTagData[cur.pvPhotoTagShown].html,c=""),ge("pv_comments")&&(cur.pvBackupComments=ge("pv_comments"),domPN(ge("pv_comments")).removeChild(ge("pv_comments")));var p=`\n    <div style="${l}" class="box_title_wrap box_grey">\n      <div class="box_x_button" onclick="Photoview.hide(0)"></div>\n      <div class="box_title_controls"></div>\n      <div class="box_title"></div>\n    </div>\n    `,u=cur.pvIsLightMode?"":'\n      <div class="pv_fs_wrap">\n        <div class="pv_fs_btn" onmousedown="return Photoview.fullscreen(event);"><div></div></div>\n      </div>\n    ',b=`\n      <div class="pv_bottom_info clear_fix">\n        <div>\n          <div class="pv_bottom_info_left">\n            <span class="pv_album_name" onmouseover="setTitle(this)"></span>\n            <span class="pv_counter"></span></div>\n            ${cur.pvShowBottomActions?'<div class="pv_bottom_actions"></div>':""}\n        </div>\n      </div>`,h=cur.pvIsLightMode?"":'\n      <div class="pv_narrow_column_wrap">\n        <div class="pv_narrow_column_cont wall_module">\n          <div class="narrow_column" id="pv_narrow"></div>\n        </div>\n      </div>',m=getProgressHtml("pv_image_progress");layer.innerHTML=`\n    <div class="pv_cont">\n      <div id="pv_box" class="_scroll_node pv_box" tabindex="0" onclick="cur.pvClicked = true;" onmouseenter="removeClass(layerWrap, 'pv_mouse_out_layer')" onmouseleave="addClass(layerWrap, 'pv_mouse_out_layer')">\n        ${p}\n        <div class="clear_fix pv_photo_wrap" style="${r}">\n          <div class="pv_close_btn" onclick="Photoview.hide(0)"></div>\n          <div class="no_select pv_left_wrap">\n            <div class="no_select pv_image_wrap">\n              <div id="pv_tag_info" class="clear_fix">\n                <div class="pv_tag_info_buttons_wrap"></div>\n                <div class="pv_tag_info_text" onmouseover="setTitle(this)"></div>\n              </div>\n              <div id="pv_tag_frame"></div>\n              <div id="pv_tag_faded"></div>\n              <div id="pv_tag_person" onmouseout="Photoview.hideTag()"></div>\n              <div class="pv_photo_tags" id="pv_photo_tags"></div>\n              <div class="pv_img_area_wrap pv_init_hover" onmouseleave="return Photoview.onImageWrapMouseLeave(event)" onmousedown="return Photoview.onImageWrapMouseDown(event)" onmousemove="Photoview.onImageWrapMouseMove(event)">\n                <div class="pv_img_progress_wrap">${m}</div>\n                <div id="pv_photo"></div>\n                \n      <div class="pv_nav_btn" id="pv_nav_btn_left" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex - 1, event);">\n        <div class="pv_nav_btn_icon"></div>\n      </div>\n      <div class="pv_nav_btn" id="pv_nav_btn_right" onmousedown="cur.pvClicked = true; Photoview.show(false, cur.pvIndex + 1, event);"><div class="pv_nav_btn_icon"></div></div>\n    \n                <div class="pv_like_fs_wrap">\n                ${u}\n                </div>\n              </div>\n            </div>\n            ${b}\n          </div>\n          ${h}\n        </div>\n        <div id="pv_albums_wrap" class="pv_white_bg photos_container_albums" style="${s}">${a}</div>\n        <div id="pv_album_wrap" class="pv_white_bg" style="${c}">${d}</div>\n        <div id="pv_vtagged_wrap" class="pv_white_bg" style="${n}">${i}</div>\n      </div>\n    </div>`,cur.pvYourComment&&domPN(ge("pv_your_comment")).replaceChild(cur.pvYourComment,ge("pv_your_comment")),extend(cur,{pvCont:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(layer),pvBox:ge("pv_box"),pvImageAreaWrap:geByClass1("pv_img_area_wrap"),pvLeftWrap:geByClass1("pv_left_wrap"),pvTitle:geByClass1("box_title_wrap"),pvTitleText:geByClass1("box_title"),pvImageWrap:geByClass1("pv_image_wrap"),pvNavBtnLeft:ge("pv_nav_btn_left"),pvNavBtnRight:ge("pv_nav_btn_right"),pvNavBtnClose:geByClass1("pv_close_btn"),pvNarrowColumnWrap:geByClass1("pv_narrow_column_wrap"),pvNarrowColumn:geByClass1("pv_narrow_column_cont"),pvPhotoWrap:geByClass1("pv_photo_wrap"),pvAlbumWrap:ge("pv_album_wrap"),pvAlbumsWrap:ge("pv_albums_wrap"),pvVTagsWrap:ge("pv_vtagged_wrap"),pvPhotoTagsContainer:ge("pv_photo_tags"),pvTagInfo:ge("pv_tag_info"),pvTagFrame:ge("pv_tag_frame"),pvTagFaded:ge("pv_tag_faded"),pvTagPerson:ge("pv_tag_person"),pvPhoto:ge("pv_photo"),pvTagInfoText:geByClass1("pv_tag_info_text"),pvTagInfoButtons:geByClass1("pv_tag_info_buttons_wrap"),pvBottomInfo:geByClass1("pv_bottom_info"),pvAlbumName:geByClass1("pv_album_name"),pvCounter:geByClass1("pv_counter"),pvBottomActions:geByClass1("pv_bottom_actions"),pvBottomLeft:geByClass1("pv_bottom_info_left"),pvNarrow:ge("pv_narrow"),pvWide:ge("pv_wide"),pvImgProgress:ge("pv_image_progress"),pvLikeFSWrap:geByClass1("pv_like_fs_wrap"),pvFSWrap:geByClass1("pv_fs_wrap"),pvFS:ge("pv_fs"),pvFSFg:ge("pv_fs_fg"),pvActions:ge("pvs_actions"),pvYourComment:ge("pv_your_comment"),pvAddMedia:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_add_media")),pvMediaPreview:ge("pv_media_preview"),pvCommentSend:ge("pv_comment_send"),pvComment:ge("pv_comment")}),addEvent(layerWrap,"scroll",Photoview.scrollResize),addEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),Photoview.updateSize(),e&&_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.init(!1,{parent:layerWrap});var v=layerWrap.scrollTop;elfocus(geByClass1("_scroll_node",cur.pvCont)),layerWrap.scrollTop=v},doShowAlbums(e,_){if(e=intval(e),!_||2!=_.button&&3!=_.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!_&&cancelEvent(_);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==_))return!!_&&cancelEvent(_);var t=(cur.pvAlbumsData||{})[e];if(t){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),_&&_.pageX&&_.pageY&&extend(cur,{pvOldX:_.pageX,pvOldY:_.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvAlbumsShown=e,val("pva_owner")!=e&&extend(cur,{pvaOffset:t.opts.offset,pvaCount:t.opts.count,pvaPhotosOffset:t.opts.photos_offset,pvaPhotosCount:t.opts.photos_count,pvShowAllAlbums:!1}),cur.pvLayerCreated?(val("pva_owner")!=e&&val(cur.pvAlbumsWrap,t.html),isVisible(cur.pvAlbumsWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumWrap,cur.pvVTagsWrap),show(cur.pvAlbumsWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pva_scroll"))):Photoview.createLayer(!0),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.show(),show(cur.pvTitle),show(cur.pvAlbumsWrap),cur.pvTitleText.innerHTML=t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId?extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex}):(!browser.msie||browser.version>8)&&(cur.pvClicked=!1),Photoview.toggleNavControls(),cur.pvListId=!1;var o=extend(nav.objLoc,{z:"albums"+cur.pvAlbumsShown});return nav.strLoc!=nav.toStr(o)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(o)),Photoview.updatePeriods(),!!_&&cancelEvent(_)}}},jumpToAlbums(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="albums"+val("pva_owner")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAlbums)(val("pva_owner"),{noHistory:!0})},jumpToAlbum(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="album"+val("pvsa_album")||cur.pvJumpTo.z!=nav.objLoc.z)?(e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAlbum)(val("pvsa_album"),{noHistory:!0})},jumpToTagged(e){"temp"!=cur.pvListId||(cur.pvCancelLoad(),cur.pvJumpTo.z!="tag"+val("pvsa_tag")||cur.pvJumpTo.z!=nav.objLoc.z)?(cur.pvJumpTo.z=="tag"+val("pvsa_tag")&&(cur.pvJumpTo.z="photo_"+cur.pvJumpTo.z),e&&(cur.pvListId=!1),extend(cur,{pvJumpFrom:!1,pvJumpSteps:0}),nav.change(cur.pvJumpTo)):Photoview.showTagged(val("pvsa_tag"),{noHistory:!0})},doShowAlbum(e,_){if(!_||2!=_.button&&3!=_.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!_&&cancelEvent(_);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==_))return!!_&&cancelEvent(_);var t=(cur.pvAlbumData||{})[e];if(t){Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),_&&_.pageX&&_.pageY&&extend(cur,{pvOldX:_.pageX,pvOldY:_.pageY,pvOldT:vkNow()}),cur.pvShown||cur.pvAlbumShown||cur.pvAlbumsShown||layerQueue.push(),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.show(),cur.pvShown=!0,cur.pvAlbumShown=e,cur.pvLayerCreated&&val("pvsa_album")==e||extend(cur,{pvsaOffset:t.opts.offset,pvsaCount:t.opts.count}),cur.pvLayerCreated?(val("pvsa_album")!=e&&val(cur.pvAlbumWrap,t.html),isVisible(cur.pvAlbumWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap);var o=t.opts.author||"";if(cur.pvTitleText.innerHTML=(o?o+'<span class="divider"></span> ':"")+t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var a=(cur.pvListId||"").split("/");a[0]&&Photoview.showRepeat(ge(a[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var i=extend(nav.objLoc,{z:"album"+cur.pvAlbumShown});return nav.strLoc!=nav.toStr(i)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(i)),!!_&&cancelEvent(_)}}},doShowTagged(e,_){if(e=intval(e),!_||2!=_.button&&3!=_.which){if(clearTimeout(window.__pvhideTimer),__afterFocus)return!!_&&cancelEvent(_);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==_))return!!_&&cancelEvent(_);var t=(cur.pvPhotoTagData||{})[e];if(t){if(Photoview.checkLayerVisibility(),cur.pvRoot=!1,Photoview.updateLocNav(),Photoview.toggleLightModeClass(!1),_&&_.pageX&&_.pageY&&extend(cur,{pvOldX:_.pageX,pvOldY:_.pageY,pvOldT:vkNow()}),cur.pvShown=!0,cur.pvPhotoTagShown=e,cur.pvLayerCreated&&val("pvsa_tag")==e||extend(cur,{pvsaOffset:t.opts.offset,pvsaCount:t.opts.count}),cur.pvLayerCreated?(val("pvsa_tag")!=e&&val(cur.pvAlbumWrap,t.html),isVisible(cur.pvAlbumWrap)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvPhotoWrap,cur.pvAlbumsWrap,cur.pvVTagsWrap),show(cur.pvAlbumWrap),Photoview.updateSize(),layerWrap.scrollTop=val("pvsa_scroll"))):Photoview.createLayer(),show(cur.pvTitle),show(cur.pvAlbumWrap),cur.pvTitleText.innerHTML=t.opts.summary,cur.pvListId&&"temp"!=cur.pvListId){extend(cur,{pvOldListId:cur.pvListId,pvOldIndex:cur.pvIndex});var o=(cur.pvListId||"").split("/");o[0]&&Photoview.showRepeat(ge(o[0]))}else(!browser.msie||browser.version>8)&&(cur.pvClicked=!1);Photoview.toggleNavControls(),cur.pvListId=!1;var a=extend(nav.objLoc,{z:"photo_tag"+cur.pvPhotoTagShown});return nav.strLoc!=nav.toStr(a)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(a)),!!_&&cancelEvent(_)}}},toggleNavControls(e){each([cur.pvNavBtnRight,cur.pvNavBtnLeft,cur.pvNavBtnClose],(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(this)})),isString(e)&&(e=e.split(" ")),each(e||[],(function(e,_){switch(_){case"close":show(cur.pvNavBtnClose);break;case"left":show(cur.pvNavBtnLeft);break;case"right":show(cur.pvNavBtnRight)}}))},getPhotoSize(){var e;switch(cur.pvVeryBig){case 3:e="w";break;case 2:case 1:e="z";break;default:e="y"}return e},show(e,_,t,o){if(!cur.pvEditorMode&&(cur.pvAttachedProducts=cur.pvAttachedProducts||{},cur.pvAttachedProducts.badges&&cur.pvAttachedProducts.badges.forEach(e=>e.remove()),!t||2!=t.button&&3!=t.which))if(cur.cancelClick)delete cur.cancelClick;else{if(Photoview.destroyPeriod(),clearTimeout(window.__pvhideTimer),"temp"==e&&cur.pvShown){if(cur.pvListId&&"temp"!=cur.pvListId)return;cur.pvWasShown=!0}else cur.pvWasShown=!1;if(__afterFocus)return!!t&&cancelEvent(t);if(cur.pvTagger&&(_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),!1!==t))return!!t&&cancelEvent(t);if(!1===e){if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown){if(cur.pvOldListId)return extend(cur,{pvJumpTo:cur.pvOldJumpTo,pvJumpFrom:cur.pvOldJumpFrom,pvJumpSteps:cur.pvOldJumpSteps}),_==cur.pvOldIndex+1&&++cur.pvOldIndex,Photoview.show(cur.pvOldListId,cur.pvOldIndex,t,o);Photoview.toggleNavControls()}e=cur.pvListId}var a=((cur.pvData||{})[e]||{}).length,i=e!=cur.pvListId;if(a){t&&t.pageX&&t.pageY&&extend(cur,{pvOldX:t.pageX,pvOldY:t.pageY,pvOldT:vkNow()}),(cur.pvOptions||{}).queue&&(layerQueue.push(),cur.pvOptions.queue=!1,cur.pvHistoryLength=0),Photoview.checkLayerVisibility()||(i=!0);var r=_+(_<0?a:_>=a?-a:0),l=i?1:cur.pvIndex>_?-1:1;if(!i&&!cur.pvCanvas){if(cur.pvJumpTo){if(cur.pvJumpSteps+=_-cur.pvIndex,r===cur.pvJumpFrom&&cur.pvJumpSteps>=a)return extend(cur,{pvOldJumpFrom:cur.pvJumpFrom,pvOldJumpSteps:cur.pvJumpSteps-(_-cur.pvIndex),pvOldJumpTo:cur.pvJumpTo}),Photoview.jumpToAlbums(cur.pvJumpSteps<0);if(l>0&&(r<cur.pvJumpFrom&&r+4>cur.pvJumpFrom||r<cur.pvJumpFrom+a&&r+4>cur.pvJumpFrom+a)){vkImage().src=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":"")+".png?3";var s=cur.pvJumpTo.z.match(/^albums(-?\d+)$/);s&&(cur.pvAlbumsData||(cur.pvAlbumsData={}),cur.pvAlbumsData[s[1]]||(cur.pvAlbumsData[s[1]]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:s[1],other:1},{onDone:Photoview.loadedAlbums})))}cur.pvJumpSteps<=-a&&(cur.pvJumpSteps+=a)}if(1==a&&_!=cur.pvIndex&&("temp"!=e||cur.pvOptions.temp_final))return Photoview.hide(),!!t&&cancelEvent(t)}i&&"temp"!=e&&(!1===cur.pvJumpFrom&&(cur.pvJumpFrom=r),cur.pvRoot=o,Photoview.updateLocNav()),_=r;var n=cur.pvData[e][_];if(n&&(n.x_||n.x_src)){cur.pvIndex=_,cur.pvShown=!0,cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1,cur.pvListId=e,Photoview.calculateVeryBig();var d=Photoview.getPhotoSize();return cur.pvCurData=Photoview.genData(n,d),cur.pvLayerCreated||Photoview.createLayer(),cur.pvCurrent&&(cur.pvCurrent.onload=Photoview.blankf,cur.pvCurrent.src=Photoview.blank),delete cur.pvCurrent,cur.pvCurrent=vkImage(),cur.pvCurrent.onload=Photoview.preload.pbind(_,l),cur.pvCurrent.src=cur.pvCurData.src,i&&Photoview.toggleNavControls(a>1?"left right close":"close"),hideProgress(cur.pvCounter),"temp"!=e||cur.pvOptions.temp_final?"temp"==e&&cur.pvOptions.temp_final&&cur.pvOptions.temp_summary||(cur.pvCounter.innerHTML=a>1?getLang("photos_photo_counter_num_of_N").replace("%s",cur.pvIndex+1).replace(/%s|{count}/,a):""):showProgress(cur.pvCounter,"","pr_baw"),cur.pvCurPhoto=n,cur.pvCurData.width&&cur.pvCurData.height?Photoview.doShow():(cur.pvCurData=cur.pvCurrent,cur.pvTimerPassed=0,clearTimeout(cur.pvTimer),cur.pvTimer=setTimeout(Photoview.doShow,0)),cur.pvBox&&toggleClass(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown),!!t&&cancelEvent(t)}}}},_checkWebGL:()=>navigator.userAgent.indexOf("Windows NT 5.1")>=0?-1:function(){try{var e=document.createElement("canvas");e.width=e.height=100;var _={preserveDrawingBuffer:!0,premultipliedAlpha:!1};return!!window.WebGLRenderingContext&&(e.getContext("webgl",_)||e.getContext("experimental-webgl",_))}catch(e){return!1}}()?1:browser.safari?(debugLog("photo editor: webgl enable needed"),-2):(debugLog("photo editor: webgl not suported"),-1),openEditor(e,_){function t(t){return t||debugLog("photo editor: CORS not available ("+_+")"),showBox("al_photos.php",{act:"edit_photo",photo:e||cur.pvData[cur.pvListId][cur.pvIndex].id,webgl:Photoview._checkWebGL(),cors:t},{dark:1,stat:["ui_controls.css","ui_controls.js"]})}_=_||cur.pvCurData.src;var o=vkImage();o.onerror=()=>t(0),o.onload=()=>t(1),o.crossOrigin="",o.src=_},showSpamActions(){show(geByClass1("pv_more_acts_hidden")),cur.pvMoreActionsTooltip.updatePosition()},doShow(){show(cur.pvImgProgress);var e=cur.pvCurData;if((!e.width||!e.height)&&cur.pvTimerPassed<5e3)return clearTimeout(cur.pvTimer),cur.pvTimerPassed+=100,void(cur.pvTimer=setTimeout(Photoview.doShow,100));if(cur.pvShown)if(cur.pvCanvas)Photoview.pvCanvasSet();else{Photoview.toggleLightModeClass(!0),isVisible(cur.pvAlbumsWrap)&&(val("pva_scroll",layerWrap.scrollTop),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvAlbumsWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),isVisible(cur.pvAlbumWrap)&&(val("pvsa_scroll",layerWrap.scrollTop),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvAlbumWrap),show(cur.pvPhotoWrap),Photoview.updateSize()),_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.hide(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTitle);var _=cur.pvPhoto&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(_&&_.src){var t=/https?:\/\/[a-z0-9\.\-]+/;_.src.replace(t,"")!=e.src.replace(t,"")&&k(e.src)}else k(e.src);if(addEvent(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto),"load",()=>Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvImgProgress)),Photoview.updatePhotoDimensions(),window.tooltips&&tooltips.destroyAll(cur.pvBox),"temp"==cur.pvListId)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvCommentsData),Photoview.toggleOnPhotoControls(!1),void Photoview.updateVerticalPosition();Photoview.toggleOnPhotoControls(!0);var o=cur.pvCurPhoto;if(o.peData)return o.closeOnPEEdit=!0,void Photoview.openStickersEditor(o);var a=!(o.commshown>=0)&&-o.commshown;cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),Photoview.hideTag(!0),(e.width<200||e.height<200)&&(o.actions.prof=!1,o.actions.dialog=!1);var i="";("NA"!=o.album&&2!=a||o.graffiti)&&(i=o.album);var r=!o.album||!o.author;if(!cur.pvIsLightMode&&!r){var l="";l+='<div class="pv_author_block clear_fix">';var s="";"NA"!=o.author&&(s=o.author),s&&(o.author_href&&(l+=`<a class="pv_author_img fl_l" href="${o.author_href}">`),l+=`<div class="ow_ava ow_ava_comm" style="background-image: url('${o.author_photo}');"></div>`,o.author_href&&(l+="</a>")),l+=`\n        <div class="pv_author_info">\n          <div id="pv_author_name">${s}</div>\n          <div class="pv_date_info_wrap">\n            <span id="pv_date_info">${o.date}</span>\n          </div>\n        </div>\n      </div>`,l+=getProgressHtml("pv_progress");var n=cur.pvCommsLikes[o.id],d=n[0],c=n[1];l+=Likes.makeTemplate(o.likes_tpl,{object_raw:o.id,likes_count:c||"",liked:o.liked,share_count:o.shares||"",share_opts:{list:cur.pvListId,to:"mail"}});var p=1&o.actions.edit||o.desc,u="";if(p){var b=o.desc||`<span class="pv_desc_edit">${getLang("photos_edit_desc")}</span>`,h="";1&o.actions.edit&&(h+='class="pv_can_edit pv_desc_cont"',h+='onclick="Photoview.editInline(event)"'),u=`<div ${h}>${b}</div>`}1==o.was_edited?l+=`<div id="pv_edit_info" class="pv_right_block">${getLang("photos_was_edited")}</div>`:o.was_edited&&(l+=`\n          <div id="pv_edit_info" class="pv_right_block" onmouseover="showTooltip(this, {\n            text: '${o.was_edited}',\n            black: 1\n          });">${getLang("photos_was_edited")}</div>`),l+='<div id="pv_desc" class="pv_right_block" style="'+(p?"":"display: none")+'">'+u+"</div>",l+='<div id="pv_attached_products_list"></div>',l+='<div id="pv_microdata">'+(o.microdata_html?o.microdata_html:"")+(o.microdata_preview_button?o.microdata_preview_button:"")+"</div>",o.microdata_html&&shortCurrency(),l+='<div id="pv_tags"'+(o.tagshtml?"":' style="display: none"')+' class="pv_right_block">'+getLang("photos_onthisphoto")+": "+o.tagshtml+"</div>",l+='<div id="pv_place" class="pv_right_block">'+(o.place?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+o.place+"</a>":"")+"</div>",l+=d.tagName?'<div id="pv_comments_place"></div>':trim(d),cur.pvReplyForm&&re(cur.pvReplyForm),cur.pvReplyForm=null,l+='<div id="pv_rotate"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>',cur.pvNarrow.innerHTML="",Photoview.updateRightBlock(),cur.pvNarrow.innerHTML=l;var m=_slicedToArray(Photoview.generateMarketList(o.attached_tags.tags),2),v=m[0],g=m[1];o.attached_tags.tags&&o.attached_tags.tags.length&&document.getElementById("pv_attached_products_list").appendChild(v),cur.pvImageAreaWrap.appendChild(g);var E=geByClass1("pv_closed_commments_placeholder");if(a||!o.actions.comm?removeClass(E,"unshown"):o.reply_form&&(addClass(E,"unshown"),o.replyFormEl=cur.pvReplyForm=o.replyFormEl||se(o.reply_form),cur.pvNarrowColumn.appendChild(cur.pvReplyForm),cur.onReplyFormSizeUpdate=cur.onMediaChanged=e=>{cur.pvShown&&Photoview.updateRightBlock()},cur.onReplyFormFocus=()=>{Photoview.updateRightBlock(!0),cur.pvNarrowScrollbar.scrollBottom(0,!0)}),d.tagName){each(geByClass("page_gif_loading",d),()=>{Page.hideGif(this,!1)});var w=ge("pv_comments_place");domPN(w).replaceChild(d,w)}if(cur.pvNarrowScrollbar=new uiScroll(cur.pvNarrow,{global:!0}),o.reply_form){var O=geByClass1("reply_field",cur.pvNarrowColumn);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.data)(O,"send",Photoview.sendComment),placeholderInit(O,{editable:1}),cur.pvOptions.comment_focus_init){delete cur.pvOptions.comment_focus_init;var P=geByClass1("submit_post_field",cur.pvReplyForm);P&&P.focus()}}cur.editing=!1,Photoview.updateRightBlock()}var D=[];if(i=i||"",cur.pvAlbumName.innerHTML=i,toggle(cur.pvBottomInfo,!cur.pvIsLightMode||cur.pvShowBottomActions||i),vk.id&&o.actions.share&&D.push(`<a id="pv_share" onclick="Photoview.sendPhoto()">${getLang("photos_share_from_view")}</a>`),!o.taginfo&&o.actions.tag&&o.tags[0]<cur.pvMaxTags&&D.push(`\n          <a id="pv_tag_link" onclick="stManager.add([jsc('web/photo_tagger_mode.js'), 'tagger.css', jsc('web/tagger.js')], () => {\n            Phototag.startTag();\n          })">${getLang("photos_tagperson")}</a>`),o.actions.del&&D.push(`<a id="pv_delete" onclick="Photoview.deletePhoto()">${getLang("photos_pv_act_delete")}</a>`),o.actions.save&&D.push(`<a id="pv_save_to_me" onclick="Photoview.savePhoto()">${getLang("photos_pv_act_save")}</a>`),cur.pvShowBottomActions&&!r){var f=[],M=[];if(o.actions.spam&&(f.push(["spam",getLang("photos_report"),"","Photoview.showSpamActions()"]),f.push("sep"),M=cur.pvReasons),o.actions.forbid){var C=Photoview._getViewedPhotoFullId().split("_"),T=C[0],L=C[1];f.push(["atfr",getLang("reports_atfr"),"sfof("+T+", "+L+", 1)"])}if(o.actions.edit&&(o.peType&Photoview.PE_V1||o.peType&Photoview.PE_V2)&&f.push(["pe",getLang("photos_pv_act_photoeditor"),"Photoview.openEditor()"]),vk.id&&o.actions.pe&&o.peType&Photoview.PE_V3&&Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.isPhotoeditor3Available)()&&!inArray(nav.objLoc[0],["support","helpdesk"])&&f.push(["spe",getLang("global_pe_edit"),"Photoview.openStickersEditor()"]),o.actions.rot&&(f.push(["rotate_ccw",getLang("photos_pv_act_rotate_ccw"),"Photoview.rotatePhoto(-1)"]),f.push(["rotate_cw",getLang("photos_pv_act_rotate_cw"),"Photoview.rotatePhoto(1)"]),f.push("sep")),o.actions.place&&f.push(["place",getLang("photos_edit_add_place"),"Photoview.editPlace()"]),o.attached_tags&&o.attached_tags.hash&&f.push(["market",getLang("photos_edit_add_market"),"Photoview.selectProductInBox()"]),o.actions.prof&&f.push(["to_profile",getLang("photos_pv_act_to_avatar"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${o.id}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]})`]),o.actions.dialog&&f.push(["to_dialog",getLang("photos_load_to_dialog"),`showBox('al_page.php', {act: 'owner_photo_edit', photo: '${o.id}', oid: ${o.actions.dialog}, list: '${cur.pvListId}'}, {stat: ['owner_photo.css', jsc('web/owner_photo.js'), 'tagger.css', jsc('web/tagger.js')]});`]),o.actions.move){var A=o.id.split("_")[0];f.push(["move_to",getLang("photos_pv_act_move_to_album"),`\n            showBox('al_photos.php', {act: 'a_move_to_album_box', photo_id: '${o.id}', owner_id: ${A}}, {stat: ['page.js', 'page.css', 'wide_dd.js', 'wide_dd.css']})\n          `]),o.actions.cover&&f.push(["as_title",getLang("photos_album_to_cover"),`\n              ajax.post('al_photos.php', {act: 'a_set_as_album_title', photo: '${o.id}', hash: '${o.hash}'}, {onDone: showDoneBox})\n            `])}var y="";each(M,(e,_)=>{var t="Photoview.report('"+o.hash+"', '"+_[0]+"')";y+=`<div onclick="${t}" class="pv_more_act_item pv_more_spam_act_item" id="pv_more_spam_act_${_[0]}">${_[1]}</div>`}),y=y?'<div class="pv_more_acts_hidden">'+y+"</div>":"";var I="";each(f,(e,_)=>{I+="sep"==_?'<div class="pv_more_act_item_sep"></div>':`\n              <div class="pv_more_act_item" onmouseover="${_[3]||""}" onclick="${_[2]||""}" id="pv_more_act_${_[0]}">\n                ${_[1]}\n              </div>\n            `}),I=`<div class="pv_more_acts">${I+=`<a\n          class="pv_more_act_item"\n          id="pv_more_act_download"\n          target="_blank"\n          rel="noopener"\n          href="${Photoview.genData(o,"w").src}\n        ">\n            ${getLang("photos_pv_act_open_original")}\n        </a>`}</div>`,f.length?(f=(f=JSON.stringify(f)).replace(/\"/g,"&quot;"),D.push(`<a class="pv_actions_more" data-items="${f}">${getLang("photos_actions_more")}</a>`)):inArray(nav.objLoc[0],["support","helpdesk"])&&D.push(`\n            <a id="pv_more_act_download" target="_blank" rel="noopener" href="${Photoview.genData(o,"w").src}">\n              ${getLang("photos_pv_act_open_original")}\n            </a>\n          `),D=D.join('<span class="divider"></span>'),cur.pvIsLightMode&&(D+='<div id="pv_rotate" style="display:none;"><form method="POST" target="pv_rotate_frame" name="pv_rotate_form" id="pv_rotate_form"></form></div></div>'),cur.pvBottomActions.innerHTML=D;var B=geByClass1("pv_actions_more");B&&(cur.pvMoreActionsTooltip=new ElementTooltip(B,{id:"pv_more_acts_tt",forceSide:"top",elClassWhenShown:"pv_more_shown",content:y+I,offset:[0,-5],autoShow:!0,noHideOnClick:!0}))}if(Photoview.updatePhotoDimensions(),extend(cur,{pvTagLink:ge("pv_tag_link"),pvLikeIcon:geByClass1("pv_like_icon"),pvLikeLink:geByClass1("pv_like_link"),pvDesc:ge("pv_desc"),pvTags:ge("pv_tags"),pvEditing:!1,pvProgress:ge("pv_progress")}),o.deleted||!o.author)cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),isArray(o.deleted)&&Photoview.toggleTopInfoPanel(o.deleted[0],o.deleted[1]),r||Photoview.toggleDeletedState(!0);else if(o.taginfo){cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done");var j=getLang("photos_confirm_tag"),W=getLang("photos_delete_tag"),R=`\n        <button class="flat_button" id="pv_confirm_tag" onclick="Photoview.confirmTag(${o.tagid}, this)">\n          ${j}\n        </button>\n        <button class="flat_button secondary black" id="pv_delete_tag" onclick="Photoview.deleteTag(${o.tagid}, this)">\n          ${W}\n        </button>\n      </div>\n      `;Photoview.toggleTopInfoPanel(o.taginfo,R),show(cur.pvCommentsData)}else Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1);(cur.pvOptions||{}).scroll&&cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollTop(cur.pvOptions.scroll),cur.pvBodyScrollTop=bodyNode.scrollTop,setTimeout((function(){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop)}),0),Photoview.updateVerticalPosition();var U=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);cur.pvPhotoTags?cur.pvPhotoTags.reload(U):vk.id&&(cur.pvPhotoTags=new _photo_tags__WEBPACK_IMPORTED_MODULE_13__.default(U,cur.pvPhotoTagsContainer)),setTimeout(Photoview.afterShow,2)}function k(e){cur.pvPhoto.innerHTML='<img src="'+e+'" />'}},toggleTopInfoPanel(e,_){var t=!!isString(e)||!!e;void 0!==e&&(cur.pvTagInfoText.innerHTML=e),void 0!==_&&(cur.pvTagInfoButtons.innerHTML=_),toggle(cur.pvTagInfo,t),Photoview.updatePhotoTagsContainerDimensions(),Photoview.updatePhotoDimensions()},toggleDeletedState(e){e=!!e,toggleClass(cur.pvCont,"pv_deleted_state",e),Photoview.updateRightBlock()},updatePhotoTagsContainerDimensions(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(_){e||(e=_.offsetWidth);var t=_.offsetLeft,o=_.offsetTop;setStyle(cur.pvPhotoTagsContainer,{top:o+"px",left:t+"px",width:e+"px"})}},updateTagFrameDimensions(e,_,t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto);if(o){var a=o.offsetLeft,i=o.offsetTop;setStyle(cur.pvTagFaded,{width:cur.pvPhWidth+"px",height:cur.pvPhHeight+"px",left:a+"px",top:i+"px"}),setStyle(cur.pvTagFrame,{left:a+"px",top:i+"px"}),setStyle(cur.pvTagPerson,{left:a+"px",top:i+"px"}),e&&_&&setStyle(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvTagFrame),{width:e,height:_,marginTop:intval(t)})}},afterShow(){cur.pvPhoto.href="/photo"+cur.pvCurPhoto.id,cur.pvPhoto.focus(),4&cur.pvCurPhoto.actions.edit&&1&cur.pvCurPhoto.actions.edit&&!cur.pvCurPhoto.desc&&Photoview.editInline(),cur.pvTagFrame.innerHTML='<img src="'+cur.pvCurData.src+'" />',Photoview.updateTagFrameDimensions(),(cur.pvOptions||{}).scroll&&(layerWrap.scrollTop=cur.pvOptions.scroll,cur.pvOptions.scroll=0),Photoview.updateLoc(),Photoview.updatePhotoDimensions()},pvCanvasUpdate(e){var _=cur.pvCurData;if(cur.pvCanvas&&_&&_.width&&_.height){cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight;var t,o=_.width||604,a=_.height||453,i=cur.pvScrWidth/o,r=ge("pv_fs_img_fade")||ge("pv_fs_img_wrap"),l=r&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(r);a*i>cur.pvScrHeight&&(i=cur.pvScrHeight/a),i>1.25&&(i=1.25),o=Math.floor(o*i),a=Math.floor(a*i),t=Math.floor((cur.pvScrHeight-a)/2),(cur.pvFSWidth!=o||cur.pvFSHeight!=a||cur.pvFSTop!=t||e)&&(cur.pvFSWidth=o,cur.pvFSHeight=a,cur.pvFSTop=t,l&&setStyle(l,{marginTop:t,width:o,height:a}))}},pvCanvasSet(){var e=cur.pvCurData;if(cur.pvCanvas&&e){var _,t=vkImage(),o=()=>{ge("pv_fs_img_fade")&&(re("pv_fs_img_wrap"),ge("pv_fs_img_fade").id="pv_fs_img_wrap")};o(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_fs_img_wrap"))&&cur.pvSlideNeedAnimation?(cur.pvSlideNeedAnimation=!1,cur.pvCanvas.insertBefore(se('<div id="pv_fs_img_fade"><img src="'+e.src+'" /></div>'),ge("pv_fs_img_wrap")),_=()=>{cssAnim(ge("pv_fs_img_wrap"),{opacity:0},{duration:1e3},()=>{o(),Photoview.fullscreenOnLoad()}),cssAnim(ge("pv_fs_img_fade"),{opacity:1},{duration:1e3})}):(val(ge("pv_fs_img_wrap"),'<img src="'+e.src+'" />'),_=Photoview.fullscreenOnLoad),Photoview.pvCanvasUpdate(!0),t.onload=_,t.src=e.src,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.updateInfo()}},updateLoc(){var e,_=cur.pvListId;cur.pvRoot?(e={0:"photo"+cur.pvCurPhoto.id},"photos"==_.substr(0,6)?e.all=1:"tag"==_.substr(0,3)?e.tag=intval(_.substr(3)):"newtag"==_.substr(0,6)&&(e.newtag=intval(_.substr(6))),-1!=_.indexOf("/rev")&&(e.rev=1),Object(_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__.isClaimContent)()&&(e.claim=window.nav.objLoc.claim,e.dmcah=window.nav.objLoc.dmcah)):e=extend(nav.objLoc,{z:"photo"+cur.pvCurPhoto.id+"/"+(cur.pvCurPhoto.list_override||_)}),nav.strLoc!=nav.toStr(e)&&(cur.pvNoHistory||++cur.pvHistoryLength,nav.setLoc(e),(cur.pvOptions||{}).fromQueue&&(cur.pvNoHistory=!0,cur.pvHistoryLength=0)),cur.pvOptions&&(cur.pvOptions.fromQueue=!1)},canFullscreen(){var e=browser,_=floatval(browser.version);return!e.mobile&&(document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||e.safari&&_>5)},fullscreenOnLoad(){_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.slide()},fullscreenEnd(e){var _=cur.pvCanvas;_&&(cleanElems(_),re(_),clearTimeout(cur.pvFSTimer),clearTimeout(cur.pvFSControlsTimer),cur.pvCanvas=cur.pvFSControls=cur.pvFSTimer=cur.pvFSControlsTimer=!1,removeEvent(document,"webkitfullscreenchange mozfullscreenchange fullscreenchange webkitfullscreenerror mozfullscreenerror fullscreenerror"),show(pageNode),cur.pvCanvasUpdateTO&&clearInterval(cur.pvCanvasUpdateTO),void 0!==cur.pvScrWasY&&(scrollToY(cur.pvScrWasY,0),delete cur.pvScrWasY),!0!==e&&(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex)))},fullscreen(e){if(!cur.pvCanvas&&!cur.pe){var _=cur.pvCanvas=bodyNode.appendChild(ce("div",{className:"fixed",id:"pv_fullscreen",innerHTML:'<div id="pv_fs_img_wrap"></div>'})),t=_.requestFullscreen||_.requestFullScreen||_.webkitRequestFullScreen||_.mozRequestFullScreen||_.msRequestFullscreen;cur.pvFinishing=!1,_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.init(),addEvent(document,"webkitfullscreenchange mozfullscreenchange MSFullscreenChange fullscreenchange",Photoview.onFullscreen),addEvent(document,"webkitfullscreenerror mozfullscreenerror MSFullscreenError fullscreenerror",Photoview.fullscreenEnd.pbind(!0));try{t.call(_)}catch(e){cur.pvPartScreen=!0,Photoview.onFullscreen()}return cancelEvent(e)}},fullscreenStop(e){cur.pvFinishing=!0===e,cur.pvPartScreen=!1;var _=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen;try{_.call(document)}catch(e){Photoview.onFullscreen()}setTimeout(Photoview.fullscreenEnd,30)},onFullscreen(){isFullScreen()?(cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),cur.pvScrWidth=cur.pvCanvas.offsetWidth,cur.pvScrHeight=cur.pvCanvas.offsetHeight,cur.pvScrWasY=scrollGetY(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(pageNode),cur.pvCanvasUpdateTO=setInterval(Photoview.pvCanvasUpdate.pbind(!1),100),cur.pvFinishing||(Photoview.updateSize(),Photoview.show(cur.pvListId,cur.pvIndex))):Photoview.fullscreenEnd(cur.pvFinishing)},showDD(e,_){if(!hasClass(e,"pv_report_blocked")&&_&&(clearTimeout(cur.hideShareTimer),e.blur(),!hasClass(_,"pv_dd_hiding"))){if(isVisible(_))return fadeIn(_,0);cur.ddShown&&Photoview.hideDD(0),cur.ddShown=_,setTimeout(addEvent.pbind(document,"click",Photoview.hideDD),1),show(_)}},hideDD(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideDD.pbind(0),e);else{var _=cur.ddShown;_&&(-1==e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(_):(addClass(_,"pv_dd_hiding"),fadeOut(_,200,()=>{removeClass(_,"pv_dd_hiding")})),removeEvent(document,"click",Photoview.hideDD),cur.ddShown=!1)}},createDD:(e,_)=>`\n      <div onmouseover="Photoview.showDD(this.previousSibling, this);" onmouseout="Photoview.hideDD(500)" onclick="Photoview.hideDD(-1)" class="pvs_dd fixed">\n        <table cellspacing="0" cellpadding="0">\n          <tr>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n            <td>\n              <div class="pvs_header_wrap">\n                <div class="pvs_header">\n                  <span class="pvs_header_text">${_}</span>\n                </div>\n              </div>\n              <div class="pvs_acts">${e}</div>\n              <div class="pvs_sh1"></div>\n              <div class="pvs_sh2"></div>\n            </td>\n            <td class="pvs_side_sh">\n              <div class="pvs_side_sh_el"></div>\n            </td>\n          </tr>\n        </table>\n       </div>\n    `,report(e,_){var t=cur.pvCurPhoto.id.split("_"),o=()=>{var e=ge("pv_more_act_spam");val(e,getLang("global_report_sent")),re(geByClass1("pv_more_acts_hidden")),cur.pvMoreActionsTooltip.updatePosition(),cur.pvMoreActionsTooltip.show()};stManager.add([jsc("web/reports.js"),"reports.css"],()=>{window.showReportReasonDescriptionPopup("photo",parseInt(t[0]),parseInt(t[1]),parseInt(_),e,o)})},showShare(){clearTimeout(cur.hideShareTimer);var e=ge("pvs_dd");if(ge("pv_share").blur(),isVisible(e))return fadeIn(e,0);setTimeout(addEvent.pbind(document,"click",Photoview.hideShare),1),show(e)},hideShare(e){if(e>0)cur.hideShareTimer=setTimeout(Photoview.hideShare.pbind(0),e);else{var _=ge("pvs_dd");_&&(-1==e?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(_):fadeOut(_,200),removeEvent(document,"click",Photoview.hideShare))}},savePhoto(){var e=cur.pvListId,_=cur.pvData[e][cur.pvIndex];ajax.post("al_photos.php",{act:"save_me",photo:_.id,list:e,hash:_.hash},{onDone:()=>{var e=document.getElementById("pv_save_to_me");domPN(e).replaceChild(ce("div",{className:"pv_save_to_me_saved",innerHTML:getLang("photos_pv_act_save_saved")}),e),_.actions.save=0},onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),e),!0)})},sendPhoto(){var e=cur.pvListId,_=cur.pvIndex,t=cur.pvData[e][_];showBox("like.php",{act:"publish_box",object:"photo"+t.id,list:e,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css",jsc("web/sharebox.js")]})},moveToAlbumBox:(e,_,t)=>!showBox("al_photos.php",{act:"a_move_to_album_box",photo_id:e+"_"+_,owner_id:e,from:t},{stat:["page.js","page.css","wide_dd.js","wide_dd.css"]}),moveToAlbum(e,_,t){ajax.post("al_photos.php",{act:"a_move_photo",photo:e,album_id:_,hash:t},{onDone:e=>{curBox().hide();var _=ge("pv_album_name");_&&(_.innerHTML=e),cur.pvCurPhoto.album=e,showDoneBox('<div class="pv_done_box">'+getLang("photos_move_to_album_success").replace("{album}",e)+"</div>")}})},setTags(e){Photoview.hideTag(),e?(show(cur.pvTags),window.tooltips&&each(geByClass("delete",cur.pvTags),()=>{tooltips.destroy(this)}),cur.pvTags.innerHTML=getLang("photos_onthisphoto")+": "+e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTags)},preload(e,_){window.updateWndVScroll&&updateWndVScroll();var t=cur.pvListId,o=((cur.pvData||{})[t]||{}).length;if(o){var a=cur.pvVeryBig>2?"w":cur.pvVeryBig?"z":"y",i=cur.pvVeryBig>1||cur.pvVeryBig?"z":"y",r=cur.pvVeryBig>1?"z":cur.pvVeryBig?"y":"x",l=cur.pvVeryBig>1?"y":cur.pvVeryBig?"x":0;cur.pvLastFrom=e,cur.pvLastDirection=_;for(var s=Photoview.allSizes,n=0;n<Math.min(Photoview.cacheSize,o-Photoview.cacheSize);++n){for(var d=e+(n+1)*-_;d>=o;)d-=o;for(;d<0;)d+=o;var c=cur.pvData[t][d];if(c)for(var p=0,u=s.length;p<u;++p){var b=s[p];c[b]&&c[b].src&&(c[b].src=Photoview.blank,delete c[b])}}var h=function(s){for(var n=e+(s+1)*_;n>=o;)n-=o;for(;n<0;)n+=o;var d=cur.pvData[t][n];return d&&d.id?d[a]?"continue":d[a+"_src"]?(d[a]=vkImage(),d[a].src=d[a+"_src"],"continue"):(d[a]=1,d[i]?"continue":d[i+"_src"]?(d[i]=vkImage(),d[i].src=d[i+"_src"],"continue"):(d[i]=1,d[r]?"continue":d[r+"_src"]?(d[r]=vkImage(),d[r].src=d[r+"_src"],"continue"):(d[r]=1,d[l]?"continue":d[l+"_src"]?(d[l]=vkImage(),d[l].src=d[l+"_src"],"continue"):(d[l]=1,d.x?"continue":(d.x=vkImage(),void(d.x.src=d.x_src)))))):((!d||vkNow()-d>3e3)&&(cur.pvData[t][n]=vkNow(),setTimeout(()=>{ajax.post("al_photos.php",{act:"show",list:t,offset:Photoview.realOffset(t,n,-1),direction:_},{onDone:Photoview.loaded})},10)),"break")};e:for(var m=0;m<Photoview.cacheSize;++m){switch(h(m)){case"break":break e;case"continue":continue}}}},hide(e,_){if(Photoview.hideTag(!0),cur.pvShown&&(!__afterFocus||!0===_)){if(cur.pvCanvas&&Photoview.fullscreenStop(!0),cur.prevPhotoWidth=cur.prevPhotoHeight=0,(cur.pvJumpTo||{}).z=="albums"+val("pva_owner")&&!cur.pvAlbumsShown&&0===e)return Photoview.jumpToAlbums(!0);if((cur.pvJumpTo||{}).z=="album"+val("pvsa_album")&&!cur.pvAlbumShown&&0===e)return Photoview.jumpToAlbum(!0);if((cur.pvJumpTo||{}).z=="tag"+val("pvsa_tag")&&!cur.pvPhotoTagShown&&0===e)return Photoview.jumpToTagged(!0);if("temp"==cur.pvListId)cur.pvCancelLoad();else if(!cur.pvNoHistory&&!e&&cur.pvHistoryLength>0&&cur.pvHistoryLength<10)return cur.pvNoHistory=!0,__adsUpdate("very_lazy"),cur.pvBodyScrollTop=bodyNode.scrollTop,history.go(-cur.pvHistoryLength);var t;if(!0!==e&&!layerQueue.count())cur.pvRoot?("newtag"==cur.pvListId.substr(0,6)?(t="albums"+vk.id+"?act=added",-1!=cur.pvListId.indexOf("/rev")&&(t+="&rev=1")):t=cur.pvListId.replace(/^photos/,"albums").replace("/rev","?rev=1"),nav.setLoc(t)):delete(t=clone(nav.objLoc)).z,nav.strLoc!=nav.toStr(t)&&nav.setLoc(t),__adsUpdate("very_lazy");window.__pvhideTimer=setTimeout(Photoview.doHide.pbind(cur),0),__adsUpdate(),cur.pvAlbumsShowing=cur.pvAlbumsShown=!1,cur.pvAlbumShowing=cur.pvAlbumShown=!1,cur.pvPhotoTagShowing=cur.pvPhotoTagShown=!1,cur.pvVideoTagShowing=cur.pvVideoTagsShown=!1}},doHide(e){void 0!==cur.pvBodyScrollTop&&(bodyNode.scrollTop=cur.pvBodyScrollTop,delete cur.pvBodyScrollTop),cur.pvTaggerTooltip&&(cur.pvTaggerTooltip.unMount(),delete cur.pvTaggerTooltip),e.pvHistoryLength=0,cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag(),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),e.pvFriends&&(cleanElems("pv_add_tag","pv_cancel_tag",e.pvFriends.firstChild.firstChild,e.pvFriends),re(e.pvFriends),e.pvFriends=e.pvFriendName=!1),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.cancelEdit(!0);var _=Photoview.allSizes,t=e.pvListId,o=((e.pvData||{})[t]||{}).length;if(e.pvLastDirection&&o){for(var a=0;a<Photoview.cacheSize;++a){for(var i=e.pvLastFrom+(a+1)*e.pvLastDirection;i>=o;)i-=o;for(;i<0;)i+=o;var r=e.pvData[t][i];if(r)for(var l=0,s=_.length;l<s;++l){var n=_[l];r[n]&&r[n].src&&(r[n].src=Photoview.blank,delete r[n])}}e.pvLastDirection=e.pvLastFrom=!1}if(cur.pvYourComment=re(cur.pvYourComment),layers.hide(),layers.fullhide=!1,delete cur.pvLayerCreated,window.tooltips&&tooltips.destroyAll(cur.pvBox),removeClass(layerWrap,"pv_layer_wrap"),removeClass(layerBG,"pv_layer"),layerBG.style.opacity="",e.pvShown=e.pvListId=e.pvClicked=!1,removeEvent(window,"resize",Photoview.onResize),removeEvent(document,"keydown",Photoview.onKeyDown),removeEvent(layerWrap,"click",Photoview.onLayerClick),removeEvent(layerWrap,"scroll",Photoview.scrollResize),removeEvent(layerWrap,"mousemove",Photoview.onLayerMouseMove),cur.pvOptions){var d=cur.pvOptions.onHide;cur.pvOptions.onHide=!1,d&&d()}if(layerQueue.pop(),Photoview.destroyPeriod(),e.pvPreloaded&&e===cur){for(var c=geByClass1("photos_container"),p=ce("div",{innerHTML:e.pvPreloaded});p.firstChild;)c.appendChild(p.firstChild);c.qsorter&&setTimeout(qsorter.added.pbind(c),0),e.pvPreloaded=!1}_web_legacy_ui_ui_scroll_box__WEBPACK_IMPORTED_MODULE_19__.default.hide(),Photoview.toggleFastChats(!0),delete cur.pvEditorMode,delete cur.pvEditorModeDimensionsUpdated,cur.pvPhotoTags&&(cur.pvPhotoTags.unMount(),delete cur.pvPhotoTags)},editPhoto(){},descTT:e=>Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e,{text:getLang("photos_edit_desc"),black:1,shift:[-160,13,0],showdt:0,appendParentCls:"narrow_column"}),editInline(e){if("A"!=((e||window.event||{}).target||{}).tagName&&!cur.pvEditing){window.tooltips&&window.tooltips.hideAll();var _=cur.pvListId,t=cur.pvIndex,o=cur.pvData[_][t],a=e=>{if(cur.pvShown&&cur.pvListId==_&&cur.pvIndex==t&&!cur.pvEditing){cur.pvEditing=[_,t];var o=ge("pv_caption_warn"),a=getLang("photos_edit_desc_intro"),i=cur.pvDesc.appendChild(ce("div",{innerHTML:`\n          <textarea\n            class="dark"\n            id="pv_edit_text"\n            onkeydown="onCtrlEnter(event, Photoview.saveInline)"\n            onkeyup="checkTextLength(cur.pvCaptionLimit, this, ${o});"\n            placeholder="${a}"\n          >${e}</textarea>\n          <div id="pv_caption_warn"><div>`},{display:"none"})),r=ge("pv_edit_text");autosizeSetup(r,{minHeight:21,maxHeight:350}),setTimeout(()=>{show(i),elfocus(r),addEvent(r,"blur",Photoview.saveInline),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvDesc.firstChild),cur.pvNarrowScrollbar.scrollTop(0)},1)}};!o.desc?a(""):ajax.post("al_photos.php",{act:"edit_desc",photo:o.id},{onDone:a,progress:cur.pvProgress})}},cancelInline(){cur.pvEditing=!1,removeEvent(ge("pv_edit_text"),"blur"),show(cur.pvDesc.firstChild),re(cur.pvDesc.firstChild.nextSibling)},saveInline(){if(cur.pvEditing){removeEvent(ge("pv_edit_text"),"blur");var e=cur.pvEditing[0],_=cur.pvEditing[1],t=cur.pvData[e][_],o=trim(val("pv_edit_text"));if(geByClass1("pv_desc_edit",cur.pvDesc)&&!o)return Photoview.cancelInline();ajax.post("al_photos.php",{act:"save_desc",photo:t.id,hash:t.hash,text:o},{onDone:o=>{if(t.desc=o,cur.pvShown&&e==cur.pvListId&&_==cur.pvIndex){cur.pvEditing=!1;var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvDesc);val(a,o||'<span class="pv_desc_edit">'+getLang("photos_edit_desc")+"</span>"),a.onmouseover=o?Photoview.descTT.pbind(a):()=>{},show(a),re(domNS(a))}},progress:cur.pvProgress})}},cmp(e,_){var t=e.length,o=_.length;return t<o?-1:t>o?1:e<_?-1:e>_?1:0},receiveComms(e,_,t,o,a,i){if(e==cur.pvListId&&_==cur.pvIndex){for(var r=ce("div",{innerHTML:t}),l=ge("pv_comments_list"),s=domLC(l),n=getXY(c,!0)[1],d=cur.pvData[e][_],c=s,p=domLC(r);p;p=domLC(r)){for(d.actions.comm&&addClass(p,"reply_replieable");c&&Photoview.cmp(c.id,p.id)>0;)c=domPS(c);c&&!Photoview.cmp(c.id,p.id)?(l.replaceChild(p,c),c=p):(c&&domNS(c)?l.insertBefore(p,domNS(c)):!c&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(l)?!0===a?(--d.commshown,r.removeChild(p)):l.insertBefore(p,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(l)):l.appendChild(p),++d.commshown)}i&&s&&(layerWrap.scrollTop+=getXY(s,!0)[1]-n),cur.pvCommsLikes[d.id][0]=ge("pv_comments"),extend(cur.pvReplyNames,o),Photoview.updateComms()}},commSaved(e){if(cur.pvShown){var _=ge("pv_comments"),t=!!_&&cur.pvData[cur.pvListId][cur.pvIndex],o=e.match(/^(-?\d+)photo(_\d+)/);t&&o&&ge("pv_comment"+o[1]+o[2])&&(cur.pvCommsLikes[t.id][0]=_)}},comments(e){if(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_comments")).id||"";if(!isVisible("pv_comments_header")||Photoview.cmp(_,"pv_comment"+e)<0)return}var t=cur.pvListId,o=cur.pvIndex,a=cur.pvData[t][o],i=ge("pv_comments_header");ajax.post("al_photos.php",{act:"photo_comments",offset:a.commshown,photo:a.id,list_id:cur.pvListId},{onDone:(_,a)=>{Photoview.receiveComms(t,o,_,a,!1,e),e&&ge("pv_comment"+e)&&Photoview.showComment(e)},showProgress:function(e){function _(){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}(()=>{i.innerHTML="",showProgress(i)}),hideProgress:function(e){function _(){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}(()=>{hideProgress(i)})})},updateComms(e){var _=cur.pvData[cur.pvListId][cur.pvIndex],t=ge("pv_comments_header"),o="";_.commcount>_.commshown&&(o=getLang("photos_show_prev_comments",_.commcount-_.commshown)),toggleClass(ge("pv_comments_list"),"unshown",!e&&0==_.commcount),toggle(t,o),toggle(geByClass1("pv_no_commments_placeholder"),0==_.commcount&&!geByClass1("_post_content",cur.pvBox)),t.innerHTML=o},commentChanged(){checkTextLength(cur.pvCommLimit,cur.pvComment),cur.pvCommenting=cur.pvData[cur.pvListId][cur.pvIndex].id},updateRightBlock(e){function _(){var e=getSize(cur.pvLeftWrap)[1]-(cur.pvReplyForm?getSize(cur.pvReplyForm)[1]:0);setStyle(cur.pvNarrow,"height",e);var _=geByClass1("pv_no_commments_placeholder_wrap");if(_&&(isVisible(_.children[0])||isVisible(_.children[1]))){var t=getSize(_)[1],o=getSize("pv_comments_list")[1],a=e-ge("pv_comments").offsetTop-o;setStyle(_,"margin-top",Math.max(0,a/2-t/2))}}_(),clearTimeout(cur.pvRightBlockUpdateTO),cur.pvRightBlockUpdateTO=setTimeout(_)},getReplyAsGroupEl:()=>ge("pv_reply_as_group"),sendComment(e,_){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=cur.pvListId,a=cur.pvIndex,i=cur.pvData[o][a],r=ge("reply_field"+e),l=r&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.data)(r,"composer"),s=(cur.pvReplyNames[(cur.reply_to||{})[0]]||[])[1],n=geByClass1("addpost_button",cur.pvReplyForm),d={},c=t.stickerId;if(c)d={message:"",attach1_type:"sticker",attach1:c,sticker_referrer:t.sticker_referrer};else{if((d=l?Composer.getSendParams(l,Photoview.sendComment.pbind(e)):{message:trim(Emoji.editableVal(r))}).delayed)return;if(!d.attach1_type&&(!d.message||s&&!s.indexOf(d.message)))return void Emoji.editableFocus(r,!1,!0)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("reply_warn"+e);var p=Photoview.getReplyAsGroupEl();ajax.post("al_photos.php",_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.fixPostParams(extend(d,{act:"post_comment",photo:i.id,hash:i.hash,from_group:p&&domData(domClosest("_submit_post_box",ge(p)),"from-oid")<0?1:"",reply_to:(cur.reply_to||{})[1]})),{onDone:(t,s)=>{++i.commcount,Photoview.receiveComms(o,a,t,s,!0),c||(l?Composer.reset(l):Emoji.val(r,"")),r.autosize&&r.autosize.update(),browser.mobile?_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.hideEditReply(e):(Emoji.editableFocus(r,!1,!0),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.cancelReplyTo(e,_)),re("reply_link"+e),_web_page_wall__WEBPACK_IMPORTED_MODULE_20__.default.hideEditPostReply(null,!0),cur.pvNarrowScrollbar&&cur.pvNarrowScrollbar.scrollBottom(),Photoview.updateRightBlock()},showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(n)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(n)}})},highlightComment(e){if(e=ge(e)){var _=getXY(e,!0)[1],t=animate.pbind(e,{backgroundColor:"#ECEFF3"},200,()=>{setTimeout(()=>{animate(e,{backgroundColor:"#FFF"},200,()=>{setStyle(e,{backgroundColor:""})})},1e3)});_<0||_>lastWindowHeight-200?animate(layerWrap,{scrollTop:layerWrap.scrollTop+_-50},300,t):t()}},showComment(e){var _=ge("pv_comment"+e);return _?Photoview.highlightComment(_):Photoview.comments(e),!1},commDone(node,text,del,script){if(node){var fc=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(node),msg=domNS(fc),ph=null!=cur.pvListId&&null!=cur.pvIndex&&cur.pvData[cur.pvListId][cur.pvIndex];if(!text)return show(fc),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(msg),void(ph?(++ph.commcount,++ph.commshown,Photoview.updateComms()):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__.photos.recache(cur.offset,1));if(msg?(msg.innerHTML=text,show(msg)):node.appendChild(ce("div",{innerHTML:text})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(fc),del&&(ph?(--ph.commshown,--ph.commcount,Photoview.updateComms(del)):window.photos&&cur.offset&&_web_photos_photos__WEBPACK_IMPORTED_MODULE_10__.photos.recache(cur.offset,-1)),ph&&(cur.pvCommsLikes[ph.id][0]=ge("pv_comments")),script)try{eval(script)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_14__.logEvalError)(e,script)}}},commProgress(e,_){var t=ge("pv_actions"+e);if(t){var o=t.firstChild.nextSibling;if(!0!==_)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(o),void show(t.firstChild);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(t.firstChild),o||(o=t.appendChild(ce("div",{className:"progress"}))),show(o)}},commParams:(e,_)=>({onDone:Photoview.commDone.pbind(e,_),progress:"pv_progress"+e+_,stat:[jsc("web/privacy.js"),"privacy.css"]}),commAction(e,_,t,o){var a=gpeByClass("reply",_),i=gpeByClass("post_actions",_);hasClass(a,"post_actions_progress")||ajax.post("al_photos.php",{act:e+"_comment",comment:t,hash:o},{onDone:Photoview.commDone.pbind(a),showProgress:addClass.pbind(i,"post_actions_progress"),hideProgress:removeClass.pbind(i,"post_actions_progress")})},_isOverLayer:e=>e.target==layer||e.target==cur.pvCont,_isOverLayerLeft(e){if(Photoview._isOverLayer(e)){var _=getXY(cur.pvBox),t=getSize(cur.pvBox);return e.pageX<_[0]&&e.pageY>_[1]&&e.pageY<_[1]+t[1]}},onLayerMouseMove(e){if(Photoview._isOverLayer(e)){var _=Photoview._isOverLayerLeft(e);toggleClass(layerWrap,"pv_left_panel_over",_),toggleClass(cur.pvNavBtnLeft,"pv_nav_btn_show",_)}else removeClass(layerWrap,"pv_left_panel_over")},onLayerClick(e,_){if(Photoview._isOverLayer(e)&&Photoview._isOverLayerLeft(e))return Photoview.show(!1,cur.pvIndex-1,e);Photoview._doLayerClick(e,_)},_doLayerClick(e,_){if(cur.pvClicked&&!_||__afterFocus||e&&cur.__mdEvent&&e.target!=cur.__mdEvent.target)cur.pvClicked=!1;else if(!e||2!=e.button&&3!=e.which&&!e.pvHandle){e&&(e.pvHandle=!0);var t=e.pageX,o=e.pageY;if(null==t&&null!=e.clientX){var a=document.documentElement,i=bodyNode;t=e.clientX+(a&&a.scrollLeft||i&&i.scrollLeft||0)-(a.clientLeft||0),o=e.clientY+(a&&a.scrollTop||i&&i.scrollTop||0)-(a.clientTop||0)}var r=Math.abs(t-intval(cur.pvOldX)),l=Math.abs(o-intval(cur.pvOldY));(r>3||l>3)&&vkNow()-intval(cur.pvOldT)>300&&(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():cur.pvEditorMode?e.target!=layerWrap&&e.target!=layer||SPE.attemptHide(()=>{Photoview.hide(0)}):Photoview.hide(0))}},onKeyDown(e){if(!1===e.returnValue)return!1;if((!window.SPE||!window.SPE.editor)&&inArray(e.keyCode,[KEY.DOWN,KEY.UP])&&cur.pvNarrowScrollbar&&!hasClass(e.target,"reply_field"))return cur.pvNarrowScrollbar.scrollBy(e.keyCode==KEY.DOWN?70:-70),cancelEvent(e);if(e.keyCode==KEY.ESC&&cur.pvEditing)return Photoview.cancelInline(),cancelEvent(e);e.altKey&&e.keyCode==KEY.RETURN&&Photoview.canFullscreen()&&(cur.pvCanvas?Photoview.fullscreenStop():Photoview.fullscreen()),e.keyCode==KEY.SPACE&&cur.pvCanvas&&(_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.startSlide(),_web_photos_fullscreen_pv__WEBPACK_IMPORTED_MODULE_11__.FullscreenPV.showControls(!0));var _=e.target.contentEditable;return!!(window.Emoji&&Emoji.shown||e.target&&("INPUT"==e.target.tagName||"TEXTAREA"==e.target.tagName||"DIV"==e.target.tagName&&_&&"inherit"!=_))||(e.keyCode==KEY.ESC?(cur.pvCanvas?Photoview.fullscreenStop():cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():e.vkCanceled||curBox()||(cur.pvEditorMode?SPE.attemptHide(()=>{Photoview.hide(0)}):Photoview.hide(0)),cancelEvent(e)):(cur.pvTagger||boxQueue.count()||cur.pvComment&&cur.pvComment.focused||e.ctrlKey||(e.keyCode==KEY.RIGHT?Photoview.show(cur.pvListId,cur.pvIndex+1):e.keyCode==KEY.LEFT&&Photoview.show(cur.pvListId,cur.pvIndex-1)),!cur.pvCanvas&&void 0))},updateVerticalPosition(e){if(cur.pvCont){var _=getSize(cur.pvCont),t=window.clientHeight()/2-_[1]/2-intval(e);setStyle(layer,"margin-top",Math.round(t))}},calculateVeryBig(){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0);cur.pvVeryBig=e>1800?3:e>1200?2:e>800&&1,window.devicePixelRatio>1&&(cur.pvVeryBig+=1,cur.pvVeryBig=Math.min(3,cur.pvVeryBig))},updateNavBtnsLeftThreshold(e){var _=getSize(cur.pvImageWrap)[0],t=getXY(cur.pvImageWrap)[0];cur.pvLeftBtnAmount&&!e||(cur.pvLeftBtnAmount=t+Photoview.LEFT_RIGHT_NAV_RATIO*_)},updatePhotoDimensions(e){if(!Photoview.isPhotosList()&&!cur.pvEditorModeDimensionsUpdated){var _=Photoview.MIN_WIDTH,t=Photoview.MIN_HEIGHT;cur.pvEditorMode&&(_=Photoview.PE_MIN_WIDTH,t=Photoview.PE_MIN_HEIGHT,cur.pvEditorModeDimensionsUpdated=!0),removeClass(cur.pvBottomInfo,"pv_with_line_break");var o=isVisible(cur.pvTagInfo),a=o?getSize(cur.pvTagInfo)[1]:0,i=Math.max(document.documentElement.clientWidth,window.innerWidth||0),r=Math.max(document.documentElement.clientHeight,window.innerHeight||0),l=getSize(cur.pvBottomInfo)[1],s=Math.max(_,i-Photoview.SIDE_COLUMN_WIDTH-2*Photoview.SIDE_MIN_GAP),n=Math.max(t,r-l-2*Photoview.VERTICAL_MIN_GAP-a);Photoview.calculateVeryBig();var d=clone(cur.pvCurData||{width:_,height:t});d.width=d.width||_,d.height=d.height||t;var c=d.width/d.height,p=Math.min(s,d.width),u=p/c;u=Math.min(n,u),p=Math.ceil(u*c);var b=getXY(cur.pvBottomLeft)[0]+getSize(cur.pvBottomLeft)[0]>getXY(cur.pvBottomActions)[0]-20;toggleClass(cur.pvBottomInfo,"pv_with_line_break",b),e&&(cur.prevPhotoWidth=cur.prevPhotoHeight=0);var h=cur.prevPhotoWidth=Math.max(p,_,cur.prevPhotoWidth||0),m=cur.prevPhotoHeight=Math.max(u,t,(cur.prevPhotoHeight||0)-a),v=Math.max(0,m/2-u/2);if(v>0&&!o){var g=(getSize(cur.pvPhoto)[1]+l)/2-u/2;g>l&&(v=g)}cur.pvAttachedProducts.photoSize={width:p,height:u,top:v},setStyle(cur.pvPhoto,{width:h,height:m}),setStyle(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(cur.pvPhoto),{width:p,height:u,marginTop:v}),setStyle(cur.pvTagInfo,{width:h}),cur.pvTagFrame&&Photoview.updateTagFrameDimensions(p,u,v),cur.pvPhotoTagsContainer&&Photoview.updatePhotoTagsContainerDimensions(p),setStyle(cur.pvImgProgress,"marginTop",v+u/2);var E=(cur.pvIsLightMode?0:Photoview.SIDE_COLUMN_WIDTH)+h;setStyle(cur.pvCont,{width:E,paddingLeft:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.sbWidth)()}),Photoview.updateRightBlock(),Photoview.updateVerticalPosition(),cur.pvPhWidth=p,cur.pvPhHeight=u,Photoview.updateNavBtnsLeftThreshold();var w=getXY(cur.pvCont),O=getSize(cur.pvCont),P=w[1]+O[1],D=i-(w[0]+O[0])<85||r-P<60;Photoview.toggleFastChats(!D)}},toggleFastChats(e){toggleClass("chat_onl_wrap","hidden",!e),each(geByClass("rb_box_wrap"),()=>{toggleClass(this,"hidden",!e)})},onResize(){if(cur.pvCanvas){var e=cur.pvVeryBig,_=cur.pvCanvas.offsetWidth,t=cur.pvCanvas.offsetHeight;return cur.pvVeryBig=_>1280||t>1280?2:(_>807||t>807)&&1,void(e!=cur.pvVeryBig&&setTimeout(Photoview.preload.pbind(cur.pvIndex,cur.pvLastDirection||1),10))}if(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown?setStyle(cur.pvCont,"width",800):Photoview.updatePhotoDimensions(!0),cur.pvPhoto){if(browser.mozilla&&cur.pvPhoto.firstChild){var o=cur.pvPhoto.firstChild.offsetLeft,a=(lastWindowWidth-cur.pvActualWidth)%2&&(cur.pvActualWidth-cur.pvPhWidth)%2?4:3;setStyle(cur.pvTagFrame,{left:o-a+"px"})}Photoview.scrollResize(),Photoview.stopTagger()}},stopTagger(){cur.pvTagger&&_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag()},updateSize(){cur.pvBox&&toggleClass(cur.pvBox,"photos_is_albums_view",!!cur.pvAlbumsShown||!!cur.pvAlbumShown),onBodyResize(),Photoview.onResize()},activate(e){e&&e.timeout?(clearTimeout(e.timeout),removeAttr(e,"timeout")):isVisible(e)&&fadeTo(e,200,vk.pvdark?1:.7)},deactivate(e){e&&isVisible(e)&&!e.timeout&&(e.timeout=setTimeout(()=>{removeAttr(e,"timeout"),fadeTo(e,200,.4)},1))},deletePhoto(e){var _=cur.pvListId,t=cur.pvIndex,o=cur.pvData[_][t],a=curBox();if(cur.deletionProgress=cur.deletionProgress||{},!cur.deletionProgress[o.id])if(cur.deletionProgress[o.id]=!0,cur.pvTagger)Photoview.stopTagger();else{cur.pvPhotoTags&&cur.pvPhotoTags.hideAreas();var i={act:"delete_photo",photo:o.id,hash:o.hash,set_prev:isChecked("pvb_prev_check"),sure:intval(e)};Object(_internal_nospam_common__WEBPACK_IMPORTED_MODULE_21__.isClaimContent)()&&(i._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_photos.php",i,{onDone:(e,i)=>{if(cur.deletionProgress[o.id]=!1,a)return a.hide(),nav.go("/id0",!1,{nocur:!0});_==cur.pvListId&&t==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(i||getLang("photo_deleted"),e),o.deleted=[cur.pvTagInfoText.innerHTML,cur.pvTagInfoButtons.innerHTML],Photoview.toggleDeletedState(!0),Photoview.updatePhotoDimensions())}})}},restorePhoto(e){var _=cur.pvListId,t=cur.pvIndex,o=cur.pvData[_][t];Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)||ajax.post("al_photos.php",{act:"restore_photo",photo:o.id,hash:o.hash},{onDone:e=>{o.deleted=!1,_==cur.pvListId&&t==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(!1),Photoview.toggleDeletedState(!1),Photoview.updatePhotoDimensions()),cur.pvPhotoTags&&cur.pvPhotoTags.showAreas()},onFail:e=>(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),e),!0),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton.pbind(e)})},spamPhoto(e,_){var t=cur.pvListId,o=cur.pvIndex,a=cur.pvData[t][o];Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(_)||(cur.pvTagger?_web_photos_photo_tagger_mode__WEBPACK_IMPORTED_MODULE_12__.Phototag.stopTag():ajax.post("al_photos.php",{act:"spam_photo",photo:a.id,hash:a.hash,spam_hash:e,pv:1},{onDone:(e,_)=>{_&&(a.deleted=e),t==cur.pvListId&&o==cur.pvIndex&&(cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photo_marked_as_spam_restore"),e),_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvCommentsData))},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton.pbind(_),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton.pbind(_)}))},rotatePhoto(e){var _=ge("pv_rotate_progress");if(!isVisible(_)){Photoview.stopTagger(),show(_),ge("pv_rotate").appendChild(ce("div",{id:"pv_rotate_frame",className:"upload_frame",innerHTML:'<iframe name="pv_rotate_frame"></iframe>'}));var t=cur.pvListId,o=cur.pvIndex,a=cur.pvData[t][o],i=ge("pv_rotate_form");i.innerHTML="",i.action=a.rotate[0];var r=extend({act:"do_rotate",to:e,list_id:t,index:o,fid:a.id},a.rotate);if(e=(e+4)%4,"rotate_photo"==r.act&&(r.angle=(r.angle+e)%4),r["rot"+e])return r.act="done_rotate",r.complete=1,void ajax.post("/al_photos.php",r,{onDone:Photoview.rotateDone,onFail:()=>{Photoview.rotateDone()}});for(var l in r)0!=l&&i.appendChild(ce("input",{type:"hidden",name:l,value:r[l]}));i.submit()}},rotateDone(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("pv_rotate_progress");var _=ge("pv_rotate_frame");if(_&&(re(_),e)){var t=e.list_id,o=e.index,a=cur.pvData[t][o];extend(a,{x_src:e.x_src,y_src:e.y_src,z_src:e.z_src,w_src:e.w_src,base:e.base,x_:e.x_,y_:e.y_,z_:e.z_,w_:e.w_,x:0,y:0,z:0,w:0,tags:e.tags,tagged:e.tagged,suggested_tags:e.suggested_tags,tagshtml:e.html}),extend(a.rotate,{photo:e.photo,hash:e.hash,rhash:e.rhash,angle:e.angle,rot1:e.rot1,rot3:e.rot3}),t==cur.pvListId&&o==cur.pvIndex&&Photoview.show(t,o),cur.pvPhotoTags&&cur.pvPhotoTags.reload()}},likeUpdate(e,_,t){_=intval(_);var o=ge("pv_like"),a=domByClass(o,"_count");if(a){var i=o.tt||{},r=clone(i.opts||{}),l=domByClass(i.container,"_value"),s=domByClass(i.container,"_content"),n=domByClass(i.container,"_title");t&&n&&val(n,t),i&&(i.likeInvalidated=!0),l&&(l.value=_),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_25__.animateCount)(a,_),toggleClass(o,"pv_liked",e),toggleClass(o,"no_likes",!_),toggleClass(s,"me_hidden",!e),_?!i.el||isVisible(i.container)||t||tooltips.show(i.el,extend(r,{showdt:0})):i.el&&i.hide()}},tagOver(e){animate(e,{backgroundColor:"#6B8DB1"},200),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e,{text:getLang("photos_delete_tag"),shift:[0,-2,0]})},tagOut(e){e.parentNode&&e.parentNode.parentNode&&animate(e,{backgroundColor:"#C4D2E1"},200)},deleteTag(e,_){var t=cur.pvListId,o=cur.pvIndex,a=cur.pvData[t][o];if(a.tagid){if(isVisible("pv_tag_handling"))return}else if(ge("pv_action_progress"))return;var i=_?1:0;ajax.post("al_photos.php",{act:"delete_tag",photo:a.id,tag:e,hash:a.hash,top_panel:i},{onDone:(_,i,r,l)=>{a.tagid?(a.taginfo=a.tagid=!1,cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(getLang("photos_tag_deleted"),_),addClass(cur.pvTagInfoButtons,"no_events"),setTimeout(()=>{removeClass(cur.pvTagInfoButtons,"no_events")},1e3)):Photoview.actionInfo().innerHTML=_,void 0!==i&&(a.tags=i,a.tagged=r,a.tagshtml=l,cur.pvListId==t&&cur.pvIndex==o&&(Photoview.setTags(l),(!a.taginfo&&a.actions.tag&&i[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink))),cur.pvPhotoTags&&cur.pvPhotoTags.deleteTag(e)},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function _(){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}(()=>{if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(_),a.tagid);else{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)}}),hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(_),a.tagid||re(Photoview.actionInfo())}})},restoreTag(e){if(!ge("pv_action_progress")){var _=cur.pvListId,t=cur.pvIndex,o=cur.pvData[_][t];ajax.post("al_photos.php",{act:"restore_tag",photo:o.id,tag:e,hash:o.hash},{onDone:(e,a,i,r)=>{void 0!==a&&(o.tags=a,o.tagged=i,o.tagshtml=r,cur.pvListId==_&&cur.pvIndex==t&&(Photoview.setTags(r),(!o.taginfo&&o.actions.tag&&a[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink)),cur.pvPhotoTags&&cur.pvPhotoTags.renderTagAreas()),Photoview.actionInfo().innerHTML=e},onFail:e=>{if(e)return Photoview.actionInfo().innerHTML=e,!0},showProgress:function(e){function _(){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}(()=>{var e=Photoview.actionInfo();e.innerHTML="",showProgress(e)}),hideProgress:()=>{re(Photoview.actionInfo())}})}},confirmTag(e,_){var t=cur.pvListId,o=cur.pvIndex,a=cur.pvData[t][o];isVisible("pv_tag_handling")||ajax.post("al_photos.php",{act:"confirm_tag",tag:e,photo:a.id,hash:a.hash},{onDone:(e,_,i)=>{a.tags=e,a.tagged=_,a.tagshtml=i,a.taginfo=a.tagid=!1,t==cur.pvListId&&o==cur.pvIndex&&(Photoview.setTags(i),(!a.taginfo&&a.actions.tag&&e[0]<cur.pvMaxTags?show:_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(cur.pvTagLink),cleanElems("pv_confirm_tag","pv_delete_tag","pv_prof_cancel","pv_prof_done"),Photoview.toggleTopInfoPanel(!1))},showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(_)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(_)}})},toProfileTag(){var e=cur.pvData[cur.pvListId][cur.pvIndex].tagged[vk.id];e&&!cur.pvTagger&&Photoview.showTag(e)},showTag(e){cur.pvPhotoTags&&cur.pvPhotoTags.showTagArea(e)},showDynTag(e){if(clearTimeout(cur.pvHidingTag),cur.pvShowingTag!=e){var _=clone(cur.pvData[cur.pvListId][cur.pvIndex].tags[e]),t=ge("pv_tag"+e);if(t){each(_,(e,t)=>{_[e]=positive(t*cur[e%2?"pvPhHeight":"pvPhWidth"]/100)});var o=0;isVisible(cur.pvTagInfo)&&(o=getSize(cur.pvTagInfo)[1]),setStyle(cur.pvTagPerson,{marginLeft:_[0]+"px",marginTop:o+_[3]+"px",minWidth:_[2]-_[0]+"px"}),cur.pvTagPerson.innerHTML=t.firstChild.innerHTML;var a=getSize(cur.pvTagPerson);_[3]+a[1]>cur.pvPhHeight&&setStyle(cur.pvTagPerson,{marginTop:cur.pvPhHeight-a[1]+"px"}),cur.pvTagPerson.onmouseover=Photoview.showDynTag.pbind(e),cur.pvShowingTag=e,browser.msie?show(cur.pvTagPerson):fadeIn(cur.pvTagPerson,200)}}},hideTag(){cur.pvPhotoTags&&cur.pvPhotoTags.hideTagArea()},realOffset(e,_,t){var o=_;if(!cur.pvData||!cur.pvData[e])return o;for(var a=0;a<_;a++)cur.pvData[e][a]&&(cur.pvData[e][a].deleted||cur.pvData[e][a].moved)&&(o+=t);return o},realCount(e,_){var t=_;if(!cur.pvData||!cur.pvData[e])return t;for(var o=0;o<cur.pvData[e].length;o++)cur.pvData[e][o]&&(cur.pvData[e][o].deleted||cur.pvData[e][o].moved)&&t++;return t},list(e,_,t){"deleted"!=t&&(cur.pvList||(cur.pvList={}),cur.pvList[e+"_"+_]=t)},loaded(e,_,t,o,a){if("deleted"!=e){if(a&&(extend(cur,{lang:extend(cur.lang||{},a.lang),pvHash:a.hash,pvCommLimit:a.commlimit,pvCaptionLimit:a.captionlimit,pvMaxTags:a.maxtags,pvReasons:a.reasons,pvReplyNames:extend(cur.pvReplyNames||{},a.names||{}),pvAskForAutoTag:a.ask_for_autotag,pvTagsQueueParams:a.qparams}),window.pvcur=extend(window.pvcur||{},{wallTpl:a.wallTpl,rmedia_types:a.rmedia_types}),cur.wallTpl=cur.wallTpl||a.wallTpl,cur.options||(cur.options={}),cur.options.share||(cur.options.share=a.share),val(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.domFC)(ge("pv_add_media")),getLang("global_add_media"))),_=Photoview.realCount(e,_),t=Photoview.realOffset(e,t,1),cur.pvData||(cur.pvData={}),cur.pvCommsLikes||(cur.pvCommsLikes={}),cur.pvData[e])if(cur.pvData[e].length<_)for(var i=cur.pvData[e].length;i<_;++i)cur.pvData[e].push(void 0);else cur.pvData[e].length>_&&(cur.pvData[e]=cur.pvData[e].slice(0,_));else cur.pvData[e]=new Array(_);for(var r=0,l=o.length;r<l;++r){for(var s=clone(o[r]),n=t+r;n>=_;)n-=_;cur.pvCommsLikes[s.id]=[s.comments,s.likes,vkNow(),!1],delete s.comments,delete s.likes,cur.pvData[e][n]=s}}},showDeleted(e,_,t){cur.pvShown&&"temp"==cur.pvListId&&(_+="<br><br>"+t),Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)({title:getLang("global_error"),onHide:()=>{cur.pvShown&&"temp"==cur.pvListId&&Photoview.hide(!0)}},_)},spamDeleted(e,_,t){isVisible(curBox().progress)||ajax.post("al_photos.php",{act:"spam_photo",photo:_,hash:t,from:"deleted"},{onDone:_=>{domPN(e).replaceChild(ce("span",{innerHTML:_}),e)},showProgress:curBox().showProgress,hideProgress:curBox().hideProgress})},showPhoto(e,_,t,o){if(cur.pvShown&&("temp"!=cur.pvListId||cur.pvWasShown)&&void 0===t.noHistory||(debugLog("in showPhoto noHistory: "+t.noHistory),cur.pvNoHistory=t.noHistory,cur.pvHistoryLength=t.noHistory?0:t.histLen||0),extend(cur,{pvJumpTo:t.jumpTo||!1,pvJumpFrom:!1,pvJumpSteps:0}),_=cur.pvList&&cur.pvList[e+"_"+_]||_,cur.pvData&&cur.pvData[_]){var a=cur.pvData[_],i=cur.pvOptions&&cur.pvOptions.onHide,r=!0;cur.pvOptions=t,cur.pvOptions.onHide||(cur.pvOptions.onHide=i);for(var l=0,s=a.length;l<s;++l)if(a[l]){if(a[l].id===e)return Photoview.show(_,l,!1,t.root),t.onShow&&t.onShow(),!1}else r=!1;return r&&o?(t.onEmpty&&t.onEmpty(),!1):void 0}},loadedAlbums(e,_,t,o){cur.pvAlbumsData&&(ajax.preload("al_photos.php",extend({offset:o.offset,part:1,owner:e},{act:"show_albums"}),t),cur.curYear=o.cur_year,cur.pvAlbumsData[e]={html:_,opts:o},cur.pvAlbumsShowing==e&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)))},showAlbums(e,_){e=intval(e),cur.pvAlbumsData||(cur.pvAlbumsData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=_.noHistory,cur.pvHistoryLength=0,cur.pvAlbumsShowing=e;var t=_.onFail;cur.pvAlbumsData[e]?"loading"!=cur.pvAlbumsData[e]&&(Photoview.doShowAlbums(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumsData[e]="loading",ajax.post("al_photos.php",{act:"show_albums",owner:e},extend(_,{onDone:Photoview.loadedAlbums,onFail:_=>(t&&t(_),delete cur.pvAlbumsData[e],cur.pvAlbumsData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedAlbum(e,_,t,o){cur.pvAlbumData&&(t&&ajax.preload("al_photos.php",extend({offset:o.offset,part:1,album:e},{act:"show_album"}),t),cur.pvAlbumData[e]={html:_,opts:o},cur.pvAlbumShowing==e&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)))},showAlbum(e,_){cur.pvAlbumData||(cur.pvAlbumData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=_.noHistory,cur.pvHistoryLength=0,cur.pvAlbumShowing=e;var t=_.onFail;cur.pvAlbumData[e]?"loading"!=cur.pvAlbumData[e]&&(Photoview.doShowAlbum(e,!1),boxRefreshCoords(layer)):(cur.pvAlbumData[e]="loading",ajax.post("al_photos.php",{act:"show_album",album:e},extend(_,{onDone:Photoview.loadedAlbum,onFail:_=>(t&&t(_),delete cur.pvAlbumData[e],cur.pvAlbumData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},loadedTagged(e,_,t){cur.pvPhotoTagData&&(cur.pvPhotoTagData[e]={html:_,opts:t},cur.pvPhotoTagShowing==e&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)))},showTagged(e,_){e=intval(e),cur.pvPhotoTagData||(cur.pvPhotoTagData={}),"temp"==cur.pvListId&&cur.pvCancelLoad(),cur.pvNoHistory=_.noHistory,cur.pvHistoryLength=0,cur.pvPhotoTagShowing=e;var t=_.onFail;cur.pvPhotoTagData[e]?"loading"!=cur.pvPhotoTagData[e]&&(Photoview.doShowTagged(e,!1),boxRefreshCoords(layer)):(cur.pvPhotoTagData[e]="loading",ajax.post("al_photos.php",{act:"show_tag",mid:e},extend(_,{onDone:Photoview.loadedTagged,onFail:_=>(t&&t(_),delete cur.pvPhotoTagData[e],cur.pvPhotoTagData[e],layers.fullhide&&layers.fullhide(!0),!0)})))},updatePeriods(){Photoview.periods=geByClass("photos_period_delimiter")},destroyPeriod(){Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)},fixPeriod(){if(Photoview.periods&&Photoview.periods.length){var e=scrollGetY(),_=getSize(Photoview.periods[0])[1],t=!1,o=!1;for(var a in Photoview.periods)if(Photoview.periods.hasOwnProperty(a)){if(getXY(Photoview.periods[a])[1]>=e)break;t=Photoview.periods[a];var i=intval(a)+1;o=!!Photoview.periods[i]&&getXY(Photoview.periods[i])[1]-e}if(t){t==Photoview.fixedPeriodEl||(Photoview.fixedPeriod?Photoview.fixedPeriod.innerHTML=t.innerHTML:(Photoview.fixedPeriod=ce("div",{innerHTML:t.innerHTML,className:"pva_period_fixed"},{left:getXY(t)[0]+"px"}),utils.appendChild(Photoview.fixedPeriod)),Photoview.fixedPeriodEl=t);var r=!1!==o?o-_:0;r>=0&&(r=0),Photoview.fixedPeriodTop!==r&&(setStyle(Photoview.fixedPeriod,{top:r+"px"}),Photoview.fixedPeriodTop=r)}else!t&&Photoview.fixedPeriod&&(re(Photoview.fixedPeriod),Photoview.fixedPeriod=!1,Photoview.fixedPeriodEl=!1)}},scrollResize(){if(!browser.mobile&&cur.pvShown&&(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown||cur.pvVideoTagsShown)){var e=ge("ui_pv_photos_load_more"),_=ge("ui_pva_more_load_more"),t=3*lastWindowHeight;isVisible(e)&&t>getXY(e)[1]-(browser.msie6?0:scrollGetY())&&(cur.pvVideoTagsShown?Photoview.loadVideoTags():cur.pvPhotoTagShown?Photoview.loadTaggedPhotos():cur.pvAlbumsShown?Photoview.loadAlbumsPhotos():Photoview.loadAlbumPhotos()),cur.pvAlbumsShowing&&Photoview.fixPeriod(),cur.pvAlbumsShown&&cur.pvShowAllAlbums&&isVisible(_)&&t>getXY(_)[1]-(browser.msie6?0:scrollGetY())&&Photoview.loadAlbums()}},loadAlbums(){cur.pvShowAllAlbums=!0,Photoview.loadAlbumsPhotos(!0)},loadedAlbumsPhotos(e,_,t,o){if(cur.pvaLoading=0,cur.pvAlbumsShown){t?cur.pvaOffset=e:cur.pvaPhotosOffset=e,o&&(cur.curYear=o);var a=t?ge("pva_content"):ge("pva_content_photos"),i=t?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),r=t?{act:"show_albums"}:{act:"show_albums",only_photos:1,cur_year:cur.curYear},l=t?cur.pvaOffset:cur.pvaPhotosOffset,s=t?cur.pvaCount:cur.pvaPhotosCount;if(a){for(var n=ce("div",{innerHTML:_});n.firstChild;){if(hasClass(n.firstChild,"photos_period_delimiter")){var d=domData(n.firstChild,"year");if(geByClass1("photos_period_delimiter_"+d)){re(n.firstChild);continue}}a.appendChild(n.firstChild)}Photoview.onResize(),Photoview.updatePeriods(),e>=s||!_?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(i):t&&(cur.pvaLoading=1,ajax.post("al_photos.php",extend({offset:l,part:1,owner:cur.pvAlbumsShown},r||{}),{onDone(){debugLog("preload done: "+cur.pvaLoading),2==cur.pvaLoading?Photoview.loadedAlbumsPhotos.apply(window,arguments):cur.pvaLoading=!1},onFail:()=>(cur.pvaLoading=0,!0)}))}}},loadAlbumsPhotos(e){var _=e?ge("ui_pva_more_load_more"):ge("ui_pv_photos_load_more"),t=e?{act:"show_albums"}:{act:"show_albums",only_photos:1},o=e?cur.pvaOffset:cur.pvaPhotosOffset;cur.pvAlbumsShown&&_&&isVisible(_)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(_)&&(cur.pvaLoading?cur.pvaLoading=2:ajax.post("al_photos.php",extend({offset:o,part:1,owner:cur.pvAlbumsShown},t||{}),{cache:t.only_photos?0:1,onDone:Photoview.loadedAlbumsPhotos,onFail:()=>(cur.pvaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(_)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(_)}}))},loadedAlbumPhotos(e,_){if(cur.pvaLoading=0,cur.pvAlbumShown){cur.pvsaOffset=e;var t=ge("pvsa_content_photos"),o=ge("ui_pv_photos_load_more");if(t){if(t.appendChild(cf(_)),!cur.pvAlbumData[cur.pvAlbumShown].opts.no_known_count&&e>=cur.pvsaCount||!_)return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(o),void Photoview.onResize();setTimeout(()=>{Photoview.onResize()},10),cur.pvsaLoading=1,ajax.post("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},{onDone(){2==cur.pvsaLoading?Photoview.loadedAlbumPhotos.apply(window,arguments):(cur.pvsaLoading=!1,ajax.preload("al_photos.php",{offset:cur.pvsaOffset,part:1,album:cur.pvAlbumShown,act:"show_album"},arguments))},onFail:()=>(cur.pvsaLoading=0,!0)})}}},loadAlbumPhotos(){var e=ge("ui_pv_photos_load_more"),_=cur.pvsaOffset;cur.pvAlbumShown&&e&&isVisible(e)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_album",album:cur.pvAlbumShown,offset:_,part:1},{onDone:Photoview.loadedAlbumPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(e)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(e)},cache:!0}))},loadedTaggedPhotos(e,_){if(cur.pvaLoading=0,cur.pvPhotoTagShown){cur.pvsaOffset=e;var t=ge("pvsa_content_photos"),o=ge("ui_pv_photos_load_more");t&&(t.appendChild(cf(_)),Photoview.onResize(),e>=cur.pvsaCount||!_?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)(o):(cur.pvsaLoading=1,ajax.post("al_photos.php",extend({offset:cur.pvsaOffset,part:1,mid:cur.pvPhotoTagShown},{act:"show_tag"}),{onDone(){debugLog("preload done: ",cur.pvsaLoading),2==cur.pvsaLoading?Photoview.loadedTaggedPhotos.apply(window,arguments):cur.pvsaLoading=!1},onFail:()=>(cur.pvsaLoading=0,!0)})))}},loadTaggedPhotos(){var e=ge("ui_pv_photos_load_more"),_=cur.pvsaOffset;cur.pvPhotoTagShown&&e&&isVisible(e)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.isButtonLocked)(e)&&(cur.pvsaLoading?cur.pvsaLoading=2:ajax.post("al_photos.php",{act:"show_tag",mid:cur.pvPhotoTagShown,offset:_,part:1},{onDone:Photoview.loadedTaggedPhotos,onFail:()=>(cur.pvsaLoading=0,!0),showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.lockButton)(e)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_22__.unlockButton)(e)},cache:1}))},thumbOver(e,_){clearTimeout((cur.pvHideTO||{})[_]);var t=geByClass1("pva_title",e),o=t.previousSibling,a=getSize(geByClass1("pva_desc",e))[1];a<5||(animate(t,{marginTop:146-(a+7)},{duration:200,transition:Fx.Transitions.easeOutCirc}),"pva_repeat"==o.className&&animate(o,{marginTop:43-Math.floor((a+7)/2)},{duration:200,transition:Fx.Transitions.easeOutCirc}))},thumbOut(e,_){cur.pvHideTO||(cur.pvHideTO={}),cur.pvHideTO[_]=setTimeout(()=>{var _=geByClass1("pva_title",e),t=_.previousSibling;animate(_,{marginTop:146},200),"pva_repeat"==t.className&&animate(t,{marginTop:43},200)},150)},fsMove(e){if(!(cur.pvAlbumsShown||cur.pvAlbumShown||cur.pvPhotoTagShown)&&cur.pvCurPhoto.author){var _=getXY(cur.pvActions),t=getSize(cur.pvActions),o=Math.max(100,.2*cur.pvPhWidth);e.pageX>_[0]-o&&e.pageX<_[0]+t[0]+o&&e.pageY>_[1]-o&&e.pageY<_[1]+t[1]+o?addClass(cur.pvActions,"visible"):removeClass(cur.pvActions,"visible")}},showRepeat(e){if(e&&!geByClass1("pva_repeat",e)){var _=stManager._srcPrefix(".css")+"/images/icons/post_hh"+(window.devicePixelRatio>=2?"_2x":""),t=getLang("photos_repeat_album");geByClass1("pva_link",e).insertBefore(ce("div",{className:"pva_repeat",innerHTML:`\n        <div class="pva_repeat_blob">\n         <div class="pva_repeat_cont">\n         <img class="pva_repeat_img png" src="${_}.png?3" />\n         <span class="pva_repeat_text">${t}</span></div>\n        </div>`}),geByClass1("pva_title",e))}},showPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",geohash:e,photo:cur.pvCurPhoto.id},{cache:1})},editPlace(){var e=cur.pvCurPhoto.geohash;showBox("al_places.php",{act:"show_photo_place",edit:1,geohash:e||"",photo:cur.pvCurPhoto.id})},updatePlace(e,_){var t=ge("pv_edit_place");_?(t&&(t.innerHTML=_?_+".":""),ge("pv_place").innerHTML=_?'<span class="pv_place_label"></span> <a class="pv_place_a" id="pv_place_a" onclick="Photoview.showPlace()">'+_+"</a>":"",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_16__.hide)("pv_add_place")):setTimeout(()=>{ajax.post("al_photos.php",{act:"get_photo_place",photo:e},{onDone:_=>{Photoview.updatePlace(e,_)}})},1e3)},reportComment(e,_,t){stManager.add([jsc("web/privacy.js"),"privacy.css"],()=>Privacy.show(e,_,"report_"+t))},selectProductInBox:function(){var e=cur.pvData[cur.pvListId][cur.pvIndex].attached_tags,_=(e.tags?e.tags.length:0)>=e.max_tags_per_object;if(e.tags&&_)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_23__.showFastBox)(getLang("global_error"),getLang("market_attach_products_overflow",e.max_tags_per_object)),!1;Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_15__.showAttachProductBox)(event,Photoview.attachProduct)},attachProduct:function(e){curBox().hide(),Photoview.toggleTopInfoPanel(`<span class="attach_market_title">${getLang("market_product_attach_photo")} "${e.title}</span>`,`<button id="attach_market_cancel" class="flat_button secondary_dark black">${getLang("groups_cancel2")}</button>\n      <button id="attach_market_save" class="flat_button" disabled>${getLang("Save")}</button>`);var _=()=>{Photoview.toggleTopInfoPanel();var e=cur.pvAttachedProducts;e.point&&e.point.remove(),cur.pvAttachedProducts.isProcess=!1};cur.pvAttachedProducts.isProcess=!0,document.getElementById("attach_market_cancel").addEventListener("click",_),document.getElementById("attach_market_save").addEventListener("click",(function(){_();var t,o=cur.pvAttachedProducts;if(Object.assign(e,o.tempTag),!o.tempTag)return!1;if(document.getElementById("MarketList")){var a=_slicedToArray(Photoview.generateMarketListItem(e),2),i=a[0],r=a[1];t=i,document.getElementById("MarketList").appendChild(i),cur.pvImageAreaWrap.appendChild(r)}else{var l=_slicedToArray(Photoview.generateMarketList([e],!0),3),s=l[0],n=l[1],d=l[2];t=d,cur.pvImageAreaWrap.appendChild(n),document.getElementById("pv_attached_products_list").appendChild(s)}var c=cur.pvData[cur.pvListId][cur.pvIndex],p="link"===e.type?e.url:e.url.match(/product-?\d+_\d+/)[0],u=_slicedToArray(c.id.split("_"),2),b=u[0],h=u[1];e.x=o.tempTag.x,e.y=o.tempTag.y,ajax.post("al_market.php",{act:"add_tag_content_product",owner_id:b,item_id:h,type:"photo",hash:c.attached_tags.hash,tag_object:p,x:o.tempTag.x,y:o.tempTag.y},{onDone:_=>{t.id=_,c.attached_tags.tags=c.attached_tags.tags||[],e.tag_id=_,c.attached_tags.tags.push(e)}})}))},attachProductPoint:function(e){var _=document.getElementById("pv_product_point");_||((_=document.createElement("div")).classList.add("attach_market_point"),_.id="pv_product_point");var t=cur.pvImageAreaWrap,o=cur.pvAttachedProducts;o.tempTag=o.tempTag||{},document.getElementById("attach_market_save").removeAttribute("disabled");var a=e.currentTarget.getBoundingClientRect(),i=cur.pvAttachedProducts.photoSize,r=e.clientX-a.left-(a.width-i.width)/2,l=e.clientY-a.top-(a.height-i.height)/2;r>0&&l>0&&r<i.width&&l<i.height&&(document.getElementById("pv_product_point")||t.appendChild(_),o.tempTag.y=(e.clientY-a.top-i.top)/i.height,o.tempTag.x=(e.clientX-a.left-(a.width-i.width)/2)/i.width,_.style.top=e.clientY-a.top+"px",_.style.left=e.clientX-a.left+"px"),o.point=_},generateMarketList:function(e){var _=document.createElement("span");_.innerHTML=getLang("photos_attached_goods"),_.classList.add("pv_photo_product_attach_label");var t,o=document.createElement("ul");o.id="MarketList",o.classList.add("AttachedProductsList");var a=document.createDocumentFragment(),i=document.createDocumentFragment();e&&e.forEach((function(_){var o=Photoview.generateMarketListItem(_);1===e.length&&(t=o[0]),a.appendChild(o[0]),i.appendChild(o[1])})),o.appendChild(a);var r=document.createElement("div");return r.appendChild(_),r.appendChild(o),[r,i,t]},generateMarketListItem:function(e){var _=document.createElement("li");_.id=e.tag_id,_.classList.add("AttachedProductsList__item");var t=document.createElement("a");t.href=e.url,t.setAttribute("target","_blank");var o=_=>{Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_17__.checkEvent)(event)||(layerQueue.push(),cancelEvent(_),showWiki({w:e.url.match(/product-?\d+_\d+/)[0]},!1,event))};"link"!==e.type&&t.addEventListener("click",o),t.classList.add("AttachedProductsList__content");var a=document.createElement("div");a.classList.add("AttachedProductsList__img"),a.style.backgroundImage="url("+(e.thumb||"/images/market/attach_product_list_placeholder.png")+")",t.appendChild(a);var i=document.createElement("span");i.classList.add("AttachedProductsList__title"),i.innerHTML=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.unclean)(e.title)),t.appendChild(i);var r=document.createElement("span");r.classList.add("AttachedProductsList__price"),r.innerHTML=e.price,t.appendChild(r),_.appendChild(t);var l=cur.pvData[cur.pvListId][cur.pvIndex],s=document.createElement("button");l.attached_tags&&l.attached_tags.hash&&(s.classList.add("AttachedProductsList__cross"),_.appendChild(s));var n=document.createElement("a");n.href=e.url,n.setAttribute("target","_blank"),"link"!==e.type&&n.addEventListener("click",o),n.classList.add("pv_attach_product_badge"),n.innerHTML=`<span class="pv_attach_product_badge_title">${Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_18__.unclean)(e.title))}</span>\n      <span class="pv_attach_product_badge_price">${e.price}</span>`;var d=cur.pvImageAreaWrap.getBoundingClientRect(),c=cur.pvAttachedProducts.photoSize;n.style.top=`calc(${Math.floor(e.y*c.height)}px + ${(d.height-c.height)/2}px)`,n.style.left=`calc(${Math.floor(e.x*c.width)}px + ${(d.width-c.width)/2}px)`,n.style.opacity="1";var p=_slicedToArray(l.id.split("_"),2),u=p[0],b=p[1];return l.attached_tags&&l.attached_tags.hash&&s.addEventListener("click",e=>{ajax.post("al_market.php",{act:"delete_tag_content_product",owner_id:u,item_id:b,type:"photo",access_key:cur.pvCurPhoto.hash,hash:l.attached_tags.hash,tag_id:e.target.parentElement.id});var _=cur.pvData[cur.pvListId][cur.pvIndex];return _.attached_tags.tags=_.attached_tags.tags.filter(_=>_.tag_id!=e.target.parentElement.id),n.remove(),document.getElementById("MarketList").childElementCount>1?e.target.parentElement.outerHTML="":document.getElementById("pv_attached_products_list").innerHTML="",cancelEvent(e)}),s.addEventListener("mouseover",e=>{Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_24__.showTooltip)(e.target,{text:getLang("photos_pv_act_delete"),black:1,center:!0,shift:[0,3]})}),_.addEventListener("mouseover",(function(){n.style.opacity="1"})),_.addEventListener("mouseout",(function(e){if(_.contains(e.relatedTarget))return!1;n.style.opacity="0"})),cur.pvImageAreaWrap.addEventListener("mouseover",(function(){cur.pvEditorMode||(n.style.opacity="1")})),cur.pvImageAreaWrap.addEventListener("mouseout",(function(e){if(cur.pvImageAreaWrap&&cur.pvImageAreaWrap.contains(e.relatedTarget))return!1;n.style.opacity="0"})),cur.pvAttachedProducts.badges=cur.pvAttachedProducts.badges||[],cur.pvAttachedProducts.badges.push(n),[_,n]}}},"oK+H":function(e,_,t){"use strict";t.r(_),t.d(_,"createPostTooltip",(function(){return i}));var o=t("zxIV"),a=t("k487"),i=(e,_,t)=>{var i=_||"",r=e+i,l=Object(o.ge)(r),s=Object(o.geByClass1)("post_action_tt_content",l),n=Object(o.geByClass1)("post_action_btn_layout",l),d=s.children;window.radioBtns["post_settings_btn"+e+i]={val:!1,els:d};var c=[-12*(window.vk.rtl?-1:1),7],p=new a.default(n,{appendTo:l,forceSide:"bottom",autoShow:!1,cls:"eltt_fancy eltt_fancy_actions",noOverflow:!1,centerShift:0,offset:c,content:s,align:"left",onFirstTimeShow:()=>{Object(o.show)(s)}});cur[e+i]=p,cur.destroy.push((function(){p&&p.destroy()})),t&&(cur[e+i+"_onChange"]=t)}},q4CX:function(e,_,t){"use strict";t.r(_),t.d(_,"POST_PARAM_DONUT_DURATION",(function(){return o})),t.d(_,"ATTACH_DATA_DONUT_DURATION",(function(){return a})),t.d(_,"ATTACH_DATA_DONUT_ONLY",(function(){return i})),t.d(_,"MEDIA_TYPE_DONUT_DURATION",(function(){return r})),t.d(_,"DONUT_DURATION_DEFAULT",(function(){return l})),t.d(_,"WALL_SAVE_RESPONSE_IS_MARKED_AS_DONUT",(function(){return s}));var o="donut_duration",a="donut_duration",i="donut_only",r="donut_duration",l=-1,s="is_marked_as_donut"},qwyz:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_array_from__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("HEwt"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("rGqo"),core_js_modules_es7_symbol_async_iterator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("rE2o"),core_js_modules_es6_symbol__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ioFf"),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("OG14"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("Oyvg"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("KKXr"),core_js_modules_es6_object_assign__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("91GP"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("SRfc"),_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("zxIV"),_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("/PiP"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("Egk5"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("FWc3"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("EasH"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("v+DW"),_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("Xrg9"),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("t7n3"),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__("kcIO"),_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__("XzvV"),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__("lXE5"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__("7jxN"),_web_lib_video__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__("Ia1d"),_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__("4+be"),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__("cGUQ"),_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__("t/FQ"),_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__("QGEU"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__("98sY"),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__("o7bv"),_web_lib_utils__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__("aong"),_web_components_ui_gallery__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__("D1OX"),_web_donut__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__("7GuL"),_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__("YIAi"),_web_ui_media_selector_ui_media_selector__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__("te1c"),_web_discover_category_post_topic__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__("hzb7"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__("jE6c"),_web_page_wall_post_tooltip__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__("oK+H"),_internal_nospam_common__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__("FThC"),_wall_tabs_utils__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__("DfBR"),_web_lib_date__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__("1BRX");function _slicedToArray(e,_){return _arrayWithHoles(e)||_iterableToArrayLimit(e,_)||_unsupportedIterableToArray(e,_)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,_){if(e){if("string"==typeof e)return _arrayLikeToArray(e,_);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,_):void 0}}function _arrayLikeToArray(e,_){(null==_||_>e.length)&&(_=e.length);for(var t=0,o=new Array(_);t<_;t++)o[t]=e[t];return o}function _iterableToArrayLimit(e,_){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(t.push(r.value),!_||t.length!==_);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return t}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Wall={LS_ADS_EVENTS:"ads.events",deleteAll:function(e,_,t){ajax.post("al_wall.php",{act:"delete_all",post:_,hash:t},{onDone:function(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e));t.oldt=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(t,_)},showProgress:function(){hide(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{className:"progress"})))},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e))}})},restoreAll:function(e,_,t){var o=Math.floor(1e5*Math.random());cur.wallRnd=o,ajax.post("al_wall.php",{act:"restore_all",post:_,hash:t,rnd:o},{onDone:function(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(t,t.oldt)},showProgress:function(){hide(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span",{className:"progress_inline"})))},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e))}})},deleteThread:function(e,_,t){ajax.post("al_wall.php",{act:"delete_thread",post:_,hash:t,from_deleted:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(ge("post"+_),"reply_deleted")},{onDone:function(t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("dld_inner",e);if(o)o.oldElements=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o,t);else{var a=ge("post"+_),i=geByClass1("reply_wrap",a);hide(i),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{id:"post_del"+_,className:"dld",innerHTML:'<span class="dld_inner">'+t+"</span>"}),a.appendChild(o)}hide("replies_wrap_deep"+_)},showProgress:function(){hide(e);var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post_actions",e);if(_)addClass(_,"post_actions_progress");else{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e);t||(t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{className:"progress"}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).appendChild(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(t))}},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(e);var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post_actions",e);_?removeClass(_,"post_actions_progress"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e))}})},restoreThread:function(e,_,t){ajax.post("al_wall.php",{act:"restore_thread",post:_,hash:t},{onDone:function(){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("replies_wrap_deep"+_),t.oldElements)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(t,t.oldElements);else{var o=geByClass1("reply_wrap","post"+_);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("post_del"+_)}},showProgress:function(){hide(e);var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e);_||(_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{className:"progress"}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).appendChild(_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(_))},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e))}})},block:function(e,_,t,o,a){ajax.post("al_wall.php",{act:"block",post:_,hash:t,bl:o,from:a},{onDone:function(_){o?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).insertBefore(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span",{innerHTML:_}),e),hide(e)):(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e)))},showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.showProgress)(e,"post_inline_progress","post_inline_progress",!0)},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("post_inline_progress")}})},blockEx:function(e,_){Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("groupsedit.php",{act:"bl_edit",name:"id"+_,gid:e,auto:1},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})},withMentions:!(browser.mozilla&&browser.version.match(/^2\./)||browser.mobile),editPost:function(e,_,t,o,a){if(cur.editingPost&&ge("wpe_text")){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wall_posts",ge("wpe_text"));if(!i||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(i))return o&&o(),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.notaBene)("wpe_text");Wall.cancelEdit()}cur.editingPost=[_],Wall.withMentions?stManager.add(["ui_controls.css","ui_controls.js","mentions.js",jsc("web/wall_edit.js")]):stManager.add([jsc("web/wall_edit.js")]),ajax.post("al_wall.php",extend({act:"edit",post:_,mention:Wall.withMentions?1:""},t),{onDone:function(){var e=Array.prototype.slice.call(arguments);if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(e[4])&&cur.options&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(cur.options.filter_media_types)){var t=[];each(e[4],(function(e,_){each(cur.options.filter_media_types,(function(e,o){if(_[0]===o[0])return t.push(o),!1}))})),e[4]=t}e.unshift(_),WallEdit.editPost.apply(window,e),a&&a()},onFail:function(){cur.editingPost=!1,o&&o()},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem)(e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"flat_button")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(e):addClass(geByClass1("post_actions","post"+_),"post_actions_progress")},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem)(e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"flat_button")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(e):removeClass(geByClass1("post_actions","post"+_),"post_actions_progress")},noSort:!0})},fixPost:function fixPost(link,post,hash,value){return ajax.post("al_wall.php",{act:"a_fix_post",post,hash,value},{onDone:function onDone(js){if(js)try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,js)}var postEl=cur.wallLayer==post?ge("wl_post"):ge("post"+post);each(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_fixed"),(function(){removeClass(this,"post_fixed")})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(postEl,"post_fixed",value),link&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(link,getLang(value?"wall_unfix_post":"wall_fix_post")),link.onclick=function(){return Wall.fixPost(link,post,hash,value?0:1)}),cur.onWKFix&&(cur.onWKFix(value),delete cur.onWKFix)},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(link,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem)(link):_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind("wpe_fix"+post)},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(link,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem)(link):_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind("wpe_fix"+post)}}),!1},cancelEdit:function(e){if(cur.editingPost){if(!0===e&&cur.editingPost[0].match(/^-?\d+_/))return;window.WallEdit?WallEdit.cancelEditPost():cur.editingPost=!1}},searchWall:function(){},switchTabContent:function(e){switch(hide("page_wall_posts","page_postponed_posts","page_suggested_posts","page_search_posts","page_top_posts","page_archive_posts","page_donut_posts"),e){case"own":case"all":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_wall_posts");break;case"postponed":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_postponed_posts"),hide("wall_more_link");break;case"suggested":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_suggested_posts");break;case"search":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_search_posts");break;case"top":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_top_posts");break;case"archive":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_archive_posts");break;case"donut":Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_donut_posts")}},switchWall:function(e,_,t){if(_&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(_))return!0;if(t||(t="own"==cur.wallType?"all":"own"),_&&"click"==_.type&&_.clientX&&_.offsetX&&cur.wallTab==t&&cur.wallType==t&&"top"!==t)return nav.go(e,_);if("postponed"==cur.wallTab&&wall.checkPostponedCount(),"archive"!==cur.wallTab&&"archive"!==t||((cur.wallLayer?wkcur:cur).wallMyDeleted={}),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(cur.wallArchiveFeatureTooltipHide)&&cur.wallArchiveFeatureTooltipHide(),!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(t,["top","archive","donut"])){var o=ge("page_wall_posts");removeClass(o,"own"),removeClass(o,"all"),addClass(o,t)}cur.wallType=t,cur.wallTab=t,uiTabs.switchTab(e),uiTabs.hideProgress(e),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(t,["top","archive","donut"])?(cur.baseWallModule=cur.module,cur.module="wall_"+t,cur.topWallFeatureTT&&cur.topWallFeatureTT.hide()):cur.baseWallModule&&(cur.module=cur.baseWallModule,delete cur.baseWallModule);var a="donut"===t&&Wall.cantAccessDonutPosts();return Wall.hasPosts()||a?(Wall.update(),Wall.showWall()):(cur.wallNextFrom=0,cur.wallTopNextFrom=0,cur.wallArchiveNextFrom=0,cur.wallArchiveRestored=0,cur.wallArchiveArchived=0,cur.wallArchiveRolledback=0,cur.wallDonutNextFrom=0,"top"===t?delete cur.wallTopFinished:"archive"===t?delete cur.wallArchiveFinished:"donut"===t&&delete cur.wallDonutFinished,uiTabs.showProgress(e),Wall.showMore(0,e)),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_)},resetWall:function(){if(cur.wallType&&cur.wallTab){var e=geByClass1("_wall_tab_"+cur.wallType);e&&(cur.wallNextFrom=0,cur.wallTopNextFrom=0,cur.wallArchiveNextFrom=0,(cur.wallLayer?wkcur:cur).wallMyDeleted={},"top"===cur.wallType?delete cur.wallTopFinished:"archive"===cur.wallType?delete cur.wallArchiveFinished:"donut"===cur.wallType&&delete cur.wallDonutFinished,uiTabs.showProgress(e),Wall.showMore(0,e,!0))}},hasPosts:function(e){e=e||cur.wallType;var _=Wall.getPostsWrap(e);return!!geByClass1("post",_)},getPostsWrap:function(e){switch(e){case"archive":return ge("page_archive_posts");case"top":return ge("page_top_posts");case"donut":return ge("page_donut_posts");default:return ge("page_wall_posts")}},showSuggested:function showSuggested(ev,rows,notAll){if(ev&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(ev))return!0;if(!cur.oid)return!1;var el=ge("page_wall_suggest");if(el=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(el,"unshown")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domQuery1)("#page_wall_suggest_more .ui_tab_group_item"):geByClass1("ui_tab",el),!el)return!1;if(uiTabs.switchTab(el),cur.wallTab="suggested",delete cur.suggestedDeletedCount,void 0!==rows)wall.suggestLoaded(rows,notAll);else{if(cur.suggestedLoading)return!1;var curOid=cur.suggestedLoading=cur.oid;uiTabs.showProgress(el),ajax.post("al_wall.php",{act:"get_suggests",owner_id:cur.oid},{onDone:function onDone(rows,notAll,js,count){if(js)try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,js)}cur.suggestedLoading=!1,uiTabs.hideProgress(el),Wall.updateTabCounter("page_wall_suggested_cnt",count),curOid===cur.oid&&"suggested"==cur.wallTab&&wall.suggestLoaded.apply(window,arguments)}})}return!1},deleteSuggested:function(e,_,t,o){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isButtonLocked)(o)){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(o);var a=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)({title:getLang("global_action_confirmation"),onHide:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(o)}},getLang("wall_delete_suggested_box"),getLang("wall_delete_suggested_btn"),(function(o){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isButtonLocked)(o)||(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(o),ajax.post("al_wall.php",{act:"delete_suggested",post_id:e,hash:t,group_id:_},{onDone:function(e){if("full_own"==cur.wallType||"full_all"==cur.wallType){var _=(Math.ceil(e/cur.pgPerPage)-1)*cur.pgPerPage;_<cur.pgOffset&&(_>0?nav.objLoc.offset=_:delete nav.objLoc.offset,nav.setLoc(nav.objLoc)),nav.reload()}else Wall.showSuggested();a.hide()},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(o),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(o)}))}),getLang("global_cancel"))}},suggestLoaded:function(e,_){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_suggested_posts",e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)("wall_more_link",_),wall.switchTabContent("suggested")},suggestMore:function(){var e=ge("page_suggested_posts"),_=ge("wall_more_link");Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isButtonLocked)(_)||ajax.post("al_wall.php",{act:"get_suggests",owner_id:cur.oid,offset:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post",e).length-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("dld",e).length},{onDone:function(t,o){for(var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:t}),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(a);i;)ge(i.id)||!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"post")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(i):e.appendChild(i),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(a);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)(_,o)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(_),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(_)})},suggestUpdate:function(e){var _=ge("page_suggests_count"),t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_));_&&(-1!==e&&1!==e||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,t+=e),Wall.updateTabCounter("page_wall_suggested_cnt",t))},suggestPublished:function(e,_,t){if(cur.onepost)return nav.go("/wall"+cur.oid);if(Wall.suggestUpdate(-1),Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.showDoneBox)(_),cur.wallMyDeleted[e]=1,cur.editingPost=!1,Wall.deinitComposer(ge("wpe_text")),"full_own"!=cur.wallType&&"full_all"!=cur.wallType||(Pagination.recache(-1),FullWall.updateSummary(cur.pgCount)),cur.postWpeIsPoster=!!cur.posterWpeSendParams,cur.posterWpe&&cur.posterWpeSendParams&&WallEdit.posterDestroy(),t&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_postponed_posts",t),wall.postponeUpdateCount()),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_suggests_count")))Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("post"+e);else{var o=ge("wall_rmenu");o?(geByClass1("ui_rmenu_item",o).click(),hide(geByClass1("_wall_menu_suggested",o))):ge("wall_tabs")&&(geByClass1("ui_tab",ge("wall_tabs")).click(),wall.updateTabVisibility("page_wall_suggest",!1))}},showDonutWall:function(e){if(!cur.oid)return!1;Wall.updateTabVisibility("page_wall_donut",!0);var _=Wall.getWallTabLink("donut");if(!_)return!1;uiTabs.switchTab(_),cur.wallTab="donut",cur.wallType="donut",void 0!==e&&Wall.donutWallSetRows(e)},donutWallSetRows(e){var _=Wall.getPostsWrap("donut");_&&(_.innerHTML=e,Wall.switchTabContent("donut"),Wall.update())},getWallTabLink:e=>{var _=ge("page_wall_"+e);return(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"unshown")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domQuery1)(`#page_wall_${e}_more .ui_tab_group_item`):geByClass1("ui_tab",_))||null},showPostponedFull:function(e){var _=ge("ui_rmenu_postponed"),t=ge("page_wall_posts");if(!_||!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"ui_rmenu_item_sel")||!t){var o={0:nav.objLoc[0],postponed:1};return nav.go(o)}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(t,e),FullWall.updateSummary(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post",t).length)},showPostponed:function(e,_){if(e&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(e))return!0;if(!cur.oid)return!1;var t=ge("page_wall_postponed");if(!(t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"unshown")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domQuery1)("#page_wall_postponed_more .ui_tab_group_item"):geByClass1("ui_tab",t)))return!1;if(uiTabs.switchTab(t),cur.wallTab="postponed",void 0!==_)Wall.postponedLoaded(_);else{if(cur.postponedLoading)return!1;var o=cur.postponedLoading=cur.oid;uiTabs.showProgress(t),ajax.post("al_wall.php",{act:"get_postponed",owner_id:cur.oid},{onDone:function(e){cur.postponedLoading=!1,uiTabs.hideProgress(t),o===cur.oid&&"postponed"==cur.wallTab&&Wall.postponedLoaded(e)}})}return!1},postponedLoaded:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_postponed_posts",e),wall.postponeUpdateCount(),wall.switchTabContent("postponed")},postponeUpdateCount:function(){var e=ge("page_postponed_posts"),_=e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post",e).length-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("dld",e).length||0;e&&Wall.updateTabCounter("page_wall_postponed_cnt",_)},checkPostponedCount:function(){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post","page_postponed_posts"),_=0;each(e,(function(){var e=this.id.replace("post","");cur.wallMyDeleted[e]||_++})),_||wall.updateTabVisibility("page_wall_postponed",!1)},updateTabCounter:function(e,_){_=_?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(_,"%s",!0):"",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)(e).forEach((function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e,_);var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"ui_tab_group_item")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"default-label",t.innerHTML)}))},updateTabVisibility:function(e,_){var t=ge("page_wall_more_tab");if(t)if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(t))if(_){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"unshown")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e+"_more","unshown")){var o=!1;cur.wallTabsMorePriority.forEach((function(_){o||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"unshown")||(addClass(_,"unshown"),removeClass(_+"_more","unshown"),removeClass(e,"unshown"),o=!0)})),o||removeClass(e+"_more","unshown")}}else{var a=ge(e);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"unshown"))addClass(ge(e+"_more"),"unshown");else{addClass(a,"unshown");var i=cur.wallTabsLimit-1-Object(_wall_tabs_utils__WEBPACK_IMPORTED_MODULE_40__.getNavigableTabs)(t).length;if(i>0){var r=i;cur.wallTabsMorePriority.forEach((function(e){if(!(r<=0)){var _=ge(e+"_more");_&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"unshown")&&(removeClass(ge(e),"unshown"),addClass(_,"unshown"),r--)}}))}}var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("ui_tab_group_item",t);l.length-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("unshown",t).length<=1&&(l.forEach((function(e){e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"unshown")||(removeClass(ge(e.id.replace(/_more$/,"")),"unshown"),addClass(e,"unshown"))})),addClass(t,"unshown"))}else{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(ge(e),"unshown",!_);var s=Object(_wall_tabs_utils__WEBPACK_IMPORTED_MODULE_40__.getNavigableTabs)(t).length;if(s>cur.wallTabsLimit){var n=s-(cur.wallTabsLimit-1);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("ui_tab_group_item",t).forEach((function(e){addClass(e,"unshown")})),cur.wallTabsMorePriority.forEach((function(e){if(!(n<=0)){var _=ge(e);_&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"unshown")&&(addClass(_,"unshown"),removeClass(ge(e+"_more"),"unshown"),n--)}})),removeClass(t,"unshown"),Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.statlogsValueEvent)("wall_more_tab_shown",cur.oid)}}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(ge(e),"unshown",!_)},postponedPublished:function(e,_){if(cur.onepost)return nav.go("/wall"+cur.oid);"full_own"!=cur.wallType&&"full_all"!=cur.wallType||(Pagination.recache(-1),FullWall.updateSummary(cur.pgCount)),_&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.showDoneBox)(_),cur.wallMyDeleted[e]=1;var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post",ge("page_postponed_posts")),o=ge("post"+e);if(t.length<=1&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(o,t)){var a=ge("wall_rmenu");a?(geByClass1("ui_rmenu_item",a).click(),hide(geByClass1("_wall_menu_postponed",a))):ge("wall_tabs")&&(geByClass1("ui_tab",ge("wall_tabs")).click(),wall.updateTabVisibility("page_wall_postponed",!1))}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(o),wall.postponeUpdateCount()},onWallSearchSend:function(e,_){_?Wall.showSearch(_,0):Wall.hideSearch()},showSearch:function(e,_){if(cur.searchLoading&&cur.searchLoading==e||!cur.oid)return!1;var t=cur.oid;cur.wallQuery=cur.searchLoading=e,"search"!=cur.wallTab&&(cur.prevWallTab=cur.wallTab,cur.wallTab="search");var o=ge("wall_more_link");return ajax.post("al_wall.php",{act:"s",search:1,q:e,owner_id:cur.oid,offset:_,inline:1,owners_only:1},{onDone:function(a,i,r){if(t===cur.oid&&"search"==cur.wallTab){var l=ge("page_search_posts");_||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(l,""),l.appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(a)),wall.switchTabContent("search"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)(o,i<r),o.onclick=Wall.showSearch.pbind(e,i);var s=cur.oid>0?_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.serviceWallUsers:_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.serviceWallGroups;Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.saveSearchAttemptStats)(s,0,r,e)}},showProgress:function(){uiSearch.showProgress("wall_search"),_&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(o)},hideProgress:function(){cur.searchLoading=!1,uiSearch.hideProgress("wall_search"),_&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(o)}}),!1},hideSearch:function(){if(delete cur.wallQuery,cur.prevWallTab){var e=(cur.oid,_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.serviceWallUsers);Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.removeSearchPositionTracker)(e),cur.wallTab=cur.prevWallTab,cur.prevWallTab=!1,wall.switchTabContent(cur.wallTab),wall.update()}},publishPostponedPost:function(e,_,t){Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("publish_postponed_title"),getLang("publish_postponed_confirm"),getLang("publish_postponed_btn"),(function(){Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)().hide(),ajax.post("al_wall.php",{act:"publish_postponed",post:e,from:t,hash:_},{onDone:Wall.postponedPublished.pbind(e),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind("wpe_publish"+e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind("wpe_publish"+e)})}),getLang("global_cancel"))},publishFreeDonutCopy:function(e,_,t,o){var a=e.currentTarget,i=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("wall_publish_donut_as_free_confirmation_title"),getLang("wall_publish_donut_as_free_confirmation_confirm"),getLang("wall_publish_donut_as_free_confirmation_btn"),()=>{var e=()=>{i.hide()},r=i.btns.ok[0];ajax.post("al_wall.php",{act:"publish_free_donut_copy",post_id:_,from:o,hash:t},{onDone:_=>{Wall.publishFreeDonutCopyDone({menuActionEl:a,message:_}),e()},onFail:()=>{e()},showProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(r)},hideProgress:()=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(r)}})},getLang("global_cancel"))},publishFreeDonutCopyDone(e){var _=e.message,t=e.menuActionEl;"full_own"!==cur.wallType&&"full_all"!==cur.wallType||(Pagination.recache(-1),FullWall.updateSummary(cur.pgCount)),_&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.showDoneBox)(_,{timeout:3e3}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t)},cmp:function(e,_){var t=e.length,o=_.length;return t<o?-1:t>o?1:e<_?-1:e>_?1:0},receive:function(e,_,t,o){o=!0===o;var a,i,r,l,s="top"===(t=t||cur.wallType),n="archive"===t,d="donut"===t,c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:e}),p=!!cur.options.revert,u=Wall.getPostsWrap(t),b=[],h=[],m=["page_top_posts","page_wall_posts","page_archive_posts","page_donut_posts"],v=0;if(o)h=m;else{var g=[[n,"page_archive_posts"],[s,"page_top_posts"],[d,"page_donut_posts"],[!0,"page_wall_posts"]].find(e=>_slicedToArray(e,1)[0]),E=_slicedToArray(g,2)[1];h=m.filter(e=>e!==E),r=p?u.firstChild:u.lastChild}function w(e){return!!(e&&e.tagName&&"div"===e.tagName.toLowerCase()&&e.id&&"post"===e.id.substr(0,4))&&e.id}h.forEach((function(e){if("page_donut_posts"!==e||!ge("wall_donut_info"))for(var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(ge(e));_;){var t=_;_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(_),t.tagName&&"input"===t.tagName.toLowerCase()||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t)}}));for(var O=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(p?c.firstChild:c.lastChild);O;O=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(p?c.firstChild:c.lastChild))if("input"!=O.tagName.toLowerCase()){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(O,"post_fixed")||!ge(O.id))if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(O,"_ads_promoted_post"))b.push({el:O,beforePost:w(p?c.firstChild:a),afterPost:w(p?a:c.lastChild)});else{for(;r&&r.tagName&&"div"==r.tagName.toLowerCase()&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(r,"post_fixed")&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(r,"_ads_promoted_post")||!s&&!n&&Wall.cmp(r.id,O.id)<0);)r=p?r.nextSibling:r.previousSibling;++v,r?Wall.cmp(r.id,O.id)?(l=r,(i=p?r.previousSibling:r.nextSibling)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"_ads_promoted_post")&&(l=i),p?(u!==Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(l)&&Wall.sendInsertBeforeError(),u.insertBefore(O,l)):(u!==Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(l.nextSibling)&&Wall.sendInsertBeforeError(),u.insertBefore(O,l.nextSibling))):(u.replaceChild(O,r),r=O,--v):p?u.appendChild(O):u.insertBefore(O,u.firstChild),a=O,Object(_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_30__.placeholderSetup)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByTag1)("textarea",O),{fast:1})}}else{var P=ge(O.id);P?u.replaceChild(O,P):u.firstChild?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(O,u.firstChild):u.appendChild(O)}if(b.length)for(var D=0,f=b.length;D<f;++D){var M=b[D];if(M.beforePost||M.afterPost){for(var C="no_position",T=p?u.firstChild:u.lastChild;T;T=p?T.nextSibling:T.previousSibling){l=null;var L=w(T);if(L){if(M.beforePost===L?l=T:M.afterPost===L&&(l=T.nextSibling),l&&(l.previousSibling&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(l.previousSibling,"_ads_promoted_post")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(l,"_ads_promoted_post"))){l=null,C="ads_sibling";break}if(l){u!==Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(l)&&Wall.sendInsertBeforeError(),u.insertBefore(M.el,l),C=!1;break}}}C&&Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.statlogsValueEvent)("debug_watch",1,"js_page_ads_promoted_post_no_position",C)}}s&&!v?cur.wallTopFinished=cur.oid:n&&!v?cur.wallArchiveFinished=cur.oid:d&&!v&&(cur.wallDonutFinished=cur.oid),"full_own"!==t&&"full_all"!==t||(Pagination.recache(v),FullWall.updateSummary(cur.pgCount)),Wall.update(),wall.addReplyNames(_),Wall.updateMentionsIndex(),v&&Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().updateCurrentPlaying()},showMore:function(e,_,t){if(cur.viewAsBox)return cur.viewAsBox();if(!cur.wallLayer){if("suggested"===cur.wallTab)return Wall.suggestMore();if(!(cur.wallTypeLoading&&cur.wallTypeLoading[cur.wallType]||"top"===cur.wallType&&cur.wallTopFinished===cur.oid||"archive"===cur.wallType&&cur.wallArchiveFinished===cur.oid||"donut"===cur.wallType&&cur.wallDonutFinished===cur.oid)){var o=cur.wallType,a="top"===o,i="archive"===o,r="donut"===o,l=ge("wall_more_link"),s=cur.wallLoading=cur.oid,n=a&&!!cur.wallTopOnlyCache,d="";0!==e&&(d=i?cur.wallArchiveNextFrom:a?cur.wallTopNextFrom:r?cur.wallDonutNextFrom:cur.wallNextFrom),cur.wallTypeLoading=cur.wallTypeLoading||{},cur.wallTypeLoading[o]=!0,t=!0===t&&!e,ajax.post("al_wall.php",{act:"get_wall",owner_id:cur.oid,offset:e,type:o,fixed:cur.options.fixed_post_id||"",wall_start_from:d,onlyCache:n},{onDone:function(l,n,d,c){return _&&uiTabs.hideProgress(_),s!==cur.oid||o!==cur.wallType?(delete cur.wallLoading,void delete cur.wallTypeLoading[o]):a&&isObject(l)&&l.wait?(cur.wallTopLoadingDelay=cur.wallTopLoadingDelay?cur.wallTopLoadingDelay+100:200,void(cur.wallTopLoadingDelay<500?setTimeout((function(){delete cur.wallLoading,delete cur.wallTypeLoading[o],Wall.showMore(e)}),cur.wallTopLoadingDelay):(delete cur.wallLoading,delete cur.wallTypeLoading[o],cur.wallTopOnlyCache=!1,Wall.showMore(e)))):(delete cur.wallTopLoadingDelay,cur.wallVideos&&each(d,(function(e,_){cur.wallVideos[e]&&(cur.wallVideos[e].list=cur.wallVideos[e].list.concat(_.list))})),i?cur.wallArchiveNextFrom=c:a?cur.wallTopNextFrom=c:r?cur.wallDonutNextFrom=c:cur.wallNextFrom=c,void setTimeout((function(){Wall.receive(l,n,o,t),e||o!==cur.wallType||Wall.showWall(),delete cur.wallLoading,delete cur.wallTypeLoading[o]}),0))},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(l),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(l)})}}},showWall:function(){wall.switchTabContent(cur.wallType);var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("wall_module",ge("page_wall_posts")))[1];e<Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)()&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(e-15)},checkTextLen:function(e,_,t){var o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Emoji.editableVal(e).replace(/\n\n\n+/g,"\n\n"));if(e.lastLen!==o.length||t){var a=e.lastLen=o.length,i=(cur.options||{}).max_post_len||(window.mvcur||{}).maxReplyLength,r=a-o.replace(/\n/g,"").length;_=ge(_),a>i-100||r>4?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(_),_.innerHTML=a>i?getLang("global_recommended_exceeded",a-i):r>4?getLang("global_recommended_lines",r-4):getLang("text_N_symbols_remain",i-a)):hide(_),window.FullWall&&cur.onepost&&FullWall.onePostOnScroll()}else window.FullWall&&cur.onepost&&FullWall.onePostOnScroll()},checkPostLen:function(e,_,t,o){var a=ge(e);if(t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(t).replace(/\n\n\n+/g,"\n\n"),a&&(a.lastLen!==t.length||o)){var i=a.lastLen=t.length,r=cur.options.max_post_len,l=i-t.replace(/\n/g,"").length,s=ge(_);i>r-100||l>4?(s.innerHTML=i>r?getLang("global_recommended_exceeded",i-r):l>4?getLang("global_recommended_lines",l-4):getLang("text_N_symbols_remain",r-i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(s)):hide(s)}},postChanged:function(e){var _=Wall.isPosterEditorOpen();if((_||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("submit_post"))&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(ge("submit_post_box"),"shown")||Wall.showEditPost(),vk.id&&!vk.widget&&!cur.options.no_draft){clearTimeout(cur.postAutosave);var t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(cur.oid)==vk.id?Wall.saveDraft:Wall.saveOwnerDraftText.pbind(cur.oid);!0===e?t():cur.postAutosave=setTimeout(t,10===e?10:1e3)}_||setTimeout(Wall.checkPosterAvailability)},ownerDraftKey:function(e){return"wall_draft"+vk.id+"_"+e},ownerDraftData:function(){return cur.wallDraftData||(cur.wallDraftData={}),cur.wallDraftData},addOwnerDraftMedia:function(e,_){if(!cur.options.no_draft){var t=Wall.ownerDraftData(),o=_[0],a=_[1],i=_[2];t._attach_cache=t._attach_cache||{},i?t._attach_cache[o+a]=i:i=t._attach_cache[o+a],t.attaches=t.attaches||[];var r=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get(Wall.ownerDraftKey(e))||{};!1!==o?t.attaches.push([o,a,i,t.attaches.length]):!1===o&&void 0!==a&&(t.attaches=t.attaches.filter((function(e){return e[3]!==a}))),_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set(Wall.ownerDraftKey(e),extend(r,{txt:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Wall.getDraftData().message||""),medias:t.attaches}))}},cleanOwnerDraftMedia:function(e){if(!cur.options.no_draft){var _=Wall.ownerDraftData(),t=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get(Wall.ownerDraftKey(e))||{};_.attaches=[],_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set(Wall.ownerDraftKey(e),extend({txt:""},t,{medias:[]}))}},saveOwnerDraftText:function(e){if(cur.postFieldZoomText&&cur.postFieldZoomText(cur.postField,cur.wallAddMedia),!cur.options.no_draft){var _=Wall.ownerDraftData(),t=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get(Wall.ownerDraftKey(e))||{},o=Wall.getDraftData(),a=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(o.message||""),i=null;if(_.txt=a,each(t.medias||{},(function(e,_){switch(_[0]){case"postpone":o.postpone&&(t.medias[e][1]=o.postpone,t.medias[e][2].draft=1);break;case"poll":var a=(cur.wallAddMedia||{}).pollData(!0,!0);a&&extend(t.medias[e][2],a);break;case"copyright":var i=(cur.wallAddMedia||{}).copyrightData(!0);i&&extend(t.medias[e][2],i);break;case _web_donut__WEBPACK_IMPORTED_MODULE_33__.ATTACH_DATA_DONUT_DURATION:o[_web_donut__WEBPACK_IMPORTED_MODULE_33__.ATTACH_DATA_DONUT_DURATION]&&(t.medias[e][2]=Object.assign(t.medias[e][2]||{},{[_web_donut__WEBPACK_IMPORTED_MODULE_33__.ATTACH_DATA_DONUT_DURATION]:o[_web_donut__WEBPACK_IMPORTED_MODULE_33__.ATTACH_DATA_DONUT_DURATION]}))}})),a&&o.bkg_id&&(i={id:o.bkg_id},cur.poster&&cur.poster.isCustomBkgId(o.bkg_id)&&extend(i,cur.poster.getCustomBkg()),t.bkg_id&&delete t.bkg_id),extend(t,{txt:a,bkg:i}),cur.shareShowImg&&extend(t,{shareShowImg:cur.shareShowImg}),e<0){var r=cur.poster?ge("submit_post_box"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_submit_post_box",ge("official"));extend(t,{from:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(r,"from-oid")||vk.id,signed:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("signed")?1:0}),Object(_web_donut__WEBPACK_IMPORTED_MODULE_33__.fieldValueIsDonutOnlyPost)(ge("post_actions_btns"),r,cur.wallAddMedia)?t.donutOnly=1:delete t.donutOnly}_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set(Wall.ownerDraftKey(e),t)}},getOwnerDraft:function(e){if(cur.options.no_draft)return[];var _=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get(Wall.ownerDraftKey(e))||[],t={from:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.from),signed:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.signed),shareShowImg:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.shareShowImg)};return Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.donutOnly)&&(t.donutOnly=1),[_.txt,_.medias,!0,t,_.bkg]},saveOwnerDraftMedia:function(e,_,t,o){if(!cur.options.no_draft){Wall.cleanOwnerDraftMedia(e);var a=cur.wallAddMedia||{},i=[],r=(cur.wallAddMedia?a.getMedias():[]).slice().map((function(e){return e.slice(0,2)}));void 0!==t&&_?i=[[_,t,o]]:_||void 0===t||r.splice(t,1),r=r.concat(i),each(r,(function(){Wall.addOwnerDraftMedia(e,this)}))}},saveDraft:function(){if(cur.postFieldZoomText&&cur.postFieldZoomText(cur.postField,cur.wallAddMedia),!cur.options.no_draft)if(cur.noDraftSave)cur.noDraftSave=!1;else if(!cur.postSent&&vk.id==Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(cur.oid)){var e=Wall.getDraftData();e.delayed||ajax.post("al_wall.php",Wall.fixPostParams(extend({act:"save_draft",hash:cur.options.post_hash},e)),{onFail:function(){return!0}})}},getDraftData:function(){if(cur.options.no_draft)return{};var e=cur.wallAddMedia||{},_=e.chosenMedia||{},t=cur.wallAddMedia?e.getMedias():[],o=e.shareData||{},a="",i=0,r=null;if(Wall.isPosterEditorOpen())r=(a=cur.poster.getText())?cur.poster.getBkgId():null;else{var l=ge("post_field");a=window.Emoji?Emoji.editableVal(l):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(l),a=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(a)}var s={message:a,bkg_id:r};return Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(_)&&_.length&&t.push(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(_)),t.length&&each(t,(function(_,t){if(t){var r=this[0],l=this[1];switch(r){case"poll":var n=e.pollData(!0,!0);if(!n)return s.delayed=!0,!1;l=n.question,delete n.question,s=extend(s,n);break;case"copyright":var d=e.copyrightData(!0);if(d)return void(s=extend(s,d));break;case"share":if(o.failed||!o.title&&(!o.images||!o.images.length)&&!o.photo_url&&!o.video)return cur.shareLastParseSubmitted&&Date.now()-cur.shareLastParseSubmitted<2e3?(s.delayed=!0,!1):void 0;o.video?(l=o.video_owner_id+"_"+o.video_id,s.snippet_video=1):l=o.user_id&&o.photo_id&&!o.noPhoto?o.user_id+"_"+o.photo_id:"",o.initialPattern&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(a)==o.initialPattern&&(s.message=""),s=extend(s,{url:o.url,mode:o.mode,title:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(o.title),description:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(o.description),button_text:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(o.button_text),button_action:o.button_action,extra:o.extra,extra_data:o.extraData,photo_url:o.video?"":Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(o.photo_url),open_graph_data:(o.openGraph||{}).data,open_graph_hash:(o.openGraph||{}).hash});break;case"page":o.initialPattern&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(a)==o.initialPattern&&(s.message="");break;case"postpone":var c=+e.postponeDate;return void(s=extend(s,{postpone:c}));case"mark_as_ads":return void(s=extend(s,{mark_as_ads:1}));case _web_donut__WEBPACK_IMPORTED_MODULE_33__.ATTACH_DATA_DONUT_DURATION:return void(s=extend(s,Object(_web_donut__WEBPACK_IMPORTED_MODULE_33__.getPostParamsFromDurationMedia)(t)))}this[3]&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(a)==this[3]&&(s.message=""),s["attach"+(i+1)+"_type"]=r,s["attach"+(i+1)]=l,i++}})),s},setDraft:function(e){if(!cur.options.no_draft&&(e[0]||e[1]&&e[1].length||null!=e[4])){var _=ge("post_field");if(_){var t=e[4];t||Emoji.val(_,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(e[0]||"")).replace(/\n/g,"<br/>")),Wall.showEditPost((function(){setTimeout((function(){if(t&&cur.poster){Wall.hidePosterFeatureTooltip();var o={text:e[0]||""};if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isString)(t)?o.bkgId=e[4]:isObject(t)&&(cur.poster.isCustomBkgId(t.id)&&cur.poster.addCustomBkg(t),o.bkgId=t.id),!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(Wall.getMainPostBlock()))return cur.poster.setBkg(o.bkgId,!0),cur.poster.setText(o.text),void Emoji.val(_,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(e[0])).replace(/\n/g,"<br/>"));Wall.openPosterEditor(o)}if(e[1]&&cur.wallAddMedia)for(var a in e[1])cur.noDraftSave=!0,cur.wallAddMedia.chooseMedia.apply(cur.wallAddMedia,e[1][a]);Wall.checkPosterAvailability(),Wall.saveDraft()}),0)})),e[2]&&wall.focusOnEnd(),e[3]&&(wall.setReplyAsGroup(ge("official"),e[3]),e[3].shareShowImg&&(cur.shareShowImgRestored=e[3].shareShowImg),e[3].donutOnly&&Wall.togglePostVisibilityAccess(ge("donut_only"),_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT,"",!0)),cur.postFieldZoomText&&cur.postFieldZoomText(cur.postField,cur.wallAddMedia)}}},initPostEditable:function(e){var _=cur.postField;if(!_||_.emojiInited)return!1;_.emojiInited=!0,stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.init(_,{ttDiff:-42,rPointer:!0,controlsCont:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(_),noStickers:!0,onSend:Wall.sendPost,noEnterSend:!0,ref:"post",checkEditable:Wall.postChanged,initUploadForImagePasteCallback:function(e,_,t){window.Upload&&Upload.onFileApiSend(cur.wallUploadInd,[t])}}),addClass(_,"submit_post_inited"),e?setTimeout(Wall.setDraft.pbind(e),0):cur.postFieldZoomText&&cur.postFieldZoomText(cur.postField,cur.wallAddMedia)})),setTimeout((function(){cur.postFieldZoomText&&addEvent(_,"keydown paste",(function(){setTimeout((function(){cur.postFieldZoomText(cur.postField,cur.wallAddMedia)}),0)}))}),0)},showEditPost:function(e){var _=ge("post_field");if(cur.viewAsBox)return setTimeout((function(){_.blur()}),0),cur.viewAsBox();0!==cur.editing&&(setTimeout(WallUpload.init,0),Wall.initComposer(_,{lang:{introText:getLang("profile_mention_start_typing"),noResult:getLang("profile_mention_not_found")},checkLen:Wall.postChanged,onValueChange:Wall.onPostValChange,onItemSelect:Wall.onPostItemSelect},e),Wall.hideEditPostReply(),addClass("submit_post_box","shown"),cur.editing=0,Wall.showPosterFeatureTooltip(),Wall.showPostCopyrightFeatureTooltip(),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(cur.onShowEditPost)&&cur.onShowEditPost(),cur.wallAdsReplacedFeatureTooltip&&Wall.showAdsReplacedTooltip(),stManager.add(["ui_controls.css","ui_controls.js","datepicker.css",window.jsc("web/datepicker.js")]))},postBoxFocus:function(e,_){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(e||window.event);var t=Wall.isPosterEditorOpen();(cur.postField&&window.Emoji||t)&&setTimeout((function(){_?t?(cur.poster.focusPoster(),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(cur.poster.getPosterElement())[1]-15)):(Emoji.focus(cur.postField),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(cur.postField)[1]-15)):t?cur.poster.focusPoster():Emoji.focus(cur.postField,!0,ge("submit_post_box"))}),0)},initComposer:function(e,_,t){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"composer"))t&&t();else if(cur.composerAdded){var o=Composer.init(e,_);t&&t(),cur.destroy.push(Composer.destroy.bind(Composer).pbind(o))}else stManager.add(["wide_dd.css","wide_dd.js"],(function(){cur.composerAdded=!0;var o=Composer.init(e,_);t&&t(),cur.destroy.push(Composer.destroy.bind(Composer).pbind(o))}))},deinitComposer:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"composer");_&&Composer.destroy(_),e.emojiId&&window.Emoji&&Emoji.destroy(e.emojiId)},hasComposerMedia:function(e){var _=e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"composer");return!(!_||!_.addMedia)&&_.addMedia.attachCount()>0},composerListShown:function(e){var _=e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"composer");if(!_)return!1;var t=_.wdd,o=0;for(var a in t.shown)o+=1;return!!(t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(t.listWrap)&&o)},onPostValChange:function(e){if(cur.wallAddMedia&&cur.wallAddMedia.checkMessageURLs.apply(window,arguments),"full_own"!=cur.wallType&&"full_all"!=cur.wallType||Pagination.pageTopUpdated(),browser.msie&&!e){var _=ge("post_field");hide(_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)(_)}},onPostItemSelect:function(e){if(e&&!(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e[0])>=0)&&cur.wallAddMedia){var _="vk.com/event"+-e[0];cur.wallAddMedia.checkMessageURLs(_,!0)}},hideEditPost:function(e){cur.editing=!1;var _=ge("post_field"),t=cur.wallAddMedia||{},o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)((window.Emoji?Emoji.editableVal:_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_));!browser.opera_mobile&&_&&(!e&&(o||t.chosenMedia||t.getMedias&&t.getMedias().length>0||t.activeState||t.attachCount&&t.attachCount()>0)||(removeClass("submit_post_box","shown"),_&&!o&&cur.postMention&&(cur.postMention.options.minHeight=cur.emptyPostheight||14),cur.onWallSendCancel&&cur.onWallSendCancel(),window.WallUpload&&WallUpload.hide(),cur.wallAddMedia&&cur.wallAddMedia._hideAddMedia(!0)))},clearInput:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("page_add_media");var e=ge("post_field");if(Wall.withMentions){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"mention");_&&(_.rtaEl.innerHTML="",hide(_.cont),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(e))}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e,""),e.blur(),e.phonblur(),Wall.hideEditPost(!0),cur.wallAddMedia&&cur.wallAddMedia.unchooseMedia(),Wall.resetPostVisibilityAccess(),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)("export_status",!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)("close_comments",!1),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(window.cur.wallOnClearInput)&&window.cur.wallOnClearInput.forEach(e=>{e()});var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"composer");t&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t.articleConvertEl),t.articleConvertEl=!1)},fixPostParams:function(e){var _=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(e);return _.Message=e.message,delete _.message,_},focusOnEnd:function(e){if(e=ge(e)||ge("post_field"))if("TEXTAREA"!=e.tagName){var _=e.innerHTML?e.innerHTML.length:e.length?e.length:e.childNodes.length-1;if(e.focus(),document.selection){var t=document.selection.createRange();t.moveStart("character",_),t.select()}else window.getSelection().collapse(e,e.childNodes.length)}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)(e)},isAnonPost:function(){var e=geByClass1("anon_toggle");return e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(geByClass1("_ui_toggler",e),"on")?1:""},saveAnon:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(geByClass1("_ui_toggler",e),"on");var _=Wall.isAnonPost();Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)("friends_only",!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)("status_export",!_),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)("facebook_export",!_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(ge("submit_post_box"),"anon_field_on");var t=cur.anonPostBtn||getLang("wall_send");cur.anonPostBtn=ge("send_post").innerHTML,ge("send_post").innerHTML=_?getLang("wall_send"):t},showPostSettings:function(e,_){var t=cur.wallAdsReplacedFeatureTooltip&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"addpost_opt");if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"ett")||t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e);t&&Wall.hideAdsReplacedTT(),new ElementTooltip(e,{cls:"post_settings_tooltip",content:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o),defaultSide:"top",offset:[0,-5],appendTo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e)}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(o)}_&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkKeyboardEvent)(_)&&"click"===_.type&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"ett").toggle()},saveExport:function(e,_,t){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("friends_only")||Wall.isAnonPost()||Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(e),cur.saveExportTO=cur.saveExportTO||{},clearTimeout(cur.saveExportTO[_]),cur.saveExportTO[_]=setTimeout((function(){ajax.post("/al_settings.php",{act:"a_save_export",service:_,disabled:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(e)?0:1,hash:t})}),300)},togglePostVisibilityAccess:function(e,_,t,o){var a=!!t;if(!Wall.isAnonPost()||a){t=t||"";var i="post_visibility_btn",r=cur[i+t];r&&r.hide(),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.radiobtn)(e,_,"post_settings_btn"+i+t);var l=ge("post_visibility_btn"+t),s=a?ge("wpe_status_export"):ge("status_export"),n=a?ge("wpe_facebook_export"):ge("facebook_export"),d=geByClass1("post_action_btn_text",l),c=_!==_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__.VISIBILITY_ACCESS_OPTIONS.ONLY_FRIENDS&&_!==_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT;if(c){var p=ge("no_friends_only"+t).innerHTML;d.innerHTML=p,d.setAttribute("aria-label",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(p)),removeClass(l,"on")}else{var u=_===_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT?ge("donut_only"+t):ge("friends_only"+t),b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(u);d.innerHTML=b,d.setAttribute("aria-label",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(b)),addClass(l,"on"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(s,!1),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(n,!1)}s&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(s,!c),n&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(n,!c);var h=a?window.cur.addMedia[t]:window.cur.wallAddMedia;h&&h.onPostVisibilityAccessChange(_),o||Wall.postChanged()}},resetPostVisibilityAccess(){Wall.canChangeVisibilityForNewPost()&&Wall.togglePostVisibilityAccess(ge("no_friends_only"),_web_page_wall_constants__WEBPACK_IMPORTED_MODULE_34__.VISIBILITY_ACCESS_OPTIONS.PUBLIC,!1,!0)},canChangeVisibilityForNewPost:()=>!!ge("post_visibility_btn"),initPostVisibilitySelector(e){Wall.canChangeVisibilityForNewPost()&&(Wall.createPostTooltip("post_visibility_btn",e.id),e.donutUpdateVisibility())},togglePostDonutDuration:function(e,_,t){t=t||"";var o="post_donut_duration_btn",a=cur[o+t];a&&a.hide(),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.radiobtn)(e,_,"post_settings_btn"+o+t);var i=cur[o+t+"_onChange"];i&&i()},cantAccessDonutPosts:()=>!1===window.cur.donutGroupUserHasWallAccess,togglePostMarkAsAds:function(e,_){_=_||"mute_notifications";var t=ge(_);if(t){var o=Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(e);if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(t,o),o)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"prev-state",+Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(t)),addClass(t,"on");else{var a=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"prev-state");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(t,"on",a)}}},needCheckSign:function(){var e=ge("check_sign");return e&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(e)},saveCheckSign:function(e){var _=Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"title",_?getLang("wall_check_sign_disabled"):getLang("wall_check_sign_enabled")),window.tooltips&&tooltips.hide(e,{onHide:e.onmouseover.bind(e)}),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(e,!_)},checkAsGroup:function(e){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(e),wall.setReplyAsGroup(e,{fromGroup:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(e)})},sendPost:function(e,_){var t=cur.wallAddMedia||{},o=t.chosenMedia||{},a=cur.wallAddMedia?t.getMedias():[],i=t.shareData||{},r=cur.poster&&!!_,l=r?_.text:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)((window.Emoji?Emoji.editableVal:_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(ge("post_field"))),s=!1,n=Wall.isAnonPost(),d=r?null:ge("send_post"),c=cur.options.suggesting?"suggest":cur.wallType;"top"===c&&(c="all"),r&&(a=a.filter(e=>{if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(e)){var _=_slicedToArray(e,1)[0];return["copyright","postpone",_web_donut__WEBPACK_IMPORTED_MODULE_33__.MEDIA_TYPE_DONUT_DURATION].includes(_)}}));var p=r?ge("submit_post_box"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_submit_post_box",ge("official")),u=Object(_web_donut__WEBPACK_IMPORTED_MODULE_33__.fieldValueIsDonutOnlyPost)(ge("post_actions_btns"),p,t),b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(p,"from-oid")==cur.postTo?1:"";p&&cur.postTo||b||cur.defaultPostSettings&&(b=cur.defaultPostSettings.official?1:"");var h={act:"post",message:l,to_id:cur.postTo,type:c,friends_only:!n&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("friends_only"),check_sign:Wall.needCheckSign(),status_export:!n&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("status_export"),close_comments:ge("close_comments")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("close_comments")?1:0:"",mute_notifications:ge("mute_notifications")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("mute_notifications")?1:0:"",mark_as_ads:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("mark_as_ads")?1:0,official:b,signed:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)("signed"),anonymous:n,hash:cur.options.post_hash,from:cur.from?cur.from:"",fixed:cur.options.fixed_post_id||"",situational_suggest_id:cur.options.situational_suggest_id||null},m=0;extend(h,Object(_web_donut__WEBPACK_IMPORTED_MODULE_33__.getDonutPostParams)(u,t)),cur.options.additional_save_params&&(h=extend(h,cur.options.additional_save_params));var v,g=cur.wallAddMedia&&cur.wallAddMedia.id||"";function E(e){var _=ge("submit_post_error");if(_.innerHTML=e.length>60?'<div class="msg_text">'+e+"</div>":e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("submit_post_error")||(Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.slideDown)("submit_post_error",100),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animate)(ge("box_layer_wrap"),{scrollTop:0})),Wall.isPosterEditorOpen()){var t=cur.poster.getErrorWrapperElement();t.innerHTML="",t.appendChild(_)}}if(extend(h,Object(_web_discover_category_post_topic__WEBPACK_IMPORTED_MODULE_36__.getPostTopicSelectorParams)(String(g))),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(o)&&o.length&&a.push(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(o)),r&&(h.poster_bkg_id=_.bkgId,h.poster_bkg_access_hash=_.accessHash,_.fallbackObj&&(a.push(["photo",_.fallbackObj.owner_id+"_"+_.fallbackObj.id,!1]),h.poster_photo_hash=_.fallbackObj.post_hash),h.poster_bkg_id!==cur.posterCtaBkgId&&(h.poster_author_bkg_check=!0)),hide("submit_post_error"),a.length){var w=0;v=!1,each(a,(function(e,_){if(_){var o=this[0],r=this[1];switch(o){case"video":if(s||"suggest"==c)break;var p=Wall.getOwnerDraft(cur.oid)[1];if(!p)break;each(p,(function(e,_){_[1]===r&&_[2]&&_[2].upload_new&&w++}));break;case"poll":if(n)return;var u=t.pollData();if(!u)return v=!0,!1;r=u.question,delete u.question,h=extend(h,u);break;case"copyright":if(n)return;var b=t.copyrightData();if(b)return void(h=extend(h,b));break;case"share":if(i.failed||!i.title&&(!i.images||!i.images.length)&&!i.photo_url&&!i.video)return cur.shareLastParseSubmitted&&Date.now()-cur.shareLastParseSubmitted<2e3?(v=!0,!1):void 0;if((cur.options.share||{}).button_exclusive&&i.button_text&&i.button_action){var g;a.length>1&&(g=getLang("global_share_too_many_attachments")),l.split("\n").length-1>(cur.options.share||{}).button_exclusive_max_message_newlines&&(g=getLang("global_share_too_many_newlines")),l.length>(cur.options.share||{}).button_exclusive_max_message_len&&(g=getLang("global_share_too_long_message"));var O=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.extractUrls)(" "+l+" "),P=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.extractUrls)(" "+i.url+" ")[0];if(P&&O.length){"/"===P.query&&(P.query=""),"www."===P.domain.substr(0,4)&&(P.domain=P.domain.substr(4));for(var D=0;D<O.length;++D){var f=O[D];if("/"===f.query&&(f.query=""),"www."===f.domain.substr(0,4)&&(f.domain=f.domain.substr(4)),P.domain!=f.domain||P.query!=f.query){g=getLang("global_share_too_many_links");break}}}if(g)return E(g),v=!0,!1}if(!i.title)return E(getLang("global_share_title_required")),v=!0,!1;if(!i.url)return E(getLang("global_share_url_required")),v=!0,!1;if(i.url=new URL(i.url).href,i.video?(r=i.video_owner_id+"_"+i.video_id,h.snippet_video=1):r=i.user_id&&i.photo_id&&!i.noPhoto?i.user_id+"_"+i.photo_id:"",i.share_upload_failed&&!r)return void(i.share_upload_failed=0);if(i.images&&i.images.length&&!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(i.images[cur.shareShowImg])&&!r&&!i.noPhoto&&!i.share_own_image&&!i.video)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(d),t.uploadShare((function(){Wall.sendPost(!0)})),v=!0,!1;if((cur.options.share||{}).require_image&&!r)return E(getLang("global_share_image_required")),v=!0,!1;i.initialPattern&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(l)==i.initialPattern&&(h.message=""),h=extend(h,{url:i.url,mode:i.mode,title:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(i.title),description:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(i.description),button_text:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(i.button_text),button_action:i.button_action,extra:i.extra,extra_data:i.extraData,photo_url:i.noPhoto||i.video?"":Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.replaceEntities)(i.photo_url),open_graph_data:(i.openGraph||{}).data,open_graph_hash:(i.openGraph||{}).hash});break;case"page":i.initialPattern&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(l)==i.initialPattern&&(h.message="");break;case"postpone":if(n)return;var M=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("postpone_date"+t.lnkId);return h=extend(h,{postpone:M}),cur.postponedLastDate=M,void(s=!0);case"mark_as_ads":return void(h=extend(h,{mark_as_ads:1}));case"pretty_cards":if(!t.prettyCardGallery)return;if(t.prettyCardGallery.needSendData())return t.prettyCardGallery.saveCards(Wall.sendPost,(function(e){E(e)})),v=!0,!1;var C=t.prettyCardGallery.getSendData();r=C.attachVal;break;case"podcast":if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(this[2],"attach_disabled"))return!1;break;case _web_donut__WEBPACK_IMPORTED_MODULE_33__.MEDIA_TYPE_DONUT_DURATION:return}this[3]&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(l)==this[3]&&(h.message=""),n&&"photo"!==o||(h["attach"+(m+1)+"_type"]=o,h["attach"+(m+1)]=r,m++)}}));var O=cur.postTo<0||cur.postTo===vk.id;if(cur.wallUploadVideoOpts&&cur.wallUploadVideoOpts.vars.is_wall_postponed_allowed&&O&&w&&!e&&!cur.postponeVideoPost)return Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)()&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)().hide(),void Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("al_video.php?act=postponed_post_box",{videos_count:w},{onDone:function(e,_){e.removeButtons(),e.addButton(_.video_post_later_text,(function(){cur.postponeVideoPost=!0,Wall.sendPost(!0),e.hide()})),e.addButton(_.video_post_now_text,(function(){Wall.sendPost(!0),e.hide()}),"no")}});if(v)return void(e&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(d))}if(!m&&!l)return e&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(d),void Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)("post_field");if(!d||e||!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isButtonLocked)(d)){cur.postponeVideoPost&&(h=extend(h,{postpone_video:!0,postpone_video_hd:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(ge("postponed_post_hd"))})),cur.postAutosave&&clearTimeout(cur.postAutosave),hide("submit_post_error"),cur.postSent=!0;var P=window.GroupsAdminTips&&window.GroupsAdminTips.isShownSection()?1:0;h.update_admin_tips=P,setTimeout((function(){ajax.post("al_wall.php",Wall.fixPostParams(h),{onDone:function(e,_,o,a){Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isString)(o)||(o=null),cur.poster&&r&&(cur.poster.unlockEditPoster(),cur.poster.closeEditor(),cur.poster.resetPoster(),cur.posterCtaBkgId&&(cur.posterCtaBkgId=null)),cur.posterFeatureTT&&cur.posterFeatureTT.hide(),Wall.clearInput(),cur.postSent=!1,cur.postponeVideoPost=!1;var i=ge("mark_as_ads"),l=ge("mute_notifications");if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(i)&&l&&(removeClass(l,"on"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(l,0)),i&&removeClass(i,"on"),t.donutUpdateVisibility(),cur.options.onSendPostDone)cur.options.onSendPostDone.apply(window,arguments);else{if(a&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.showDoneBox)(a),!isObject(e)||!e.redirect){if(Object(_wall_tabs_utils__WEBPACK_IMPORTED_MODULE_40__.showHiddenNavigableTabs)(),s){if("feed"==c)Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.showDoneBox)(e,{out:3e3});else if("full_own"==c||"full_all"==c)return Wall.showPostponedFull(e);return wall.updateTabVisibility("page_wall_postponed",!0),void Wall.showPostponed(!1,e)}if(("full_own"==c||"full_all"==c)&&(cur.pgStart||nav.objLoc.postponed)){var n=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(nav.objLoc);return delete n.offset,delete n.postponed,vk.id!=cur.oid&&delete n.own,nav.go(n)}if(vk.id!=cur.oid&&"full_own"==c){var d=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(nav.objLoc);return delete d.own,nav.go(d)}return"feed"==c?cur.wallPostCb():"suggest"==c?(wall.updateTabVisibility("page_wall_suggest",!0),Wall.showSuggested(!1,e,_),Wall.suggestUpdate()):void(u?Wall.showDonutWall(e):(ge("wall_tabs")&&geByClass1("ui_tab",ge("wall_tabs")).click(),Wall.receive(e,_),cur.onWallSendPost&&cur.onWallSendPost(),P&&null!==o&&window.GroupsAdminTips&&window.GroupsAdminTips.refreshSection(o)))}nav.go(e.redirect)}},onFail:function(e){if(cur.postSent=!1,cur.postponeVideoPost=!1,cur.poster&&r&&cur.poster.unlockEditPoster(),cur.posterFeatureTT&&cur.posterFeatureTT.hide(),!cur.options.onSendPostFail){if(!e)return!0;var _=ge("submit_post_error");if(_.innerHTML=e.length>60?'<div class="msg_text">'+e+"</div>":e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("submit_post_error")||Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.slideDown)("submit_post_error",100),Wall.isPosterEditorOpen()){var t=cur.poster.getErrorWrapperElement();t.innerHTML="",t.appendChild(_)}return!0}cur.options.onSendPostFail.apply(window,arguments)},showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(d)},hideProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(d)},noSort:!0})}),0)}},_repliesLoaded:function(e,_,t,o,a){var i=ge("replies"+e);if(i){var r=i.nextSibling;if(_){var l=i.offsetHeight;i.innerHTML=t,Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)()+(i.offsetHeight-l),0,void 0,!0),setTimeout(Wall.scrollHighlightReply.pbind("post"+_),0)}else i.innerHTML=t;if(r&&"replies_open"==r.className&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(r),ajax._framenext(),e==cur.wallLayer){var s=wkcur.reverse;extend(wkcur,{offset:!s&&a.offset||0,loaded:a.num||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",i,"div").length,count:a.count}),wall.addReplyNames(o),WkView.wallUpdateReplies(),s||(wkLayerWrap.scrollTop=wkLayerWrap.scrollHeight,WkView.wallUpdateRepliesOnScroll())}else wall.addReplyNames(o),Wall.repliesSideSetup(e);Wall.updateMentionsIndex(),setTimeout((function(){Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().updateCurrentPlaying()}),10),a&&Likes.updateComments("wall"+e,a.count)}},repliesSideSetup:function(e){if(cur.wallLayer!=e){var _=ge("replies"+e);if(_){var t=geByClass1("wr_header",_,"a"),o=ge("post"+e),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"deep_active"),i=ge("replies_side"+e);if(cur.wallMyOpened[e]&&(t||a)){if(!i){var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)('<div class="replies_side_wrap"><div id="replies_side'+e+'" class="replies_side"></div></div>');_.parentNode.insertBefore(r,_),(i=r.firstChild).onmouseover=Wall.repliesSideOver.pbind(e),i.onmouseout=Wall.repliesSideOut.pbind(e),i.onclick=a?Wall.hideDeepReplies.pbind(e):Wall.repliesSideClick.pbind(e)}_.onmouseover=Wall.repliesSideOver.pbind(e),_.onmouseout=Wall.repliesSideOut.pbind(e),Wall.repliesSideOver(e)}else hide(i),_.onmouseover=null,_.onmouseout=null}}else WkView.wallUpdateReplies()},repliesSideClick:function(e){var _=ge("replies"+e),t=Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(_)[1];return t>o&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(o-100,0),hide("replies_side"+e),Wall.showReplies(e,3,!1)},repliesSideOver:function(e){var _=ge("replies"+e),t=ge("replies_side"+e);if(_){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(t))[1],a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(t)[1],i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(_)[1],r=_.offsetHeight,l=window.lastWindowHeight||0,s=o+a-l+15,n=i+r-l;cur.wallRepliesSideOver=[e,t,s,n],Wall.repliesSideUpdate()}},repliesSideOut:function(e){cur.wallRepliesSideOver&&cur.wallRepliesSideOver[0]==e&&delete cur.wallRepliesSideOver},repliesSideUpdate:function(e){var _=cur.wallRepliesSideOver;if(_){var t,o=_[1],a=_[4]||{},i=_[5]||"",r="replies_side";void 0===e&&(e=Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)()),e<_[2]?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(o),t={marginTop:0,opacity:1}):e<_[3]?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(o),r+=" replies_side_fixed",t={opacity:Math.max(0,Math.min(1,(_[3]-e)/200))}):(r+=" replies_side_hidden",t={marginTop:_[3]-_[2],opacity:0,display:null}),JSON.stringify(a)!==JSON.stringify(t)&&(each(a,(function(e,_){a[e]=null})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)(o,extend(a,t)),_[4]=t),i!=r&&(o&&(o.className=r),_[5]=r)}},highlightReply:function(e){(e=ge(e))&&(addClass(e,"reply_highlighted"),setTimeout((function(){removeClass(e,"reply_highlighted")}),1500))},scrollHighlightReply:function(e){if(e=ge(e))if(cur.wallLayer||e.id.match(/^post-?\d+(photo|video|market)?_\d+$/)&&(window.wkcur&&wkcur.shown||window.mvcur&&mvcur.mvShown||cur.pvShown)){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(e,!0)[1];_<0||_>lastWindowHeight-200?Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animate)(wkLayerWrap,{scrollTop:wkLayerWrap.scrollTop+_-50},300,Wall.highlightReply.pbind(e)):Wall.highlightReply(e)}else{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(e)[1];t<Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)()+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("page_header")[1]?(Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(t,300),setTimeout(Wall.highlightReply.pbind(e),300)):Wall.highlightReply(e)}},showReply:function(e,_,t,o){if(cur.viewAsBox)return!1;if(o&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(o))return!0;if(window.mvcur&&mvcur.post==_)return Videoview.showComment(t),!1;var a=ge("post"+t);if(a)Wall.scrollHighlightReply(a);else if(cur.wallLayer==_)WkView.wallShowPreviousReplies(t);else if(_.match(/market/))Market.comments(_);else{if(e.tt&&e.tt.hide&&e.tt.hide(),"full"==cur.wallType){var i=t.split("_");return delete nav.objLoc.offset,nav.go(extend(nav.objLoc,{reply:i[1]}))}Wall.showReplies(_,!1,t)}return!1},showReplies:function(e,_,t,o){if(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(o||window.event))return!0;if(cur.viewAsBox)return cur.viewAsBox();if(cur.wallLayer!=e||!wkcur.reverse){cur.wallMyOpened[e]=3!=_;var a={act:"get_replies",post:e,count:_},i={onDone:Wall._repliesLoaded.pbind(e,t),showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind("wrh"+e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind("wrh"+e),local:1};if(t||_&&!(_>20)||(extend(a,{cont:"replies"+e}),extend(i,{frame:1}),cur.onFrameBlocksDone=function(){setTimeout(Wall.repliesSideSetup.pbind(e),browser.msie?100:10)}),ajax.post("al_wall.php",a,i),!browser.msie&&_>0&&_<10){for(var r=ge("replies"+e),l=r&&r.lastChild,s=[];s.length<_&&l;)"DIV"==l.tagName&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(l,"reply")&&s.push(l),l=l.previousSibling;if(s.length==_){var n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",r,"div").length;for(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(r,'<a class="wr_header wrh_all"></a>'),Wall.updateRepliesHeader(e,r.firstChild,_,n),hide("replies_side"+e);s.length;)r.appendChild(s.pop());Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)("wrh"+e)}}return!1}},moreReplies:function(e,_,t,o){var a;if(o.deep){var i=e.split("_");a={act:"get_post_replies",offset:_,owner_id:i[0],item_id:i[1],count:t},o.order&&(a.order=o.order)}else a={act:"get_replies",offset:_,post:e,count:t};return extend(a,{rev:o.rev,from:o.from}),ajax.post("al_wall.php",a,{onDone:function(_,t,a){var i=ge("replies"+e);o.clear?i.innerHTML=_:o.rev||o.append?i.appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(_)):i.innerHTML=_+i.innerHTML,wall.addReplyNames(t),o.onDone&&o.onDone(_,t,a),Wall.updateMentionsIndex()},onFail:()=>!1,showProgress:o.showProgress,hideProgress:o.hideProgress}),!1},openDeepShortReplies:function(e,_){var t=geByClass1("replies_next",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e));return t&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(t),t.focus(),t.click(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e)),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_)},collapseDeepReplies:function(e,_){var t=ge("replies"+_);if(t&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"replies_list_deep")){var o=Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(e)[1],i=Math.round(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.clientHeight)()/2);cur.wallLayer?(a-=o)<i&&Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animate)(wkLayerWrap,{scrollTop:wkLayerWrap.scrollTop+a-i},300):o>a-i&&Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(a-i),Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(ge("post"+_));var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span",{className:"progress_inline replies_next_loader"});Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e),t.innerHTML="";var l=ge("reply_box_wrap"+_);l&&hide(l);var s=ge("replies_wrap_deep"+_);removeClass(s,"replies_deep_has_field"),addClass(s,"replies_deep_has_short"),wall.updateRepliesOnScroll(),ajax.post("al_wall.php",{act:"get_collapsed_replies",reply_id:_},{onDone:function(e){t.innerHTML=e},onFail:function(){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",t)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",t),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(cur.wallTpl.reply_deep_next,{post_id:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"post-id"),reply_id:_,offset:0,text:getLang("wall_next_n_replies",cur.options&&cur.options.replies_page_count||20),class:" replies_next_deep"}));t.appendChild(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(o)},showProgress:function(){t.appendChild(r),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(r)},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(r)}})}},overCollapseDeepReplies:function(e){var _=geByClass1("replies_deep_collapse_icon",e),t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(_),o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getStyle)(_,"bottom")),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(e),r=Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),l=cur.wallLayer?wkLayerWrap.scrollTop:r;cur.wallLayer&&(i[1]-=r);var s,n,d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.clientHeight)(),c=i[1]+a[1],p=null,u=0;cur.wallLayer?(p=ge("wl_reply_form"),u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(p)[1],s=l+c-d,n=l+i[1]+t[1]+o+o-d):("full"===cur.wallType&&(p=geByClass1("reply_box_inner_wrap",ge("reply_box_wrap"+cur.oid+"_"+cur.pid)),u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(p)[1]),s=c-d,n=i[1]+t[1]+o+o-d),cur.onScrollCollapseDeepReplies=wall.updCollapseDeepRepliesIcon.pbind(e,_,{iconSize:t,iconBottom:o,collapseSize:a,collapsePos:i,fixedField:p,fixedFieldSize:u,maxFixedScroll:s,topMaxScroll:n}),addEvent(cur.wallLayer?wkLayerWrap:window,"scroll",cur.onScrollCollapseDeepReplies),addEvent(window,"resize",cur.onScrollCollapseDeepReplies),cur.onScrollCollapseDeepReplies()},outCollapseDeepReplies:function(e){cur.onScrollCollapseDeepReplies&&(removeEvent(cur.wallLayer?wkLayerWrap:window,"scroll",cur.onScrollCollapseDeepReplies),removeEvent(window,"resize",cur.onScrollCollapseDeepReplies),delete cur.onScrollCollapseDeepReplies);var _=geByClass1("replies_deep_collapse_icon",e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)(_,{position:null,bottom:null,left:null,right:null})},updCollapseDeepRepliesIcon:function(e,_,t){var o=cur.wallLayer?wkLayerWrap.scrollTop:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),a=t.maxFixedScroll;if((cur.wallLayer&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t.fixedField,"wl_reply_form_fixed")||"full"===cur.wallType&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t.fixedField,"fixed"))&&(a+=t.fixedFieldSize),o<a){var i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)((t.collapseSize[0]-t.iconSize[0])/2),r=t.topMaxScroll+t.fixedFieldSize-o,l=t.fixedFieldSize+t.iconBottom;r>0&&(l-=r),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)(_,{position:"fixed",bottom:l,left:t.collapsePos[0]+i,right:"auto"})}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)(_,{position:null,bottom:null,left:null,right:null})},updateCollapseDeepReplies:function(e){if(cur.wallTpl.reply_deep_collapse){var _=ge("replies_wrap_deep"+e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",ge("post"+e));if(_){e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"post-id");var t=ge("replies"+e);if(!t)return t;var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",t).length>=2,a=geByClass1("replies_deep_collapse",_);if(o){if(a)return;a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(cur.wallTpl.reply_deep_collapse,{reply_id:e})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(a,t)}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(a)}}},showNextReplies:function(e,_,t){var o=_.split("_"),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"offset"),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"count"),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"collapse"),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"replies_prev"),s=cur.wallLayer?ge("wl_post"):ge("post"+_),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)("post"+_,"reply"),d={act:"get_post_replies",owner_id:o[0],item_id:o[1],offset:a,count:i,collapse:r},c=l?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPS)(e);if(c&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(c,"reply")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(c,"replies_wrap_deep"))){var p=(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(c,"post-id")||"").split("_")[1];l?d.next_id=p:d.prev_id=p}if(n)cur.wallLayer||(s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",s));else{var u=ge("replies"+_),b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(u,"top-ids");b&&(d.top_replies=b)}var h=s.offsetHeight,m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"post-id");d.order=wall.getRepliesOrder(m);var v=n&&wall.isDescRepliesOrder(m,d.order);v&&(l=!l);var g=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span",{className:"progress_inline replies_next_loader"});return ajax.post("al_wall.php",d,{onDone:function(t,o,i){var n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:t})),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(),c=!1;n.forEach((function(e){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"wr_header")){var _=ge(e.id);_&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"reply")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"replies_wrap_deep"))||(d.appendChild(e),c=!0)}}));var p,u,b=l&&!v||!l&&v,g=!1;if(b){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(ge("replies_wrap_deep"+_),"replies_deep_has_short")){var E=window.innerHeight||document.documentElement.clientHeight,w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("page_header")[1],O=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e),P=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(O)[1];p=cur.wallLayer?wkLayerWrap.scrollTop:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),g=cur.wallLayer?P<E:P<p+E-w}u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(d,e)}else u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domLC)(d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(d,e);var D=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(i.num),f=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(i.offset),M=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(i.count),C=Math.max(0,f+(l?-D:D)),T=M-C,L=0;if(c&&(l&&f>0||!l&&T>0)&&(L=l?a-C:Math.min(T,D),i.closest_inx>=0&&(L=Math.min(L,i.closest_inx))),document.activeElement===e?addEvent(e,"focusout",(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e)})):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e),L){var A=e.cloneNode(!0);removeClass(A,"replies_next_pre_deleted"),r||(b?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(A,u),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(A,getLang("wall_prev_n_replies",L))):(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(A,u),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(A,getLang("wall_next_n_replies",L))),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(A,"count",L),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(A,"offset",C))}removeClass(ge("replies_wrap_deep"+_),"replies_deep_has_short");var y=s.offsetHeight-h;if(g&&y){var I=p+y;cur.wallLayer?wkLayerWrap.scrollTop=I:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(I,0,!1,!0)}wall.updateCollapseDeepReplies(_),wall.updateMentionsIndex(),wall.addReplyNames(o),wall.addDeepRepliesBlock(_),cur.wallMyOpened=cur.wallMyOpened||{},cur.wallMyOpened[m]=1,wall.repliesSideSetup(m),wall.updateRepliesOnScroll()},onFail:function(){removeClass(e,"replies_next_pre_deleted")},showProgress:function(){addClass(e,"replies_next_pre_deleted"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(g,e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(g)},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(g)}}),t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(!1)},emojiOpts:{},emojiShowTT:function(e,_,t){return void 0!==Wall.emojiOpts[e]&&Emoji.ttShow(Wall.emojiOpts[e],_,t)},emojiHideTT:function(e,_,t){return void 0!==Wall.emojiOpts[e]&&Emoji.ttHide(Wall.emojiOpts[e],_,t)},initReplyEditable:function(e,_,t,o,a){if(e.emojiInited)return!1;var i=ge("reply_button"+t),r=ge("reply_media_preview"+t);e.emojiInited=!0,stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){var l=Emoji.init(e,{ttDiff:o?-40:-42,rPointer:!0,controlsCont:_,shouldFocus:!a,ref:"reply",onSend:function(){Wall.sendReply(t),e.blur()},ctrlSend:function(){return Wall.customCur().wallTpl.reply_multiline||Wall.composerListShown(e)},checkEditable:function(){cur.onReplyChanged&&cur.onReplyChanged(e,t),Wall.checkTextLen(e,"reply_warn"+t)},onChange:function(){i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(i,"reply_send_disabled",!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Emoji.editableVal(e))&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(r,"media_preview_has_medias")),Wall.hideCheckTimer(t,"editing")},onStickerSend:function(e,_){Wall.sendReply(t,!1,{stickerId:e,sticker_referrer:_})},initUploadForImagePasteCallback:Page.initUploadForImagePaste});if(vk.widget&&!window.emojiStickers&&Emoji.updateTabs(),Wall.emojiOpts[t]=l,cur.afterEmojiInit&&cur.afterEmojiInit[t]){var s=geByClass1("emoji_smile",Emoji.opts[l].controlsCont);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(s)&&(cur.afterEmojiInit[t](),delete cur.afterEmojiInit[t])}}))},initEditReply:function(e,_,t,o){var a,i=e,r=ge("reply_field"+e),l=ge("post"+e),s=ge("reply_fakebox"+e),n=ge("reply_box"+e),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(l,"reply"),c=cur.wallLayer?wkcur:cur,p=!1;if(d){if(a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",l)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",l),p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"deep_active")){if(!cur.reply_to){var u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(l,"answering-id");if(u){var b=e.split("_")[1];cur.reply_to=[Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(u),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(b)],Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,b)}}wall.addDeepRepliesBlock(e),s=ge("reply_fakebox"+e)}i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"post-id")}else cur.wallLayer?(p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(ge("wl_post"),"deep_active"),a=ge("wl_reply_form_inner")):(a=l,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"deep_active"));if(!a&&s?a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_wrap",s):!a&&n&&(a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_wrap",n)),s){var h=ge("replies"+i),m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(h,"can_reply_as_group"),v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(h,"can_reply_as_any_group"),g=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-photo")||"",E=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-href")||"",w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-name")||"",O="";v?O=c.wallTpl.reply_form_any_group:m&&(O=c.wallTpl.reply_form_group),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(p&&c.wallTpl.reply_form_new?c.wallTpl.reply_form_new:c.wallTpl.reply_form,{add_buttons:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(O,{post_id:e,oid:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e),owner_photo:g||"/images/blank.gif"}),post_id:e,oid:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e),owner_photo:g,owner_href:E,owner_name:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.unclean)(w))})),s.parentNode.replaceChild(n,s),r=ge("reply_field"+e)}if(Wall.initReplyEditable(r,n,e,_,t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(r,"composer"))o&&o();else{var P,D,f,M,C=[],T=!1;window.mvcur&&mvcur.mvShown?P=mvcur.mvMediaTypes:cur.wallLayer==i?P=wkcur.options.rmedia_types:window.pvcur&&cur.pvShown?(P=pvcur.rmedia_types,D=0,f=0):P=c.options&&c.options.rmedia_types,p&&(T=!0,D=0,f=0),each(P||c.options&&c.options.media_types||[],(function(){Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(this[0],["photo","video","audio","doc","link","page"])&&C.push(this)}));var L=!1,A=i.match(/^(\d+_)?-?\d+_(photo|video|topic|market)?\d+(mv)?(_\d+)?$/);C.length>0&&A?(M={lnk:p?ge("reply_more_attaches"+e):ge("reply_add_media_"+e),preview:ge("reply_media_preview"+e),actionsEl:!1,gearEl:!1,types:C,options:{from:"topic"===A[2]?"board":"comment",limit:2,disabledTypes:["album","market","market_album","poll",_web_ui_media_selector_ui_media_selector__WEBPACK_IMPORTED_MODULE_35__.MEDIA_SELECTOR_GROUP],toggleLnk:!0,maxShown:void 0!==D?D:void 0,hideAfterCount:void 0!==f?f:void 0,vectorIcon:T,hideLabel:getLang("wall_reply_add_attach_label"),toId:"full"===cur.wallType?cur.oid:cur.postTo,onToggleBlock:function(_){var t=ge("reply_box"+e),o=geByClass1("reply_box_photo",t);o&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)(o,_)},onMediaChanged:function(){Wall.hideCheckTimer(e,"editing"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)("reply_button"+e,"reply_send_disabled",!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Emoji.editableVal(r))&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)("reply_media_preview"+e,"media_preview_has_medias"))}}},i.match(/^-?\d+_topic/)&&(extend(M.options,{disabledTypes:["album","share","link","page"],limit:10,editable:1,sortable:1,teWidth:280,teHeight:200}),L=!0)):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("reply_add_media_"+e),Wall.initComposer(r,{lang:{introText:getLang("profile_mention_start_typing"),noResult:getLang("profile_mention_not_found")},toup:L,wddClass:"reply_composer_dd",width:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(r.parentNode)[0],media:M,isReply:!0},o)}return void 0!==r.emojiId&&cur.afterEmojiInit&&cur.afterEmojiInit[e]&&(cur.afterEmojiInit[e](),delete cur.afterEmojiInit[e]),{postId:i,postEl:a,isReply:d,rf:r}},showEditReply:function(e,_,t,o,a,i){if(cur.viewAsBox)return setTimeout((function(){ge("reply_field"+e).blur()}),0),cur.viewAsBox();if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)("post"+e,"Post--with_closed_comments_donut"))return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)("replies_wrap"+e,{display:""}),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_);var r=wall.initEditReply(e,t,a,i);if(r.rf){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("reply_box_wrap",r.rf));var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",r.rf);l&&addClass(l,"replies_deep_has_field")}return cur.wallMyOpened&&(cur.wallMyOpened[e]=cur.wallMyOpened[e]||!1),cur.editing===e?(Emoji.editableFocus(r.rf,!1,!0),!1):(Wall.hideEditPostReply(),r.isReply?addClass(ge("replies_wrap_deep"+e),"deep_reply_box_open"):addClass(r.postEl,"reply_box_open"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)("replies_wrap"+e,{display:""}),cur.editing=e,window.Emoji&&setTimeout((function(){Emoji.editableFocus(r.rf,!1,!0),Wall.repliesSideOver(e)}),0),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.triggerEvent)(window,"scroll"),void 0!==r.rf.emojiId&&cur.afterEmojiInit&&cur.afterEmojiInit[e]&&(cur.afterEmojiInit[e](),delete cur.afterEmojiInit[e]),cur.wallTpl&&cur.wallTpl.reply_multiline_intro&&ajax.post("al_wall.php",{act:"a_ctrl_submit_intro",hash:cur.wallTpl.poll_hash},{onDone:function(_){_&&cur.editing===r.postId&&Wall.replySubmitTooltip(e,1)},onFail:function(){return!0}}),window.mvcur&&mvcur.post==r.postId&&Videoview.onShowEditReply(),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(cur.onReplyFormSizeUpdate)&&cur.onReplyFormSizeUpdate(r.rf),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(cur.onReplyFormFocus)&&cur.onReplyFormFocus(r.rf),!1)},hideEditReply:function(e,_){cur.editing=!1;var t,o=ge("reply_field"+e),a=ge("post"+e),i=ge("reply_box"+e),r=cur.reply_to&&Wall.getReplyName(cur.reply_to[0]),l=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(window.Emoji?Emoji.editableVal(o):""),s=Wall.hasComposerMedia(o),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"reply");if(!(t=cur.wallLayer?ge("wl_reply_form_inner"):n?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",a):a)&&i&&(t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_wrap",i)),o&&(!s||_)){if(r&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(r)&&r[1]&&(l&&r[1].indexOf(l)||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o,""),l="")),_&&(l||s)){var d=o&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(o,"composer");d?Composer.reset(d):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o,""),l="",hide(geByClass1("reply_warn",t))}if(!(browser.opera_mobile||browser.safari_mobile||l)){Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)()&&Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)().isVisible()||(n?removeClass(ge("replies_wrap_deep"+e),"deep_reply_box_open"):removeClass(t,"reply_box_open")),ge("reply_link"+e)&&hide("replies_wrap"+e),window.tooltips&&i&&tooltips.hideAll(i),o.blur(),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.triggerEvent)(window,"scroll"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,""),hide("reply_to_title"+e),cur.reply_to=!1;var c=Wall.emojiOpts[e];c>=0&&Emoji.opts[c]&&Emoji.opts[c].onChange&&Emoji.opts[c].onChange(),cur.onReplyFormSizeUpdate&&cur.onReplyFormSizeUpdate();var p=cur.replySubmitSettings;p&&p.tt&&p.tt.el&&p.tt.destroy(),window.mvcur&&mvcur.post==e&&Videoview.onHideEditReply()}}},replyNamesRE:function(){wall.addReplyNames({});var e=wall.getReplyNames();if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isEmpty)(e))return!1;var _=[];return each(e,(function(e,t){t&&(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(t)&&(t=t[1]),"string"==typeof t&&_.push(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.escapeRE)(t)))})),new RegExp("^("+_.join("|")+")")},replyTo:function(e,_,t,o){var a=window.cur.wallLayer==e?wkcur:window.cur;Wall.showEditReply(e,o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,_);var i=a.reply_to&&Wall.getReplyName(a.reply_to[0]);a.reply_to=[t,_];var r=Wall.getReplyName(t),l=ge("reply_as_group"+e),s=e.match(/^(-?\d+)_([a-z]+)?(\d+)([a-z]+)?$/),n=s[1],d=s[2]||"",c=s[4]||"",p=ge("post"+n+d+"_"+_),u=p&&geByClass1("reply_to",p,"a"),b=Wall.replyNamesRE(),h=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",p)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",p),m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(h,"deep_active"),v=m?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",p):null,g=v?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(v,"post-id"):e,E="";if(!m||v){var w=(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(r)?r[0]:r)||"";w='<a class="reply_to_mem" onclick="return wall.showReply(this, \''+g+"', '"+n+d+"_"+_+c+"', event);\">"+w+"</a>";var O='<span class="reply_to_cancel" onclick="return Wall.cancelReplyTo(\''+g+"', event);\"></span>",P='<div class="reply_to_label">'+langStr(getLang("global_reply_to"),"user",w)+"</div>";E=m?P+O:O+P}if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to_title"+g,E),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(r)&&r[1]&&window.Emoji){var D=ge("reply_field"+g),f=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Emoji.val(D)));!(f=f.replace(/&nbsp;/g," "))||i&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(i)&&!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.winToUtf)(i[1]).indexOf(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.winToUtf)(f))?Emoji.val(D,r[1]):b&&(f=f.replace(b,r[1]),Emoji.val(D,f));var M=Wall.emojiOpts[e];M>=0&&Emoji.opts[M]&&Emoji.opts[M].onChange&&Emoji.opts[M].onChange(),Emoji.focus(D,!0)}if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)("reply_to_title"+g,E),l){var C=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(l.parentNode)&&n<0&&u&&u.getAttribute("rid")===n;Wall.setReplyAsGroup(l,{from:C?n:vk.id})}return a.onReplyFormSizeUpdate&&a.onReplyFormSizeUpdate(),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(o),!1},cancelReplyTo:function(e,_){var t=window.cur.wallLayer==e?wkcur:window.cur,o=ge("reply_field"+e),a=t.reply_to&&Wall.getReplyName(t.reply_to[0]),i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(window.Emoji?Emoji.editableVal(o):"")),r=Wall.replyNamesRE(),l=ge("post"+e),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",l)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",l),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(s,"deep_active");if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(a)&&a[1]&&window.Emoji){i&&a[1].indexOf(i)?r&&(i=i.replace(r,""),Emoji.val(o,i)):(i="",Emoji.val(o,i));var d=Wall.emojiOpts[e];d>=0&&Emoji.opts[d]&&Emoji.opts[d].onChange&&Emoji.opts[d].onChange(),Emoji.focus(o,!0)}if(hide("reply_to_title"+e),n){var c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(l,"answering-id");if(c){var p=e.split("_")[1];t.reply_to=[Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(c),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(p)],Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,p)}else t.reply_to=!1,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,"")}else window.mvcur&&mvcur.post==e?mvcur.mvReplyTo=!1:t.reply_to=!1,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e,"");return t.onReplyFormSizeUpdate&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(t.onReplyFormSizeUpdate)&&t.onReplyFormSizeUpdate(o),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(_),!1},replySubmitTooltip:function(e,_,t){var o=e&&window.cur.wallLayer==e?wkcur:window.cur,a=e&&(ge("reply_box"+e)||ge("reply_fakebox"+e)),i=a&&geByClass1("button_blue",a,"div"),r=o.replySubmitSettings;if(!(t&&i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(i)))if(t=t||i,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"flat_button")&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isButtonLocked)(t)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"button_disabled"))!_&&r&&r.tt&&r.tt.hide&&r.tt.hide();else if(r||(r=o.replySubmitSettings=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{className:"reply_submit_hint_tt_point"})),_){if(t)if(r.parentNode==t&&r.tt&&r.tt.show)r.tt.show();else{r.tt&&r.tt.el&&r.tt.destroy(),t.insertBefore(r,t.firstChild);var l=Wall.customCur().wallTpl.reply_multiline?1:0,s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(Wall.customCur().wallTpl.reply_multiline_hint,{enabled:l?"on":"",disabled:l?"":"on"}),n=a&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",a)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",a)),d=n&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n,"deep_active");Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(r,{text:s,typeClass:"tt_default_right",slide:15,shift:d?[15,8]:[0,8],asrtl:1,hasover:1,toup:!1,showdt:700,hidedt:700,dir:"auto",noZIndex:!0,onCreate:function(){radioBtns.reply_submit={els:Array.prototype.slice.apply(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("radiobtn",ge("reply_submit_hint_opts"))),val:s?1:0}}})}}else r&&r.tt&&r.tt.hide&&r.tt.hide()},onReplySubmitChanged:function(e,_){if(cur.wallTpl.reply_multiline=e,Wall.customCur().wallTpl&&(Wall.customCur().wallTpl.reply_multiline=e),_){var t=cur.replySubmitSettings;t&&t.tt&&t.tt.el&&t.tt.destroy()}else ajax.post("al_wall.php",{act:"a_save_ctrl_submit",value:e,hash:Wall.customCur().wallTpl.poll_hash}),window.Notifier&&Notifier.lcSend("wall_reply_multiline",{value:e})},getReplyFromId:function(e){var _=ge("reply_as_group"+e);return!(!_||!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(_.parentNode))&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_submit_post_box",_),"from-oid")},showCheckTimer(e,_,t){var o=ge("reply_field"+e),a=ge("reply_box"+e),i=a&&geByClass1("WallCheckComment__timer",a);if(o&&i){Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(o,{text:t.description,showdt:0,hidedt:0,shift:[0,-1],width:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(o)[0],forcetoup:!0,nohide:!0,noZIndex:browser.msie_edge,className:"WallCheckComment__tt"}),geByTag("span",i).forEach(e=>{e.style.animationDuration=t.delay+"s"}),a.classList.add("WallCheckComment--shown");var r=setTimeout(()=>{a.classList.remove("WallCheckComment--shown"),Wall.sendReply(e,void 0,_)},1e3*t.delay);i.timeout=r,i.onclick=()=>{Wall.hideCheckTimer(e,"button")},cur.destroy||(cur.destroy=[]),cur.destroy.push(()=>{r&&clearTimeout(r)}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)(o)}},hideCheckTimer(e){var _=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=ge("reply_field"+e),o=ge("reply_box"+e),a=o&&geByClass1("WallCheckComment__timer",o);if(t&&a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"check_timestamp");_&&i&&Wall.isCheckTimerShown(e)&&ajax.post("al_wall.php",{act:"check_comment_cancelled",post_raw:e,timestamp:i,reason:_}),a.timeout&&clearTimeout(a.timeout),t.tt&&t.tt.hide&&t.tt.hide(),o.classList.remove("WallCheckComment--shown"),"button"===_&&setTimeout(()=>Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)(t),0)}},isCheckTimerShown(e){var _=ge("reply_box"+e);return _&&_.classList.contains("WallCheckComment--shown")},sendReply:function(e,_,t){t=extend({},t);var o,a=ge("replies_wrap_deep"+e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("reply_to"+e);if(a?(o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",a)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",a),"post-id"),i=i||e.split("_")[1]):o=e,window.mvcur&&mvcur.post==o)return Videoview.sendComment(o,_,t);var r,l,s,n=window.cur.wallLayer==o,d=n?ge("wl_post"):ge("post"+o),c=ge("replies"+e),p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(d,"deep_active"),u=n?wkcur:window.cur,b=ge("reply_field"+e),h=b&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(b,"composer"),m=u.reply_to&&Wall.getReplyName(u.reply_to[0]),v=b&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(b,"send");if(v&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(v))return v(e,_,t);if(t.stickerId)l={message:"",attach1_type:"sticker",attach1:t.stickerId,sticker_referrer:t.sticker_referrer};else if(t.suggest)l={message:t.suggest};else{if((l=h?Composer.getSendParams(h,Wall.sendReply.pbind(e)):{message:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Emoji.editableVal(b))}).delayed)return;if(!l.attach1_type&&(!l.message||Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(m)&&m[1]&&!m[1].indexOf(l.message)))return void Emoji.editableFocus(ge("reply_field"+e),!1,!0)}var g=window.wkcur&&ge("wk_content");if(b&&(g&&g.contains(b)?wkcur.wallCheckComments:u.wallCheckComments)){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_in_progress"))return;if(!(s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_timestamp")||void 0))return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(_),void ajax.post("al_wall.php",{act:"check_comment",post_raw:o,text:l.message},{onDone(_){_&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_timestamp",_.timestamp),_.description&&_.delay)?Wall.showCheckTimer(e,t,_):Wall.sendReply(e,void 0,t)},onFail:()=>(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_timestamp",Date.now()),Wall.sendReply(e,void 0,t),!0),showProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_in_progress",!0)},hideProgress(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_in_progress",null)}});if(Wall.isCheckTimerShown(e))return void Wall.hideCheckTimer(e,"button");Wall.hideCheckTimer(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(b,"check_timestamp",null)}t.stickerId||t.suggest||(h?r=Composer.reset(h):window.Emoji&&Emoji.val(b,""),b.autosize&&b.autosize.update()),u.wallMyOpened=u.wallMyOpened||{},u.wallMyReplied[o]=1,u.wallMyOpened[o]=1;var E=ge("post_hash"+o)?ge("post_hash"+o).value:u.options.post_hash,w=null,O=p&&(a||!n&&"full"!==u.wallType),P=wall.getRepliesOrder(o),D=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(c,"top-ids"),f=!1;if(O&&c){var M=!a&&wall.isDescRepliesOrder(o,P)?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(c):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domLC)(c);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(M,"replies_next")&&(O=!1,f=!0)}extend(l,{act:"post",type:u.wallType,reply_to:o,reply_to_msg:i,reply_to_user:u.reply_to&&u.reply_to[0]||0,start_id:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("start_reply"+o),from:n?"wkview":"",hash:E,only_new:O?1:0,need_last:f?1:0,order:P,top_replies:D||null,timestamp:s}),u.reverse&&(l.rev=1);var C,T=wall.getReplyFromId(e);if(T&&(l.from_oid=T),C=u.wallType?"feed"==u.wallType?"news"==u.section?"feed_"+(u.subsection?u.subsection:u.section):"recommended"==u.section?"feed_recommended"+("recent"!=u.subsection?"_"+u.subsection:""):-1!==["friends","groups","videos","photos","list"].indexOf(u.section)?"feed_"+u.section+(u.subsection?"_"+u.subsection:""):"feed_"+u.section:"top"==u.wallType?"wall_top":"wall_"+(u.onepost?"one":(u.wallType||"").indexOf("full_")?"page":"full"):u.module,extend(l,{ref:C}),browser.mobile?Wall.hideEditReply(e):(Emoji.editableFocus(b,!1,!0),Wall.cancelReplyTo(e,_)),hide("reply_warn"+e),ajax.post("al_wall.php",Wall.fixPostParams(l),{onDone:function(_,t,a,i){if(p){if(O)return wall.onOnlyNewReplySent.apply(window,arguments);if(f)return wall.onLastChunkReplySent.apply(window,arguments);if(n)return wall.onNewReplySentLayer.apply(window,arguments)}if("full"===u.wallType)return p?FullWall.onNewReplySent.apply(window,arguments):FullWall.onReplySent.apply(window,arguments);u.wallMyReplied[o]=0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("reply_link"+o),hide("reply_warn"+o),Wall._repliesLoaded(e,!1,t,a,i),Wall.processPostReplyActions(_)},onFail:function(e){if(w&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(w),h?r=Composer.restore(h,r):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(b,l.message),b.autosize&&b.autosize.update(),e)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("global_error"),e),!0},showProgress:function(){p?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disableButton)(ge("reply_button"+e),!0):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(ge("reply_button"+e))},hideProgress:function(){p?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disableButton)(ge("reply_button"+e),!1):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(ge("reply_button"+e))}}),window.cur.onPostReply&&window.cur.onPostReply(e),!l.from_oid&&l.message&&!O){var L=-++u.wallMyRepliesCnt,A=Emoji.emojiToHTML(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(l.message),!0),y=wall.getReplyNames(),I=l.reply_to_user<0?getLang("wall_replied_to_group"):y[l.reply_to_user]&&y[l.reply_to_user][0],B=I?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(u.wallTpl.reply_link_to,{to_user:I}):"";if(w=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(u.wallTpl.reply_fast,{reply_id:"0_"+L,message:A.replace(/\n/g,"<br/>"),to_link:B,date:Wall.getNowRelTime(u)})),c&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(c)||ge("reply_link"+e))Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("reply_link"+e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("replies_wrap"+e);else if(!u.onepost){var j=c.nextSibling;if(j&&"replies_open"==j.className&&Wall.openNewComments(e),!n){var W=geByClass1("wr_header",c,"a"),R=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",c,"div").length+1,U=R;W&&(U=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(W.getAttribute("offs").split("/")[1])+1),(U>5||R<U)&&(W||c.insertBefore(W=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("a",{className:"wr_header"}),c.firstChild),Wall.updateRepliesHeader(e,W,R,U))}}u.reverse?c.insertBefore(w,c.firstChild):c.appendChild(w),n&&(WkView.wallUpdateReplies(),u.reverse||(wkLayerWrap.scrollTop=wkLayerWrap.scrollHeight,WkView.wallUpdateRepliesOnScroll()))}},onOnlyNewReplySent:function(e,_,t){var o=ge("post"+e),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"reply"),i=a?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",o)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",o):o,r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"post-id"),l=!a&&wall.isDescRepliesOrder(r);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"deep_active")){var s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",o);a&&s&&(e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"post-id"));var n=cur.wallLayer===r,d=Wall._getRepliesInfoBeforeAddNewReply(e,n),c=Wall._checkVisibilityBeforeAddNewReply(e,d,l,n);a&&wall.addDeepRepliesBlock(e);var p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(_);l&&d.repliesListEl.firstChild?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(p,d.repliesListEl.firstChild):d.repliesListEl.appendChild(p),Wall._fixScrollAfterAddNewReply(e,d,c,l,n),a&&wall.updateCollapseDeepReplies(e),Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(p),wall.incReplyCounter(i),wall.addReplyNames(t)}},onLastChunkReplySent:function(e,_,t,o,a,i){var r=ge("post"+a),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(r,"reply"),s=l?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",r)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",r):r,n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"post-id"),d=!l&&wall.isDescRepliesOrder(n);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(s,"deep_active")){var c=cur.wallLayer===n,p=Wall._getRepliesInfoBeforeAddNewReply(a,c),u=Wall._checkVisibilityBeforeAddNewReply(a,p,d,c);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(p.repliesListEl,_),Wall._fixScrollAfterAddNewReply(a,p,u,d,c);var b=ge("post"+i);Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(b),l&&wall.updateCollapseDeepReplies(a),wall.incReplyCounter(s,1,e),wall.addReplyNames(o)}},_getRepliesInfoBeforeAddNewReply:function(e,_){var t=_?wkLayerWrap.scrollTop:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),o=window.innerHeight||document.documentElement.clientHeight,a=t+(_?0:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("page_header_cont")[1]),i=t+o,r=ge("replies"+e),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(r,_)[1],s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(r)[1];return{repliesListEl:r,scrollY:t,topY:a,bottomY:i,viewportHeight:o,repliesListY:l,repliesListH:s,repliesListEndY:l+s,layerFieldH:_?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("wl_reply_form")[1]:0}},_checkVisibilityBeforeAddNewReply:function(e,_,t,o){return t?o?_.repliesListY>0&&_.repliesListY<_.viewportHeight-_.layerFieldH:_.topY<_.repliesListY&&_.bottomY>_.repliesListY:o?_.repliesListEndY>0&&_.repliesListEndY<_.viewportHeight-_.layerFieldH:_.topY<_.repliesListEndY&&_.bottomY>_.repliesListEndY},_fixScrollAfterAddNewReply:function(e,_,t,o,a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(_.repliesListEl)[1];if(o)t||Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(_.repliesListY-100,300,!1,!0);else if(t){var r=_.scrollY+i-_.repliesListH;a?wkLayerWrap.scrollTop=r:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(r,0,!1,!0)}else{var l=_.repliesListY+i-300;a?Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animate)(wkLayerWrap,{scrollTop:_.scrollY+l},300):Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(l,300,!1,!0)}},incReplyCounter:function(e,_,t){_=_||1;var o,a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"post-id"),i=geByClass1("comment",e);i&&(t||(o=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"count"),t=Math.max(0,o+_)),Likes.update("wall"+a,{comment_num:t}))},onNewReplySentLayer:function(e,_,t,o){var a=ge("wl_post"),i=geByClass1("wl_replies",a);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(i,_);var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(i).filter((function(e){return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"reply")})).length;extend(wkcur,{offset:t,loaded:r,count:e}),wall.addReplyNames(o),WkView.wallUpdateReplies();var l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"post-id");wall.isDescRepliesOrder(l)?wkLayerWrap.scrollTop=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(a)[1]-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("wl_replies_wrap")[1]-30:wkLayerWrap.scrollTop=wkLayerWrap.scrollHeight,WkView.wallUpdateRepliesOnScroll()},postTooltip:function(e,_,t,o){if(!cur.viewAsBox){var a=(t||{}).reply,i=(t||{}).className||"",r=a&&!(a%2)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(e)[0]>420;o=o||{},a||(o.appendEl=bodyNode),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,extend({url:"al_wall.php",params:extend({act:"post_tt",post:_},t||{}),slide:15,shift:[r?417:27,6,6],ajaxdt:100,showdt:400,hidedt:200,dir:"auto",className:"rich wall_tt"+i,typeClass:r?"tt_default_right":"tt_default"},o))}},adsMarkTooltip:function(e){cur.viewAsBox||Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{black:1,shift:[15,7,0],text:e.getAttribute("data-tooltip")})},hideEditPostReply:function(e,_){if(!1!==cur.editing&&(cur.wallLayer&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)("wl_post","deep_active")&&(_=!0),_||!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(boxLayerBG)&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(layerBG))){var t=e&&e.target?e.target:{},o=t.id;cur.editing?cur.editingHide?cur.editingHide(cur.editing,t):e&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_reply_wrap",t)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"reply_link")||o=="reply_field"+cur.editing||"reply_to_link"==t.className)||Wall.hideEditReply(cur.editing):(cur.wallAddMedia||{}).chosenMedia||e&&"post_field"==o||Wall.hideEditPost()}},postShowDeletedMessage:function(e,_){var t=ge("post"+e);if(t){var o=geByClass1("_post_content",t)||geByClass1("feedback_row_t",t);Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(o),hide(o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(o),"post_publish")&&hide(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(o));var a="post_del"+e,i=ge(a),r='<span class="dld_inner">'+_+"</span>";return i?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(i,r),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(i)):t.appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{id:a,className:"dld",innerHTML:r})),!0}return!1},postHideDeletedMessage:function(e){var _=ge("post"+e);if(_){var t=geByClass1("_post_content",_)||geByClass1("feedback_row_t",_);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(t),"post_publish")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(t));var o=ge("post_del"+e);return hide(o),!0}return!1},isArchiveWall:function(){return cur.pgParams&&cur.pgParams.archive||"wall_archive"===cur.module},rollbackPostsArchiveState:function(e,_,t){if(Wall.isArchiveWall()&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.linkLocked)(e)){var o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.split("_")[1]);ajax.post("al_wall_archive.php",{act:"a_rollback_state",from:ge("page_wall_more_tab")?"profile":"wall",postId:o,hash:t},{onDone:function(e){cur.wallArchiveRolledback=!0,Wall.postShowDeletedMessage(_,e)},showProgress:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockLink)(e),hideProgress:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockLink)(e)})}},restoreLastRollbackPostsArchiveState:function(e,_,t){if(Wall.isArchiveWall()&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.linkLocked)(e)){var o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_.split("_")[1]);ajax.post("al_wall_archive.php",{act:"a_restore_last_rollback",from:ge("page_wall_more_tab")?"profile":"wall",postId:o,hash:t},{onDone:function(e){delete cur.wallArchiveRolledback,Wall.postShowDeletedMessage(_,e)},showProgress:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockLink)(e),hideProgress:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockLink)(e)})}},postSetArchiveState:function postSetArchiveState(actionEl,postRaw,hash,state,isRollback){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.actionsMenuItemLocked)(actionEl)&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.linkLocked)(actionEl)){var postId=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(postRaw.split("_")[1]),isActionMenuItem=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(actionEl,"ui_actions_menu_item"),localCur=cur.wallLayer?wkcur:cur;localCur&&(localCur.wallMyDeleted||(localCur.wallMyDeleted={}),localCur.wallMyDeleted[postRaw]=!Wall.isArchiveWall()==!state?0:1);var extended=!isRollback&&(Wall.isArchiveWall()?cur.wallArchiveRestored>=3&&!cur.wallArchiveRolledback:!cur.wallArchiveArchived);ajax.post("al_wall_archive.php",{act:"a_set_state",from:ge("page_wall_more_tab")?"profile":cur.pid?"post":"wall",hash,state:state?1:void 0,extended:extended?1:void 0,postId},{onDone:function onDone(msg,js){if(Wall.isArchiveWall()&&(state=!state,isRollback||(cur.wallArchiveRestored||(cur.wallArchiveRestored=0),cur.wallArchiveRestored++)),state&&(cur.wallArchiveArchived=!0),isRollback?Wall.postHideDeletedMessage(postRaw):Wall.postShowDeletedMessage(postRaw,msg)){"full_own"==cur.wallType||"full_all"==cur.wallType?(Pagination.recache(state?-1:1),FullWall.updateSummary(cur.pgCount)):"full"==cur.wallType&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(postEl,"reply")&&(state?--cur.pgOffset:++cur.pgOffset,state?--cur.pgCount:++cur.pgCount,FullWall.repliesSummary(cur.pgCount));var postEl=ge("post"+postRaw);"own"!=cur.wallType&&"all"!=cur.wallType&&"archive"!=cur.wallType||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(postEl,"own")&&(state?++cur.deletedCnts.own:--cur.deletedCnts.own),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(postEl,"all")&&(state?++cur.deletedCnts.all:--cur.deletedCnts.all),Wall.isArchiveWall()&&(state?--cur.deletedCnts.archive:++cur.deletedCnts.archive),Wall.update())}if(js)try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,js)}},showProgress:isActionMenuItem?_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem.pbind(actionEl):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockLink)(actionEl),hideProgress:isActionMenuItem?_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem.pbind(actionEl):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockLink)(actionEl)})}},deletePost:function(e,_,t,o,a){(cur.wallLayer?wkcur:cur).wallMyDeleted[_]=1;var i=ge("post"+_),r=geByClass1("post_actions",i),l={act:"delete",post:_,hash:t,root:o?1:0,confirm:a?1:0,from:"wall"};cur.suggestedDeletedCount&&cur.suggestedDeletedCount>=2&&(l.delete_all=1),Object(_internal_nospam_common__WEBPACK_IMPORTED_MODULE_39__.isClaimContent)()&&(l._nol=JSON.stringify(window.nav.objLoc)),ajax.post("al_wall.php",l,{onDone:function(a,r,l){if(l)var s=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(a,l,getLang("global_delete"),(function(){s.hide(),wall.deletePost(e,_,t,o,1)}),getLang("box_cancel"));else{Wall.postShowDeletedMessage(_,a),"full_own"==cur.wallType||"full_all"==cur.wallType?(Pagination.recache(-1),FullWall.updateSummary(cur.pgCount)):"full"==cur.wallType&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"reply")&&(cur.pgOffset--,cur.pgCount--,FullWall.repliesSummary(cur.pgCount));var n=ge("post_publish_wrap"+_);n&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(n,"suggest")&&(void 0===cur.suggestedDeletedCount&&(cur.suggestedDeletedCount=0),cur.suggestedDeletedCount++),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"suggest")?Wall.suggestUpdate(-1):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"postponed")?wall.postponeUpdateCount():"own"!=cur.wallType&&"all"!=cur.wallType&&"archive"!=cur.wallType||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"own")&&++cur.deletedCnts.own,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"all")&&++cur.deletedCnts.all,Wall.isArchiveWall()&&++cur.deletedCnts.archive,Wall.update())}},showProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem)(e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"flat_button")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(e):addClass(r,"post_actions_progress")},hideProgress:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem)(e):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"flat_button")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(e):removeClass(r,"post_actions_progress")}});var s=ge("delete_post"+_);s&&s.tt&&s.tt.el&&s.tt.destroy()},markAsSpam:function markAsSpam(el,post,hash,inline){ajax.post("al_wall.php",{act:"spam",post,hash,from:inline?"inline":""},{onDone:function onDone(msg,js){if(inline)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(el).replaceChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:msg}),el);else{var r=ge("post"+post),t=geByClass1("_post_content",r)||geByClass1("feedback_row_t",r);Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(r);var pd=ge("post_del"+post);pd?(pd.innerHTML='<span class="dld_inner">'+msg+"</span>",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(pd)):r.appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{id:"post_del"+post,className:"dld",innerHTML:'<span class="dld_inner">'+msg+"</span>"})),hide(t)}if(js)try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,js)}},showProgress:function(){el&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(el,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem)(el):inline&&(hide(el),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(el)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(el).appendChild(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span",{className:"progress_inline"}))))},hideProgress:function(){el&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(el,"ui_actions_menu_item")?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem)(el):inline&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(el),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(el)))},stat:[jsc("web/privacy.js"),"privacy.css"]});var btn=ge("delete_post"+post);btn&&btn.tt&&btn.tt.el&&btn.tt.destroy()},ignoreAdsItem:function(e,_,t){var o=ge("post"+e),a=o.getAttribute("data-ad"),i=geByClass1("ui_actions_menu_wrap",o);o&&(i&&uiActionsMenu.toggle(i,!1),Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(o),ajax.post("/al_feed.php?misc",{act:"a_ignore_item",post_raw:e,feed_raw:_,hash:t,ad_data:a,no_html:1},{onDone:function(){hide(o)}}))},ignoreAdsOwner:function(e,_,t,o){var a=ge("post"+e);a&&ajax.post("/al_feed.php?misc",{act:"a_ignore_owner",post_raw:e,owner_id:_,hash:t,list:0,no_html:1},{onDone:function(e){hide(a)},showProgress:o&&_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(o),hideProgress:o&&_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(o)})},markAsAds:function(e,_,t,o){ajax.post("al_wall.php",{act:"mark_as_ads",post:e,hash:_,full:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(o)},{onDone:function(_){ge("ui_actions_menu_item_mark_as_ads"+e).innerHTML=_}})},restorePost:function(e,_,t){return(cur.wallLayer?wkcur:cur).wallMyDeleted[e]=0,ajax.post("al_wall.php",{act:"restore",post:e,hash:_,root:t?1:0},{onDone:function(_){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("post_del_btn"+e),Wall.postHideDeletedMessage(e)){var t=ge("post"+e);"full_own"==cur.wallType||"full_all"==cur.wallType?(Pagination.recache(1),FullWall.updateSummary(cur.pgCount)):"full"==cur.wallType&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"reply")&&(cur.pgOffset++,cur.pgCount++,FullWall.repliesSummary(cur.pgCount)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"suggest")?Wall.suggestUpdate(1):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"postponed")?wall.postponeUpdateCount():"own"!=cur.wallType&&"all"!=cur.wallType&&"archive"!=cur.wallType||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"own")&&--cur.deletedCnts.own,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"all")&&--cur.deletedCnts.all,Wall.isArchiveWall()&&--cur.deletedCnts.archive,Wall.update())}}}),!1},blockPostApp:function(e,_,t,o){ajax.post("al_wall.php",{act:"block_post_app",aid:e,from:_,hash:t},{onDone:function(e){o.parentNode.parentNode.innerHTML=e},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(o),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(o)})},checkPostClick:function(e,_,t){if(_=_||window.event,!e||!_)return!0;var o=_.target||_.srcElement,a=8,i=!1,r=/wall_post_text|published_comment|post_media|page_event_share|page_public_share|page_group_share|feed_friends|feed_videos|feed_explain_list|explain|feed_photos|feedback_row/;do{if(!o||o==e||o.onclick||o.onmousedown||Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(o.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(o.className,["play_new","video_box_wrap"])||(i=o.className.match&&o.className.match(r)))break}while(a--&&(o=o.parentNode));if(!i)return!1;if(cur.postClicked||(cur.postClicked={}),!t||!cur.postClicked[e]){if(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||document.selection&&document.selection.createRange().text||"").toString()))return!1;t&&(cur.postClicked[e]=!0,setTimeout((function(){cur.postClicked[e]=!1}),2e3))}return o||!0},postClick:function(e,_,t){t=t||{};var o,a=(e||"").match(/^(-?\d+)_(wall)?(\d+)$/),i=ge("post"+e);if(o=!!t.skipCheck||Wall.checkPostClick(i,_)){if(!0!==o){var r=geByClass1("wall_post_more",o,"a");if(r&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(r))return r.onclick(),void(a||removeClass(i,"wall_post_over"))}if(a&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(i,"suggest")&&!cur.onepost){var l=i&&i.getAttribute("data-ad"),s=i&&i.getAttribute("data-ad-block-uid"),n="/wall"+a[1]+"_"+a[3];if(browser.mobile&&_){var d={};l&&s&&(d.params={_post_ad_data:l,_post_ad_block_unique_id:s}),nav.go(n,null,d)}else Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.checkEvent)(_)?window.open(n,"_blank"):(l&&s&&(t.ads_params={post_ad_data:l,ad_block_unique_id:s}),Wall.hideEditPostReply(),Wall.postFull("wall"+a[1]+"_"+a[3],!1,t))}}},postClickStat:function(e){var _=(e=Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.normEvent)(e)).currentTarget,t=[];_.getAttribute("data-ad-view")&&(t.push(Wall.postsGetRaws(_)),Page.postsSeen(t));var o=e.target;Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(o.getAttribute("data-post-click-type"),["post_owner_img","post_owner_link"])||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"author")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"post_image")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"post_img")?Wall.triggerAdStat(_,"click_post_owner"):("A"==e.target.nodeName&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wall_post_text",e.target,_)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("page_media_thumbed_link",e.target,_)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e.target,"lnk")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("lnk",e.target,_))&&Wall.triggerAdStat(_,"click_post_link")},adBlockClickStat:function(e,_){var t=(e=Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.normEvent)(e)).currentTarget;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"_ads_block_data_w")||(t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_ads_block_data_w",t));var o=[];t.getAttribute("data-ad-view")&&(o.push(Wall.postsGetRaws(t)),Page.postsSeen(o)),Wall.triggerAdStat(t,_)},getAdsEvents:function(){var e=Wall._lsAdsEvents;return e||(e=Wall._lsAdsEvents=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get(Wall.LS_ADS_EVENTS)||{}),e},cleanAdsEvents:function(){var e=Wall.getAdsEvents(),_=(new Date).getTime()/1e3|0,t=!1;each(e,(function(o,a){_-a>=3600&&(delete e[o],t=!0)})),t&&_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set(Wall.LS_ADS_EVENTS,e)},triggerAdPostStat:function(e,_){Wall.triggerAdStat(e,_)},triggerAdStat:function triggerAdStat(elIdOrEl,event){for(var el="string"==typeof elIdOrEl?Wall.domPost(elIdOrEl):elIdOrEl,pixels=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-stat-"+event);pixels;){var adBlockUID=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-block-uid"),isUniqueEvent=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(event,["load","impression","impression_long","video_start","video_play_3s","video_play_10s","video_play_25","video_play_50","video_play_75","video_play_95","video_play_100"]);if(isUniqueEvent&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-disabled-stat-"+event,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-stat-"+event)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-stat-"+event,null)),adBlockUID&&isUniqueEvent)try{var eventKey=Object(_web_lib_utils__WEBPACK_IMPORTED_MODULE_31__.hashCode)(""+event+adBlockUID),lsData=Wall.getAdsEvents();if(lsData[eventKey])break;var now=(new Date).getTime()/1e3|0;lsData[eventKey]=now,_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set(Wall.LS_ADS_EVENTS,lsData)}catch(e){try{console.log(e.message)}catch(e){}}pixels=pixels.split("$$$"),each(pixels,(function(e,_){Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.vkImage)().src=_}));break}var statHtml=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-stat-html-"+event);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(el,"ad-stat-html-"+event,null),statHtml)for(var statElemWrap=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:statHtml}),elem;elem=statElemWrap.firstChild;)if(el.appendChild(elem),"SCRIPT"===elem.tagName)try{eval(elem.innerHTML)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,elem.innerHTML)}},copyHistory:function(e,_,t,o){var a=(e=e||window.event).target||e.srcElement,i=8,r=!1,l=/published_a_quote/;do{if(!a||(r=a.className.match(l))||a.onclick||a.onmousedown||Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(a.tagName,["A","IMG"]))break}while(i--&&(a=a.parentNode));if(r&&!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||document.selection&&document.selection.createRange().text||"").toString()))return ajax.post("al_wall.php",{act:"copy_history",post:t,offset:o,from:cur.module},{onDone:function(e){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(_)&&(hide(_),e)){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(_),"published_by_quote")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(_):_;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(t).insertBefore(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(t)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isAncestor)(t,"im_rows")?IM.updateScroll(!0):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isAncestor)(t,"wl_post")&&WkView.wallUpdateReplies()}}}),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e)},postFull:function(e,_,t){if(e.match(/^wall-?\d+_\d+$/)&&!(t||{}).nolist&&(!cur.pgParams||!cur.pgParams.owners_only&&!cur.pgParams.q))switch(cur.wallType){case"all":case"full_all":e+="/all"}return Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__.showWiki)({w:e},!1,_,t)},checkReplyClick:function(e,_){if(_=_||window.event,!e||!_)return!1;var t=_.target||_.srcElement,o=8,a=!1;do{if(!t||t==e||t.onclick||t.onmousedown||"A"==t.tagName&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"_reply_lnk")||Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(t.tagName,["IMG","TEXTAREA","EMBED","OBJECT"])&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"emoji")||"wpe_cont"==t.id||(a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"_reply_content")))break}while(o--&&(t=t.parentNode));return!a||!!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||document.selection&&document.selection.createRange().text||"").toString())},replyClick:function(e,_,t,o){var a=e.split("_"),i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(a[0]),r=a[1].replace(/-?\d+$/,""),l=ge("post"+i+r+"_"+_),s=ge("post"+e);if(!(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(s,"closed_comments")||!cur.stickerClicked&&Wall.checkReplyClick(l,t))){(t||{}).cancelBubble=!0;var n=geByClass1("wall_reply_more",l,"a");if(n&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(n))return removeClass(l,"reply_moreable"),void n.onclick();if(o){s=cur.wallLayer?ge("wl_post"):s;var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(s,"deep_active"),c=cur.stickerClicked||!1,p=e;if(d){var u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",l);p=u?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(u,"post-id"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(l,"post-id")}var b=ge("reply_field"+p);cur.stickerClicked=!1,!c||b&&b.emojiInited||(cur.afterEmojiInit=cur.afterEmojiInit||{},cur.afterEmojiInit[p]=function(){Emoji.clickSticker(c,ge("reply_field"+p))}),Wall.replyTo(p,_,o,t),c&&b&&b.emojiInited&&Emoji.clickSticker(c,b)}}},stickerClick:function(e,_,t){if((t||{}).cancelBubble=!0,window.Emoji)if(_){var o=Emoji.isStickerPackEnabled(e,Wall.stickerClick.pbind(e,_));if(0!==o)if(o){var a=_.parentNode,i=8;do{if(!a||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"reply"))break}while(i--&&(a=a.parentNode));a&&a.onclick&&(cur.stickerClicked=e,a.onclick())}else Emoji.clickSticker(e,!1)}else Emoji.clickSticker(e,!1);else stManager.add([jsc("web/emoji.js"),"notifier.css"],(function(){Wall.stickerClick(e,_)}))},domPost:function(e){return ge("post"+e)},formatCount:function(e,_){return _=_||{},Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.formatCount)(e,_)},likeFullUpdate:function(e,_,t){var o=_.match(/^(wall|photo|video|note|topic|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(-?\d+_)(\d+)/);Likes.update(o?(o[1]||"wall")+o[2]+o[3]:_,t)},likeUpdate:function(e,_,t,o,a,i,r){r||(o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(o)),!1===e&&cur.wallLayer===_&&(e=ge("wl_post_body"));var l=_.match(/(-?\d+)(_?)(photo|video|note|topic|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(\d+)/),s=l[1]+"_"+l[4],n=e&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_content",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",e))||wall.domPost(s),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(n,r?"_views_wrap":i?"_share_wrap":"_like_wrap"),c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(d,"_count");if(c){if(!r&&!i){var p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(n,"_views_wrap"),u=p&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(p,"_count");!u||!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(p,"_auto_update")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(u)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(u)!=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(c)||wall.likeUpdate(e,_,0,this.formatCount(o),void 0,void 0,1)}var b=d.tt||{},h=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(b.opts||{}),m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(b.container,"_value"),v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(b.container,"_content"),g=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(b.container,"_title");a&&g&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(g,a),b&&(b.likeInvalidated=!0),m&&(m.value=o),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animateCount)(c,r?o:Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(o,"%s",!0),{str:"auto",noWrapWidth:!!r}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(d,i?"my_share":"my_like",t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(d,r?"no_views":i?"no_shares":"no_likes",!o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(v,"me_hidden",!t&&!r),o?b.el&&(!1===a?b.destroy&&b.destroy():Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(b.container)||a||!1===a||tooltips.show(b.el,extend(h,{showdt:0}))):b.el&&b.hide();var E=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(o,"%s",!0);if(r){var w=geByClass1("feedback_views",n),O=0;O=o.match(/^\d+$/)?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(o):5,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(w,"<em>"+o+"</em> "+getLang("global_X_post_views",O,!0))}else if(i){var P="";o>0&&(P="<em>"+E+"</em> "+getLang("global_X_shared",o,!0)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(geByClass1("feedback_share",n),P)}else{var D="";o>0&&(D="<em>"+E+"</em> "+getLang("global_like")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(geByClass1("feedback_like",n),D)}Wall.updateFeedbackVisibility(n)}},updateFeedbackVisibility:function(e){var _=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(geByClass1("feedback_views",e))),t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(geByClass1("feedback_share",e))),o=!Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(geByClass1("feedback_like",e)))&&!t&&!_;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(geByClass1("post_feedback_info",e),"empty",o)},likeShareUpdate:function(e,_,t,o,a){return Wall.likeUpdate(e,_,t,o,a,!0)},like:function(e,_){if(vk.id&&!cur.viewAsBox){var t=wall.domPost(e),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(t,"_like_wrap"),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(o,"_icon"),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(o,"_count"),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"fw_like_icon")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(a,"fw_my_like"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(o,"my_like"),l=e.match(/(-?\d+)(_?)(photo|video|note|topic|market|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(\d+)/),s=(l[3]||"wall")+l[1]+"_"+l[4],n=cur.module;cur.wallType&&(n="feed"==cur.wallType?"feed_"+("news"==cur.section&&cur.subsection?cur.subsection:cur.section):"top"==cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full")),ajax.post("like.php",{act:"a_do_"+(r?"un":"")+"like",object:s,hash:_,wall:2,from:n},{onDone:Wall.likeFullUpdate.pbind(!1,e)});var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(i);Wall.likeUpdate(!1,e,!r,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(d)+(r?-1:1)),cur.onWallLike&&cur.onWallLike()}},bookmark:function(e,_){Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_),addClass(e,"bookmarked")},likeShare:function(e,_){if(vk.id&&!cur.viewAsBox){var t=e.match(/(-?\d+)(_?)(photo|video|note|topic|market|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(\d+)/),o=(t[3]||"wall")+t[1]+"_"+t[4],a=ge("like_share_"+o),i=Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(a),r=cur.wallType?"feed"==cur.wallType?"feed_"+cur.section:"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module;"top"==cur.wallType&&(r="wall_top"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(a),ajax.post("like.php",{act:"a_do_"+(i?"un":"")+"publish",object:o,hash:_,wall:2,ref:r},{onDone:Wall.likeFullUpdate.pbind(!1,e)});var l=wall.domPost(e),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(l,"_like_wrap"),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(s,"_icon"),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(l,"_count")),c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n,"fw_like_icon")?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n,"fw_my_like"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(s,"my_like");Wall.likeUpdate(!1,e,!0,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(d)+(c?0:1))}},likeShareCustom:function(e,_){var t=e.match(/(-?\d+)(_?)(photo|video|note|topic|market|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(\d+)/),o=(t[3]||"wall")+t[1]+"_"+t[4];Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("like.php",extend({act:"publish_box",object:o},_))},likeShareCheckLen:function(e,_,t){e=ge(e),_=ge(_),t=t||255;var o=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e)).replace(/\n\n\n+/g,"\n\n");if(e.lastLen!==o.length){var a=e.lastLen=o.length,i=a-o.replace(/\n/g,"").length;a>t-50||i>4?(a>t?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,getLang("text_exceeds_symbol_limit",a-t)):i>4?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,getLang("global_recommended_lines",i-4)):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,getLang("text_N_symbols_remain",t-a)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(_)):hide(_)}},showLikesPage:function(e,_,t){cur.likesBox.loadTabContent("like.php",{act:"a_get_members",object:e,published:_,offset:t,wall:1},_)},clearLikesCache:function(e,_){var t="^/like.php#"+Object(_shared_lib_convert__WEBPACK_IMPORTED_MODULE_26__.toQueryString)({act:"a_get_members",object:e,published:_,offset:12345,wall:1,tab:_,only_content:1}).replace("12345","\\d+")+"$",o=new RegExp(t,"i");for(var a in ajaxCache)o.test(a)&&delete ajaxCache[a]},subscribeByButton:function(e,_,t,o,a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_subscribed"),r={showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(e),onDone:function(){i=!i,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(e,"_subscribed",i)}},l={};_>0&&a&&(l.from=a),Wall.subscribeToAuthor(i,_,t,o,r,l)},subscribeByAction:function(e,_,t,o){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.actionsMenuItemLocked)(e)){var a=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"value"))?1:0,i={showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem.pbind(e)},r={};_>0&&o?r.from=o:_<0&&(i=extend(i,{onDone:function(o,r,l){if(r){var s=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("global_warning"),r,getLang("group_leave_group"),(function(){s.hide(),Wall.subscribeToAuthor(a,_,t,i,"",{confirm:1})}),getLang("global_cancel"));return!0}Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e,o),e.setAttribute("data-value",1-a),l&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e))}})),Wall.subscribeToAuthor(a,_,t,"",i,r)}},subscribeToAuthor:function(e,_,t,o,a,i){a=extend({onFail:function(e){setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("global_error"),e).hide,3e3)}},a),i=i||{},_>0?ajax.post("al_friends.php",extend({act:e?"remove":"add",mid:_,hash:t,from:"feed"},i),a):ajax.post("al_groups.php",extend({act:e?"list_leave":"list_enter",gid:-_,hash:t},i),a),o&&ajax.post("al_feed.php?act=viral_subscribe_stat",{author_id:_,subscribe:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(!e),hash:o})},showPhoto:function(e,_,t,o,a){return!Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("al_photos.php",{act:"photo_box",to_id:e,photo:_,hash:t},{cache:1},!!o.href&&a)},_animDelX:function(e,_,t,o){},domFC:function(e){for(e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(e);e&&e.id.match(/page_wall_count_/);)e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(e);return e},domPS:function(e){for(e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPS)(e);e&&e.id.match(/page_wall_count_/);)e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPS)(e);return e},scrollCheck:function(e,_,t){var o,a,i=null==_?Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)():_,r=0,l=[],s=window.innerHeight||document.documentElement.clientHeight||bodyNode.clientHeight;if(window.scrollAnimation)return!1;if((Wall.repliesSideUpdate(i),cur.wallPage)&&(a="suggested"==cur.wallTab?ge("page_suggested_posts"):"top"==cur.wallTab?ge("page_top_posts"):"donut"===cur.wallTab?ge("page_donut_posts"):ge("page_wall_posts"),(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(cur.topRow)!=a||((cur.topRow||{}).id||"").match(/page_wall_count_/))&&(cur.topRow=Wall.domFC(a)),vk.id&&cur.topRow&&!cur.topRow.id.match(/page_wall_count_/)&&!((window.curNotifier||{}).idle_manager||{}).is_idle)){for(var n=[],d=Wall.domPS(cur.topRow);d;d=Wall.domPS(d))cur.topRow.offsetTop>i&&(cur.topRow=d),d.unseen||(d.unseen=!0,n.push(Wall.postsGetRaws(d)));Page.postsUnseen(n);for(var c=cur.topRow;c;c=o){LongView&&LongView.register(c,"Wall");var p=r||c.offsetTop;if(p>=i+s)break;(((o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(c))||{}).id||"").match(/page_wall_count_/)&&(o=null),(r=o?o.offsetTop:p+c.offsetHeight)<i&&o&&(cur.topRow=o);var u=c.bits||0;u>=3||(u|=(p>=i&&p<i+s?1:0)|(r>=i&&r<i+s?2:0))&&(c.bits=u,3==u&&l.push(Wall.postsGetRaws(c)))}LongView&&LongView.onScroll(i,s),Page.postsSeen(l)}if(cur.wallAutoMore&&!cur.wallLoading&&!cur.viewAsBox){var b=ge("wall_more_link");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(b)&&i+lastWindowHeight+1500>Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(b)[1]&&b.onclick()}},postsGetRaws:function(e){var _,t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.indexOf)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e).children,e),o={};if(!e)return o;o.module=cur.module,o.index=t;var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_ads_promoted_post"),i=e.getAttribute("data-ad-view");i&&(o["ad_"+i]=1,a&&(o.module+="_ads_promoted_post"));var r=e.getAttribute("post_view_hash");if(r&&(o.hash=r),"block_"===e.id.substr(0,6)){o[e.id]=1,o.block=e.id.substr(6);var l=attr(e,"data-contain");l&&(l=l.split(",")).forEach((function(e){e=e.split(":"),o[e[0]]=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e[1])||1}))}else(_=e.id.match(/^post(-?\d+_\d+)$/))&&(o[_[1]]=1,(_=(e.getAttribute("data-copy")||"").match(/^(-?\d+_\d+)$/))&&(o[_[1]]=-1));return o},votingExtendParams:function(e,_){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"fixed")&&(e.is_fixed=1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"preview")&&(e.is_preview=1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"board")&&(e.is_board=1),vk.widget&&(e.is_widget=1,e.width=cur.widgetWidth,e.url=cur.url),cur.voteHash&&(e.vote_hash=cur.voteHash);var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"id");t&&(e.voting_id=t);var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"ref");o&&(e.ref=o);var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"hash");a&&(e.hash=a);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"material");return!i||e.is_board||e.is_widget||(e.material=i),e},votingRevote:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"id");if(this.votingIsLocked(t))return;var o=this.votingExtendParams({act:"revote"},_);ajax.post("al_voting.php",o,{onDone:this.votingUpdateFull.bind(this,t),showProgress:this.votingLock.bind(this,t),hideProgress:this.votingUnlock.bind(this,t)})}},votingIsLocked:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_media_voting"+e),t=!1;return _.forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"media_voting_locked")&&(t=!0)}),t},votingLock:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_media_voting"+e).forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"disabled")&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"queue")||addClass(e,"media_voting_locked")})},votingUnlock:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_media_voting"+e).forEach(e=>{removeClass(e,"media_voting_locked")})},votingUpdate:function(e,_){ajax.post("al_voting.php",{act:"get_layout",voting_id:e},{onDone:t=>{Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(_)&&!1===_(t)||(this.votingUpdateFull(e,t),this.votingUnlock(e))},onFail:()=>this.votingUnlock(e),showProgress:()=>this.votingLock(e)})},votingUpdateFull:function(e,_){if(e&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isString)(_)){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_media_voting"+e);t.length&&(t.forEach(e=>{if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"disabled")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"queue"))if(""===_)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e);else{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(_);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"media_voting_can_vote")){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(t);addClass(o,"media_voting_just_voted"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(e,t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.removeClassDelayed)(o,"media_voting_just_voted")}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(e,t)}}),window.IMBRIDGE&&setTimeout(IMBRIDGE.syncHistory.bind(IMBRIDGE),0),vk.widget&&window.WPoll&&window.WPoll.resizeWidget())}},votingUpdatePartly:function(e,_){if(e&&isObject(_)&&!this.votingIsLocked(e)){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_media_voting"+e);if(t.length){var o=_.answers.reduce((e,_)=>Math.max(e,_.rate),0),a={};_.answers.forEach(e=>{e.isLeader=e.rate===o,a[e.id]=e}),t.some(t=>{if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"disabled")){if(t.classList.contains("media_voting_voted")&&!_.votes)return this.votingUpdate(e),!0;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("media_voting_option_wrap",t).forEach(e=>{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"id"),o=a[t];if(e.tt&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isFunction)(e.tt.destroy)&&e.tt.destroy(),o){var i=geByClass1("media_voting_option_bar",e),r=geByClass1("media_voting_option_percent",e),l=geByClass1("media_voting_option_count",e),s=geByClass1("media_voting_option_counter",e),n=Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(o.votes,"%s",!0),d=new Array(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(n).textContent.split("").length+2).join("0");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domLC)(l),d),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domLC)(s),n),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(r,_.votes?o.rate:""),i.style.transform=`scaleX(${.01*o.rate})`,i.style.oTransform=`scaleX(${.01*o.rate})`,o.votes?l.classList.remove("media_voting_option_count_hidden"):(l.classList.add("media_voting_option_count_hidden"),e.classList.remove("media_voting_option_voted")),o.isLeader?e.classList.add("media_voting_option_leader"):e.classList.remove("media_voting_option_leader")}});var o=geByClass1("_media_voting_footer_voted_text",t);if(o){var i;i=_.votes?vk.widget?"voting_x_voted_short":"voting_x_voted":"voting_nobody_voted",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(o,getLang(i,_.votes,!0));var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("media_voting_footer_voted_friend",t);r.length>_.votes&&r.forEach(e=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(e)})}}}),window.IMBRIDGE&&window.IMBRIDGE.syncHistory(),vk.widget&&window.WPoll&&window.WPoll.resizeWidget()}}},votingUpdateByPostRaw:function(e){if(vk.id){e=e.split("_");var _=positive(e[1]),t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e[0]),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_media_voting"+t+"_"+_);if(o&&o.length){var a=geByClass1("media_voting",o[0]);if(a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"id");this.votingUpdate(i)}}}},votingVote:function(e,_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"id");if(!this.votingIsLocked(t)&&vk.id){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"queue"))return this.votingUpdate(t,e=>{if(e&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isString)(e)){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(e));if(t&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"queue")&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"disabled"))return this.votingVote(t,_,!0),!1}});if(_.length){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e),"wk_voting_box"),a=this.votingExtendParams({act:"vote",option_ids:_.join(",")},e);ajax.post("al_voting.php",a,{onDone:(e,_)=>{o?nav.reload():(vk.widget&&window.WPoll&&window.WPoll.updateShareMessage(_),this.votingUpdateFull(t,e))},showProgress:this.votingLock.bind(this,t),hideProgress:()=>{o||this.votingUnlock(t)}})}}else vk.widget&&Widgets.oauth()},votingButtonVote:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"media_voting_multiple")){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("media_voting_option_selected",_),o=[];t.forEach((function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"id");_&&o.push(_)})),this.votingVote(_,o)}},votingOptionVote:function(e,_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(t){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"media_voting_multiple")){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"id");if(this.votingIsLocked(o)||!vk.id)return void(vk.widget&&Widgets.oauth());Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(e,"media_voting_option_selected");var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("media_voting_option_selected",t).length;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(t,"media_voting_has_selected_options",a)}else{var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"id");this.votingVote(t,[i])}Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_)}},votingOptionTooltip:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"id"),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"owner-id"),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"id"),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"board");Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{url:"al_voting.php",params:{act:"option_tt",option_id:t,owner_id:o,is_board:i,voting_id:a},slide:15,ajaxdt:100,showdt:400,hidedt:200,dir:"auto",shift:[0,10,10],typeClass:"voting_tt"})}},votingLayer:function(e,_){var t=!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"media_voting_option_wrap")&&e,o=t?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"id"):0,a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"media_voting")?e:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"id"),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"owner-id"),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"board"),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"ref"),n={w:(l?"board_poll":"poll")+r+"_"+i};if(o&&(n.opt_id=o),vk.widget)window.open(location.origin+"/"+n.w,"poll");else{var d={queue:1,noloader:!!Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)()};"story"===s&&(d.customRef="story"),Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__.showWiki)(n,!1,void 0,d)}Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_)}},votingExport:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(_&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"board")){var t=this.votingExtendParams({act:"export_box"},_);Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("al_voting.php",t,{onDone:function(){Object(_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_20__.curBox)().setOptions({width:500})}})}},votingOnMain:function(e,_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(t){if(this.votingIsLocked(o))return;var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"id"),a=this.votingExtendParams({act:"onmain",state:_?1:0},t);ajax.post("al_voting.php",a,{onDone:this.votingUpdateFull.bind(this,o),showProgress:this.votingLock.bind(this,o),hideProgress:this.votingUnlock.bind(this,o)})}},votingClosed:function(e,_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"id");if(this.votingIsLocked(o))return;var a=this.votingExtendParams({act:"closed",state:_?1:0},t);ajax.post("al_voting.php",a,{onDone:this.votingUpdateFull.bind(this,o),showProgress:this.votingLock.bind(this,o),hideProgress:this.votingUnlock.bind(this,o)})}},votingNarrowAction:function votingNarrowAction(votingId,hash,action){var act,state;switch(action){case 101:act="closed",state=0;break;case 102:act="closed",state=1;break;case 103:act="onmain",state=0;break;case 104:act="onmain",state=1}act&&!cur.votingNarrowActionProgress&&ajax.post("al_voting.php",{act,voting_id:votingId,is_fixed:1,state,narrow:1,hash},{onDone:function onDone(html,js){var votingModuleEl=ge("group_voting");if(votingModuleEl&&(votingModuleEl=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(votingModuleEl),html?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(votingModuleEl,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(html)):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(votingModuleEl)),js)try{eval(js)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_29__.logEvalError)(e,js)}},showProgress:function(){cur.votingNarrowActionProgress=!0},hideProgress:function(){cur.votingNarrowActionProgress=!1}})},votingReport:function(e,_){if(!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.actionsMenuItemLocked)(e)){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("media_voting",e);if(t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"id");if(this.votingIsLocked(o))return;var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"board");ajax.post("al_voting.php",{act:"a_report_form",voting_id:o,is_board:a,hash:_},{onDone:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cf)(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"media_voting_board")&&addClass(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(_),"media_voting_board"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(t,_),vk.widget&&window.WPoll&&window.WPoll.resizeWidget()},showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockActionsMenuItem)(e),this.votingLock(o)}.bind(this),hideProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockActionsMenuItem)(e),this.votingUnlock(o)}.bind(this)})}}},foTT:function(e,_,t){t&&t.oid&&(_=t.oid==vk.id?getLang("wall_my_friends_only"):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("wpfo"+t.pid)),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTitle)(e,_)},update:function(){if(cur.wallLayer)WkView.wallUpdateReplies();else{var e="top"===cur.wallType,_="archive"===cur.wallType,t="donut"===cur.wallType;if(("all"===cur.wallType||"own"===cur.wallType||e||_||t)&&("all"===cur.wallTab||"own"===cur.wallTab||"top"===cur.wallTab||"archive"===cur.wallTab||"donut"===cur.wallTab)){var o=_?"all":e||t?"own":cur.wallType,a=ge("wall_more_link"),i=Wall.getPostsWrap(cur.wallType),r=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(cur.deletedCnts[o]),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)(o,i).length-r,s=!1;if((e||_||t)&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(geByClass1("no_posts",i))||e&&cur.wallTopFinished===cur.oid||_&&cur.wallArchiveFinished===cur.oid||t&&(cur.wallDonutFinished===cur.oid||Wall.cantAccessDonutPosts())))s=!0;else{var n;if(n=_?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_archive")):e?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_top")):t?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_donut")):"own"===o?Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own")):Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all")),"suggested"!==cur.wallTab){var d=n;cur.oid<0&&cur.options.fixed_post_id&&(d-=1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_posts_count",d?Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(d,cur.options.wall_counts):cur.options.wall_no)}var c=l;!e&&!_&&cur.options.fixed_post_id&&cur.options.wall_oid<0&&(c+=1),s=c>=n-r}s?hide(a):(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(a),a.onclick=Wall.showMore.pbind(l)),cur.wallTab==cur.wallType&&(shortCurrency(),cur.gifAutoplayScrollHandler&&cur.gifAutoplayScrollHandler(),cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler())}}},getAbsDate:function(e,_){_=_||window.cur;var t,o=new Date(e||Date.now()),a=o.getHours(),i=o.getMinutes(),r="";return _.wallTpl.time_system&&(r=_.wallTpl.time_system[a>11?1:0],a=a%12||12),t=a>9?a:"0"+a,i=i>9?i:"0"+i,_.wallTpl.date_format.replace("{am_pm}",r).replace("{hour}",a).replace("{num_hour}",t).replace("{minute}",i)},getNowRelTime:function(e){e=e||window.cur;var _=Date.now();return'<span class="rel_date rel_date_needs_update" time="'+Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_/1e3-(e.tsDiff||0))+'" abs_time="'+Wall.getAbsDate(_,e)+'">'+getLang("wall_just_now")+"</span>"},getNewPostHTML:function(e,_,t,o){o=o||window.cur;var a,i=[],r=e[2],l=r.split("_")[0],s="",n="",d=e[4].split("|"),c=Wall.getNowRelTime(o);1==e[8]?(s+=o.wallTpl.reply_link,n+=o.wallTpl.reply_button):l!=vk.id&&(s+=o.wallTpl.own_reply_link);var p=e[3].replace("mem_link","author").replace("memLink","author"),u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(p),b=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.unclean)(u.innerText||u.textContent||""));-1!=e[6].indexOf('id="wpfo')&&(p+='<span class="page_fronly inl_bl" onmouseover="Wall.foTT(this, false, {oid: \''+l+"', pid: '"+e[2]+"'})\"></span>"),o.wallTpl.custom_del&&(_>(e[9]==l?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER)||l==vk.id||e[9]==vk.id||e[2].split("_")[0]!=e[4])&&i.push(o.wallTpl.custom_del),_>(e[9]==l?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER)||l==vk.id||e[9]==vk.id?i.push(o.wallTpl.del):e[2].split("_")[0]!=e[4]&&i.push(o.wallTpl.spam);var h=_>constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR&&e[9]==l||l==vk.id||e[9]==vk.id;h&&"rss"!==e[13]&&i.push(o.wallTpl.edit),l!=vk.id&&e[9]!=vk.id||!e[6]||(e[6]=e[6].replace("vk2017_snippet_show_layer_button","vk2017_snippet_show_layer_button_hidden"));var m=l<0&&e[9]==l&&_>constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR;return a={oid:l,name:p,actions:i.length?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.post_actions,{actions:i.join("")}):"",replies:"",reply_link:s,reply_button:n,own_reply_link:o.wallTpl.own_reply_link,reply_box:1==e[8]?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.reply_box,{actions:"",class:m?" reply_fakebox_with_official":""}):"",photo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(d[0]),link:e[5],text:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(e[6]),date:c,post_id:e[2],poll_hash:o.wallTpl.poll_hash,date_postfix:"",user_image:"",post_url:"/wall"+r.replace("_wall_reply","_"),can_reply_as_group:m?1:"",owner_photo:m?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(d[1]||d[0]):"",owner_href:m?e[5]:"",owner_name:m?b:"",online_class:l>0?" online":"",likes:Likes.makeTemplate(o.wallTpl.post_likes,{object_raw:e[2]})},t&&extend(a,t(a,e)),h&&o.wallTpl.author_data&&(a.date=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.author_data,{date:a.date,post_id:r})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.post,a),a)},updateAnonNewPost:function(e,_){if("anon"==e[13]){var t=geByClass1("author",_),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span");o.innerHTML=t.innerHTML,o.className=t.className,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(t,o);var a=geByClass1("post_image",_),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span");i.innerHTML=a.innerHTML,i.className=a.className,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(a,i)}return _},getNewReplyHTML:function(e,_,t,o){o=o||window.cur;var a=[],i=ge("reply_field"+e[2])||ge("reply_fakebox"+e[2])||ge("fwr_text"),r="",l="",s="",n=e[10]||"";(_>constants.Groups.GROUPS_ADMIN_LEVEL_USER||!e[2].indexOf(vk.id+"_")||e[4]==vk.id?a.push(o.wallTpl.del_reply):e[2].split("_")[0]!=e[4]&&a.push(o.wallTpl.spam_reply),(_>constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR&&e[4]==Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e[2])||e[4]==vk.id)&&a.push(o.wallTpl.edit_reply),-1!=e[8].indexOf('class="wall_reply_more"')&&(r+="reply_moreable"),i)&&(r+=" reply_replieable",l=o.wallTpl.reply_link_wrap,wall.getReplyNames()[e[4]]||wall.addReplyName(e[4],[e[11],e[12]]));r&&(s=" onclick=\"Wall.replyClick('%post_id%', %reply_msg_id%, event, %reply_uid%)\""),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.reply_actions,{actions:a.join("")});var d={name:e[5].replace("mem_link","author"),photo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(e[6]),link:e[7],text:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(e[8]),classname:r,actions:a,attr:s,date:Wall.getNowRelTime(o),to_link:n,answer_link:l,post_id:e[2],reply_id:e[3],like_id:e[3].replace("_","_wall_reply"),reply_msg_id:e[3].split("_")[1],reply_uid:e[4]||"false",likes:Likes.makeTemplate(o.wallTpl.reply_likes,{object_raw:e[3]})};return t&&extend(d,t(d)),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.wallTpl.reply,d)},updatePostImages:function(e){return e.replace(/<img[^>]+>/g,(function(e){return e.match(/class=/)?e.replace("src=","data-src=").replace('class="','class="__need_img '):e}))},loadPostImages:function(e){each(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("__need_img",e,"img"),(function(){var e=this.getAttribute("data-src");e&&(this.src=e,this.removeAttribute("data-src")),removeClass(this,"__need_img")}))},openNewComments:function(e){var _=ge("replies"+e),t=_.nextSibling,o=geByClass1("wr_header",_,"a"),a=0,i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",_,"div").length,r=i,l=t.newCnt;Wall.loadPostImages(_),each(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clone)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("new_reply",_,"div")),(function(){if(removeClass(this,"new_reply"),Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(this),100==++a)return!1})),o&&(r=a+Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(o.getAttribute("offs").split("/")[1])),i+=-l+a,(r>3||i<r)&&(o||_.insertBefore(o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("a",{className:"wr_header"}),_.firstChild),Wall.updateRepliesHeader(e,o,i,r)),cur.wallMyOpened[e]=1,t&&"replies_open"==t.className&&(l>100?(t.innerHTML=getLang("news_x_new_replies_more",Math.min(100,l-a)),t.newCnt-=a):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t)),Wall.repliesSideSetup(e)},langWordNumeric:function(e,_,t){return Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langWordNumeric)(e,_,t)},updateTimes:function(e){var _=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Date.now()/1e3),t=[];_-=cur.tsDiff,each(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("rel_date_needs_update",e||ge("page_wall_posts"),"span"),(function(e,o){if(o){var a=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(o.getAttribute("time")),i=_-a,r=Object(_web_lib_date__WEBPACK_IMPORTED_MODULE_41__.getFormattedDiffTimeText)(i);r||(r=o.getAttribute("abs_time"),t.push(o)),o.innerHTML=r}})),each(t,(function(){removeClass(this,"rel_date_needs_update")}))},updateRepliesHeader:function(e,_,t,o){if(!cur.onepost){var a,i,r=_.href,l=3,s=0;if(!r&&(i=e.match(/^(-?\d+)_(photo|video|note|topic|video|)(\d+)$/))){var n=i[2]||"wall";switch(r="/"+n+i[1]+"_"+i[3],n){case"topic":r+="?offset=last&scroll=1";break;case"wall":r+="?offset=last&f=replies"}_.href=r}o>t?t<100?(a=o>100?getLang("wall_show_n_last_replies",100):getLang("wall_show_all_n_replies",o),l=!1):a=getLang("wall_hide_replies"):(a=getLang("wall_hide_replies"),s=1),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_,"wrh_all",s),_.innerHTML=a,_.onclick=Wall.showReplies.pbind(e,l,!1),_.setAttribute("offs",t+"/"+o)}},processQueueEvent(e){if(isObject(e)&&e.entity_type)switch(e.entity_type){case"voting":this.votingUpdatePartly(e.data.id,e.data)}},updated:function(e,_,t){var o=e?window.wkcur:window.cur;if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(o.wallQueues)&&Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(t.events)&&t.events.length){var a=o.wallQueues.filter(e=>e.key===_).pop();if(a)if(t.failed)o.wallQueues=!1;else{a.ts=t.ts;var i=e?wkLayerWrap.scrollTop:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollGetY)(),r=i,l=!(o.wallType||"").indexOf("full"),s=o.onepost,n=!!e,d=e;l&&(nav.objLoc.q||nav.objLoc.search||nav.objLoc.day)||(each(t.events,(function(){if(isObject(this))return Wall.processQueueEvent(this);var _=this.split("<!>"),t=_[0],a=_[1],i=_[2],c=0,p=0,u=e&&window.cur.wallLayer==i&&ge("wl_post");if(u&&"del_reply"!=a||(u=ge("post"+i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isAncestor)(u,e?wkLayerWrap:pageNode)||(u=null)),t==o.options.qversion){switch((Wall.isArchiveWall()?"archive_post"===a:"reveal_post"===a)&&(a="res_post"),(Wall.isArchiveWall()?"reveal_post"===a:"archive_post"===a)&&(a="del_post"),a){case"new_post":if(u)break;if(l&&o.pgStart>0){o.pgOffset++;break}if(o.oid==vk.id&&vk.id==_[9]&&window.curNotifier&&curNotifier.idle_manager.is_idle&&Wall.clearInput(),"own"!==o.wallType&&"all"!==o.wallType&&!Wall.hasPosts("own"))break;var b=ge("page_wall_posts"),h=b.lastChild,m=!!l&&FullWall.addTetaTet,v=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[_.length-1]),g=void 0!==o.options.is_admin?o.options.is_admin:o.options.wall_oid<0?8&v?constants.Groups.GROUPS_ADMIN_LEVEL_EDITOR:2&v?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER:constants.Groups.GROUPS_ADMIN_LEVEL_USER,E=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Wall.getNewPostHTML(_,g,m,o)),w=b.firstChild;if(Wall.updateAnonNewPost(_,E),ge("post"+i))break;for(h&&h!=E?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(h):h=!1,l?h||o.pgOffset++:(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all"))+1),addClass(E,"all"),Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[10])&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own"))+1),addClass(E,"own"))),0==_[8]&&addClass(E,"closed_comments"),o.deepRepliesActive&&addClass(E,"deep_active");w&&("INPUT"==w.tagName||1!=w.nodeType||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(w,"post_fixed"));)w=w.nextSibling;b!==Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(w)&&Wall.sendInsertBeforeError(),b.insertBefore(E,w),Wall.votingUpdateByPostRaw(i),c=E.offsetHeight+15,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(E,d)[1],Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(E),Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_28__.updateAriaElements)(),Wall.updateMentionsIndex(),AudioUtils.updateQueueReceivedPost(E);break;case"edit_post":var O=ge("wpt"+i);if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(u)||!O)break;var P=geByClass1("wall_post_more",O);P&&(P=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(P))),c=-O.offsetHeight,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(O,d)[1];var D=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(_[3],{poll_hash:o.wallTpl.poll_hash})),f=o.videoInlinePlayer&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isAncestor)(window._videoLastInlined[0],O),M=f&&"playing"==o.videoInlinePlayer.getState();if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(O,D),f){var C=geByClass1("page_post_sized_thumbs",O);1==Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(C).length&&(C.innerHTML="",C.appendChild(window._videoLastInlined[1]),C.appendChild(window._videoLastInlined[0]),M&&setTimeout((function(){o.videoInlinePlayer.play()}),0))}P&&(P=geByClass1("wall_post_more",O))&&P.onclick(),Wall.votingUpdateByPostRaw(i),c+=O.offsetHeight,Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(O),Wall.updatePostAuthorData(i);break;case"edit_reply":var T=_[3],L=ge("wpt"+T);if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("post"+T)||!L)break;var A=geByClass1("wall_reply_more",L);A&&(A=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(A)));var y=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.psr)(_[4]);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(L,y),c=-L.offsetHeight,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(L,d)[1],A&&(A=geByClass1("wall_reply_more",L))&&A.onclick(),c+=L.offsetHeight,Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(L);break;case"post_parsed_link":if(!u)break;var I=geByClass1("wall_postlink_preview_btn_disabled",u);if(!I)break;var B=_[3];if("1"===B)removeClass(I,"wall_postlink_preview_btn_disabled"),removeClass(I,"button_disabled");else if("0"===B)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(I);else if(B){var j=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("a",{href:B,className:"flat_button",innerHTML:getLang("wall_preview_link")});Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(I,j)}break;case"del_post":u&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(u)&&!o.wallMyDeleted[i]&&!s&&(c-=u.offsetHeight+15,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(u,d)[1],Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(u),addClass(u,"unshown"),l||n||(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all"))-1),_[3]&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own"))-1),Wall.isArchiveWall()&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_archive",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_archive"))-1)));break;case"res_post":u&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(u)&&((o.wallRnd==_[4]||Wall.isArchiveWall())&&removeClass(u,"unshown"),l?o.pgOffset++:(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_all"))+1),_[3]&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_own"))+1),Wall.isArchiveWall()&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_archive",Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)("page_wall_count_archive"))+1)));break;case"new_reply":if(!u||o.wallMyReplied[i]||ge("post"+_[3])||s&&o.pgOffset<o.pgCount||n&&(o.reverse?o.offset:o.offset+o.loaded<o.count))break;if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n?ge("wl_post"):ge("post"+i),"deep_active")){var W=wall.addNewReply(_);c+=W[0],p=W[1];break}var R,U=ge("replies"+i),k=ge("replies_wrap"+i),K=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[_.length-1]),S=void 0!==o.options.is_admin?o.options.is_admin:o.options.wall_oid<0?8&K?constants.Groups.GROUPS_ADMIN_LEVEL_EDITOR:2&K?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER:constants.Groups.GROUPS_ADMIN_LEVEL_USER,x=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Wall.getNewReplyHTML(_,S,!1,o)),N=n?U.offsetHeight:u.offsetHeight,F=!1;if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(U)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(k)&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("reply_link"+i)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("wall_fixed",k)){R=U.nextSibling;var H=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("new_reply",U,"div").length+1;if(n||s||o.wallMyOpened[i]){if(!s){R&&"replies_open"==R.className&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(R),F=!0;var $=geByClass1("wr_header",U,"a"),V=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",U,"div").length+1,z=V;$&&(z=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)($.getAttribute("offs").split("/")[1])+1),(z>5||V<z)&&($||U.insertBefore($=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("a",{className:"wr_header"}),U.firstChild),Wall.updateRepliesHeader(i,$,V,z))}}else addClass(x,"new_reply"),R&&"replies_open"==R.className||(R=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{className:"replies_open",onclick:Wall.openNewComments.pbind(i),role:"button",tabIndex:0}),U.parentNode.insertBefore(R,U.nextSibling)),R.innerHTML=getLang("wall_x_new_replies_more",Math.min(100,H)),R.newCnt=H}else Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)("reply_link"+i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(k,U),F=!0;e&&o.reverse&&U.firstChild?U.insertBefore(x,U.firstChild):U.appendChild(x),F&&Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(x),n?(o.count++,o.loaded++,WkView.wallUpdateReplies(),c=U.offsetHeight-N,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(x,d)[1]):(s&&(FullWall.repliesSummary(_[13]),o.pgOffset++,o.pgCount++,FullWall.repliesSummary(o.pgCount),Pagination.pageReady(!1),FullWall.onePostOnScroll(!1,!1,!0)),c=u.offsetHeight-N,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(F?x:R)[1],Wall.repliesSideSetup(i)),Wall.updateMentionsIndex(),Likes.update("wall"+i,{comment_num:_[13]});break;case"del_reply":if(o.wallMyDeleted[i]||!u)break;var q=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",u)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",u);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(q,"deep_active")){var G=wall.removeDeepReply(_);c+=G[0],p=G[1];break}if(c-=u.offsetHeight,p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(u,d)[1],Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(u),o.layerpost)hide(u),o.count--,o.loaded--;else{s&&(o.pgOffset--,o.pgCount--,FullWall.repliesSummary(o.pgCount));var Y=u.parentNode.id.match(/replies(-?\d+_\d+)/);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(u),Y&&Wall.repliesSideSetup(Y[1])}break;case"view_post":Wall.likeUpdate(!1,i,0,Wall.formatCount(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[3])),void 0,void 0,1);break;case"like_post":case"like_reply":if(!u)break;var X="like_reply"==a?"wall_reply"+i:i,J=u&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(u,"_like_wrap"),Q=u&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(u,"_share_wrap");wall.likeFullUpdate(J,X,{like_my:J&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(J,"my_like"),like_num:_[3],like_title:!1,share_my:Q&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(Q,"my_share"),share_num:_[4],share_title:!1});break;case"upd_ci":var Z=_[2],ee=ge("current_info"),_e=ee||ge("page_current_info");if(!_e)break;switch(_[3]){case"audio":var te=geByClass1("current_audio_cnt");te&&te.tt&&te.tt.hide();var oe=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[5]||""),ae=oe?"":" hidden",ie="";ee||(ie+=" onmouseover=\"showTooltip(this, {forcetoup: true, text: '"+o.options.ciAudioTip+"', black: 1, shift: [14, 5, 5]})\" onclick=\"Page.playCurrent(this, '"+_[4]+"')\""),Z=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o.options.ciAudioTpl,{text:Z,attrs:ie,count:oe,cnt_class:ae}),wall.updateOwnerStatus(Z,_e,_,ee);break;case"app":var re=_[6]?"[12, 5, 5]":"[15, 5, 5]",le=_[6]?" current_app_icon":"",se=ee?' onclick="cur.ciApp = '+_[4]+'"':" onmouseover=\"showTooltip(this, {forcetoup: true, text: '"+o.options.ciAppTip+"', black: 1, shift: "+re+'})" href="'+_[5]+'?ref=14" onclick="return showApp(event, '+_[4]+', 1, 14, cur.oid)"';_[6]&&(se+=" style=\"background-image: url('"+_[6]+"'); background-size: 16px 16px;\""),Z='<a class="current_app'+le+'"'+se+">"+Z+"</a>",wall.updateOwnerStatus(Z,_e,_,ee);break;default:stManager.add([jsc("web/emoji.js")],(function(){Z=Z?'<span class="current_text">'+Emoji.emojiToHTML(Z,!0)+"</span>":Z,wall.updateOwnerStatus(Z,_e,_,ee)}))}break;case"upd_ci_cnt":var ne=ge("current_info"),de=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(_[2]),ce=ne||ge("page_current_info"),pe=ce&&geByClass1("current_audio_cnt",ce);pe&&(pe.tt&&pe.tt.destroy(),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(pe,"hidden",0==de),Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_23__.animateCount)(pe,Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.langNumeric)(de,"%s",!0),{str:"auto"}));break;case"cover_updated":var ue=geByClass1("_page_cover");if(ue&&_[2]){var be=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.vkImage)(),he=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.isRetina)()?_[3]:_[2];be.src=he,be.onload=function(){ue.style.backgroundImage="url('"+he+"')",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(be)}}}c&&(e?p<0:r+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)("page_header_cont")[1]>p)&&(r+=c)}})),r!=i&&i>100&&!o.onepost&&(e?wkLayerWrap.scrollTop=r:Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(r,0,!1,!0)),Wall.update())}}},updateOwnerStatus:function(e,_,t,o){o&&(e='<span class="'+(e?"my_current_info":"no_current_info")+'">'+(e||getLang("change_current_info"))+"</span>",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_.parentNode.nextSibling,e),!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)("currinfo_editor")&&cur.oid>0&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)("currinfo_audio","app"!=t[3]),t[2]&&"app"!=t[3]&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(ge("currinfo_audio"),Boolean(t[2])),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)("currinfo_app","app"==t[3]),addClass("currinfo_app","on")));Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,e)},updateMentionsIndex:function(e){if(clearTimeout(cur.wallUpdateMentionsIndexTO),e){var _={},t=[],o=new RegExp("^(https?://(vk.com|"+location.host.replace(/\./,"\\.")+"))?/?"),a=[];each(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("author",bodyNode,"a"),(function(){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(this),a=this.href.replace(o,"");if(void 0===_[a]){var i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(this.getAttribute("data-from-id"));i&&i!=vk.id&&(_[a]=t.length,t.push([i,e,"@"+a,"/images/camera_c.gif"]))}})),a=(a=a.concat(Array.prototype.slice.apply(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_image",bodyNode,"a")))).concat(Array.prototype.slice.apply(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply_image",bodyNode,"a"))),each(a,(function(){var e=this.href.replace(o,""),a=_[e];if(void 0!==a){for(var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(this);i&&"IMG"!=i.tagName;)i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(i);i&&(t[a][3]=i.getAttribute("src"),delete _[e])}})),cur.wallMentions=t}else cur.wallUpdateMentionsIndexTO=setTimeout(wall.updateMentionsIndex.pbind(!0),300)},initUpdates:function(e){var _=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.length&&window.Notifier){var t=_?window.wkcur:window.cur,o=()=>{t.wallQueues&&t.wallQueues.forEach(e=>{Notifier.addKey(e,(e,t)=>{Wall.updated(_,e,t)})})};if(!t.wallQueues){var a=setInterval(o,1e4);_?t._hide.push(()=>clearInterval(a)):t.destroy.push(()=>clearInterval(a))}t.wallQueues=e,o()}},initWallOptions:function(e){extend(cur,{wallCheckComments:e.check_comments,wallType:e.wall_type,wallTpl:e.wall_tpl,wallMyDeleted:{},tsDiff:e.wall_tpl&&e.wall_tpl.abs_timestamp?900*Math.round((Date.now()/1e3-e.wall_tpl.abs_timestamp)/900):0,wallMyOpened:{},wallMyReplied:{},wallMentions:[],wallMyRepliesCnt:0,wallUploadOpts:e.upload,wallUploadVideoOpts:e.upload_video,hasGroupAudioAccess:e.hasGroupAudioAccess,wallAdsReplacedFeatureTooltip:e.ads_replaced_feature_tooltip,wallAdsReplacedFeatureTooltipHash:e.ads_replaced_feature_tooltip_hash}),e.wall_tpl&&e.wall_tpl.lang&&(cur.lang=extend(cur.lang||{},e.wall_tpl.lang)),window.Notifier&&Notifier.addRecvClbk("wall_reply_multiline","wall",(function(e){Wall.onReplySubmitChanged(e.value,1)}),!0)},onPostLoaded:function(e,_){e=ge(e),Wall.onAdBlockLoaded(e,_),_&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_post")&&(e=geByClass1("_post",e)),e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_post")&&cur.onPostLoaded&&cur.onPostLoaded(e)},onAdBlockLoaded:function(e,_){var t;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_ads_block_data_w")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_ads_promoted_post_data_w")?t=e:_&&(t=geByClass1("_ads_block_data_w",e)||geByClass1("_ads_promoted_post_data_w",e)),t&&Wall.triggerAdStat(t,"load")},init:function(e){Wall.initWallOptions(e),extend(cur,{wallInited:!0,postField:ge("post_field"),wallSearch:ge("wall_search"),wallPage:ge("profile")||ge("group")||ge("public"),wallPageNarrow:ge("narrow_column"),wallUploadOpts:e.upload||!1,wallOnClearInput:[],deletedCnts:{own:0,all:0,archive:0},posterFeatureTooltip:e.poster_feature_tooltip,posterFeatureTooltipHash:e.poster_feature_tooltip_hash,postCopyrightFeatureTooltip:e.post_copyright_feature_tooltip,postCopyrightFeatureTooltipHash:e.post_copyright_feature_tooltip_hash}),cur.destroy.push((function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.cleanElems)(e.postField)}));var _=removeEvent.pbind(document,"click",Wall.hideEditPostReply);cur._back?(cur._back.hide.push(_),cur._back.show.push(_),cur._back.show.push(addEvent.pbind(document,"click",Wall.hideEditPostReply))):cur.destroy.push(_),cur.wallTab=cur.wallType,Wall.update(),Wall.initUpdates(e.add_queues),e.wall_tpl&&(cur.timeUpdateInt=setInterval((function(){Wall.updateTimes(e.wallCont)}),1e4),cur.destroy.push((function(){clearInterval(cur.timeUpdateInt)})));var t=window;addEvent(t,"scroll",Wall.scrollCheck),addEvent(window,"resize",Wall.scrollCheck),cur.destroy.push((function(){removeEvent(t,"scroll",Wall.scrollCheck),removeEvent(window,"resize",Wall.scrollCheck)})),cur.wallAutoMore=e.automore;var o=!1;if(cur.options.no_draft||(o=e.draft||cur.oid!=vk.id&&Wall.getOwnerDraft(cur.oid)),Wall.initPostEditable(o),cur.wallSearch&&placeholderInit(cur.wallSearch),removeEvent(document,"click",Wall.hideEditPostReply),addEvent(document,"click",Wall.hideEditPostReply),e.poster_options&&Wall.initPosterEditor(e.poster_options),e.media_types){var a=extend({onAddMediaChange:(e,_,t)=>{cur.postCopyrightFeatureTT&&cur.postCopyrightFeatureTT.hide(),Wall.hidePosterFeatureTooltip(),Wall.postChanged(10),["poll","postpone",_web_donut__WEBPACK_IMPORTED_MODULE_33__.MEDIA_TYPE_DONUT_DURATION].includes(e)||wall.focusOnEnd(),cur.oid!=vk.id&&Wall.saveOwnerDraftMedia(cur.oid,e,_,t),setTimeout(Wall.checkPosterAvailability)},onChangedSize:()=>{setTimeout(()=>{var e=ge("submit_post_box"),_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("VideoRestriction",e);each(_,(e,_)=>{var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(_)[1],o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(_)[0];Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_,"VideoRestriction--onlyIcon",o<200),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_,"VideoRestriction--small",o>=200&&o<300&&o>t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_,"VideoRestriction--medium",o>=300&&o<400)})})},onMediaChange:()=>{Wall.postChanged()},onMediaUploadStarted:()=>{Wall.postChanged()},editable:1,from:"post",sortable:1,poster:cur.poster},e.media_opts||{});if(cur.wallAddMedia=new MediaSelector(ge("page_add_media"),"media_preview",e.media_types,a),cur.wallAddMedia.menu){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(cur.wallAddMedia.menu.menuNode,"_type_podcast"),r=ge("official");i&&r&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_submit_post_box",r),"from-oid")!=cur.postTo&&hide(i)}}if(Wall.initPostVisibilitySelector(cur.wallAddMedia),Object(_web_discover_category_post_topic__WEBPACK_IMPORTED_MODULE_36__.isPostTopicSettingEnabled)(window.cur)){var l=cur.wallAddMedia&&cur.wallAddMedia.id||"",s=Object(_web_discover_category_post_topic__WEBPACK_IMPORTED_MODULE_36__.initPostTopicCreatingSelector)(String(l),ge("post_actions_btns"));s&&(window.cur.destroy.push(s.onDestroy),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(window.cur.wallOnClearInput)&&window.cur.wallOnClearInput.push(s.clearSelection))}if(cur.withUpload=window.WallUpload&&!browser.safari_mobile&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(cur.wallType,["all","own","feed","full_all","ads_promoted_stealth"])&&Wall.withMentions&&cur.wallUploadOpts,cur.withUpload&&WallUpload.checkDragDrop()){var n=function(){removeEvent(document,"dragover dragenter drop dragleave",p)},d=!1,c=!1,p=function(e){if(!1!==d&&(clearTimeout(d),d=!1),cur.uploadInited)return n(),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e);switch(e.type){case"drop":c=!1,delete cur.wallUploadFromDrag,hide("post_upload_dropbox");break;case"dragleave":d=setTimeout((function(){c=!1,delete cur.wallUploadFromDrag,hide("post_upload_dropbox")}),100);break;case"dragover":case"dragenter":c||2==(c=!e.target||"IMG"!=e.target.tagName&&"A"!=e.target.tagName?2:1)&&setTimeout(WallUpload.initCallback,0),2==c&&(cur.wallUploadFromDrag=1)}return Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e)};addEvent(document,"dragover dragenter drop dragleave",p),cur.destroy.push(n)}Wall.updateMentionsIndex(),e.top_wall_feature_tooltip?setTimeout((function(){Wall.showTopWallTooltip(e.top_wall_feature_tooltip_hash)}),800):e.order_feature_tooltip&&setTimeout((function(){Wall.showOrderTooltip(e.order_feature_tooltip_hash)}),800)},initPosterEditor:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)('<div class="page_block"></div>'),t=Wall.getMainPostBlock();"feed"===cur.module&&addClass(_,"feed_post_field_wrap");var o=function(){return!1},a=function(){Wall.closeFancyTooltipsInPost(),Wall.openPosterEditor(),cur.poster.sendStatsInfo("open")},i={onPreOpen:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(_,t)},onPostOpen:function(){var e=cur.poster.getTextInputEl();Wall.restoreCaretPositionForPoster(e)},onPreHide:function(){Wall.saveCaretPositionForPoster(cur.poster.getTextInputEl()),Wall.closeFancyTooltipsInPost();var e=ge("submit_post_error"),_=ge("submit_post_box"),t=ge("post_actions_btns"),o=ge("submit_post");Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(t,o),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(e)&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(_))},onPostHide:function(){var e=ge("post_settings_btn"),o=cur.options.suggesting&&ge("check_sign");e&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(e,cur.openPosterBtn),o&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(o,cur.openPosterBtn),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(t);var a=cur.poster.getTextAsHtml();a&&a.match(Emoji.emojiRegex)&&(a=a.replace(Emoji.emojiRegex,Emoji.emojiReplace)),cur.postField.innerHTML=a,Wall.restoreCaretPositionForPoster(cur.postField),setTimeout((function(){Composer.updateArticleConvertSuggest(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(cur.postField,"composer"))})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(_)},onPreUploaderOpen:function(){var e=cur.poster.getTextInputEl();Wall.saveCaretPositionForPoster(e)},onPostUploaderClose:function(){var e=cur.poster.getTextInputEl();Wall.restoreCaretPositionForPoster(e)},onOverTextLimit:function(){Wall.disablePoster(!0),cur.poster.closeEditor(),cur.poster.sendStatsInfo("auto_disable"),cur.poster.state.toggled=!0},onChangeData:Wall.postChanged,onSend:function(e){Wall.sendPost(!0,e)},onDestroy:function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(_)},getPostOwnerId:function(){return+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(ge("submit_post_box"),"from-oid")},width:Wall.getMainPostBlock().clientWidth,containerClasses:"poster_wall-creating",placeholder:attr(cur.postField,"placeholder"),appendToElem:_};cur.openPosterBtn=ge("page_poster_btn"),cur.poster=new Poster(e.poster_config,i),addEvent(cur.openPosterBtn,"click",a),addEvent(cur.openPosterBtn,"mousedown",o),cur.destroy.push((function(){removeEvent(cur.openPosterBtn,"click",a),removeEvent(cur.openPosterBtn,"mousedown",o)}))},openPosterEditor:function(e){if(cur.poster&&!cur.poster.state.disabled&&!cur.poster.state.opened){e=e||{},cur.posterFeatureTT&&cur.posterFeatureTT.hide();var _=Wall.getMainPostBlock(),t=e.bkgId,o=window.browser.windows7||window.browser.windowsVista||window.browser.windowsXp;Wall.saveCaretPositionForPoster(cur.postField);var a=e.text||cur.postField.innerHTML;if(a=(a=a.replace(/\n/g,"<br/>")).replace(/<img[^>]*>/g,(function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:e}).firstChild,t=Emoji.getCode(_);return t?o?" ":Emoji.codeToChr(t):e})),!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(_))return cur.poster.setBkg(t,!0),void cur.poster.setText(a);hide(_);var i=ge("post_settings_btn"),r=ge("submit_post_error"),l=cur.options.suggesting&&ge("check_sign"),s=cur.poster.getPostOptionsWrapperEl();if(i&&s.appendChild(i),l&&s.appendChild(l),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(r)){var n=cur.poster.getErrorWrapperElement();n.innerHTML="",n.appendChild(r)}var d=cur.poster.getBtnsWrapper(),c=ge("post_actions_btns");c&&(d.firstChild?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(c,d.firstChild):d.appendChild(c),c.children.length||d.children.length>1?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(d):hide(d)),cur.poster.openEditor(),cur.poster.setBkg(t,!0),cur.poster.setText(a)}},checkPosterAvailability:function(){if(cur.poster){var e=cur.wallAddMedia?cur.wallAddMedia.getMedias():[],_=cur.poster.isTextFieldValid(cur.postField),t=Wall.checkAttachesForPoster(e),o=_&&t;!o!==cur.poster.state.disabled&&Wall.disablePoster(!o),o&&cur.poster.state.toggled&&(Wall.openPosterEditor(),cur.poster.sendStatsInfo("auto_enable"),cur.poster.state.toggled=!1)}},checkAttachesForPoster(e){if(!Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(e))return!1;if(!e.length)return!0;var _=0;return e.some(e=>{if(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(e)){var t=_slicedToArray(e,1)[0];["copyright","postpone",_web_donut__WEBPACK_IMPORTED_MODULE_33__.MEDIA_TYPE_DONUT_DURATION].includes(t)||++_}}),0===_},disablePoster:function(e){cur.poster&&(void 0===e&&(e=!0),cur.poster.state.disabled=e,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(cur.openPosterBtn,"_disable",e))},isPosterEditorOpen:function(){return cur.poster&&cur.poster.isOpen()},saveCaretPositionForPoster:function(e){if(document.activeElement===e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span"),t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("span");_.classList.add("poster__marker","poster__marker_start"),t.classList.add("poster__marker","poster__marker_end");var o=getSelection().getRangeAt(0);(o=o.cloneRange()).insertNode(_),o.collapse(!1),o.insertNode(t)}},restoreCaretPositionForPoster:function(e){var _=geByClass1("poster__marker_start",e),t=geByClass1("poster__marker_end",e);if(_&&t){var o=document.createRange();o.setStartBefore(_),o.setEndBefore(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(_),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t);var a=window.getSelection();a.removeAllRanges(),a.addRange(o)}else wall.focusOnEnd(e)},getMainPostBlock:function(){var e=cur.mainPostBlock;return e||(e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(ge("submit_post_box")),cur.mainPostBlock=e),e},changeAuthorInPoster:function(e){cur.poster&&e&&cur.poster.changeBkgAuthor({authorName:e.authorName,authorUrl:e.authorUrl})},sendInsertBeforeError:function(){ajax.post("al_page.php",{act:"insert_before_error",trace:(new Error).stack,owner_id:cur.oid,module:cur.module})},closeFancyTooltipsInPost:function(){var e=cur.wallAddMedia.lnkId;cur["postPostponeTT"+e]&&cur["postPostponeTT"+e].hide(),cur["post_action_btn"+e]&&cur["post_action_btn"+e].hide(),Object(_web_discover_category_post_topic__WEBPACK_IMPORTED_MODULE_36__.topicUISelectorHide)(e)},switchOwner:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(geByClass1("_ui_toggler",e),"on"),uiSearch.showProgress("wall_search"),cur.options.params.owners_only=cur.options.params.owners_only?null:1,nav.change({owners_only:cur.options.params.owners_only,offset:null})},fakeReplyAsGroupOver:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("reply_fakebox_with_official",e)&&wall.replyAsGroupOver(e)},fakeReplyAsGroupCheck:function(e,_,t){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("reply_fakebox_with_official",e))return window.tooltips&&window.tooltips.hide(e),Wall.showEditReply(_,null,!1,!1,!0,(function(){var e=ge("reply_as_group"+_);e&&(e.focus(),e.click())})),t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t)},setReplyAsGroup:function(e,_){if(!e)return!1;if(e.hasAttribute("data-reinit-ads-needs-confirmation")&&window.AdsEdit&&!_.reinitConfirmed&&AdsEdit.reinitCreatingPostFormNeeded())return AdsEdit.reinitCreatingPostFormConfirm(wall.setReplyAsGroup.pbind(e,extend({},_||{},{reinitConfirmed:!0}))),!1;var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("_submit_post_box",e),o=t&&ge("signed"),a=t&&ge("close_comments"),i=t&&ge("mute_notifications"),r=t&&ge("official"),l=t&&ge("mark_as_ads"),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"tt"),n=_.from||(_.fromGroup?cur.oid:vk.id),d=n==vk.id?wall.replyAsProfileData():window.replyAsData&&window.replyAsData[n]||wall.replyAsGroupDomData(e);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"from-oid")==n||!d||d[0]!=n)return!1;var c=ge("submit_post_box"),p=!t&&cur.poster&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("poster",e),u=t===c;p&&(t=c,o=ge("signed"),l=ge("mark_as_ads"),a=ge("close_comments"),i=ge("mute_notifications"),r=ge("official")),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"from-oid",n),wall.replyAsAnimate(t,d[2],d[1]),cur.poster&&(u||p)&&Wall.changeAuthorInPoster({authorName:d[3],authorUrl:d[2]}),s&&s.rows&&each(s.rows,(function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(this,"active",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(this,"from-oid")==n)})),o&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(o,n>0),l&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(l,n>0),a&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(a,n>0),i&&(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.isChecked)(l)?(addClass(i,"on"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(i,1)):Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disable)(i,n>0)),r&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(r,n!==vk.id),e.setAttribute("aria-label",getLang(n<0?"wall_reply_as_group":"wall_reply_as_user")),e.hasAttribute("data-replace-owner-name")&&(e.innerHTML=d[3],"A"===e.tagName&&(e.href=d[2])),e.hasAttribute("data-replace-post-to")&&(cur.postTo=d[0]),e.hasAttribute("data-replace-oid")&&(cur.oid=d[0]),e.hasAttribute("data-reinit-ads-post-editor")&&window.AdsEdit&&(_.withoutRedraw?AdsEdit.reinitCreatingPostFormBoundWithoutRedraw():AdsEdit.reinitCreatingPostFormBound()),"official"==e.id&&Wall.postChanged(!0);var b=cur.wallAddMedia&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(cur.wallAddMedia.menu.menuNode,"_type_podcast");if(b){var h=cur.postTo==n;each(cur.wallAddMedia.getMedias()||[],(function(e,_){if("podcast"===_[0])return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_[2],"attach_disabled",!h),h=!1,!1})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)(b,h)}return e.id&&Wall.hideCheckTimer(e.id.replace("reply_as_group",""),"editing"),cur.wallAddMedia&&cur.wallAddMedia.donutUpdateVisibility(t),!1},replyAsAnimate:function(e,_,t){var o=e&&geByClass1("_post_field_author",e),a=o&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_field_image",o),i=e&&geByClass1("_post_field_official",e),r=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_field_image",i),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"author_secondary")?0:1;o&&a&&a[l]&&(o.href=_,a[l].src=t),r&&r[l]&&(r[l].src=t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(e,"author_secondary")},replyAsGroupOver:function(e){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"checkbox_official")&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"reply_fakebox_wrap_image")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"disabled"))return!1;var _,t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_submit_post_box",e),o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("deep_active",e);if(_=o&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",e)?[7,8,8]:o?[2,8,8]:[9,8,8],Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{text:function(){return(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"from-oid")||vk.id)<0?getLang("global_on_behalf_group"):getLang("global_on_behalf_me")},black:1,shift:_}),!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"reply_fakebox_wrap_image")&&(wall.isWallReply(e)||wall.isAdsCreatingPost(e))){var a="/al_groups.php",i="get_editor_clubs";wall.isAdsCreatingPost(e)&&(a="/ads_edit.php",i="a_get_promoted_post_stealth_groups"),ajax.post(a,{act:i},{cache:1})}},replyAsGroupFocus:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"tt");_&&_.isShown()||wall.replyAsGroupOver(e)},replyAsGroup:function(e,_,t){if(!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"checkbox_official")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"disabled"))return t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t);if(!(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"can_reply_as_any_group")>0)&&wall.isWallReply(e))return wall.replyAsGroupTT(e,_,[]),t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t);if(!wall.isWallReply(e)&&!wall.isAdsCreatingPost(e)||cur.replyAsLoaded)wall.showReplyAsGroupTooltip(e,_);else{var o="/al_groups.php",a="get_editor_clubs";wall.isAdsCreatingPost(e)&&(o="/ads_edit.php",a="a_get_promoted_post_stealth_groups"),ajax.post(o,{act:a},{cache:1,onDone:function(t){cur.replyAsLoaded=t,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(e)&&wall.showReplyAsGroupTooltip(e,_)}})}return t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t)},showReplyAsGroupTooltip(e,_){var t=!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("can_reply_only_verified",e),o=(cur.replyAsLoaded||[]).filter(e=>!t||e[0]>0||e[4]);wall.replyAsGroupTT(e,_,o)},replyAsGroupDomData:function(e){var _,t,o,a,i;if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",e)){var r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",e),"post-id");r&&(_=ge("reply_box"+r)||ge("reply_fakebox"+r),t=r.split("_")[0])}else _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_submit_post_box",e),t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"oid");return _&&(o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"owner-photo"),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"owner-href"),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"owner-name")),t&&o&&a&&i&&[t,o,a,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.unclean)(i))]||cur.wallTpl&&cur.wallTpl.ownerData||!1},isWallReply:function(e){var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_submit_post_box",e);return _&&_.id.match(/reply_box(-?\d+)_(\d+)/)},isAdsCreatingPost:function(e){return!!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ads_edit_ad_submit_post_header",e)},replyAsProfileData:function(){return window.cur&&cur.wallTpl&&cur.wallTpl.profileData||window.wkcur&&wkcur.wallTpl&&wkcur.wallTpl.profileData||window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData},replyAsGroupList:function(e,_){var t=e.hasAttribute("data-disallow-profile")?[]:[wall.replyAsProfileData()],o=wall.replyAsGroupDomData(e);return o&&t.push(o),(wall.isWallReply(e)||wall.isAdsCreatingPost(e))&&each(window.replyAsList,(function(){this[0]!=_&&t.push(this)})),t},replyAsGroupTT:function(e,_,t){window.replyAsList=t||[],window.replyAsData={},each(window.replyAsList,(function(){window.replyAsData[this[0]]=this}));var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"tt"),a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_submit_post_box",e),i=a&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"from-oid");if(!wall.replyAsProfileData())return!1;if(!o){var r=wall.replyAsGroupList(e,_),l="";e.hasAttribute("data-enable-search")&&(l+='<div class="post_from_tt_row_search_wrap"><input class="clear_fix post_from_tt_row post_from_tt_row_search" value="" placeholder="'+getLang("global_search")+'" /><div class="post_from_tt_row_search_progress"></div></div>');var s=function(e,_,t,o,a){return'<a id="_post_from_tt_row_oid_'+_+'" class="clear_fix post_from_tt_row _post_from_tt_row_searchable'+e+'" data-from-oid="'+_+'" href="'+t+'"><img class="post_from_tt_image" src="'+o+'" aria-label="'+a+'">'+a+"</a>"};each(r,(function(){var e=i==this[0]?" active":"";l+=s(e,this[0],this[2],this[1],this[3])}));var n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("deep_active",e);o=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+l+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"bottom",offset:function(){return wall.isAdsCreatingPost(e)?[e.offsetWidth/2+8.5,-2]:n?[1,-5]:[-10,-5]},onFirstTimeShow:function(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_from_tt_row",_);each(t,(function(_,t){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"post_from_tt_row_search")||addEvent(t,"click",wall.setReplyAsGroup.pbind(e,{from:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(this,"from-oid")}))}));var a=geByClass1("post_from_tt_row_search",_);if(a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_from_tt_row_searchable",_),r=e.getAttribute("data-search-url"),l={};addEvent(a,"keyup valueChanged",(function(){var t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.trim)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(a)).toLowerCase();if(r&&t){e.searchRequestTimeout&&(clearTimeout(e.searchRequestTimeout),delete e.searchRequestTimeout);var n=geByClass1("post_from_tt_row_search_progress",_);geByClass1("pr",n)||Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.showProgress)(n),e.searchRequestTimeout=setTimeout((function(){l[t]?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.hideProgress)(n):ajax.plainpost(r,{str:t},(function(a){l[t]=!0,a=JSON.parse(a),each(a,(function(){if(!ge("_post_from_tt_row_oid_"+this[0])){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(s("",this[0],this[2],this[1],this[3]));geByClass1("ui_scroll_content",_).appendChild(t),addEvent(t,"click",wall.setReplyAsGroup.pbind(e,{from:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"from-oid")})),window.replyAsData[this[0]]||(window.replyAsData[this[0]]=this)}})),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_from_tt_row_searchable",_),setTimeout((function(){o.scroll.update(),o.updatePosition()}),0),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.hideProgress)(n)}),(function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.hideProgress)(n)}))}),500)}each(i,(function(e,_){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggle)(_,""===t||-1!==_.innerText.toLowerCase().indexOf(t))}))}))}this.rows=t,this.scroll=new uiScroll(geByClass1("_post_scroll_wrap",_)),setTimeout((function(){o.scroll.update(),o.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(o.scroll){var _=geByClass1("active",e),t=_?_.offsetTop-(o.scroll.data.viewportHeight-Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(_)[1])/2:0;o.scroll.scrollTop(t);var a=geByClass1("post_from_tt_row_search",e);a&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.elfocus)(a)}}),0)},onHide:function(e){var _=geByClass1("post_from_tt_row_search",e);_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,"")}}),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"tt",o)}_&&o.isShown()&&!e.hasAttribute("data-disallow-profile")&&wall.setReplyAsGroup(e,{from:i==vk.id?_:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),o.isShown()||o.show()},reportPost:function(e,_,t){stManager.add([jsc("web/privacy.js"),"privacy.css"],(function(){return Privacy.show(e,_,"report_"+t)}))},parsePostId:function(e){var _=e.match(/(-?\d+)(_?)(photo|video|note|topic|market|wall_reply|note_reply|photo_comment|video_comment|topic_comment|market_comment|)(\d+)/);return{type:_[3]||"wall",id:_[1]+"_"+_[4]}},likeIt:function(e,_,t,o){if(Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(o),!vk.id)return!1;if(cur.viewAsBox)return cur.viewAsBox(),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(o);var a,i=wall.parsePostId(_),r=i.type,l=i.id,s=e&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_content",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",e))||wall.domPost(l),n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(s,"_like_wrap"),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(n,"_count"),c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n,"my_like");a=_==cur.wallLayer?"wkview":cur.wallType?"feed"==cur.wallType?"news"==cur.section?"feed_"+(cur.subsection?cur.subsection:cur.section):"recommended"==cur.section?"feed_recommended"+("recent"!=cur.subsection?"_"+cur.subsection:""):"friends"==cur.section||"groups"==cur.section||"videos"==cur.section||"photos"==cur.section?"feed_"+cur.section+(cur.subsection?"_"+cur.subsection:""):"feed_"+cur.section:"top"==cur.wallType?"wall_top":"wall_"+(cur.onepost?"one":(cur.wallType||"").indexOf("full_")?"page":"full"):cur.module,ajax.post("like.php",{act:c?"a_do_unlike":"a_do_like",object:r+l,hash:t,wall:2,from:a},{onDone:Wall.likeFullUpdate.pbind(e,_),onFail:function(){return!0}});var p=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.stripHTML)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(d)).replace(/(\s|,)/g,"");return Wall.likeUpdate(e,_,!c,Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(p)+(c?-1:1)),"wall"==r&&window.cur.onLike&&window.cur.onLike(e,r,_,c),cur.onWallLike&&cur.onWallLike(),"wall"==r&&Wall.triggerAdStat(l,"like_post"),!1},likesShow:function(e,_,t){if(!e.postDontShowLikes){t=t||{};var o=wall.parsePostId(_),a=o.type,i=o.id,r=a+i,l=e&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_content",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",e))||wall.domPost(i),s=t.views?"_views_wrap":t.share?"_share_wrap":"_like_wrap",n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(l,s),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"_feedback_info_item")?e:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(n,"_icon"),c=l&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(l,"_share_wrap");if(d&&!cur.viewAsBox){var p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(n)[0],u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(d)[0],b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(d,!0)[0],h=u+b/2-p-41,m=t.views?{views:1}:t.share?{published:1}:{};if(t.listId&&(m.list=t.listId),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(d,"_feedback_info_item")){var v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByTag1)("em",d);h=-40,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(d,"feedback_share")&&(h+=7),h+=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(v)[0]/2}var g=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(d,"_feedback_info_item")?d:d.parentNode;Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(g,{url:"/like.php",params:extend({act:"a_get_stats",object:r,has_share:c?1:""},m),slide:15,shift:[-h,t.views?2:"wall_reply"==a?-3:7],ajaxdt:100,showdt:400,hidedt:200,dir:"auto",checkLeft:!0,reverseOffset:80,noZIndex:!0,tip:{over:function(){Wall.likesShow(e,_,t)}},onShowStart:function(){var _=g.tt.container;setTimeout((function(){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.setStyle)(_,{left:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.floatval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getStyle)(_,"left"))+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(d)[0]-u})}),10),Object(_web_lib_stats__WEBPACK_IMPORTED_MODULE_21__.statlogsValueEvent)("likes_show",Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"shown"))},typeClass:"like_tt",className:t.cl||""})}}},likesShowList:function(e,_,t){t=t||{};var o=wall.parsePostId(_),a=o.type,i=o.id,r=a+i,l=e&&(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_post_content",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",e))||wall.domPost(i),s=t.share?"_share_wrap":"_like_wrap",n=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(l,s);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domByClass)(n,"_icon")&&!cur.viewAsBox&&Object(_web_lib_feature_entries__WEBPACK_IMPORTED_MODULE_13__.showWiki)({w:(t.views?"views":t.share?"shares":"likes")+"/"+Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(r)},!1,!1,{queue:1})},sharesShow:function(e,_,t){Wall.likesShow(e,_,extend(t,{share:1}))},viewsShow:function(e,_,t){Wall.likesShow(e,_,extend(t,{views:1}))},sharesShowList:function(e,_,t){Wall.likesShowList(e,_,extend(t,{share:1}))},viewsShowList:function(e,_,t){Wall.likesShowList(e,_,extend(t,{views:1}))},viewsUpdate:function(e,_){var t=wall.parsePostId(_),o={act:"a_get_stats",object:t.type+t.id,views:1};ajax.post("/like.php",o,{cache:1,onDone:function(t,a){Wall.likeUpdate(!1,_,!1,t,void 0,void 0,1);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:a});e.setAttribute("title",i.innerText||i.textContent),setTimeout(ajax.invalidate.pbind("/like.php",o),3e3)}})},sharesOpen:function(e,_,t){if(cur.viewAsBox)return cur.viewAsBox(),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(e);if(!vk.id)return!1;Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.stopEvent)(e);var o=wall.parsePostId(_),a=o.type,i=o.id,r=a+i;return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showBox)("/like.php",extend({act:"publish_box",object:r},t)),"wall"==a&&Wall.triggerAdStat(i,"share_post"),!1},customCur:function(){return window.wkcur&&wkcur.shown?wkcur:window.mvcur&&mvcur.mvShown?mvcur:window.pvcur&&cur.pvShown?pvcur:cur},processPostReplyActions:function(e){},updatePostAuthorData:function(e){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("_post_author_data_"+e).forEach((function(e){e.post_author_data_update=!0}))},closeComments:function(e,_,t,o,a){var i=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"closed"))?0:1;ajax.post("al_wall.php",{act:"close_comments",owner_id:_,post_id:t,close:i,hash:o},{onDone:function(){if(a)a(i);else{var _=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",e);Wall.onCloseComments(i,_)}}})},onCloseComments:function(e,_,t){if(_&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"postponed")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"post")&&!vk.widget){var o=geByClass1("comment",_),a=geByClass1("reply_box_inner_wrap",_),i=cur.pgParams&&cur.pgParams.archive||"wall_archive"===cur.module,r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"Post--with_closed_comments_donut");if(t||r||o&&a){i||r||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(_,"closed_comments",e);var l=geByClass1("action_closing_comments",_);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(l,"closed",e),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(l,getLang(e?"wall_open_comments":"wall_closing_comments"))}else{var s=_.id.replace("post","").split("_");ajax.post("al_wall.php",{act:"comment_box",owner_id:s[0],post_id:s[1]},{onDone:function(t,o){if(!i){var a=geByClass1("comment",_),r=geByClass1("reply_box_inner_wrap",_);if(!a&&t){var l=geByClass1("like",_);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domNS)(l))}if(!r&&o){var s=geByClass1("replies_list",_);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(o),s)}}Wall.onCloseComments(e,_,!0)}})}}},showPostEditedTime:function(e){var _=(cur.lang||{}).wall_changed;if(_){var t=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"time")),o=60*((new Date).getTimezoneOffset()+180);t&&Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{text:_.replace("{time}",Object(_web_lib_lang__WEBPACK_IMPORTED_MODULE_25__.getDateText)(t,o)),black:1,shift:[0,4]})}},showPostAuthorData:function(e,_){var t=e.className.match(/_post_author_data_(-?\d+_\d+)/)[1]||"",o=_?_.target:window.event.srcElement;!t||o!=e&&o.onmouseover||(e.post_author_data_update&&(delete e.post_author_data_update,e.post_author_data_tt&&(e.post_author_data_tt.destroy(),e.post_author_data_tt=!1)),e.post_author_data_tt||ajax.post("al_page.php",{act:"post_author_data_tt",raw:t},{onDone:function(_){var o=geByClass1("post_link",e)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(e);if(_&&o){var a={content:_,arrowSize:"mini",cls:"post_author_data",defaultSide:"bottom",align:"left",id:"author_tt_"+t},i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("_im_mess_stack",e);i?a.appendTo=i:a.appendToParent=!0,vk.widget&&(a.offset=[0,-2],a.forceSide="bottom"),e.post_author_data_tt=new ElementTooltip(o,a),e.post_author_data_tt.show()}else e.post_author_data_tt=!0}}))},hideAdsReplacedTT:function(){cur.adsReplacedFeatureTT.destroy(),cur.wallAdsReplacedFeatureTooltip=null,cur.adsReplacedFeatureTT=null,ajax.post("al_index.php",{act:"hide_feature_tt",hash:cur.wallAdsReplacedFeatureTooltipHash,type:"ads_in_post_replaced"})},showAdsReplacedTooltip:function(){if(!cur.adsReplacedFeatureTT){var e=setTimeout((function(){var e=geByClass1("addpost_opt");e&&(cur.adsReplacedFeatureTT=new ElementTooltip(e,{content:'<div class="ads_replaced_feature_tt__close" onclick="cur.adsReplacedFeatureTT.hide();"></div>'+getLang("global_ads_in_post_replaced"),forceSide:"top",cls:"feature_intro_tt ads_replaced_feature_tt",autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendTo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e),offset:[1,-10],onHide:Wall.hideAdsReplacedTT}),cur.adsReplacedFeatureTT.show())}),800);cur.destroy.push((function(){clearTimeout(e)})),cur.destroy.push((function(){cur.adsReplacedFeatureTT&&cur.adsReplacedFeatureTT.destroy()}))}},createPostTooltip:_web_page_wall_post_tooltip__WEBPACK_IMPORTED_MODULE_38__.createPostTooltip,showTopWallTooltip:function(e){if(!cur.topWallFeatureTT){var _=ge("page_wall_top");_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(_)||(_=ge("page_wall_top_more")),_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.isVisible)(_)&&(cur.topWallFeatureTT=new ElementTooltip(geByClass1("ui_tab",_)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_tab",_),{content:'<div class="feature_tooltip__close" onclick="cur.topWallFeatureTT.hide();"></div>'+getLang("wall_top_feature_text"),forceSide:"top",cls:"feature_intro_tt feature_info_tooltip",autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendTo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domClosest)("page_block",_),onHide:function(){ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"top_wall_web"})}}),cur.topWallFeatureTT.show())}},hidePostCopyrightFeatureTooltip:function(){cur.postCopyrightFeatureTooltip&&cur.postCopyrightFeatureTooltipHash&&(cur.postCopyrightFeatureTooltip=!1,cur.postCopyrightFeatureTT.hide(),setTimeout(()=>{cur.postCopyrightFeatureTT.destroy()},ElementTooltip.FADE_SPEED),ajax.post("al_index.php",{act:"hide_feature_tt",hash:cur.postCopyrightFeatureTooltipHash,type:"post_copyright"}))},showPostCopyrightFeatureTooltip:function(){if(cur.postCopyrightFeatureTooltip&&!cur.postCopyrightFeatureTT){var e=setTimeout(()=>{var e=ge("post_settings_btn");e&&cur.postCopyrightFeatureTooltip&&(cur.postCopyrightFeatureTT=new ElementTooltip(e,{content:'<div class="feature_tooltip__close" onclick="Wall.hidePostCopyrightFeatureTooltip();"></div>'+getLang("wall_post_copyright_feature_text"),cls:"feature_intro_tt feature_info_tooltip",forceSide:"bottom",autoShow:!1,noOverflow:!1,noHideOnClick:!0,appendToParent:!0,offset:[-6.5,-8],onShow:()=>{ajax.post("al_index.php",{act:"show_feature_tt",hash:cur.postCopyrightFeatureTooltipHash,type:"post_copyright"})},onWindowClick:()=>{cur.postCopyrightFeatureTT&&(cur.postCopyrightFeatureTT.hide(),cur.postField.blur())}}),cur.postCopyrightFeatureTT.show())},800);cur.destroy.push(()=>clearTimeout(e))}},hidePosterFeatureTooltip:function(){cur.posterFeatureTooltip=!1,cur.posterFeatureTT&&cur.posterFeatureTooltipHash&&(cur.posterFeatureTT.destroy(),cur.posterFeatureTT=null,ajax.post("al_index.php",{act:"hide_feature_tt",hash:cur.posterFeatureTooltipHash,type:"poster_new_year"}))},showPosterFeatureTooltip:function(){if(cur.posterFeatureTooltip){var e=setTimeout((function(){var e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domQuery1)(".poster__open-btn",ge("page_poster_btn"));if(e&&cur.posterFeatureTooltip){var _='<div class="poster_feature_tt__layout" onclick="cur.posterFeatureTT.hide(); cancelEvent(event);"><div class="poster_feature_tt__close"></div><div class="poster_feature_tt__info">'+getLang("wall_new_posters_new_year")+"</div>";cur.posterFeatureTT=new ElementTooltip(e,{content:_,forceSide:"bottom",cls:"eltt_fancy poster_feature_tt",autoShow:!1,noOverflow:!1,align:"left",centerShift:-28,noHideOnClick:!0,appendToParent:!0,offset:[0,-8],onHide:Wall.hidePosterFeatureTooltip,onWindowClick:function(){cur.posterFeatureTT.hide(),cur.postField.blur()}}),cur.posterFeatureTT.show(),cur.poster&&cur.poster.sendStatsInfo("new_bkg_tooltip_show")}}),800);cur.destroy.push((function(){clearTimeout(e)}))}},friendsRecommInit:function(e,_){if(e){_=_||{};var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"from")||"user_rec",o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"code"),a={scrollY:!1,onViewItem:function(e,o){_.checkViewItem&&!_.checkViewItem(e)||Wall.onViewFriendRecomm(e,o,t)},onDestroy:function(){_.onDestroy&&_.onDestroy()}};Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"next")&&(a.onLoadMore=function(){ajax.post("al_friends.php",{act:"a_recomm_friends_gallery",next:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"next"),track_code:o,friend_id:_.friendId||0},{onDone:function(_,t){var o=[];_&&(o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.ce)("div",{innerHTML:_}))),Object(_web_components_ui_gallery__WEBPACK_IMPORTED_MODULE_32__.uiGetGallery)(e).addMore(o,!t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"next",t||null)}})}),new _web_components_ui_gallery__WEBPACK_IMPORTED_MODULE_32__.UIGallery(e,a)}},onViewFriendRecomm:function(e,_,t){if(!e.viewed&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_gallery_item")){var o=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"uid"),a="feed"===cur.module&&feed?feed.getModuleRef():cur.module,i=Wall._friendsRecommGetTrackCode(e);Wall.friendsRecommLogSave(["show_user_rec",o,Date.now(),_,a,t,i]),e.viewed=!0}},toggleRecommFriend:function(e,_,t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("friend_recomm_card",e),a=o&&+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(o,"uid");if(a){var i={act:"add",mid:a,hash:t,from:"user_rec",ref:"feed"===cur.module&&feed?feed.getModuleRef():cur.module,track_code:Wall._friendsRecommGetTrackCode(o),ts:Date.now()},r=Wall.friendsRecommLogGet(!0,a);return r.length&&(Wall.friendsRecommLogClear(a),i.logs=r),ajax.post("al_friends.php",i,{onDone:function(_){Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e,_),addClass(e,"secondary"),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.disableButton)(e,!0),addClass(o,"friend_recomm_card_accepted"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(geByClass1("wall_card_text_special",o))},onFail:function(e){if(r&&Wall.friendsRecommLogOnFail(r),e)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("global_error"),e),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(e)}),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_),!1}},hideRecommFriend:function(e,_,t){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("friend_recomm_card",e),a=o&&+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(o,"uid");if(a){var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_gallery",e),r="feed"===cur.module&&feed?feed.getModuleRef():cur.module,l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(o,"code")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"code")||"";return ajax.post("al_friends.php",{act:"hide_possible",mid:a,ref:r,track_code:l,hash:t},{onDone:function(){var _=Object(_web_components_ui_gallery__WEBPACK_IMPORTED_MODULE_32__.uiGetGallery)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_gallery",e));if(_){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_gallery_item",e);_.removeItem(t)}},onFail:function(e){if(e)return Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_16__.showFastBox)(getLang("global_error"),e),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton.pbind(e),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton.pbind(e)}),Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(_),!1}},onClickRecommFriend:function(e){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"ui_gallery_item")||(e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_gallery_item",e)),e){var _=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"uid"),t="feed"===cur.module&&feed?feed.getModuleRef():cur.module,o=Wall._friendsRecommGetTrackCode(e);Wall.friendsRecommLogAddVisited(_,t,o),Wall.friendsRecommLogSave(["open_user",_,Date.now(),t,o])}},_friendsRecommGetTrackCode:function(e){var _,t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"code");return t||(_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("ui_gallery",e),t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"code")),t||""},friendsRecommLogSave:function(e,_){var t=Wall.friendsRecommLogGet();t.push(e),_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set("friends_recomm",t),Wall.friendsRecommLogSend(_)},friendsRecommLogGet:function(e,_,t){var o=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get("friends_recomm")||[];return _&&(o=o.filter((function(e){return(t?e[1]!==_:e[1]===_)&&Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.inArray)(e[0],["show_user_rec","open_user"])}))),e&&(o=o.map((function(e){return e.join("|")}))),o},friendsRecommLogClear:function(e){if(e){var _=Wall.friendsRecommLogGet(!1,e,!0);_.length?_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set("friends_recomm",_):_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.remove("friends_recomm")}else _shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.remove("friends_recomm");Wall.friendsRecommLogCleanVisited(e)},friendsRecommLogAddVisited:function(e,_,t){var o=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get("friends_recomm_visited")||{};o[e]={ref:_,trackCode:t},_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set("friends_recomm_visited",o)},friendsRecommLogCheckVisited:function(e){return(_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get("friends_recomm_visited")||{})[e]},friendsRecommLogCleanVisited:function(e){if(e){var _=_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.get("friends_recomm_visited")||{};delete _[e],_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set("friends_recomm_visited",_)}else _shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.remove("friends_recomm_visited")},friendsRecommLogSend:function(e){!cur.friendsRecommLogIdle&&window.curNotifier&&curNotifier.idle_manager&&(Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(cur.onIdle)||(cur.onIdle=[]),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_37__.isArray)(cur.onUnidle)||(cur.onUnidle=[]),cur.friendsRecommLogIdle=function(){clearTimeout(cur.friendsRecommLog)},cur.onIdle.push(cur.friendsRecommLogIdle),cur.onUnidle.push(Wall.friendsRecommLogSend)),clearTimeout(cur.friendsRecommLog),e?Wall._friendsRecommLogSend():cur.friendsRecommLog=setTimeout(Wall._friendsRecommLogSend,1e4)},_friendsRecommLogSend:function(){if(!cur.friendsRecommProcess){var e=Wall.friendsRecommLogGet(!0);e.length&&(cur.friendsRecommProcess=!0,Wall.friendsRecommLogClear(),ajax.post("al_friends.php",{act:"a_recomm_logs",logs:e},{onDone:function(){delete cur.friendsRecommProcess},onFail:function(){return Wall.friendsRecommLogOnFail(e),delete cur.friendsRecommProcess,!0}}))}},friendsRecommLogOnFail:function(e){var _=Wall.friendsRecommLogGet();_=e.map((function(e){return e.split("|")})).concat(_),_shared_lib_ls__WEBPACK_IMPORTED_MODULE_18__.default.set("friends_recomm",_)},replyEditPhoto:function(e,_,t){return Wall.showEditReply(_,null,!1,!1,!1,(function(){var t=ge("reply_more_attaches"+_);if(t){var o=geByClass1("ms_item_photo",t);tooltips.hide(e),o&&o.click()}})),t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t)},replyMoreAttachShow:function(e,_,t){return Wall.showEditReply(_,null,!1,!1,!0,(function(){var e=geByClass1("ms_items_more_wrap",ge("reply_more_attaches"+_));e&&(e.focus(),e.click())})),t&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(t)},replyFakeEmojiOver:function(e){wall.initEditReply(e,!1,!0,(function(){var _=ge("reply_smile"+e);if(_){var t=geByClass1("emoji_smile",_);t&&t.onmouseover()}}))},hideDeepReplies:function(e){var _=ge("post"+e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"reply")&&(_=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",_),e=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"post-id"));var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"replies-offset")||0,o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"replies-limit")||3,a=ge("replies"+e),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(cur.wallTpl.reply_deep_next,{post_id:e,reply_id:e,offset:t,count:o,text:"",class:" replies_next_main"}));a.innerHTML="",a.appendChild(i),Object(_web_lib_scroll__WEBPACK_IMPORTED_MODULE_22__.scrollToY)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(a)[1]-100,0,null,!0),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"collapse",!0),i.click(),cur.wallMyOpened[e]=0},addNewReply:function(e){var _,t=e[2],o=(e[10]||"").match(/wall.showReply\([^-)0-9]*(-?[_0-9]+)[^-)0-9]*(-?[_0-9]+)[^-)0-9]*\)/),a=o&&o[2]||"",i=a&&a!==t,r=cur.wallLayer&&cur.wallLayer===t,l=r?ge("replies"+t):ge("post"+t),s=l.offsetHeight,n=0,d=0;_=i?wall._addDeepReply(e,a):wall._addRootReply(e);var c=r?ge("wl_post"):ge("post"+t);return wall.incReplyCounter(c,1,e[13]),r?(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(geByClass1("wl_replies_wrap",c)),cur.count++,cur.loaded++):(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)("replies_wrap"+t),Wall.repliesSideSetup(t)),Wall.updateMentionsIndex(),_&&(n=l.offsetHeight-s,d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(_,r)[1]),[n,d]},_addDeepReply:function(e,_){var t,o=e[2],a=e[10]||"",i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(a),r=i&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"root-id")||_,l=ge("post"+r),s=l&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",l),n=cur.wallLayer&&cur.wallLayer===o?wkcur:cur;if(s&&(r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"post-id"),l=ge("post"+r)),!l)return null;var d=ge("replies"+r);if(!d){wall.addDeepRepliesBlock(r);var c=ge("reply_fakebox"+r)||ge("reply_box"+r);c&&hide(c),t=d=ge("replies"+r)}if(!d)return null;if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("reply",d).length){var p=wall._addNewReplyShowMore(o,r,d,"replies_next_deep");t=t||p}else{var u=ge("replies_short_deep"+r),b=wall.isDescRepliesOrder(o);if(u){var h=geByClass1("replies_short_text_count",u),m=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(h).replace(/[^0-9]/g,""))||0;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(h,getLang("global_replied_to_reply_count",m+1))}else{u=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(n.wallTpl.reply_deep_short,{post_id:o,reply_id:r,reply_msg_id:r.split("_")[1],img_src:e[6]||"",name:e[5]||"",count:getLang("global_replied_to_reply_count",1)}));var v=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(d);if(v)Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(u,v),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(v,"replies_next_deep")&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.toggleClass)(v,"replies_prev",b);else{d.appendChild(u);var g=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(n.wallTpl.reply_deep_next,{post_id:o,reply_id:r,offset:0,count:1,text:getLang("wall_next_n_replies",1),class:" replies_next_deep"+(b?" replies_prev":"")}));d.appendChild(g)}}addClass(s,"replies_deep_has_short"),t=u}return wall.updateCollapseDeepReplies(r),removeClass(s,"replies_deep_empty_list"),t},_addRootReply:function(e){var _=e[2],t=cur.wallLayer&&cur.wallLayer===_,o=t?wkcur:cur,a=ge("replies"+_),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(a).length,r="full"===o.wallType,l=!i||i<3&&(t||r),s=wall.isDescRepliesOrder(_);if(l){var n=Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.intval)(e[e.length-1]),d=void 0!==o.options.is_admin?o.options.is_admin:o.options.wall_oid<0?8&n?constants.Groups.GROUPS_ADMIN_LEVEL_EDITOR:2&n?constants.Groups.GROUPS_ADMIN_LEVEL_MODERATOR:constants.Groups.GROUPS_ADMIN_LEVEL_USER:constants.Groups.GROUPS_ADMIN_LEVEL_USER,c=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Wall.getNewReplyHTML(e,d,!1,o));return Object(_web_lib_legacy__WEBPACK_IMPORTED_MODULE_27__.nodeUpdated)(c),s&&a.firstChild?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(c,a.firstChild):a.appendChild(c),c}return wall._addNewReplyShowMore(_,_,a,"replies_next_main",s)},_addNewReplyShowMore:function(e,_,t,o,a){var i,r,l=cur.wallLayer&&cur.wallLayer===e?wkcur:cur,s=l.options.replies_page_count||20,n=a?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domFC)(t):Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domLC)(t);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(n,"replies_next"))return(i=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(n,"count")||0)<s?(i++,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(n,"count",i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(n,a?getLang("wall_prev_n_replies",i):getLang("wall_next_n_replies",i))):a&&(r=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(n,"offset")||0,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(n,"offset",r+1)),n;if(a)r=0;else{var d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)(o,t),c=d[d.length-1],p=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domChildren)(t);if(c){var u=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(c,"count")||s,b=+Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(c,"offset")||0,h=p.indexOf(c);h=(h>=0?h:0)+1,r=b+u+p.slice(h).filter((function(e){return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"reply")})).length}else r=p.filter((function(e){return Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(e,"reply")})).length}var m=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(l.wallTpl.reply_deep_next,{post_id:e,reply_id:_,offset:r,count:1,text:a?getLang("wall_prev_n_replies",1):getLang("wall_next_n_replies",1),class:" "+(a?" replies_prev":"")+(o?" "+o:"")}));return a?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertBefore)(m,t.firstChild):t.appendChild(m),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.show)(m),m},removeDeepReply:function(e){var _=e[2],t=ge("post"+_),o=0,a=0;if(cur.wallMyDeleted[_]||!t)return[o,a];a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getXY)(t,cur.layerpost)[1],Object(_web_lib_video__WEBPACK_IMPORTED_MODULE_24__.revertLastInlineVideo)(t);var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",t)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",t),r=i?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(i,"post-id"):"",l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("replies_wrap_deep",t);if(l)o=-t.offsetHeight,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.getSize)(l)[1]&&addClass(l,"replies_deep_empty_list"),wall.updateCollapseDeepReplies(_);else if(ge("replies_wrap_deep"+_)){var s=cur.wallLayer&&cur.wallLayer===r?wkcur:cur,n=geByClass1("reply_date",t),d=geByClass1("reply_link_wrap",t),c="",p=attr(t,"onclick");p&&(c+=' onclick="'+p+'"');var u=_.split("_")[0],b=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(u<0?s.wallTpl.reply_deleted_group:s.wallTpl.reply_deleted_user,{reply_id:_,date:n?n.innerHTML:"",answer:d?d.outerHTML:"",class:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"reply_replieable")?" reply_replieable":"",attr:c})),h=t.offsetHeight;Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domReplaceEl)(t,b),o=b.offsetHeight-h}else o=-t.offsetHeight,Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.re)(t);return cur.layerpost&&(cur.count--,cur.loaded--),i&&(wall.repliesSideSetup(r),wall.incReplyCounter(i,-1)),[o,a]},addDeepRepliesBlock:function(e){var _=ge("post"+e);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(_,"reply")){var t=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("wl_post",_)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("post",_);if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.hasClass)(t,"deep_active")){var o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(t,"post-id"),a=ge("replies_wrap_deep"+e),i=(cur.wallLayer?wkcur:cur).wallTpl;a||(a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(i.reply_deep,{post_id:o,reply_id:e,reply_msg_id:e.split("_")[1],text:"",offset:0,class:" replies_next_deep"})),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domInsertAfter)(a,_));var r=ge("reply_fakebox"+e),l=ge("reply_box"+e);if(!r&&!l){var s=ge("reply_fakebox"+o)||ge("reply_box"+o),n=geByClass1("checkbox_official",s)||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.gpeByClass)("reply_fakebox_with_official",s),d=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(i.reply_box,{post_id:e,owner_name:Object(_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_19__.clean)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-name")||""),owner_photo:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-photo")||"",owner_href:Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(s,"owner-href")||"",can_reply_as_group:n||"",class:n?" reply_fakebox_with_official":""}));a.appendChild(d),addClass(a,"replies_deep_has_field")}}}},addReplyName:function(e,_){var t={};t[e]=_,wall.addReplyNames(t)},addReplyNames:function(e){var _=cur.wallLayer?wkcur:cur;_.options||(_.options={}),_.options.reply_names=extend({},_.options.reply_names,e)},getReplyNames:function(){return(cur.wallLayer?wkcur:cur).options.reply_names||{}},getReplyName:function(e){return cur.pvShown&&cur.pvReplyNames?cur.pvReplyNames[e]||[]:window.mvcur&&mvcur.mvShown&&!mvcur.minimized?mvcur.mvReplyNames[e]||[]:wall.getReplyNames()[e]||[]},showReorderRepliesTooltip:function(e,_){var t=cur.wallLayer&&cur.wallLayer===_?wkcur:cur;if(!t["postRepliesReorderTT"+_]&&!Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.data)(e,"ett")){var o,a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domPN)(e);o=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"hide-smart")||!1?t.wallTpl.replies_reorder_tooltip:t.wallTpl.replies_reorder_tooltip_with_smart;var i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(o||"",{postId:_})),r=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("radiobtn",i),l=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"order")||"asc";radioBtns["post_replies_reorder"+_]={val:l,els:r},r.some((function(e){if(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"order")===l)return Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.checkbox)(e,!0),!0}));var s=new ElementTooltip(e,{appendTo:a,forceSide:"bottom",autoShow:!1,cls:"eltt_fancy eltt_fancy_actions",noOverflow:!1,centerShift:0,offset:[-10,0],content:i,align:"left"});t["postRepliesReorderTT"+_]=s,cur.destroy.push((function(){s&&s.destroy()})),s.show()}},reorderReplies:function(e,_,t){var o=cur.wallLayer&&cur.wallLayer===_?wkcur:cur;t=t||"asc",Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.radiobtn)(e,t,"post_replies_reorder"+_);var a=ge("post_replies_reorder"+_),i=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"label")||Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e);Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(a,i),a.setAttribute("aria-label",i),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"order",t),o["postRepliesReorderTT"+_]&&o["postRepliesReorderTT"+_].hide(),wall.moreReplies(_,0,0,{deep:!0,clear:!0,order:t,onDone:function(e,t,o){var a=ge("replies"+_);if(o.count>o.offset+o.num){var i=cur.wallLayer&&cur.wallLayer===_?wkcur:cur,r=i.options.replies_page_count||20,l=Math.min(r,o.count-o.offset-o.num),s=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.se)(Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.rs)(i.wallTpl.reply_deep_next,{post_id:_,reply_id:_,offset:o.offset+o.num,count:l,text:getLang("wall_next_n_replies",l),class:" replies_next_main"}));a.appendChild(s)}o.top_reply_ids&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(a,"top-ids",o.top_reply_ids.join(",")),cur.wallMyOpened=cur.wallMyOpened||{},cur.wallMyOpened[_]=1,wall.repliesSideSetup(_)}})},getRepliesOrder:function(e){var _=ge("post_replies_reorder"+e);return(_?Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(_,"order"):"")||"asc"},isDescRepliesOrder:function(e,_){return"desc"===(_=_||wall.getRepliesOrder(e))},postEventChangeStatus:function(e,_,t,o){var a=Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"context");return stManager.add([jsc("web/groups.js")],()=>{Groups.enter(e,_,t,a,(e,t,o)=>{var i=a.split("_"),r=!i[1],l=i[0]+"_"+(r?"decline":""),s=r?getLang("events_snippet_will_participate_active"):getLang("events_snippet_cant_participate_active");o=o||{},Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_event_action_btn"+_).forEach(e=>{addClass(e,"secondary"),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(e,s),Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.domData)(e,"context",l)}),o.members&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("page_media_event"+_).forEach(e=>{var _=geByClass1("page_media_event_members",e);_&&Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.val)(_,o.members)})},{showProgress:()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_event_action_btn"+_).forEach(e=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.lockButton)(e)})},hideProgress:()=>{Object(_web_lib_dom__WEBPACK_IMPORTED_MODULE_12__.geByClass)("post_event_action_btn"+_).forEach(e=>{Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_17__.unlockButton)(e)})}})}),o&&Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_14__.cancelEvent)(o)},showEventFriends:function(e,_){Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_15__.showTooltip)(e,{url:"/al_groups.php",params:{act:"a_event_friends_tt",owner_id:_},ajaxdt:100,showdt:400,hidedt:200,dir:"auto",noZIndex:!0,typeClass:"like_tt"})},showOrderTooltip:function(e){var _=geByClass1("post_replies_reorder");_&&(cur.orderFeatureTT=new ElementTooltip(_,{content:'<div class="feature_tooltip__close" onclick="cur.orderFeatureTT.hide();"></div>'+getLang("wall_order_feature_text"),forceSide:"top",cls:"feature_intro_tt feature_info_tooltip order_feature_tooltip",autoShow:!1,noHideOnClick:!0,noAutoHideOnWindowClick:!0,appendToParent:!0,offset:[0,-4],onHide:()=>{ajax.post("al_index.php",{act:"hide_feature_tt",hash:e,type:"order_web"}),cur.orderFeatureTT.destroy(),delete cur.orderFeatureTT}}),cur.orderFeatureTT.show())},updateRepliesOnScroll:function(){cur.wallLayer?WkView.wallUpdateRepliesOnScroll():"full"===cur.wallType&&FullWall.onePostOnScroll()}};__webpack_exports__.default=Wall},tI7G:function(e,_,t){"use strict";t.r(_),t.d(_,"isDonutDurationFinite",(function(){return i})),t.d(_,"domInsertChildAfterOtherChild",(function(){return r})),t.d(_,"getDonutOnlyFieldEl",(function(){return l})),t.d(_,"appendChildOrUpdate",(function(){return s}));var o=t("zxIV"),a=t("q4CX"),i=function(e){return e>0},r=function(e,_,t){_?Object(o.domInsertAfter)(t,_):e&&(e.firstChild?Object(o.domInsertBefore)(t,e.firstChild):t&&e.appendChild(t))},l=function(e){return e instanceof Element?Object(o.domQuery1)('[name="'+a.ATTACH_DATA_DONUT_ONLY+'"]',e):null},s=function(e,_,t){t?Object(o.domReplaceEl)(t,_):e.appendChild(_)}},te1c:function(e,_,t){"use strict";t.r(_),t.d(_,"MEDIA_SELECTOR_GROUP",(function(){return A})),t.d(_,"MediaSelector",(function(){return x}));t("HEwt"),t("rE2o"),t("ioFf"),t("rGqo"),t("VRzm"),t("Vd3H"),t("a1Th"),t("Btvt"),t("KKXr"),t("Oyvg"),t("SRfc"),t("91GP"),t("pIFo");var o=t("v+DW"),a=t("Egk5"),i=t("EasH"),r=t("FWc3"),l=t("BxOC"),s=t("wetz"),n=t("t7n3"),d=t("/PiP"),c=t("W9Tc"),p=t("7GuL"),u=t("YIAi"),b=t("zxIV"),h=t("jE6c"),m=t("oK+H"),v=t("HLtZ"),g=t("q4CX"),E=t("tI7G"),w=t("CxPP"),O=e=>{var _=e.addMedia,t=e.actionsEl,o=e.onMediaChange;if(!Object(b.ge)("post_donut_duration_btn"+_.lnkId))if(t){var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=e.silent;P({actionsEl:t,addMedia:_,onMediaChange:a?()=>{}:o})},i=Object(b.se)(Object(n.getTemplate)("donut_duration_select",{link_id:_.lnkId})),r=Object(b.geByClass1)("post_available",t);Object(E.domInsertChildAfterOtherChild)(t,r,i),Object(m.createPostTooltip)("post_donut_duration_btn",_.lnkId,()=>{a()});var l=_.findChosenMedia(g.MEDIA_TYPE_DONUT_DURATION);if(void 0!==l){var s=_.chosenMediaToObject(l).data;f(_,s[g.ATTACH_DATA_DONUT_DURATION])}_.donutUpdateVisibility(),a({silent:!0})}else Object(v.logError)(new Error("donutDurationInitSelector: no actionsEl provided"))},P=e=>{var _=e.actionsEl,t=e.addMedia,a=e.onMediaChange;if(_){var i=+Object(o.radioval)("post_settings_btnpost_donut_duration_btn"+t.lnkId);Object(E.isDonutDurationFinite)(i)?t.addOrUpdateChosenMedia(g.MEDIA_TYPE_DONUT_DURATION,"",{[g.ATTACH_DATA_DONUT_DURATION]:i}):D(t),f(t,i),a&&a()}},D=e=>{e.unchooseMediaForType(g.MEDIA_TYPE_DONUT_DURATION)},f=function(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.DONUT_DURATION_DEFAULT,t=Object(b.ge)("post_donut_duration_btn"+e.lnkId);if(t){var a=Object(b.geByClass1)("post_action_btn_text",t),i=Object(b.ge)("donut_duration"+_+e.lnkId),r=Object(E.isDonutDurationFinite)(_),l=r?Object(b.val)(i):Object(b.domData)(a,"empty");a.innerHTML=l,a.setAttribute("aria-label",Object(h.replaceEntities)(l)),Object(b.toggleClass)(t,"on",r);var s="post_donut_duration_btn";Object(o.radiobtn)(i,_,"post_settings_btn"+s+e.lnkId)}},M=(e,_,t)=>{if(t&&_){var o=Object(b.geByClass1)("post_available",_),a=Object(b.ge)("post_donut_duration_btn"+t.lnkId),i=!!Object(E.getDonutOnlyFieldEl)(_);o&&a&&i&&Object(b.toggleClass)(_,"post_actions_btns--donut-actions-hidden",!e)}},C=t("nqXl");function T(e,_){return function(e){if(Array.isArray(e))return e}(e)||function(e,_){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(t.push(r.value),!_||t.length!==_);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return t}(e,_)||function(e,_){if(!e)return;if("string"==typeof e)return L(e,_);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L(e,_)}(e,_)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,_){(null==_||_>e.length)&&(_=e.length);for(var t=0,o=new Array(_);t<_;t++)o[t]=e[t];return o}var A="group",y=p.MEDIA_TYPE_DONUT_DURATION,I="anonymous",B="poll_fixed",j="poll_closed",W="poll_background_id",R="poll_photo_id",U="poll_until",k="poll_is_multiple",K="poll_disable_unvote",S=/^invite\/[a-z0-9]{7}$|/,x=function(e,_,t,m,v,g){var E,P=[],L=(m=m||{}).mediaHandlers||{},x=m.from;each(t||[],(function(_,t){var a=t[0],l=t[1],s=t[2];if(l){var n=!1,d=!1,c=m.toId||cur.postTo,p={to_id:c,blockPersonal:m.blockPersonal};switch(p.mail_add=m.mail?1:"",p.from=m.from,a){case"graffiti":n=showBox.pbind("al_wall.php",{act:"canvas_draw_box",flash:browser.flash},{cache:1,dark:1});break;case"photos_list":n=showBox.pbind("al_photos.php",extend(p,{act:"choose_photo"}),{cache:1,stat:[jsc("web/photos.js"),"photos.css",jsc("web/upload.js")],dark:1});break;case"photo":n=L.photo?L.photo.pbind(m):showBox.pbind("al_photos.php",extend(p,{act:"choose_photo",max_files:m.limit||10,no_album_select:~(m.disabledTypes||[]).indexOf("album")?1:""}),{cache:1,stat:[jsc("web/photos.js"),"photos.css",jsc("web/upload.js")],dark:1});break;case"video":var u=extend(p,{act:"a_choose_video_box",max_files:m.limit||10});n=function(){var _=domClosest("_submit_post_box",e);hasClass(_,"anon_field_on")||showBox("al_video.php",u,{cache:1,dark:1})};break;case"audio":n=function(){var _=domClosest("_submit_post_box",e);hasClass(_,"anon_field_on")||stManager.add([jsc("web/audio.js"),jsc("web/indexer.js"),jsc("web/auto_list.js"),jsc("web/grid_sorter.js"),"audio.css"],(function(){var _=!1;each(E.chosenMedias||[],(function(){"audio_playlist"===this[0]&&(_=!0)})),cur.audioAttachOriginalOwnerId=!1,cur.audioAttachSwitchOwnerId=!1;var t=vk.id,o=parseInt((""+p.to_id||"").replace(/^board/,"-")),a=domClosest("_submit_post_box",e);domData(a,"from-oid")<0||"im"===cur.module&&cur.gid?(t=o,cur.audioAttachOriginalOwnerId=o,cur.audioAttachSwitchOwnerId=vk.id):cur.hasGroupAudioAccess&&(cur.audioAttachOriginalOwnerId=vk.id,cur.audioAttachSwitchOwnerId=o),AudioPage.showAttachBox(t,{canPlaylistAttach:!_&&!cur.editor,onAudioChoose:AudioUtils.onAudioChoose,onPlaylistChoose:AudioUtils.onPlaylistChoose})}))};break;case"poll":n=()=>E.chooseMedia("poll","",s);break;case"doc":n=L.doc?L.doc.pbind(m):showBox.pbind("docs.php",Object.assign(p,m.docParams,{act:"a_choose_doc_box"}),{stat:["docs.css"]});break;case"map":n=showBox.pbind("al_places.php",extend(p,{act:"a_choose_place_box"}),{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"note":n=showWiki.pbind({note:"new"},!0,!1,{queue:1});break;case"postpone":n=e=>{if(g){if(hasClass(e.target,"_close"))return E.unchooseMedia(E.postponeInd),void cancelEvent(e);var _=()=>{cur["postPostponeTT"+E.lnkId].show(),triggerEvent(geByClass1("datepicker_control",cur["postPostponeTT"+E.lnkId]._ttel),"mousedown",!1,!0);var e=!E.postponeDate;E.postponeDate=val("postpone_date"+E.lnkId),e&&E.chooseMedia("postpone",E.postponeDate,s)};E.postponeDatepicker?"DP_PLACEHOLDER"!==E.postponeDatepicker&&_():(cur.postponedLastDate&&(s.date=intval(cur.postponedLastDate)+3600),E.postponeDatepicker="DP_PLACEHOLDER",E.setupPostpone(s,null,_))}else E.chooseMedia("postpone",l,s)};break;case y:d=!0,n=()=>{};break;case"mark_as_ads":n=()=>E.chooseMedia("mark_as_ads",l,s);break;case"share":n=function(e){e=e||{},window.onShareChooseUrlBoxInit=function(){var e=geByClass1("share_url_input",curBox().bodyNode);addEvent(e,"keydown",(function(e){if(e.which==KEY.ENTER)return t(curBox().btns.ok[0],e),!1}))};var _=showBox("share.php",{act:"choose_url_box"},{dark:1}),t=function(t,a){var i=geByClass1("share_url_input",_.bodyNode),r=val(i);Object(o.lockButton)(t),disable(i,!0),hide("share_url_error"),E.chooseMedia("share",l,extend(s,{url:r,draft:!0,onSuccess:function(){disable(i,!1),Object(o.unlockButton)(t),_.hide(),e.videoId&&window.AdsEdit&&window.AdsEdit.showSnippetVideo&&window.AdsEdit.showSnippetVideo(e.videoId)},onError:function(e){var _="";e&&e!==getLang("global_unknown_error")&&-1===e.indexOf("ERR_PAGE_GET_FAILED")&&(_=e+" "),disable(i,!1),Object(o.unlockButton)(t),ge("share_url_error").innerHTML=_+getLang("global_share_link_failed"),show("share_url_error")}}))};_.removeButtons(),_.addButton(getLang("global_continue"),t)};break;case"pretty_cards":n=function(e){e&&e.replace_owner_id&&(s.editor.owner_id=e.replace_owner_id),E.chooseMedia("pretty_cards",l,s)};break;case"gift":n=function(){var e=(e=m.peer<2e9?m.peer:0)||cur.peer;m.giftBoxPrepare&&m.giftBoxPrepare(e),showBox("al_gifts.php",{act:"get_gift_box",mid:e,fr:e==vk.id?1:0,ref:"media_selector"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1})};break;case"money":n=function(){var e=cur.peer;c>-2e9&&c<0&&(p.owner_id=c),showBox("al_payments.php",extend(p,{act:"money_transfer_box",to_id:e}),{onFail:function(e){return curBox()&&curBox().hide(),setTimeout(Object(i.showFastBox)(getLang("global_error"),e).hide,2e3),!0}})};break;case"market":c==vk.id?(n=showBox.pbind("al_market.php",extend(p,{act:"a_choose_user_product_box"}),{cache:1}),s.tt_words&&(cur.checkMessageHandler=function(e){if(!cur.marketIntroShown&&(e=" "+e+" ").match(new RegExp("\\s("+s.tt_words.join("|")+")\\s","i"))){var _=getSize(E.menu.moreWrap);Object(r.showTooltip)(E.menu.moreWrap,{text:s.tt_text,dir:"left",slideX:15,width:230,shift:[-_[0]-5,-_[1]/2],hasover:1}),cur.marketIntroShown=!0}})):n=showBox.pbind("al_market.php",extend(p,{act:"a_choose_product_box"}),{cache:1});break;case"article":n=()=>openArticleEditor(c);break;case"podcast":n=function(){stManager.add([jsc("web/podcast.js")],(function(){Podcast.select()}))}}(n||d)&&P.push([a,l,n])}})),_=ge(_||"media_preview"),v=!1!==v&&ge(v||"post_settings_btn"),g=!1!==g&&ge(g||"post_actions_btns");var N=m.limit||10,F=N>1,H=m.editable&&(!browser.msie||parseInt(browser.version)>8),$=m.sortable&&(!browser.msie||parseInt(browser.version)>8),V=!!g,z=function(e,_,t){if(!(e=ge(e)))return!1;t=t||{},window.__addMediaIndex||(window.__addMediaIndex=0);var o=++__addMediaIndex;e.innerHTML='<div class="media_selector clear_fix"></div>';var i,r=domByClass(e,"media_selector"),l=[],s={id:o,menuNode:r,types:_,lastTypes:_,_onInitHandlers:[],activate:function(e){s.touched=!0===e,t.onActivate&&t.onActivate()},show:function(){if(i&&(clearTimeout(i),i=0),s.moreWrap&&!hasClass(s.moreWrap,"shown")){t.forceToUp||replaceClass(s.moreWrap,"to_up","to_down");var e=domByClass(s.moreWrap,"_more_items");(getClientRectOffsetY(e)>0||t.forceToUp)&&replaceClass(s.moreWrap,"to_down","to_up"),setTimeout(addClass.pbind(s.moreWrap,"shown"),0)}},hide:function(e){function _(_){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}((function(e){if(!i){var _=function(){i=0,s.moreWrap&&removeClass(s.moreWrap,"shown")};if(e){var t=domByClass(s.moreWrap,"_more_items");hide(t),_(),setTimeout(show.pbind(t),0)}else i=setTimeout(_,300)}})),setOptions:function(e){extend(t,e)},setItems:function(e){for(window.tooltips&&tooltips.destroyAll(r);r.firstChild;)re(r.firstChild);var _=void 0!==t.hideAfterCount?t.hideAfterCount:4,o=void 0!==t.maxShown?t.maxShown:3,i=!1,n=t.hideItem,c=(n||e.length>_)&&(!browser.mobile||t.ignoreMobile),p=t.hideLabel||getLang("global_media_selector_more");function u(e,_,o,a,i,r){var n=ce("a",{innerHTML:a?_:'<span class="blind_label">'+_+"</span>",className:"ms_item ms_item_"+e+" _type_"+e});if(!a&&s.moreWrap?domInsertBefore(n,s.moreWrap):(a||i).appendChild(n),n.setAttribute("tabindex",0),!a){n.setAttribute("data-title",_),n.setAttribute("aria-label",_),n.setAttribute("role","link");var d=function(){showTitle(this,!1,r||!1,{noZIndex:!0})};addEvent(n,"mouseover",d),l.push((function(){removeEvent(n,"mouseover",d)}))}if(o&&!cur.viewAsBox){var c=function(){return s.activate(),s.hide(!0),t.onItemClick&&!t.onItemClick(e)||o(),!1};addEvent(n,"click",c),l.push((function(){removeEvent(n,"click",c)}))}}s.moreWrap=!1,s.lastTypes=e,each(e,(function(e,_){var b=_[0],h=_[1],m=_[2];if("article"!=b){if("postpone"===b&&V&&!s.postponeBtn){var v=getLang("wall_publication_now");s.postponeBtn=se(`<div class="post_action_btn has_cross" id="post_postpone_btn${s.id}">\n                <div class="post_action_btn_layout">\n                  <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(v)}">${v}</span>\n                  <span class="post_action_image_btn _close" role="button" title="${replaceEntities(getLang("wall_post_timer_reset"))}"></span>\n                  <div class="post_action_tt_content _postpone" id="post_postpone_tt_content${s.id}" onclick="cancelEvent(event)"></div>\n                </div>\n               </div>`),t.actionsEl.appendChild(s.postponeBtn);var g="post_postpone_btn"+s.id,w=ge(g),P=geByClass1("post_action_tt_content",w),D=geByClass1("post_action_btn_layout",w),f=[-4*(vk.rtl?-1:1),4],M=new ElementTooltip(D,{appendTo:domPN(w),forceSide:"bottom",autoShow:!1,customShow:!0,cls:"_postpone timer_in_tt",noOverflow:!1,centerShift:0,offset:f,content:P,noHideOnClick:!0,align:"left",onShow:()=>{E.activeState=!0},onHide:()=>{E.activeState=!1,setTimeout(()=>{E.postponeDatepicker&&E.postponeDatepicker.hide()},ElementTooltip.FADE_SPEED)},onFirstTimeShow:function(){show(P)}});return cur["postPostponeTT"+s.id]=M,cur.destroy.push((function(){M&&M.destroy()})),addEvent(s.postponeBtn,"click",m),void l.push((function(){removeEvent(s.postponeBtn,"click",m)}))}if(b!==y){if(c&&(n?b==n:e==o)){var C=r.appendChild(ce("div",{className:"ms_items_more_wrap"})),T=function(e){s.fromKeyboard=Object(a.checkKeyboardEvent)(e),"mouseover"==e.type&&(s.touched||s.fromKeyboard)||(s.fromKeyboard&&hasClass(s.moreWrap,"shown")?s.hide():s.show())},L=function(){s.fromKeyboard||s.hide()};addEvent(C,"mouseover click",T),addEvent(C,"mouseout",L),l.push((function(){removeEvent(C,"mouseover click",T),removeEvent(C,"mouseout",L)})),t.vectorIcon&&(p='<span class="blind_label">'+p+"</span>",addClass(C,"ms_items_more_wrap_vector"));var A=C.appendChild(ce("a",{className:"ms_item_more",innerHTML:'<span class="ms_item_more_label">'+p+"</span>"}));A.setAttribute("tabindex",0),A.setAttribute("role","button");var I=ce("div",{className:"ms_items_more_helper"});i=ce("div",{className:"ms_items_more _more_items"}),I.appendChild(i),C.appendChild(I),s.moreWrap=C}u(b,h,m,i,r)}else s.enqueueOnAddMediaInit(O)}else Object(d.isArticleEditorAvailable)()&&u(b,h,m,!1,r,[6,8])}))},enqueueOnAddMediaInit(e){s._onInitHandlers.push(e)},onAddMediaInit(e){s._onInitHandlers.forEach(_=>{_(e)}),s._onInitHandlers=[]}};_&&s.setItems(_),browser.msie&&(removeEvent(e,"MSPointerDown"),addEvent(e,"MSPointerDown",s.activate.pbind(!0)));removeEvent(e,"mouseover"),addEvent(e,"mouseover click",s.activate),t.global||cur.destroy.push((function(){removeEvent(e,"mouseover click",s.activate)}));t.forceToUp&&addClass(geByClass1("ms_items_more_wrap",r),"to_up");return s.handlersToClean=l,s}(e,P,{onActivate:function(){cur.attachCount=E.attachCount,cur.chooseMedia=E.chooseMedia,cur.getFrom=E.getFrom,cur.hasChosenMedia=E.hasChosenMedia,cur.lastAddMedia=E,cur.onMediaUploadStarted=m.onMediaUploadStarted,cur.showMediaProgress=E.showMediaProgress,cur.unchooseMedia=E.unchooseMedia,cur.updateChosenMedia=E.updateChosenMedia},onItemClick:function(e){return!(F&&E.attachCount()>=N&&"postpone"!==e&&"mark_as_ads"!==e&&"copyright"!==e)||(vk.widget?showBox("blank.php",{code:1900,limit:N}):Object(i.showFastBox)(getLang("global_error"),getLang("attachments_limit",N)),!1)},hideAfterCount:m.hideAfterCount,topOffset:m.topOffset,forceUp:m.forceUp,global:m.global,maxShown:m.maxShown,forceToUp:m.forceToUp,vectorIcon:m.vectorIcon,ignoreMobile:m.ignoreMobile,actionsEl:g,hideLabel:m.hideLabel});if(z){var q=intval(z.id);if(F){_.innerHTML=`<div id="page_pics_preview${q}" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview${q}" class="page_pics_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview${q}" class="page_docs_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview${q}" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview${q}" class="page_docs_preview media_preview clear_fix"></div><div id="page_adocs_preview${q}" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview${q}" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview${q}" class="page_docs_preview media_preview _page_ppdocs_preview clear_fix"></div><div id="page_progress_preview${q}" class="page_progress_preview media_preview clear_fix"></div>`;var G=domFC(_),Y=domNS(G),X=domNS(Y),J=domNS(X),Q=domNS(J),Z=domNS(Q),ee=domNS(Z),_e=domNS(ee),te=domNS(_e);removeClass(_,"media_preview"),removeClass(Q,"vk_mini_app_preview"),addClass(_,"multi_media_preview")}else addClass(_,"med_no_attach"),show(_);return V&&(_e=ge("post_postpone_tt_content"+q)),(E={_addMediaLink:e,lnkId:q,menu:z,types:P,phLists:{},handlers:{},postponeIsTooltip:V,chosenMedias:[],limit:N,_showAddMedia:function(){z.show()},_hideAddMedia:function(e){z.hide(e)},hasRestrictingAttach:function(){return geByClass1("medadd_c_story",X)},getFrom:()=>x,updateChosenMedia:function(e,_,t){E.chooseMedia(e,_,t,null,null,null,!0)},addOrUpdateChosenMedia(){for(var e=arguments.length,_=new Array(e),t=0;t<e;t++)_[t]=arguments[t];var o=_[0],a=_[1];return(E.hasChosenMedia(o,a)?E.updateChosenMedia.bind(E):E.chooseMedia.bind(E))(..._)},hasChosenMedia:function(e,_){var t=!1;return each(E.chosenMedias,(function(){if(this[0]===e&&this[1]===_)return t=!0,!1})),t},chooseMedia:function(t,o,a,i,r,l,s){if(!cur.articleEditorLayer||"article"===t||"poll"===t){if(vk.widget&&(o=clean(o)),"postpone"===t&&V){if(hasClass(E.menu.postponeBtn,"on"))return!1;addClass(E.menu.postponeBtn,"on")}if(m.poster&&m.poster.isOpen()&&"postpone"!==t&&t!==y&&"copyright"!==t&&m.poster.closeEditor(),E.onChange&&!1===E.onChange(t,o,a,i))return void 0!==a.upload_ind&&re("upload"+a.upload_ind+"_progress_wrap"),!1;if("note"===t&&(cur.pbNoteAdded=!1),inArray(t,m.disabledTypes||[]))return!1;if((E.attachCount()>=N&&void 0===a.upload_ind&&"postpone"!==t&&t!==y&&"mark_as_ads"!==t||E.hasRestrictingAttach())&&"copyright"!==t){if(F)return!1;E.unchooseMedia()}var d=!1,u={},b=null;if(F&&(each(E.chosenMedias,(function(e){if(b=e,this[0]==t&&this[1]==o)return d=!0,!1;u[this[0]]=u[this[0]]?u[this[0]]+1:1})),d&&!s||s&&!d))return!1;var h,v,g="",w="",O=!1,P=X,D="",M="",L=!1;switch(t){case"graffiti":if(u.pretty_cards)return!1;isObject(a)||(a={thumb:a||""}),g=`<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="${(a=He(a)).thumb}" /></div>`,P=O=ee;break;case"photos_list":if(vk.widget||u.pretty_cards)return!1;hide(this._addMediaLink),vkImage().src=a[1],(I=a[3].replace(/^{|}$/g,""))&&(I+=","),I+='"queue":1',g=`<div${m.nocl?"":` onclick="return showPhoto('${a[4]}', '${a[2]}', '${I.replace(/"/g,"&quot;")});"`} class="fl_l page_preview_photo"><img class="page_preview_photo" src="${a[1]}" /></div>`,P=O=G;break;case"photo":if(u.pretty_cards)return!1;isObject(a)||(a={thumb_m:a[0]||"",thumb_s:a[1]||"",list:a[2]||"",view_opts:a[3]||"",upload_ind:a.upload_ind||void 0}),a=He(a),vkImage().src=a.thumb_m;var I=a.view_opts.replace(/^{|}$/g,"");if(vk.widget&&(I=I.replace(/&quot;/g,'"')),I&&(I+=","),I+='"queue":1',E.phLists[o]=a.list,H){if(!a.editable)return!1;if(!m.nocl){var B="{"+I+"}";B=JSON.parse(B),a.editable.click=E.showPhoto.pbind(o,a.list,B)}}g=`<div ${m.nocl?"":` onclick="return cur.addMedia[${E.lnkId}].showPhoto('${o}', '${a.list}', {${I.replace(/"/g,"&quot;")}});"`} class="fl_l page_preview_photo${l?" page_preview_ph_graff":""}"><img class="page_preview_photo" src="${a.thumb_m}" /></div>`,O=1,P=G;break;case"video":if(isEmpty(a)||u.pretty_cards)return!1;if(isObject(a)||(a={thumb:a||""}),H){if(!a.editable)return!1;m.nocl||(a.editable.click=showVideo.pbind(o,a.list_id,{queue:1,autoplay:1}))}(a=He(a)).preview&&!vk.widget?(g=a.preview,a.editable.preview=g):g=`\n              <div ${m.nocl?"":`onclick="return showVideo('${o}', '${a.list_id}', {queue:1,autoplay:1});"`} class="fl_l page_preview_video">\n                <img class="page_preview_video" src="${a.thumb}" />\n              </div>\n            `,O=1,P=G,v=a.list_id;break;case"article":if(vk.widget||u.article||u.page||u.pretty_cards||!a)return!1;g='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+getLang("global_article")+"</div>",w=a.snippet_html,o=a.url,a.rev&&(o+="?rev="+a.rev),P=Q;break;case"audio":if(u.pretty_cards)return!1;a=He(a),g=Page.addAudioPreview(clean(o),a),D=` id="pam${q}_audio${clean(o)}"`;break;case"audio_playlist":if(u.audio_playlist)return!1;(a=He(a)).id=intval(a.id),a.ownerId=intval(a.ownerId),vk.widget&&a.authorHref&&!a.authorHref.match(/^(https?:\/\/|\/)/)&&(a.authorHref="https://"+a.authorHref),vk.widget&&a.coverUrl&&!a.coverUrl.match(/^(https?:\/\/|\/)/)&&(a.coverUrl="https://"+a.coverUrl);var j=a.coverUrl?`background-image:url('${a.coverUrl}'); background-size: cover;`:"",W="";W=a.authorHref?`<a href="${a.authorHref}" onclick="return nav.go(this)">${a.authorName}</a>`:a.authorName;var R="'"+(a.accessHash||"")+"'";w='<div class="audio_pl_attach_preview _audio_pl _audio_pl_'+a.ownerId+"_"+a.id+' clear_fix"><div class="audio_pl_attach_preview__play" onclick="return getAudioPlayer().playPlaylist('+a.ownerId+", "+a.id+", "+R+')"></div><div class="audio_pl_attach_preview__cover" style="'+j+'">'+(a.gridCovers||"")+'</div><div class="audio_pl_attach_preview__title">'+a.title+'</div><div class="audio_pl_attach_preview__info_line">'+W+"</div></div>",g='<span class="medadd_h">'+getLang("global_audio_playlist")+"</span>",P=Q;break;case"artist":if(u.artist)return!1;var U=a.coverUrl?`background-image:url('${a.coverUrl}');`:"",k="",K="";a.blockId&&(k=`<div class="audio_artist_snippet__play" onclick="return getAudioPlayer().playBlock('${a.ownerId}', 'artist${a.blockId}', '', '', 'artist')">${getLang("audio_listen_snippet")}</div>`,K="_audio_pl _audio_pl_${data.ownerId}_artist${data.blockId}"),w=`<div class="audio_artist_attach_preview _audio_artist ${K} clear_fix">\n              <div class="audio_artist_snippet__cover" style="${U}"></div>\n              <div class="audio_artist_snippet__info">\n                ${k}\n                <div class="audio_artist_snippet__title">${a.title}</div>\n                <div class="audio_artist_snippet__subtitle">${getLang("global_artist")}</div>\n              </div>\n            </div>`,g='<span class="medadd_h">'+getLang("global_artist")+"</span>",P=Q;break;case"doc":if(vk.widget||u.pretty_cards)return!1;if(a.editable){var S="stopEvent(event);";(a=He(a)).hasBox&&(a.editable.click=e=>{Page.showGifBox(a.id,a.ownerId,intval(a.postId),intval(a.postOwnerId),a.hash,e)},S=`Page.showGifBox(${intval(a.id)}, ${intval(a.ownerId)}, ${intval(a.postId)}, ${intval(a.postOwnerId)}, '${a.hash}', event);`),M+=" page_preview_doc_as_photo_wrap";var x=T(a.editable.sizes.m||a.editable.sizes.s,1)[0];g=`<a href="${a.editable.href}" onclick="${m.nocl?"":S}" class="page_preview_doc_as_photo" target="_blank" rel="noopener" style="background-image: url('${x}');"><img class="page_preview_doc_as_photo" src="${x}" />${a.editable.label}</a>`,O=1,P=G}else a.thumb&&a.thumb_s?(g="gif"==a.ext?'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+a.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+a.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint doc_gif">'+a.title+"</div>":'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+a.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+a.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint">'+a.title+"</div>",w='</a><div class="pam_bg"></div>',P=O=Y,D=' id="pam'+q+"_doc"+o+'"'):(g="",w='<div class="page_doc_row"><a target="_blank" rel="noopener" href="'+a.href+'" class="page_doc_icon page_doc_icon'+intval(a.type)+'"></a><a target="_blank" href="'+a.href+'" class="page_doc_title">'+a.title+'</a><div class="page_doc_description_row"><div class="page_doc_size">'+a.size_str+"</div></div></div>",D=' id="pam'+q+"_doc"+o+'"');break;case"story":if(vk.widget||u.pretty_cards)return!1;g='<div class="medadd_c_story"><a target="_blank" rel="noopener" '+a.attr+'"><div class="medadd_c_story_thumb fl_l" style="background-image:url('+a.thumb+')"></div></a><div class="medadd_c_story_info fl_l"><a class="medadd_c_story_title" target="_blank" '+a.attr+'">'+a.title+'</a><div class="medadd_c_story_desc">'+a.date_string+"</div></div>",hide(e);break;case"narrative":if(u.narrative)return!1;g='<span class="medadd_h">'+getLang("global_type_narrative")+"</span>",w=a.snippet_html;break;case"mask":if(vk.widget||u.pretty_cards)return!1;g='<div class="medadd_c_mask"><div class="medadd_c_story_thumb fl_l" style="background-image:url(/images/landings/vkmasks/masksSnippet_2x.png)"></div></a><div class="medadd_c_story_info fl_l"><div class="medadd_c_story_title">'+a.share.title+'</div><div class="medadd_c_story_desc">'+a.share.desc+"</div></div>";break;case"share":if(u.share||u.page||u.pretty_cards||u.market||!a.lang)return!1;if(isArray(a)&&(a={domain:a[0],url:a[1],initialPattern:a[2],title:a[3],description:a[4],images:[a[5]],user_id:a[6],photo_id:a[7]}),L=a.is_vk_mini_app,a.draft){var te={onSuccess:a.onSuccess,onError:a.onError};return E.checkURL(a.url,void 0,{},te),!1}if(!a.title&&!(cur.options.share||{}).allow_preview_empty_links)return(a.onError||function(){})(),!1;if(L?(a.title=Object(n.unclean)((a.title||"").replace(/\n/g,"\\n")),a.description=Object(n.unclean)((a.description||"").replace(/\n/g,"\\n"))):(a.title=Object(n.unclean)((a.title||"").replace(/<br>/g,"\n")),a.description=Object(n.unclean)((a.description||"").replace(/<br>/g,"\n")),a.description_short=Object(n.unclean)((a.description_short||"").replace(/<br>/g,"\n")),a.description_narrow=Object(n.unclean)((a.description_narrow||"").replace(/<br>/g,"\n"))),cur.options=cur.options||{},cur.options.share&&cur.options.share.max_title_len&&(a.title=(a.title||"").substr(0,cur.options.share.max_title_len)),cur.options.share&&cur.options.share.max_desc_len&&(a.description=(a.description||"").substr(0,cur.options.share.max_desc_len),a.description_short=(a.description_short||"").substr(0,cur.options.share.max_desc_len),a.description_narrow=(a.description_narrow||"").substr(0,cur.options.share.max_desc_len)),a.media=a.media||o,a.lang&&(cur.lang=extend(cur.lang||{},a.lang)),a=He(a),g='<a target="_blank" rel="noopener" href="/away.php?to='+encodeURIComponent(a.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(Object(n.unclean)(a.is_vk_mini_app?a.lang.global_vk_mini_app:a.lang.profile_choose_link))+"</a>",L&&addClass(Q,"vk_mini_app_preview"),!a.prometheus&&a.map_data){var oe=$e(Q),ae="";ae=a.map_data[3]?a.map_data[3].replace("size=0,0","size="+oe.width+","+oe.height):"/maps?lat="+floatval(a.map_data[0])+"&lng="+floatval(a.map_data[1])+"&z=11&"+(window.isRetina()?"w="+2*oe.width+"&h="+2*oe.height:"w="+oe.width+"&h="+oe.height);var ie="";Object(c.partConfigEnabled)("maps_no_referrer")&&(ie='referrerpolicy="no-referrer"'),g+=`<div class="medadd_c_share_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(a.map_data[0])}, long: ${floatval(a.map_data[1])}, provider: ${intval(a.map_data[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" ${ie} width="${oe.width}" height="${oe.height}" src="${ae}" /></a></div>`}if(E.shareData=extend(E.shareData||{},a,{imagesStyles:[""]}),P=Q,(a.onSuccess||function(){})(),(cur.options.share||{}).button_exclusive&&a.shareButtons)hide(e),(le=ge("signed"))&&disable(le);hide(domByClass(z.menuNode,"_type_share")),hide(domByClass(z.menuNode,"_type_market"));break;case"pretty_cards":if(u.share||u.pretty_cards||vk.widget)return!1;var le;g='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+a.lang.global_wall_pretty_cards+"</div>",(le=ge("signed"))&&disable(le),hide(domByClass(z.menuNode,"_type_pretty_cards")),hide(e),P=Q;break;case"poll":if(!a.lang||vk.vidget||u.poll||!J||u.pretty_cards)return!1;hide(domByClass(z.menuNode,"_type_poll")),P=J;break;case"map":if(vk.widget||u.pretty_cards)return!1;var ne=$e(ee);ie="";Object(c.partConfigEnabled)("maps_no_referrer")&&(ie='referrerpolicy="no-referrer"'),g=`<span class="medadd_h medadd_h_link inl_bl">${clean(Object(n.unclean)(a[4]))}</span><div class="fl_l medadd_c_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(a[0])}, long: ${floatval(a[1])}, provider: ${intval(a[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" ${ie} width="${ne.width}" height="${ne.height}" src="/maps?lat=${floatval(a[0])}&lng=${floatval(a[1])}&z=11&w=${ne.width}&h=${ne.height}" /></a></div>`,P=O=ee,hide(domByClass(z.menuNode,"_type_map"));break;case"page":if(u.share||u.page||!a.lang||vk.widget||u.pretty_cards)return!1;var de=a.media.split("_");g='<a href="/page'+a.media+'" onclick="return showWiki({oid: '+de[0]+", id: "+de[1]+'}, false, event, {queue: 1})" class="medadd_h medadd_h_page inl_bl">'+a.lang.profile_choose_page+"</a>",P=Q;break;case"album":if(vk.widget||u.pretty_cards)return!1;if(a.is_private_album){extend(a.editable,{title:a.title,size:0}),O=1,P=G;break}if(a.thumb.match(/^\/images\//)&&(a.thumb=""),H){if(!a.editable)return!1;extend(a.editable,{title:a.title,size:a.count,click:!m.nocl&&nav.change.pbind({z:"album"+o})})}var pe=a.thumb;vkImage().src=pe,g=`<a class="${"fl_l page_album_link"+(pe?"":" page_album_nocover")}" ${h=m.nocl?"":' href="/album'+o+'" onclick="return nav.change({z: \'album'+o+"'}, event)\""}>\n              ${pe?`<div class="page_album_thumb_wrap"><img class="page_album_thumb" src="${pe}"/></div>`:""}\n              <div class="page_album_title">\n                <div class="page_album_size">${a.count}</div>\n                <div class="page_album_title_text">${a.title}</div>\n              </div>\n            </a>`,O=1,P=G;break;case"note":if(!a.lang||vk.widget||u.pretty_cards)return!1;g="<a onclick=\"showWiki({w: 'note"+a.raw+'\', edit: 1}, true, event, {queue: 1})" class="medadd_h medadd_h_note inl_bl">'+a.lang.profile_choose_note+"</a>",w='<div class="medadd_c medadd_c_note"><a onclick="showWiki({w: \'note'+a.raw+'\', edit: 1}, true, event, {queue: 1})" id="share_note_title'+a.raw+'">'+a.title+"</a></div>",P=Q;break;case"market":if(vk.widget||u.pretty_cards||u.share||u.market)return!1;g='<div class="medadd_c_market"><a target="_blank" rel="noopener" href="'+a.href+'"><img class="medadd_c_market_thumb fl_l" src="'+a.thumb+'" /></a><div class="medadd_c_market_info fl_l"><a class="medadd_c_market_title" target="_blank" href="'+a.href+'">'+a.title+'</a><div class="medadd_c_market_price">'+a.price+"</div></div>",hide(domByClass(z.menuNode,"_type_market"));break;case"market_album":if(vk.widget||u.pretty_cards)return!1;if(a.is_private_album){extend(a.editable,{title:a.title,msize:""}),O=1,P=G;break}if(H){if(!a.editable)return!1;extend(a.editable,{title:a.title,msize:langNumeric(a.count,a.lang.profile_X_market_items),click:!1})}de=o.split("_");vkImage().src=a.thumb,h=m.nocl?"":' href="/market'+de[0]+"?section=album_"+de[1]+'"',g=`<a class="${"fl_l page_preview_album wall_album_cover_wrap wall_market_album_cover"+(a.thumb?"":" page_album_nocover")}" ${h}>\n              ${a.thumb?`<img class="wall_album_cover" src="${a.thumb}"/>`:""}\n              <div class="wall_album_caption">\n                <div class="wall_album_title_wrap clear_fix">\n                  <div class="wall_album_count fl_r">${a.count}</div>\n                  <div class="wall_album_title">${a.title}</div>\n                </div>\n              </div>\n            </a>`,O=1,P=G;break;case"copyright":if(vk.widget)return!1;E.copyrightCreate(a);break;case"postpone":if(vk.widget)return!1;var ue="";if(cur.editingPost&&!F)o=intval(o),a.date=o||intval(cur.editingPost[7]),ge("wpe_save").innerHTML=getLang("global_save"),ue=getLang("global_save");else if(cur.editingPost&&"wpe_media_preview"==_.id){o=intval(o),a.date=o||intval(cur.editingPost[7]);var be=geByClass1("medadd_c_timersett",_e);if(be){var he=domPN(be);be=he.innerHTML,re(he)}else be="";ge("wpe_save").innerHTML=getLang("global_save"),ue=getLang("global_save")}else{a.draft?a.date=intval(o):cur.postponedLastDate&&(a.date=intval(cur.postponedLastDate)+3600);var me=ge("official");if(!(Ie=gpeByClass("_submit_post_box",me))&&m.poster&&domClosest("poster",me)&&(Ie=ge("submit_post_box")),me&&Ie){var ve=domData(Ie,"from-oid"),Ee=domData(Ie,"oid");ve==vk.id&&Ee&&wall.setReplyAsGroup(me,{from:Ee}),disable(me);var we=window.data(me,"tt");if(we&&we.rdBtns){var Oe=we.rdBtns[1],Pe=we.rdBtnsGroup,De=domData(Oe,"as");radiobtn(Oe,De,Pe)}}(Oe=ge("send_post"))&&(Oe.innerHTML=a.lang.profile_wall_postpone_btn,ue=a.lang.profile_wall_postpone_btn)}V?(E.updatePostponeBtnText(!1,a.date),E.postponeDate=a.date):g=`<div class="medadd_h medadd_h_timer inl_bl">${a.lang.profile_choose_timer}<span id="postpone_preview${q}"></span></div>`,!E.postponeDatepicker&&V&&E.setupPostpone(a,be),m.poster&&m.poster.changeBtnText(ue);var fe=Math.round((new Date).getTime()/1e3);intval(a.date)<fe&&(a.date=fe+3600),hide(domByClass(z.menuNode,"_type_postpone")),P=_e;break;case y:if(vk.widget)return!1;f(E,a[p.ATTACH_DATA_DONUT_DURATION]);break;case"mark_as_ads":if(vk.widget)return!1;g='<div class="medadd_h medadd_h_mark_as_ads inl_bl">'+a.lang.global_ads_wall_post_mark_as_ads_action+"</div>",hide(domByClass(z.menuNode,"_type_mark_as_ads")),P=_e;break;case"wall":if(vk.widget||u.pretty_cards)return!1;g='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+a.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+a.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+a.href+'">'+a.author+'</a><div class="medadd_c_wall_type">'+a.lang.title+"</div></div>",D=' id="pam'+q+"_wall"+o+'"',hide(e);break;case"wall_reply":if(vk.widget||u.pretty_cards)return!1;g='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+a.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+a.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+a.href+'">'+a.author+'</a><div class="medadd_c_wall_type">'+a.lang.title+"</div></div>",D=' id="pam'+q+"_wall_reply"+o+'"',hide(e);break;case"podcast":if(vk.widget||u.pretty_cards)return!1;var Me="_im_media_preview"===domPN(P).id,Ce=!Me&&cur.editingPost&&"wpe_media_preview"===domPN(P).id;if(Me)g='<div class="medadd_c_podcast"><a target="_blank" rel="noopener" href="'+a.href+'"><img class="medadd_c_podcast_thumb fl_l" src="'+a.thumb+'" /></a><div class="medadd_c_podcast_info fl_l"><a class="medadd_c_podcast_title" target="_blank" href="'+a.href+'">'+a.title+'</a><div class="medadd_c_podcast_type">'+a.lang.title+"</div></div>";else{var Te=!1;each(E.chosenMedias||[],(function(e,_){isArray(_)&&"podcast"===_[0]&&(cur.addMedia[E.lnkId].unchooseMedia(e),Te=!0)})),Te&&E.onChange&&E.onChange(t,o,a,i),g='<div class="podcast_preview_title">'+getLang("audio_podcast_attach_media")+"</div>";var Le=a.audio[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+a.audio[AudioUtils.AUDIO_ITEM_INDEX_ID];cur.podcastEditData={audioId:Le,ref:"post",onCreate:function(e,_){E.chooseMedia("podcast",e[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[AudioUtils.AUDIO_ITEM_INDEX_ID],{audio:e,coverUrl:_})}};var Ae="<span class=\"podcast_snippet__edit\" onclick=\"cur.chooseMedia = cur.podcastEditData.chooseMedia; stManager.add([jsc('web/podcast.js')], function() { Podcast.edit('"+Le+"'); });\"></span>";g+='<div class="podcast_snippet_loading" id="podcast_loading'+o[0]+'"></div>',stManager.add([jsc("web/podcast.js")],(function(){domReplaceEl(ge("podcast_loading"+o[0]),Podcast.drawSnippet(a.audio,a.coverUrl,Ae))}),!0)}if(P=Z,(a.onSuccess||function(){})(),hide(domByClass(z.menuNode,"_type_podcast")),!Me&&!Ce){var ye=ge("official"),Ie=ye&&gpeByClass("_submit_post_box",ye);if(ye&&Ie)(ve=domData(Ie,"from-oid"))!==(Ee=domData(Ie,"oid"))&&(M=" attach_disabled")}break;case A:if(vk.widget||u.pretty_cards||u[A])return!1;var Be="",je=Number(a.type);if(je===C.GROUPS_CLASS_EVENT&&(Be=a.private?getTemplate("event_snippet_private_info"):""),!(g=getTemplate("event_snippet",extend({bottom:Be},a))))return(a.onError||function(){})(),!1;g='<div class="event_preview_title">'+(je===C.GROUPS_CLASS_EVENT?getLang("events_media_type"):getLang("groups_media_type_community"))+"</div>"+g,P=Q,(a.onSuccess||function(){})()}if(F){var We=E.chosenMedias,Re=d?b:We.length,Ue="";if(H&&1===O)Ue=!1;else if("photos_list"===t)Ue=se('<div class="page_preview_'+t+"_wrap"+M+'" style="position: relative">'+g+'<div class="page_photos_count">'+o.split(",").length+"</div></div>");else if("postpone"==t&&V||"copyright"===t||t===y)Ue=!1;else{var ke=null;"share"===t&&a.map_data&&(ke="map"),Ue=se('<div class="page_preview_'+(ke||t)+"_wrap"+M+(L?" page_preview_vk_mini_app":"")+'"'+(m.nocl?' style="cursor: default"':"")+D+'><div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+E.lnkId+"].unchooseMedia("+Re+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+g+w+"</div>")}if(addClass(Ue,O?"fl_l":"clear_fix"),void 0!==a.upload_ind&&re("upload"+a.upload_ind+"_progress_wrap"),m.toggleLnk&&!d){var Ke=E.attachCount()+1<N;toggle(e,Ke),m.onToggleBlock&&m.onToggleBlock(Ke)}H&&1===O?(addClass(P,"editable_thumbs_wrap"),P=domLC(P)&&hasClass(domLC(P),"editable_thumbs")?domLC(P):P.appendChild(ce("div",{id:"thumbs_edit"+q,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css",jsc("web/thumbs_edit.js")],()=>{if(We[Re]&&(We[Re].type===t||We[Re].media!==o)){if(m.toggleLnk&&!d){var i=E.attachCount()+1<N;toggle(e,i),m.onToggleBlock&&m.onToggleBlock(i)}a.editable.remove=E.unchooseMedia.pbind(Re),show(domPN(P));var r=ThumbsEdit.convert(t,o,a.editable);domData(P,"te-inited")?d?ThumbsEdit.updateMedia(P,t,o,a):ThumbsEdit.addMedia(P,r):ThumbsEdit.init(P,[r],{width:m.teWidth,height:m.teHeight,force:!0,onMove:m.onAddMediaChange,onUpdate:m.onChangedSize,deferred:!0}),toggleClass(_,"media_preview_has_medias",E.hasVisibleRows()&&(hasClass(_,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),m.onChangedSize&&m.onChangedSize()}},!0)):(("postpone"!=t&&"copyright"!=t&&t!==y||!V)&&(show(P),d?P.replaceChild(Ue,We[b][2]):P.appendChild(Ue)),$&&(P==X?stManager.add([jsc("web/sorter.js")],(function(){var e=getXY(X),_=getSize(X),t=function(){X.sorter?sorter.added(X):P.childNodes.length>1&&sorter.init(X,{onReorder:m.onAddMediaChange})};e[0]||e[1]||_[0]||_[1]?t():cur.sorterClbk=t,m.onChangedSize&&m.onChangedSize()}),!0):P==Y&&stManager.add([jsc("web/qsorter.js")],(function(){Y.qsorter?qsorter.added(Y):P.childNodes.length>1&&qsorter.init(Y,E.qsorterOpts()),m.onChangedSize&&m.onChangedSize()}),!0)),m.onChangedSize&&m.onChangedSize()),d?We[b]=[t,o,Ue,i,v,a]:We.push([t,o,Ue,i,v,a])}else{Re=0;if("postpone"===t?Re=1:"mark_as_ads"===t&&(Re=2),"postpone"==t&&V||"copyright"===t||t===y)Ue=!1;else{var Se=(!1===O?"page_docs_preview":"page_pics_preview")+(Re?"":" post_thumbed_media");Se+=O?" fl_l":" clear_fix";var xe=null;"share"===t&&a.map_data&&(xe="map"),Ue=se(`\n            <div class="${Se}">\n              <div class="${"page_preview_"+(xe||t)+"_wrap"} ${M}" ${(m.nocl?'style="cursor: default"':"")+D}>\n                ${g}\n                <div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="${getLang("dont_attach")}" aria-label="${getLang("dont_attach")}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[${E.lnkId}].unchooseMedia(${Re}); return cancelEvent(event);">\n                  <div class="page_media_x" nosorthandle="1"></div>\n                </div>\n                ${w}\n              </div>\n            </div>`)}void 0!==a.upload_ind&&re("upload"+a.upload_ind+"_progress_wrap"),"postpone"!==t&&t!==y&&"mark_as_ads"!==t&&"copyright"!==t&&(E.chosenMedia=[t,o],E.chosenMedia[5]=a,E.chosenMediaData=a),E.singleAdded(Ue,t)}"share"==t?!a.title||i||a.url?a.video?(cur.shareShowImg=0,E.bigLink=!0,E.showExternalPreview()):E.showExternalPreview():(cur.shareShowImg=0,E.showPreview(!0),E.shareData.images=!1):"page"==t?a.nopreview||(cur.shareShowImg=0,E.shareData=extend(E.shareData||{},a,{images:!1}),E.showPreview()):"poll"===t?E.pollCreate(a):"postpone"==t?V?E.postponeInd=Re:E.setupPostpone(a,be):"mark_as_ads"==t?E.markAsAds=1:"pretty_cards"==t&&E.createPrettyCards(a),toggleClass(_,"media_preview_has_medias",E.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),m.onChangedSize&&m.onChangedSize();var Ne=window.event;return Ne&&"click"==Ne.type&&(Ne.ctrlKey||Ne.metaKey||Ne.shiftKey)&&E.attachCount()+1<=N&&(r=!0),cur.fileApiUploadStarted&&void 0!==a.upload_ind||cur.preventBoxHideWithSharedBox||cur.preventBoxHide||!0===r||inArray(t,["poll","share","page","postpone","mark_as_ads","pretty_cards","copyright"])||boxQueue.hideLast(),cur.lastPostMsg=!1,m.onMediaAdd&&m.onMediaAdd(),getAudioPlayer().updateCurrentPlaying(),cur.onMediaChanged&&cur.onMediaChanged(E.chosenMedias),m.onMediaChanged&&m.onMediaChanged(),void 0!==a.upload_ind&&delete a.upload_ind,!1}function Fe(e,_){return isString(e)?e=clean(Object(n.unclean)(Object(n.unclean)(e))):(isObject(e)||isArray(e))&&(e=He(e,_)),e}function He(e,_){if(!vk.widget)return e;if((_=positive(_))>5)return e;if(isArray(e))e.forEach((function(t,o){e[o]=Fe(t,_+1)}));else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&(e[t]=Fe(e[t],_+1));return e}function $e(e){var _=340,t=127;return"im"!==cur.module&&(_=Math.min(parseInt(e.parentElement.offsetWidth),510)||480,t=Math.min(_/2,200),(hasClass(e.parentElement,"reply_media_preview")||"wpe_media_preview"===e.parentElement.id)&&t>120&&(t=120)),{width:_,height:t}}},unchooseMedia:function(t,o){if(E.onChange&&!1===E.onChange(!1,t))return!1;if(F){if(cur.checkURLDomainRequest&&cur.checkURLDomainRequest.abort(),clearTimeout(cur.showLoaderTimeout),clearInterval(cur.shareImgInterval),clearTimeout(cur.shareImgInterval2),clearTimeout(cur.imgLoadTimeout),clearTimeout(cur.checkURLDomainTO),void 0===t){if(window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+q),each(E.chosenMedias,(function(e,_){!_||void 0===e||o&&!inArray(_[0],o)||E.unchooseMedia(e)})),E.urlsCancelled=[],m.onChangedSize){m.onChangedSize();var a=setInterval(m.onChangedSize,50);setTimeout(clearTimeout.bind(null,a),500)}return void(E.copyrightToggle&&E.copyrightToggle(!0))}var i=E.chosenMedias;if(i[t]){var r;switch("podcast"===i[t][0]&&(r=cur.editingPost&&!cur.editingPost[3].reply&&"wpe_media_preview"===gpeByClass("multi_media_preview",i[t][2]).id),i[t][2]?((g=geByClass1("page_media_x_wrap",i[t][2],"div"))&&g.tt&&g.tt.el&&g.tt.destroy(),domPN(i[t][2])==X&&X.sorter?(each(X.sorter.elems,(function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})})),X.sorter.destroy(),re(i[t][2]),X.childNodes.length>1&&sorter.init(X,{onReorder:m.onAddMediaChange})):domPN(i[t][2])==Y&&Y.qsorter?(each(Y.qsorter.elems,(function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})})),Y.qsorter.destroy(),re(i[t][2]),Y.childNodes.length>1&&qsorter.init(Y,E.qsorterOpts())):re(i[t][2])):"photo"!=i[t][0]&&"video"!=i[t][0]&&"album"!=i[t][0]||window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+q,i[t][0]+i[t][1]),i[t][0]){case"page":case"share":E.shareData={},re(E.sharePreview),hide("medadd_c_linkimg_loader"),delete E.sharePreview,show(domByClass(z.menuNode,"_type_share")),show(e),(l=ge("signed"))&&disable(l,!isChecked("official")),show(domByClass(z.menuNode,"_type_market"));break;case"pretty_cards":var l;re(E.prettyCardGallery.el),delete E.prettyCardGallery,(l=ge("signed"))&&disable(l,!isChecked("official")),show(domByClass(z.menuNode,"_type_pretty_cards")),show(e);break;case"poll":re(E.pollPreview),delete E.pollPreview,show(domByClass(z.menuNode,"_type_poll"));break;case"map":show(domByClass(z.menuNode,"_type_map"));break;case"podcast":var s=!0;if(r)+cur.editingPost[0].split("_")[0]!==cur.oid&&(s=!1);else{var n=(d=ge("official"))&&gpeByClass("_submit_post_box",d);if(d&&n)domData(n,"from-oid")!==domData(n,"oid")&&(s=!1)}toggle(domByClass(z.menuNode,"_type_podcast"),s);break;case"market":show(e),show(domByClass(z.menuNode,"_type_market"));break;case"wall":case"wall_reply":case"story":case"narrative":show(e);break;case"postpone":var d,c=geByClass1("medadd_c_timersett",E.postponePreview);cur.editingPost&&c&&!V?re(domFC(E.postponePreview)):(_e.innerHTML="",E.postponeDatepicker=null,E.postponeDate=null),E.postponePreview=!1,(d=ge("official"))&&disable(d,!1);var p=m.poster,u="";if(cur.editingPost)if(cur.editingPost[6]&&intval(cur.editingPost[6].getAttribute("data-suggest"))){u=getLang("wall_publish_suggest");var b=ge("wpe_save");b&&(b.innerHTML=u)}else{u=getLang("wall_publish_now");var h=ge("wpe_save");h&&(h.innerHTML=u)}else u=getLang("wall_send"),ge("send_post").innerHTML=u;p&&p.changeBtnText(u),V?(removeClass(E.menu.postponeBtn,"on"),E.updatePostponeBtnText(!0)):show(domByClass(z.menuNode,"_type_postpone"));break;case y:f(E);break;case"mark_as_ads":show(domByClass(z.menuNode,"_type_mark_as_ads")),E.markAsAds=!1;break;case"copyright":E.copyrightRemove()}i[t]=!1}if(m.toggleLnk){s=E.attachCount()<N;toggle(e,s),m.onToggleBlock&&m.onToggleBlock(s)}toggle(G,!!(H?geByClass1("thumb_wrap",G):domFC(G))),toggle(Y,!!domFC(Y)),toggle(X,!!domFC(X)),toggle(J,!!domFC(J)),toggle(Q,!!domFC(Q)),toggle(Z,!!domFC(Z)),toggle(ee,!!domFC(ee)),V||toggle(_e,!!domFC(_e)),toggle(te,!!domFC(te))}else{var v,g;if(null==t&&(t=0),(g=geByClass("page_media_x_wrap",_,"div")[t])&&g.tt&&g.tt.el&&g.tt.destroy(),1==t){if(V)_e.innerHTML="",E.postponeDatepicker=null,E.postponeDate=null,removeClass(E.menu.postponeBtn,"on"),E.updatePostponeBtnText(!0);else if(E.postponePreview){show(geByClass1("add_media_type_"+q+"_postpone",z.menuNode,"a"));var w=domPN(E.postponePreview);window.tooltips&&tooltips.destroyAll(w),re(w),E.postponePreview=!1;var O=z.lastTypes;each(z.types,(function(e,_){"postpone"===_[0]&&O.push(_)})),z.setItems(O)}}else if(2==t&&E.markAsAds){E.markAsAds=!1;var P=geByClass1("page_preview_mark_as_ads_wrap",_);window.tooltips&&P&&tooltips.destroyAll(P),re(P);O=z.lastTypes;each(z.types,(function(e,_){"mark_as_ads"===_[0]&&O.push(_)})),z.setItems(O)}else if(3===t)E.copyrightRemove();else{if(E.postponePreview||E.markAsAds){w=E.postponePreview&&domPN(E.postponePreview),P=E.markAsAds&&domPN(geByClass1("page_preview_mark_as_ads_wrap",_));for(var D=[],M=0;M<_.childNodes.length;M++){var C=_.childNodes[M];"DIV"==C.nodeName&&C!=w&&C!=P&&D.push(C)}each(D,(function(e,_){re(_)}));O=[];each(z.types,(function(e,_){"postpone"===_[0]&&E.postponePreview||"mark_as_ads"===_[0]&&E.markAsAds||O.push(_)})),z.setItems(O)}else val(_,""),addClass(_,"med_no_attach"),z.setItems(z.types);E.chosenMedia&&(E.chosenMedia=!1,E.chosenMediaData=!1),(v=E.shareData)&&(v.url&&E.urlsCancelled.push(v.url),v.initialPattern&&E.urlsCancelled.push(v.initialPattern),E.shareData={}),each([E.sharePreview,E.pollPreview],(function(){re(this)})),E.sharePreview=E.pollPreview=!1}m.toggleLnk&&show(e)}if(toggleClass(_,"media_preview_has_medias",E.hasVisibleRows()&&(hasClass(_,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),E.copyrightToggle&&E.copyrightToggle(!0),cur.onMediaChanged&&cur.onMediaChanged(i),m.onMediaChanged&&m.onMediaChanged(),cur.lastPostMsg=!1,E.onChange&&E.onChange(!1),m.onChangedSize){m.onChangedSize();a=setInterval(m.onChangedSize,50);setTimeout(clearTimeout.bind(null,a),500)}},findChosenMedia:e=>E.chosenMedias.find(_=>_[0]===e),findChosenMediaAllIndices(e){return _=E.chosenMedias,t=_=>_[0]===e,_.reduce((function(e,_,o){return t(_)?e.concat(o):e}),[]);var _,t},chosenMediaToObject(e){var _=T(e,6);return{type:_[0],media:_[1],data:_[5]}},unchooseMediaForType(e){E.findChosenMediaAllIndices(e).forEach(e=>{E.unchooseMedia(e)})},singleAdded:function(t,o){if("copyright"!==o){if("postpone"===o){if(V)return;_.appendChild(t)}else if("mark_as_ads"===o)E.postponePreview?_.insertBefore(t,domLC(_)):_.appendChild(t);else{if(o===y)return;domFC(_)?_.insertBefore(t,domFC(_)):_.appendChild(t)}removeClass(_,"med_no_attach");var a=[];each(z.lastTypes,(function(e,_){("postpone"!==_[0]||!E.postponePreview&&"postpone"!==o)&&("mark_as_ads"!==_[0]||!E.markAsAds&&"mark_as_ads"!==o)&&(inArray(o,["postpone","mark_as_ads"])||inArray(_[0],["postpone","mark_as_ads"]))&&a.push(_)})),z.setItems(a),m.toggleLnk&&!a.length&&hide(e)}},getMedias:function(e){if(F){var _=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+q):[],t={},o=E.chosenMedias||[],a=[],i=function(e,_,o){if(o[0]+o[1]==e)return a.push(o),t[e]=!0,!1};return each(_,(function(e,_){each(o,i.pbind(_[0]+_[1]))})),each(Y.childNodes,(function(e,_){var t=(_.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(o,i.pbind(t[1]+t[2]))})),each(X.childNodes,(function(e,_){var t=(_.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(o,i.pbind(t[1]+t[2]))})),each(o,(function(e,_){_&&isArray(_)&&_.length&&!t[_[0]+_[1]]&&a.push(_)})),a}return(o=E.chosenMedia)?[e?o:o[0]+o[1]]:[]},showPhoto:function(e){function _(_,t,o,a){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}((function(e,_,t,o){for(var a in!cur.pvData||cur.pvShown&&cur.pvListId==_||delete cur.pvData[_],ajaxCache)a.toString().match(/^\/al_photos\.php\#act=show&draft_photos/)&&delete ajaxCache[a];var i=E.getMedias(),r=[];return each(i,(function(e,_){_&&"photo"==_[0]&&r.push(_[1]+"/"+(E.phLists[_[1]]||""))})),t.additional={},t.additional.open_pe=intval(cur.openEditor),cur.openEditor||(t.additional.draft_photos=r.join(";")),delete cur.openEditor,showPhoto(e,_,extend(t,{queue:1}),o)})),showMediaProgress:function(_,t,o){if(E.onProgress&&!1===E.onProgress(_,t,o))return!1;var a=o.loaded/o.total,i=intval(100*a),r=(o.fileName||o.name||"").replace(/[&<>"']/g,""),l=r?t+"_"+r:t,s=r?r.length>33?r.substr(0,30)+"...":r:"",n=ge("upload"+l+"_progress");if(n){show(n);u=geByClass1("ui_progress_bar",n);setStyle(u,{width:i+"%"})}else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[l]=q;var d=`\n          <div class="fl_l">\n            <div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">\n              <div id="upload${l}_progress" class="page_attach_progress ui_progress">\n                <div class="ui_progress_back"></div>\n                <div class="ui_progress_bar"></div>\n              </div>\n            </div>\n          </div>\n          ${s?'<div class="attach_label fl_l">'+s+"</div>":""}\n          <div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200);showTooltip(this, {text: '${getLang("dont_attach")}', shift: [16, 8, 8], black: 1})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="Upload.terminateUpload(${t}, '${r||t}', this);"></div>\n          `;if(F){if(te.appendChild(ce("div",{id:"upload"+l+"_progress_wrap",innerHTML:d,className:"clear_fix upload_"+t+"_progress"},{marginTop:"6px"})),show(te),m.toggleLnk){var c=E.attachCount()<N;toggle(e,c),m.onToggleBlock&&m.onToggleBlock(c)}}else{var p=ce("div",{id:"upload"+l+"_progress_wrap",innerHTML:d,className:"clear_fix upload_"+t+"_progress"});E.chosenMedia="progress",E.singleAdded(p,"progress")}m.onChangedSize&&m.onChangedSize(),n=ge("upload"+l+"_progress");var u=geByClass1("ui_progress_bar",n);i?setStyle(u,{width:i+"%"}):(setStyle(u,{width:"1px"}),hide(n))}},hasVisibleRows:function(){var e=!1;return each(geByClass("media_preview",_),(function(){if(isVisible(this))return e=!0,!1})),e},attachCount:function(){if(E.attachedCount)return E.attachedCount();if(!_)return 0;if(!F)return _.childNodes.length-(E.postponePreview?1:0)-(E.markAsAds?1:0);var e=(H&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+q]||{}).previews||[]:G.childNodes).length+Y.childNodes.length+ee.childNodes.length+X.childNodes.length/(X.sorter?2:1)+te.childNodes.length;return E.sharePreview&&++e,E.pollPreview&&++e,e},pollCreate:function(e){var _=e.poll_html;if(cur.addMedia[q].pollInputData=e,J)if(_){var t=`<div class="medadd_c" id="poll_dummy${q}">${_}</div>`;E.pollPreview=J.appendChild(domFC(cf(t)))}else stManager.add(["ui_controls.css","ui_controls.js","datepicker.css",window.jsc("web/datepicker.js")],()=>{var _=e.poll_question_length,t=e.question,o=e.lang,a=e[I],i=e.answers,r=e[B],l=e[j],s=e[W],d=e[R],c=e[U],p=e[k],u=e.poll_is_board,b=e.poll_is_edit,h=e.poll_is_not_posted,v=e.poll_backgrounds,g=e.poll_answers_limit||10,w=e.poll_no_animate_opening||e.question,O=e[K],P=`\n          <div class="medadd_h medadd_h_poll inl_bl">\n            ${o.question}\n            <span class="medadd_poll_question_warning"></span>\n          </div>\n          <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" oninput="cur.addMedia[%lnkid%].pollChangeQuestion(this)" maxlength="${_}" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_question${u&&b?" disabled":""}"${u&&b?' readonly="readonly"':""} id="create_poll_question%lnkid%" value="%question%" />\n          <div class="medadd_h">${o.answers}</div>\n          <div class="medadd_poll_answers" id="create_poll_answers%lnkid%">\n            %answers%\n          </div>\n          ${u&&b?"":`<div class="medadd_poll_answer_add_wrap" id="create_poll_add%lnkid%">\n            <div class="medadd_poll_answer_add fakeinput dark" onclick="cur.addMedia[%lnkid%].pollAnswerAdd()">${o.answer_add}</div>\n          </div>`}\n          %backgrounds%\n          %settings%\n          <div class="checkbox medadd_datepicker_checkbox medadd_poll_cb%classuntil%" id="create_poll_until%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.until}</div>\n          <div class="medadd_datepicker">\n            <input type="text" class="medadd_datepicker_date dark" id="create_poll_untildate%lnkid%"/><div class="medadd_datepicker_at datepicker_at">${o.at}</div><input type="text" class="medadd_datepicker_time dark" id="create_poll_untiltime%lnkid%"/>\n          </div>\n          ${u?`\n          <div class="checkbox medadd_poll_cb%classonmain%" id="create_poll_onmain%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.add_to_main}</div>\n          `:""}\n          ${u&&b?`\n          <div class="checkbox medadd_poll_cb%classclosed%" id="create_poll_closed%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.close}</div>\n          `:""}\n        `,D=`\n          <div class="medadd_h">${o.settings}</div>\n          ${b&&!h||u?"":`<div class="checkbox medadd_poll_cb%classanon%" id="create_poll_anonymous%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.anonymous}</div>`}\n          ${b?"":`<div class="checkbox medadd_poll_cb%classmulty%" id="create_poll_multy%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.multy}</div>`}\n          ${b?"":`<div class="checkbox medadd_poll_cb%classdisableunvote%" id="create_poll_disable_unvote%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${o.disable_unvote}</div>`}\n        `,f=`\n          <div class="medadd_poll_answer_wrap">\n            <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_answer${u&&b?" disabled":""}"${u&&b?' readonly="readonly"':""} %attrs%/>\n            <div class="page_media_x_wrap medadd_poll_answer_remove" data-title="${o.answer_remove}" aria-label="${o.answer_remove}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[%lnkid%].pollAnswerRemove(this)">\n              <div class="page_media_x"></div>\n            </div>\n          </div>\n        `,M=`\n          <div class="medadd_h">${o.background}</div>\n          <div class="medadd_poll_backgrounds_wrap" id="create_poll_backgrounds_wrap%lnkid%">\n            <div class="medadd_poll_backgrounds_arrow_prev" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('prev')"></div>\n            <div class="medadd_poll_backgrounds_arrow_next" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('next')"></div>\n            <div class="medadd_poll_backgrounds" id="create_poll_backgrounds%lnkid%">\n              %backgrounds%\n            </div>\n          </div>\n        `;cur.addMedia[q].answersLimit=g,cur.addMedia[q].tplAnswer=f;var C="";u||(C+=cur.addMedia[q].pollBackgroundGetHtml(),v&&v.forEach(e=>{C+=cur.addMedia[q].pollBackgroundGetHtml(e)}),C+=rs('\n          <div class="medadd_poll_background medadd_poll_background_uploader" onclick="cur.addMedia[%lnkid%].pollBackgroundUpload(this);">\n            <div class="medadd_poll_background_preview"></div>\n          </div>\n        ',{lnkid:q}),C=rs(M,{lnkid:q,backgrounds:C}));var L="";if(!i||isArray(i)&&!i.length){var A=[];for(var y in e)if(e.hasOwnProperty(y)){var S="answers".length+1;if("answers["===y.substr(0,S)){var x=intval(y.slice(S,-1));A.push([x,e[y]])}}A.length?(i=[],A.sort((e,_)=>e[0]<0&&_[0]<0?e[0]<_[0]:e[0]>=0&&_[0]>=0?e[0]>_[0]:_[0]<0).forEach(e=>{i.push([e[0]<0?e[0]:0,e[1]])})):i=[[0,""],[0,""]]}i.forEach((e,_)=>{var t=T(e,2),o=t[0],a=t[1];L+=rs(f,{attrs:(o?` id="create_poll_ans${o}"`:"")+(a?` value="${clean(Object(n.unclean)(a))}"`:""),lnkid:q})}),E.pollPreview=J.appendChild(ce("div",{className:"medadd_c medadd_poll",innerHTML:rs(P,{lnkid:q,question:t?clean(Object(n.unclean)(t)):"",classuntil:c?" on":"",settings:rs(D,{lnkid:q,classanon:a?" on":"",classmulty:p?" on":"",classdisableunvote:O?" on":""}),backgrounds:C,answers:L,classonmain:r?" on":"",classclosed:l?" on":""})})),i.length==g&&hide("create_poll_add"+q);var N="create_poll_untildate"+q,F=new Datepicker(N,{time:"create_poll_untiltime"+q,width:157,noPast:!0,activePeriod:2592e6,minStep:1,date:c||Math.round(((new Date).getTime()+864e5)/1e3),onUpdate:()=>{var e=new Date,_=new Date(1e3*positive(val(N)));_.getTime()>=e.getTime()+2592e6&&(F.timePicker.hourDD.val(e.getHours()),_.getMinutes()>e.getMinutes()&&F.timePicker.minDD.val(e.getMinutes()),F.setDate(_.getFullYear(),_.getMonth()+1,_.getDate(),!0,e.getHours(),e.getMinutes())),cur.addMedia[q].pollChanged()}});if(cur.addMedia[q].pollBackgroundsPos=0,cur.addMedia[q].pollBackgroundSelect(d?-d:intval(s)),cur.addMedia[q].pollChangeQuestion(ge("create_poll_question"+q)),w)elfocus("create_poll_question"+q),m.onChangedSize&&m.onChangedSize(),cur.addMedia[q].pollUpdateArrows();else{E.pollPreview.style.position="absolute",E.pollPreview.style.visibility="hidden";var H=E.pollPreview.offsetHeight;E.pollPreview.style.height=0,E.pollPreview.style.position="",E.pollPreview.style.visibility="",animate(E.pollPreview,{height:H},m.mail?0:200,()=>{E.pollPreview.style.height="",elfocus("create_poll_question"+q),m.onChangedSize&&m.onChangedSize(),cur.addMedia[q].pollUpdateArrows()})}var $=ge("create_poll_backgrounds_wrap"+q);function V(){addEvent($,browserFeatures.wheelEvent,cur.addMedia[q].pollMouseWheel)}function z(){removeEvent($,browserFeatures.wheelEvent,cur.addMedia[q].pollMouseWheel)}addEvent($,"mouseenter",V),addEvent($,"mouseleave",z),cur.destroy.push((function(){removeEvent($,browserFeatures.wheelEvent,cur.addMedia[q].pollMouseWheel),removeEvent($,"mouseenter",V),removeEvent($,"mouseleave",z)}))})},pollMouseWheel:function(e){cancelEvent(e);var _=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;cur.addMedia[q].pollBackgroundsPaging(_,!0)},pollBackgroundsPaging:function(e,_){var t=ge("create_poll_backgrounds_wrap"+q),o=ge("create_poll_backgrounds"+q),a=t.offsetWidth,i=cur.addMedia[q].pollBackgroundsPos;isNumeric(e)?i+=e:"next"===e?i+=a:i-=a,cur.addMedia[q].pollBackgroundsPos=Math.max(0,Math.min(i,o.scrollWidth-a)),_?removeClass(o,"animated"):addClass(o,"animated"),setStyle(o,"transform","translateX("+cur.addMedia[q].pollBackgroundsPos*(vk.rtl?1:-1)+"px)"),cur.addMedia[q].pollUpdateArrows()},pollUpdateArrows:function(){var e=ge("create_poll_backgrounds_wrap"+q),_=ge("create_poll_backgrounds"+q);if(e){var t=e.offsetWidth,o=_.scrollWidth-t;toggleClass(e,"medadd_poll_backgrounds_arrow_prev_disabled",0===cur.addMedia[q].pollBackgroundsPos),toggleClass(e,"medadd_poll_backgrounds_arrow_next_disabled",cur.addMedia[q].pollBackgroundsPos===o||o<=0)}},pollUntilGet:function(){var e=isChecked("create_poll_until"+q)?positive(val("create_poll_untildate"+q)):0;return Math.min(e,(new Date).getTime()+2592e6)},pollBackgroundChange:function(e,_){var t=gpeByClass("medadd_poll_backgrounds",e),o=geByClass1("medadd_poll_background_radio",e);geByClass("medadd_poll_background_radio",t).forEach(e=>{checkbox(e,e===o)}),cur.addMedia[q].pollChanged()},pollAnswerAdd:function(){var e=ge("create_poll_answers"+q),_=geByClass("medadd_poll_answer_wrap",e).length,t=cur.addMedia[q].answersLimit;if(_<t){var o=cf(rs(cur.addMedia[q].tplAnswer,{lnkid:q}));e.appendChild(o);var a=geByClass("medadd_poll_answer",e).pop();elfocus(a)}m.onChangedSize&&m.onChangedSize(),toggle("create_poll_add"+q,_<t-1)},pollAnswerRemove:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),m.onChangedSize&&m.onChangedSize(),cur.addMedia[q].pollChanged(),show("create_poll_add"+q)},pollKeydown:function(e,_){if((_=_||window.event)&&(10==_.keyCode||_.keyCode==KEY.ENTER||_.keyCode==KEY.TAB)){var t=hasClass(e,"medadd_poll_question"),o=_.shiftKey;if(t&&o)return;var a=t?domFC(domNS(domNS(e))):(o?domPS:domNS)(domPN(e));return a?elfocus(geByTag1("input",a)):o?elfocus(geByClass1("medadd_poll_question",domPN(domPN(domPN(e))))):this.pollAnswerAdd(),cancelEvent(_)}},pollKeyup:function(e,_){(!(_=_||window.event)||10!=_.keyCode&&_.keyCode!=KEY.ENTER&&_.keyCode!=KEY.TAB)&&(cur.addMedia[q].pollChangedTimeout&&clearTimeout(cur.addMedia[q].pollChangedTimeout),cur.addMedia[q].pollChangedTimeout=setTimeout(()=>cur.addMedia[q].pollChanged(),100))},pollBackgroundGetHtml:function(e){var _="",t=T(e||[0],1)[0];if(t<0){var o=T(e,5),a=o[1],i=o[2],r=o[3],l=o[4];_=`\n          <div class="medadd_poll_background" onclick="cur.addMedia[${q}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview">\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n              <div class="medadd_poll_background_photo" style="background: rgb(${i}, ${r}, ${l});">\n                <div class="medadd_poll_background_photo_holder">\n                  <div class="medadd_poll_background_photo_gradient" style="background: linear-gradient(0, rgba(${i}, ${r}, ${l}, 1) 0, rgba(${i}, ${r}, ${l}, 0) 50%)"></div>\n                  <img src="${a}" class="medadd_poll_background_photo_img"/>\n                </div>\n              </div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}" data-photo-r="${i}" data-photo-g="${r}" data-photo-b="${l}" data-photo-url="${a}"></div>\n          </div>\n        `}else{var s="",n="";if(t){var d=T(e,2)[1];if("gradient"===d){var c=T(e,4),p=c[2],u=c[3],b=[];u.forEach(e=>{var _=T(e,2),t=_[0],o=_[1];b.push(`#${o} ${Math.round(100*t)}%`)}),s=`background: linear-gradient(${p-90}deg, ${b.join(",")});"`}else if("tile"===d){var h=T(e,5),m=h[2],v=h[3];s=`background: url(${h[4]}) top center;background-size: ${m}px ${v}px;"`}}else n=" medadd_poll_background_default";_=`\n          <div class="medadd_poll_background${n}" onclick="cur.addMedia[${q}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview"${s?` style="${s}"`:""}>\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}"></div>\n          </div>\n        `}return _},pollBackgroundAdd:function(e){var _=ge("create_poll_backgrounds"+q),t=geByClass1("medadd_poll_background_uploader",_),o=cf(cur.addMedia[q].pollBackgroundGetHtml(e));o=domFC(o),_.insertBefore(o,t)},pollBackgroundSelect:function(e){var _=ge("create_poll_backgrounds"+q);if(_){var t=domQuery1(`.radiobtn[data-id="${e}"]`,_)||domQuery1('.radiobtn[data-id="0"]',_);if(t){var o=domPN(t);cur.addMedia[q].pollBackgroundsPos=(o.offsetLeft-_.offsetWidth/2+o.offsetWidth/2)*(vk.rtl?-1:1),cur.addMedia[q].pollBackgroundsPaging(0,!0),cur.addMedia[q].pollBackgroundChange(o)}}},pollBackgroundGet:function(){var e=domQuery1(`#create_poll_backgrounds${q} .radiobtn.on`);return intval(domData(e,"id"))},pollBackgroundUploaded:function(e,_,t){var o=-intval(e);cur.addMedia[q].pollBackgroundAdd([o,clean(_),intval(t.r),intval(t.g),intval(t.b)]),cur.addMedia[q].pollBackgroundSelect(o)},pollBackgroundUpload:function(){var e=cur.addMedia[q].pollInputData;showBox("al_page.php",{act:"owner_photo_box",oid:e&&e.poll_owner_id||(m.mail?cur.gid?-cur.gid:vk.id:cur.oid||vk.id),lnk_id:q,is_voting:1},{stat:["owner_photo.css",jsc("web/owner_photo.js")]})},pollChanged:function(){m.onMediaChange&&m.onMediaChange()},pollBackgroundsGet:function(){var e=cur.addMedia[q].pollInputData,_=[];e&&e.poll_backgrounds&&e.poll_backgrounds.forEach(e=>{T(e,1)[0]>0&&_.push(e)});var t=ge("create_poll_backgrounds"+q);return geByClass("radiobtn",t).forEach((function(e){var t=intval(domData(e,"id"));t&&t<0&&_.push([t,domData(e,"photo-url"),intval(domData(e,"photo-r")),intval(domData(e,"photo-g")),intval(domData(e,"photo-b"))])})),_},pollData:function(e,_){var t=cur.addMedia[q],a={};if(t&&ge("create_poll_question"+q)){for(var i=ge("create_poll_answers"+q),r=!1,l=0,s=domFC(i);s;s=domNS(s)){var n=trim(val(domFC(s)));if(n){var d=-intval((domFC(s).id.match(/^create_poll_ans(\d+)$/)||[0,-l++])[1]);a[`answers[${d}]`]=n,r=!0}}if(!r)return domFC(i)||t.pollAnswerAdd(),!0!==e&&Object(o.notaBene)(domFC(domFC(i))),!1;var c=trim(val("create_poll_question"+q));if(!c)return!0!==e&&Object(o.notaBene)("create_poll_question"+q),!1;a.question=c,a[U]=t.pollUntilGet();var p=t.pollBackgroundGet();if(p<0?(a[R]=-p,a[W]=0):p>=0&&(a[R]=0,a[W]=p),a[I]=isChecked("create_poll_anonymous"+q)?1:0,a[B]=isChecked("create_poll_onmain"+q)?1:0,a[j]=isChecked("create_poll_closed"+q)?1:0,a[k]=isChecked("create_poll_multy"+q)?1:0,a[K]=isChecked("create_poll_disable_unvote"+q)?1:0,t.pollInputData&&_){a.poll_backgrounds=t.pollBackgroundsGet();var u=["poll_is_board","poll_is_edit","poll_id","poll_answers_limit"];m.mail&&u.push("lang"),u.forEach(e=>{t.pollInputData[e]&&(a[e]=t.pollInputData[e])}),m.mail&&(a.poll_is_edited=0,a["answers[0]"]||a.question!=t.pollInputData.question?a.poll_is_edited=1:[I,B,j,k,U,R,W,K].forEach(e=>{intval(a[e])!==intval(t.pollInputData[e])&&(a.poll_is_edited=1)}),a.poll_is_edited||t.pollInputData.answers.forEach(e=>{var _=T(e,2),t=_[0],o=_[1];void 0!==a[`answers[${-t}]`]&&a[`answers[${-t}]`]==o||(a.poll_is_edited=1)}))}}else t&&ge("poll_dummy"+q)&&t.pollInputData&&t.pollInputData.poll_id&&(a.poll_id=t.pollInputData.poll_id);return a},pollChangeQuestion:function(e){var _=cur.addMedia[q].pollInputData,t=_.poll_question_length-e.value.length,o=geByClass1("medadd_poll_question_warning");o.innerHTML=t<=20?langNumeric(t,_.lang.question_length):""},markAsAdsInit(){var e=this.markAsAdsGetCheckboxEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].markAsAdsChanged();`)},markAsAdsGetCheckboxEl:()=>!!v&&v.querySelector(".Post__markAsAdsButton"),markAsAdsData(e){var _=!!e&&{},t=this.markAsAds||isChecked(this.markAsAdsGetCheckboxEl());return!t&&this.chosenMedias&&(t=this.chosenMedias.some(e=>{if(isArray(e)&&"mark_as_ads"===T(e,1)[0])return!0})),(t||e)&&(_={mark_as_ads:t?1:0}),_},markAsAdsChanged(){var e=this.markAsAdsGetCheckboxEl();if(e&&!hasClass(e,"disabled")){checkbox(e),Wall&&Wall.togglePostMarkAsAds(e,e.dataset.muteId);var _=this.markAsAdsData(!0).mark_as_ads;E.copyrightToggle&&E.copyrightToggle(!_),E.donutUpdateVisibility(),m.onMediaChange&&m.onMediaChange()}},copyrightInit(){var e=this.copyrightGetBtnEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].copyrightShowBox();`),this.markAsAdsData(!0).mark_as_ads&&this.copyrightToggle(!1)},copyrightToggle(e){var _=document.querySelector("#post_copyright_btn"+this.lnkId);toggle(_,e);var t=this.copyrightGetBtnEl();t&&(e?(this.copyrightData(!0).copyright?(val(t,getLang("wall_post_copyright_edit_button")),t.classList.add("Post__copyrightButton--added")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added")),t.classList.remove("Post__copyrightButton--disabled")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added"),t.classList.add("Post__copyrightButton--disabled")))},copyrightGetBtnEl:()=>!!v&&v.querySelector(".Post__copyrightButton"),copyrightCreate(e){if(this.copyrightInputData=e,g&&e&&e.copyright){var _="post_copyright_btn"+this.lnkId,t=document.querySelector("#"+_);if(!t){var o=getLang("wall_post_copyright_source_text");t=cf(`<div class="post_action_btn on" id="${_}" onclick="cur.addMedia[${this.lnkId}].copyrightShowBox();">\n              <div class="post_action_btn_layout">\n                <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(o)}">${o}</span>\n              </div>\n             </div>`),g.appendChild(t)}}this.copyrightChanged()},copyrightRemove(){var e=document.querySelector("#post_copyright_btn"+this.lnkId);e&&e.parentNode.removeChild(e),this.copyrightInputData&&(this.copyrightInputData.copyright=""),this.copyrightChanged()},copyrightUnchoose(){this.chosenMedias&&this.chosenMedias.forEach((e,_)=>{isArray(e)&&"copyright"===e[0]&&this.unchooseMedia(_)}),this.multi||this.copyrightRemove()},copyrightBoxAccept(e){var _=e.btns.ok[0],t=document.querySelector(".PostCopyrightBox__input"),a=document.querySelector(".PostCopyrightBox__error");if(hide(a),!Object(o.isButtonLocked)(_)){var i=val(t);if(!i)return Object(o.notaBene)(t);ajax.post("al_wall.php",{act:"copyright_check_link",link:i},{onDone:()=>{this.copyrightInputData||(this.copyrightInputData={}),this.copyrightInputData.copyright=i,this.chooseMedia("copyright","",this.copyrightInputData),e.hide()},onFail:e=>(val(a,e),show(a),!0),showProgress:()=>Object(o.lockButton)(_),hideProgress:()=>Object(o.unlockButton)(_)})}},copyrightBoxDecline(e,_){_&&this.copyrightUnchoose(),e.hide()},copyrightShowBox(){showBox("al_wall.php",{act:"copyright_box"},{cache:!0,onDone:e=>{cur.postCopyrightFeatureTT&&cur.postCopyrightFeatureTT.hide();var _=this.copyrightData(!0);e.removeButtons(),_.copyright?(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text_edit")}),e.setButtons(getLang("wall_post_copyright_edit_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText(`<a onclick="cur.addMedia[${this.lnkId}].copyrightBoxDecline(curBox(), true);">${getLang("global_delete")}</a>`)):(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text")}),e.setButtons(getLang("wall_post_copyright_add_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText("")),e.show();var t=document.querySelector(".PostCopyrightBox__input");val(t,_.copyright?Object(n.unclean)(_.copyright):""),addEvent(t,"keypress",_=>Object(s.onEnter)(()=>{this.copyrightBoxAccept(e)},_)),t.focus()}})},copyrightChanged(){var e=this.markAsAdsData(!0).mark_as_ads;this.copyrightToggle(!e),m.onMediaChange&&m.onMediaChange()},copyrightData(e){var _=!!e&&{};return(this.copyrightInputData&&this.copyrightInputData.copyright||e)&&(_={copyright:this.copyrightInputData&&this.copyrightInputData.copyright||""}),_},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,_,t){if(!(cur.noCheckMessageURLs||E.chosenMedia||E.urlAttachmentLoading&&E.urlAttachmentLoading[0]>vkNow()-1e4||E.attachCount()>=N)){if(cur.checkMessageHandler&&Object(h.isFunction)(cur.checkMessageHandler)&&cur.checkMessageHandler(e),cur.reply_to&&cur.reply_to[0]){var o=Wall.getReplyName(cur.reply_to[0]);if(o=o&&isArray(o)&&o[1]?o[1]:""){var a=extractUrls(o,_);for(var i in a)if(a.hasOwnProperty(i)){var r=a[i].url;r.match(/^https?:\/\//)||(r="http://"+r),inArray(r,E.urlsCancelled)||E.urlsCancelled.push(r)}}}var l=extractUrls(e,_).map((function(e){var _=e.url,t=e.query,o=e.domain,a=_,i={};_.match(/^https?:\/\//)||(_="http://"+_);var r=inArray(_,E.urlsCancelled)||inArray(a,E.urlsCancelled),l=!0,s=!1;r||o.match(/(^|\.|\/\/)(vkontakte\.ru|vk\.com)/i)&&(l=!!t.match(/(#photo|^\/(photo|video|album|page|audio|doc|mask|poll|podcast)|z=(album|photo|video|audio_playlist|podcast)|w=(page|product|poll))(-?\d+_)?\d+|app\d+(?:_-\d+)?|\.(jpg|png|gif)$|artist\/([^\/]+).*$|market-?\d+\?section=album_\d+|^\/stickers\/.+$|\?w\=story(\d+)_(\d+)$|stor(y|ies)(\d+)_(\d+)$|^(\/dev)?\/(blog|press)\/.+$|^\/jobs\?w=job\d+$|^\/landings\/.+$|^\/messenger$|^\/fellowship$|^\/talents$|^\/bestgames2016$|^\/play_safe_at_home$|^\/services$|^\/vk_apps_contest$|^\/home(\/.+)?$|^\/miniapps_2019$|^\/data_protection(\?section=(rules|requests|principles))?$|^\/safety(\?section=(social|parents|youth|tips|health))?$|^\/ads(\/([a-zA-Z0-9\_]+))?$|^http:\/\/instagram\.com\/p\/.+/),t.match(S)&&(l=!0),t.match(/narrative(-?\d+_\d+)/)&&(l=!0),t.match(/^(\/@[._a-zA-Z0-9-]+)([\?|\&]rev=[_a-z0-9]+|[\?|\&]anchor=[-a-zа-я0-9]+)*$/)&&(delete(i=nav.fromStr(_))[0],l=!0),!l&&t.match(/music\/album\/(-?\d+_\d+)(_[a-z0-9]+)?/)&&(l=!0,s=!1),!l&&t.match(/[a-zA-Z0-9_\.-]{2,32}/)&&(l=!0,s=!0));return e.url=_,e.canceled=r,e.valid=l,e.initialUrl=a,e.params=i,e.needsCheckDomain=s,e})).filter((function(e){return!e.canceled&&e.valid})).sort((function(e,_){return e.needsCheckDomain-_.needsCheckDomain}));if(l.length){var s=l[0];s.needsCheckDomain?E.checkURLDomain(s.query,s.initialUrl,t):E.checkURL(s.initialUrl,t,s.params)}}},checkURLDomain:function(e,_,t){cur.checkURLDomainTO&&clearTimeout(cur.checkURLDomainTO),cur.checkURLDomainTO=setTimeout(function(e,_,t){cur.checkURLDomainRequest=ajax.post("share.php",{act:"id_by_link",url:e,to_mail:m.mail},{onDone:function(e,o){(e||o)&&E.checkURL(_,t)},onFail:function(){return!0}})}.pbind(e,_,t),100)},clearCheckURL:function(){clearTimeout(cur.checkURLTO),re(E.urlAttachmentLoading[2]),F?toggle(te,te.childNodes>0):toggleClass(_,"med_no_attach",!_.childNodes),E.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})},onCheckURLDone:function(e,_,t){var o="";_=_||{},E.urlAttachmentLoading&&(o=E.urlAttachmentLoading[1],E.clearCheckURL()),e?E.chooseMedia(t[0],t[1],extend({},t[2],_),o,!0):((m.onCheckURLDone||function(){})(e,t),(_.onError||function(){})(t))},cancelCheckUrl:function(){re(E.checkURLForm)},_getShareTimeHash:function(){var e=cur.share_timehash||((cur.options||{}).share||{}).timehash||"",_=Math.floor(Date.now()/1e3),t=-1;return e&&(t=parseInt(e.split("_",1)[0])+36e3),t-_<60?Object(l.post)("share.php?act=renew_url_attachment_hash",{act:"renew_url_attachment_hash",hash:e}).then((function(e){var _=e[0];return cur.share_timehash=_,_})):Promise.resolve(e)},checkURL:function(e,_){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e?this._getShareTimeHash().then((function(a){E.urlsCancelled.push(e),E.urlAttachmentLoading=[vkNow(),e],re(E.checkURLForm),E.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+q+'"></iframe>'}),utilsNode.appendChild(E.checkURLForm);var i=E.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+q}));each(extend({hash:a,allowed_share_buttons:((cur.options||{}).share||{}).allowed_buttons||"",index:q,url:e,to_mail:m.mail?1:"",from:cur.module},t),(function(e,_){i.appendChild(ce("input",{type:"hidden",name:e,value:_}))})),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=E.onCheckURLDone.pbind(!0,o),window.onUploadFail=E.onCheckURLDone.pbind(!1,o),_&&(cur.checkURLTO=setTimeout((function(){E.urlAttachmentLoading.length>0&&E.clearCheckURL()}),_)),i.submit()})):(o.onError||function(){})()},addPreview:function(e,_){var t=_?" medadd_c_link_hidden":"";return E.sharePreview=Q.appendChild(ce("div",{className:"medadd_c medadd_c_link"+t,innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="medadd_c_linkprg">'+getProgressHtml("","medadd_c_linkprg_inner")+"</div>":"")+"</div>"}))},shareImgUrl:function(e){var _=E.shareData;if(isArray(_.preview_images)&&_.preview_images[e])return _.preview_images[e];if(_.images_proxy&&_.images_proxy[e])return _.images_proxy_url+_.images_proxy[e];if(_.images){var t=_.images[e];return isArray(t)&&(t=t[0]?t[0]:""),t}return""},initSnippetVideoFunctions:function(){cur.selectSnippetVideo=function(){var e={to_id:m.toId||cur.postTo,act:"a_choose_video_box",snippet_video:1};showBox("al_video.php",e,{cache:1,dark:1})},cur.chooseSnippetVideo=function(e,_){var t=E.shareData,o=e.split("_");t.video_owner_id=o[0],t.video_id=o[1],t.video_full_id=e,t.video=_;for(var a=!1,i=0,r=Object.keys(_.editable.sizes);i<r.length;i++){var l=r[i];(a&&_.editable.sizes[l][1]>_.editable.sizes[a][1]||!a)&&(a=l)}if(a){var s=_.editable.sizes[a];t.images[t.images.length-1]=[s[0],o[0],o[1],"video",_.editable.duration],cur.shareShowNext(0,1)}E.showVideoSnippetPreview()}},showPreview:function(e){var t,o,a=E.shareData,i=E.sharePreview||E.addPreview(),r=domFC(i);a.is_product?addClass(r,"medadd_c_link_product"):removeClass(r,"medadd_c_link_product"),toggleClass(r,"medadd_c_link_special",!!a.prometheus),"comment"!==m.from||a.is_vk_mini_app||(a.images=[]),!a.prometheus&&a.images&&(t=a.images[cur.shareShowImg],o=!(!E.bigLink&&!a.big_link||a.force_small_link));var l=!(!cur.options.share||!cur.options.share.allow_snippet_video),s=a.video&&l,d="",c={};if(a.failed)d=getLang("page_not_loaded");else if(a.prometheus)d="im"===cur.module?'<a target="_blank" href="'+a.url+'">'+a.title+"</a>":getTemplate("prometheus_snippet",{author_img:a.prometheus_author_image_url}),e=!0;else if(a.template){var p=a.template;p&&(d=getTemplate(p,a))}else{var u="",b=clean(E.shareImgUrl(cur.shareShowImg));if(l&&E.initSnippetVideoFunctions(),!b&&a.is_vk_mini_app&&a.images&&a.images[cur.shareShowImg]&&(b=a.images[cur.shareShowImg]),a.images&&a.images[cur.shareShowImg]&&b){var h=a.images[cur.shareShowImg];if(a.images.length>0){var v=!(!cur.options.share||!cur.options.share.allow_custom_photo),g=v&&!(cur.options.share&&cur.options.share.require_image),w="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",O="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_video")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",P="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_remove_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",D=isArray(h)&&1==h.length,f=D&&!l,M=D&&l,C=a.media&&"_"!=a.media&&v?'<div class="medadd_c_linkimg_controls">  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_l">'+(a.images.length>1?'    <div class="medadd_c_linkimg_controls_btn_arrows_group">      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_left" onclick="cur.shareShowNext(true);"></div>      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_right" onclick="cur.shareShowNext();"></div>    </div>':"")+'    <div class="medadd_c_linkimg_controls_btn '+(a.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload" '+w+" onclick=\"Page.ownerPhoto('"+a.media+"');\"></div>"+(l?'<div class="medadd_c_linkimg_controls_btn '+(a.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload_video" '+O+' onclick="cur.selectSnippetVideo();"></div>':"")+"  </div>"+(g?'  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_r">    <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_remove" '+P+' onclick="window.tooltips && window.tooltips.hide(this); cur.removeLinkImage(this)"></div>  </div>':"")+"</div>":"",T=(t?"":"display: none")+";background-image:url("+b+")";a.image_ratio>0&&(T+=";height: 0px; padding-top: "+100*a.image_ratio+"%;min-height: 0px;");var L="video"===h[3];u='<div class="medadd_c_linkimg_container '+(Q&&Q.offsetWidth>550?"medadd_c_linkimg_container_wide":"")+'" style="'+T+'">'+u+(L?'<div class="medadd_c_linkimg_container_video_overlay"></div>':"")+(L?'<div class="video_thumb_label"><span class="video_thumb_label_item"></span><span class="video_thumb_label_item">'+h[4]+"</span></div>":"")+(f?'<div class="medadd_c_linkimg_button"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+a.media+"');\">"+getLang("global_link_choose_own_photo")+"</button></div>":"")+(M?'<div class="medadd_c_linkimg_button"><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+a.media+"');\">"+getLang("global_link_choose_own_photo")+'</button></div><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark medadd_c_linkimg_video_button" onclick="cur.selectSnippetVideo();">'+getLang("global_link_choose_own_video")+"</button></div></div>":"")+C+'<div id="medadd_c_linkimg_loader" class="medadd_c_linkimg_loader">'+getProgressHtml("","inv medadd_c_linkimg_loader_inner")+"</div></div>"}}var A="";a.microdata&&a.microdata_preview_html&&(A=a.microdata_preview_html),c={title:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_title")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_title},description:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_desc")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_desc},url:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_url")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_url}};var y=a.shareButtons,I=y&&y.length&&y[0],B=a.button_text||I&&I[1],j=a.button_text_lang||I&&I[2],W=a.button_action||I&&I[0];if(y&&y.length&&j===B)for(var R=0;R<y.length;++R)if(y[R][0]===W&&y[R][2]===B){B=y[R][1];break}var U=!1;y&&y.length&&(U=y.length>1||j===B||I[0]!==W||I[1]!==B);var k=!!y&&y.length,K=cur.options.share&&cur.options.share.allow_remove_button&&!s;d=u+'<div class="medadd_c_linkwrap '+(u?"":"no_photo")+'"><div class="medadd_c_linkwrap_block">'+(a.title||c.title.editable?'<div class="medadd_c_linkhead '+(c.title.editable?"medadd_inline_editable":"")+'">'+(c.title.editable?'<div class="medadd_inline_editable_icon"></div>':"")+'<span class="medadd_inline_edit_target" data-max-length="'+(cur.options.share&&cur.options.share.max_title_len?cur.options.share.max_title_len:0)+'" data-field="title">'+(clean(a.title).replace(/\n/g,"<br>")||c.title.placeholder)+"</span></div>":"")+(A?'<div class="medadd_c_linkmicrodata">'+A+"</div>":"")+(a.domain||c.url.editable?`<div class="page_media_link_url medadd_c_linkaddr ${c.url.editable?"medadd_inline_editable":""}">${c.url.editable?'<div class="medadd_inline_editable_icon"></div>':""}<span class="medadd_inline_edit_target" data-max-length="2000" data-field="url" data-display-field="domain">${a.domain||"Url..."}</div>`:"")+"</div>"+(j&&k?'<div class="medadd_c_linkwrap_block medadd_c_linkwrap_block_button">'+(K?'<div class="hide_icon medadd_c_linkbtn_remove" onclick="cur.shareRemoveButton();" onmouseover="showTooltip(this, {text: \''+getLang("global_share_button_remove_tooltip")+"', black: 1, shift: [15, 10, 0]})\"></div>":"")+'<div class="wall_postlink_preview_btn medadd_c_linkbtn"><a onclick="cur.toggleShareButton(this);return false;" onmouseout="Page.actionsDropdownHide(domNS(this), 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" class="flat_button"><span onmouseover="Page.actionsDropdownUnhide()" class="'+(U?"page_actions_dd_label":"")+' wall_postlink_preview_btn_label" data-field="button_text">'+j+"</span></a></div></div>":"")+'</div><div class="clear_fix"></div>'}if(o?addClass(r,"medadd_c_linkimg_big"):removeClass(r,"medadd_c_linkimg_big"),e)cur.preventShareAnim&&(cur.preventShareAnim.stop(),clearInterval(cur.animateUpdateInterval),m.onChangedSize&&m.onChangedSize()),val(r,d),r.style.height="auto",shortCurrency();else{show(Q);var S=_.appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon '+(o?"medadd_c_linkimg_big":"")+'">'+d+"</div>"},{position:"absolute",width:getSize(i)[0]-10,visibility:"hidden"})),x=getSize(S)[1];re(S),setStyle(r,{height:"0"}),setStyle(i,{overflow:"hidden"}),val(r,d),shortCurrency(),cur.animateUpdateInterval=setInterval((function(){m.onChangedSize&&m.onChangedSize()}),100),cur.preventShareAnim=animate(r,{height:x},200,(function(){setStyle(r,{height:"auto",display:""}),setStyle(i,{overflow:""}),clearInterval(cur.animateUpdateInterval),m.onChangedSize&&m.onChangedSize()})),re(geByClass1("medadd_c_linkprg",Q))}function N(e){var _=new RegExp(/^([\w-]*:\/\/)|(tel:).*$/),t=new RegExp(/^(?:tel:)?(\+7|8)(\d{3})(\d{3})(\d{2})(\d{2})$/),o=new RegExp(/^(([a-zа-я0-9]|[a-zа-я0-9][a-zа-я0-9\-]*[a-zа-я0-9])\.)*([a-zа-я0-9]|[a-zа-я0-9][a-zа-я0-9\-]*[a-zа-я0-9])$/i),a=new RegExp(/^([\w-]*:\/\/)?([a-zа-я0-9\-]+(?:[\-\.]{1}[a-zа-я0-9\-]+)*\.[a-zа-я0-9\-]{2,22})(:[0-9]{1,5})?([\/\?\#].*)?$/i);if(!e||e.inlineEdit)return!1;var i=getSize(e),r=gpeByClass("medadd_inline_editable",e);e.inlineEdit=!0,addClass(r,"medadd_inline_editing"),removeClass(r,"medadd_inline_invalid");var l=ce("textarea",{className:"medadd_inline_edit"},{width:i[0],height:i[1]}),s=parseInt(e.getAttribute("data-max-length"));s&&l.setAttribute("maxlength",s);var d=e.getAttribute("data-field"),p=e.getAttribute("data-display-field");val(l,Object(n.unclean)(E.shareData[d])),val(e,""),e.appendChild(l);var u=ce("span",{className:"medadd_inline_edit_target"},{opacity:0,zIndex:-1,width:i[0],height:"auto",wordWrap:"break-all",position:"absolute"});r.appendChild(u);var b=i[1];if(elfocus(l),"url"===d){var h=E.shareData[d];t.test(h)&&val(l,Object(n.unclean)(h.replace("tel:",""))),l.onkeydown=function(e){32!==e.which&&32!==e.keyCode||e.preventDefault(),13!==e.which&&13!==e.keyCode||(e.preventDefault(),l.blur())},l.oninput=function(){var e=this;cur.editingPostUrlCleanTimeout&&clearTimeout(cur.editingPostUrlCleanTimeout),cur.editingPostUrlCleanTimeout=setTimeout((function(){e.value=e.value.replace(/[\n ]/g,"")}))}}l.onblur=function(){if(l.oninput=null,removeClass(r,"medadd_inline_editing"),re(u),clearTimeout(cur.editingPostUrlCleanTimeout),E.shareData[d]=val(l),"url"===d&&E.shareData[d])try{var i=E.shareData[d];if(t.test(i.replace(/[\h\s(\)-]/g,"")))i=i.replace(/[\h\s\(\)-]/g,""),E.shareData.domain=i.replace(t,"+7 ($2) $3-$4-$5"),E.shareData[d]=i.replace(t,"tel:+7$2$3$4$5");else{_.test(i)||(i="https://"+i);var s=new URL(i);if(!s.host||!o.test(s.host)||!a.test(i))throw new Error("Invalid url");if(t.test(Object(n.unclean)(E.shareData.domain).replace(/[\h\s\(\)-]/g,""))||o.test(E.shareData.domain)||E.shareData.domain===getLang("global_link_invalid_url")||E.shareData.domain===getLang("global_link_edit_url")){var b=i.match(a);E.shareData[d]=i.replace(a,"$1"+b[2].toLowerCase()+"$3$4"),E.shareData.domain=b[2].toLowerCase()}}}catch(e){addClass(r,"medadd_inline_invalid"),E.shareData.domain=getLang("global_link_invalid_url")}var h;"url"!==d||E.shareData[d]||(E.shareData.domain=getLang("global_link_edit_url")),h=p&&E.shareData[p]?E.shareData[p]:val(l),val(e,clean(h).replace(/\n/g,"<br>")||c[d].placeholder),e.inlineEdit=!1};var m=function(){var e=clean(val(l)+" M").replace(/\n/g,"<br>");val(u,e);var _=getSize(u);b!=_[1]&&(b=_[1],animate(l,{height:_[1]},200))};addEvent(l,"click keyup change",m),setTimeout(m,0)}if(c.title&&c.title.editable){var F=geByClass1("medadd_c_linkhead",r),H=geByClass1("medadd_inline_edit_target",F);F&&H&&(F.onclick=N.bind(this,H))}if(c.description&&c.description.editable){var $=geByClass1("medadd_inline_edit_target",geByClass1("medadd_c_linkdsc",r));$&&($.onclick=N.bind(this,$))}if(c.url&&c.url.editable){var V=geByClass1("medadd_c_linkaddr",r),z=geByClass1("medadd_inline_edit_target",V);V&&z&&(V.onclick=N.bind(this,z)),m.linkTooltip&&!cur.linkTooltip&&V&&(cur.linkTooltip=new ElementTooltip(m.linkTooltip.el(V),m.linkTooltip.opts),m.linkTooltip.timeout?setTimeout(()=>cur.linkTooltip.show(),m.linkTooltip.timeout):cur.linkTooltip.show())}if(k&&(E.shareData.button_text=B,E.shareData.button_text_lang=j,E.shareData.button_action=W,U)){var q=domPN(geByClass1("wall_postlink_preview_btn_label",r)),G=[],Y=0,X=0,J=[];for(var R in y)if(y.hasOwnProperty(R)){var Z=y[R];Z[0]==W&&Z[1]==B&&(Y=X),G.push([X++,Z[1]]),J.push('<a class="page_actions_item" tabindex="0" role="link" onclick="cur.updateShareButton(this);Page.actionsDropdownHide(domPN(domPN(this)), 1, cur.setActiveShareButton.pbind(false));return false;" data-button-text="'+Z[1]+'" data-button-text-lang="'+Z[2]+'" data-button-action="'+Z[0]+'">'+Z[2]+"</a>")}q.setAttribute("data-items",JSON.stringify(G)),q.setAttribute("data-value",Y);var ee=['<div class="page_actions_wrap medadd_c_linkbtn_actions_wrap unshown" onmouseout="Page.actionsDropdownHide(this, 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" onmouseup="setTimeout(function() { Page.actionsDropdownUnhide(); }, 5)">','<div class="page_actions_inner">',J.join(""),"</div>","</div>"].join("");domPN(q).appendChild(se(ee)),ls.get("share_button_text_tooltip_shown")||cur.buttonTextTooltip||setTimeout((function(){cur.closeButtonTextTooltip=function(){cur.buttonTextTooltip.hide(),ls.set("share_button_text_tooltip_shown",1)};var e=geByClass1("wall_postlink_preview_btn_label",r),_=domCA(e,".box_layout");cur.buttonTextTooltip=new ElementTooltip(e,{autoShow:!1,appendTo:_||geByTag1("body"),content:'<div class="feature_intro_tt_hide" onclick="cur.closeButtonTextTooltip();"></div>'+getLang("global_share_button_text_tooltip"),forceSide:"left",cls:"feature_intro_tt",offset:[-10,0,0],onHide:function(){cur.buttonTextTooltip.destroy()}}),cur.buttonTextTooltip.show(),addEvent(e,"mouseover",(function(){cur.buttonTextTooltip&&cur.buttonTextTooltip.hide()}))}),1e3)}},showVideoSnippetPreview:function(){if(!(!cur.options.share||!cur.options.share.allow_snippet_video)){var e=E.shareData,_=e.video,t=e.video_owner_id,o=e.video_id;_&&isObject(_)&&t&&o&&_.editable&&(E.initSnippetButtonFunctions(),E.showPreview())}},initSnippetButtonFunctions:function(){cur.shareRemoveButton=function(){var _=E.sharePreview;window.tooltips&&tooltips.destroyAll(_),re(geByClass1("medadd_c_linkwrap_block_button",_)),E.shareData.button_text="",E.shareData.button_text_lang="",E.shareData.button_action="",show(domByClass(e,"media_selector"))},cur.updateShareButton=function(e){var _=e.getAttribute("data-button-text"),t=e.getAttribute("data-button-text-lang"),o=e.getAttribute("data-button-action");E.shareData.button_text=_,E.shareData.button_text_lang=t,E.shareData.button_action=o;var a=E.sharePreview;return val(geByClass1("page_actions_header_inner",a),t),val(geByClass1("wall_postlink_preview_btn_label",a),t),!1},cur.setActiveShareButton=function(e){var _=E.sharePreview;(e?addClass:removeClass)(domPN(geByClass1("wall_postlink_preview_btn_label",_)),"active")},cur.toggleShareButton=function(e){hasClass(e,"active")?(Page.actionsDropdownHide(domNS(e),1),cur.setActiveShareButton(!1)):(Page.actionsDropdown(domNS(e)),cur.setActiveShareButton(!0))}},showExternalPreview:function(){var e=E.shareData;e.images||(e.images=[]);var _,t=[],o=[],a={};each(e.images,(function(_,i){a[i]||(a[i]=!0,t.push(i),e.images_proxy&&o.push(e.images_proxy[_]))})),e.uniqueImagesCount=t.length,e.images=t,e.images_proxy=o;var i=!(!cur.options.share||!cur.options.share.allow_snippet_video);if(_=Q&&Q.offsetWidth>550?isRetina()?"/images/post_snippet_image_placeholder_w_2x.png":"/images/post_snippet_image_placeholder_w.png":i?isRetina()?"/images/post_snippet_image_video_placeholder_2x.png":"/images/post_snippet_image_video_placeholder.png":isRetina()?"/images/post_snippet_image_placeholder_2x.png":"/images/post_snippet_image_placeholder.png",e.placeholder_inserted||(e.images.push([(cur.options.share||{}).allow_custom_photo?_:""]),e.placeholder_inserted=!0),!e.images||!e.images.length)return cur.shareShowImg=0,void E.showPreview();cur.shareShowImg=0,cur.shareShowImg--,E.addPreview(!0,!!e.map_data),e.imagesStyles={};var r=!1;cur.shareSetOwnPhoto=function(_){curBox()&&curBox().hide(),E.bigLink=!0,e.images[e.images.length-1]=[_.photo_url,_.user_id,_.photo_id],cur.shareShowNext(0,1)},cur.shareClearOwnPhoto=function(){e.images[e.images.length-1]=[],cur.shareShowNext(0,0,1)},cur.removeLinkImage=function(e){var _=gpeByClass("medadd_c_linkcon",e);addClass(_,"no_photo"),removeClass(_,"medadd_c_linkimg_big"),re(gpeByClass("medadd_c_linkimg_container",e)),setStyle(_,"height",""),E.shareData.noPhoto=!0},E.initSnippetButtonFunctions(),cur.shareShowNext=function(t,o,a){var i=vkImage();cur.prevShareShowDir=t,a||(o?cur.shareShowImg=e.images.length-1:t?cur.shareShowImg-=1:cur.shareShowImg+=1);var l=isArray(e.images[e.images.length-1])&&!!e.images[e.images.length-1][0];if(!l&&cur.shareShowImg>e.images.length-2)cur.shareShowImg=0;else if(cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(!l&&cur.shareShowImg<0)cur.shareShowImg=e.images.length-2;else if(cur.shareShowImg<0)cur.shareShowImg=e.images.length-1;else if(0==cur.shareShowImg)for(var s=1;s<e.images.length-1;s++){vkImage().src=E.shareImgUrl(s)}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return E.showPreview(r),void(r=!0);var n=E.shareImgUrl(cur.shareShowImg);n&&(i.src=n),e.video=0,isArray(e.images[cur.shareShowImg])&&e.images[cur.shareShowImg][1]&&e.images[cur.shareShowImg][2]?"video"===e.images[cur.shareShowImg][3]?(e.video=1,e.video_owner_id=e.images[cur.shareShowImg][1],e.video_id=e.images[cur.shareShowImg][2]):(e.user_id=e.images[cur.shareShowImg][1],e.photo_id=e.images[cur.shareShowImg][2],e.share_own_image=!0):(e.user_id=void 0,e.photo_id=void 0,e.share_own_image=!1);var d=null;n&&(cur.imgLoadTimeout=d=setTimeout((function(){!0!==cur.shareImgInterval&&(isArray(e.images[cur.shareShowImg])||(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),cur.shareShowNext()))}),5e3));var c=setTimeout((function(){show("medadd_c_linkimg_loader"),c=null,m.onChangedSize&&m.onChangedSize()}),100);cur.showLoaderTimeout=c;var p=function(){if(i.width||i.height||!n){var t=i.width,o=i.height,a="",l="";if(d&&(clearTimeout(d),d=null),c&&(clearTimeout(c),c=null),hide("medadd_c_linkimg_loader"),clearInterval(cur.shareImgInterval),!isArray(e.images[cur.shareShowImg])&&(t<150||o<67)){if(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext.pbind(0,0,1),0)}else{var s=t>=532&&o>=235,p=(s||!!e.big_link)&&!e.force_small_link;if(cur.options.share&&cur.options.share.force_big_link&&!s){e.images.splice(cur.shareShowImg,1),e.images_proxy.splice(cur.shareShowImg,1);var u=(cur.options.share||{}).allow_custom_photo||(cur.options.share||{}).require_image;return 0==e.images.length&&u&&e.images.push([u?_:""]),cur.prevShareShowDir||cur.shareShowImg--,void cur.shareShowNext(cur.prevShareShowDir)}E.bigLink=p,p?a="width: 100%;":(t>150&&(o=150*o/t,t=150),a="width: "+t+"px; height: "+o+"px;")}e.images.length>1&&(l=""),e.imagesStyles[cur.shareShowImg]='style="'+a+'"'+l,E.showPreview(r),r=!0,m.onAddMediaChange&&m.onAddMediaChange("share",e.media,e)}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(p,300),cur.shareImgInterval2=setTimeout(p,0)},cur.shareShowNext()},uploadShare:function(e){var _=E.shareData,t=E.sharePreview,o=t.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+q+'"></iframe>'})),a=o.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+q})),i=_.images[cur.shareShowImg];each({act:"a_photo",url:_.url,index:q,image:i,extra:_.extra||0,hash:vk.ip_h},(function(e,_){a.appendChild(ce("input",{type:"hidden",name:e,value:_}))})),window.onUploadDone=function(_,a){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(o),E.shareData=extend(E.shareData,{user_id:a.user_id,photo_id:a.photo_id,photo_url:i}),setTimeout(e,0)},window.onUploadFail=function(_,a){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(o),E.shareData.share_upload_failed=1,setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),a.submit()},setupPostpone:function(e,t,o){var a;a=F||_e?_e:domPN(geByClass1("page_preview_postpone_wrap",_));var i=cur.editingPost&&"wpe_media_preview"==domPN(a).id,r=i||!F?"":"1px",l=!1,s=`<div class="clear_fix">\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_date${q}" value="${e.date||""}" /></div>\n        <div class="fl_l datepicker_item medadd_c_timerat">${e.lang.profile_wall_postpone_at}</div>\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_time${q}"/></div></div>`,n=void 0!==e.friends_only||e.donut_is_available;cur.editingPost&&n?(s+='<div class="medadd_c_timersett">',E.visibilityAddSelect(e),l=!0):cur.editingPost&&t&&(s+=t,l=!0),V||(E.postponePreview=a.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(l?" medadd_c_nofixed":"")+(V?" timer_in_tt":""),innerHTML:s}))),V&&(E.postponeSubmitWrapper=se(`<div><input type="hidden" id="postpone_date${q}" value="${e.date||""}"><input type="hidden" id="postpone_time${q}"></div>`),a.appendChild(E.postponeSubmitWrapper)),V||(E.postponePreview.style.height=r);var d="datepicker-inline-container_"+q,c=`<button class='flat_button reset_time_btn secondary' onclick='cur.addMedia[${q}].onResetPostponeBtnClick()'>${getLang("wall_post_timer_reset")}</button>`,p=`<td class="cal_clear" id="${d}" colspan="7">${c}</td>`;stManager.add(["ui_controls.css","ui_controls.js","datepicker.css",window.jsc("web/datepicker.js")],(function(){E.postponeDatepicker=new Datepicker("postpone_date"+q,{time:"postpone_time"+q,width:155,noPast:!0,minStep:1,sideTop:cur.oid<0,sideTopOffset:10,inlineTime:V,inlineTimeContainerId:d,inlineTimeContainerIdx:q,addRows:V?"<tr>"+p+"</tr>":null,addRowsM:V?'<tr><td class="cal_clear" colspan="7"></td></tr>':null,onUpdate:function(e,_){var t=[...arguments];m.onMediaChange&&m.onMediaChange.apply(m,t),E.postponeDate=val("postpone_date"+E.lnkId),V&&E.updatePostponeBtnText()},hideAnotherMonth:!1}),i||!F||V||animate(E.postponePreview,{height:33},200,(function(){E.postponePreview.style.height=""})),E.menu.postponeBtn&&E.updatePostponeBtnText(),Object(h.isFunction)(o)&&o()}))},getPostponeDateString:function(e){if(val("postpone_date"+E.lnkId)||e){e=(e=e||+val("postpone_date"+E.lnkId))+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var _=getLang("datepicker_dateFormat");"dateFormat"===_&&(_="{day} {month} {year}");var t=new Date(1e3*e),o=t.getDate(),a=t.getMonth()+1,i=t.getFullYear();return _.replace("{day}",o).replace("{month}",winToUtf(getLang("Month"+a+"_of"))).replace("{year}",i)+` ${getLang("profile_wall_postpone_at")} `+`${t.getHours()}:${("0"+t.getMinutes()).slice(-2)}`}},onResetPostponeBtnClick(){cur["postPostponeTT"+E.lnkId].hide(),null!=E.postponeInd&&setTimeout(()=>{E.unchooseMedia(E.postponeInd)},ElementTooltip.FADE_SPEED),cancelEvent(event)},resetPostpone:function(e){if(e){e=e+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var _=new Date(1e3*e);if(_){var t=_.getDate(),o=_.getMonth()+1,a=_.getFullYear(),i=_.getHours(),r=_.getMinutes();E.postponeDatepicker.timePicker.hourDD.val(i),E.postponeDatepicker.timePicker.minDD.val(r),E.postponeDatepicker.setDate(a,o,t,null,i,r)}}},updatePostponeBtnText:function(e,_){if(V){var t=geByClass1("post_action_btn_text",E.menu.postponeBtn),o="";if(e)o=getLang("wall_publication_now");else{var a=E.getPostponeDateString(_);if(!a)return;o=a}t.innerHTML=o,t.setAttribute("aria-label",replaceEntities(o))}},createPrettyCards:function(e){cur.lang=extend(cur.lang||{},e.lang||{});var _=se(e.editor.container_html);Q.appendChild(_),E.prettyCardGallery=new PrettyCardGallery(_,e.editor,e.pretty_cards)},visibilityAddSelect:function(e){var _,t=!1;e.donut_only?(t=!0,_="name_donut_only"):e.friends_only?(t=!0,_="name_friends_only"):_="name_no_friends_only";var o=se(getTemplate("visibility_access",{link_id:q}));toggleClass(o,"on",t);var a=geByClass1(_,o),i=geByClass1("post_action_btn_text",o),r=val(a);if(val(i,r),attr(i,"aria-label",r),o){var l=geByClass1("post_action_btn",g);l?g.insertBefore(o,l):g.appendChild(o),Wall.createPostTooltip("post_visibility_btn",q),E.donutUpdateVisibility()}var s=+domData(a,"value");radiobtn(a,s,"post_settings_btnpost_visibility_btn"+q);var n=ge("post_donut_duration_btn"+q);n&&toggleClass(n,"visible",e.donut_only)},onPostVisibilityAccessChange(e){((e,_)=>{_!==u.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT&&D(e);var t=Object(b.ge)("post_donut_duration_btn"+e.lnkId);if(t){var a=_===u.VISIBILITY_ACCESS_OPTIONS.ONLY_DONUT,i=e.markAsAdsGetCheckboxEl();Object(b.toggleClass)(t,"visible",a),i&&Object(o.disable)(i,a)}})(E,e)},donutUpdateVisibility(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;!function(e,_){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;M(Object(w.isDonutPostSettingVisible)(t,_),e,_)}(g,E,e)},destroy:function(){(X||{}).sorter&&X.sorter.destroy();for(var t=0;t<z.handlersToClean.length;t++)z.handlersToClean[t]();(Y||{}).qsorter&&Y.qsorter.destroy(),removeClass(_,"media_preview_has_medias"),_&&(_.innerHTML=""),show(e)},qsorterOpts:function(){return{xsize:Math.floor(Y.offsetWidth/135),width:135,height:102,onReorder:m.onAddMediaChange,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),Y.qsorter&&(Y.qsorter.destroy(),window.qsorter.init(Y,E.qsorterOpts()))}}).copyrightInit(),E.markAsAdsInit(),E.menu.onAddMediaInit({actionsEl:g,addMedia:E,onMediaChange:m.onMediaChange}),cur.addMedia||(cur.addMedia={}),cur.addMedia[q]=E,m.onAddMediaChange&&(E.onChange=m.onAddMediaChange),E}}},yTQ2:function(e,_,t){"use strict";t.r(_);t("pIFo"),t("HEwt"),t("rGqo"),t("rE2o"),t("ioFf"),t("OG14"),t("a1Th"),t("Btvt");var o=t("Nk8j");function a(e,_){return function(e){if(Array.isArray(e))return e}(e)||function(e,_){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],o=!0,a=!1,i=void 0;try{for(var r,l=e[Symbol.iterator]();!(o=(r=l.next()).done)&&(t.push(r.value),!_||t.length!==_);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw i}}return t}(e,_)||function(e,_){if(!e)return;if("string"==typeof e)return i(e,_);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return i(e,_)}(e,_)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,_){(null==_||_>e.length)&&(_=e.length);for(var t=0,o=new Array(_);t<_;t++)o[t]=e[t];return o}var r="friends_dropdown__list_item",l="friends_dropdown__list_item system_message";var s=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=extend({onUserSelected:()=>!1,onEscapePress:()=>!1,onKeyUp:()=>!1},e),cur.pvServerFriendsIndex&&cur.pvServerFriendsIds||(cur.pvServerFriendsIndex=new vkIndexer([],e=>{var _=a(e,2);_[0];return _[1]}),cur.pvServerFriendsIds=[]),this.topUsers=new vkIndexer([],e=>{var _=a(e,2);_[0];return _[1]}),this.isInited=!1,this.lastSeachTerm="",this.hoverItem=null,this.keyboardNavigation=!1,this.freeTerm=null,this._handleInputKeyEvent=this._handleInputKeyEvent.bind(this),this._handleMouseMoveOnce=this._handleMouseMoveOnce.bind(this)}init(){this.isInited&&this.friendsdListNode||(Object(o.getIndexedFriends)()||this.fetchFriendsList(),this.isInited=!0,this._initElement(),this._initScroll());return this.friendsdListNode}update(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._resetScroll(),this.setTopUsers(e),this._hideDropdown()}setTopUsers(e){this.topUsers.list.forEach(e=>{this.topUsers.remove(e)}),e.forEach(e=>{this.topUsers.add(e)}),this.topUsers.list=e}_hideDropdown(){removeClass(this.friendsdListNode,"show-dropdown")}_getItemHtml(e,_,t,o){return`<div class="${r}" data-id="${e}" data-name="${_}">\n      <img src="${o}" alt="${_}" class="friends_dropdown__list_image">\n      <div class="friends_dropdown__list_info">\n        <div class="friends_dropdown__list_name">${_} ${e===vk.id.toString()?`(${getLang("photos_tags_user_you")})`:""}</div>\n        <div class="friends_dropdown__list_label">${t}</div>\n      </div>\n    </div>`}_initElement(){this.friendsdListNode=ce("div",{className:"friends_dropdown__list"}),this.listInput=ce("input",{className:"friends_dropdown__list_input",placeholder:""+replaceEntities(getLang("photos_tags_dropdown_placeholder"))}),this.listDropdown=ce("div",{className:"friends_dropdown__list_dropdown"}),this.listContent=ce("div",{className:"friends_dropdown__list_content"}),this.listDropdown.appendChild(this.listContent),this.friendsdListNode.appendChild(this.listInput),this.friendsdListNode.appendChild(this.listDropdown),this._setListHTML(`<div class="${l}">${getLang("box_loading")}</div>`),addEvent(this.friendsdListNode,"click",cancelEvent),addEvent(this.listDropdown,"click",e=>{this._handleItemSelected(e.target)}),addEvent(this.listDropdown,"mouseover",e=>{if(!this.keyboardNavigation){var _=hasClass(e.target,r)?e.target:gpeByClass(r,e.target);this._setHoverItem(_)}}),addEvent(this.listInput,"keyup keydown keypress",this._handleInputKeyEvent),addEvent(this.listInput,"click",()=>{this.show()})}_handleItemSelected(e){var _=hasClass(e,r)?e:gpeByClass(r,e),t=domData(_,"name"),o=domData(_,"id");o&&this.options.onUserSelected(o,t),hasClass(e,"add_term_tag")&&this.freeTerm&&this.options.onUserSelected(0,this.freeTerm)}_getItemEleById(e){return window.domQuery1(`[data-id="${e}"]`,this.listDropdown)}_setListHTML(e){(this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent).innerHTML=e}_setHoverItem(e){var _=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=domData(e,"id");if(t&&t!==this.hoverItem){if(this.hoverItem){var o=this._getItemEleById(this.hoverItem);removeClass(o,"hover")}this.hoverItem=t,addClass(e,"hover"),_&&this.scroll&&this.scroll&&this.scroll.scrollIntoView(e)}}show(e){hasClass(this.friendsdListNode,"show-dropdown")||(this._renderFriendsList(this.lastSeachTerm,e),addClass(this.friendsdListNode,"show-dropdown"),this._resetScroll(),this.scroll&&this.scroll.update())}_renderFriendsList(e){var _=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e=trim(e),Object(o.getIndexedFriends)()){var t=this._doSearch(e);this._renderFriendsDropdown(e,t,_)}else this._setListHTML(`<div class="${l}">${getLang("box_loading")}</div>`);clearTimeout(this.requestTimeout),e.length>0&&e!==this.lastSeachTerm&&(this.requestTimeout=setTimeout(()=>{this.fetchFriendsWithQuery(e)},300))}_initScroll(){browser.safari||stManager.add(["ui_common.css","ui_common.js"],()=>{this.scroll=new window.uiScroll(this.listContent,{global:!0})})}_handleInputKeyEvent(e){if("keyup"===e.type){switch(e.keyCode){case KEY.ENTER:this._handleEnter();break;case KEY.ESC:return this.options.onEscapePress(),void this._hideDropdown();default:var _=e&&e.target.value;_!==this.lastSeachTerm&&(this._renderFriendsList(_),this.lastSeachTerm=_,this.hoverItem=null)}this.options.onKeyUp(),this.show()}else switch(e.keyCode){case KEY.UP:case KEY.DOWN:this._handleArrows(e.keyCode===KEY.DOWN)}}_handleArrows(){var e,_,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.keyboardNavigation||(this.keyboardNavigation=!0,addEvent(this.listDropdown,"mousemove",this._handleMouseMoveOnce)),this.hoverItem)e=this._getItemEleById(this.hoverItem),_=t?domNS(e):domPS(e);else{var o=this.listContent.__uiScroll__?this.listContent.__uiScroll__.content:this.listContent;_=domFC(o)}_&&this._setHoverItem(_,!0)}_handleMouseMoveOnce(){this.keyboardNavigation=!1,removeEvent(this.listDropdown,"mousemove",this._handleMouseMoveOnce)}_handleEnter(){if(this.hoverItem){var e=this._getItemEleById(this.hoverItem);this._handleItemSelected(e)}}_doSearch(){var e,_,t,i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",l=Object(o.getPhotoData)("tagged"),s=Object(o.getIndexedFriends)();r.length>0?(_=this.topUsers.search(r),t=s.search(r),i=cur.pvServerFriendsIndex.search(r)):(_=this.topUsers.list,t=s.list,i=cur.pvServerFriendsIndex.list),e=_.concat(t,i);var n=[];return(e=e.filter(e=>{var _=a(e,1)[0],t=n.indexOf(_)<0&&(!l||!l[_]);return n.push(_),t})).length>20&&(e=e.slice(0,20)),e}_renderFriendsDropdown(e,_){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="";if(_.forEach(e=>{var _=a(e,4),t=_[0],i=_[1],r=_[2],l=_[3],s="id"+t;o+=this._getItemHtml(t,i,r,l,s)}),!o&&t){this.freeTerm=e,e=clean(e);var i=getLang("photos_tags_not_found_tag_text").replace("{tagName}",`<span class="add_term_tag">${e}</span>`);o=`<div class="${l}">${i}</div>`,this._setListHTML(o)}else o&&(this._setListHTML(o),this.freeTerm=null,this._resetScroll());this.hoverItem=null}focus(){this.listInput.focus()}reset(){this.listInput.value="",this.lastSeachTerm="",this.hoverItem=null,this._resetScroll()}_resetScroll(){this.scroll?this.scroll.scrollTop():this.listContent.scrollTop=0}fetchFriendsList(){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags"},{onDone:e=>{Object(o.setIndexedFriends)(e,()=>{this._renderFriendsList(this.lastSeachTerm)})}})}fetchFriendsWithQuery(e){ajax.post("hints.php",{act:"a_json_friends",from:"photo_tags",str:e,photo:Object(o.getPhotoData)("id")},{onDone:_=>{this._handleFetchFriends(e,_)}})}_handleFetchFriends(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(this.lastSeachTerm===e){var t,i=0,r=Object(o.getPhotoData)("tagged");(t=r?_.filter(e=>{var _=a(e,1)[0];return!r[_]}):_).forEach(e=>{var _=e[0];cur.pvServerFriendsIds.indexOf(_)<0&&(cur.pvServerFriendsIds.push(_),cur.pvServerFriendsIndex.add(e),i++)}),(i>0||0===t.length)&&this._renderFriendsList(e,!0)}}};_.default=class{constructor(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.options=extend({closeOnClick:!0,resetDropdownOnShow:!0,onUserSelected:()=>!1,onMouseLeave:()=>!1,onEscapePressed:()=>!1,onDeleteClicked:()=>!1,onSuggestionDeclined:()=>!1},_),this.container=e,this.friendsDropdown=new s({onUserSelected:this._handleUserSelected.bind(this),onEscapePress:this._handleEscapePress.bind(this),onKeyUp:this._handleStartInteraction.bind(this)}),this.friendsDropdownNode=this.friendsDropdown.init(),this._handleConfirmedTooltipClick=this._handleConfirmedTooltipClick.bind(this),this._handleDocumentClick=this._handleDocumentClick.bind(this),this.renderTooltip()}renderTooltip(){this.tooltipNode=ce("div",{className:"photo_tooltip"},{display:"none"});var e=ce("div",{className:"photo_tooltip__content"});this.sugggestionNode=ce("div"),this.nameNode=ce("div",{className:"photo_tooltip__name"},{display:"none"}),this.listNode=ce("div",{className:"photo_tooltip__suggestion"}),this.listNode.appendChild(this.friendsDropdownNode),addEvent(this.nameNode,"click",this._handleConfirmedTooltipClick),e.appendChild(this.nameNode),e.appendChild(this.sugggestionNode),e.appendChild(this.listNode),this.tooltipNode.appendChild(e),this.container.appendChild(this.tooltipNode),addEvent(this.tooltipNode,"mouseenter",()=>{this.isActive=!0}),addEvent(this.sugggestionNode,"click",e=>{switch(cancelEvent(e),window.domData(e.target,"button")){case"yes":this.options.onUserSelected(this.suggestedUserId,this.suggestedUserName,!0);break;case"no":this.options.onSuggestionDeclined(),hide(this.sugggestionNode),this.showFriendsList(),this.userHref=null,this.showAndFocusFriendsList()}}),addEvent(this.tooltipNode,"mouseleave",()=>{this.interaction||(this.isActive=!1,this.options.onMouseLeave())}),this.options.closeOnClick&&addEvent(document,"click",this._handleDocumentClick)}_handleDocumentClick(e){this.options.onMouseLeave(),this.interaction=!1,this.isActive=!1,this.hide()}_handleUserSelected(e,_){this.isActive=!1,this.options.onUserSelected(e,_)}_handleEscapePress(){this.isActive=!1,this.interaction=!1,this.friendsDropdown.reset(),this.options.onEscapePressed()}_handleStartInteraction(){this.interaction=!0}_handleConfirmedTooltipClick(e){cancelEvent(e),"button"===e.target.tagName.toLowerCase()?this.options.onDeleteClicked():this.userHref&&this._go(this.userHref,e)}updatePosition(e){var _=e.top,t=e.right,o=e.bottom,a=e.left,i=t-a,r=getSize(this.tooltipNode),l=r[0]?r[0]:280,s="bottom",n=a+Math.floor(i/2)-l/2,d=o;if((n<10||this.hasDropdown&&o>window.clientHeight()-300)&&(s="right_top"),"right_top"===s){n=t,d=_;var c=window.clientHeight()-_;c<300&&(d=_-300+c)}domData(this.tooltipNode,"dir",s),setStyle(this.tooltipNode,{top:d,left:n})}updateSuggestionQuestion(e,_){this.sugggestionNode.innerHTML=this._getSuggestionHTML(e,_),this.suggestedUserName=_,this.suggestedUserId=e}_getSuggestionHTML(e,_){var t=e===vk.id?getLang("photos_tags_user_you"):_;return`<div class="suggested_tag_user">\n      ${getLang("photos_tags_suggestion_question").replace("{userName}",`<div class="suggested_tag_user__name">&nbsp;${t}</div>`)}\n      <div class="suggested_tag_user__actions">\n        <button data-button="yes" class="yes">${getLang("box_yes")}</button>\n        <span>&middot;</span>\n        <button data-button="no">${getLang("box_no")}</button>\n      </div>\n    </div>`}updateState(e){var _=e.suggestedUserName,t=e.suggestedUserId,o=e.usersList,a=e.userName,i=e.userHref,r=e.canDeleteTag;this.suggestedUserName=!1,this.suggestedUserId=!1,this.userHref=i,this.hasDropdown=!1,removeClass(this.tooltipNode,"tagged"),a?(this.nameNode.innerHTML=`${a} ${r?"<button>Delete</button>":""}`,toggleClass(this.nameNode,"show_delete",r),show(this.nameNode),hide(this.listNode),hide(this.sugggestionNode),addClass(this.tooltipNode,"tagged")):t?(this.updateSuggestionQuestion(t,_),hide(this.nameNode),hide(this.listNode),show(this.sugggestionNode)):(this.friendsDropdown.update(o),hide(this.nameNode),hide(this.sugggestionNode),this.showFriendsList(),this.hasDropdown=!0)}showFriendsList(){show(this.listNode),this.options.resetDropdownOnShow&&this.resetFriendsDropdown()}resetFriendsDropdown(){this.friendsDropdown.reset()}show(e){var _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isActive=!1,this.interaction=!1,this.updateState(_),this.updatePosition(e),show(this.tooltipNode),t&&this.friendsDropdown.show(!0),this.friendsDropdown.focus()}hide(){hide(this.tooltipNode)}showAndFocusFriendsList(e){this.userHref?this._go(this.userHref,e):(this.friendsDropdown.focus(),this.friendsDropdown.show())}unMount(){removeEvent(document,"click",this._handleDocumentClick),re(this.tooltipNode)}_go(e,_){_&&_.ctrlKey?window.open(e):nav.go(e,_)}}},zmTt:function(e,_,t){"use strict";t.r(_);t("a1Th"),t("Btvt");var o=t("zxIV"),a=t("Egk5"),i=t("lXE5"),r={init:function(e,_){cur.lSTL&&Object(o.re)(cur.lSTL);var t=(_=_||{}).parent=_.parent||boxLayerWrap;extend(cur,{lSTLWrap:t,lSTL:t.appendChild(ce("div",{id:"layer_stl",innerHTML:`<div id="layer_stl_bg" class="fixed"></div><div id="layer_stl_cl"></div><nobr id="layer_stl_text" class="fixed">${getLang("global_to_top")}</nobr>`,el:e.bodyNode,onclick:a.cancelEvent,onmousedown:r.lSTLDown,sc:r.onScroll})),lSTLText:ge("layer_stl_text",t),lSTLShown:0,lSTLWas:0,lSTLWasSet:0,lSTLOpts:_}),e&&e.setOptions({onShow:r.show,onHide:r.hide}),e&&e.scrollInited||(addEvent(t,"scroll",r.onScroll),e&&(e.scrollInited=!0)),onBodyResize(),r.onScroll()},hide:function(e){function _(){return e.apply(this,arguments)}return _.toString=function(){return e.toString()},_}((function(){var e=cur.lSTLOpts;e&&e.parent&&(removeEvent(e.parent,"scroll",r.onScroll),hide(cur.lSTL),cur.lSTLShown=0,e.onHide&&e.onHide())})),show:function(){var e=cur.lSTLOpts;e&&e.parent&&(addEvent(e.parent,"scroll",r.onScroll),setTimeout(r.onScroll,0),e.onShow&&e.onShow())},lSTLDown:function(e){if(e=e||window.event,!Object(a.checkEvent)(e)){var _=cur.lSTLWrap;if(!__afterFocus){var t=0,o=_.scrollTop;cur.lSTLWasSet&&cur.lSTLWas?(t=cur.lSTLWas,cur.lSTLWas=0):cur.lSTLWas=o,_.scrollTop=t}return Object(a.cancelEvent)(e)}},onScroll:function(){if(cur.lSTL){var e=cur.lSTLWrap.scrollTop,_=cur.lSTLWas||e>200,t=0;if(cur.lSTL.style.marginTop=Math.min(e,boxLayer.scrollHeight-cur.lSTL.scrollHeight-1)+"px",vk.staticheader){var a=Object(o.getSize)("page_header_wrap")[1];cur.lSTLText.style.marginTop=Math.max(-Math.min(Object(i.scrollGetY)(),bodyNode.clientHeight-(window.lastWindowHeight||0)),-a)+"px"}_?(1!==cur.lSTLShown&&(Object(o.show)(cur.lSTL),cur.lSTLShown=1),cur.lSTLWas&&e>500&&(cur.lSTLWas=0),e>200?(t=(e-200)/200,cur.lSTLWasSet&&(cur.lSTLWasSet=0,val(Object(o.domLC)(cur.lSTL),getLang("global_to_top")),removeClass(Object(o.domLC)(cur.lSTL),"down"))):(t=(200-e)/200,cur.lSTLWas&&(cur.lSTLWasSet||(cur.lSTLWasSet=1,val(Object(o.domLC)(cur.lSTL),""),addClass(Object(o.domLC)(cur.lSTL),"down"))))):0!==cur.lSTLShown&&(hide(cur.lSTL),cur.lSTLShown=0),setStyle(cur.lSTL,{opacity:Math.min(Math.max(t,0),1)})}}};_.default=r}});