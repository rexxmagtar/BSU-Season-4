!function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],u=0,g=[];u<o.length;u++)s=o[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&g.push(r[s][0]),r[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(d&&d(t);g.length;)g.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,o=1;o<n.length;o++){var l=n[o];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={"web/imn":0},i=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/js/cmodules/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=l;i.push([172,"bundles/common","bundles/vendors","bundles/1c6a9b415901224f27daf60c6bc90be0"]),n()}({"+/AQ":function(e,t,n){"use strict";n.r(t),n.d(t,"getNativeOption",(function(){return r})),n.d(t,"setNativeOption",(function(){return i})),n.d(t,"createScroll",(function(){return c}));var a=n("ofcU");function r(e,t){return bodyNode[e]||document.documentElement[e]}function i(e,t,n){"scrollTop"===e&&window.scrollTo(0,t)}class s{constructor(e,t){this.el=e,this.opts=t,this.module=Object(a.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);i("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-n<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},n=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),n=t-this.prevScroll,a=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-n,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&a-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(a.destroyModule)(this.module)}}class o{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var n=this.scrollTop(),a=this.prevTop-n;this.prevTop=n,t.scrollChange&&t.scrollChange(n),t.onScroll&&t.onScroll(a,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class l{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function c(e,t){return t.noScroll?new l(e):t.nativeScroll?new s(e,t):new o(e,t)}},"+tmx":function(e,t,n){"use strict";n.r(t),n.d(t,"MILLISECOND",(function(){return a})),n.d(t,"SECOND",(function(){return r})),n.d(t,"MINUTE",(function(){return i})),n.d(t,"HOUR",(function(){return s})),n.d(t,"DAY",(function(){return o})),n.d(t,"WEEK",(function(){return l})),n.d(t,"MONTH",(function(){return c})),n.d(t,"ruLocale",(function(){return d})),n.d(t,"EVENTS",(function(){return u}));var a=1,r=1e3*a,i=60*r,s=60*i,o=24*s,l=7*o,c=30*o,d="ru-RU",u={MOUSE_DOWN:"mousedown",KEY_DOWN:"keydown",SCROLL:"scroll",CLICK:"click"}},"/eGY":function(e,t,n){"use strict";n.r(t),n.d(t,"VKPAY_APP_ID",(function(){return d})),n.d(t,"BUTTON_TYPE_TEXT",(function(){return u})),n.d(t,"BUTTON_TYPE_VKPAY",(function(){return g})),n.d(t,"BUTTON_TYPE_LOCATION",(function(){return m})),n.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return p})),n.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return _})),n.d(t,"BUTTON_COLOR_DEFAULT",(function(){return h})),n.d(t,"BUTTON_COLOR_SECONDARY",(function(){return f})),n.d(t,"BUTTON_COLOR_PRIMARY",(function(){return b})),n.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return v})),n.d(t,"BUTTON_COLOR_POSITIVE",(function(){return y})),n.d(t,"handleButtonClick",(function(){return C})),n.d(t,"getButtonAppearance",(function(){return j})),n.d(t,"getButtonLabel",(function(){return E})),n.d(t,"getActionObjectFromElement",(function(){return S})),n.d(t,"getAttributesFromActionObject",(function(){return w}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("/8Fb"),n("pIFo");var a=n("t7n3"),r=n("nAFc"),i=n("/PiP"),s=n("EasH"),o=n("N4ZS");function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=6217559,u="text",g="vkpay",m="location",p="open_app",_="open_link",h="default",f="secondary",b="primary",v="negative",y="positive",O=["app-id","owner-id","type","payload","hash","label"];function C(e,t,n,a){var r=e.app_id,o=e.owner_id,l=e.type,c=e.payload,h=e.hash,f=void 0===h?"":h;switch(l){case _:break;case g:case p:var b="app"+(l===g?d:r)+(o?"_"+o:"");Object(i.showWiki)({w:b+encodeURIComponent("#"+f),from_keyboard:1,app_hash:n});break;case m:cur.sendLocation=function(e,n){n(),t({keyboardAuthorId:a,action:{label:"",attaches:[e],payload:c}})},Object(s.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case u:t({action:e,appHash:n,keyboardAuthorId:a});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:l,payload:e.payload}),t({action:e,appHash:n,keyboardAuthorId:a})}}function j(e){return T(e)?b:e.color.toLowerCase().replace(h,f)}function E(e){var t=e.action,n=t.label;return t.type===m?getLang("mail_keyboard_label_location"):T(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(r.decodeHTMLEntities)(t||""),t=Object(a.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(n)}function T(e){var t=e.action,n=t.app_id,a=t.type;return a===g||a===p&&n===d}function S(e){return O.reduce((t,n)=>(t[n.replace("-","_")]=e.getAttribute("data-"+n)||void 0,t),{})}function w(e){var t=Object.entries(e).reduce((e,t)=>{var n=l(t,2),r=n[0],i=n[1];return e+` data-${r.replace("_","-")}="${Object(a.clean)(""+i)}"`},"");e.type===_&&(t+=` href="${Object(o.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"0Rlc":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,n=e.checked,o=e.disabled,l=e.indeterminate,c=e.name,d=e.id,u=s(e,["children","checked","disabled","indeterminate","name","id"]),g=Object(r.classNames)("CheckBox",u.className,{"CheckBox--disabled":o,"CheckBox--indeterminate":l});return a.createElement("label",{className:g},a.createElement("input",i({},u,{className:"CheckBox__input",id:d,type:"checkbox",checked:n,name:c,disabled:o,onChange:this.onChange})),a.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,n){"use strict";n.r(t);n("91GP");var a=n("q1tI"),r=(n("17x9"),n("r7nW")),i=n("6aSF"),s=n("pemR");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var l=e=>{var t=e.title,n=e.onClose,r=e.appearance,i=Object(s.classNames)("Modal__header","Modal__header--"+r);return a.createElement("div",{className:i},a.createElement("div",{className:"Modal__headerInner"},a.createElement("h1",{className:"Modal__headerTitle"},t),a.createElement("button",{className:"Modal__headerCross",type:"button",onClick:n},"Закрыть")))};l.defaultProps={appearance:"white"};var c=e=>a.createElement(i.default,{className:"Modal__body"},e.children);c.defaultProps={children:null};var d=e=>{var t=e.className,n=e.appearance,i=e.title,l=e.actionButtons,c=e.onClose,u=e.children,g=e.footerHint,m=Object(s.classNames)("Modal","Modal--"+n,t);return a.createElement(r.default,o({},e,{className:m}),a.createElement(d.Header,{title:i,onClose:c,appearance:n}),Boolean(u)&&a.createElement(d.Body,null,u),a.createElement(d.Footer,{actionButtons:l,hint:g}))};d.Header=l,d.Body=c,d.Footer=e=>{var t=e.actionButtons,n=e.hint;return a.createElement("div",{className:"Modal__footer"},a.createElement("div",{className:"Modal__footerInner"},n&&a.createElement("div",{className:"Modal__footerHint"},n),t))},d.defaultProps=o({},r.default.defaultProps,{appearance:"white"}),t.default=d},"1+Fu":function(e,t,n){"use strict";n.r(t),n.d(t,"createWorker",(function(){return u}));n("KKXr"),n("rGqo"),n("Btvt"),n("9AAn");var a=n("DM26"),r=new Map,i=!1;function s(e){return e.queue||e.key}function o(){r.forEach((e,t)=>{var n=e.onData,a=e.onUpdateKey,r=e.ts;(function(e){return!!window.curNotifier&&!curNotifier.addQueues[s(e)]})(t)&&Notifier.addKey(extend(t,{ts:r}),d.bind(null,n,a,t))})}function l(){i||(i=setInterval(o,3e3))}function c(e){!function(e){if(!window.curNotifier)return!1;delete curNotifier.addQueues[s(e)]}(e),r.delete(e),0===r.size&&(clearInterval(i),i=!1)}function d(e,t,n,i,s){if(s.failed)return c(n),void function(e,t,n,i){var s;switch(e){case 1:case 2:case 3:case 5:s=i(t,e);break;case 4:s=Object(a.pause)(1).then(()=>t);break;default:throw new Error("Unkonwn error from queue: "+e)}Object(a.pause)(3).then(()=>s).then(e=>{r.set(e,{onUpdateKey:i,onData:n,ts:e.ts}),o(),l()})}(s.err,n,e,t);r.set(n,{onData:e,onUpdateKey:t,ts:intval(s.ts)}),s.events.map(e=>e.split("<!>")).forEach(e)}function u(e,t,n){return Notifier.addKey(e,d.bind(null,t,n,e)),r.set(e,{onData:t,onUpdateKey:n,ts:e.ts}),l(),{stop:c.bind(null,e)}}},172:function(e,t,n){e.exports=n("M24l")},"1y80":function(e,t,n){"use strict";function a(e,t,n,a,r){return window.statlogsValueEvent(e,t,n,a,r)}function r(e){return Math.random()<e}function i(e,t,n,i,s,o){r(e)&&a(t,n,i,s,o)}n.r(t),n.d(t,"statlogsValueEvent",(function(){return a})),n.d(t,"randEnabled",(function(){return r})),n.d(t,"statlogsProbValueEvent",(function(){return i}))},"22MJ":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=n("pemR"),i=n("dLHM");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class l extends a.Component{constructor(){super(...arguments),this.getRef=e=>{this.element=e&&e.element}}render(){var e=this.props,t=e.className,n=o(e,["className"]);return a.createElement(i.default,s({},n,{className:Object(r.classNames)(t,"BlockSearchInput"),ref:this.getRef}))}}l.defaultProps=i.default.defaultProps},"4LiD":function(e,t,n){"use strict";var a=n("dyZX"),r=n("XKFU"),i=n("KroJ"),s=n("3Lyj"),o=n("Z6vF"),l=n("SlkY"),c=n("9gX7"),d=n("0/R4"),u=n("eeVq"),g=n("XMVh"),m=n("fyDq"),p=n("Xbzi");e.exports=function(e,t,n,_,h,f){var b=a[e],v=b,y=h?"set":"add",O=v&&v.prototype,C={},j=function(e){var t=O[e];i(O,e,"delete"==e||"has"==e?function(e){return!(f&&!d(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return f&&!d(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof v&&(f||O.forEach&&!u((function(){(new v).entries().next()})))){var E=new v,T=E[y](f?{}:-0,1)!=E,S=u((function(){E.has(1)})),w=g((function(e){new v(e)})),I=!f&&u((function(){for(var e=new v,t=5;t--;)e[y](t,t);return!e.has(-0)}));w||((v=t((function(t,n){c(t,v,e);var a=p(new b,t,v);return null!=n&&l(n,h,a[y],a),a}))).prototype=O,O.constructor=v),(S||I)&&(j("delete"),j("has"),h&&j("get")),(I||T)&&j(y),f&&O.clear&&delete O.clear}else v=_.getConstructor(t,e,h,y),s(v.prototype,n),o.NEED=!0;return m(v,e),C[e]=v,r(r.G+r.W+r.F*(v!=b),C),f||_.setStrong(v,e,h),v}},"4cFO":function(e,t,n){"use strict";n.r(t);n("VRzm"),n("Btvt");var a=n("BJj/"),r=n("ERyv");function i(e,t){if(!t)return ls.get(e);ls.set(e,t)}function s(e){try{var t={};return Error.captureStackTrace(t,e),t.stack}catch(e){return""}}t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(a.debounce)(i,300),o=extend({},e),l=[],c=[];return t.store&&(o=ls.get(t.key)||o),{get:()=>o,set(e){var a=Object(r.isWeirdLogging)()?s(this.set):null;return e(o).then(e=>(o=e,t.store&&n(t.key,e),this.emit(),this)).catch(e=>Object(r.imWeirdCatch)("store_set_catch",e,{stack:a}))},setState(e){return this.set(t=>(t=extend(t,e),this.emit(),Promise.resolve(t)))},stash(){l.push(o),o=extend({},e),this.emit()},reset(){o=extend({},e),this.emit()},unmount(){o={},e=!1,c=[]},pop(){l.length>0&&(o=l.pop(),this.emit())},emit(){c.length>0&&c.forEach(e=>e(this))},subscribe(e){-1===c.indexOf(e)&&c.push(e)},unsubscribe(e){c=c.filter(t=>t!==e)},mutate(e){e(o),t.store&&n(t.key,o),this.emit()}}}},"6aSF":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("+/AQ")),i=n("pemR");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class l extends a.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,n=e.isShadows,a=e.neverHide,i=e.onScroll;this.scroller||(this.scroller=Object(r.createScroll)(this.wrapper,{shadows:n,nativeScroll:t,hidden:!a,onScroll:i}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,n=(e.isNative,e.isShadows,e.neverHide,e.className),r=void 0===n?"":n,l=o(e,["children","isNative","isShadows","neverHide","className"]);return a.createElement("div",s({},l,{className:Object(i.classNames)("Scroll",r),ref:this.getWrapperRef}),t)}}l.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,n){"use strict";n.r(t),n.d(t,"getLang",(function(){return s}));var a=n("nAFc"),r=n("4+be"),i={};function s(e,t,n){void 0===t&&(t=!1);var s="number"==typeof t,o=t||s,l=e+(o?".raw":"");if(void 0===i[l]){var c=o?Object(r.getLang)(e,"raw"):Object(r.getLang)(e);"string"==typeof c?i[l]=Object(a.decodeHTMLEntities)(c):Array.isArray(c)&&(i[l]=c.map(a.decodeHTMLEntities))}if(s){var d=t;return Object(r.langNumeric)(d,i[l],n)}return i[l]||""}t.default={getLang:s}},"7hRE":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}render(){var e=this.props,t=e.photo,n=e.title,o=e.isOnline,l=e.isMobile,c=e.onlineSize,d=e.element,u=e.className,g=s(e,["photo","title","isOnline","isMobile","onlineSize","element","className"]),m=d||"div",p="Avatar--badge-"+c,_=Object(r.classNames)("Avatar",p,u,{"Avatar--online":o,"Avatar--mobile":l});return a.createElement(m,i({className:_},g),a.createElement("div",{className:"Avatar__wrapper"},a.createElement("img",{onError:this.onError,className:"Avatar__img",src:this.state.errored?"/images/camera_c.gif":t,alt:n})))}}o.defaultProps={isOnline:!1,isMobile:!1,onlineSize:"m"}},"86+7":function(e,t,n){"use strict";n.r(t),n.d(t,"oCacheExists",(function(){return r})),n.d(t,"oCacheGet",(function(){return i})),n.d(t,"oCacheAdd",(function(){return s}));n("KKXr");var a=n("aong");function r(e,t){return t in Object(a.unpackStore)(e).oCache}function i(e,t){var n=Object(a.unpackStore)(e).oCache[t];return n&&!n._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(n),n._n=1),n}function s(e,t){var n=Object(a.unpackStore)(e);n.oCache||(n.oCache={}),t.id&&(n.oCache[t.id]=t)}},"8h6g":function(e,t,n){"use strict";n.r(t),n.d(t,"VIDEO_UPLOAD_EXTS",(function(){return a})),n.d(t,"VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB",(function(){return r})),n.d(t,"VIDEO_UPLOAD_CHUNK_SIZE",(function(){return i}));n("KKXr");var a="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),r=5,i=4194304},"9AAn":function(e,t,n){"use strict";var a=n("wmvG"),r=n("s5qY");e.exports=n("4LiD")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=a.getEntry(r(this,"Map"),e);return t&&t.v},set:function(e,t){return a.def(r(this,"Map"),0===e?0:e,t)}},a,!0)},As6E:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("pemR")),s=n("clTp");class o extends a.Component{constructor(e){super(e),this.onClick=()=>{if(!this.state.dropdown||this.state.dropdown.removed){var e=this.props,t=e.text,n=e.position,a=e.align,r=e.marginTop,i=e.marginLeft,o=Object(s.default)(this.el);this.update({text:t,position:n,align:a,rect:o,marginTop:r,marginLeft:i})}else this.update()},this.onMouseEnter=e=>{this.callerHovered=!0,this.timeouts.appear=setTimeout(()=>{if(this.el&&this.callerHovered){var e=this.props,t=e.position,n=e.align,a=e.marginTop,r=e.marginLeft,i=Object(s.default)(this.el);this.update({position:t,align:n,rect:i,marginTop:a,marginLeft:r})}},80)},this.onMouseLeave=e=>{this.callerHovered=!1,this.timeouts.callerDisappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250)},this.onDropdownMouseEnter=()=>{"hover"===this.props.trigger&&(this.hovered=!0)},this.onDropdownMouseLeave=e=>{"hover"===this.props.trigger&&(this.hovered=!1,this.timeouts.disappear=setTimeout(()=>{this.callerHovered||this.hovered||this.update()},250))},this.onDocumentClick=e=>{!this.state.dropdown||this.state.dropdown.removed||this.el.contains(e.target)||this.update()},this.onResize=e=>{if(this.state.dropdown&&!this.state.dropdown.removed){var t=this.props,n=t.text,a=t.position,r=t.align,i=t.marginTop,o=t.marginLeft,l=Object(s.default)(this.el);this.update({text:n,position:a,align:r,rect:l,marginTop:i,marginLeft:o})}},this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.dropdown&&this.state.dropdown.removed&&this.setState({dropdown:void 0})},this.onItemClick=(e,t)=>{t.separator||(this.update(),t.onClick(e))},this.state={},this.timeouts={}}componentDidMount(){this.el=r.findDOMNode(this),"click"===this.props.trigger?(this.el.addEventListener("click",this.onClick),document.addEventListener("mousedown",this.onDocumentClick),window.addEventListener("resize",this.onResize)):(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("mouseleave",this.onMouseLeave))}componentWillUnmount(){Object.keys(this.timeouts).forEach(e=>{clearTimeout(this.timeouts[e])}),"click"===this.props.trigger?(this.el.removeEventListener("click",this.onClick),document.removeEventListener("mousedown",this.onDocumentClick),window.removeEventListener("resize",this.onResize)):(this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("mouseleave",this.onMouseLeave)),this.defaultNode&&(this.defaultNode.parentNode.removeChild(this.defaultNode),delete this.defaultNode)}update(e){if(!e)return this.setState({dropdown:Object.assign({},this.state.dropdown,{removed:!0})});var t=e.position,n=e.align,a=e.rect,r=e.marginTop,i=e.marginLeft,s=a.left,o=a.top;switch(t){case"t":s+=.5*a.width;break;case"r":s+=a.width,o+=.5*a.height;break;case"b":s+=.5*a.width,o+=a.height;break;case"l":o+=.5*a.height}s=Math.round(s+i),o=Math.round(o+r),this.setState({dropdown:{position:t,align:n,x:s,y:o}})}renderDropdown(){if(!this.state.dropdown)return null;var e=this.state.dropdown,t=e.x,n=e.y,r=e.position,s=e.align,o=e.removed,l=Object(i.classNames)("Dropdown","Dropdown--"+r,{"Dropdown--removed":!!o,["Dropdown--align-"+s]:"t"===r||"b"===r},this.props.className);return a.createElement("div",{className:l,style:{top:n,left:t},onTransitionEnd:e=>this.onTransitionEnd(e),onMouseEnter:this.onDropdownMouseEnter,onMouseLeave:this.onDropdownMouseLeave},a.createElement("ul",{className:"Dropdown__in"},this.props.data.map((e,t)=>a.createElement("li",{className:Object(i.classNames)("Dropdown__item",{Dropdown__item_separator:e.separator}),onClick:t=>this.onItemClick(t,e),key:void 0!==e.id?e.id:t},e.text))))}render(){var e=this.renderDropdown();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),a.createElement(a.Fragment,null,this.props.children,r.createPortal(e,this.defaultNode))):this.props.children}}o.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,trigger:"click",className:""}},"BN/X":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{render(){var e=this.props,t=e.hovered,n=e.className,o=e.children,l=s(e,["hovered","className","children"]),c=Object(r.classNames)("Link",{"Link--hovered":!!t},n);return this.props.href?a.createElement("a",i({},l,{className:c}),o):a.createElement("span",i({},l,{className:c}),o)}}o.defaultProps={href:void 0,hovered:!1}},BxOC:function(e,t,n){"use strict";n.r(t),n.d(t,"post",(function(){return r})),n.d(t,"plainget",(function(){return i})),n.d(t,"plaingetCancelable",(function(){return s}));n("VRzm"),n("Btvt");var a=n("cGUQ");function r(e,t,n){return t&&(t.im_v=3),new Promise((a,r)=>{ajax.post(e,t,{timeout:n,onDone(){a.apply(null,[[...arguments]])},onFail(){return r.apply(null,arguments),!0}})})}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s(e,t,n),r=a.request;return r}function s(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){n.abort()}n=window.XDomainRequest?new XDomainRequest:ajax._getreq();var s=new Promise((i,s)=>{var o,l=Date.now(),c=r.timeout||60,d=Object(a.toQueryString)(t);if(window.XDomainRequest)n.open("get",`${e}?${d}`),n.ontimeout=function(e){s([e,{}])},n.onerror=function(e){s([e,{}])},n.onload=function(){i([n.responseText,{}])},setTimeout((function(){n.send()}),0);else{n.onreadystatechange=function(){4==n.readyState&&(clearInterval(o),n.status>=200&&n.status<300?i([n.responseText,n]):s([n.responseText,n]))};try{n.open("GET",`${e}?${d}`,!0)}catch(e){return s([e,n])}n.send()}o=setInterval((function(){Date.now()-l>1e3*c&&(window.browser.safari&&n.abort(),s(["",{}]),clearInterval(o))}),1e3)});return{request:s,cancel:i}}},ERyv:function(e,t,n){"use strict";n.r(t),n.d(t,"isWeirdLogging",(function(){return c})),n.d(t,"imWeirdLog",(function(){return d})),n.d(t,"imWeirdCatch",(function(){return u})),n.d(t,"startLoggingAllUnhandled",(function(){return g})),n.d(t,"stopLoggingAllUnhandled",(function(){return m}));n("VRzm"),n("Btvt");var a,r=n("BxOC"),i=n("DM26"),s=1;function o(e,t,n,r,i){if("Script error."!==e){var s=i?i.stack||i.message:null;d("unhandled_error",s?{err:e,stack:s}:{err:e})}a&&a.apply(this,arguments)}function l(e){e.preventDefault()}function c(){return!!window.imwl}function d(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c()&&(n&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(i.retryFn)(r.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:s++,ua:navigator.userAgent},t))}))}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return d(e,extend({err:t&&t.message||t},n)),Promise.reject(t)}function g(){a=window.onerror,window.onerror=o,window.addEventListener("unhandledrejection",l)}function m(){window.onerror=a,a=void 0,window.removeEventListener("unhandledrejection",l)}},FABD:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return d}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR")),i=n("vRp6"),s=n("p+C8"),o=n("XpgC");function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class d extends a.PureComponent{constructor(e){super(e),this.onRemoveToken=e=>{var t=this.searchContainer.offsetHeight;this.props.onRemoveToken(e.target.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.onChange=e=>{var t=e.target.value;t!==this.value&&(this.value=t,this.props.onChange(e),this.scrollContainer.scrollTop=0)},this.onSelect=e=>{var t=this.searchContainer.offsetHeight;this.props.onSelect(e.currentTarget.getAttribute("data-id")).then(()=>{this.updateScroll(t)})},this.onKeydown=e=>{27===e.keyCode&&(this.input.value="",this.input.blur(),this.props.onChange(e),e.stopPropagation())},this.updateScroll=e=>{var t=this.searchContainer.offsetHeight;this.input.focus(),this.searchContainer.scrollTop=this.searchContainer.scrollHeight,e!==t&&(this.scrollContainer.scrollTop=this.scrollContainer.scrollTop+t-e)},this.inputRef=e=>{this.input=e},this.searchContainerRef=e=>{this.searchContainer=e},this.scrollContainerRef=e=>{var t=e;if(e&&e.container)for(t=e;t.container;)t=t.container;this.scrollContainer=t},this.value=e.value}componentDidMount(){this.input.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.className,n=e.tokens,d=(e.onSelect,e.renderToken),u=(e.onRemoveToken,e.removeTokenPlaceholder),g=e.value,m=e.placeholder,p=e.useInfiniteScroll,_=e.loadMore,h=e.hasMore,f=e.virtualized,b=e.notFoundText,v=e.children,y=e.emptyText,O=e.isSearching,C=c(e,["className","tokens","onSelect","renderToken","onRemoveToken","removeTokenPlaceholder","value","placeholder","useInfiniteScroll","loadMore","hasMore","virtualized","notFoundText","children","emptyText","isSearching"]),j=p?i.default:"div",E=p?{loadMore:_,hasMore:h,virtualized:f,useCapture:!1}:{},T=[].concat(v);return a.createElement("div",{className:Object(r.classNames)("MultiSelect",t)},a.createElement("div",{className:"MultiSelect__search",ref:this.searchContainerRef},n.map((e,t)=>a.createElement("span",{className:"MultiSelect__token",key:e.id},a.createElement("span",{className:"MultiSelect__tokenTitle"},d?d(e):e.text),u?a.createElement(o.default,{text:u},a.createElement("span",{className:"MultiSelect__tokenRemove","data-id":e.id,onClick:this.onRemoveToken})):a.createElement("span",{className:"MultiSelect__tokenRemove","data-id":e.id,onClick:this.onRemoveToken}))),a.createElement("div",{className:"MultiSelect__caret"},a.createElement("div",{className:"MultiSelect__caretIn"},a.createElement("input",l({},C,{type:"text",className:"MultiSelect__input",placeholder:0===n.length?m:"",onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,value:g,ref:this.inputRef}))))),0===T.length&&(g||y)&&!O&&a.createElement("div",{className:"MultiSelect__empty"},a.createElement("div",{className:"MultiSelect__emptyIn"},g?b:y)),a.createElement(j,l({className:"MultiSelect__scroll",ref:this.scrollContainerRef},E),T.map(e=>a.createElement(s.default,{className:"MultiSelect__suggestsItem","data-id":e.props["data-id"],onClick:this.onSelect,key:e.key},e))))}}d.defaultProps={removeTokenPlaceholder:"",placeholder:"",value:"",useInfiniteScroll:!1,notFoundText:"Not found"}},FEsp:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n.n(a),i=n("pemR"),s=function(){return(s=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};t.default=function(e){var t=e.children,n=e.className,a=o(e,["children","className"]);return r.a.createElement("div",s({},a,{className:Object(i.classNames)("Stub",n)}),t||"No results.")}},LYnS:function(e,t,n){"use strict";n.r(t);n("pIFo");var a=n("86+7"),r=n("rHUl"),i=n("6krn").default.getLang;t.default=()=>[{id:"user name",label:i("mail_community_templates_hint_name"),process:e=>Object(a.oCacheGet)(e,Object(r.getPeer)(e)).first_name},{id:"user surname",label:i("mail_community_templates_hint_last_name"),process(e){var t=Object(a.oCacheGet)(e,Object(r.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:i("mail_community_templates_hint_your_name"),process:e=>Object(a.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:i("mail_community_templates_hint_your_last_name"),process(e){var t=Object(a.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:i("mail_community_templates_hint_community"),process:e=>Object(a.oCacheGet)(e,e.get().id).name},{id:"greeting",label:i("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return i(t>=3&&t<12?"mail_greeting_good_morning":t>=12&&t<17?"mail_greeting_good_afternoon":t>=17&&t<=23?"mail_greeting_good_evening":"mail_greeting_good_night")}}]},M24l:function(e,t,n){"use strict";n.r(t);var a=n("E2g8"),r=n("jE6c"),i=(n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("91GP"),n("VRzm"),n("Vd3H"),n("pIFo"),n("OEbY"),n("SRfc"),n("rGqo"),n("Btvt"),n("OG14"),n("vT4u")),s=n("P13b"),o=n("rHUl"),l=n("MhhX"),c=n("4+be"),d=n("FWc3"),u=n("nAFc");function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function p(e,t){var n=0,a=[],r=[],i=!1;return e.forEach(e=>{e.width=e.width?e.width:function(e){return 12+9*Object(u.decodeHTMLEntities)(e.name).length}(e),e.width+(i?0:69)>=t-n?(r.push(e),i||(n+=69,i=!0)):(a.push(e),n+=e.width)}),[a,r]}function _(e,t){var n=t.peer_tags&&t.peer_tags.length?e.peer_profile_tags.filter(e=>t.peer_tags.includes(e.id)):[];return t.ad_id&&n.unshift({isAdTag:!0,width:t.has_ad_access?104:97,name:t.has_ad_access?`${Object(c.getLang)("mail_ad_tag_text_prefix")} ${t.ad_id}`:Object(c.getLang)("mail_ad_tag_no_access_text"),color:"#e5ebf1"}),n}var h=n("aong"),f=n("ofcU"),b=n("f01n");function v(e,t,n){var a=intval(domData(n,"msgid"));if(!Object(h.getSelectionText)()&&!Object(s.checkSelectClick)(t)){var r=intval(domData(n,"peer"));return e.set(i.cancelSearch.bind(null,r)),e.get().longpoll.push([Object(b.changePeer)(r,a)]),!1}}function y(e,t){return{isAll:e=>Object(i.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return Object(i.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):Object(i.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){Object(f.destroyModule)(t)}}}function O(e){return e.findIndex(e=>"number"==typeof e.peerId&&e.href)>-1}function C(e,t){var n=v.bind(null,t);return y(0,Object(f.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",n)}}))}var j=n("h++7"),E=n("4cFO"),T=n("+/AQ");function S(e,t){return Object(h.toArray)(e).find(e=>domData(e,"list-id")===t)}function w(e,t){return Object(h.toArray)(e).findIndex(e=>domData(e,"list-id")===t)}function I(e,t,n,a){if(n){k(e,t,a);var r=domData(n,"list-id"),i=r&&S(t.children,r);i&&a.forEach(e=>addClass(i,e)),e.setState({hoveredListItemId:r})}}function k(e,t,n){var a=domQuery("."+n.join("."),t);a&&Object(h.toArray)(a).forEach(e=>{n.forEach(t=>removeClass(e,t))}),e.setState({hoveredListItemId:null})}function M(e,t){var n=t&&domQuery("."+t.join("."),e)[0];return n?domData(n,"list-id"):null}function A(e,t,n){return e.map(t).reduce((e,t)=>(e[t]=!0,e),n)}function L(e,t,n){return{ids:A(n.get().elements,e,{}),scrolls:t,activated:!0}}function P(e,t,n){return n.elements=n.elements.filter(n=>t(n)!==e),delete n.ids[e],Promise.resolve(n)}function N(e,t,n){var a=[];n.elements=n.elements.map(n=>{var r=t(n),i=e.filter(e=>t(e)===r)[0];return a.push(r),i||n});var r=e.filter(e=>!inArray(t(e),a));return n.elements=n.elements.concat(r),Promise.resolve(n)}function x(e){var t={};return e.forEach(e=>{"r"===e[0]&&t["a,"+e[1]]?delete t["a,"+e[1]]:t[`${e[0]},${e[1]}`]=e}),Object.keys(t).map(e=>t[e])}function D(e,t,n,a,r,i){for(var s=0;s<a;s++)e=domNS(e);var o=se(r(t));return domData(o,"list-id",n),e?i.insertBefore(o,e):i.appendChild(o),e}function R(e,t,n,a,r){var i=a.get(),s=i.limit,o=i.offset,l=function(e,t){var n=t.get();return!n._sortedEls&&e&&t.setState({elements:n.elements.sort(e),_sortedEls:!0}),t.get().elements}(n().sortFn,a).slice(0,o+s),c=function(e,t){for(var n=[],a=Math.max(e.length,t.length),r=0;r<a;r++){var i=e[r],s=t[r];!i&&s?n.push(["a",s,r]):i&&!s?n.push(["r",i,r]):i!==s&&(n.push(["r",i,r]),n.push(["a",s,r]))}var o=x(n),l=x(n.reverse());return o.length>l.length?l:o}(Object(h.toArray)(e.children).map(e=>domData(e,"list-id")).filter(e=>!!e),l.map(e=>n().idFn(e).toString()));if(function(e,t,n,a){if(0!==t.length){var r=(t=t.sort((e,t)=>e[2]-t[2])).filter(e=>"a"===e[0]);if(t.filter(e=>"r"===e[0]).map(t=>e.children[t[2]]).forEach(e=>re(e)),0!==r.length)for(var i=r.shift(),s=i[2],o=(D(e.children[s],n[i[2]],i[1],0,a,e),0);o<r.length;o++)i=r[o],D(e.children[s],n[i[2]],i[1],i[2]-s,a,e),s=i[2]}}(e,c,l,n().renderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(a,t),r)return c.filter(e=>"a"==e[0]).map(e=>parseInt(e[1]))}function B(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=e.get(),l=t.getContainer().children,c=w(l,a||o.hoveredListItemId);c<0||(o.limit+o.offset<c?e.setState({offset:c-o.limit+1}).then(R.bind(null,t.getContainer(),t,n)):Promise.resolve()).then(()=>{var e=l[c],n=t.scrollTop(),a=t.getScrollHeight(),o=e.offsetHeight;i="center"===i?-.5*t.getScrollHeight():i,s="center"===s?a/2:s;var d=r?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=n+i>e.offsetTop,g=o+e.offsetTop>n+a-s;u?d(e.offsetTop-i):g&&d(e.offsetTop-a+o+s)})}function F(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var n=arguments.length,a=new Array(n>2?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];return t(...a).then(()=>{e.get().loading=!1})}function H(e,t,n){return n.scrolls||(n.scrolls={}),n.scrolls[e]&&!t||(n.scrolls[e]={scrolled:n.scrolled||0,scrollItem:n.scrollItem}),Promise.resolve(n)}function U(e,t,n,a){var r=e.get(),i=r.elements,o=a.getContainer(),l=e.setState({offset:r.offset+r.limit}).then(()=>{var n,s=r.offset,l=r.limit;return l+s>i.length?n=t().more(s,l).then(t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t)).then(q.bind(null,e,o,a,t,r.pipeId)):(n=Promise.resolve(),R(o,a,t,e)),n});if(!n){var c=i.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";Object(s.wrapLoading)(o)(l,"bottom",c)}return l}function G(e,t){var n=e.get().pipeId;return!(void 0!==n&&void 0!==t&&n!==t)}function q(e,t,n,a,r,i){return!!G(e,r)&&e.setState(function(e,t,n){var a=e.filter(e=>!n.ids[t(e)]);return{_sortedEls:!1,els:a,ids:A(a,t,n.ids),elements:n.elements.concat(a)}}(i,a().idFn,e.get())).then(R.bind(null,t,n,a))}function K(e,t,n){var a=F.bind(null,t,U.bind(null,t,n)),r=(e,a)=>{(t.get().activated||e)&&(void 0!==a&&t.get().elements.length>0&&t.setState({scrolled:a}),n().onScroll&&n().onScroll())},i=Object(T.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:r.bind(null,!1),more:!!n().more&&a.bind(null,!1)}),s=Object(f.createModule)({handlers:(a,r)=>{r(e,"click",t.get().elCls,n().onClick)}});return t.setState(L(n().idFn,{},t)),{pipe:(e,a)=>(t.setState({pipeId:a}),e.then(q.bind(null,t,i.getContainer(),i,n,a))),replacePreserveOrder:e=>t.set(N.bind(null,e,n().idFn)).then(R.bind(null,i.getContainer(),i,n)),pipeReplace(e,a){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.setState({pipeId:a,stop:!1}),e.then(e=>{if(G(t,a))return t.setState({elements:e,_sortedEls:!1,ids:A(e,n().idFn,{})}).then(R.bind(null,i.getContainer(),i,n,t,r))})},wipe(){i.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,n)=>t.set(H.bind(null,e,n)),updateScroll(){i.update(!1,!0)},toTop(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?i.smoothScroll(-i.scrollTop()):i.scrollTop(0),e&&r(e,0)},scrollTop:e=>i.scrollTop(e),restoreScroll(e){var n=t.get().scrolls,a=n[e];return a&&(t.setState({scrolls:extend({},n,{[e]:null})}),i.scrollTop(a.scrolled)),!!a},unsetScroll(e){t.setState({scrolls:extend({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var n=i.scroll.scroller,a=i.scrollTop(),r=a+("up"===e?-1:1)*n.clientHeight;t?i.smoothScroll(r-a):i.scrollTop(r)},scrollToElement(e,a,r,s){B(t,i,n,e,a,r,s)},getScroller:()=>i.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?a(e,i):Promise.resolve([]),add:(e,a)=>q(t,i.getContainer(),i,n,a,e),hoverNextElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,l=w(o,t.get().hoveredListItemId||M(s,a)),c=Object(h.toArray)(o).slice(l+1).find(n().hoverableFn);I(t,s,c,e),B(t,i,n,null,!1,r.top,r.bottom)},hoverPrevElement(e,a){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=i.getContainer(),o=s.children,l=w(o,t.get().hoveredListItemId||M(s,a)),c=l>=0&&Object(h.toArray)(o).slice(0,l).reverse().find(n().hoverableFn);I(t,s,c,e),B(t,i,n,null,!1,r.top,r.bottom)},hoverFirstElement(e,a){var r=i.getContainer(),s=r.children,o=Object(h.toArray)(s).findIndex(n().hoverableFn),l=s[o];!t.get().hoveredListItemId&&l&&(I(t,r,l,e),B(t,i,n,o,!1,a.top,a.bottom))},hoverElement(e,a,r){var s=i.getContainer(),o=s.children,l=w(o,e),c=o[l];c&&(I(t,s,c,a),B(t,i,n,l,!1,r.top,r.bottom))},unhoverElements(e){k(t,i.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(L(n().idFn,e,t))},getHoveredElement:()=>S(i.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(P.bind(null,e,n().idFn)).then(R.bind(null,i.getContainer(),i,n))},unmount(){Object(f.destroyModule)(s),i.destroy()}}}var V=n("1y80"),W=n("86+7"),$=n("lJdi");function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Q=["_im_dialog_selected","nim-dialog_selected"],X=["_im_dialog_hovered","nim-dialog_hovered"];function J(e,t,n){removeClass(t.parentNode,"im-page--dialogs_with-mess");var a=n.getCurrentElements().filter(e=>e.message);n.toTop(),n.reset(),Object(V.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),a.length>0?(a=[{type:"sep_messages"}].concat(a),e.setState({searchOnlyMessages:!0})):a=[Se()],n.pipeReplace(Promise.resolve(a))}function Z(e){return hasClass(e,"_im_search")}function ee(e,t,n,a){if(Object(o.isSearching)(e)&&e.get().searchAllLoaded||Object(o.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||Object(s.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if(Object(o.isSearching)(e))return Object(i.searchMessages)(Object(o.getSearchText)(e),e.get()).then(e=>{var t=z(e,2),n=t[0];return Te(t[1],n)});var r=e.get().active_tab,l=e.get().dialog_tabs_all;return r!==j.FOLDER_MESSAGE_REQUEST&&l[j.FOLDER_ALL]&&!Object(s.isReversedDialogs)(e)||l[r]?0===Ge(e).length?Object(o.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):Promise.resolve([{type:"empty_dialogs"}]):Promise.resolve([]):e.set(i.loadDialogs).then(t=>{var n=Ge(e);return 0===n.length?Object(o.isMessageRequestFolder)(e)?Promise.resolve([{type:"message_request_notice"},{type:"empty_message_requests"}]):[{type:"empty_dialogs"}]:n})}function te(e,t,n,a,r,l){if(!(gpeByClass("_im_peer_target",r.target)||gpeByClass("_im_dialog_ad_tag",r.target)||gpeByClass("_im_dialog_peer_tags",r.target))){var c=n.get(),d=Z(l),u=parseInt(domData(l,"peer"),10),g=parseInt(domData(l,"msgid"),10),m=Object(o.getTab)(n,u);if(function(e,t){return e.get().active_tab===j.FOLDER_MESSAGE_REQUEST&&Object(o.tabIsMessageRequestToChat)(t)}(n,m))return t().showInvitationBox(n,u),cancelEvent(r);var p="";if(Object(o.isSearching)(n)&&(p="conversations_search"),Object(o.isRecentSearchesActive)(n)&&(p="recent_searches"),hasClass(l,"_im_sugg_"+u)&&(p="popular_suggestions"),d&&(p="message_search"),checkEvent(r))return window.open(function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=Object(s.getBaseLink)(e),i=()=>`${r}?sel=${Object(s.convertPeerToUrl)(t.peerId)}${a&&n?"&msgid="+n:""}`;if(a)return i();if(Object(s.isUserPeer)(t.peerId)||Object(s.isCommunityPeer)(t.peerId))return Object(s.isClassicInterface)(e)?i():t.href;return i()}(n,m,g,d));if(a.saveScroll("list"),d&&c.msgid!==g)c.longpoll.push([b.changePeer(u,g,!1,!1,p)]);else if(u!==c.peer){c.longpoll.push([b.changePeer(u,!1,!0,!0,p)]);var _=Object(o.isSearching)(n);_&&!hasClass(l,"_dont_add_recent")&&Object(i.saveRecentSearchPeer)(u,cur.imDb),_&&m&&!Object(s.isClassicInterface)(n)&&setTimeout(()=>{var e=m.message?m.message.messageId:m.peerId;a.scrollToElement(e.toString(),!0,0,"center")},100)}else u===c.peer&&e().goToHistoryEnd();cancelEvent(r)}}function ne(e,t,n,a){var r,i="string"==typeof n.photo&&""!==n.photo;return Object(s.isChatPeer)(t)&&!i?r=Object(s.renderPhotosFromTab)(e,n,!a):(r=`<img src="${n.photo}" alt="">`,a&&(r=getTemplate("im_dialogs_link_img",{href:n.href||n.link,photo:r}))),{photo:r,userLink:`<span class="_im_dialog_link">${n.tab||n.name}</span>`}}function ae(e){return!Object(s.isPendingForward)(e)}function ie(e,t,n,a){return n?"":a?getTemplate("im_img_prebody",{photo:t}):e+":"}function oe(e,t,n,a,r,i,l,c,d,u){var g="",m=Object(o.isChannelPeer)(Object(o.getTab)(e,n));return t&b.FLAG_OUTBOUND?g=ie(getLang("mail_by_you"),u,m,d):Object(s.isChatPeer)(n)&&0!==a&&(g=ie(Object(W.oCacheGet)(e,a).first_name,Object(W.oCacheGet)(e,a).photo,m,d)),l=Object(s.renderShortText)(n,c,l,r,i),g?getTemplate("im_drow_prebody",{prebody:g,body:l}):l}function le(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=[];return Object(s.isClassicInterface)(a)&&i.push("nim-dialog_classic"),Object(o.isRecentSearchesActive)(a)&&i.push("nim-dialog_recent"),i.push("nim-dialog_empty"),r.search&&i.push("_im_search"),getTemplate("im_drow",{peer:e.peerId,msg_id:"",photo:t,user_link:n,date:"",body:"",unread:"",more:i.join(" "),is_star:"",unread_message_string:"",is_online:onlinePlatformClass(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==a.get().peer?"nim-dialog_selected _im_dialog_selected":""})}function de(e,t,n){return!!(n&b.FLAG_OUTBOUND)&&(!Object(s.isSelfMessage)(t.peerId,e.get().gid)&&(!(Object(s.isChatPeer)(t.peerId)&&t.data&&t.data.closed)&&(!t.unread&&!(!t.lastmsg||t.lastmsg<=t.out_up_to))))}function ue(e){var t=ve(e);return(e.unread>0?e.unread:"")>0&&t}function me(e){return!(!e.mentions||!e.mentions.length)}function pe(e){return function(e){return!(!e.expiring_messages||!e.expiring_messages.length)}(e)&&!me(e)}function _e(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=n||ve(t),i=ne(e,t.peerId,t,Object(s.isClassicInterface)(e)),c=i.photo,d=i.userLink;if(!r)return le(t,c,d,e,a);var u=r.flags,g=Object(s.isFvkcomgroup)(e,t.peerId),m=Object(o.tabIsMessageRequestToChat)(t),p=Object(o.isCasperChat)(e,t.peerId),_=be(t,e,n),h=Object(o.isCommunityChat)(e,t.peerId),f=[];a.search&&f.push("_im_search","nim-dialog_search"),inArray(t.peerId,e.get().mutedPeers)&&f.push("nim-dialog_muted"),t.verified&&f.push("nim-dialog_verified"),p&&f.push("nim-dialog_casper"),t.ad_id&&f.push("nim-dialog_has-ad-tag"),t.has_ad_access&&f.push("nim-dialog_has-ad-access"),Object(o.isRecentSearchesActive)(e)&&f.push("nim-dialog_recent"),Object(l.isMessageEmpty)(r)&&!p&&f.push("nim-dialog_empty"),Object(s.isClassicInterface)(e)&&f.push("nim-dialog_classic"),t.folders&b.FOLDER_IMPORTANT&&f.push("nim-dialog_starred"),!a.search&&Object(s.isUnrespond)(e,t.peerId,t)&&f.push("nim-dialog_unrespond"),(g||h)&&e.get().gid&&f.push("nim-dialog_deny-remove"),me(t)&&f.push("nim-dialog_unread-mentions"),pe(t)&&f.push("nim-dialog_unread-expiring");var v=Object(o.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:r.date,y=e.get().timeshift,O=v?getShortDateOrTime(v,y,!0,getLang("months_sm_of","raw")):"",C=!de(e,t,u)||m||Object(o.isSearching)(e)?"":"nim-dialog_unread-out",j=t.unread>0?getLang("mail_im_new_messages",t.unread):"",E=e.get().is_peer_profile_enabled,T=!E&&t.ad_id?getTemplate("im_drow_ad_tag",{ad_id:t.ad_id}):"";return getTemplate("im_drow",{peer:t.peerId,msg_id:r.messageId,photo:c,user_link:d,date:O,body:_,unread_message_string:j,tab_name:stripHTML(t.tab),unread:Object(s.simplifyCounter)(t.unread),more:f.join(" "),is_online:onlinePlatformClass(t.online),is_unread:ue(t)?"nim-dialog_unread":"",is_unread_out:C,is_selected:a.noselect||m||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected",ad_tag_html:T})}function he(e,t,n,a,r){if(!t.deletedDialog)if(hasClass(e,"nim-conversation-search-row"))fe(e,t,n);else{var i=n.get(),c=ve(t),d=c.flags,u=be(t,n),g=ne(n,t.peerId,t,Object(s.isClassicInterface)(n)),m=g.photo,p=g.userLink,_=n.get().timeshift,h=c.date?getShortDateOrTime(c.date,_,!0,getLang("months_sm_of","raw")):"";Ae(e,t),val(geByClass1("_dialog_body",e),u),val(geByClass1("_im_dialog_date",e),h),val(geByClass1("_im_dialog_unread_ct",e),Object(s.simplifyCounter)(t.unread)),val(geByClass1("_im_dialog_link",e).parentNode,p);var f=geByClass1("_im_dialog_photo",e);f.innerHTML!==m&&val(f,m),i.is_peer_profile_enabled?i.peer||Fe(e,n):t.ad_id&&function(e,t){if(addClass(t,"nim-dialog_has-ad-tag"),toggleClass(t,"nim-dialog_has-ad-access",!!e.has_ad_access),!geByClass1("_im_dialog_ad_tag",t)){var n=getTemplate("im_drow_ad_tag",{ad_id:e.ad_id});geByClass1("nim-dialog--name",t).innerHTML+=n}}(t,e);var v=Object(o.isCasperChat)(n,t.peerId);toggleClass(e,"nim-dialog_verified",!!t.verified),toggleClass(e,"nim-dialog_casper",v),toggleClass(e,"nim-dialog_muted",inArray(t.peerId,n.get().mutedPeers)),toggleClass(e,"nim-dialog_unrespond",Object(s.isUnrespond)(n,t.peerId,t)),toggleClass(e,"nim-dialog_classic",Object(s.isClassicInterface)(n)),toggleClass(e,"nim-dialog_unread",ue(t)),toggleClass(e,"nim-dialog_unread-mentions",me(t)),toggleClass(e,"nim-dialog_unread-expiring",pe(t)),toggleClass(e,"nim-dialog_deny-remove",n.get().gid>0&&(Object(s.isFvkcomgroup)(n,t.peerId)||Object(o.isCommunityChat)(n,t.peerId))),removeClass(e,"nim-dialog_failed"),removeClass(e,"nim-dialog_deleted"),addClass(e,"_im_dialog"),toggleOnline(geByClass1("_im_peer_online",e),t.online),toggleClass(e,"nim-dialog_recent",Object(o.isRecentSearchesActive)(n)),toggleClass(e,"nim-dialog_empty",Object(l.isMessageEmpty)(c)&&!v),toggleClass(e,"nim-dialog_unread-out",de(n,t,d)&&!Object(o.isSearching)(n)),Re(e),toggleClass(e,"nim-dialog_starred",t.folders&b.FOLDER_IMPORTANT),r&&setTimeout((function(){addClass(geByClass1("_im_dialog_"+t.peerId,a),"nim-dialog_injected")}),100)}}function fe(e,t,n){Ae(e,t),toggleClass(e,"nim-dialog_recent",Object(o.isRecentSearchesActive)(n)),val(geByClass1("_im_dialog_unread_ct",e),Object(s.simplifyCounter)(t.unread)),toggleClass(e,"nim-dialog_unread",ue(t)),toggleClass(e,"nim-dialog_unread-expiring",pe(t)),toggleClass(e,"nim-dialog_unread-mentions",me(t));var a=ne(n,t.peerId,t,Object(s.isClassicInterface)(n)).photo,r=geByClass1("_im_dialog_photo",e);r.innerHTML!==a&&val(r,a),toggleOnline(geByClass1("_im_peer_online",e),t.online)}function be(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=n||ve(e),r=Object(o.tabIsMessageRequestToChat)(e),i=Object(o.isCasperChat)(t,e.peerId);if(r){var c=Object(s.isClassicInterface)(t),d=e.mr&&e.mr.inviter_id,u=Object(W.oCacheGet)(t,d),g=c?u.name:u.short_name,m=c?getTemplate("im_img_prebody",{photo:u.photo}):"",p=getLang("mail_mr_service_message").replace(/{user}/,g);return m+p}if(Object(s.isPeerBlocked)(e.peerId,t)){var _=t.get().block_states[e.peerId].name,h=getLang("mail_community_answering").replace("{username}",_);return getTemplate("im_drow_prebody",{prebody:h,body:""})}return Object(l.isServiceMsg)(a)&&!r?Object(s.renderServiceMsg)(t,a,e,!1):i&&Object(l.isMessageEmpty)(a)?getLang("mail_empty_casper_message"):Object(l.isExpiredCasperMessage)(a)?getLang("mail_expired_message"):oe(t,a.flags,e.peerId,a.userId,!0,a.attaches,a.text,a.subject,Object(s.isClassicInterface)(t),Object(W.oCacheGet)(t,t.get().id).photo)}function ve(e){var t=e.lastmsg_meta;return isArray(t)&&(t=b.addMessageEvent([4].concat(t))),t||b.addMessageEvent([4,-1,0,e.peer,0,"",{},{},-1,-1,0])}function ye(e,t,n){var a=Object(o.getTab)(e,t),r=Object(o.tabIsMessageRequestToChat)(a),l=Object(s.showLeaveDialog)(e,t,a=>{n().updateMenu(e);var o=Promise.resolve();Object(s.isChatPeer)(t)&&(o=r?e.set(i.rejectMessageRequest.bind(null,t)):e.set(i.leaveChat.bind(null,t))),a&&o.then(()=>Object(s.cleanHistory)(e,l,n,i.flushHistory,t)),l.hide()})}function Oe(e,t,n,a,r,o){var l=gpeByClass("_im_dialog",o,n);if(cancelEvent(r),!l)return!1;var c=intval(domData(l,"peer")),d=t.get(),u=Object(s.isCommunityPeer)(c)||Object(s.isUserPeer)(c);if(d.recentSearch){var g=Object(i.removeFromRecentSearch)(c,cur.imDb);re(l),0===g.length&&De(t,a,e)}else Object(s.isClassicInterface)(t)&&u?Object(i.deleteDialog)(c,d).then(n=>{var a=z(n,2),r=a[0],i=a[1];r?(!function(e,t,n,a,r){var i=geByClass1("_dialog_body",t);addClass(t,"nim-dialog_deleted"),removeClass(t,"_im_dialog"),val(i,getTemplate("im_delete_actions",{text:langNumeric(n,getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:a}))}(c,l,r,i),e().updateMenu(t)):ye(t,c,e)}):ye(t,c,e);return!1}function Ce(e,t){Object(s.toggleMessageRequestsTab)(e,t,i.changeDialogsTab)}function je(e,t){switch(t.type){case"sep_btn_search_msg":return Object(s.renderBtnSearchOnlyMessages)(e);case"sep_messages":return Object(s.renderMessagesSep)();case"sep_conversations":return Object(s.renderConversationsSep)();case"sep_popular":return Object(s.renderPopularSuggSep)();case"popular_sugg":return Object(s.renderPopularSuggestions)(e);case"clear_recent":return Object(s.renderClearRecent)();case"empty_dialogs":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_list_empty")});case"empty_message_requests":return getTemplate("im_dialogs_none",{msg:getLang("mail_dialogs_mr_empty")});case"empty":return getTemplate("im_dialogs_none",{msg:getLang("mail_im_search_empty")});case"message_request_notice":return getTemplate("im_dialogs_message_requests_notice",{msg:getLang("mail_message_request_tab_notice")});case"message_request_button_go":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_tab_mr")});case"message_request_button_return":return getTemplate("im_dialogs_message_requests_button",{msg:getLang("mail_go_to_all_tab")});default:return t.message?_e(e,t,t.message,{noselect:!0,search:!0}):t.local_index||Object(o.isSearching)(e)?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=ne(e,t.peerId,t,Object(s.isClassicInterface)(e)),r=a.photo,i=a.userLink,l=ae(e),c=""===n?[]:[n];return Object(o.isRecentSearchesActive)(e)&&c.push("nim-dialog_recent"),Object(s.isClassicInterface)(e)&&c.push("nim-csr_classic"),inArray(t.peerId,e.get().mutedPeers)&&c.push("nim-dialog_muted"),Object(o.isCasperChatTab)(t)&&c.push("nim-dialog_casper"),me(t)&&c.push("nim-dialog_unread-mentions"),pe(t)&&c.push("nim-dialog_unread_expiring"),getTemplate("im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:r,user_link:i,unread:Object(s.simplifyCounter)(t.unread),tab_name:stripHTML(t.tab),is_unread:ue(t)?"nim-dialog_unread":"",is_online:onlinePlatformClass(t.online),is_selected:t.peerId==e.get().peer&&l?"nim-dialog_selected _im_dialog_selected":"",more:c.join(" ")})}(e,t):_e(e,t)}}function Ee(e,t,n,a,r,o){var l=intval(domData(o,"peer")),c=domData(o,"action"),d=domData(o,"sid"),u=geByClass1("_im_dialog_"+l,t),g=intval(domData(o,"spam"));switch(c){case"restore":u&&e.set(i.restoreDialog.bind(null,l,d,g)).then(()=>{addClass(u,"_im_dialog"),removeClass(u,"nim-dialog_deleted"),he(u,e.get().tabs[l],e,t,!1),a().updateMenu(e)});break;case"spam":var m=`${getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${d}" data-peer="${l}">\n            ${getLang("mail_restore")}\n        </button>`;if(u){var p=geByClass1("_dialog_body",u);val(p,m),Object(i.spamDialog)(l,d,e.get())}break;case"block":(Object(s.isCommunityInterface)(e)?Object(s.showBlacklistBox)(l,e):Object(s.showBlacklistBoxUser)(l,e)).once("success",(function(){e.set(i.flushHistory.bind(null,l)).then(()=>{n().restoreDialogs(e)})}))}cancelEvent(r)}function Te(e,t){return e.map(e=>b.addMessageEvent([4].concat(e))).map(e=>extend({},t[e.peerId],{message:e}))}function Se(e){return{type:"empty",lang:e}}function we(e,t){var n=e.get().msg_local_ids_sort,a=n&&n[t.lastmsg];return void 0!==a?2e9+a:t.minor_sort_id}function Ie(e,t,n,a){var r=gpeByClass("_im_dialog",a,t),s=intval(domData(r,"peer"));return e.set(i.toggleDialogImportant.bind(null,s)),setTimeout((function(){Me(e,t,n,a)}),100),cancelEvent(n),!1}function ke(e,t,n){var a=t.major_sort_id||0,r=n.major_sort_id||0,i=a!==r?r-a:we(e,n)-we(e,t);return i=Object(s.isReversedDialogs)(e)?-i:i}function Me(e,t,n,a){Object(d.showTooltip)(a,{text:function(){var n=gpeByClass("_im_dialog",a,t),r=domData(n,"peer");return e.get().tabs[r].folders&b.FOLDER_IMPORTANT?getLang("mail_im_toggle_important_off"):getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:qe(e,a.getBoundingClientRect().top)})}function Ae(e,t){var n=t.unread>0?getLang("mail_im_new_messages",t.unread):"",a=geByClass1("_im_unread_blind_label",e);val(a,n)}function Le(e,t,n,a,r){var s=gpeByClass("_im_dialog",r,t),l=intval(domData(s,"peer")),c=e.get().tabs[l].lastmsg;return e.set(i.markDialogAnswered.bind(null,l,c)).then(()=>{he(s,e.get().tabs[l],e,t),Object(o.isRecentSearchesActive)(e)||n().restoreDialogs(e)}),showDoneBox(getLang("mail_marked_as_answered"),{out:1e3}),cancelEvent(a),!1}function Pe(e){var t=Object(o.isSearching)(e),n=e.get().searchOnlyMessages;return Object(s.isClassicInterface)(e)?{top:t&&!n?96:60,bottom:Object(s.isCommunityInterface)(e)?42:87}:{top:t&&!n?36:0,bottom:0}}function Ne(e,t){e.hoverFirstElement(X,Pe(t))}function xe(e){e.unhoverElements(X)}function De(e,t,n){if(Object(o.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else n().cancelSearch(e),cancelStackFilter("im_search")}function Re(e){var t=geByClass1("_im_dialog_star",e),n=geByClass1("_im_dialog_date",e);if(t&&n){var a=n.offsetWidth;t.style.right=15+a+14+"px"}}function Be(e){geByClass("_im_dialog",e).forEach(e=>{Re(e)})}function Fe(e,t){var n=t.get(),a=parseInt(domData(e,"peer")),r=Object(o.getTab)(n,a);if(n.is_peer_profile_enabled&&Object(s.isCommunityInterface)(n)&&r&&!Object(o.isChannelPeer)(r)&&!Object(o.isCommunityChat)(n,a)){var i=geByClass1("_im_dialog_peer_tags",e);if(r.ad_id||n.peer_profile_tags&&r.peer_tags){var l=r.peerTagsMaxWidth||0;if(!l){var d=geByClass1("_im_dialog_name_w",e).offsetWidth;l=340-(d+6+(r.verified?16:0)),t.set(e=>(e.tabs[a].peerTagsMaxWidth=l,Promise.resolve(e)))}!function(e,t,n,a){if(t<69)e.innerHTML="";else{e.style.maxWidth=t+"px";var r=n.get(),i=Object(o.getTab)(r,a),s=_(r,i);if(s.length){var l=g(p(s,t),2),d=l[0],u=l[1],m=d.reduce((e,t)=>(t.isAdTag?e+=getTemplate("sImPeerTagsAdTag",{ad_id:i.ad_id,url:`ads?act=office&union_id=${i.ad_id}&utm_medium=community_messages_ad_tag&utm_source=dialog`,extra_class:i.has_ad_access?"PeerTagsItem--hasAdAccess":""}):e+=getTemplate("sImPeerTagsItem",{name:t.name,color:t.color}),e),""),h=u.length,f="+"+Object(c.getLang)("mail_im_peer_profile_extra_tags",h);h&&(m+=getTemplate("sImPeerTagsExtra",{text:f})),e.innerHTML=m}else e.innerHTML=""}}(i,l,t,a)}else i.innerHTML&&(i.innerHTML="")}}function He(e,t){var n=t.get();n.is_peer_profile_enabled&&Object(s.isCommunityInterface)(n)&&geByClass("_im_dialog",e).forEach(e=>{Fe(e,t)})}function Ue(e,t,n,a,r){return{selectPeer(t,n){for(var a=geByClass("_im_dialog",e),r=n.get().peer,i=0;i<a.length;i++){var s=a[i],o=intval(domData(s,"peer")),l=intval(domData(s,"msgid"));o===r&&(!Z(s)||t===l&&Z(s))?(addClass(s,"nim-dialog_selected"),addClass(s,"_im_dialog_selected")):hasClass(s,"_im_dialog_selected")&&(removeClass(s,"nim-dialog_selected"),removeClass(s,"_im_dialog_selected"))}},appendFastDialogs(t,a,r){removeClass(e.parentNode,"im-page--dialogs_with-mess"),n.saveScroll("list"),r?(n.reset(),Object(s.isPendingForward)(t)||Object(o.isRecentSearchesActive)(t)||!O(a)?Object(o.isRecentSearchesActive)(t)&&(O(a)&&(a=[{type:"clear_recent"}].concat(a)),Object(o.doPopularSuggExist)(t)&&(a=[{type:"sep_popular"},{type:"popular_sugg"}].concat(a))):a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a),t.setState({searchOnlyMessages:!1}),n.pipeReplace(Promise.resolve(a)).then(()=>Ne(n,t))):n.pipe(Promise.resolve(a)),Object(s.isClassicInterface)(t)&&!Object(s.isReservedPeer)(t.get().peer)||n.toTop()},deactivate(){n.deactivate()},activate(){n.activate()},hoverFirstDialog(e){Ne(n,e)},hoverNextDialog(e){n.hoverNextElement(X,Q,Pe(e))},hoverPrevDialog(e){n.hoverPrevElement(X,Q,Pe(e))},unhoverDialogs:xe.bind(n),selectHoveredDialog(t){var r=geByClass1("_im_dialog_hovered",e);r||(r=geByClass1("_im_dialog",e)),r&&te(a,this,t,n,{},r)},appendSearch(t,a,r){var i=Te(r,a);r.length>0?(addClass(e.parentNode,"im-page--dialogs_with-mess"),n.pipe(Promise.resolve([{type:"sep_messages"}].concat(i))).then(()=>Ne(n,t))):(0===n.getCurrentElements().length&&n.pipeReplace(Promise.resolve([Se()])),removeClass(e.parentNode,"im-page--dialogs_with-mess"))},update(e){n.pipeReplace(Promise.resolve(Ge(e)))},updateDialog(t,n){var a=geByClass1("_im_dialog_"+t,e);a&&!Z(a)&&he(a,Object(o.getTab)(n,t),n,e)},focusOnSelected(t){var a=t.get().peer;if(a){var r=geByClass1("_im_dialog_"+a,e);r?n.scrollTop(r.offsetTop-r.offsetHeight):n.toTop()}},restoreScroll(e){n.restoreScroll("list")||n.toTop()},forceScrollReinit(){var e=n.getScroller();e&&(e.style.overflowY="hidden",setTimeout(()=>e.style.overflowY="",0))},restoreDialogs(t,r,i){removeClass(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),0!==Ge(t).length||n.isLoading()||(r=!0),r&&n.reset(),i&&n.wipe(),n.pipeReplace(Promise.resolve(Ge(t))).then(()=>{if(r&&(!Object(s.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,n){return Object(s.isClassicInterface)(n)||t().toggleSettingsLoader(n,!0),e.checkMore(!Object(s.isClassicInterface)(n)).then(()=>{Object(s.isClassicInterface)(n)||t().toggleSettingsLoader(n,!1)})}(n,a,t);return n.toTop(),e}}).then(()=>xe(n)).then(()=>Be(e)).then(()=>He(e,t))},appendDialogs(t,a){removeClass(e.parentNode,"im-page--dialogs_with-mess"),a.forEach(n=>{var a=geByClass1("_im_dialog_"+n.peerId,e);a&&fe(a,n,t)}),Object(s.isPendingForward)(t)||Object(o.isRecentSearchesActive)(t)||!O(a)||(a=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(a)),t.setState({searchOnlyMessages:!1}),n.isEmpty()&&0===a.length&&Object(s.isPendingForward)(t)&&(a=[Se(getLang("mail_im_search_empty_chats"))]),n.replacePreserveOrder(a)},updateCounter(t,n){var a=geByClass1("_im_dialog_"+n,e),r=Object(o.getTab)(t,n);if(a&&!Z(a)&&(Ae(a,r),val(geByClass1("_im_dialog_unread_ct",a),Object(s.simplifyCounter)(r.unread)),toggleClass(a,"nim-dialog_unread",r.unread>0),toggleClass(a,"nim-dialog_unread-out",de(t,r,ve(r).flags)),toggleClass(a,"nim-dialog_unread-mentions",me(r)),toggleClass(a,"nim-dialog_unread-expiring",pe(r))),Object(o.isRecentSearchesActive)(t)){var i=geByClass1("_im_sugg_"+n,e);i&&(val(geByClass1("_sugg_unread_ct",i),Object(s.simplifyCounter)(r.unread)),toggleClass(i,"sugg-is_unread",r.unread>0))}},removeDialog(e,t){n.remove(t)},updateOnline(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a){var r=n.get().tabs[t],i=geByClass1("_im_peer_online",a);toggleOnline(i,r.online)}},setDialogFailed(t,n,a){var r=geByClass1("_im_dialog_"+t,e);r&&(a.get().tabs[t].lastmsg===n&&(addClass(r,"nim-dialog_failed"),val(geByClass1("_im_dialog_unread_ct",r),"!")))},scrollUp(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.toTop(e,t),n.saveScroll("list",!0)},saveScroll(e){n.saveScroll("list",!0)},promoteDialog(a,r){var i=geByClass1("_im_dialog_"+r,e);i&&!Z(i)||!Object(o.isSearching)(a)?(n.pipeReplace(Promise.resolve(Ge(a)),void 0,!0).then(t=>{!inArray(r,t)&&i&&he(i,Object(o.getTab)(a,r),a,e)}),t().updateTyping(r,a)):n.unsetScroll("list")},removeSelection(t){var a=t.get().peer.toString(),r=`._im_dialog_${a}.${Q.join(".")}`,i=domQuery(r,e)[0];Q.forEach(e=>removeClass(i,e)),Object(s.isClassicInterface)(t)||n.hoverElement(a,X,Pe(t))},updateScroll(){n.updateScroll()},updateTyping(t,n){var a=geByClass1("_im_dialog_"+t,e);if(a&&!Z(a)&&!n.get().tabs[t].deletedDialog){var r=geByClass1("_im_dialog_typing",a),i=!Object(s.isClassicInterface)(n),l=Object(s.formatTyper)(Object(o.getTab)(n,t).activity,t,!Object(s.isChatPeer)(t),n.get(),1,i);val(r,l),toggleClass(a,"nim-dialog_typing",l)}},showInvitationBox(e,t){var n=()=>this.removeDialog(e,t),r=()=>Object(s.isClassicInterface)(e)&&a().updateMenu(e);return(Boolean(Object(o.getTab)(e,t))?Promise.resolve():e.set(i.loadPeer.bind(null,t,0,0,0))).then(()=>{var a=Object(o.getTab)(e,t);if(!Object(o.tabIsMessageRequestToChat)(a)){var l=b.changePeer(t,!1,!1,!1,"");return e.get().longpoll.push([l])}return Object(s.showInvitationBox)(e,{receiver_peer_id:t},i.leaveInvitation,!1,{updateList:n,updateMenu:r})})},updateStarPosition(){Be(e)},renderPeerTags(t){var n=t.get().peer;n?Fe(geByClass1("_im_dialog_"+n,e),t):He(e,t)},unmount(){n.unmount(),Object(f.destroyModule)(r)}}}function Ge(e){var t=e.get(),n=t.active_tab,a=t.dialog_tabs[n],r=t.tabs,i=a.map(e=>r[""+e]).sort(ke.bind(null,e)),o=t.dialog_tab_cts.mr;if(n===j.FOLDER_MESSAGE_REQUEST&&i.unshift({type:"message_request_notice"}),!Object(s.isClassicInterface)(e))switch(n){case j.FOLDER_ALL:o>0&&i.unshift({type:"message_request_button_go"});break;case j.FOLDER_MESSAGE_REQUEST:i.unshift({type:"message_request_button_return"})}return i}function qe(e,t){return t>(e.get().gid?220:150)||Object(o.isSearching)(e)}function Ke(e,t,n,a){var r=Object(f.createMutations)(Ue),l=r.callMutations,c=r.bindMutations,u=function(e,n){Object(d.showTooltip)(n,{text:()=>{if(Object(o.isRecentSearchesActive)(t))return getLang("mail_hide_from_recent");var e=Number(n.getAttribute("data-peer")),a=Object(o.getTab)(t,e),r=Object(o.tabIsMessageRequestToChat)(a);return Object(s.isChatPeer)(e)&&!r?Object($.doesChatTabHaveFlag)(Object(o.getTab)(t,e),1024)?getLang("mail_unfollow_channel"):Object(o.isChatActive)(a)?getLang("mail_leave_chat"):getLang("mail_delete"):getLang("mail_delete")},black:1,[Object(s.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:Object(s.isClassicInterface)(t)?[-4,10]:[0,10],toup:qe(t,n.getBoundingClientRect().top),zIndex:1})},m=function(e,n){Object(d.showTooltip)(n,{text:getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:qe(t,n.getBoundingClientRect().top)})},b=Me.bind(null,t,e),v=Ie.bind(null,t,e),y=Le.bind(null,t,e,l),O={idFn:e=>function(e,t){return t.message?t.message.messageId:Object(o.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}(t,e),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:je.bind(null,t),more:ee.bind(null,t,l),onScroll:!!Object(s.isClassicInterface)(t)&&(()=>{(bodyNode.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&browser.safari?addClass(a,"im-page--header_static"):removeClass(a,"im-page--header_static")})},C=K(e,Object(E.default)({limit:40,offset:0,nativeScroll:!!Object(s.isClassicInterface)(t),height:64,elements:Ge(t)}),()=>O),j=te.bind(null,n,l,t,C),T=J.bind(null,t,e,C),S=Ee.bind(null,t,e,l,n),w=Oe.bind(null,n,t,e,C),I=Ce.bind(null,t,n),k=Object(f.createModule)({handlers:(a,r)=>{r(e,"click","_im_dialog_close",w),r(e,"click","_im_dialog_markre",y),r(e,"click","_im_dialog_star",v),r(e,"click","_im_dialog",j),r(e,"click",s.MESSAGE_SEARCH_CLASS,T),r(e,"mouseover","_im_dialog_close",u),r(e,"mouseover","_im_dialog_markre",m),r(e,"click",s.CLEAR_RECENT_CLASS,()=>{Object(i.resetRecentSearch)(cur.imDb),De(t,C,n)}),r(e,"click",s.TOGGLE_MR_TAB,I),r(e,"mouseover","_im_dialog_star",b),r(e,"click","_im_dialog_daction",S),Object(s.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&r(e,"mouseover","_im_peer_tags_extra",e=>function(e,t){var n=e.target,a=gpeByClass("_im_dialog",n),r=parseInt(domData(a,"peer")),i=t.get(),s=Object(o.getTab)(i,r),l=s.peerTagsMaxWidth;if(l){var c=g(p(_(i,s),l),2)[1].reduce((e,t)=>e+=getTemplate("sImPeerTagsExtraTooltipItem",{name:t.name,color:t.color}),"");Object(d.showTooltip)(n,{text:c,center:!0,dir:"bottom",className:"PeerTagsExtraTooltip",hasover:!0})}}(e,t)),a(e,"mouseover",Object(h.throttle)(C.unhoverElements.bind(C,X),100))}});return c(e,l,C,n,k)}n("hhXQ");var Ve=n("O8ze"),We=n("/eGY"),$e=n("RQ7Z"),ze=n("EasH"),Ye=n("pemR"),Qe=n("Wu9C"),Xe=n("ZoqV"),Je=n("q1tI"),Ze=n("i8i4"),et=n("MCfn"),tt=(n("17x9"),n("gqqU")),nt=n("PjZB"),at=n("22MJ"),rt=n("FEsp"),it=n("vRp6"),st=n("p+C8"),ot=n("NsuH"),lt=n("ThPM"),ct=n("7hRE"),dt=n("gdug"),ut=n("6krn");function gt(){return(gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function _t(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var ht=Je.useEffect,ft=Je.useState,bt=ut.default.getLang,vt=e=>{var t,n=e.searchValue,a=e.isLoading,r=e.convos,i=e.mode,l=e.selectedConvos,c=e.store,d=e.onSearchValueChange,u=e.onSearchInputKeydown,g=e.onConvoSelect,m=e.onListLoadMore,p=e.searchInputGetter,_=e.className,h=_t(e,["searchValue","isLoading","convos","mode","selectedConvos","store","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","searchInputGetter","className"]),f=Object(Ye.classNames)("ConvoPicker",_),b=Je.createRef(),v=mt(ft(0),2),y=v[0],O=v[1],C=i||"default",E=e=>{e!==y&&(O(e),T(e))},T=e=>{if(t){var n=r[e].peerId,a=t.querySelector(`[data-id="${n}"]`);if(a){var i=a.offsetTop,s=t.scrollTop;if(i<s)t.scrollTop=i;else{var o=t.offsetHeight,l=i+a.offsetHeight;l>s+o&&(t.scrollTop=l-o)}}}};return ht(()=>{p&&p(b)},[]),Je.createElement("div",gt({className:f,onMouseLeave:()=>O(-1)},h),Je.createElement(at.default,{value:n,onChange:d,onKeyDown:e=>{switch(e.which||e.keyCode){case j.ARROW_UP:E(Math.max(y-1,0)),e.preventDefault();break;case j.ARROW_DOWN:E(Math.min(y+1,r.length-1)),e.preventDefault();break;case j.ENTER:g(r[y].peerId),e.preventDefault()}u(e)},placeholder:bt("mail_top_search"),autoFocus:!0,key:"search",ref:b}),a&&Je.createElement(rt.default,{className:"ConvoPicker__stub",key:"loading"},Je.createElement(nt.default,null)),!a&&0===r.length&&Je.createElement(rt.default,{className:"ConvoPicker__stub",key:"no-results"},bt("mail_im_search_empty_chats")),!a&&r.length>0&&Je.createElement(it.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:m,hasMore:!1,ref:e=>t=Ze.findDOMNode(e),key:"results"},r.map((e,t)=>{var n=e.peerId,a=e.name,r=e.photo,i=e.online,d=Object(o.getTab)(c,n),u=(d||{}).online||i,m=d&&Object(o.isCasperChatTab)(d)?`<span class="ConvoPicker__resultTitle ConvoPicker__resultTitle--casper">\n                    <span class="ConvoPicker__resultTitleText">\n                      ${a}\n                    </span>\n                  </span>`:a,p="radio"===C?Je.createElement("span",{className:Object(Ye.classNames)("ConvoPicker__radio",{"ConvoPicker__radio--selected":l.includes(n)})}):"",_=Array.isArray(r)?Je.createElement(lt.default,{photos:r}):Je.createElement(ct.default,{isOnline:!!u,isMobile:!!dt.mobPlatforms[u],title:a,photo:r,onlineSize:"s"});return Je.createElement(st.default,{key:n,"data-id":n,active:t===y,canBeHovered:!1,chevron:"default"===C,aside:p,onClick:()=>g(n),onMouseEnter:()=>O(t)},Je.createElement(ot.default,{size:"34",title:m,photo:_,description:d&&Object(s.getChatMemberCount)(d)}))})))},yt=n("DM26"),Ot=n("rjmT");function Ct(){return(Ct=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function jt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Et(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Et(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var Tt=Object(yt.debouncedPromise)(i.searchHints,300),St=ut.default.getLang;class wt extends Je.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if(Object(o.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?i.searchImTopConv:i.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},()=>n("",e.get()).then(e=>this.setSearchResults(this.filterResults(e))).then(()=>this.searchInput.focus()).catch(e=>console.error(e)))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=Object(o.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter(e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!Object($.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&Object($.doesChatTabHaveFlag)(e,1024)))})},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=Object(o.isCommunityInterface)(t)&&0===this.state.mode,r=a?i.searchImTopConv:i.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}):r(e,n).then(t=>{var r=t.map(e=>e.peerId);return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?Tt(e,r,"all",{hidegid:a},n):Promise.resolve([])}).then(t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)}).catch(()=>{})},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},r={};return Object(i.searchTopConv)("",t).then(i=>(i.forEach(e=>{r[e.peerId]=e}),[t.peer].concat(n.filter(e=>e!=t.peer)).map(t=>{var n=Object(o.getTab)(e,t);return a[t]=!0,{name:r[t]&&r[t].name||n.name,photo:r[t]&&r[t].photo||n.photo,data:n.data,peerId:t}}).concat(i.filter(e=>!a[e.peerId]))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([Object(b.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),Object(Ve.statlogsForwardEvent)(t),Object(o.isCommunityInterface)(t)&&Object(Ve.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},()=>{Emoji.focus(this.input)})},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var r=e.filter(e=>!t.found[e.peerId]);r.forEach(e=>{t.found[e.peerId]=!0}),t.setState({found:[].concat(t.state.found,r),loading:a})}else t.found=e.reduce((e,t)=>(e[t.peerId]=!0,e),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new Ot.ImDraft({},0),r=e.get().pendingForward;if(t&&!Object(s.isMessageTooLong)(val)){this.setState({sending:!0});var l=Object(o.isCommunityInterface)(e)&&0===this.state.mode;l||a.addAttach("mail",r.msgIds.join(";"),r.object||null);var c={message:n,attaches:a.dData.attaches.map(e=>[e.type,e.id])||[]},d={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:l?r.msgIds.join(";"):void 0}};new Promise(n=>{Object(i.loadHashes)([t],{hidegid:!0},e.get()).then(e=>{var a=jt(e,1)[0];return n(a[t])})}).then(n=>e.set(i.sendMessage.bind(null,t,c,Ct({hash:n},d)))).then(()=>{Object(Ve.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(St("mail_send3"))}).catch(e=>{this.unmounted||this.setState({sending:!1},()=>{Object(ze.showFastBox)(St("mail_error"),e)})})}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then(e=>{this.setSearchResults(this.filterResults(e))}).catch(e=>console.error(e))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,a=this.state,r=a.mode,i=a.loading,s=a.selected,l=a.found,c=a.sending,d=Object(Ye.classNames)("MessageForward",{"MessageForward--form":0===r&&!!s});return Je.createElement("section",{className:d},Je.createElement(tt.default,{title:Je.createElement(Je.Fragment,null,Je.createElement("span",{className:"MessageForward__title"},St("mail_forward_messages")),Object(o.isCommunityInterface)(t)&&Je.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},St(0===r?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),Je.createElement("div",{className:"MessageForward__content"},Je.createElement(vt,{searchValue:this.state.value,isLoading:i,convos:l,mode:1===r?"default":"radio",selectedConvos:[s],store:t,onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),Je.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},Je.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},Je.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:St("mail_im_enter_msg")}),Je.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},Je.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:St("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},Je.createElement("div",{className:"emoji_smile_icon_vector emoji_smile_icon"})))),c?Je.createElement("div",{className:"MessageForward__send-spinner"},Je.createElement(nt.default,null)):Je.createElement("button",{className:"MessageForward__send",onClick:this.send}))))}}var It,kt=Object(et.connect)(wt);function Mt(){It&&It.hide()}function At(){It&&It.updateBoxCoords()}function Lt(){return document.querySelector("#MessageForward")}function Pt(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=Lt();t&&Ze.unmountComponentAtNode(t),Object(f.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),a||show(t)},hideLoader(){hide(n),a||hide(t)}}}function Nt(e,t,n){var a=(0,Object(f.createMutations)(Pt).bindMutations)(Object(f.createModule)({handlers:(e,t)=>{}})),r={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=Lt();t&&Ze.render(Je.createElement(et.default,{value:e},Je.createElement(kt,{closePopup:Mt,updatePopup:At})),t)}(t),requestAnimationFrame(()=>It.updateBoxCoords())},onHideAttempt:()=>(t.set(i.prepareForward.bind(null,null)),a.unmount(),!0)};return a.showLoader(),Promise.resolve().then(e=>{a.hideLoader(),It=new MessageBox(r).content('<div id="MessageForward"></div>').show()}),a}var xt="im-page--header-action_loading";function Dt(e,t,n){return!e.map(e=>{var a=Object(o.getMessage)(t,n,e);return Object(l.isImportant)(a)}).reduce((e,t)=>e&&t,!0)}function Rt(e,t){var n=t.get(),a=n.peer,r=n.tabs[a].pinned;return 1===e.length&&r&&e[0]===Object(o.parserMessage)(r).messageId}function Bt(e,t,n){var a=Object(c.getLang)("mail_selected_shorted",t.length);Gt({actions:!0},"im-page--chat-header"),val(geByClass1("im-page--selected-messages"),getTemplate("im_selected_messages",{label:a.replace("{count}",t.length),tip:Object(c.getLang)("mail_deselect_all")}));var r=Object(o.getTab)(n,n.get().peer),i=e.querySelector("._im_mess_actions"),l=Dt(t,n,n.get().peer),d=Rt(t,n),u=t.length>1,g=!u&&Object(s.isChatPeer)(r.peerId)&&Object(s.canPinMessage)(n,t[0]),m=Object(s.canForwardMessages)(n,t),p=e.querySelector('._im_page_action[data-action="respond"]'),_=e.querySelector('._im_page_action[data-action="forward"]'),h=Boolean(Object(o.tabIsOutgoingMessageRequest)(r)),f=Boolean(Object(o.tabIsMessageRequest)(r));i.className=Object(Ye.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!l,"im-page--mess-actions_pinned":d,"im-page--mess-actions_channel":Object(o.isChannelPeer)(r)&&!n.get().gid,"im-page--mess-actions_multiple-selection":u,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":h,"im-page--mess-actions_in-mr":f,"im-page--mess-actions_no-important-btn":!Object(s.canMarkImportant)(n,t)}),t.length>1?p.innerHTML=Object(c.getLang)("mail_forward_here"):p.innerHTML=Object(c.getLang)("mail_im_mark_reply"),m?(_.removeAttribute("disabled"),_.classList.remove("button_disabled")):(_.setAttribute("disabled","disabled"),_.classList.add("button_disabled")),u&&!m?(p.setAttribute("disabled","disabled"),p.classList.add("button_disabled")):(p.removeAttribute("disabled"),p.classList.remove("button_disabled"));var b=l?Object(c.getLang)("mail_im_toggle_important"):Object(c.getLang)("mail_im_toggle_important_off"),v=d?Object(c.getLang)("mail_unpin"):Object(c.getLang)("mail_pin");attr(geByClass1("im-page-action_star",e),"aria-label",b),attr(geByClass1("im-page-action_pin",e),"aria-label",v)}function Ft(e,t,n){var a=t.get(),r=a.peer,l=a.tabs[r],c=geByClass1("_im_chat_verified",e),d=geByClass1(s.PINNED_CONTAINER_CLASS,e),u=Object(s.isChatPeer)(r),g=u&&Object(o.isChannelPeer)(l),m=a.selectedMessages&&!!a.selectedMessages.length;c.tt=!1;var p=Object(s.renderPhotosFromTab)(t,l,!0),_=getTemplate("im_simple_link",{href:g?"/club"+-l.ownerId:l.href,content:getTemplate("im_peer_photo",{online_class:"",owner_photo:p,modifier_class:"nim-peer_smaller"})});val(geByClass1("im-page--aside-photo",e),_);var h=u&&Object(o.isChatActive)(l),f={muted:inArray(r,a.mutedPeers),verified:!!l.verified,chat:u,vkcomgroup:g,actions:m,derelict:u&&!h&&!g,pinned:!1};if(u){var b=Object(o.getPinnedMessage)(t),v=function(e){var t=Object(o.getPinnedMessage)(e);if(!t||Object(W.oCacheGet)(e,t.userId))return!1;return t.userId}(t);b&&Object(Qe.isPinnedMessageVisibleInTab)(t,r)&&(v?t.set(i.loadChatMember.bind(null,{[r]:[v]})).then(Ft.bind(null,e,t,n)):f.pinned=!0)}Ht(t,l,e);var y=!l.top_banner&&d.innerHTML,O=!l.top_banner&&Ut(t,e,d),C=geByClass1("_im_page_peer_name",e);removeClass(C,s.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;geByClass("_im_header_icon",e).forEach(e=>{if("star"===e.dataset.type&&Object(s.isFoldersAvailable)(t)&&(toggleClass(e,"im-page--header-icon_shown",!a),toggleClass(e,"im-page--header-icon_star-active",Object(s.isImportant)(t))),"answer"===e.dataset.type&&Object(s.isFoldersAvailable)(t)&&toggleClass(e,"im-page--header-icon_shown",!a&&Object(s.isUnrespond)(t)),"search"===e.dataset.type&&!Object(s.isCommunityInterface)(t)){var n=t.get().peer,r=!a&&Object(s.isFullyLoadedTab)(t,n)&&Object(o.getTab)(t,n).offset&&!Object(s.isCommunityInterface)(t)&&(!Object(s.isCallToPeerAvailable)(t,n)||!Object(s.isClassicInterface)(t));toggleClass(e,"im-page--header-icon_shown",r)}})}(e,t,[]);var j=geByClass1("im-page--header-call",e);if(j&&j.classList.toggle("im-page--header-call-is-hidden",!Object(s.isCallToPeerAvailable)(t,r)),Object(s.isClassicInterface)(t)){var E=geByClass1("_im_page_back",e);attr(E,"href",`${Object(s.getBaseLink)(t)}?tab=${a.active_tab}`)}Gt(f,"im-page--chat-header"),Object(s.compensateHistoryHeightChange)(t,O,y,n)}function Ht(e,t,n){var a=Object(h.unpackStore)(e),r=t.name,i=Object(s.isChatPeer)(t.peerId),l=i&&Object(o.isChannelPeer)(t),d=i&&Object(o.isChatActive)(t),u=i&&Object(o.isCasperChatTab)(t),g="";i?g=l?getTemplate("im_vkcomgroup_members",{name:Object(c.getLang)("mail_im_n_vkcomgroup_members",Object(s.getAliveMembersCount)(t))}):d?getTemplate("im_chat_members",{name:Object(c.getLang)("mail_im_n_chat_members",Object(s.getAliveMembersCount)(t))}):"":Object(s.isUserPeer)(t.peerId)&&(g=Object(s.getLastSeenTextInHeader)(e,t.peerId));var m="";!a.is_peer_profile_enabled&&t.ad_id&&(m=getTemplate("im_simple_name_ad_tag",{ad_id:t.ad_id}));var p=[];""===g&&p.push("im-page--title--1line"),!a.is_peer_profile_enabled&&t.has_ad_access&&p.push("im-page--title--has-ad-access"),u&&p.push("im-page--title--casper"),p=p.join(" ");var _=getTemplate("im_simple_name",{name:t.tab,href:l?"/club"+-t.ownerId:t.href,name_attr:r,ads_union:t.ad_union_ids_attr,online:g,more_cls:p,ad_tag_html:m});val(geByClass1("im-page--title-wrapper",n),_)}function Ut(e,t,n){var a=Object(o.getPinnedMessage)(e),r=n||geByClass1(s.PINNED_CONTAINER_CLASS,t);if(removeClass(r,"im-page--pinned_with-bar"),a&&Object(l.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&addClass(r,"im-page--pinned_with-bar")}var i=Object(s.renderPinnedMessage)(e);return val(r,i),!!i}function Gt(e,t){var n=geByClass1(t);Object.keys(e).forEach(a=>{toggleClass(n,`${t}_${a}`,!!e[a])})}function qt(e,t,n,a,r){e.set(i.removeMessagesWithRestore.bind(null,n,r,a)).then(t().removeMessagesRestore.bind(null,n,r,a)),Object(i.removeMessageSend)(n,r,null,a,e.get())}function Kt(e,t,n,a,r){var l=e.get().selectedMessages,c=domData(r,"action"),d=e.get().peer,u=!0,g=Object(o.getTab)(e,d);if("star"!==c&&Object(o.tabIsOutgoingMessageRequest)(g))return Wt(e,t,n);switch(c){case"delete":var m=!(vk.id==d&&!e.get().gid)&&l.every(t=>Object(s.canMessageBeDeletedForAll)(e,Object(o.getMessage)(e,d,t)));if(m||l.length>1){u=!1;var p=Object(s.showMsgDeleteDialog)(d,l.length,m,a=>{Wt(e,t,n),p.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?Object(i.removeMessageSend)(l,d,null,"deleteforall",e.get()):qt(e,t,l,c,d)})}else qt(e,t,l,c,d);break;case"spam":qt(e,t,l,c,d);break;case"forward":if(!Object(s.canForwardMessages)(e,l))return;Object(i.processFwd)(l,d,e).then(t=>e.set(i.prepareForward.bind(null,t))).then(()=>n().showForward(e)).catch(e=>console.error(e));break;case"star":var _=Dt(l,e,d);e.set(i.favMessage.bind(null,l,_,d)),e.get().longpoll.push(l.map(e=>({type:_?b.SET_FLAGS:b.RESET_FLAGS,messageId:e,peerId:d,flags:b.FLAG_IMPORTANT})));break;case"respond":var h=e.get(),f=1===l.length;Object(i.processFwd)(l,h.peer,e).then(t=>e.set(i.forwardMessages.bind(null,t,h.tfdraft,f))).then(()=>{t().respond(e,d)});break;case"pin":var v=Object(o.getLocalId)(e,l[0]);if(!Object(s.canPinMessage)(e,v))return;var y=Rt(l,e),O=y?i.unpinMessageOptimistic.bind(null,d):i.pinMessageOptimistic.bind(null,v,d),C=y?i.unpinMessage.bind(null,d):i.pinMessage.bind(null,v,d),j=Jt.bind(null,t,d);e.set(i.checkChatMember.bind(null,e,v,d)).then(e=>e.set(O)).then(j).then(e=>e.set(C)).then(j)}u&&Wt(e,t,n)}function Vt(e,t,n,a,r,l){var d=domData(l,"action"),u=a.querySelector("._im_dialog_action_wrapper ._ui_menu").parentNode,g=e.get().peer;switch(d){case i.CHAT_ACTION_CLEAR:var m=Object(o.getTab)(e,g),p=Object(s.showFlushChat)(m,g,()=>{Object(s.cleanHistory)(e,p,t,i.flushHistory,e.get().peer)});break;case i.CHAT_ACTION_MEDIA:showWiki({w:"history"+Object(s.convertPeerToUrl)(g)+"_photo"},null,{});break;case i.CHAT_ACTION_CALL_AUDIO:case i.CHAT_ACTION_CALL_VIDEO:Object(s.isCallToPeerAvailable)(e,g)&&Object(s.startCallFromIm)(e,g,d===i.CHAT_ACTION_CALL_VIDEO);break;case i.CHAT_ACTION_SEARCH:t().showSearch(e);break;case i.CHAT_ACTION_BLOCK_NOTIFY:case i.CHAT_ACTION_BLOCK_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!1,g)).then(()=>{e.get().longpoll.push([Object(b.resetPeer)()]),showDoneBox(Object(c.getLang)("mail_community_was_blocked"))});break;case i.CHAT_ACTION_ALLOW_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!0,g)).then(()=>{n().changeActions(e)});break;case i.CHAT_ACTION_BLOCK:Object(s.showBlacklistBox)(g,e).once("success",t=>{t.delta&&(showDoneBox(t.msg),e.get().longpoll.push([Object(b.resetPeer)()]))});break;case i.CHAT_ACTION_LEAVE:var _=Object(s.showLeaveDialog)(e,g,n=>{var a=e.set(i.leaveChat.bind(null,g)).then(()=>e.set(i.unpinMessageOptimistic.bind(null,g)));n&&a.then(()=>Object(s.cleanHistory)(e,_,t,i.flushHistory,g)),_.hide(),e.get().longpoll.push([Object(b.resetPeer)()])});break;case i.CHAT_ACTION_RETURN:e.set(i.returnToChat.bind(null,g)).then(e=>e.set(i.getPinnedMessage.bind(null,g))).then(t().updateChatTopic.bind(null,g)).catch(e=>{Object(ze.showFastBox)(Object(c.getLang)("global_error"),e)});break;case i.CHAT_ACTION_MUTE:case i.CHAT_ACTION_UNMUTE:e.set(i.toggleMutePeer.bind(null,g,d===i.CHAT_ACTION_MUTE,-1)).then(t().updateState.bind(null,g));break;case i.CHAT_ACTION_INVITE:if(Object(s.isChatPeer)(g))Object(s.inviteUser)(e,g,t,i.setCreationType);else if(Object(s.isUserPeer)(g)){var h=e.get().tabs[g],f=[[g,h.tab]];e.set(i.setCreationType.bind(null,"chat",[])).then(()=>t().showCreation(e,f))}break;case i.CHAT_ACTION_PIN_HIDE:Object(Qe.pinnedMessageHide)(e,Object(o.getPeer)(e),t);break;case i.CHAT_ACTION_PIN_UNHIDE:Object(Qe.pinnedMessageUnHide)(e,Object(o.getPeer)(e),t);break;case i.CHAT_ACTION_UNPIN:Object(Qe.pinnedMessageUnpin)(e,Object(o.getPeer)(e),t);break;case i.CHAT_ACTION_SETTINGS:n().showSettings(e)}uiActionsMenu.toggle(u,!1),t().cancelEditing()}function Wt(e,t,n){var a=e.get().selectedMessages;e.set(i.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function $t(e,t,n,a){var r,i,o=Object(s.isClassicInterface)(e);switch(domData(a,"type")){case"star":i=[4,6],r=()=>Object(s.isImportant)(e)?Object(c.getLang)("mail_im_toggle_important_off"):Object(c.getLang)("mail_im_toggle_important");break;case"answer":i=[4,6],r=Object(c.getLang)("mail_end_conversation");break;case"search":i=o?[5,6]:[4,-9],r=Object(c.getLang)("mail_search_in_peer")}Object(d.showTooltip)(a,{text:r||"",black:1,shift:i,forcetoup:!0,appendParentCls:o?"_im_dialog_actions":"_im_mess_actions"})}function zt(e,t,n){var a=Object(s.isClassicInterface)(e),r=domData(n.target,"action");"respond"!==r&&"forward"!==r&&Object(d.showTooltip)(n.target,{text:Yt.bind(null,e,r)||"",black:1,shift:[2,a?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function Yt(e,t){var n=e.get(),a=n.selectedMessages,r=n.peer;switch(t){case"pin":return Rt(a,e)?Object(c.getLang)("mail_unpin"):Object(c.getLang)("mail_pin");case"star":return Dt(a,e,r)?Object(c.getLang)("mail_im_toggle_important"):Object(c.getLang)("mail_im_toggle_important_off");case"delete":return Object(c.getLang)("mail_delete");case"spam":return Object(c.getLang)("mail_im_mark_spam")}}function Qt(e,t,n,a,r){switch(domData(r,"type")){case"star":e.set(i.toggleDialogImportant.bind(null,e.get().peer)).then(()=>{setTimeout(()=>$t(e,0,0,r),40)});break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(r,{fasthide:!0});break;case"answer":var s=Object(o.getTab)(e,e.get().peer);s&&(e.set(i.markDialogAnswered.bind(null,e.get().peer,s.lastmsg)),showDoneBox(Object(c.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([Object(b.resetPeer)()]))}}function Xt(e,t){var n=Number(t),a=Object(s.formatTimespan)(n,!0),r=Object(c.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector("._im_page_status").innerHTML=r}function Jt(e,t,n){return e().updateChatTopic(t,n),n}function Zt(e,t,n,a){var r={};return{changeActions(t){var n=e.querySelector("._im_dialog_action_wrapper ._ui_menu"),a=geByClass1("_im_dialog_action_wrapper",e),r=t.get().curActions,s=Object.keys(r).map((e,t)=>{var n="";return 7!==i.ACTION_PRIORITIES[e]&&10!==i.ACTION_PRIORITIES[e]||0===t||(n='<div class="ui_actions_menu_sep"></div>'),n+getTemplate("sImUiActionMenuItem",{action:e,name:r[e].name,icon:r[e].icon})}).join("");0===Object.keys(r).length?addClass(a,xt):(val(n,s),removeClass(a,xt))},setNetworkWaitingStatus(t){r.interval&&clearInterval(r.interval),Xt(e,t),r.timeout=t,r.interval=setInterval(()=>{r.timeout>1?(r.timeout--,Xt(e,r.timeout)):(clearInterval(r.interval),r={})},1e3)},setNetworkReconnectingStatus(){var t,n;r.interval&&clearInterval(r.interval),r={},t=e.querySelector("._im_page_status"),n=Object(c.getLang)("mail_network_reconnecting"),t&&(t.innerHTML=n)},clearNetworkStatus(){r.interval&&clearInterval(r.interval),r={},e.querySelector("._im_page_status").innerHTML=""},showSettings(t){var n=t.get(),r=Object(o.getTab)(t,n.peer);Object(o.isChatActive)(r)&&Object(Xe.mount)(e,t,a)},showForward(e){Nt(0,e)},renderPeer(n){Ft(e,n,t)},reRenderPinned(t){var n=Object(o.getCurrentTab)(t);n&&n.pinned&&Ut(t,e)},reRenderTitle(t){var n=Object(o.getCurrentTab)(t);n&&Ht(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&Bt(e,n,t)},hideActions(t){if(!Object(s.isFullyLoadedTab)(t,t.get().peer)){geByClass("_im_header_icon",e).forEach(e=>{addClass(e,xt)});var n=geByClass1("_im_dialog_action_wrapper",e);addClass(n,xt);var a=geByClass1("_im_dialog_call_action_wrapper",e);addClass(a,xt)}},showActions(t){if(Object(s.isFullyLoadedTab)(t,t.get().peer)){geByClass("_im_header_icon",e).forEach(e=>{removeClass(e,xt)});var n=geByClass1("_im_dialog_action_wrapper",e);removeClass(n,xt);var a=geByClass1("_im_dialog_call_action_wrapper",e);removeClass(a,xt)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?Bt(e,a,n):Ft(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=geByClass1("_im_page_peer_online",t);a&&Object(s.isUserPeer)(n)&&Object(o.getTab)(e,n)&&Object(s.applyInnerHtml)(a,Object(s.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){Wt(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){Object(f.destroyModule)(n),cancelStackFilter("fowrward")}}}function en(e,t,n){var a=Object(f.createMutations)(Zt),r=a.callMutations,o=a.bindMutations,l=Kt.bind(null,t,n,r),c=Vt.bind(null,t,n,r,e),d=Wt.bind(null,t,n,r),u=(e,n)=>Object(s.showVerifiedTooltip)(n,t.get().peer),g=$t.bind(null,t,e),m=zt.bind(null,t,e),p=Qt.bind(null,t,e,n),_=()=>r().showSettings(t),h=t=>{!gpeByClass("im-page--chat-header_chat",t.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",t.target,e)||checkEvent(t)||(_(),cancelEvent(t))},v=()=>function(e){var t=()=>{e&&(e.classList.remove("im-page--chat-header_reconnected"),e.removeEventListener("mouseleave",t))};e&&(e.classList.add("im-page--chat-header_reconnected"),e.addEventListener("mouseleave",t)),window.lpConnect.abortWaiting()}(e),y=Object(f.createModule)({handlers:(n,a)=>{a(e,"click","_im_page_action",l),a(e,"click","_im_action",c),a(e,"click",s.DESELECT_ALL_CLASS,d),a(e,"mouseover","_im_chat_verified",u),a(e,"mouseover","_im_header_icon",g),a(e,"mouseover","_im_page_action",m),a(e,"click","_im_header_icon",p),a(e,"click","_im_header_link",h),a(e,"click","_im_page_peer_name",h),a(e,"click","_im_chat_members",_),a(e,"click","_im_page_reconnect",v),a(e,"click","_im_page_back",e=>{checkEvent(e)||(t.get().longpoll.push([Object(b.resetPeer)()]),cancelEvent(e))})}});return Object(s.isReservedPeer)(t.get().peer)||setTimeout(()=>{t.set(i.setActions).then(r().changeActions)}),o(e,n,y,r)}n("KKXr"),n("/8Fb");var tn,nn,an,rn,sn,on,ln,cn,dn,un,gn,mn,pn,_n,hn,fn=n("ZVxX"),bn=browser.msie&&intval(browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function vn(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var yn=!1,On=!1,Cn=100;function jn(e){var t=e.get().peer;Object(s.isFullyLoadedTab)(e,t)&&!Object(s.isAnyMessageBeingEdited)(e)&&Date.now()-(Object(s.getTab)(e,t).lastTyping||0)>1e3*i.ACTIVITY_PERIOD&&e.set(i.sendRecordingAudio.bind(null,t))}function En(e){if(!On){On=!0,Object(s.lockButton)(on);var t={peer:dn.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise((t,n)=>{for(var a=new FormData,r=[],i=0;i<e.wave.length;i++)r.push(parseInt(31*e.wave[i]));a.append("waveform",JSON.stringify(r)),a.append("file",e.buffer,"voice_message."+function(e){var t=e.match(/.*\/(\w*).*/);switch(t[1]){case"mpeg":return"mp3";case"ogg":case"webm":case"wav":return t[1]}return""}(e.mimeType));var s=new bn;s.onload=s.onerror=function(e){var a=e.currentTarget.response;200==this.status&&a.length>0&&"{"==a[0]?(a=JSON.parse(a),t(a)):n()},s.open("POST",hn.upload_url,!0),s.send(a)})})(e).then(e=>e.file?new Promise((n,a)=>{ajax.post("/docs.php",extend({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,a)=>{kn(),mn([["doc",e+"_"+a,"audiomsg"]],{},t.peer),xn(),n()},onFail:function(e){a(e)},progress:null})}):Promise.reject()).then(()=>{Object(s.unlockButton)(on),On=!1}).catch(()=>{On=!1,Object(s.unlockButton)(on),Object(ze.showFastBox)(getLang("global_error"),getLang("mail_audio_message_upload_error"))})}}function Tn(){_n(),nn.innerHTML=vn(yn.duration),yn.duration>=600&&Nn()}function Sn(e){e.set(i.cancelRecording).then(Ln)}function wn(){_n(),stManager.add(["voice_message_player.js","speech.js"],(function(){yn||(yn=Speech.newRecorder(),addEvent(yn,"progress",Tn)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),yn.record().then(()=>{var e;e=dn,hn.isRecording=!0,cancelStackPush("audio_message_cancel",Sn.bind(null,e)),hideProgress(geByClass1("im-audio-message-send-wrapper",tn)),nn.innerHTML="0:00",addClass(tn,"im-audio-message_recording"),removeClass(tn,"im-audio-message_recorded"),function(){tn&&tn.classList&&tn.classList.remove("im-audio-message-input--hidden");geByClass1("_im_chat_input_parent",cn).classList.add("im-chat-input--hidden")}(),(gn=Speech.createVisualization("wave",yn.source,an)).start();var t=an.getBoundingClientRect();Cn=(t.right-t.left)/3}).catch(e=>{AudioMessagePlayer.resumeGlobalMedia();var t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t="mail_audio_message_device_error";break;case"PermissionDeniedError":case"PermissionDismissedError":t="mail_audio_message_permission_error";break;case"Unsupported":t="mail_audio_message_unsupported_error"}Object(ze.showFastBox)(getLang("global_error"),getLang(t)),console.error(e)})}))}function In(){yn&&yn.stop(),gn&&(gn.destroy(),gn=null)}function kn(){hn.isRecording=!1,cancelStackFilter("audio_message_cancel")}function Mn(){An(),En(yn)}function An(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),removeEvent(yn,"finish",An),removeEvent(yn,"finish",Mn),e=URL.createObjectURL(yn.buffer),domData(un,"duration",yn.duration),domData(un,"ogg",e),domData(un,"mp3",e),geByClass1("audio-msg-track--duration",un).innerHTML=vn(yn.duration),geByClass1("audio-msg-track--wave-wrapper",un).innerHTML=AudioMessagePlayer.getWave(yn.wave,Cn),removeClass(tn,"im-audio-message_recording"),addClass(tn,"im-audio-message_recorded")}function Ln(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];kn(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),removeEvent(yn,"finish",An),removeEvent(yn,"finish",Mn),In(),xn(),e&&pn()}function Pn(){yn.isRecording?(addEvent(yn,"finish",Mn),removeEvent(yn,"finish",An),In()):En(yn)}function Nn(){addEvent(yn,"finish",An),removeEvent(yn,"finish",Mn),In()}function xn(){removeClass(tn,"im-audio-message_recorded"),removeClass(tn,"im-audio-message_recording"),tn&&tn.classList&&tn.classList.add("im-audio-message-input--hidden"),geByClass1("_im_chat_input_parent",cn).classList.remove("im-chat-input--hidden")}function Dn(){ge("audiomsg_record"),un=ge("audiomsg_player"),cn=geByClass1("_im_chat_input_w"),tn=geByClass1("im-audio-message-input",cn),nn=geByClass1("audio-msg-track--duration",tn),an=geByClass1("audio-msg-track--wave",tn),sn=geByClass1("im-audio-message--cancel-btn",tn),on=geByClass1("_im_audio_send",tn),ln=geByClass1("audio-msg-track--btn",tn),geByClass1("im-chat-input--text",cn);var e=geByClass1("im-chat-input--textarea",cn);addClass(e,"_voice_field_wrap"),addEvent(rn,"click",wn),addEvent(sn,"click",Ln),addEvent(on,"click",Pn),addEvent(ln,"click",Nn)}function Rn(){!function(){yn&&removeEvent(yn,"progress",Tn);removeEvent(rn,"click",wn),removeEvent(sn,"click",Ln),removeEvent(on,"click",Pn),removeEvent(ln,"click",Nn)}(),un=tn=nn=an=rn=sn=on=ln=null}function Bn(e,t,n){return{cancelRecording:Ln,start:function(){wn()},unmount(){Ln(!1),Rn()}}}function Fn(e,t,n,a,r){return dn=t,hn=t.get().audio_msg,_n=jn.bind(null,t),mn=n,pn=r,Object(fn.initFailBack)(),Object(s.getAvailableMicrophones)().then(e=>{var n=e.length>0;n?(Dn(),a()):setCookie("remixvoice","0",7),t.set(i.setVoiceMessageAvail.bind(null,n))}).catch(e=>{throw setCookie("remixvoice","0",7),e}),(0,Object(f.createMutations)(Bn).bindMutations)(e,t,n)}var Hn=n("6aSF"),Un=n("Ht+d"),Gn=n("N4ZS"),qn=n("Egk5");function Kn(){return(Kn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Vn(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class Wn extends Je.Component{constructor(){super(...arguments),this.onLinkClick=e=>{var t=this.props.action.link;if(/^https:\/\/(.+\.)?vk\.com\/gifts580392144\?act=send&ref=[^&]+$/.test(t))return Object(ze.showBox)("al_gifts.php",{act:"get_gift_box",mid:580392144,fr:0,ref:t.split("&ref=")[1]},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(qn.cancelEvent)(e)},this.onButtonClick=()=>{var e=this.props,t=e.action,n=e.sendMessage,a=e.appHash,r=e.keyboardAuthorId;return Object(We.handleButtonClick)(t,n,a,r)}}render(){var e=this.props,t=e.action,n=(e.sendMessage,e.appHash,e.keyboardAuthorId,Vn(e,["action","sendMessage","appHash","keyboardAuthorId"])),a=Object(We.getButtonAppearance)(this.props),r=Object(We.getButtonLabel)(this.props),i=t.type,s=Je.createElement(Un.default,Kn({wide:!0,overflow:!0},n,{type:t.type,appearance:a,className:"BotButton BotButton--"+i,onClick:this.onButtonClick}),Je.createElement("span",{className:"BotButtonLabel Button--overflow",dangerouslySetInnerHTML:{__html:r}}));switch(t.type){case We.BUTTON_TYPE_OPEN_LINK:return this.wrapLinkButton(s);default:return s}}wrapLinkButton(e){var t=this.props.action,n=Object(Gn.wrapAwayIfExternal)(t.link,!0);return Je.createElement("a",{href:n,className:"Keyboard__buttonWrapper",target:"_blank",rel:"nofollow noopener",onClick:this.onLinkClick},e)}}Wn.defaultProps={color:We.BUTTON_COLOR_DEFAULT};var $n=Wn;class zn extends Je.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props.store,t=this.props.send,n=e.get(),a=Object(o.getCurrentKeyboard)(e),r=n.keyboard_app_hash;return a&&a.buttons?Je.createElement("div",{className:Object(Ye.classNames)("Keyboard",{"Keyboard--hidden":a.hide})},Je.createElement(Hn.default,{className:"Keyboard__scroll-wrapper"},Je.createElement("div",{className:"Keyboard__container"},a.buttons.map((e,n)=>Je.createElement("div",{key:"row-"+n,className:"Keyboard__row"},e.map((n,i)=>Je.createElement("div",{className:"Keyboard__button",key:"cell-"+i,style:{width:zn.getButtonWidth(e.length)}},Je.createElement($n,{sendMessage:t,appHash:r,keyboardAuthorId:a.author_id,action:n.action,type:n.action.type,color:n.color})))))))):null}}var Yn=Object(et.connect)(zn);function Qn(){return document.getElementById("_im_keyboard_container")}function Xn(e,t,n){return{init(){return new Promise(e=>{this.isMounted=!0,function(e,t,n){var a=Qn();if(a){var r=Je.createElement(et.default,{value:e},Je.createElement(Yn,{send:t}));Ze.render(r,a,n)}}(t,n,e)})},toggle:(e,n,a)=>t.set(i.toggleKeyboard.bind(null,e,n,a)),unmount(){var t=Qn();t&&this.isMounted&&Ze.unmountComponentAtNode(t),this.isMounted=!1,Object(f.destroyModule)(e)}}}var Jn=n("LYnS"),Zn=n("fD+e").default,ea=n("m5nf").default,ta=n("m5nf"),na=ta.MAIN,aa=ta.EDIT;function ra(e,t){return Object(Jn.default)().reduce((function(t,n){return t.replace(new RegExp("({"+n.id+"})","gi"),n.process(e))}),t).replace(/&lt;br&gt;/gi,"<br>")}function ia(e,t,n,a,r){var s;return{closeSettingsPopup:function(){s&&s.hide()},showSettingsPopup:function(e){var n=this,a={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:function(){var a=document.getElementById("TemplatesSettings");a&&Ze.render(Je.createElement(et.default,{value:t},Je.createElement(ea,{popup:s,section:e,getTemplates:function(){return Object(o.getTemplates)(t)},saveTemplate:n.saveTemplate.bind(n),deleteTemplate:n.deleteTemplate.bind(n),closePopup:n.closeSettingsPopup.bind(n)})),a),requestAnimationFrame((function(){return s.updateBoxCoords()}))}};(s=new ze.MessageBox(a).content('<div id="TemplatesSettings"></div>')).show()},applyTemplate:function(e){var n=Object(o.getTemplates)(t).find((function(t){return t.id===e}));Object(Ve.statlogsCommunityTemplatesClickEvent)(),a(ra(t,Object(u.prepareToWriting)(n.text)))},getPreparedTemplates:function(){return Object(o.getTemplates)(t).map((function(e){return Object.assign({},e,{name:e.name,text:ra(t,e.text)})}))},saveTemplate:function(e){var n=Object(u.decodeHTMLEntities)(e.name),a=Object(u.decodeHTMLEntities)(e.text);return t.set(e.id?i.updateTemplate.bind(null,e.id,n,a):i.createTemplate.bind(null,n,a))},deleteTemplate:function(e){return t.set(i.deleteTemplate.bind(null,e))},isNeedRenderTemplates:function(){return!!Object(o.getPeer)(t)&&(!!Object(o.isCommunityInterface)(t)&&(!(Object(o.getPeer)(t)>2e9&&Object($.doesChatTabHaveFlag)(Object(o.getCurrentTab)(t),1024))&&!Object(o.isCommunityChat)(t,Object(o.getPeer)(t))))},toggleImText:function(e){void 0===e&&(e=this.isNeedRenderTemplates()),r(e)},update:function(){this.toggleImText()},unmount:function(){this.toggleImText(!1)}}}function sa(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function oa(e,t){var n=t.queues[e].currEv;return n?(t.queues[e].errored.push(n),sa(e,t)):Promise.resolve(t)}function la(e,t,n){return n.queues[e]?(n.queues[e].errored=t?[]:n.queues[e].errored.concat(n.queues[e].evs),n.queues[e].evs=[],sa(e,n)):Promise.resolve(n)}function ca(e,t,n,a){var r=a.get().queues[e];if(r&&!r.currEv&&r.evs.length>0&&!r.pause){var i=ca.bind(null,e,t,n,a),s=r.evs.shift();r.currEv=s,t(e,s).then(()=>{a.get().opts.waitCommit||a.set(sa.bind(null,e))}).then(i).catch(t=>a.set(oa.bind(null,e)).then(()=>{n(e,function(e,t){var n=ma(e,t.get()).errored;return n.length>0&&n[n.length-1]}(e,a),t)}).then(i))}}function da(e,t,n){var a=n.queues[e];return a.errored.filter(e=>e.mess.messageId===t).forEach(e=>{e.failed=!1,a.evs.push(e)}),a.errored=a.errored.filter(e=>e.mess.messageId!==t),Promise.resolve(n)}function ua(e){var t=Date.now();return Object.keys(e.queues).forEach(n=>ga(n,e,t,18e5)),Promise.resolve(e)}function ga(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.queues[e],i=[];return r.errored.forEach(e=>{e.ts>=n-a?(e.failed=!1,r.evs.push(e)):i.push(e)}),r.errored=i,Promise.resolve(t)}function ma(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function pa(e,t,n){return ma(e,n).pause=t,Promise.resolve(n)}function _a(e,t,n){return t.ts=Date.now(),ma(e,n).evs.push(t),Promise.resolve(n)}function ha(e){Object.keys(e.get().queues).forEach(t=>{e.set(oa.bind(null,t)),e.set(la.bind(null,t,!1))})}function fa(e,t,n){var a=Object(E.default)({queues:{},debug:n&&n.debug,opts:extend({},n)},n);return n&&n.store?(a.setState(function(e){for(var t={},n=Object.keys(e.queues),a=n.length,r=0;r<a;r++){var i=n[r],s=e.queues[i];(s.currEv||s.evs.length||s.errored.length)&&(t[i]=s)}return{queues:t,opts:e.opts}}(a.get())),ha(a)):ha(a),{pushMessage:(n,r)=>a.set(_a.bind(null,n,r)).then(a=>{ca(n,e,t,a)}),resend(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a.set(da.bind(null,n,r)).then(()=>{var i=a.get().queues[n].evs.filter(e=>e.mess.messageId===r)[0];return ca(n,e,t,a),i})},resendAll:()=>a.set(ua).then(()=>{Object.keys(a.get().queues).forEach(n=>{ca(n,e,t,a)})}),resendPeer:n=>a.set(ga.bind(null,n)).then(()=>{ca(n,e,t,a)}),reset:n=>a.set(la.bind(null,n,!0)).then(a=>{ca(n,e,t,a)}),setErrored:(e,t)=>a.set(n=>(ma(e,n).errored=t,Promise.resolve(n))),pause(e){a.set(pa.bind(null,e,!0))},isPaused:e=>!!ma(e,a.get()).pause,complete(n,r){var i=a.get();i.queues[n].currEv&&i.queues[n].currEv.rid===r&&a.set(sa.bind(null,n)).then(()=>{ca(n,e,t,a)})},resume(n){a.set(pa.bind(null,n,!1)).then(Object(yt.pause)(.1)).then(()=>{ca(n,e,t,a)})},inspectQueue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!a.get().queues[e])return[];var n=a.get().queues[e];return(t&&n.currEv?[n.currEv]:[]).concat(n.evs.slice()).concat(n.errored.slice().map(e=>extend({},e,{failed:!0}))).sort((e,t)=>e.ts-t.ts)}}}var ba=n("hOuX"),va=n("QGEU"),ya=n("BJj/"),Oa=(n("Oyvg"),n("rCUf")),Ca="jpg jpeg png gif heic heif".split(" "),ja=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function Ea(e){var t=Ca.slice(0,Ca.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+Ca.join(",."):"mask"===e?Ca.join("|"):""}function Ta(e,t,n){var a=void 0!==t.ind?t.ind:t,r=t.fileName?a+"_"+t.fileName:t;if(re("upload"+r+"_progress_wrap"),e().unchoose(r),!geByClass1("popup_box_container")){var i=Object(c.getLang)("mail_add_doc_error");"wrong_music_file"===n?i=Object(c.getLang)("mail_upload_music_fail"):"wrong_arch_file"===n||"wrong_arch_mp3_file"===n?i=Object(c.getLang)("mail_upload_arch_fail"):"photo"===Upload.options[a].file_name?i=Object(c.getLang)("mail_add_photo_error"):"video_file"===Upload.options[a].file_name&&(i=Object(c.getLang)("video_upload_error")),setTimeout(Object(ze.showFastBox)({title:Object(c.getLang)("global_error")},i).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+a)||{}).action}),Upload.embed(a)}function Sa(e){var t=void 0!==e.ind?e.ind:e,n=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),a=n?t+"_"+n:e,r=ge("upload"+a+"_progress_wrap");return r&&hide(geByClass1("progress_x",r)),a}function wa(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var n="^("+Ea("mask")+")";return[].slice.call(t.items).every(e=>{var t=e.type.split("/");return new RegExp(n,"i").test(t[1])})?"photo":[].slice.call(t.items).every(e=>"video"===e.type.split("/")[0]||~ja.indexOf(e.type))?"video":"doc"}function Ia(e){var t=geByClass1("_im_upload_dropbox"),n=geByClass1("im-page--chat-header").getBoundingClientRect(),a=geByClass1("im-chat-input").getBoundingClientRect();(n.width<10||a.bottom-n.bottom<10)&&(e="none"),t.style.top=n.bottom+"px",t.style.left=n.left+1+"px",t.style.width=n.width-2+"px",t.style.height=a.bottom-n.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function ka(){geByClass1("_im_upload_dropbox").classList.remove("im-dropbox--visible")}function Ma(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function Aa(e,t,n,a){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),a().reHeight(n)}function La(e,t,n,a,r){var i=t.get().upload_opts,s=geByClass1("_im_upload_photo",r),o=geByClass1("_im_drop_photo",r);return Upload.init(s,i.url,i.params,{accept:Ea("accept"),file_name:"photo",file_size_limit:26214400,file_types:Ea("types"),file_match:i.opts.ext_re,lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:o,dragEl:bodyNode,onNoFilteredCallback(e){Upload.onFileApiSend(a,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var r=window.parseJSON(a);r.photos?function(e,t,n,a){var r=Sa(e);ajax.post("al_photos.php",extend({act:"choose_uploaded"},t),{onDone:function(e,t){a().choose("photo",e,extend(t,{upload_ind:r}))},onFail:Ta.bind(null,a,e)})}(e,r,0,n):Aa(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("photo",r,Ma(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_photo_fails",1,i.opts.server,t),Ta(n,e,t)},onDragEnter(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Ia(wa(n,e.dataTransfer))},onDragOut(){ka()},onDrop(){ka()}})}function Pa(e,t,n,a){var r=t.get().upload_doc_opts,i=geByClass1("_im_upload_doc",a),s=geByClass1("_im_drop_doc",a);return Upload.init(i,r.url,r.params,{file_name:"file",file_size_limit:209715200,file_types:"*.*;",lang:r.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:r.opts.server,error:r.opts.default_error,error_hash:r.opts.error_hash,dropbox:s,dragEl:bodyNode,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,a){var i=window.parseJSON(a);i.file?function(e,t,n,a){var r=Sa(e),i={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};n.opts.imhash&&(i=extend(i,{from_place:"from_gim",imhash:n.opts.imhash})),ajax.post("docs.php",extend(i,t),{onDone:function(e,t,n){a().choose("doc",e+"_"+t,extend(n,{upload_ind:r}))},onFail:Ta.bind(null,a,e)})}(e,i,r,n):Aa(e,a,t,n)},onUploadProgress(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("doc",r,Ma(e,t,a))},onUploadError(e,t){statlogsValueEvent("upload_doc_fails",1,r.opts.server,t),Ta(n,e,t)}})}function Na(e,t,n){removeEvent(bodyNode,"dragover dragenter");var a=geByClass1("_im_upload_dropbox"),r=Pa(0,t,n,a),s=function(e,t,n,a,r){var s=t.get().upload_video_params;if(s){var o=geByClass1("_im_upload_video",r),l=geByClass1("_im_drop_video",r);return s.options.visible_dropbox=!1,Object(Oa.getUploadModule)(o,l,s,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,a){var r=window.parseJSON(a);r.video_id?Object(Oa.onVideoUploaded)(e,r,t.get().textMediaSelector,(e,n)=>{var a=document.querySelector('[data-video="'+n+'"]'),r=e.editable.sizes.x[0]||e.thumb;if(a&&r){a.style.backgroundImage=`url(${r})`;var s=gpeByClass("_im_mess",a);"im"===cur.module&&s&&Object(i.updateVideoThumb)(t,s)}}):Aa(e,a,t,n)},onUploadProgress:function(e,t,a){var r=void 0!==e.ind?e.ind:e;n().progress("video",r,Ma(e,t,a))},onUploadError:function(e,t){statlogsValueEvent("upload_video_fails",1,s.options.server,t),Ta(n,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(a,e)},onDragEnter:function(e){var t=geByClass1("im-audio-message_recording");e.dataTransfer&&!t&&Ia(wa(n,e.dataTransfer))},onDragOut:function(){ka()},onDrop:function(){ka()}})}}(0,t,n,r,a),o=La(0,t,n,s,a);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var l=Object(f.createModule)({handlers:e=>{var t=ge("im_full_upload");e(t,"change",(function a(r){if(window.Upload&&r.target.files){if(n().canAddMedia()){var i=Array.from(r.target.files),d=i.filter(e=>Upload.checkFileType(e.name,Ea("types"))),u=i.filter(e=>Upload.checkFileType(e.name,Object(Oa.getUploadVideoExtMasks)("types")));Upload.onFileApiSend(o,d),Upload.onFileApiSend(s,u)}else Object(ze.showFastBox)(Object(c.getLang)("global_error"),Object(c.getLang)("global_error"));Object(f.destroyModule)(l);var g=t.cloneNode();g.value="",t.parentNode.replaceChild(g,t),e(t=g,"change",a)}}))}});return{paste(e){Upload.onFileApiSend(o,e)},unmount(){Object(f.destroyModule)(l),Upload.deinit(o),Upload.deinit(s),Upload.deinit(r)}}}var xa=n("wSs/"),Da=n("rudk"),Ra=n("g1O2");function Ba(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Ha(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function Ua(e){return e.map(e=>({id:e[1],type:e[0],kind:e[2]||null}))}function Ga(e,t,n,a,r,i){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(br(t,a))return Promise.resolve(!1);var l=Qa(a);l.getBoundAttach(n.message)&&(n.message=""),n.share_url=l.getShareUrl(),n.cancelled_shares=l.getCancelledShares();var c=Object(ba.random)(),d={peerId:t,messageId:"rid"+c,flags:b.FLAG_OUTBOUND,date:intval(Date.now()/1e3)-a.get().timeshift,subject:"",text:Object(s.replaceSpecialSymbols)(clean(n.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:a.get().gid?vk.id:null},type:b.ADD_MESSAGE,attaches:Ua(n.attaches)};return n.rid=c,n.mess=d,e(t,n),a.get().longpoll.push([d]),o&&i().clearText(t,a),r().newMessage(a),Promise.resolve(!0)}function qa(e,t,n,a,r,i,s){var o=arguments.length>7&&void 0!==arguments[7]&&arguments[7];o||(o=e.get().peer);var l=Qa(e),c=Ka(l,s),d=c?l.dData.attaches.map(e=>[e.type,e.id]):[],u={message:"",attaches:[].concat(d,i)};s&&extend(u,s),Va(e,t,!1).then(()=>Ga(n,o,u,e,t,a,!1).then(n=>(c&&or(e,r,t),Promise.resolve(n)))).catch(t=>{debugLog(t),Ya(e,r)})}function Ka(e,t){var n=e.dData,a=t&&t.sticker_referrer,r=a&&0===a.indexOf("suggestion"),i=t&&t.is_hintach_item;return(!n.txt.trim()||r||i)&&0===n.attaches.filter(e=>"reply"!==e.type).length}function Va(e,t,n){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(i.changePeer.bind(null,e.get().peer,!1,!1)).then(()=>e.set(i.loadPeer.bind(null,e.get().peer,!0,-1,!1))).then(()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),n))):Promise.resolve(n)}function Wa(e,t,n){var a=!!intval(domData(n,"val"));a!==cur.ctrl_submit&&(cur.ctrl_submit=a,e.set(i.changeSubmitSettings.bind(null,a)))}function $a(e,t,n,a){return!e.get().delayed_ts&&setTimeout(()=>{e.set(i.setDelayedMessage.bind(null,!1,!1)).then(()=>{n(...a)})},t)}function za(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(c.getLang)("mail_send_error"),t=Object(c.getLang)("global_error");Object(ze.showFastBox)({title:t},e,Object(c.getLang)("mail_ok"),()=>{nav.reload({force:!0})})}function Ya(e,t){document.activeElement&&document.activeElement.blur(),za();var n=geByClass1("_im_send",t);return e.set(i.toggleSendingAbility.bind(null,!0)).then(()=>{Object(s.lockButton)(n)})}function Qa(e){return e.get().tfdraft||new Ot.ImDraft}function Xa(e,t,n,a,r,l){var c=Object(o.getPeer)(e),d=Object(o.getCurrentKeyboard)(e)||{},g=d.one_time,m=void 0!==g&&g,p=geByClass1("_im_send",a);return Promise.resolve().then(()=>{if(Object(o.isSendingAvailable)(e)){if(Object(i.isAnythingLoading)(e.get())||!Object(s.isFullyLoadedTab)(e,e.get().peer)){var a=$a(e,2e3,Xa,Object(h.toArray)(arguments));return e.set(i.setDelayedMessage.bind(null,!0,a)).then(()=>{Object(s.lockButton)(p)})}return clearTimeout(e.get().delayed_ts),e.set(i.setDelayedMessage.bind(null,!1,!1)).then(()=>Object(s.unlockButton)(p)).then(Va.bind(null,e,t)).then(()=>{var a=l.keyboardAuthorId,i=l.action||{},o=i.attaches||[],d=Object(u.decodeHTMLEntities)(i.payload||""),g=Object(u.decodeHTMLEntities)(i.label||"");Object(s.isChatPeer)(c)&&(g=`@${Object(W.oCacheGet)(e,a).link.slice(1)} ${g}`);return Object(V.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,c,a),Ga(n,c,{message:g,attaches:o,payload:d},e,t,r,!1)}).then(()=>m?e.set(i.deleteKeyboard.bind(null,c)):Promise.resolve()).then(()=>r().fixKeyboard())}}).catch(t=>{debugLog(t),Ya(e,a)})}function Ja(e,t,n,a,r,l){var d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return Promise.resolve().then(()=>{var u=geByClass1("_im_send",a);if(!Object(o.isSendingAvailable)(e))return!1;if(Object(i.isAnythingLoading)(e.get())||!Object(s.isFullyLoadedTab)(e,e.get().peer)){var g=$a(e,2e3,Ja,Object(h.toArray)(arguments));return e.set(i.setDelayedMessage.bind(null,!0,g)).then(()=>{Object(s.lockButton)(u)})}clearTimeout(e.get().delayed_ts),r().saveText(e);var m=!1,p=Qa(e),_=p.dData.attaches.map(e=>{if("poll"==e.type){var t=l.pollData();return t||(m=!0),[e.type,e.id,t]}return[e.type,e.id]}).concat(d);if(m)return!1;var f=e.set(i.setDelayedMessage.bind(null,!1,!1)).then(()=>{Object(s.unlockButton)(u)}),v=Object(o.getPeer)(e);return f.then(Va.bind(null,e,t)).then(()=>{var i=p.dData.txt,o=t().getEditingMessage();if(o||i||_.length){if(o)return i||_.length&&!p.hasOnlyReplies(o)?Object(s.isMessageTooLong)(i)?void Object(ze.showFastBox)(Object(c.getLang)("global_error"),Object(c.getLang)("mail_err_edit_too_long")):(t().cancelEditing(),void(Object(xa.wasMessageReallyModified)(e,o,p)&&(Object(xa.replaceMsgAfterEdit)(e,o,i,_,p.getShareUrl(),p.getCancelledShares()),t().sendEditMessage(e,o),e.get().longpoll.push([b.editMessageLocallyEvent(o)])))):void Za(e,t,a,o.messageId);var l=Object(s.splitMessageToParts)(i,_).map(a=>Ga(n,v,{message:a.msgText||"",attaches:a.attaches||[]},e,t,r));return Promise.all(l)}})}).catch(t=>{debugLog(t),Ya(e,a)})}function Za(e,t,n,a){var r=e.get(),s=r.peer,o=Object(ze.showFastBox)({title:Object(c.getLang)("mail_dialog_msg_delete_title"),dark:1},Object(c.getLang)("mail_dialog_msg_delete_for_all"),Object(c.getLang)("mail_delete"),(function(e){Object(i.removeMessageSend)([a],s,null,"deleteforall",r),o.hide(),t().cancelEditing()}),Object(c.getLang)("global_cancel"),(function(){o.hide(),rr(geByClass1("_im_text",n))}))}function er(e,t,n){return e.set(i.deliverMessage.bind(null,t,n,{}))}function tr(e,t,n,a){e.get().longpoll.push([b.failedMessage(t,n.mess,a)])}function nr(e,t,n,a,r,l,c,d,u){var g,m=Object(ya.debounce)(vr.bind(null,e,n),500);var p=Emoji.init(geByClass1("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>Er(e,t).then(e=>e&&a([])),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(n,a){var r=e.get().peer,l=Emoji.val(a);Object(s.isReservedPeer)(r)||br(r,e)||Qa(e).dData.txt==l||!l||function(e){var t=e.get().peer;Object(s.isFullyLoadedTab)(e,t)&&!Object(o.isAnyMessageBeingEdited)(e)&&Date.now()-(Object(o.getTab)(e,t).lastTyping||0)>1e3*i.ACTIVITY_PERIOD&&e.set(i.sendTyping.bind(null,t))}(e),Tr(e,t,l),m(a);var c=t.offsetHeight;if(g&&g!==c){var u=d().updateScroll();d().scrollFix(e,e.get().peer,u)}g=c},onStickerSend:(e,t,n)=>r([["sticker",e,n]],{sticker_referrer:t}),onHintachSend:(e,t)=>l([[e,t]],{is_hintach_item:!0}),uploadActions:c,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){u().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(p),e.setState({emojiOptId:p}),p}function ar(e,t,n){var a=Emoji.val(geByClass1("_im_text",t));Object(o.isAnyMessageBeingEdited)(e)&&""!==a||Er(e,t).then(t=>{var r=intval(domData(n.target,"tttype"));(2===r&&!0!==t||1===r&&!0===t||3!==r&&""===a)&&window.tooltips&&tooltips.destroy(n.target,{fasthide:!0});var i=Qa(e).dData.attaches.length>0;if(Object(o.isAnyMessageBeingEdited)(e)&&""===a&&!i)return domData(n.target,"tttype",3),Object(d.showTooltip)(n.target,{text:Object(c.getLang)("mail_delete_for_all"),black:!0,force:3!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return domData(n.target,"tttype",1),Object(d.showTooltip)(n.target,{text:Object(c.getLang)("mail_added_audiomsg"),black:!0,force:1!==r,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});domData(n.target,"tttype",2);var s=e.get().ctrl_submit?1:0;return Object(d.showTooltip)(n.target,{text:getTemplate("ctrl_submit_hint",{enter_on:s?"":"on",ctrl_on:s?"on":""}),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==r,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:Object(h.toArray)(geByClass("_im_submit_btn")),val:s}}})})}function rr(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function ir(e,t,n,a){var r=e.getFwdRaw(),i=t.querySelector("._im_media_fwd"),d=t.parentNode.querySelector("._im_replied_content");if(!(Object(o.getCurrentKeyboard)(a)||{}).hide&&r&&n.toggleKeyboard(!0),i.innerHTML="",d.innerHTML="",r){var u=function(e,t){if(e.get().isEditing){var n=Object(s.getNowEditingMessage)(e);return n&&Object(l.hasReply)(n)}return"reply"===t.type}(a,r),g=u?d:i,m=r.object;g.innerHTML=u?sr(m):function(e,t,n,a){if(n.object&&n.object.authorName){var r=Object(s.renderShortText)(0,"",a.text,!0,Object(Da.convertKludgesToAttaches)(a.kludges,0));return getTemplate("im_attach_mess",{messages:r,text:a.authorName,date:getSmDate(a.date,e.get().timeshift),modifier:"im-fwd_msg"})}return getTemplate("im_attach_mess",{messages:Object(c.getLang)("mail_title_X_msgs",t.getFwdCount()),text:Object(c.getLang)("mail_im_fwd_msgs_title"),date:"",modifier:""})}(a,e,r,m)}}function sr(e){var t=Object(s.renderShortText)(0,"",e.text,!0,Object(Da.convertKludgesToAttaches)(e.kludges,0));return getTemplate("im_replied_message",{authorName:e.authorName,text:t})}function or(e,t,n){return e.set(i.forwardMessages.bind(null,null,Qa(e),!1)).then(()=>{var a=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content"),i=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");r&&r.children.length&&(r.innerHTML="",dr(e,n)),i&&i.children.length&&(i.innerHTML="",dr(e,n)),a&&a.children.length&&(a.innerHTML="",dr(e,n)),Tr(e,t)})}function lr(e,t,n){var a=Object(o.getPeer)(e);e.set(i.acceptMessageRequest.bind(null,a)).then(()=>{jr(e,a,t),n()}).catch(()=>za())}function cr(e,t,n){var a=Object(o.getPeer)(e);e.set(i.rejectMessageRequest.bind(null,a)).then(()=>{Object(s.isClassicInterface)(e)&&t(e),n(e,a),a===e.get().peer&&e.get().longpoll.push([b.resetPeer()])}).catch(()=>za())}function dr(e,t){var n=t().updateScroll();t().scrollFix(e,e.get().peer,n)}function ur(e,t,n,a){var r=e.get().peer,s=inArray(r,e.get().mutedPeers);e.set(i.toggleMutePeer.bind(null,r,!s,-1)).then(n().updateState.bind(null,r)),cancelEvent(a)}function gr(e,t,n,a){var r=e.get().peer;e.set(i.returnToChat.bind(null,r)).then(e=>e.set(i.getPinnedMessage.bind(null,r))).then(n().updateChatTopic.bind(null,r)),cancelEvent(a)}function mr(e,t,n,a,r,i,l,c){if("close"!==l&&"open"!==l&&"hide"!==l)throw new Error(`Action "${l}" not found`);var d=e.get(),u=Object(o.getCurrentKeyboard)(e);(Object(s.isCommunityInterface)(e)||!u||d.isEditing)&&(l="hide");var g="close"===l||"hide"===l,m=Promise.resolve();g||n.isMounted||(m=n.init());var p=!u&&"open"!==l;return m.then(()=>(toggleClass(t,"im-chat-input_open-keyboard",!g),toggleClass(t,"im-chat-input_close-keyboard",g&&"hide"!==l),toggleClass(a,"im_chat-input--keyboard-button_hidden","hide"===l),n.toggle(d.peer,g,i))).then(()=>{if(!p||c){var t=r().updateScroll();return r().scrollFix(e,d.peer,t)}})}function pr(e,t){if(Object(o.isAnyMessageBeingEdited)(e))return!1;var n=e.get();if(Object(s.isCommunityInterface)(e))return!1;if(!Object(o.getCurrentTab)(e).moneyTransferAvail)return!1;if(Object(s.isCommunityPeer)(t))return n.moneyTransferCommAvail;if(Object(s.isUserPeer)(t)){var a=inArray(t,n.moneyTransferExcept);return t!=vk.id&&!a&&!Object(s.isContactPeer)(t)}return!1}function _r(e,t){return!Object(o.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!Object(o.getCurrentTab)(e).moneyRequestAvail&&(!(!Object(s.isCommunityPeer)(t)&&!Object(s.isChatPeer)(t))||!!Object(s.isUserPeer)(t)&&(t!=vk.id&&!Object(s.isContactPeer)(t)))))}function hr(e,t,n,a,r,i,l,c,d,u,g,m,p,_,h,b){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[Object(o.getPeer)(e)])},toggleKeyboard(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!Object(o.getCurrentKeyboard)(e).hide,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return mr(e,a,m,g,i,n,t?"close":"open")},initKeyboard(){if(!e.get().peer||!Object(o.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[Object(o.getPeer)(e)];return mr(e,a,m,g,i,!0,t?"close":"open")},fixKeyboard(){var t,n=Object(o.getCurrentKeyboard)(e);return t=n?n.hide?"close":"open":"hide",mr(e,a,m,g,i,!0,t,!0)},hideKeyboard:()=>mr(e,a,m,g,i,!1,"hide"),restoreDraft(e,r,l){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1}));var c=e.get().peer,d={gift:Object(s.isGiftOptionAvailableForPeer)(e,c)&&!Object(o.isAnyMessageBeingEdited)(e),money:Object(s.isMoneyOptionAvailableForPeer)(e,c)&&!Object(o.isAnyMessageBeingEdited)(e),poll:Object(s.isChatPeer)(c)},u=geByClass1("ms_items_more",a);Object.entries(d).forEach(e=>{var t=Ba(e,2),n=t[0],a=t[1],r=geByClass1("ms_item_"+n,u);toggleClass(r,"ms_item--hidden",!a)});var g={im:!0,fromId:-Object(o.getGroupId)(e)||vk.id,peer:c,moneyTransfer:{request:_r(e,c),send:pr(e,c)}},m=e.get().emojiOptId;if(void 0===m?e.setState({suggestionsConfig:g}):Emoji.setSuggestionsConfig(m,g),Object(s.isReservedPeer)(c))return Promise.resolve();var p=Qa(e);return Emoji.val(n)!==p.dData.txt?function(e,t){Emoji.val(e,clean(t)),rr(e)}(n,p.dData.txt):rr(n),p.prepareObjects(e.get().gid,r&&r.messageId).then(()=>{if(!jr(e,c,n)&&c==e.get().peer){for(var r=p.dData.attaches,s=0;s<r.length;s++)t.chooseMedia(r[s].type,r[s].id,r[s].object||{});if(ir(p,a,this,e),l){var o=i().updateScroll();i().scrollFix(e,c,o)}Tr(e,a,p.dData.txt)}})},sendMessage(){r([])},sendMessageFromKeyboard(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xa.call(null,e,i,_,a,...n)},choose(e,n,a){t.chooseMedia(e,n,a)},updateChosenMedia(e,n,a){t.updateChosenMedia(e,n,a)},canAddMedia:()=>!t.hasRestrictingAttach()&&!br(e.get().peer,e),isEmpty:e=>!trim(Emoji.val(n))&&!Qa(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,n,a){t.showMediaProgress(e,n,a)},updateState(e){this.restoreKeyboard(),jr(e,e.get().peer,n)},focusOn(e){Emoji.editableFocus(n,!1,!0)},setDraft(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Object(o.getTab)(e,e.get().peer);Object($.doesChatTabHaveFlag)(a,1024)&&!e.get().gid||(p&&p.update(),e.setState({tfdraft:t}),t&&this.restoreDraft(e,i().getEditingMessage(),n))},clearText(e,r){Qa(r).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(n,""),or(r,a,i);var s=i().updateScroll();i().scrollFix(r,r.get().peer,s)},attachMessages(e,t){if(e.get().peer===t){ir(Qa(e),a,this,e);var n=i().updateScroll();i().scrollFix(e,t,n),Tr(e,a)}},detachMessages(t){var n=Qa(e).getFwdRaw();if(n&&!!n.id.split(";").find(e=>Math.abs(e)===t.messageId))return or(e,a,i).then(()=>{var t=i().updateScroll();i().scrollFix(e,e.get().peer,t)});return Promise.resolve()},cancelRecording(){u.cancelRecording()},reHeight(e){var t=i().updateScroll();i().scrollFix(e,e.get().peer,t)},isBlocked:()=>br(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers(e.get().emojiOptId,!t)},saveText(e){Qa(e).setText(Emoji.val(geByClass1("_im_text",a)))},resendAll(){h()},resendPeer(){b(e.get().peer)},unmount(){Object(f.destroyModule)(d),t.destroy(),c.unmount(),m.unmount(),p&&p.unmount(),Emoji.destroy(e.get().emojiOptId),u.unmount()}}}function fr(e,t){return!!Object(s.isChatPeer)(e)&&t.get().tabs[e].data.kicked}function br(e,t){return fr(e,t)||Object(o.getTab)(t,e)&&Object(o.getTab)(t,e).block_error>0||Object(s.isLocksAvailable)(t)&&Object(s.isPeerBlocked)(e,t)}function vr(e,t,n){var a=e.get().peer,r=Emoji.val(n);Object(s.isReservedPeer)(a)||Qa(e).dData.txt==r||br(a,e)||(t.checkMessageURLs(r,!0,2e3),Qa(e).setText(r))}function yr(e){var t=Qa(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Or(e,t){e.disabled=!0,e.contentEditable="false",addClass(e,"im-chat-input--text_disabled"),addClass(t,"im-chat-input_error"),addClass(geByClass1("_im_page_history"),"is_tf_blocked")}function Cr(e,t){e.disabled=!1,e.contentEditable="true",removeClass(e,"im-chat-input--text_disabled"),removeClass(t,"im-chat-input_error"),removeClass(geByClass1("_im_page_history"),"is_tf_blocked")}function jr(e,t,n){var a=gpeByClass("_im_chat_input_parent",n),r=geByClass1("_im_chat_input_error",a),i=Object(o.getTab)(e,t);if(br(t,e)){Or(n,a);var l=function(e,t,n){switch(n.block_error){case 7:case 5:return Object(c.getLang)("mail_peer_deleted");case 14:return Object(c.getLang)("mail_community_deleted");case 11:return Object(c.getLang)("mail_group_banned_messages");case 4:case 6:case 9:case 19:case 20:case 13:return Object(s.isCommunityPeer)(t)?Object(c.getLang)("mail_send_privacy_community_error"):Object(c.getLang)("mail_send_privacy_error");case 23:var a=Object(W.oCacheGet)(e,t);return langSex(a.sex,Object(c.getLang)("mail_blacklist_user","raw")).replace("{user}",a.kick_name);case 12:return Object(c.getLang)("mail_cant_send_messages_to_community");case 16:return Object(c.getLang)("mail_chat_youre_kicked");case 26:return Object(c.getLang)("mail_chats_is_disabled");case 0:if(fr(t,e))return Object(c.getLang)("mail_chat_youre_kicked");var r=e.get().block_states[t].name;return Object(c.getLang)("mail_community_answering").replace("{username}",r);default:return Object(c.getLang)("mail_send_privacy_error")}}(e,t,i);if(Object(o.isChannelPeer)(i)&&addClass(geByClass1("_im_page_history"),"is_channel"),Object(s.isFvkcomgroup)(e,t)&&!e.get().gid){addClass(a,"is-f-vkcomgroup");var d=inArray(t,e.get().mutedPeers);l=Object(o.isChatActive)(i)?getTemplate("sImPeerMuteUnmute",{text:d?Object(c.getLang)("mail_im_unmute"):Object(c.getLang)("mail_im_mute"),cls:d?"im-action_unmute":"im-action_mute"}):getTemplate("sImPeerReturnToChat",{text:Object(c.getLang)("mail_return_to_vkcomgroup")})}else removeClass(a,"is-f-vkcomgroup");return val(r,l),!0}return i&&Object(s.tabIsMessageRequest)(i)?(Or(n,a),addClass(a,"is-message_request"),val(r,getTemplate("sImPeerAcceptOrRejectMessageRequest",{cls_accept:"_mr_button_accept",cls_reject:"_mr_button_reject"})),!0):(a.classList.contains("is-message_request")&&(Cr(n,a),removeClass(a,"is-message_request"),val(r,"")),n.disabled&&(removeClass(a,"is-f-vkcomgroup"),removeClass(geByClass1("_im_page_history"),"is_channel"),Cr(n,a),removeClass(a,"is-message_request"),val(r,"")),!1)}function Er(e,t,n){return Object(s.isVoiceMessageAvailable)(e).then(a=>{if(!a&&!Object(o.isAnyMessageBeingEdited)(e))return!0;var r=null!=n?n:Emoji.val(geByClass1("_im_text",t));if(trim(r))return!Object(o.isAnyMessageBeingEdited)(e)||!Object(s.isMessageTooLong)(r);var i=Qa(e),l=Object(s.getNowEditingMessage)(e);return i.hasAttaches()&&!i.hasOnlyReplies(l)})}function Tr(e,t,n){var a=geByClass1("_im_send",t.parentNode);Ha(a,{fasthide:!0}),Er(e,t,n).then(t=>{if(Object(o.isAnyMessageBeingEdited)(e))toggleClass(a,"is_input_empty",!t),attr(a,"aria-label",Object(c.getLang)("mail_im_edit"));else{toggleClass(a,"im-send-btn_audio",!t),toggleClass(a,"im-send-btn_send",t),t&&removeClass(a,"im-send-btn_saudio");var n=t?Object(c.getLang)("mail_send2"):Object(c.getLang)("mail_added_audiomsg");attr(a,"aria-label",n)}})}function Sr(e,t,n,a,r){cur.share_timehash=t.get().share_timehash;var l=Object(f.createMutations)(hr),u=l.callMutations,g=l.bindMutations,m=Na(0,t,u),p=er.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var _=fa(p,tr.bind(null,t),{store:"ls",key:"im_send_queue_"+vk.id,waitCommit:!0}),h=_.pushMessage,v=_.inspectQueue,y=_.resend,O=_.resendAll,C=_.resendPeer,j=_.setErrored,E=_.complete,T=qa.bind(null,t,r,h,u,e),S=qa.bind(null,t,r,h,u,e),w=yr.bind(null,t);hide(geByClass1("ms_items_more_helper",e));var I=t.get().mediaTypes||[["photo",Object(c.getLang)("mail_added_photo")],["video",Object(c.getLang)("profile_wall_video")],["audio",Object(c.getLang)("profile_wall_audio")],["doc",Object(c.getLang)("profile_wall_doc")],["map",Object(c.getLang)("profile_wall_map")],["gift",Object(c.getLang)("profile_wall_gift")]];(t.get().moneyTransferAvail||t.get().moneyRequestAvail)&&I.push(["money",Object(c.getLang)("profile_wall_money")]);var k=new MediaSelector(geByClass1("_im_media_selector",e),"_im_media_preview",I,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(n,a,s,o){return n&&u().toggleKeyboard(!0),function(e,t,n,a,r,s,o,l,c){if(!t.get().removingMedias){if("album"===r||"page"===r||"mail"===r||"reply"===r)return!1;if("share"===r&&!o.title)return!1;var d,u;s&&"string"==typeof r?(l&&Qa(t).addBindUrl(l,r,s),Qa(t).addAttach(r,s,o)):(Qa(t).syncWithSelector(c),"number"==typeof s&&c.chosenMedias[s]&&(d=c.chosenMedias[s],u=Qa(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&u.dData.cancelled.push(`${d[0]},${d[1]}`)));var g=e().updateScroll();if(e().scrollFix(t,t.get().peer,g),t.get().delayed_message&&!Object(i.isAnythingLoading)(t.get()))return n([]),!1;Tr(t,a)}}(r,t,M,e,n,a,s,o,k)},onMediaChange:function(){return function(e,t,n,a,r){if(!t.get().removingMedias){var i=r.getMedias().find(e=>"poll"===e[0]);i&&Qa(t).addAttach(i[0],i[1],r.pollData(!0,!0)),Tr(t,a)}}(0,t,0,e,k)},editable:1,onChangedSize:function(){var n,a,i=r().updateScroll();r().scrollFix(t,t.get().peer,i),n=e,a=ge("_im_media_preview").offsetHeight,toggleClass(n,"im-chat-input--overflowed",a>400)},sortable:1,teWidth:150,mail:1,teHeight:100,forceToUp:!0,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}}),M=Ja.bind(null,t,r,h,e,u,k),A=ar.bind(null,t,e),L=geByClass1("_im_send",e),P=qa.bind(null,t,r,h,u,e),N=Fn(e,t,P,()=>{addClass(L,"im-send-btn_audio"),removeClass(L,"im-send-btn_static")},()=>{u().restoreKeyboard()});!function(e,t){var n=geByClass1("_im_text",e),a=Object(yt.promisify)(stManager.add);(window.Wall?Promise.resolve():a(["page.js"])).then((function(){Wall.initComposer(n,{lang:{introText:Object(c.getLang)("profile_mention_start_typing"),noResult:Object(c.getLang)("profile_mention_not_found")},toup:!0,getValue:()=>t.get().peer>2e9?(window.Emoji&&Emoji.editableVal||val)(n):"",onShow:()=>{addClass(e,"im_mention_shown");var t=data(n,"composer");if(t&&t.wdd&&t.wdd.shown){var a=0,r=!1,i=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,val(t.wddInput,""),Composer.toggleSelectList(t)};each(t.wdd.shown,(function(){this[0]&&(a++,"@"+t.curTerm==this[2]&&(r=!0))})),!a||r&&1==a?i():cancelStackPush("im_mention",i)}},onHide:()=>{removeClass(e,"im_mention_shown"),cancelStackFilter("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=k,t.set(i.initTextStore.bind(null,v,y,j,E));var x=geByClass1("_im_text",e);setTimeout(()=>{Object(o.getPeer)(t)&&u().setDraft(t,Object(o.getTabDraft)(Object(o.getCurrentTab)(t))),nr(t,e,k,M,T,S,m,r,u)},0);var D=or.bind(null,t,e,r),R=lr.bind(null,t,x,()=>{var e=r().updateScroll();r().scrollFix(t,Object(o.getPeer)(t),e)}),B=cr.bind(null,t,n,a),F=ur.bind(null,t,e,r),H=gr.bind(null,t,e,r),U=Wa.bind(null,t);jr(t,t.get().peer,x);var G=e.querySelector("._im_keyboard_button"),q=function(e,t,n,a,r){return(0,Object(f.createMutations)(Xn).bindMutations)(Object(f.createModule)({handlers:(e,t)=>{}}),t,a)}(0,t,0,Xa.bind(null,t,r,h,e,u)),K=Object(s.isCommunityInterface)(t)?function(e,t,n,a){var r=(0,Object(f.createMutations)(ia).bindMutations)(Object(f.createModule)({handlers:function(){}}),e,t,n,a);if("function"!=typeof r){r.toggleImText();var i=Je.createElement(et.default,{value:e},Je.createElement(Zn,{getTemplates:r.getPreparedTemplates,applyTemplate:r.applyTemplate.bind(r),isNeededRendering:r.isNeedRenderTemplates,showSettingsPopup:r.showSettingsPopup.bind(r,na),showCreatingTemplatePopup:r.showSettingsPopup.bind(r,aa)}));Ze.render(i,t)}return r}(t,e.querySelector("._message_templates_container"),e=>Object(Ra.setHTML)(x,e),t=>toggleClass(e,"im-chat-input--textarea_show-templates",t)):null,V=Object(f.createModule)({handlers:(n,a)=>{n(L,"click",()=>{Promise.resolve().then(()=>Er(t,e)).then(e=>{if(e||Object(o.isAnyMessageBeingEdited)(t))M([]);else{var n=Qa(t);Ka(n)&&function(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),n=e.getFwdRaw();if(n){var a=n.object;t&&(t.innerHTML=sr(a))}else t.innerHTML=""}(n),Ha(L,{fasthide:!0}),N.start(),setTimeout(()=>removeClass(L,"im-send-btn_saudio"),300)}})}),n(L,"mouseover",A),n(x,"focus",()=>{t.get().longpoll.push([b.transitionEvent("message")]),cur.focused=t.get().peer}),n(x,"blur",()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([b.transitionEvent(e)]),cur.focused=!1}),n(G,"click",()=>u().toggleKeyboard(void 0)),n(G,"mouseover",()=>{Object(d.showTooltip)(G,{text(){var e=Object(o.getCurrentKeyboard)(t);return!e||e.hide?Object(c.getLang)("mail_show_keyboard"):Object(c.getLang)("mail_hide_keyboard")},black:!0,shift:[4,5]})}),a(e.parentNode,"click","_im_peer_mute_unmute",F),a(e.parentNode,"click","_im_peer_return_to_chat",H),a(e.parentNode,"click","_im_remove_replied",D),a(e.parentNode,"click","_mr_button_accept",R),a(e.parentNode,"click","_mr_button_reject",B),a(e,"click","_im_fwd_close",D),a(e,"click","_im_will_fwd",w),a(e,"keydown","_im_text",e=>function(e,t,n,a){if(38===a.which&&n().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!Object(va.hasAccessibilityMode)()&&!Object(i.isAnythingLoading)(e.get())){var r=Object(xa.findLastMessageToEdit)(e,Object(o.getCurrentTab)(e));r&&t().startEditing(Object(o.getMessage)(e,e.get().peer,r))}}(t,r,u,e)),a(bodyNode,"click","_im_submit_btn",U)}}),W=g(t,k,x,e,M,r,v,m,V,N,G,q,K,h,O,C);return W.initKeyboard(),W}function wr(e,t,n,a,r,i){return{focus(e){uiSearch.focus(t),function(e,t,n,a){cancelStackPush("im_hist_search",Lr.bind(null,e,t,n,a))}(e,t,n,a)},changePeer(e,n){uiSearch.getFieldEl(t).value=n.get().tabs[e].searchText||""},search(){i({})},unmount(){Object(f.destroyModule)(r),cancelStackFilter("im_hist_search"),a.then(e=>e.destroy())}}}function Ir(e,t,n,a){e.set(i.setCurrentSearchDate.bind(null,e.get().peer,`${a.d}.${a.m}.${a.y}`)).then(Mr.bind(null,e,t,n))}function kr(e,t){e.then(e=>{triggerEvent(geByClass1("datepicker_control",t),"mousedown",!1,!0)})}function Mr(e,t,n){var a=e.get().peer;uiSearch.showProgress(n),Object(i.searchMessagesInplace)(a,e.get()).then(a=>{uiSearch.hideProgress(n),t().insertSearch(a,e)}).catch(()=>{uiSearch.focus(n),uiSearch.hideProgress(n)})}function Ar(e,t,n,a,r,s){if("keyup"!==s.type||13==s.which){var o=clean(uiSearch.getFieldEl(t).value);e.set(i.setCurrentSearch.bind(null,o,e.get().peer)).then(r.bind(null,e,a,t))}}function Lr(e,t,n,a){cancelStackFilter("im_hist_search"),a.then(e=>{e.hide()}),e.set(i.cancelSearch.bind(null,e.get().peer)).then(()=>{uiSearch.getFieldEl(t).value="",n().cancelSearch(e)})}function Pr(e,t,n,a){n.then(e=>{e.hide()}),e.set(i.clearDate.bind(null,e.get().peer)).then(Mr.bind(null,e,t,a))}function Nr(e,t,n){var a=geByClass1("_im_search_date_input",e),r=geByClass1("_im_search_history_input",e),i=function(e,t,n,a){var r='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+getLang("wall_clear_date_filter")+"</button></td>";return new Promise(e=>{stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(n,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+r+"</tr>",addRowsM:'<tr id="im_month_clear">'+r+"</tr>",onUpdate:a,pastActive:!0,noFuture:!0});e(t)}))})}(0,0,a,Ir.bind(null,t,n,r)),s=kr.bind(null,i,e),o=Ar.bind(null,t,r,a,n,Object(ya.debounce)(Mr,300)),l=Lr.bind(null,t,r,n,i),c=Pr.bind(null,t,n,i,r),d=Object(f.createModule)({handlers:(t,n)=>{t(geByClass1("_im_search_date",e),"click",s),t(uiSearch.getFieldEl(r),"keyup",o),t(geByClass1("_im_start_inplace_search",e),"click",o),t(geByClass1("_im_cancel_inplace_search",e),"click",l),n(e,"click","_im_clear_date",c)}});return wr(0,r,n,i,d,o)}function xr(e,t,n,a,r){var i=Object(s.getHistoryTopIndent)(e);Object(d.showTooltip)(t,{shift:[n,10],black:1,className:"_im_history_tooltip "+a,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>i+37,text:r})}function Dr(e,t,n){var a=gpeByClass("_im_mess",n),r=intval(domData(a,"msgid")),s=e.get().peer,c=Object(o.getMessage)(e,s,r),d=!Object(l.isImportant)(c);return e.get().longpoll.push([{peerId:s,messageId:r,type:d?b.SET_FLAGS:b.RESET_FLAGS,flags:b.FLAG_IMPORTANT}]),e.set(i.favMessage.bind(null,[r],d,s)),Rr(e,-10,t,n,!0),!1}function Rr(e,t,n,a,r){var i=domData(gpeByClass("_im_mess",a),"msgid"),s=Object(o.getMessage)(e,e.get().peer,i),c=getLang("mail_im_unmark_important"),d=getLang("mail_im_toggle_important"),u=Object(l.isImportant)(s)?c:d,g=u.length>16;r&&window.tooltips&&tooltips.destroy(a),xr(e,a,g?84:34,g?"im-star-tt_long":"im-star-tt",s?u:"")}function Br(e,t,n,a){var r=e.get().peer,o=+domData(domClosest("im-mess",a.target),"msgid");if(Object(s.canForwardMessages)(e,[o]))return Object(Ve.statlogsForwardFromChannel)(),Object(i.processFwd)([o],r,e).then(t=>e.set(i.prepareForward.bind(null,t))).then(()=>{Nt(0,e)}),!1}function Fr(e,t,n){var a=e.get().peer,r=+domData(domClosest("im-mess",n.target),"msgid");return Object(i.processFwd)([r],a,e).then(t=>e.set(i.forwardMessages.bind(null,t,e.get().tfdraft,!0))).then(()=>t().respond(e,a)),!1}function Hr(e,t,n,a){xr(e,a,18,"im-reply-tt",getLang("mail_im_mark_forward"))}function Ur(e,t,n,a){xr(e,a,18,"im-reply-tt",getLang("mail_im_reply"))}function Gr(e,t,n,a){var r=intval(domData(gpeByClass("_im_mess",a),"msgid")),i=Object(o.getMessage)(e,e.get().peer,r);return i&&t().startEditing(i),!1}function qr(e,t,n){xr(e,n,18,"im-edit-tt",getLang("mail_im_edit"))}function Kr(e,t,n){var a=Rr.bind(null,t,0),r=Dr.bind(null,t),i=Hr.bind(null,t,0),o=Br.bind(null,t,e.querySelector("_im_dialog_actions"),n),l=Ur.bind(null,t,0),c=Fr.bind(null,t,n),d=qr.bind(null,t),u=Gr.bind(null,t,n),g=Object(f.createModule)({handlers:(t,n)=>{n(e,"click","_im_mess_fav",r),n(e,"mouseover","_im_mess_fav",a),n(e,"click","_im_mess_forward",o),n(e,"mouseover","_im_mess_forward",i),n(e,"click","_im_mess_reply",c),n(e,"mouseover","_im_mess_reply",l),n(e,"click","_im_mess_edit",u),n(e,"mouseover","_im_mess_edit",d)}});return function(e,t){return{markImportant(t,n,a){Object(s.updateStar)(t,n,e)},unmount(){Object(f.destroyModule)(t)}}}(e,g)}function Vr(e,t,n,a,r){if(!Object(i.isSearchingInplace)(e.get().peer,e.get())&&!(hasClass(r,s.FAILED_CLASS)||hasClass(r,s.SENDING_CLASS)||hasClass(r,"_im_mess_srv")||Object(s.checkSelectClick)(a,r)||Object(o.isAnyMessageBeingEdited)(e)||"A"===a.target.tagName||domClosest("_im_replied_message",a.target)||a.target.classList.contains("_im_retry_media")||a.target.closest("."+s.MESSAGE_KEYBOARD_BUTTON_CLASS))){var l,c,d=intval(domData(r,"msgid")),u=e.get().peer;if(!Object(s.isAlreadyDeleted)(e,u,d))l=a.shiftKey?Object(o.getMessageRangeFromSelection)(e,u,d):[d],e.set(i.addSelection.bind(null,l)).then(()=>{var a=Object(o.getSelectedMessages)(e),r=!1;l.forEach(e=>{var t=geByClass1("_im_mess_"+e,n);if(t){var i=inArray(e,a);r|=i,toggleClass(t,"im-mess_selected",i);var s=i?getLang("mail_deselect_message"):getLang("mail_select_message"),o=geByClass1("_im_mess_blind_label_select",t);attr(o,"aria-label",s)}}),r&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)}).then(()=>{1!==e.get().selectedMessages.length||c?c&&c.hide():c=function(e){var t=e.get();if(t.pinnedMessagesPromo&&Object(s.isChatPeer)(t.peer)){var n=geByClass1("_mess-action-promo"),a=new ElementTooltip(n,{autoShow:!1,appendTo:n,content:getTemplate("im_pinned_messages_promo",{content:getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),Object(i.hidePromoTooltip)()}});return a.show(),a}}(e)})}}function Wr(e,t,n){var a=Vr.bind(null,t,n,e),r=Object(f.createModule)({handlers:(t,n)=>{n(e,"click","_im_mess",a)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map(t=>geByClass1("_im_mess_"+t,e)).filter(e=>e).forEach(e=>removeClass(e,"im-mess_selected"))},unmount(){Object(f.destroyModule)(t)}}}(e,r)}function $r(e,t,n){var a=n.get(),r=a.observer,i=a.targets;i.length&&i.forEach(r.unobserve.bind(r));var s=function(e,t){var n=e.get().peer,a=Object(o.getTab)(e,n);return Object(o.isFullyLoadedTab)(e,n)?Object.keys(a.msgs).reduce((e,n)=>{var r=a.msgs[n],i=t||document;if(Object(l.isUnread)(a,Object(o.parserMessage)(r))){var s=i.querySelector("._im_mess_"+n);s&&e.push(s)}return e},[]):[]}(e,t);n.setState({targets:s}),s.length&&s.forEach(r.observe.bind(r))}var zr=n("Syd7");var Yr={onNewMessagesChunk:function(e){var t=geByClass("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach(e=>LongView.register(e,"im"))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}};function Qr(){return(Qr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Xr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Zr(e,t,n,a){var r=e instanceof Array?e:geByClass("_im_bar_date",e),i=t.contHeight();Yr.onNewMessagesChunk();var s=r.reduce((e,t)=>(e[domData(t,"date")]=[t.offsetTop+10,i,t],e),{}),o=!n&&a.barMap?a.barMap:{};return a.barMap=extend(o,s),a.barMapKeys=Object.keys(a.barMap).sort(),Promise.resolve(a)}function ei(e,t){return t.barMapKeys.forEach(n=>{t.barMap[n][0]-=e}),Promise.resolve(t)}function ti(e,t,n,a,r){var i=e.get().barMap[t],o=Object(s.isClassicInterface)(r)?68:20;return n-(i[0]+n-i[1])+a-o}function ni(e,t,n,a){return a.barTransition=a.barMap[t][2],n>0?(addClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),addClass(e,"im-page--date-bar-transition-inverse")):n<0&&(removeClass(a.barMap[t][2],"im-page--date-bar-transition-inverse"),removeClass(e,"im-page--date-bar-transition-inverse")),addClass(a.barMap[t][2],"im-page--date-bar-transition"),addClass(e,"im-page--date-bar-transition"),Promise.resolve(a)}function ai(e,t){return t.barTransition&&(removeClass(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),removeClass(e,"im-page--date-bar-transition"),Promise.resolve(t)}function ri(e,t,n,a,r){var i,s,o=e.get(),l=n-t;o.barMapKeys.forEach(t=>{var o=ti(e,t,n,a,r);if(o>=l){var c=i?ti(e,i,n,a,r):n;i=c>o?t:i}else if(o<l){var d=s?ti(e,s,n,a,r):0;s=o>d?t:s}});var c={};return[[s,"prev"],[i,"cur"]].forEach(t=>{var i=Xr(t,2),s=i[0],o=i[1];s&&(c[o+"Bar"]=function(e,t){var n=e.get().barMap[t][2];return{text:n.textContent,date:domData(n,"date")}}(e,s),c[o+"Left"]=ti(e,s,n,a,r)-l)}),c}function ii(e,t,n,a,r){var o=e.get(),l=Object(i.isEverythingLoaded)(o),c=t.get(),d=r.scrollTop(),u=c.lastTop?c.lastTop-d:0;c.lastTop=d;var g=Object(Qe.isPinnedMessageVisibleInTab)(o,o.peer)?Object(s.getPinnedMessageHeight)(e):0,m=Object(i.isSearchingInplace)(o.peer,o)&&o.tabs[o.peer]&&o.tabs[o.peer].top_banner?50:0,p=(Object(s.isClassicInterface)(e)?68+g+m:0)-16,_=ri(t,d,r.contHeight(),p,e),h=_.prevBar,f=_.curBar,b=_.prevLeft,v="translateY(0px)",y=!1,O=!1,C=!1;f||l||(f=function(e){var t=geByClass1("_im_mess",e),n=domData(t,"ts");return t&&n?{text:getShortDate(intval(n),!1,!0,getLang("months_of","raw")),date:n}:null}(a)),f?y=f:O=!0,h&&f&&b>-32&&b<0&&(C=!0,O=!1,y=f,v=`translateY(${-32-b}px)`),y&&function(e,t){domData(e,"ts")!==t.date&&(e.innerHTML=t.text,domData(e,"ts",t.date),e.style.visibility="visible")}(n,y),C?t.set(ni.bind(null,n,h.date,u)):t.set(ai.bind(null,n)),v&&(n.style.transform=v),toggleClass(n,"im-page--top-date-bar_no-b",O)}function si(e,t){var n=geByClass1("_im_top_date_bar",t),a={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},r=Object(E.default)(a),i=null,s=null,o=null,l=Object(ya.debounce)(e=>{var n=r.get();Object.keys(n).length&&!n.isDisabled&&r.set(Zr.bind(null,t,e,!1))},500);return{reset(a){r.get().isDisabled||r.set(Zr.bind(null,t,a,!0)).then(ii(e,r,n,t,a))},disable(){r.setState(Qr({},a,{isDisabled:!0}))},enable(){r.setState({isDisabled:!1})},heightIncreased(e,t){r.get().isDisabled||(l(t),r.set(ei.bind(null,e)))},parseMore(a,i){r.get().isDisabled||r.set(Zr.bind(null,a,i,!1)).then(()=>{ii(e,r,n,t,i)})},toggle(e){r.get().isDisabled&&e||n.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){r.get().isDisabled||(s=Date.now(),o||(addClass(t,"im-page--top-date-bar_visible"),o=setInterval((function(){Date.now()-s>2e3&&(removeClass(t,"im-page--top-date-bar_visible"),clearInterval(o),o=null)}),100)))},update(a){r.get().isDisabled||(i&&(clearTimeout(i),i=null),i=setTimeout((function(){ii(e,r,n,t,a)}),300),ii(e,r,n,t,a))},unmount(){i&&(clearTimeout(i),i=null),o&&(clearInterval(o),o=null),r.unmount()}}}var oi=n("bIHZ"),li=n("uytb"),ci=n("S2bU"),di=n("t7n3"),ui=n("zxIV");function gi(e,t){var n=geByClass1("_im_dialog_actions",e);Object(ui.toggleClass)(n,"im-page--chat-header_top-banner",t)}function mi(e,t){var n=geByClass1("_im_top_banner_hide",e);n&&window.tooltips&&tooltips.hide(n),gi(e,!1),t.innerHTML=""}function pi(e,t,n){var a=geByClass1("_im_top_banner",e),r=Object(f.createModule)({handlers:(r,o)=>{var l=geByClass1("_im_dialog_actions",e);o(e,"click","_im_top_banner_hide",()=>{t.set(i.hideTopBannerAction.bind(null,t.get().peer)),mi(e,a);var r=!!Object(s.renderPinnedMessage)(t);Object(s.compensateHistoryHeightChange)(t,r,!0,n)}),o(e,"click","_im_top_banner_button",r=>{var o=function(e,t,n,a){var r=e.target,s=Object(ui.domData)(r,"payload");return s?(t.set(i.callbackTopBannerAction.bind(null,t.get().peer,s)),mi(n,a),!0):(r.classList.contains("_im_top_banner_button_gifts")&&(showBox("al_gifts.php",{act:"get_gift_box",mid:t.get().peer,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1}),Object(V.statlogsValueEvent)("gifts_im_birthday_banner","click",t.get().peer),e.originalEvent.preventDefault()),!1)}(r,t,e,a),l=!!Object(s.renderPinnedMessage)(t);Object(s.compensateHistoryHeightChange)(t,l,!o,n)}),o(l,"mouseover","_im_top_banner_hide",(e,t)=>{Object(d.showTooltip)(t,{text:getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:bodyNode})})}});return{renderPeer(t){var r=Object(o.getTab)(t,t.get().peer).top_banner,i=a.children.length;r&&!Object(o.isSearchShown)(t)?(gi(e,!0),a.innerHTML=function(e){var t=e.icon?Object(di.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",n=e.text;"employees_banner"===e.name&&(n=Object(ci.replaceHyperLinks)(n,ci.linksReplacer.bind(null,!1)),n=Object(ci.replaceMentions)(n));var a=(e.buttons||[]).map(e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return Object(di.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=" _im_top_banner_button_gifts",Object(di.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});default:return Object(di.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}});return a=a.concat([Object(di.getTemplate)("im_top_banner_hide_btn",{})]),Object(di.getTemplate)("im_top_banner",{text:n,icon:t,buttons:a.join("")})}(r),"birthday"===r.name&&Object(V.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer)):a.children.length&&mi(e,a);var l=a.children.length;Object(s.compensateHistoryHeightChange)(t,l,i,n)},unmount(){Object(f.destroyModule)(r)}}}var _i=n("cGUQ");function hi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return fi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var bi="im-audio-message_recorded",vi=!1,yi={};function Oi(e){return e.get().isMassMentionsMessageAllowed}function Ci(e){var t=Object(o.getTab)(e,e.get().peer);return!!Object(o.getPinnedMessage)(e)||!(!t||!t.top_banner)}function ji(e,t){var n=Object(h.unpackStore)(e),a=Object(o.getTab)(n,t);return Object(s.isChatPeer)(t)&&Object(Qe.isPinnedMessageVisibleInTab)(n,t)||!!a.top_banner&&!Object(o.isSearchShown)(t,n)}function Ei(e){return Object(s.getPinnedMessageHeight)(e)}function Ti(e,t,n){var a=n||window.clientHeight();return Math.min(a-15,Math.max(0,e,742+t.offsetTop))}function Si(e,t){var n=intval(domData(t.target,"msgid")),a=gpeByClass("_im_mess_"+n,t.target),r=geByClass1("_im_log_body",a),i=geByClass1("_im_mess_susp_cont",a);r.innerHTML=i.innerHTML}function wi(e,t){return geByClass1("_im_mess_"+t,e)}function Ii(e,t,n){var a,r,i,o,l,c,d,u,g,m=geByClass1(e,t);o={onStartDrag:(e,t)=>{addClass(bodyNode,"cursor_ns_resize"),a=t,r=t},onDrop:()=>{removeClass(bodyNode,"cursor_ns_resize")},onDrag:(e,i)=>{var o=Ti(r-a+i,t);Object(s.setClassicChatHeight)(o),n().fixHeight()}},d=function(e){l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onDrag&&o.onDrag.call(i,l,c)},u=function e(t){o.onDrop&&o.onDrop.call(i,l,c),removeEvent(document,"mouseup touchend mouseleave",e),removeEvent(document,"mousemove touchmove",d)},g=function(e){(1===e.which||e.touches&&e.touches[0])&&(addEvent(document,"mouseup touchend mouseleave",u),addEvent(document,"mousemove touchmove",d),l=void 0!==e.clientX?e.clientX:e.touches[0].clientX,c=void 0!==e.clientY?e.clientY:e.touches[0].clientY,o.onStartDrag&&o.onStartDrag.call(i,l,c),o.onDrag&&o.onDrag.call(i,l,c),cancelEvent(e))},(i=m).beginDragHandler=g,addEvent(i,"mousedown touchstart",g)}function ki(e,t){var n;n=geByClass1(e,t),removeEvent(n,"mousedown touchstart",n.beginDragHandler)}function Mi(e){e().hideError()}function Ai(e,t,n,a,r){if(checkEvent(a))return!0;var s=Object(_i.fromQueryString)(r.getAttribute("href")),o=intval(s.msgid);o&&e.set(i.changePeer.bind(null,e.get().peer,o,!1)).then(()=>Vi(n,t,o,e)),cancelEvent(a)}function Li(e,t,n){var a=Object(o.getTab)(t,n),r=Object(i.strHistory)(a.history);toggleClass(e,"im-page--history_empty-hist",!r)}function Pi(e,t,n,a){if(hasClass(n.target,"_im_mess_marker")){var r=n.target,i=Object(h.toArray)(geByClass(s.FAILED_CLASS,t));window.tooltips&&i.map(e=>geByClass1("_im_mess_marker",e)).filter(e=>e!==r).forEach(e=>tooltips.hide(e,{fasthide:!0}));var o=domData(a,"msgid");Object(d.showTooltip)(r,{content:getTemplate("im_failed_menu",{count:i.length,modifiers:Object(Ye.classNames)("im-settings_failed",{"im-settings_no_delete":o>0,"im-settings_single":1===i.length}),id:o}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function Ni(e){return geByClass1("_im_peer_history",e)}function xi(e,t){var n=t.contHeight(),a=e.scrollTop+(n-e.contHeight);t.scrollTop(a)}function Di(e,t,n,a,r,l,c,d,u){var g=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],m=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=(t.get().tabs||{})[n];r().hideError(),l.renderPeer(t),d.renderPeer(t),u.render(t);var _=Object(o.isCasperChat)(t,n);if(toggleClass(e,"im-page--history_casper",_),!t.get().tabHistoryNotChanged){l.reRenderTitle(t),Li(e,t,n);var h=Object(i.strHistory)(p.history);if(h){var f=geByClass1("_im_peer_history",e);val(f,h)}else r().showEmptyScreen();getAudioPlayer().isPlaying()&&getAudioPlayer().updateCurrentPlaying(),os(t,a,e)}if(Object(i.isSearchingInplace)(n,t.get())?r().showSearch(t):r().cancelSearch(t,!1),c.changePeer(n,t),t.get().msgid)Vi(a,e,t.get().msgid,t);else if(p.scrollBottom&&g){xi(p,a);var b=Object(s.isMessagesVisible)(t,e,a),v=hi(b,1),y=v[0];p.skipped||setTimeout(()=>{p.unread&&!y&&(zi(t,e,!0),Yi(t,e,!0)),Fi(t,a,e),Hi(t,a,e)},100)}else Ki(a,e,r,t,m)||a.scrollBottom(-30);window.LazyLoad&&window.LazyLoad.scan(!!a.scroll&&a.scroll.scroller)}function Ri(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=n||t.scrollTop(),r=t.scrollBottom(),s=t.contHeight(),o=e.get().peer;e.set(i.saveHistoryScroll.bind(null,o,a,r,s))}function Bi(){return $e.screenfull.isFullscreen}function Fi(e,t,n){var a=Object(o.isGoToMentionVisible)(e),r=Object(o.isGoToEndVisible)(e),i=t.getScrollHeight()/4,s=t.scrollTop()>0;t.scrollBottom()>i&&(!r||a)&&s&&zi(e,n,!0,40)}function Hi(e,t,n){if(Oi(e)){var a=t.getScrollHeight()/4,r=t.scrollTop()>0,i=Object(o.isGoToMentionVisible)(e);t.scrollBottom()>a&&!i&&r&&Yi(e,n,!0,40)}}function Ui(e,t,n,a,r,l,c,d){var u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];if((e.get().history_init||(e.get().history_init=!0,!(d.scrollTop()>0)))&&!Bi()){r.update(d),r.show();var g=e.get().peer;if(0!==g&&Object(s.isFullyLoadedTab)(e.get(),g)&&(Yr.onHistoryScroll(d.scrollTop()),!layers.visible)){var m=Object(o.getTab)(e,g);m&&!m.skipped&&d.scrollBottom()>40?(Fi(e,d,l),Hi(e,d,l)):m.skipped||m.unread||(gs(e,l),ms(e,l));var p=Object(s.wrapLoading)(n);if(!Object(i.isSearchingInplace)(g,e.get())&&u&&a(d),!vi&&(c<0||0===d.scrollBottom())&&d.scrollBottom()<1e3){if(Object(i.isSearchingInplace)(g,e.get()))return;if(m.skipped>0&&!e.get().no_moving_down){var _=gpeByClass("_im_page_history",l),h=e.get();vi=!0;var f=e.set(i.loadLessHistory).then(t().loadHistory.bind(null,h.peer,{reversed:!0})).then(()=>{Gi(e),vi=!1,zi(e,_),Yi(e,_),m.skipped||e.set(i.changePeer.bind(null,e.get().peer,!1,!1))});return rs(_,!0),void f.then(rs.bind(null,_,!1))}}if(!vi&&d.scrollTop()<1e3){if(Object(i.isSearchingInplace)(g,e.get())){vi=!0;var b=t().getSearchResulstModule();return b.isAll(e)?void(vi=!1):void p(b.loadMore(e).then(n=>{vi=!1,n&&(t().loadHistory(e.get().peer,{},e,n),a(d))}),"up")}var v=e.get();m.allShown||(vi=!0,p(e.set(i.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,v.peer,{})).then(()=>{vi=!1,a(d)}),"up"))}c<0&&ys(e,g,d.scrollBottom(),l,t),Object(i.videoAutoPlayHandler)()}}}function Gi(e){var t=e.get().peer;if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle)&&t)return e.set(i.readLastMessages.bind(null,t))}function qi(e,t){if(!(window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle))return e.set(i.readTillSpecificMessage.bind(null,t,e.get().peer))}function Ki(e,t,n,a,r){var i=geByClass1("_im_unread_bar_row",t);if(i){var o=a.get(),l=o.peer,c=i.getBoundingClientRect(),d=geByClass1("_im_chat_body_abs",t).getBoundingClientRect().top+20;Object(s.isClassicInterface)(a)&&(d+=47+(ji(o,l)?Ei(a):0));var u=e.scrollTop()-d+c.top;return e.scrollTop(u),Ri(a,e,u),setTimeout(()=>{l===a.get().peer&&Ui(a,n,Ni(t),(function(){}),r,t,0,e)},80),Gi(a),!0}return!1}function Vi(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"top",i=wi(t,n);if(i){var o=Object(s.isClassicInterface)(a),l=a.get().peer,c=o?window.clientHeight():geByClass1("_im_chat_body_abs",t).offsetHeight,d=i.offsetTop+domPN(i).offsetTop+domPN(domPN(i)).offsetTop+domPN(domPN(domPN(i))).offsetTop;o&&ji(a,l)&&(d-=Ei(a)),"top"===r?e.scrollTop(d-e.getScrollHeight()/2+c/2):e.scrollTop(d-e.getScrollHeight()+c/4),addClass(i,"im-mess_light"),setTimeout(()=>{removeClass(i,"im-mess_light")},2e3)}}function Wi(e,t,n){n.updateLastSeen(e)}function $i(e,t,n,a,r,s){var o=domData(s,"action"),l=domData(s,"msgid"),c=geByClass1("_im_mess_marker",wi(n,l)),d=Number(l)>0?"edit":"send",u=e.get().peer,g=Ni(n);switch(o){case"resend":Object(Ve.statlogsSendingRetry)("retry",d),t(r,s);break;case"resend_all":Object(Ve.statlogsSendingRetry)("retry",d),a().resendPeer();break;case"delete":Object(Ve.statlogsSendingRetry)("delete",d),e.set(i.removeFailed.bind(null,g,u,l));break;case"delete_all":Object(Ve.statlogsSendingRetry)("delete",d),e.set(i.removeFailed.bind(null,g,u,void 0))}tooltips.hide(c,{fasthide:!0})}function zi(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.get(),o=r.peer;if(!Object(s.isReservedPeer)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_end"),d=!1;(n||l.skipped>0||l.unread>0)&&!Object(i.isSearchingInplace)(o,e.get())?(d=!0,Qi(t,e),addClass(c,"im-navigation_shown")):us(c,!0),e.set(i.updateGoToEndVisibility.bind(null,[d,+a]))}}function Yi(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!Oi(e))return!1;var r=e.get(),o=r.peer;if(!Object(s.isReservedPeer)(o)){var l=e.get().tabs[o],c=(t||document).querySelector("._im_to_mention"),d=Ji(e).length,u=!1;l.unread>0&&d>0&&!Object(i.isSearchingInplace)(o,e.get())?(u=!0,Xi(t,e,d),addClass(c,"im-navigation_shown")):us(c,!0),e.set(i.updateGoToMentionVisibility.bind(null,[u,+a]))}}function Qi(e,t){var n=t.get().peer,a=Object(o.getTab)(t,n);(e||document).querySelector("._im_to_end").querySelector("._im_to_end_label").innerHTML=Number(a.unread)>0?Object(di.formatCount)(a.unread):""}function Xi(e,t,n){(e||document).querySelector("._im_to_mention").querySelector("._im_to_mention_label").innerHTML=n>0?Object(di.formatCount)(n):""}function Ji(e){var t=e.get(),n=t.id,a=t.peer,r=Object(o.getTab)(e,a);if(!a||!r)return[];var i=r.msgs||{};return Object.values(i).filter(e=>!(!e||Array.isArray(e)||Object(l.isOut)(e)||!Object(l.isUnread)(r,e))&&Object(l.hasUserMentions)(e,n))}function Zi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(0===e.scrollTop()&&0===e.scrollBottom())return!1;var n=e.scrollBottom();return n<(t?30+t:30)}function es(e,t,n,a,r){var i=domData(r,"msgid"),s=e.get().peer,l=Object(o.getMessage)(e,s,i);l.type===b.EDIT_MESSAGE?(n().sendEditMessage(e,l),n().resendMessage(s,i)):e.get().imQueueResend(s,i).then(t=>{e.get().longpoll.push([Object(b.resendEvent)(s,t.mess)])})}function ts(e,t,n,a,r){var o=intval(domData(r,"peer")),l=intval(domData(gpeByClass("_im_mess",r),"msgid")),c=e.get().tabs[o].hash;return Object(i.restoreMessageSend)(l,o,c,e.get().gid),e.set(i.restoreMessage.bind(null,l,o)).then(s.restoreMessage.bind(null,l,o,Ni(t))).then(()=>os(e,n,t)),!1}function ns(e,t){e().showCreation(t)}function as(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function rs(e,t){if(e){var n=e.querySelector("._im_to_end");toggleClass(n,"im-navigation_loading",t)}}function is(e,t,n,a){var r=t.get().peer,c=Object(o.getTab)(t,r);if(Object(s.isFullyLoadedTab)(t,r)){var d=Object.keys(c.msgs).find(e=>{var t=c.msgs[e];return!Array.isArray(t)&&Object(l.isUnread)(c,t)});if(!c.skipped)return d?Vi(a,n,d,t):a.scrollBottom(-30),zi(t,n),Yi(t,n),ys(t,r,0,n,e),void Object(i.readTillSpecificMessage)(c.lastmsg,r,t.get());as(n,!0),t.set(i.changePeer.bind(null,r,!1,!1)).then(()=>t.set(i.loadPeer.bind(null,r,!0,-1,!1))).then(()=>{as(n,!1),e().changePeer(t,!1,!1)})}}function ss(e,t,n,a){var r=Object(o.getTab)(t,t.get().peer),s=Ji(t),l=!!s.length&&s[0].messageId;if(!r.skipped)return l&&Vi(a,n,l,t,"center"),zi(t,n,!0),Yi(t,n),qi(t,l),void ys(t,t.get().peer,0,n,e);as(n,!0),t.set(i.changePeer.bind(null,t.get().peer,!1,!1)).then(()=>t.set(i.loadPeer.bind(null,t.get().peer,!0,-1,!1))).then(()=>{as(n,!1),e().changePeer(t,!1,!1),qi(t,l)})}function os(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(s.isClassicInterface)(e)){var r=t.contHeight(),i=geByClass1("_im_chat_input_w",n),o=geByClass1("_im_chat_resize",n);if(!1!==(a=!1!==a?a:Object(s.getClassicChatHeight)())&&a>0){var l=window.clientHeight(),c=geByClass1("_im_chat_audio_input_parent",n),d=Ti(a,n,l),u=hasClass(c,"im-audio-message_recording")||hasClass(c,bi),g=u?c:geByClass1("_im_chat_input_parent",n),m=d-g.offsetHeight;o.style.height=l-d-15+"px",setStyle(i,{top:m+"px",bottom:"auto"})}else o.style.height="0px",setStyle(i,{top:"auto",bottom:"0px"});var p=geByClass1("_im_peer_history_w",n);return setStyle(p,{borderBottomWidth:i.offsetHeight-15-1}),t.contHeight()-r}var _=t.getScrollHeight();t.update(!1,!0);var h=t.getScrollHeight();return _-h}function cs(e,t,n,a){var r=t.offsetHeight;a(),e.heightIncreased(t.offsetHeight-r,n)}function ds(e,t){var n=t.getBoundingClientRect().top;Object(d.showTooltip)(t,{className:"im-page--admin-tt",text:getLang("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:n>200})}function us(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];hasClass(e,"im-navigation_shown")&&(t&&addClass(e,"im-navigation_fast"),removeClass(e,"im-navigation_shown"),t&&(e.offsetHeight,removeClass(e,"im-navigation_fast")))}function gs(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.querySelector("._im_to_end");e.set(i.updateGoToEndVisibility.bind(null,[!1,0])),us(a,n)}function ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.querySelector("._im_to_mention");e.set(i.updateGoToMentionVisibility.bind(null,[!1,0])),us(a,n)}function ps(e,t,n){$e.screenfull.isFullscreen||0===t.get().peer||Object(s.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function _s(e,t){var n=e.get(),a=n.peer,r=domClosest("_im_mess_srv",t.target),c=intval(domData(r,"msgid")),d=Object(o.getMessage)(e,a,c),u=d&&Object(l.isServiceMsg)(d)&&d.kludges.source_act;if(u===s.CHAT_PIN_MESSAGE||u===s.CHAT_UNPIN_MESSAGE){var g=r.querySelector(".im_srv_mess_link");if(g&&"A"!==g.tagName){var m=d.kludges.source_chat_local_id;if(!m||yi[m])return;yi[m]=Object(i.getMessageLocalId)(a,m,n).then(e=>{var t=hi(e,1)[0];if(t){var n=`/im?sel=${Object(s.convertPeerToUrl)(a)}&msgid=${t}`,r=g.innerHTML;domReplaceEl(g,Object(s.serviceLink)(n,r,!0,"im_srv_mess_link")),delete yi[m]}})}}}function hs(e,t,n){var a=e.get(),r=a.peer,i=n.target.href&&n.target.href.match(/msgid=([\d]+)/),l=i&&i[1];"A"!==n.target.tagName||!l||Object(s.isAlreadyDeleted)(e,r,l)||checkEvent(n)||(Object(o.getMessage)(e,r,l)?(e.setState({msgid:l}),Object(oi.updateLocation)({msgid:l}),t().focusOnMessage()):a.longpoll.push([Object(b.changePeer)(r,l)]));cancelEvent(n)}function fs(e){var t=Object(o.getCurrentTab)(e);Object(s.isChatPeer)(t.peerId)&&(t.pinHideId=cur.imDb.select(li.PIN_HIDDEN_ID_OP,t.peerId))}function bs(e,t,n,a,r){e.setState({isEditing:!1}),removeClass(a,"im-mess_is_editing"),removeClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackFilter("cancel_edit"),n.setDraft(e,Object(o.getPeer)(e)?Object(o.getTabDraft)(Object(o.getCurrentTab)(e)):null),n.toggleStickers(e,!0),n.restoreKeyboard(),vs(t)}function vs(e){Object(h.toArray)(geByClass("_im_history_tooltip",e)).forEach(hide)}function ys(e,t,n,a,r){var s=Object(o.getTab)(e,t);if(!(Date.now()-(s.lastReset||0)<1e3)&&(s&&s.msgs&&s.history&&!vi&&s.offset>300&&0==s.skipped&&n<50&&n>=0&&0===(e.get().selectedMessages||[]).length)){var l=Object.keys(s.msgs).filter(e=>e>0).sort((e,t)=>e-t).slice(0,-50),c=l.slice(-1)[0];e.mutate(i.resetTabAll.bind(null,t)),e.set(i.removeMessages.bind(null,l,t)).then(()=>r().removeStartingFromMessage(c,t,e))}}function Os(e,t,n,a){var r=a.target,i=domClosest("_im_replied_message",r),o=Number(i.getAttribute("data-msgid")),l=domClosest("im-mess",r),c=Number(l.getAttribute("data-msgid")),d=e.get().peer;o&&!Object(s.isAlreadyDeleted)(e,d,o)?(e.setState({msgid:o}),Object(oi.updateLocation)({msgid:o}),Object(s.focusOnMessage)(e,t().focusOnMessage,d,o)):c&&Object(s.showRepliedBox)(e,c,a)}function Cs(e){checkEvent(e)||cancelEvent(e)}function js(e,t){var n=domClosest("_im_mess",t);if(n){var a=Number(n.getAttribute("data-msgid")),r=e.get().peer,s=Object(o.getMessage)(e,r,a);a&&s&&!Object(l.isOut)(s)&&Object(i.markAudioMessageAsListened)(r,a,e.get())}}function Es(e,t,n){var a=n.target.closest("."+s.MESSAGE_KEYBOARD_BUTTON_CLASS),r=n.target.closest("."+s.MESSAGE_STACK_CLASS);if(a){var i=t.get().keyboard_app_hash,o=e.sendMessageFromKeyboard.bind(null,()=>e),l=Object(We.getActionObjectFromElement)(a),c=r?r.dataset.peer:void 0;return Object(We.handleButtonClick)(l,o,i,c)}}function Ts(e,t){var n=e.get().peer,a=t.reduce((t,a)=>{if(a.isIntersecting){var r=+a.target.getAttribute("data-msgid");r&&!Object(l.isOut)(Object(o.getMessage)(e,n,r))&&t.push(r)}return t},[]);if(a.length){var r=Math.max(...a);qi(e,r)}}function Ss(e,t){var n=t.target.closest("._im-call-snippet"),a=n.closest("._im_mess_callsnippet"),r=n.dataset.type,i=a.dataset.peer;if(!Object(s.isCallToPeerAvailable)(e,i))return!1;Object(s.isUserPeer)(i)&&Object(s.startCallFromIm)(e,i,"video"===r)}function ws(e,t,n,a,r,c,d,u,g,m,p,_,v,y,O,j,E,T){var S,w=Object(h.throttle)((function(){n.smoothScroll(...arguments)}),300);return{fixKeyboard(){r.fixKeyboard()},changePeer(e){var l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=e.get().peer;if(revertLastInlineVideo(t),0===g)return O.disable(),r.setDraft(e,null),function(e){addClass(e,"im-page--history_empty"),Ni(e).innerHTML=""}(t);if(Object(s.isFullyLoadedTab)(e.get(),e.get().peer)){removeClass(t,"im-page--history_search"),e.set(i.dropSelection),a.changeActions(e),a.showActions(e);var m=e.get().prevPeer;removeClass(t,"im-page--history_loading"),toggleClass(t,"im-page--history_vkcomgroup",Object(s.isFvkcomgroup)(e,g)),l?r.setDraft(e,Object(o.getTabDraft)(Object(o.getCurrentTab)(e))):r.updateState(e),zi(e,t),Yi(e,t),c().updateTyping(g,e),Wi(e,0,a),Object(s.isReservedPeer)(m)&&!Object(s.isReservedPeer)(g)?function(e,t,n,a,r,i,s,o,l,c,d){removeClass(e,"im-page--history_empty"),Di(e,t,n,a,r,i,s,o,l,c,d)}(t,e,g,n,c,a,u,j,T,d,O):Object(s.isReservedPeer)(m)||Object(s.isReservedPeer)(g)||Di(t,e,g,n,c,a,u,j,T,d,O),Object(o.isCasperChat)(e,g)||(O.enable(),O.toggle(!0),O.reset(n)),Object(s.isReservedPeer)(g)||Ui(e,c,Ni(t),v,O,t,0,n),Object(s.ensureDomHasActions)(t)}},preparePeer(e){var n=Object(o.getPeer)(e);fs(e),r.setDraft(e,Object(o.getTabDraft)(Object(o.getTab)(e,n)),!1),c().updateTyping(n,e),c().hideError(),a.renderPeer(e),j.renderPeer(e),a.hideActions(e),u.changePeer(n,e),Wi(e,0,a),O.toggle(!1),gs(e,t,!0),ms(e,t,!0)},saveScroll:e=>Ri(e,n),loadingPeer(e){Object(i.isAnythingLoading)(e.get())||(removeClass(t,"im-page--history_empty"),addClass(t,"im-page--history_loading"))},stopLoading(e){removeClass(t,"im-page--history_loading")},deselectDialog(e){d().removeSelection(e)},replaceMessageAttrs(e,n){Object(s.replaceMessageAttrs)(n.get(),Ni(t),e)},cleanSelection(e){m.cleanSelection(e)},updateDialogFilters(e){d().updateDialogFilters(e)},getSearchResulstModule:()=>S,showSearchResults(e){e?(removeClass(t,"im-page--history_search-empty"),Ni(t).innerHTML=e):(addClass(t,"im-page--history_search-empty"),Ni(t).innerHTML=Object(s.renderEmptySearch)())},insertSearch(e,r){S||(a.deselectAll(r),S=C(t,r)),addClass(t,"im-page--history_search"),c().showSearchResults(e),os(r,n,t),n.scrollBottom(0),zi(r,t),Yi(r,t),O.reset(n)},updateChatTopic(e,t){d().updateDialog(e,t),e===t.get().peer&&(a.renderPeer(t),a.renderActions(t),j.renderPeer(t))},updateActions(e){a.changeActions(e)},updateChatPhoto(e,r,i){if(Object(s.isPeerActive)(e.peerId,i.get())){a.renderPeer(i),j.renderPeer(i);var o=Zi(n);Object(s.addChatPhotoToUpdate)(e,r,i.get(),Ni(t)),o&&n.scrollBottom(-30)}},markImportant(e,n,r){wi(t,e)&&(a.changedMessageSelection(r),g.markImportant(e,n,r))},isNewMessagesVisible:e=>function(e,t){return Object(o.getUnreadScrollBottom)(e)>=intval(t.scrollBottom())}(e,n),loadHistory(e,a,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=r.get();if(Object(s.isPeerActive)(e,o)){var l=i||o.tabs[e].historyToAppend;if(!l)return;var c=geByClass1("_im_peer_history",t),d=domFC(c),u=n.scrollBottom(),g=a.reversed?e=>c.appendChild(e):e=>c.insertBefore(e,d),m=0;a.reversed&&(m=c.offsetHeight);var p=sech(l),_=document.createDocumentFragment();p.forEach(e=>_.appendChild(e)),g(_),a.reversed&&O.heightIncreased(c.offsetHeight-m,n),a.reversed||n.scrollBottomFixSave(u),n.update(!1,!0);var h=p.filter(e=>hasClass(e,"_im_bar_date"));O.parseMore(h,n),Object(s.ensureDomHasActions)(t)}},sendMessage(e){0!==e.get().peer&&r.sendMessage()},editMessage(e,r){if(Object(s.isFullyLoadedTab)(e,r.peerId)&&Object(s.isPeerActive)(r.peerId,e.get())){if(!wi(t,r.messageId))return;Ri(e,n),Object(s.editAndReplaceMessage)(e.get(),r,t),xi(Object(o.getTab)(e,r.peerId),n),a.reRenderPinned(e),O.reset(n)}},addMessage(e,a){if(!Object(i.isSearchingInplace)(a.peerId,e.get())&&Object(s.isFullyLoadedTab)(e,a.peerId)&&Object(s.isPeerActive)(a.peerId,e.get())){if(wi(t,a.messageId))return;var r=Ni(t);cs(O,r,n,()=>{var i=Zi(n),d=geByClass1("_im_unread_bar_row",t),u=hi(Object(s.isMessagesVisible)(e,t,n),2),g=u[0],m=u[1];Object(s.appendToHistory)(e.get(),a,r,!0,!0,!g&&!d),removeClass(t,"im-page--history_empty-hist");var p=Object(o.getTab)(e,e.get().peer),_=Object(l.isServiceMsg)(a)&&a.userId===vk.id,h=a.kludges&&a.kludges.source_act,f=_&&h!==s.CHAT_PIN_MESSAGE&&h!==s.CHAT_UNPIN_MESSAGE;p.skipped||g||!Object(l.isUnread)(p,a)||Object(l.isOut)(a)||(zi(e,t,!0,m),Yi(e,t,!0,m)),(a.local||i||f)&&n.scrollBottom(0),c().updateTyping(a.peerId,e),Qi(t,e),vs(t)});var d=domPS(domLC(r));if(hasClass(d,"_im_bar_date")){var u=ce("div");u.innerHTML=d.outerHTML,O.parseMore(u,n)}c().hideError(),O.update(n),Object(i.updateMentions)(e.get()),ys(e,a.peerId,n.scrollBottom(),0,c),this.updateObserver()}},setMessageErrored(e,n,a,r){a&&"string"==typeof a&&c().showError(a),Object(s.setMessageError)(e,n,t)},markMessagesAsRead(e,n){e.get().peer===n.peerId&&Object(s.markMessagesAsRead)(e.get(),n.peerId,t)},compensateHistoryHeightChange(e){n.scrollTop(n.scrollTop()+e*Ei(_))},updateTyping(e,n){if(!Object(i.isSearchingInplace)(e,n.get())){var a=n.get();if(a.peer===e&&Object(s.isFullyLoadedTab)(a,e)){var r=Object(s.formatTyper)(Object(o.getTab)(n,e).activity,e,!1,a),l=geByClass1(s.TYPING_CLASS,t);if(l||r){if(!l){var d=geByClass1("_im_typer_c",t);val(d,getTemplate("im_typing",{cls:Object(s.isClassicInterface)(n)?"im-activity_classic":""})),l=geByClass1(s.TYPING_CLASS,t)}val(geByClass1("_im_typing_name",l),r);var u=Object(s.loadSummaryActivityType)(Object(o.getTab)(n,e).activity||{})===i.ACTIVITY_TYPE_RECORDING_AUDIO;l.setAttribute("data-activity-type",u?"recording":"typing"),r?(addClass(l,"im-page--typing_vis"),c().hideError()):removeClass(l,"im-page--typing_vis")}}}},scrollFix(e,t,a){O.heightIncreased(a,n),O.update(n),Object(s.isPeerActive)(t,e.get())&&Zi(n,a)&&n.scrollBottom(-30)},goToEnd(){is(()=>this,_,t,n)},updateGoToEnd(e,a){var r=Object(o.getTab)(e,e.get().peer);r&&(r.skipped||r.unread)?zi(e,t):gs(e,t,a),p(0,n,!1);var i=e.get().peer;setTimeout(()=>{e.get().peer===i&&Ri(e,n)})},updateGoToMention(e,a){var r=Object(o.getTab)(e,e.get().peer),i=Ji(e),s=i.length>0&&i[0].messageId;r&&s?Yi(e,t):ms(e,t,a),p(0,n,!1);var l=e.get().peer;setTimeout(()=>{e.get().peer===l&&Ri(e,n)})},newMessage(e){d().newMessage(e),gs(e,t,!0),ms(e,t,!0)},scroll(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==e.get().peer){var i=a?n.getScrollHeight():40;!0===r&&(i=n.contHeight()),i="up"===t?-i:i,a||r?w(i,()=>{p(i,n)}):(n.scrollTop(n.scrollTop()+i),p(i,n))}},showCreation(e,t){d().showCreation(e,t)},updateScroll:()=>os(_,n,t),toggleBarDate(e){O.toggle(e)},changedMessageSelection(e){a.changedMessageSelection(e)},updateOnline(e,t){Object(s.isTabLoaded)(t.get(),e)&&e===t.get().peer&&a.renderPeer(t)},isEmpty:e=>r.isEmpty(e),replaceAttachmentPlaceholders(e,r){if(Object(s.isPeerActive)(r.peerId,e.get()))cs(O,Ni(t),n,()=>{var i=Zi(n);Object(s.replaceAttaches)(t,r,e.get());var l=Object(o.getTab)(e,r.peerId);if(l.mediacontent[r.messageId].length>=3&&l.mediacontent[r.messageId][2].pinned){var c=Object(o.parserMessage)(l.pinned);c&&c.messageId==r.messageId&&(l.pinned=l.mediacontent[r.messageId][2].pinned,a.reRenderPinned(e))}i&&n.scrollBottom(0)}),O.update(n);else if(Object(l.isMoneyRequest)(r)){var i=Object(o.getTab)(e,r.peerId);if(i.mediacontent[r.messageId].length>=3&&i.mediacontent[r.messageId][2].pinned){var c=Object(o.parserMessage)(i.pinned);c&&c.messageId==r.messageId&&(i.pinned=i.mediacontent[r.messageId][2].pinned)}}},removeMessages(e,r,i){i.get().peer===r&&(Object(s.removeMessages)(e,Ni(t)),Object(s.removeExpiredMessagesStub)(e,Ni(t)),os(i,n,t),a.changedMessageSelection(i),this.updateObserver())},removeStartingFromMessage(e,r,i){if(i.get().peer===r){var o=Ni(t),l=geByClass1("_im_mess_"+e,o);Object(s.removeStartingFromMessage)(l,o),os(i,n,t),a.changedMessageSelection(i)}},hideGoToEnd(e){gs(_,t,e)},hideGoToMention(e){ms(_,t,e)},removeMessagesRestore(e,n,a,r){r.get().peer===n&&Object(s.removeMessagesWithRestore)(e,n,a,Ni(t))},removeExpiredFailedMessages(e){_.get().peer===e&&_.set(i.removeExpiredFailed.bind(null,Ni(t),e))},handleMessageExpiration(e){Object(s.isFullyLoadedTab)(_.get(),e.peerId)&&(Object(s.replaceExpiredMessageWithPlaceholder)(_,t,e),Object(s.replaceExpiredRepliedMessageWithPlaceholder)(t,e),r.detachMessages(e))},updateState(e,t){d().updateState(e,t)},updateBanner(e){j.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(a.changeActions(e),a.renderPeer(e),a.renderActions(e),j.renderPeer(e),r.updateState(e),Object(i.updateMentions)(e.get()))},focustTxt(e){r.focusOn(e)},startSearch(e){c().showSearch(e),u.changePeer(e.get().peer,e),u.search()},showSearch(e){addClass(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),Ci(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout(()=>u.focus(e),10)},cancelSearch(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.get().searchShown&&(removeClass(t,"im-page--hisory_search-open"),removeClass(t,"im-page--history_search"),removeClass(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),Ci(e)&&this.updateChatTopic(e.get().peer,e),a.changedMessageSelection(e)),r&&!Object(s.isReservedPeer)(e.get().peer)&&S){var o=e.get().tabs[e.get().peer],l=Object(i.strHistory)(o.history);l?Ni(t).innerHTML=l:c().showEmptyScreen(),os(e,n,t),n.scrollBottom(0),e.get().msgid&&(Vi(n,t,e.get().msgid,e),zi(e,t),Yi(e,t)),v(n),O.reset(n)}S&&(S.unmount(),S=!1,Object(s.ensureDomHasActions)(t))},showEmptyScreen(){var e=geByClass1("_im_peer_history",t);addClass(t,"im-page--history_empty-hist");var n=Object(o.isCasperChat)(_,_.get().peer)?getTemplate("sImEmptyCasper"):getLang("mail_im_here_history");val(e,n)},updateHistory(e){0!==_.get().peer&&e(t)},focusOnMessage(){Vi(n,t,_.get().msgid,_)},sendEditMessage(e,t){e.set(i.deliverEditedMessage.bind(null,Object(o.getTab)(e,t.peerId),t)).catch(n=>e.get().longpoll.push([Object(b.failedMessage)(t.peerId,t,n)]))},unmount(){Object(f.destroyModule)(e),n.destroy(),clearInterval(y),r.unmount(),a.unmount(),g.unmount(),m.unmount(),u.unmount(),O.unmount(),cancelStackFilter("forward"),ki("_im_chat_resize_track",t),T.destroy()},removePeer(e,t){d().removePeer(e,t)},restoreScroll(e,t){var a=e.get().tabs[t];a.scrollBottom?xi(a,n):n.scrollBottom(-30)},resendMessage(e,n){e===_.get().peer&&Object(s.startResendMessage)(e,n,t)},resendPeer(){r.resendPeer()},resendAll(){r.resendAll()},respond(e,t){r.attachMessages(e,t),r.focusOn(e);var a=Object(o.getTab)(e,t);a&&!a.skipped&&(n.scrollBottom(-30),v(n))},cancelRecording(){r.cancelRecording()},hideError(){geByClass1("_im_error",t).classList.remove("im-page--error--visible")},showError(e){var a=geByClass1("_im_error",t);a.innerHTML=e,a.classList.add("im-page--error--visible"),n.scrollBottom(-30)},startEditing(e){if(Object(i.isAnythingLoading)(_.get()))Object(s.showWaitUntilUploadedBox)();else{e=Object(o.parserMessage)(e);var n=Object(s.getNowEditingMessage)(_);if(!(r.isBlocked()||n&&n.messageId==e.messageId)){n&&this.cancelEditing(),vs(t),_.get().searchShown&&this.cancelSearch(_);var l=wi(t,e.messageId);l&&(this.cancelRecording(),function(e,t,n,a,r){e.setState({isEditing:!0}),n.saveText(e),addClass(a,"im-mess_is_editing"),addClass(geByClass1("_im_page_history"),"is_msg_editing"),cancelStackPush("cancel_edit",()=>bs(e,t,n,a,r));var i=new Ot.ImDraft;i.dData.txt=Object(xa.convertEmojiHtmlToRegularText)(r.text),i.dData.attaches=Object(Da.convertKludgesToAttaches)(r.kludges,r.messageId),n.toggleStickers(e,!1),n.setDraft(e,i),setTimeout(()=>n.focusOn(e),0)}(_,t,r,l,e),r.hideKeyboard(),a.deselectAll(_))}}},cancelEditing(){var e=Object(s.getNowEditingMessage)(_);e&&bs(_,t,r,wi(t,e.messageId))},messageKeyboardButtonClick:e=>Es(r,_,e),getEditingMessage:()=>Object(s.getNowEditingMessage)(_),focusEditingMessage(){var e=Object(s.getNowEditingMessage)(_);e&&Vi(n,t,e.messageId,_),r.focusOn(_)},setNetworkWaitingStatus(e){a.setNetworkWaitingStatus(e)},setNetworkReconnectingStatus(){a.setNetworkReconnectingStatus()},clearNetworkStatus(){a.clearNetworkStatus()},updateCasperMessageStatus(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.isFullyLoadedTab)(_.get(),e.peerId)&&_.set(i.updateCasperMessageExpiringStatus.bind(null,e,n)).then(()=>{_.get().peer===e.peerId&&Object(s.setCasperMessageExpiringStatusDOM)(t,n,e.messageId)})},updateObserver(){E.update()},renderPeerProfile(e){T.render(e)},destroyPeerProfile(){T.destroy()}}}function Is(e,t,n,a,r){var l=geByClass1("_im_peer_history_w",e);Object(va.hasAccessibilityMode)()&&addClass(l,"history_a11y");var c,d,u,g=Object(f.createMutations)(ws),m=g.callMutations,p=g.bindMutations,_=(c=Ri.bind(null,t),d=Object(ya.debounce)(c,100),u=Object(h.throttle)(c,100),e=>{d(e),u(e)}),v=si(t,e),y=Ui.bind(null,t,m,l,_,v,e),O=Object(T.createScroll)(geByClass1("_im_chat_body_abs",e),{onScroll:y,nativeScroll:Object(s.isClassicInterface)(t),shadows:!1}),C=Object(s.isClassicInterface)(t)?void 0:O.scroll.container,j=function(e,t,n){var a=Object(E.default)({observer:new IntersectionObserver(n,{root:t}),targets:[]});$r(e,t,a);var r=Object(f.createModule)({handlers:(e,t)=>{}});return{update(){$r(e,t,a)},unmount(){var e=a.get(),t=e.observer;e.targets.forEach(t.unobserve.bind(t)),Object(f.destroyModule)(r)}}}(t,C,Ts.bind(null,t));setTimeout((function(){var n=t.get().peer;n?(fs(t),(Object(o.getCurrentTab)(t).pinned||Object(o.getCurrentTab)(t).top_banner)&&(m().updateChatTopic(n,t),t.set(i.setActions),S.changeActions(t)),t.get().msgid?Vi(O,e,t.get().msgid,t):Ki(O,e,m,t,v)||O.scrollBottom(-30),t.get().history_init=!1,Object(o.isCasperChat)(t,n)?v.disable():v.reset(O),zi(t,e),Yi(t,e),Ui(t,m,l,_,v,e,0,O),Object(s.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(i.setInplaceSearch.bind(null,nav.objLoc.st,n)),m().startSearch(t))):v.disable()}),15);var S=en(geByClass1("_im_dialog_actions",e),t,m),w=Sr(geByClass1("_im_text_input",e),t,Object(s.isClassicInterface)(t)?a.updateMenu:void 0,(e,t)=>{n.removeDialog(e,t),n.restoreDialogs(e,!0)},m),I=Nr(geByClass1("_im_dialog_actions",e),t,m),k=Kr(e,t,m),M=Wr(e,t,()=>({changedMessageSelection:S.changedMessageSelection})),A=Object(zr.mount)(l);Object(Qe.mount)(e,t,m);var L=pi(e,t,()=>({hidePinned(){Object(Qe.pinnedMessageHide)(t,t.get().peer,m,!1)},compensateHistoryHeightChange(e){m().compensateHistoryHeightChange(e)},showPinned(){Object(Qe.pinnedMessageUnHide)(t,t.get().peer,m,!1)}}));Object(s.isReservedPeer)(t.get().peer)||t.set(i.restoreHistoryQueue.bind(null,t.get().peer)).then(()=>{Object(s.restoreQueue)(t.get().peer,t.get(),Ni(e)),Li(e,t,t.get().peer)}),AudioMessagePlayer.events.on("listened",js.bind(null,t)),Ii("_im_chat_resize_track",e,r);var P=es.bind(null,t,e,m),N=ts.bind(null,t,e,O),x=ns.bind(null,r,t),D=is.bind(null,m,t,e,O),R=ss.bind(null,m,t,e,O),B=Pi.bind(null,t,e),F=s.showEditTimeTooltip.bind(null,t),H=s.showMessageInfoTooltip.bind(null,t),U=$i.bind(null,t,P,e,m),G=Ai.bind(null,t,e,O),q=ps.bind(null,m,t,O),K=_s.bind(null,t),V=hs.bind(null,t,m),W=Os.bind(null,t,m,e),$=Es.bind(null,w,t),z=Mi.bind(null,m),Y=s.showCasperExpiringTooltip.bind(null,t,e),Q=()=>showWiki({w:"expired_messages"}),X=Ss.bind(null,t),J=Object(f.createModule)({handlers:(n,a)=>{a(e,"click",s.RESTORE_CLASS,N),a(e,"mouseover click",s.FAILED_CLASS,B),a(e,"mouseover","_im_edit_time",F),a(e,"mouseover","_im_page_info",H),a(e,"click","_im_mess_susp",Si.bind(null,e)),a(e,"click","_im_failed_action",U),a(e,"click","_im_mess_link",G),a(e,"mouseover","_im_admin_name",ds),a(e,"mouseover","_im_mess_srv",K),a(e,"mouseover","im-mess-stack--bomb",Y),a(e,"click","im_srv_mess_link",V),a(e,"click","_im_error",z),a(e,"click","_im_replied_message",W),a(e,"click","_im_replied_author_link",Cs),a(e,"click","_chat_invitation",(e,n)=>{if(checkEvent(e))return!0;if(!gpeByClass("wall_postlink_preview_btn",e.target)&&!hasClass(e.target,"wall_postlink_preview_btn"))return!0;var a=geByClass1("flat_button",n),r={invite_chat_id:domData(a,"inv-id"),invite_hash:domData(a,"hash")};Object(s.showInvitationBox)(t,r,i.leaveInvitation),cancelEvent(e)}),a(e,"click","_im_join_cancel",()=>t.get().longpoll.push([Object(b.resetPeer)()])),a(e,"click","_im_retry_media",e=>function(e,t,n){var a=e.get(),r=domClosest("_im_mess",n.target),l=domData(r,"msgid"),c=Object(o.getMessage)(a,a.peer,l),d=e=>t().replaceAttachmentPlaceholders(e,c);c&&(Object(Ve.statlogsSendingRetry)("retry_attach"),e.set(i.addAttachmentsToStoreData.bind(null,c,[Object(s.renderMessageMedia)(e,c)])).then(d),e.set(i.loadMedia.bind(null,c)).then(d))}(t,m,e)),a(e,"click",s.MESSAGE_KEYBOARD_BUTTON_CLASS,$),a(e,"click","_im-call-snippet",X),n(geByClass1("_im_peer_history_w",e),"mousemove",v.show),n(geByClass1("_im_start_new",e),"click",x),n(e.querySelector("._im_to_end"),"click",D),n(e.querySelector("._im_to_mention"),"click",R),n(geByClass1("_im_cancel_edit",e),"click",()=>(m().cancelEditing(),!1)),n(geByClass1("_im_edit_focus_cur",e),"click",()=>(m().focusEditingMessage(),!1)),$e.screenfull.raw&&n(document,$e.screenfull.raw.fullscreenchange,q),n(window,"im_goToMessage",e=>{var n=intval(e.msgid);if(n)return window.statlogsValueEvent("im_links_to_attachments",1,"to_message"),t.set(i.changePeer.bind(null,e.sel,n,!1)).then(()=>Object(s.focusOnMessage)(t,m().focusOnMessage,t.get().peer,n))}),a(e,"click","im-expired-message--in",Q)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?Object(Qe.pinnedMessageHide)(t,e.peer,m,!1):Object(Qe.pinnedMessageUnHide)(t,e.peer,m,!1)}],window.showForwardBox=e=>function(e,t){Object(s.boxHandleMessagesLabelsTooltips)(showBox("al_im.php",t,{dark:1}),e)}(t,e);var Z=setInterval(Wi.bind(null,t,e,S),1e4);return p(J,e,O,S,w,m,r,I,k,M,y,t,_,Z,v,L,j,A)}function ks(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ms(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ms(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ms(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var As=[],Ls=0,Ps=!1;function Ns(e){As=As.reduce((t,n)=>{var a=ks(n,2),r=a[0],i=a[1];return i(e)?t:t.concat([[r,i]])},[])}function xs(e,t){!1===Ps&&(Ps=!0,document.body.addEventListener("click",Ns,!0)),As=As.concat([[e,t]])}function Ds(e){As=As.filter(t=>ks(t,1)[0]!==e),0===Ls&&(document.body.removeEventListener("click",Ns,!0),Ps=!1)}function Rs(e,t){As=As.map(n=>{var a=ks(n,2),r=a[0],i=a[1];return r===e?[e,t]:[r,i]})}function Bs(e,t){return 0===t.length?t=>(e(t),!0):n=>{var a=t.reduce((e,t)=>e&&!domClosest(t,n.target),!0);return a&&e(n),a}}function Fs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Hs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Us(e,t,n,a){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var r=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(s.wrapLoading)(r)(Object(i.loadImportant)(e.offset).then(t=>{var n=Fs(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(r,"im-important_all"):e.loading=!1,a.set(i.mergeTabs.bind(null,Object(s.tabFromIds)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,r.appendChild(c),Object(s.ensureDomHasActions)(r)}),"bottom")}}function Gs(e,t,n){for(var a=arguments.length,r=new Array(a>3?a-3:0),s=3;s<a;s++)r[s-3]=arguments[s];r.filter(e=>inArray(e.type,[b.SET_FLAGS,b.RESET_FLAGS,b.CHANGE_PEER])).forEach(a=>{if(a.type!==b.CHANGE_PEER){if(a.flags===b.FLAG_IMPORTANT){var r=a.type===b.SET_FLAGS;e.set(i.updateFavMessage.bind(null,[a.messageId],0,r)).then(n=>{t.markImportant(a.messageId,r,e)})}}else n.hide()})}function qs(e,t,n,a){var r=ge("box_layer_wrap"),i=t.get().longpoll,o=Object(E.default)({peer:0,longpoll:i,oCache:{},tabs:Object(s.tabFromIds)(a.msgs,a.hash)}),l=Kr(e.bodyNode,o,()=>({})),c=C(e.bodyNode,t);Object(s.ensureDomHasActions)(e.bodyNode);var d=Gs.bind(null,t,l,e);i.onData(d);var u=Us.bind(null,{all:!1,loading:a.all,offset:a.offset},e,r,o),g=Object(f.createModule)({handlers:(e,t)=>{e(r,"scroll",u)}});return{unmount(){Object(f.destroyModule)(g),c.unmount(),l.unmount(),i.offData(d)}}}var Ks=n("XzvV");function Vs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ws(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ws(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ws(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var $s=Object(ya.debounce)(V.statlogsProbValueEvent,1e3);function zs(e){return ge("im_dialogs_search",e)}function Ys(e,t,n,a,r,s){var l=trim(s);if(Object(o.isSearchingValue)(e,l)){var c=Zs.bind(null,e,n,r,t);l?(e.setState({recentSearch:!1}),r.stop()):r.replaceOrAdd(c),cancelStackPush("im_search",c),l&&e.set(i.setCurrentSearch.bind(null,l,!1)).then(t),addClass(a,"im-page--dialogs-search_fill"),addClass(a,"_im_d_search")}else l||(r.stop(),e.set(i.setCurrentSearch.bind(null,"",!1)).then(t),removeClass(a,"im-page--dialogs-search_fill"),removeClass(a,"_im_d_search"))}function Qs(e,t,n){return function(){var a=Object(o.getSearchText)(t);a===e&&n(...arguments)}}function Xs(e,t,n){var a=Object(o.getSearchText)(n);return $s(.01,"im_search_stat",1,"search_start"),Object(i.updateSearchQuery)(a),n.setState({recentSearch:!1}),e().toggleSettingsButton(n,!!a),a?(n.get().dialog_search_going=!0,function(e,t,n){var a=Qs(e,n,t().appendFastDialogs.bind(null,n));return Object(i.searchTopConv)(e,n.get()).then(e=>(a(e),e))}(a,e,n).then(r=>{var i=r.map(e=>e.peerId);return t(a,e,i,n)}).then(e=>{n.get().dialog_search_going=!1}).catch(()=>{})):(e().restoreDialogs(n,!1,!0),Object(Ks.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function Js(e,t,n,a){var r=a.get(),o=Qs(e,a,t().appendDialogs.bind(null,a)),l=Qs(e,a,t().appendSearch);return Object(s.isPendingForward)(a)?Object(i.searchHints)(e,n,"all",{},r).then(o):Promise.all([Object(i.searchHints)(e,n,"all",{},r).then(o),Object(i.searchMessages)(e,r)]).then(e=>{var t=Vs(e,2),n=Vs(t[1],2),r=n[0],i=n[1];l(a,r,i,!0)})}function Zs(e,t,n,a){cancelStackFilter("im_search");var r=zs(t);uiSearch.reset(r),e.setState({recentSearch:!1}),Ys(e,a,t,r,n,r.value)}function eo(e,t,n,a,r,i){Object(o.isSearching)(e)?(Zs(e,t,r,n),setTimeout(()=>no(e,i),10)):(window.tooltips&&tooltips.hide(i,{showsp:0}),function(e,t,n){n().showCreation(e)}(e,0,a))}function to(e,t,n,a,r){return Object(s.showFavvedBox)(e,n,qs,a)}function no(e,t){return Object(d.showTooltip)(t,{appendEl:bodyNode,text:()=>Object(o.isSearching)(e)?getLang("mail_cancel"):getLang("mail_start_conversaion"),black:1,shift:[3,-1],appendCls:"js-im-page"})}function ao(e,t,n){var a=n.target;e.set(i.toggleCommunityMute.bind(null,t)).then(()=>{toggleClass(a,"im-page--gim-mute_muted",e.get().mute),t&&ro(e,{target:a})})}function ro(e,t){var n=t.target;return Object(d.showTooltip)(n,{text:()=>e.get().mute?getLang("mail_im_sound_off"):getLang("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function io(e){var t=e.target;Object(d.showTooltip)(t,{text:getLang("mail_corona_bot"),black:1,shift:[4,-1],showdt:300,appendEl:bodyNode,appendCls:"js-im-page"})}function so(e,t){if(!checkEvent(t)){var n=Object(h.unpackStore)(e);Object(Ve.statlogsCoronaBotLinkClickEvent)(),n.longpoll.push([Object(b.changePeer)(n.coronaBotPeer,!1,!0,!0)]),cancelEvent(t)}}function oo(e,t,n,a,r,i,s){return{focusInput(t){uiSearch.focus(zs(e).parentNode)},createCanceled(e,n){removeClass(t,"im-dialog-select_rotated")},rotateCross(e){addClass(t,"im-dialog-select_rotated")},setSearch(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t,n,a,r){var i=zs(t);i.value=r,Ys(e,a,t,i,n,i.value)}(t,e,a,r?i:()=>{},n)},clearSearch(t){Zs(t,e,a,()=>{})},updateCoronaBotLinkState(e){var t=Object(h.unpackStore)(e);toggleClass(s,"im-page--corona-bot-link_active",t.peer===t.coronaBotPeer)},updateImportantCnt(t){var n=t.get().important_cnt,a=geByClass1("_im_important_counter",e);toggleClass(a,"im-page--stars_hidden",0===n),a.innerHTML="<i></i> "+n},unmount(){a.stop(),Object(f.destroyModule)(r),uiSearch.destroy(n),cancelStackFilter("im_search")}}}function lo(e,t,n){var a=geByClass1("_im_search_croll",e),r=zs(e),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Ls++,{stop(){Ls--,Ds(e)},replaceOrAdd(n){var a=As.filter(t=>{var n=ks(t,1)[0];return e===n}),r=Bs(n,t);a.length>0?Rs(e,r):xs(e,r)}}}("im_search",["_im_search_croll","_im_page_dcontent","_im_d_search","_im_dialog"]),c=Object(yt.debouncedPromise)(Js,300),u=Xs.bind(null,n,c),g=Ys.bind(null,t,u,e,r,l),m=eo.bind(null,t,e,u,n,l,a),p=to.bind(null,t,e,n),_=geByClass1("_im_dialogs_corona_bot",e),h=so.bind(null,t),v=geByClass1("_im_dialogs_search_input",e);uiSearch.init(v,{onChange:g});var y=no.bind(null,t,a),O=geByClass1("_im_gim_mute",e);r.value&&g(r.value);var C=Object(f.createModule)({handlers:(c,u)=>{if(c(geByClass1("_im_av_time",e),"mouseover",e=>{Object(d.showTooltip)(e.target,{text:getLang("mail_admin_av_time"),dir:geByClass1("_im_top_notice")||geByClass1("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})}),c(a,"click",m),c(a,"mouseover",y),c(geByClass1("_im_important_counter",e),"click",p),Object(s.isClassicInterface)(t)){var g=ao.bind(null,t,!0),f=ro.bind(null,t);c(O,"click",g),c(O,"mouseover",f)}c(r,"focus",()=>{t.get().longpoll.push([Object(b.transitionEvent)("search")])}),c(r,"click",()=>{Object(o.isSearching)(t)&&n().toggleSettingsButton(t,!0),function(e,t,n,a,r){if(!Object(o.isSearching)(e)){var l=cur.imDb.select(li.RECENT_SEARCH_OP);if(0!==l.length||Object(o.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),Ys(e,()=>{Object(o.isSearching)(e)||(a.stop(),r().toggleSettingsButton(e,!1),r().restoreDialogs(e,!1,!0))},t,n,a,"");var c=l.filter(t=>!Object(s.isTabLoadedWithMessage)(e.get(),t)),d=l.filter(t=>Object(s.isTabLoadedWithMessage)(e.get(),t)).reduce((t,n)=>(t[n]=Object(o.getTab)(e,n),t),{});e.get().topConvTree.then(t=>{var n=t.list.filter(e=>inArray(e[0],c)).reduce((e,t)=>(e[t[0]]=Object(i.localIndexToDialog)(t),e),{}),a=extend({},n,d);return r().appendFastDialogs(e,l.map(e=>a[e])),Object(i.searchHints)(!1,Object.keys(n),!1,{},e.get())}).then(t=>{r().appendDialogs(e,t)})}}}(t,e,r,l,n)}),c(r,"blur",()=>{var e;e=0===t.get().peer||Object(s.isPendingForward)(t)?"search":"default",Object(o.isSearching)(t)||n().toggleSettingsButton(t,!1),t.get().longpoll.push([Object(b.transitionEvent)(e)])}),c(_,"mouseover",io),c(_,"click",h)}});return Object(s.isClassicInterface)(t)&&ao(t,!1,{target:O}),oo(e,a,v,l,C,u,_)}var co=n("W9Tc");function uo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return go(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return go(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function go(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function mo(e,t,n,a){if(!e.loading&&!e.all&&n.scrollTop+window.innerHeight-n.scrollHeight>-300){var r=geByClass1("_im_peer_history",t.bodyNode);e.loading=!0,Object(s.wrapLoading)(r)(Object(i.loadSpam)(e.offset,a.get().gid).then(t=>{var n=uo(t,4),o=(n[0],n[1]),l=(n[2],n[3]);e.all=l.all,e.offset=l.offset,e.all?addClass(r,"im-important_all"):e.loading=!1,a.set(i.mergeTabs.bind(null,Object(s.tabFromIds)(l.msgs,l.hash)));var c=ce("div");c.innerHTML=o,r.appendChild(c),Object(s.ensureDomHasActions)(r)}),"bottom")}}function po(e,t){var n=t.get().selectedMessages,a=geByClass1("_im_spam_box",e.bodyNode),r=geByClass1("ui_tab_sel",e.bodyNode);if(n.length>0){var i=getLang("mail_selected",n.length);i=i.replace("{count}",n.length),val(r,i+`<button aria-label="${getLang("mail_deselect_all")}" type="button" class="im-deselect ${s.DESELECT_ALL_CLASS}"></button>`)}else val(r,getLang("mail_spam"));0===n.length?removeClass(a,"im-important-box_with-sel"):(addClass(a,"im-important-box_with-sel"),val(geByClass1("_im_spam_not_spam"),getLang("mail_im_mark_notspam",n.length)),val(geByClass1("_im_spam_spam"),getLang("mail_im_mark_delspam",n.length)))}function _o(e,t,n){var a=e.get().selectedMessages;e.set(i.cleanSelected).then(n.cleanSelection.bind(null,a)).then(n=>po(t,e))}function ho(e,t,n,a){var r=gpeByClass("_im_mess",a,t);if(r){var o=intval(domData(r,"msgid"));r&&(Object(i.removeMessageSend)([o],0,e.get().tabs[0].hash,"undel",e.get()),Object(s.restoreMessage)(o,0,t))}}function fo(e,t,n){var a=e.get().selectedMessages;Object(i.removeMessageSend)(a,0,e.get().tabs[0].hash,"delete",e.get()),Object(s.removeMessagesWithRestore)(a,0,"delete",t),_o(e,t,n)}function bo(e,t,n){var a=e.get().selectedMessages;Object(i.removeMessageSend)(a,0,e.get().tabs[0].hash,"nospam",e.get()),a.map(e=>geByClass1("_im_mess_"+e)).filter(e=>e).forEach(e=>{var t=intval(domData(e,"peer")),n=intval(domData(e,"msgid"));val(e,Object(s.renderGoTo)(t,n)),addClass(e,"im-mess_light")}),_o(e,t,n)}function vo(e,t,n,a,r){var i=gpeByClass("_im_mess",r,t.bodyNode),s=intval(domData(i,"peer")),o=intval(domData(i,"msgid"));return t.hide(),n().unmount(),e.get().longpoll.push([Object(b.changePeer)(s,o)]),Object(qn.stopEvent)(a),cancelEvent(a),!1}function yo(e,t,n,a){var r=Object(ze.showFastBox)({title:getLang("mail_deleteall1"),dark:1,bodyStyle:"padding: 20px; line-height: 160%;"},getLang("mail_delete_all_spam"),getLang("mail_delete"),()=>{Object(i.flushSpam)(e,a).then(e=>{var t=uo(e,2),n=(t[0],t[1]);showDoneBox(n)}),r.hide(),t.hide(),n().unmount()},getLang("mail_close"),()=>r.hide())}function Oo(e,t){return{unmount(){t.unmount(),Object(f.destroyModule)(e)}}}function Co(e,t,n){var a=ge("box_layer_wrap"),r=Object(f.createMutations)(Oo),i=r.callMutations,o=r.bindMutations,l=Object(E.default)({peer:0,oCache:{},tabs:Object(s.tabFromIds)(n.msgs,n.hash),gid:t.get().gid}),c=mo.bind(null,{all:n.all,loading:!1,offset:n.offset},e,a,l),d=ho.bind(null,l,e.bodyNode),u=vo.bind(null,t,e,i),g=yo.bind(null,n.hash,e,i,t.get().gid),m=Wr(e.bodyNode,l,t=>({changedMessageSelection:po.bind(null,e)})),p=fo.bind(null,l,e.bodyNode,m),_=bo.bind(null,l,e.bodyNode,m),h=_o.bind(null,l,e,m);return Object(s.ensureDomHasActions)(e.bodyNode),o(Object(f.createModule)({handlers:(t,n)=>{t(a,"scroll",c),t(geByClass1("_im_spam_spam",e.bodyNode),"click",p),t(geByClass1("_im_spam_not_spam",e.bodyNode),"click",_),t(geByClass1("_im_spam_flush",e.bodyNode),"click",g),n(e.bodyNode,"click","_im_mess_restore",d),n(e.bodyNode,"click","_im_go_to",u),n(e.bodyNode,"click",s.DESELECT_ALL_CLASS,h)}}),m)}function jo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"im_settings",t={sound:ls.get("sound_notify_off")?getLang("mail_im_sound_off"):getLang("mail_im_sound_on")};return window.pushNotifier&&window.pushNotifier.loadEndpoint()||Object(co.partConfigEnabled)("push_notifier")&&ls.get("im_ui_notify_off")?t.browser=getLang("mail_notification_settings"):t.browser=To()?getLang("mail_im_notifications_on"):getLang("mail_im_notifications_off"),getTemplate(e,t)}function Eo(e,t){Object(d.showTooltip)(t.target,{content:jo("im_settings_pop"),dir:"down",shift:[220,9],hasover:!0,showdt:10})}function To(){return DesktopNotifications.supported()&&!DesktopNotifications.checkPermission()&&!ls.get("im_ui_notify_off")}function So(e,t,n,a,r){var i=domData(r,"action"),o=gpeByClass("_im_settings_menu",r),l=hasClass(o,"_im_settings_popup")?"im_settings_pop":"im_settings";switch(i){case"spam":Object(s.showSpamLayer)(e,Co,a);break;case"sound":ls.get("sound_notify_off")?ls.set("sound_notify_off",0):ls.set("sound_notify_off",1),o.outerHTML=jo(l);break;case"browser":To()?(ls.set("im_ui_notify_off",1),o.outerHTML=jo(l),Object(Ve.statlogsBrowserNotificationsOff)()):DesktopNotifications.checkPermission()?DesktopNotifications.requestPermission(()=>{o.parentNode&&(o.outerHTML=jo(l))}):Object(co.partConfigEnabled)("push_notifier")?nav.go("/settings?act=notify"):(ls.set("im_ui_notify_off",0),o.outerHTML=jo(l),Object(Ve.statlogsBrowserNotificationsOn)())}}function wo(e,t,n){var a=Eo.bind(null,t),r=So.bind(null,t,n,e),l=function(e,a){if(Object(s.showUnreadOnly)(t,n,i.changeDialogsTab)){var r=t.get().active_tab===j.FOLDER_UNREAD;val(a,getTemplate("im_filter",{filter:r?getLang("mail_to_all_dialogs"):getLang("mail_to_unread")}))}},c=Object(f.createModule)({handlers:(t,n)=>{n(e,"mouseover","_im_dialogs_cog_settings",a),n(e,"click","_im_settings_action",r),n(e,"click","_im_to_unread",l)}});return function(e,t){return{updateFilter(t){var n,a=t.get().active_tab===j.FOLDER_UNREAD,r=[];Object(o.isSearching)(t)&&r.push("im-page--dialogs-filter_hidden"),t.get().unread_cnt>0?n=a?getLang("mail_to_all_dialogs"):getLang("mail_to_unread"):(n=getLang("mail_all_dialogs"),r.push("im-page--dialogs-filter_disabled")),val(geByClass1("_im_to_unread",e),getTemplate("im_filter",{filter:n,cls:r.join(" ")}))},toggleButton(t,n){var a=geByClass1("im-page--dialogs-filter",e);toggleClass(a,"im-page--dialogs-filter_hidden",n)},toggleLoader(t,n){var a=geByClass1("_im_dialogs_cog_settings",e);toggleClass(a,"im-page--dialogs-settings_loading",n)},updateSettings(t){geByClass1("_im_settings_menu",e).outerHTML=jo()},unmount(){Object(f.destroyModule)(t)}}}(e,c)}function Io(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function ko(e){return e.selection=[],Promise.resolve(e)}function Mo(e,t){return t.selection=t.selection.filter(t=>t.id!==e),Promise.resolve(t)}function Ao(e,t,n,a,r,i,s){var o=intval(domData(s,"peer"));tooltips.hide(s),t.set(Mo.bind(null,o)).then(i=>{Po(e,a,t,r),n().selectionDeleted(t,o)})}function Lo(e,t,n,a){e.set(i.setCurrentSearch.bind(null,n,!1)).then(t().onChange)}function Po(e,t,n,a){var r=n.get().selection,i=uiSearch.getFieldEl(e);uiSearch.focus(e),r.length>0?attr(i,"placeholder",""):attr(i,"placeholder",unclean(Object(c.getLang)("mail_search_creation"))),t.innerHTML=r.map(e=>`<div class="token">\n      <div class="token_title">${e.name}</div>\n      <div data-peer="${e.id}" class="token_del _ui_multiselect_cancel"></div>\n    </div>`).join(""),toggleClass(e,"ui_multiselect_has_selection",r.length>0),domFC(e).scrollTop+=50,a()}function No(e,t){return Object(d.showTooltip)(t,{text:Object(c.getLang)("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function xo(e,t,n){uiSearch.init(e,{onChange:Lo.bind(null,t,n)});var a=uiSearch.getFieldEl(e),r=ce("div",{className:"_ui_multiselection ui_multiselect_cnt"});a&&a.parentNode.insertBefore(r,a);var i,s,o=(i=a,s=0,function(){var e=i.offsetWidth;setStyle(i,{width:1});var t=i.offsetLeft;s!==t?(s=t,e=i.parentNode.offsetWidth,setStyle(i,{width:Math.max(30,e-t-20)})):setStyle(i,{width:e})});t.set(ko);var l=Ao.bind(null,e,t,n,r,o),c=t=>{document.activeElement!==a&&uiSearch.focus(e)},d=Object(f.createModule)({handlers:(t,n)=>{n(e,"click","_ui_multiselect_cancel",l),n(e,"mouseover","_ui_multiselect_cancel",No),t(e,"click",c)}});return{addSelection:(n,a)=>t.set(Io.bind(null,{id:n,name:a})).then(Po.bind(null,e,r,t,o)),removeSelection:n=>t.set(Mo.bind(null,n)).then(Po.bind(null,e,r,t,o)),resetSelection(){!function(e,t,n,a){e.set(ko).then(Po.bind(null,t,n,e,a))}(t,e,r,o)},focus(){uiSearch.focus(e)},save(){t.stash(),Po(e,r,t,o)},restore(){t.pop(),Po(e,r,t,o)},unmount(){uiSearch.destroy(e),Object(f.destroyModule)(d)}}}var Do=n("v+DW"),Ro="_im_dialogs_creation_name",Bo="_im_create_select",Fo=["im-creation--item_hovered"];function Ho(e,t,n,a,r,s){Object(i.toggleConversation)(!1),removeClass(t,"im-create_shown"),removeClass(t,"im-create_photo-attached"),setTimeout(Go.bind(null,t,!1),100),$o(s).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>{removeClass(e,"olist_item_wrap_on")}),n().createCanceled(e,a),r.resetSelection(),"add_member"===e.get().creationType&&e.set(i.setCreationType.bind(null,"chat",[])),e.set(i.presetAvatar.bind(null,!1));var o=geByClass1("_im_avatar_img",t);qo(e,s,t),uiSearch.reset(geByClass1(Ro,t)),uiSearch.reset(geByClass1(Bo,t)),o&&o.parentNode.removeChild(o),qo(e,s,t),cancelStackFilter("im_search");var l=0===e.get().peer?"search":"default";e.get().longpoll.push([Object(b.transitionEvent)(l)]),attr(t,"aria-hidden","true")}function Uo(e,t,n){return t&&(n.current_create_peer_ids={},n.current_create_peers=[]),n.current_create_peer_ids||(n.current_create_peer_ids={}),n.current_create_peers||(n.current_create_peers=[]),e.forEach(e=>{e.then(e=>{e=e.filter(e=>!n.current_create_peer_ids[e.peerId]),n.current_create_peer_ids=e.reduce((e,t)=>(e[t.peerId]=!0,e),n.current_create_peer_ids),n.current_create_peers=n.current_create_peers.concat(e)})}),Promise.resolve(n)}function Go(e,t){toggleClass(e,"im-create_material",t)}function qo(e,t,n){var a=geByClass1("_im_confirm_creation",n),r=t.get().selection.length,i="add_member"===e.get().creationType,s=r>0,o=uiSearch.getFieldEl(geByClass1(Ro,n)).value.length>0,l=!s&&(i||!o),d=i?1===r?Object(c.getLang)("mail_append_chat"):Object(c.getLang)("mail_im_create_chat_with"):o||r>1?Object(c.getLang)("mail_im_create_chat"):Object(c.getLang)("mail_im_go_to_dialog");val(a,d),toggleClass(a,"button_disabled",l)}function Ko(e,t,n,a,r,i,s){if(s){var o,l=intval(domData(s,"list-id")),c=$o(i),d=trim(s.textContent),u=geByClass1(Bo,t),g=getSize(u)[1];inArray(l,c)?(o=a.removeSelection(l,d),removeClass(s,"olist_item_wrap_on")):(o=a.addSelection(l,d),addClass(s,"olist_item_wrap_on")),o.then(()=>{var e=g-getSize(u)[1],t=r.scrollTop();r.scrollTop(t-e)}),qo(e,i,t);var m=geByClass1(Bo,t);uiSearch.reset(m)}}function Vo(e,t){var n=$o(e),a=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],r=[];return t.online&&r.push("online"),mobPlatforms[t.online]&&r.push("mobile"),inArray(t.peerId,n)&&a.push("olist_item_wrap_on"),getTemplate("im_owner_item",{owner_id:t.peerId,cls:" "+a.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:r.join(" ")})}function Wo(e){return Object(o.getSearchText)(e)||!1}function $o(e){return e.get().selection.map(e=>e.id)}function zo(e,t,n){return e.then(e=>e.filter(e=>e.is_friend&&!inArray(e.peerId,n.get().creationFilter)))}function Yo(e,t,n,a,r){var s,o,l=geByClass1(Bo,e),c=Object(i.searchLocalHints)(a,t.get()),d=n.hoverFirstElement.bind(n,Fo,tl(t));t.get().creation_shown_all=!1,n.reset(),n.pipe(zo(c,0,t),a),n.toTop(),a?(o=Object(i.searchTopConv)(a,t.get()),s=Object(i.searchHintsIndex)(a,[],"friends",t.get()),n.pipe(zo(s,0,t),a).then(d),n.pipe(zo(o,0,t),a).then(d)):(s=Promise.resolve([]),o=Promise.resolve([])),t.set(Uo.bind(null,[c,o,s],!0)),uiSearch.showProgress(l),Promise.all([c,s,o]).then(()=>uiSearch.hideProgress(l))}function Qo(e,t,n,a){var r=2e9+Math.round(rand(1e6,2e6));cur.recieveCropResult=n=>{cur.recieveCropResult=!1,curBox()&&curBox().hide(),e.set(i.presetAvatar.bind(null,n)),Object(i.getOwnerPhoto)(n,r).then(e=>{geByClass1("_im_create_avatar",t).appendChild(ce("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))}),addClass(t,"im-create_photo-attached")},Page.ownerPhoto(r)}function Xo(e,t){geByClass1("_im_create_avatar",t).innerHTML="",e.set(i.presetAvatar.bind(null,!1)),removeClass(t,"im-create_photo-attached")}function Jo(e,t,n,a,r,i){$o(t).map(e=>geByClass1("_im_dialog"+e)).forEach(e=>removeClass(e,"olist_item_wrap_on")),t.reset(),Yo(n,e,a,!1,$o(t)),r.resetSelection(),Ho(e,n,i,!1,r,t)}function Zo(e,t,n,a,r,s,l){var d=$o(t),u=e.get(),g=geByClass1("_im_confirm_creation",n),m=uiSearch.getFieldEl(geByClass1(Ro,n)).value,p="add_member"===e.get().creationType,_=!p&&(m.length||d.length>1),h=geByClass1("_im_creation_show_history_input",n).checked;if(p)return e.set(i.addNewMember.bind(null,u.peer,d,h)).catch(e=>Object(ze.showFastBox)(Object(c.getLang)("global_error"),e)),Ho(e,n,s,"",r,t);if(Object(Do.lockButton)(g),!_)return f(d[0]);function f(i){Jo(e,t,n,a,r,s),function(e,t,n,a,r,i){Ho(e,t,n,!1,r,i),e.get().longpoll.push([Object(b.changePeer)(a,!1,!1,!1,"create_conversation")])}(e,n,s,i,r,t),Object(Do.unlockButton)(g),Object(o.isSearching)(e)?s().cancelSearch(e):s().restoreDialogs(e)}e.set(i.createChat.bind(null,u.next_chat_avatar,d,m)).then(()=>f(u.next_peer)).catch(e=>{Object(Do.unlockButton)(g),topMsg(Object(c.getLang)("global_unknown_error"),2,"#FFB4A3")})}function el(e,t){return Object(d.showTooltip)(e,{text:Object(c.getLang)("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function tl(e,t){var n=t&&t.get().selection.length;return{top:-1,bottom:Object(s.isClassicInterface)(e)?n>0?69:0:-1}}function nl(e,t,n){qo(e,t,n)}function al(e,t,n,a,r,i,s,o){return{show(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.setState({shown:!0}),Go(e,!0),cancelStackPush("im_create",s),addClass(e,"im-create_shown");var o=a.get().selection.reduce((e,t)=>(e[t.id]=!0,e),{});i&&i.forEach(t=>{if(!o[t[0]]){var n=e.querySelector("._im_dialog"+t[0]);r.addSelection(t[0],t[1]),n&&!n.classList.contains("olist_item_wrap_on")&&n.classList.add("olist_item_wrap_on")}}),function(e,t,n,a){toggleClass(e,"im-create_chat","chat"===a.get().creationType),toggleClass(e,"im-create_invite","add_member"===a.get().creationType);var r="chat"===a.get().creationType?Object(c.getLang)("mail_im_group_dialog"):Object(c.getLang)("mail_im_friends_tab"),i=geByClass1("_im_create_title",e);val(i,r),val(geByClass1("_im_confirm_creation",e),"add_member"===a.get().creationType?Object(c.getLang)("mail_im_create_chat_with"):Object(c.getLang)("mail_im_create_chat")),Yo(e,a,t,!1,n.get().selection.map(e=>e.id))}(e,n,a,t),setTimeout(()=>{t.get().longpoll.push([Object(b.transitionEvent)("create")]),attr(e,"aria-hidden","false"),r.focus()},1)},focusSearch(e){r.focus()},confirmCreate(e){o()},hide(n){n.get().shown=!1,Ho(n,e,t,!1,r,a)},scroll(e){n.scrollPage(e,!0)},updateScroll(){n.updateScroll()},selectElement(t){Ko(t,e,0,r,n,a,n.getHoveredElement())},hoverPrevElement(e){n.hoverPrevElement(Fo,null,tl(e,a))},hoverNextElement(e){n.hoverNextElement(Fo,null,tl(e,a))},unmount(){Object(f.destroyModule)(i),n.unmount(),r.unmount(),cancelStackFilter("im_create"),cur.recieveCropResult=void 0}}}function rl(e,t,n){var a=Object(E.default)({selection:[]}),r=K(geByClass1("_im_create_list",e),Object(E.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),()=>({idFn:e=>intval(e.peerId),hoverableFn:e=>hasClass(e,"_im_dialog"),renderFn:Vo.bind(null,a),more(e,n){var r;return t.get().shown?(t.get().creation_shown_all||!1!==Wo(a)?r=Promise.resolve([]):(t.get().creation_shown_all=!0,r=Object(i.searchTopConv)(Wo(a),t.get())),t.set(Uo.bind(null,[r],!1)),zo(r,Wo(a),t)):Promise.resolve(!1)},onClick(n,i){checkEvent(n)||(Ko(t,e,0,l,r,a,i),cancelEvent(n))}}));t.get().creationQuery=!1,t.get().creationType="chat";var s=geByClass1(Bo,e),o=Object(yt.debouncedPromise)(n=>function(e,t,n,a){var r=a.get(),i=Wo(r);r.selection.map(e=>e.id),n.unhoverElements(Fo),e.get().creationQuery=i,Yo(t,e,n,i)}(t,e,r,n),300),l=xo(s,a,()=>({selectionDeleted(n,a){qo(t,n,e),removeClass(geByClass1("_im_dialog"+a),"olist_item_wrap_on")},onChange:o})),c=Ho.bind(null,t,e,n,"cross",l,a),d=Qo.bind(null,t,e),u=Xo.bind(null,t,e),g=Jo.bind(null,t,a,e,r,l,n),m=Zo.bind(null,t,a,e,r,l,n),p=nl.bind(null,t,a,e),_=geByClass1("_im_create_cancel",e),b=geByClass1(Ro,e),v=b.querySelector(".ui_search_reset"),y=Object(f.createModule)({handlers:(t,n)=>{t(_,"click",c),t(_,"mouseover",el.bind(null,_)),t(geByClass1("_im_create_avatar",e),"click",d),t(geByClass1("_im_create_remove_avatar",e),"click",u),t(geByClass1("_im_cancel_creation",e),"click",g),t(b,"change",p),t(b,"input",p),t(b,"paste",p),t(v,"click",p),t(geByClass1("_im_confirm_creation",e),"click",m),t(e,"mouseover",Object(h.throttle)(r.unhoverElements.bind(r,Fo),100))}});return al(e,n,r,a,l,y,c,m)}function il(e,t){return t.state=e,Promise.resolve(t)}function sl(e,t,n,a,r){switch(t){case j.ARROW_UP:Object(s.isEditableFocused)()||(a.scroll(r,"up"),cancelEvent(n));break;case j.ARROW_DOWN:Object(s.isEditableFocused)()||(a.scroll(r,"down"),cancelEvent(n));break;case j.PAGE_UP:n.ctrlKey||Object(s.isClassicInterface)(r)||(a.scroll(r,"up",!0),cancelEvent(n));break;case j.PAGE_DOWN:n.ctrlKey||Object(s.isClassicInterface)(r)||(a.scroll(r,"down",!0),cancelEvent(n));break;case j.HOME:Object(s.isEditableFocused)()||(a.scroll(r,"up",!1,!0),cancelEvent(n));break;case j.END_KEY:Object(s.isEditableFocused)()||(a.scroll(r,"down",!1,!0),cancelEvent(n));break;case j.PRINTABLE:a.focustTxt(e)}}function ol(e,t,n,a,r,i){var o=Object(E.default)({state:t||"default"});return{signal(t,l){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(o.get().state){case"default":return sl(o,t,l,a,e);case"fwd":case"search":return function(e,t,n,a,r,i){switch(t){case j.ARROW_DOWN:a.hoverNextDialog(i),cancelEvent(n);break;case j.ARROW_UP:a.hoverPrevDialog(i),cancelEvent(n);break;case j.ENTER:Object(s.isEditableFocused)()&&!gpeByClass("_im_dialogs_search_input",document.activeElement)||a.selectHoveredDialog(i);break;case j.PRINTABLE:r.focusInput(i)}}(0,t,l,n,r,e);case"create":return function(e,t,n,a,r){switch(t){case j.PAGE_UP:!n.ctrlKey&&Object(s.isClassicInterface)(r)&&(a.scroll("up"),cancelEvent(n));break;case j.PAGE_DOWN:!n.ctrlKey&&Object(s.isClassicInterface)(r)&&(a.scroll("down"),cancelEvent(n));break;case j.ARROW_DOWN:a.hoverNextElement(r);break;case j.ARROW_UP:a.hoverPrevElement(r);break;case j.ENTER:gpeByClass("_im_dialogs_creation_name",document.activeElement)?a.confirmCreate(r):gpeByClass("im-create--search",document.activeElement)&&a.selectElement(r);break;case j.PRINTABLE:a.focusSearch(r)}}(0,t,l,i,e);case"message":return function(e,t,n,a,r){switch(t){case j.HOME:case j.END_KEY:a.isEmpty(r)&&sl(e,t,n,a,r);break;case j.PAGE_UP:case j.PAGE_DOWN:sl(e,t,n,a,r)}}(o,t,l,a,e);default:throw new Error("Unknown state: "+o.get().state)}},transition:e=>o.set(il.bind(null,e))}}var ll=n("BxOC"),cl=n("nJdr"),dl=n("V1Nw"),ul=n("ERyv");function gl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ml(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ml(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var pl={},_l=Date.now();function hl(e,t){var n=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&statlogsValueEvent("im_longpoll",1,n+"0x",t.getResponseHeader("x-frontend")),pl[n]=pl[n]?pl[n]+1:1,Date.now()-_l>=3e4&&(Object.keys(pl).forEach(e=>{statlogsValueEvent("im_longpoll",pl[e],e+"0x",t.getResponseHeader("x-frontend"))}),pl={},_l=Date.now()))}function fl(e){return e.updates.map(e=>{switch(e[0]){case 0:return b.deleteEvent(e);case 1:return b.replaceFlagsEvent(e);case 2:return b.setFlagsEvent(e);case 3:return b.resetFlagsEvent(e);case 4:return b.addMessageEvent(e);case 5:return b.editMessageEvent(e);case 6:return b.readInboundEvent(e);case 7:return b.readOutboundEvent(e);case 8:return b.gotOnlineEvent(e);case 9:return b.gotOfflineEvent(e);case 10:return b.resetDirectoriesEvent(e);case 11:return b.replaceDirectoriesEvent(e);case 12:return b.setDirectoriesEvent(e);case 13:return b.deleteDialogEvent(e);case 18:return b.replaceMessageEvent(e);case 19:return b.invalidateMessageEvent(e);case 51:return b.chatChangedEvent(e);case 52:return b.chatUpdatedEvent(e);case 63:return b.typingEvent(e);case 64:return b.recordingAudioEvent(e);case 70:return b.videoCallEvent(e);case 80:return b.unreadCountEvent(e);case 114:return b.notifySettingsChangedEvent(e);case 116:return b.refreshMessageEvent(e);case-1:return b.resyncEvent();default:return b.emptyEvent(e)}})}function bl(e,t){return Promise.resolve(extend({},t,{timeout:e<64?2*e:e}))}function vl(e,t){return Promise.resolve(extend({},t,{imTs:e}))}function yl(e){e.set(e=>Promise.resolve(extend({},e,{stopped:!0}))).then(()=>{e.get().cancelToken()})}function Ol(e,t){return t.cancelToken=e,Promise.resolve(t)}function Cl(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function jl(e){return e.pauses||(e.pauses=[]),Object(h.lplog)("Aborting all pauses","error"),e.pauses.forEach(e=>e()),e.pauses=[],Promise.resolve(e)}function El(e,t,n,a){var r=a.failed?Object(yt.abortablePause)(4,e):{},s=r.abort,o=r.pause;switch(a.failed){case 1:return Object(h.lplog)("Old timestamp, init resync","error"),e.set(Cl.bind(null,s)),n([b.resyncEvent()]),e.set(i.loadLongPollTs).then(o).then(Tl.bind(null,e,t,n));case 2:return Object(h.lplog)("Key is incorrect","error"),e.set(Cl.bind(null,s)),e.set(i.loadLongPollKey).then(o).then(Tl.bind(null,e,t,n));case 3:throw Object(ul.imWeirdLog)("im_longpoll_force_reload",a,!1),nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(vl.bind(null,a.ts)).then(()=>a)}}function Tl(e,t,n){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var a=e.get(),r=`${a.imUrl}/${a.imPart}`,i=Object(ll.plaingetCancelable)(r,{act:"a_check",key:a.imKey,version:9,ts:a.imTs,wait:25,mode:a.mode}),s=i.request,o=i.cancel;return e.set(Ol.bind(null,o)).then(()=>s).then(t=>{var n=gl(t,2),r=n[0],i=n[1];return i&&hl(a,i),e.set(bl.bind(null,1)),JSON.parse(r)}).catch(e=>{var t=gl(e,2),n=(t[0],t[1]);return n&&hl(a,n),Promise.reject(new Error(""))}).then(El.bind(null,e,t,n))}function Sl(e){var t=e.id,n=e.gid,a=e.key,r=e.ts,i=e.url,s=e.lhost,o=e.lpstat,l=new EventEmitter,c=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,d=fa((function(e,t){return c&&window.longpollTesting_onImEvents(t),l.trigger("data",t),Promise.resolve({})})),u=d.pause,g=d.resume,m=d.pushMessage,p=d.isPaused,_=d.reset,f=Object(E.default)({id:t,gid:n,mode:202,timeout:1,imKey:a,imTs:r,imPart:i,imUrl:s,pause:!1,stat:o});return function e(t,n,a){t.get().stopped||(Object(h.lplog)("New request"),Tl(t,a,n).then(fl).then(e=>(Object(h.lplog)("Request success","success"),e)).then(n).catch(e=>{if(!t.get().stopped)return Object(h.lplog)("Error, waiting: "+(e.message||"no message (probably browser reset)"),"error"),t.set(bl.bind(null,a()?2:t.get().timeout)).then(()=>{var e=Object(yt.abortablePause)(t.get().timeout,t),n=e.abort,a=e.pause;return t.set(Cl.bind(null,n)).then(a)});Object(h.lplog)("Stopped longpoll")}).then(e.bind(null,t,n,a)))}(f,m.bind(null,"main"),p.bind(null,"main")),{onData:e=>l.on("data",e),offData:e=>l.off("data",e),abortWaiting:()=>f.set(jl),stop:yl.bind(null,f),pause:u.bind(null,"main"),resume:g.bind(null,"main"),reset:_.bind(null,"main"),push:e=>l.trigger("data",e),isEnabled:()=>!f.get().pause&&!f.get().stopped}}var wl=n("1+Fu");function Il(e){var t=e.get().isCoronaBotLinkShown,n=e.get().coronaBotPeer,a=e.get().tabbedPeers.map(t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer]).filter(e=>e).filter(e=>!(e.deletedDialog||t&&e.peerId===n)).map(e=>({type:"peer",peer:e.peerId}));return a.length>0&&(a=[{type:"sep"}].concat(a)),t&&(a=[{type:"sep"},{type:"coronaBot",peer:n}].concat(a)),a}function kl(e,t){if("sep"===t.type)return getTemplate("im_right_menu_sep",{});if("coronaBot"===t.type){var n=e.get().coronaBotPeer,a=`${Object(s.getBaseLink)(e)}?sel=${n}&tab=${e.get().active_tab}`;return getTemplate("im_right_menu_tpl",{href:a,label:getLang("mail_corona_bot"),peer:n,attrs:`title="${getLang("mail_corona_bot")}" `,cls:"im-right-menu--corona-bot"})}var r=`${Object(s.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,i=Object(s.getBareTab)(t.peer,e),o=i.tab;return o=getTemplate("im_right_menu_ct",{name:o,count:i.unread>0?i.unread:""}),getTemplate("im_right_menu_tpl",{href:r,label:o,peer:t.peer,attrs:`title="${stripHTML(i.tab)}"`,cls:i.unread>0?"im-right-menu--unread":""})}function Ml(e,t,n,a){var r=gpeByClass("_im_peer_tab",a),s=intval(domData(r,"list-id")),o=e.get().tabbedPeers.filter(e=>e.peer!==s);return e.set(i.updateTabbedPeers.bind(null,o,!0)).then(()=>{if(Al(t,e),s===e.get().peer)e.get().longpoll.push([Object(b.resetPeer)()]);else if(0!==e.get().peer){var n=gpeByClass("_im_right_menu",a);uiRightMenu.hideSliding(n)}}),cancelEvent(n),!1}function Al(e,t){return e.pipeReplace(Promise.resolve(Il(t)))}function Ll(e,t,n,a){return{updateMenu(t){!function(e,t){geByClass("_im_peer_tab",e).forEach(e=>{var n=Object(_i.fromQueryString)(attr(e,"href").split("?")[1]);n.tab!==t.get().active_tab&&attr(e,"href",`${Object(s.getBaseLink)(t)}?sel=${n.sel}&tab=${t.get().active_tab}`)})}(e,t);var a=gpeByClass("_im_right_menu",e);Al(n,t).then(()=>{var e;(e=t.get().peer?ge("ui_rmenu_peer_"+t.get().peer):ge("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(a)})},updateName(e,t){var n=ge("ui_rmenu_peer_"+e);if(n){var a=geByClass1("_im_r_tx",n),r=t.get().tabs[e].tab;val(a,r)}},updateCounter(e,t){var n=ge("ui_rmenu_peer_"+t);if(n){var a=geByClass1("_im_r_ct",n),r=e.get().tabs[t].unread;val(a,r>0?r:""),toggleClass(n,"im-right-menu--unread",r>0)}},unmount(){Object(f.destroyModule)(a),n.unmount()}}}function Pl(e,t,n){1===n.which&&(e.get().peer&&e.get().longpoll.push([Object(b.resetPeer)()]),e.get().longpoll.push([Object(b.changeTab)(t)]),cancelEvent(n))}function Nl(e,t,n){var a=K(e,Object(E.default)({limit:50,offset:0,noScroll:!0,elements:Il(t)}),()=>({idFn:e=>e.peer||"000",renderFn:kl.bind(null,t)})),r=Ml.bind(null,t,a),i=Object(f.createModule)({handlers:(n,a)=>{a(e,"click","_im_r_cl",r),a(e,"click","_im_peer_tab",(e,n)=>{if(!checkEvent(e)){var a=intval(domData(n,"list-id")),r=Object(h.unpackStore)(t);r.isCoronaBotLinkShown&&r.coronaBotPeer===a&&Object(Ve.statlogsCoronaBotLinkClickEvent)(),r.longpoll.push([Object(b.changePeer)(a,!1,!0,!0)]),cancelEvent(e)}}),j.FOLDERS.forEach(a=>{n(geByClass1("_ui_item_"+a,e.parentNode),"mousedown",Pl.bind(null,t,a))})}});return Ll(e,0,a,i)}function xl(e){var t=e.get().tabs,n=e.get().peer,a=Object.keys(t).filter(t=>Object(s.isFullyLoadedTab)(e,t)&&intval(t)!==n).map(e=>t[e]);a.filter(e=>Date.now()-e.last_visited>54e6).forEach(t=>e.set(i.cleanTab.bind(null,t.peerId))),a.filter(t=>Object(s.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5).forEach(t=>e.set(i.stringifyTab.bind(null,t.peerId)))}function Dl(e){var t=setInterval(xl.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}function Rl(e){return e.which||e.keyCode}function Bl(e,t,n){!n||inArray(Rl(n),j.UNPRINTABLE_KEYS)||Object(i.isSearchingInplace)(e.get().peer,e.get())||Object(s.isEditableFocused)()||n.ctrlKey||browser.mac&&n.metaKey||n.key&&1!==n.key.length||t.signal("printable",n)}function Fl(e,t,n){Rl(n)===j.ENTER&&e.signal(Rl(n),n)}function Hl(e,t,n,a){var r=Rl(a);if(!layers.visible){if(r>=49&&r<=57&&(a.ctrlKey||a.metaKey&&browser.mac)&&Object(s.isClassicInterface)(t))return function(e,t){var n=e.get().tabbedPeers[t];n&&e.get().longpoll.push([Object(b.changePeer)(n.peer,!1,!0,!0)])}(t,r-49),cancelEvent(a);inArray(r,j.UP_DOWN_CONTROLS)&&e.signal(r,a)}}function Ul(e,t){var n=browser.mozilla?"keydown":"keypress",a=Object(E.default)({signalTimer:!1}),r=Bl.bind(null,e,t),i=Hl.bind(null,t,e,a),s=Fl.bind(null,t,a),o=Object(f.createModule)({handlers:(e,t)=>{e(document,"keydown",i),e(document,"keyup",s),e(document,n,r)}});return{unmount(){Object(f.destroyModule)(o)}}}function Gl(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function ql(e,t){var n=e?e.indexOf(t):-1;return-1!==n&&(e.splice(n,1),!0)}function Kl(e,t,n,a,r,l){var c=Object(o.getTab)(e,t);switch(n){case b.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case b.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return n===b.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?Gl(c.adminIds,a):ql(c.adminIds,a),Vl(e,t,r),!0;case b.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return c.data.flags=a,Vl(e,t,r),!0;case b.MAIL_CHAT_UPDATE_TYPE_PINNED:return delete c.pinHideId,cur.imDb.update(li.PIN_HIDDEN_ID_OP,[c.peerId,void 0]),!1;case b.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:return function(e,t,n){if(Object(s.isTabLoaded)(n.get(),e)){var a=Object(o.getTab)(n,e);Gl(a.memberIds,t)&&a.membersCount++,-1===a.data.active.indexOf(t)&&a.data.active.push(t),t===vk.id&&(a.data.kicked=0,a.data.closed=0)}return n.set(i.loadChatMember.bind(null,{[e]:[t]})).then(()=>{if(t===vk.id&&n.get().peer===e)return Promise.all([n.set(i.getPinnedMessage.bind(null,e)),n.set(i.loadKeyboard.bind(null,e))])})}(t,a,e).then(()=>(Wl(e,t,r,l),r.fixKeyboard())),!0;case b.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case b.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,n,a,r){if(Object(s.isTabLoaded)(a.get(),e)){var l=Object(o.getTab)(a,e);ql(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter(e=>e!==t),t===vk.id&&(n?l.data.kicked=1:l.data.closed=1)}return t===vk.id&&a.get().peer===e?(r.cancelEditing(),a.set(i.unpinMessageOptimistic.bind(null,e))):Promise.resolve()}(t,a,n===b.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,r).then(()=>Wl(e,t,r,l)),e.get().id!==a&&(Object(o.getKeyboard)(e,t)||{}).author_id!==a||e.set(i.deleteKeyboard.bind(null,t)).then(()=>r.fixKeyboard()),!0;case b.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set(i.loadBanner.bind(null,t)).then(()=>r.updateBanner(e)),!0;case b.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case b.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;default:return!1}}function Vl(e,t,n){e.get().peer===t&&(Object(i.setActions)(e.get()),n.updateActions(e))}function Wl(e,t,n,a){e.get().peer===t&&(Object(i.setActions)(e.get()),n.updateChat(e,t),a.updateDialog(t,e))}var $l=n("gF8j"),zl=n("ambf");function Yl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ql(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ql(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Xl(e,t,n,a,r){var l=r.reduce((e,t)=>(e[t.peerId]||(e[t.peerId]=[]),e[t.peerId].push(t.messageId),e),{});Object.keys(l).forEach(r=>{var c=l[r],d=Object(o.getTab)(e,r),u=d&&!d.offset,g=d&&d.inplaceSearch&&!!d.searchOffset;e.set(i.removeMessages.bind(null,c,r)).then(()=>e.set(i.removeMessagesMarkDeleted.bind(null,c,r))).then(()=>{if(e.get().peer===+r&&Object(s.isFullyLoadedTab)(e.get(),r)){var n=Object(o.getTab)(e,r);t.removeMessages(c,+r,e);var a=n.inplaceSearch;if(!n.offset&&!u&&(Object(i.setActions)(e.get()),t.updateActions(e),a||t.showEmptyScreen()),a&&g&&!n.searchOffset&&(t.showSearchResults(),browser.safari)){var l=geByClass1("_im_peer_history_w");l.style.display="none",setTimeout(()=>l.style.display="",0)}}}).then(()=>{var s=Object(o.getTab)(e,r),l=s&&c.some(e=>e>=s.lastmsg),d=s&&c.filter(e=>e>s.in_up_to);l?Object(i.loadActualLastMessage)(e,+r).then(()=>{n.promoteDialog(e,r),a&&a.updateCounter(e,r),t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0)}):d&&Object(i.removeUnreadDeletedMsgsFromTab)(r,d,e.get()).then(()=>n.updateDialog(r,e))})})}function Jl(e,t){"spam"===t?Object(s.showSpamLayer)(e,Co,{}):"fav"===t&&Object(s.showFavvedBox)(e,{},qs,{})}function Zl(e,t){if(e.get().gid){var n=t.parentNode,a=geByClass("_im_right_menu_counter",n),r=e.get().dialog_tab_cts;a.forEach(e=>{var t=domData(e,"tab");val(e,r[t]||"")})}}function ec(e,t,n,a,r){e.forEach(e=>{switch(e.kludges.source_act){case s.CHAT_PHOTO_REMOVE:case s.CHAT_PHOTO_UPDATE:!function(e,t,n,a){t.set(i.updateChatPhoto.bind(null,e)).then(()=>{var r=e.kludges.source_act;n.updateDialog(e.peerId,t),a.updateChatPhoto(e,r,t)})}(e,t,n,a)}})}function tc(e,t){var n=e.get().longpoll.push.bind(null,[b.resetPeer()]),a=()=>{var r=e.get().selectedMessages;r&&r.length?(e.setState({selectedMessages:[]}).then(()=>{t.changedMessageSelection(e),t.cleanSelection(r)}),setTimeout(()=>cancelStackPush("im_peer",a),0)):n()};cancelStackPush("im_peer",a)}function nc(e){var t=e.attaches.filter(e=>"sticker"!==e.type&&"call"!==e.type);return Object(l.isServiceMsg)(e)||0===t.length}function ac(e,t,n){addClass(n,"im-page_history-show"),t.loadingPeer(e)}function rc(e,t){var n=function(e,t){var n=document.querySelector("._im_aside_notice"),a=Object(s.isCommunityInterface)(e)?236:120;return a+=10,a+=n?n.offsetHeight:0,Math.floor((t.offsetHeight-a)/32)}(e,t);if(e.get().tabbedPeers.length>n){var a=e.get().tabbedPeers.filter(t=>{var n=t.peer;return intval(n)!==e.get().peer}).map(t=>{var n=t.peer;return e.get().tabs[n]}).sort((e,t)=>t.last_touched-e.last_touched),r=[];0!==e.get().peer&&r.push(e.get().tabs[e.get().peer]);var o=r.concat(a).slice(n).map(e=>e.peerId),l=e.get().tabbedPeers.filter(e=>!inArray(e.peer,o));return e.set(i.updateTabbedPeers.bind(null,l,!0))}return Promise.resolve(e)}function ic(){for(var e=curBox();e;)e.hide(),e=curBox()}function sc(e,t,n,a,r,l,c,d,u){e.get().audio_msg.isRecording&&e.set(i.cancelRecording).then(()=>{a.cancelRecording()}),AudioMessagePlayer.detachPlayer(),Object(o.isAnyMessageBeingEdited)(e)&&a.cancelEditing(),Object(o.isSearching)(e)&&t.cancelSearch&&(r.clearSearch(e),n.restoreDialogs(e),u().toggleSettingsButton(e,!1)),oc(e,d,u),ac(e,a,l);var g=e.get().peer;Object(i.updateMentions)(e.get()),Object(i.videoAutoPlayHandler)(),Object(s.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!Object(o.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!Object(o.getMessage)(e,t.peerId,Object(o.getTab)(e,t.peerId).lastmsg)||Object(o.getTab)(e,t.peerId).skipped)&&e.mutate(e=>Object(o.makeTabNotFullyLoaded)(e,t.peerId));var m=e.set(i.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then(e=>{var n=e.get(),a=i.loadPeer.bind(null,t.peerId,!1,t.msgid,!1,n);return n.tabs[t.peerId]?Promise.resolve(n):e.set(a)}).then(()=>{n.selectPeer(t.msgid,e),function(e,t){Object(s.isPendingForward)(e)&&(cancelStackFilter("forward"),e.set(i.forwardMessages.bind(null,e.get().pendingForward,Object(o.getTabDraft)(Object(o.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),ic(),a.preparePeer(e),tc(e,a),Object(s.isClassicInterface)(e)&&(n.deactivate(),rc(e,l).then(()=>c.updateMenu(e)),Object(s.updateMessageRequestsCounterInDOM)(e))});return(m=t.msgid?m.then(()=>e.set(i.selectPeerOnMessage.bind(null,t.peerId===g,g))):m.then(()=>e.set(i.selectPeer.bind(null,!0)))).then(()=>e.set(i.prepareCasperMessagesFromMessages.bind(null,t.peerId))).then(()=>{if(e.get().peer===t.peerId){if(t.forward){var n=e.get().tabs[e.get().peer];!n.scrollBottom&&n.unread&&e.set(i.readLastMessages.bind(null,e.get().peer))}Object(s.isClassicInterface)(e)&&c.updateMenu(e),a.changePeer(e,!1),a.updateTyping(t.peerId,e),a.removeExpiredFailedMessages(t.peerId),Object(i.updateMentions)(e.get()),r.updateCoronaBotLinkState(e)}}).catch(e=>Object(ul.imWeirdCatch)("applyNewPeer",e))}function oc(e,t,n){t&&e.get().shown&&(t.hide(e),n().createCanceled(e))}function lc(e,t,n){Object(o.isSearching)(e)&&(t.clearSearch(e),n.restoreDialogs(e))}function cc(e,t,n,a,r,o,l){Object(s.isClassicInterface)(e)&&(r.saveScroll(e),o.saveScroll(e)),a.rotateCross(e),addClass(l,"im-page_creating"),e.setState({isCreating:!0}),n&&n.show(e,t),Object(s.isClassicInterface)(e)&&(setStyle(l,{height:_c(l,e).page}),setTimeout((function(){addClass(l,"im-page_cropped")}),200)),Object(i.toggleConversation)(!0)}function dc(e,t,n,a){Object(s.isTabLoaded)(e.get(),a)&&(t.updateTyping(a,e),n.updateTyping(a,e))}function uc(e,t,n,a,r){a.activityType||(a.activityType=r);var o=e=>dc(e,t,n,a.peerId);Object(s.isSelfMessage)(a.peerId,e.get().gid)||(e.set(i.setActivity.bind(null,a,r)).then(o),e.set(i.waitActivity.bind(null,a,r)).then(o))}function gc(e,t){t?e.classList.add("im-page_reconnecting"):e.classList.remove("im-page_reconnecting")}function mc(e,t,n,a,r,c,d,u,g,m,p,_,h,v,y,O,C,E,T,S,w){var I=!1;return{changePeer(e,n){t.selectPeer(e,n)},cancelSearch(e){lc(e,a,t)},loadingPeer(e){ac(e,n,r)},restoreDialogs(e,n,a){t.restoreDialogs(e,n,a)},toggleSettingsButton(e,t){p.toggleButton(e,t)},focusSearch(e){a.focusInput(e)},appendSearch(e,n,a,r){t.appendSearch(e,n,a,r)},appendDialogs(e,n){t.appendDialogs(e,n)},showCreation(e,i){cc(e,i,m,a,t,n,r)},updateState(e,a){t.updateDialog(e,a),a.get().peer===e&&n.updateChat(a,e)},appendFastDialogs(e,n){t.appendFastDialogs(e,n,!0)},createCanceled(e,i){a.createCanceled(e,i),Object(s.isClassicInterface)(e)?(setStyle(r,{height:"auto"}),removeClass(r,"im-page_cropped"),setTimeout(()=>a.focusInput(e),0),0===e.get().peer?t.restoreScroll(e):n.restoreScroll(e,e.get().peer)):setTimeout(()=>{0===e.get().peer?a.focusInput(e):n.focustTxt(e)},0),removeClass(r,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){O&&O.updateMenu(e)},goToHistoryEnd(){n.goToEnd()},updateDialog(e,n){t.updateDialog(e,n)},focusTxt(e){n.focustTxt(e)},resync(e){Object(o.isSearching)(e)&&a.clearSearch(e),t.restoreDialogs(e,!0,!0),t.focusOnSelected(e),m&&m.hide(e),Object(s.isCommunityInterface)(e)&&Zl(e,r),Object(s.isClassicInterface)(e)&&(e.get().tabbedPeers.forEach(t=>{var n=t.peer;O.updateCounter(e,n),O.updateName(n,e)}),Object(s.updateMessageRequestsCounterInDOM)(e)),n.cleanSelection(e.get().selectedMessages||[]),n.cancelSearch(e,!0),Object(s.isReservedPeer)(e.get().peer)||n.changePeer(e,!1);var i=e.get().gid?"l_mgid"+e.get().gid:"msg";handlePageCount(i,e.get().unread_cnt)},toggleSettingsLoader(e,t){p.toggleLoader(e,t)},onUserActions(e,t){if(!Object(i.isSearchingInplace)(e.get().peer,e.get())){var a=e.get(),r=a.peer;if(Object(s.isFullyLoadedTab)(a,r))if(!c.is_idle)if(Object(o.countUnread)(e.get().peer,e.get())>0)!a.tabs[r].skipped&&n.isNewMessagesVisible(e)&&(n.hideGoToEnd(!0),n.hideGoToMention(!0),e.set(i.readLastMessages.bind(null,r)))}},removeSelection(e){t.removeSelection(e),a.focusInput(e)},route(e,o,l,c){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var d=!1;return!!(e.mr||e.invite_chat_id&&l.invite_hash)||(c&&c.params&&"left_nav"===c.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach(e=>{switch(e){case"sel":l.q||(d=!0);var u=l.sel?Object(s.unUrlPeer)(l.sel):0,p=c.back;0===u?_.get().longpoll.push([b.resetPeer(!1,p)]):u!==_.get().peer&&_.get().longpoll.push([b.changePeer(u,l.msgid||!1)]);break;case"invite_chat_id":case"invite_hash":!function(e){e.set(i.leaveInvitation)}(_);break;case"tab":oc(_,m,g),d=!0;var h=l.tab||j.FOLDER_ALL;_.get().longpoll.push([b.changeTab(h)]);break;case"act":l.act&&"create"===l.act?cc(_,[],m,a,t,n,r):function(e,t,n,a){n&&n.hide(e,t)}(_,[],m);break;case"st":l.st&&l.sel?(curBox()&&curBox().hide(),_.mutate(i.setInplaceSearch.bind(null,unescape(l.st),l.sel)),n.startSearch(_)):(_.mutate(i.cancelSearch.bind(null,o.sel)),n.cancelSearch(_,!0));break;case"q":l.q?(curBox()&&curBox().hide(),a.setSearch(_,l.q,!0)):a.clearSearch(_);break;case"box":Jl(_,l.box)}}),Object(s.isClassicInterface)(_)&&void 0===e.sel&&O.updateMenu(_),d&&lc(_,a,t),!1)},updateDialogFilters(e){Object(o.isSearching)(e)||t.restoreDialogs(e),p.updateFilter(e)},removePeer(e,n){t.removeDialog(e,n),t.saveScroll(e),e.get().peer===n&&e.get().longpoll.push([b.resetPeer()]),Object(s.isClassicInterface)(e)&&O.updateMenu(e)},newMessage(e){Object(s.isClassicInterface)(e)||t.scrollUp(!0)},onEvents(e,_){var f=function(e){for(var t=!1,n=e.length-1;n>=0;n--)e[n].type!==b.UNREAD_COUNT||t?e[n].type===b.UNREAD_COUNT&&e.splice(n,1):t=!0;return e}(_.filter(e=>e.type!==b.ADD_MESSAGE||!(e.flags&b.FLAG_STEALTH))),v=_.filter(l.isServiceMsg),y=_.filter(e=>e.type===b.ADD_MESSAGE);ec(v,e,t,n);var C=Object(i.checkNewPeople)(v,y,e),E=Promise.resolve();C.shouldLoad&&(E=e.set(i.loadNewPeople.bind(null,C,d))),E.then(()=>{f.forEach(d=>{switch(d.type){case b.ADD_MESSAGE:var _=Object(o.getTab)(e,d.peerId),f=!_||!_.msgs||0===_.msgs.length,v=Object(s.getMessageStoreStatus)(d,e.get()),y=Object(o.isCommunityBlocked)(e,d.peerId),C=!_.offset,E=null;if(d.kludges.keyboard&&!d.kludges.keyboard.inline){var T=Object.assign(d.kludges.keyboard,{author_id:d.userId});E=e.set(i.setKeyboard.bind(null,d.peerId,T))}else{var w=Object(o.getKeyboard)(e,d.peerId);w&&w.one_time&&w.author_id!==Object(l.getAuthorId)(e,d)&&(E=e.set(i.deleteKeyboard.bind(null,d.peerId)))}switch(d.peerId===Object(o.getPeer)(e)&&E&&E.then(()=>n.fixKeyboard()),Object(l.isCasperMessage)(d)&&zl.casperMessagesStore.add(d),v){case s.MSG_NEW:e.set(i.addMessage.bind(null,d)),rc(e,r),function(e,t){var n=e.get().tabs[t.peerId],a=e.get().active_tab;return a===j.FOLDER_ALL||Object(i.filterFromTab)(a)(n)}(e,d)&&(Object(o.tabIsMessageRequest)(_)||(d.flags&b.FLAG_OUTBOUND||e.set(i.updateFavAndTitle.bind(null,d.peerId,!0)),function(e,t){var n=t.flags&b.FLAG_OUTBOUND,a=inArray(t.peerId,e.get().mutedPeers),r=t.flags&b.FLAG_DELETED,i=e.get().gid;if(!n&&!a&&!r){var o,l,c=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",d=(c?c+" ":"")+t.text||"",u=t.userId,g=t.peerId,m=e.get().tabs[g];if(t.kludges&&t.kludges.source_act&&(d=stripHTML(Object(s.renderServiceMsg)(e,t,m,!1))),(!e.get().notify_msg&&!Object(s.isChatPeer)(g)||i&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:g}),!Object(s.isChatPeer)(g))return;d=trim(replaceEntities(stripHTML(d.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),d=Object(ci.replaceMentions)(d,(e,t,n,a,r)=>r),Object(s.isChatPeer)(g)?(o=Object(W.oCacheGet)(e,u).name,m.tab&&(o+=" » "+m.tab),l=Object(W.oCacheGet)(e,u).photo):(o=m.tab,l=m.photo);var p=t.attaches[0];if(p&&"mail"===p.type)d+="\n["+getLang("mail_added_msgs")+"]";else if(p){var _="doc"===p.type&&"graffiti"===p.kind?"graffiti":p.type;d+="\n["+getLang("mail_added_"+_)+"]"}o=trim(replaceEntities(stripHTML((o||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:d,author_id:g,title:o,author_photo:l})}}(e,d)),t.updateTyping(d.peerId,e),Object(o.isSearching)(e)?t.updateDialog(d.peerId,e):t.promoteDialog(e,d.peerId));var k=Object(o.isCommunityBlocked)(e,d.peerId),M=!_.offset;(y&&!k||C&&!M)&&n.updateActions(e),Object(s.isClassicInterface)(e)?(O.updateCounter(e,d.peerId),O.updateMenu(e)):p.updateFilter(e),e.set(i.updateActivity.bind(null,d)).then(dc.bind(null,e,n,t,d.peerId)),n.addMessage(e,d),nc(d)||!Object(s.isFullyLoadedTab)(e,d.peerId)||d.local||e.set(i.loadMedia.bind(null,d)).then(e=>{n.replaceAttachmentPlaceholders(e,d),Object(i.videoAutoPlayHandler)()}),Object(Ve.statlogsSendingTimeStart)(e,d,"send","opt_to_lp");break;case s.MSG_LOCAL_DUPLICATE:nc(d)||e.set(i.loadMedia.bind(null,d)).then(e=>{n.replaceAttachmentPlaceholders(e,d)}),e.set(i.replaceMessage.bind(null,d)),n.replaceMessageAttrs(d,e),t.updateDialog(d.peerId,e),d.randomId&&Object(Ve.statlogsSendingTimeEnd)(e,d,"send","opt_to_lp");break;case s.MSG_DUPLICATE:Object(o.isSearching)(e)||t.promoteDialog(e,d.peerId)}Object(o.tabIsMessageRequest)(_)&&Object(s.checkMessageRequestsTab)(e,t.update),_&&f&&_.peerId===Object(o.getPeer)(e)&&S();break;case b.EDIT_MESSAGE:case b.REPLACE_MESSAGE:e.set(i.editMessage.bind(null,d)).then(e=>{if(d.kludges.is_expired)return Object(s.removeExpiredMessageIfNeed)(d,n.handleMessageExpiration),void t.updateDialog(d.peerId,e);t.updateDialog(d.peerId,e),n.updateTyping(d.peerId,e),n.editMessage(e,d),nc(d)||!Object(s.isFullyLoadedTab)(e,d.peerId)||d.local||e.set(i.loadMedia.bind(null,d)).then(e=>n.replaceAttachmentPlaceholders(e,d))});break;case b.INVALIDATE_MESSAGE:break;case b.READ_INBOUND:e.set(i.markInboundMessagesAsRead.bind(null,d)).then(e=>{t.updateCounter(e,d.peerId),n.updateGoToEnd(e,!0),n.updateGoToMention(e,!0),n.updateObserver(),Object(s.isClassicInterface)(e)&&O.updateCounter(e,d.peerId),Object(o.isSearching)(e)||t.restoreDialogs(e),p.updateFilter(e)});break;case b.READ_OUTBOUND:e.set(i.markOutboundMessagesAsRead.bind(null,d)).then(e=>{t.updateCounter(e,d.peerId),n.markMessagesAsRead(e,d)});break;case b.UNREAD_COUNT:e.set(i.updateUnreadCount.bind(null,d.count)).then(()=>{var t=e.get().gid?"l_mgid"+e.get().gid:"msg";handlePageCount(t,d.count),p.updateFilter(e),Object(s.isClassicInterface)(e)&&Zl(e,r)});break;case b.GOT_ONLINE:case b.GOT_OFFLINE:var A=d.type===b.GOT_ONLINE;e.set(i.updateOnline.bind(null,d.userId,!!A&&d.platform,d.lastSeenTs)).then(e=>{Object(s.isTabLoaded)(e.get(),d.userId)&&(t.updateOnline(d.userId,e),n.updateOnline(d.userId,e))});break;case b.SET_FLAGS:case b.REPLACE_FLAGS:case b.RESET_FLAGS:if(!(d.flags&b.FLAG_DELETED||d.flags&b.FLAG_SPAM)||d.type!==b.SET_FLAGS||Object(s.isAlreadyDeleted)(e,d.peerId,d.messageId)||e.get().blockedFlagUpdates[d.peerId]||u(d),d.flags===b.FLAG_IMPORTANT){var L=d.type===b.SET_FLAGS;e.set(i.updateImportant.bind(null,L?1:-1,d.messageId)).then(()=>{Object(s.isClassicInterface)(e)||a.updateImportantCnt(e)}),e.set(i.updateFavMessage.bind(null,[d.messageId],d.peerId,L)).then(()=>{n.markImportant(d.messageId,L,e)})}break;case b.RECORDING_AUDIO:uc(e,n,t,d,i.ACTIVITY_TYPE_RECORDING_AUDIO);break;case b.TYPING:uc(e,n,t,d,i.ACTIVITY_TYPE_TYPING);break;case b.NOTIFY_SETTINGS_CHANGED:!function(e,t,n,a){e.set(i.setMutedPeer.bind(null,n,a)).then(t().updateState.bind(null,n))}(e,g,d.peerId,!d.sound);break;case b.RESYNC:e.get().longpoll.pause(),e.set(i.resync).then(g().resync).then(()=>e.get().longpoll.resume());break;case b.TRANSITION:h.transition(d.state);break;case b.RESET_PEER:if(d.removeActivePeer){var P=e.get().tabbedPeers.filter(t=>{var n=t.peer,a=t.type;return n!==e.get().peer&&"perm"===a});e.setState({tabbedPeers:P})}!function(e,t,n,a,r){e.set(i.cancelRecording).then(()=>{n.cancelRecording()}),AudioMessagePlayer.detachPlayer(),t.removeSelection(e),removeClass(a,"im-page_history-show"),t.updateStarPosition(),n.stopLoading(),n.destroyPeerProfile(),Object(o.isAnyMessageBeingEdited)(e)&&n.cancelEditing();var l=e.get().peer;e.set(i.changePeer.bind(null,0,!1,!1)).then(()=>{window.tooltips&&window.tooltips.hideAll(),ic(),Object(s.isClassicInterface)(e)&&t.activate(),n.changePeer(e),Object(s.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout(()=>{e.get().longpoll.push([b.transitionEvent("search")])},13),Object(s.isLocksAvailable)(e)&&Object(s.isPeerBlockedByMe)(l,e)&&e.set(i.releaseBlock.bind(null,l)),r.updateCoronaBotLinkState(e)})}(e,t,n,r,a),t.renderPeerTags(e),d.cancelSearch&&lc(e,a,t),Object(s.isClassicInterface)(e)&&O.updateMenu(e),a.focusInput(e);break;case b.CHANGE_TAB:Object(o.isSearching)(e)&&a.clearSearch(e),Object(s.changeTab)(d.tab,e,g,i.changeDialogsTab).then(e=>{p.updateFilter(e)});break;case b.RESET_DIRECTORIES:case b.SET_DIRECTORIES:case b.REPLACE_DIRECTORIES:var N=d.type,x=d.peerId,D=d.mask;if(D===b.FOLDER_HAS_BANNER)break;var R=D===b.FOLDER_AD_TAG;e.set(i.updateFolderState.bind(null,x,D,N,d.local,R)).then(e=>{Object(o.isSearching)(e)||N===b.RESET_DIRECTORIES&&D===j.FOLDER_MASKS[j.FOLDER_IMPORTANT]||N===b.RESET_DIRECTORIES&&D===j.FOLDER_MASKS[j.FOLDER_MESSAGE_REQUEST]||N===b.SET_DIRECTORIES&&D===j.FOLDER_MASKS[j.FOLDER_MESSAGE_REQUEST_REJECTED]||N===b.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(x,e),Zl(e,r),e.get().peer===x&&n.changedMessageSelection(e)});break;case b.DELETE_DIALOG:e.set(i.deletedDialog.bind(null,d.peerId,Promise.resolve([]))).then(()=>{g().removePeer(e,d.peerId),g().updateDialogFilters(e)});break;case b.CHANGE_PEER:sc(e,d,t,n,a,r,O,m,g);break;case b.MUTEX:var B={[d.peerId]:d},F=Object(s.isPeerBlocked)(d.peerId,e);e.set(i.updateBlockStates.bind(null,B)).then(()=>{t.updateDialog(d.peerId,e);var a=Object(s.isPeerBlocked)(d.peerId,e);Object(s.isFullyLoadedTab)(e.get(),d.peerId)&&F!==a&&n.updateChat(e,d.peerId)});break;case b.FAILED_MESSAGE:e.set(i.setMessageErrored.bind(null,d.peer,d.message)).then(()=>{n.setMessageErrored(d.peer,d.message,d.error,e),t.setDialogFailed(d.peer,d.message.messageId,e)});break;case b.RESEND:var H=d.message.messageId;e.set(i.resendMessage.bind(null,d.peerId,H,d.message)).then(()=>{n.resendMessage(d.peerId,H),t.promoteDialog(e,d.peerId)});break;case b.CONVERSATION_UPDATED:if(Object(s.isTabLoaded)(e.get(),d.peerId))Kl(e,d.peerId,d.updateType,d.updateArg,n,t)||g().reloadChatInfo(d.peerId);if(Object(o.isMessageRequestChangedEvent)(d)){var U=Promise.resolve();d.updateArg!==b.MESSAGE_REQUEST_STATUS_NEW&&(U=e.set(i.deletedDialog.bind(null,d.peerId,Promise.resolve([]))).then(()=>{g().removePeer(e,d.peerId),g().updateDialogFilters(e)})),U.then(()=>e.set(i.updateMessageRequestsCounter.bind(null,d))).then(()=>{Object(s.updateMessageRequestsCounterInDOM)(e),Object(s.checkMessageRequestsTab)(e,t.update)})}break;case b.WAITING_FOR_RECONNECT:setTimeout(()=>{gc(r,!0),n.setNetworkWaitingStatus(d.timeout-1)},1e3);break;case b.RECONNECTING:gc(r,!0),n.setNetworkReconnectingStatus();break;case b.RECONNECTED:gc(r,!1),setTimeout(n.clearNetworkStatus,0),browser.chrome&&!Object(s.isClassicInterface)(e)&&e.get().peer&&(c.is_idle?I||(c.once("unidle",()=>{I=!1,t.forceScrollReinit()}),I=!0):t.forceScrollReinit())}})})},updateHistory:e=>n.updateHistory(e),reloadChatInfo(e){Object(s.isTabLoaded)(_.get(),e)&&_.set(i.loadChatInfo.bind(null,e)).then(()=>function(e,t,n,a,r){a.updateChatTopic(t,e),Object(s.isClassicInterface)(e)&&r.updateName(t,e),e.get().peer==t&&(Object(i.setActions)(e.get()),a.updateActions(e))}(_,e,0,n,O))},cancelRecording:()=>_.set(i.cancelRecording).then(()=>n.cancelRecording()),fixHeight(){S()},unmount(){Object(f.destroyModule)(e),clearInterval(_.get().update_title_to),c.stop(),w(),zl.casperMessagesStore.destroy(),t.unmount();var r=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_logo"+r+".ico"),n.unmount(),a.unmount(),cancelStackFilter("im_peer"),p.unmount(),m&&m.unmount(),O&&O.unmount(),C&&C(),v&&v(),Object(s.isLocksAvailable)(_)&&_.get().peer&&_.set(i.releaseBlock.bind(null,_.get().peer)),E.unmount(),O&&O.unmount(),T.unmount(),clearInterval(y),cur.imDb.unmount(),cur.imDb=!1}}}function pc(e,t,n,a){var r=t.get();Object(s.isReservedPeer)(r.peer)||e().onUserActions(t,a),r.update_old_title&&t.set(i.updateFavAndTitle.bind(null,!1,!1))}function _c(e,t){var n=ge("page_header"),a=geByClass1("_im_page_history",e),r=window.clientHeight()-n.offsetHeight-30-2,i=Object(s.isClassicInterface)(t)?250:400,o={page:Math.max(r,i)};if(Object(s.isClassicInterface)(t)){var l=Object(s.getClassicChatHeight)();l=l>0?Math.min(l-n.offsetHeight-30-2,r):r;var c=hasClass(a,"im-page--history_empty-hist")?l:r;o.history=Math.max(l,i),o.chat=Math.max(c,i)}return o}function hc(e,t,n,a,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!isFullScreen()){var c=_c(e,t);if(setStyle(e,{minHeight:c.page}),Object(s.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(i.initializeChatResize),setStyle(e,{height:t.get().isCreating?c.page:"auto"}),setStyle(geByClass1("_im_page_dialogs",e),{minHeight:c.page,position:"static",top:0}),setStyle(geByClass1("_im_page_history",e),{minHeight:c.history,position:"relative",top:0}),setStyle(geByClass1("_im_chat_body_abs",e),{minHeight:c.chat,height:c.chat,position:"relative",top:0})),browser.safari&&l&&"function"==typeof l&&l(),a&&a.updateScroll(),r&&r.updateScroll(),n){var d=n.updateScroll();n.scrollFix(t,t.get().peer,d)}o&&setTimeout(()=>hc(e,t,n,a,r,!1),100)}}function fc(e,t){e.get().resendAllOnOnline&&t()}function bc(){!function(e){var t="safari-repaint";e.forEach((function(e){hasClass(e,t)&&removeClass(e,t),addClass(e,t)})),setTimeout((function(){e.forEach((function(e){removeClass(e,t)}))}),100)}([geByClass1("_im_dialog_actions"),geByClass1("_im_chat_input_w"),ge("side_bar"),geByClass1("_im_right_menu"),geByClass1("_im_dialogs_settings"),geByClass1("_im_dialogs_search")])}function vc(e,t){var n,a=t.get(),r=window.devicePixelRatio>=2?"_2x":"";setFavIcon("/images/icons/favicons/fav_im"+r+".ico"),hc(e,t,!1,!1,!1,!0),Object(Ve.statlogsBrowserNotificationsUser)();var l=Object(f.createMutations)(mc),c=l.callMutations,d=l.bindMutations,u=a.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),g=u?Notifier.getLpInstance():t.get().gid?function(e){Object(ul.imWeirdLog)("im_start_longpoll_group",{},!1);var t=Object(dl.createLongpollEventsQueue)(e.ts,e=>{a.trigger("data",e)}),n=Object(cl.createLongpoll)(e,t.onLp),a=new window.EventEmitter;return{onData:e=>a.on("data",e),offData:e=>a.off("data",e),push:e=>a.trigger("data",e),pause:t.pause.bind(t),resume:t.resume.bind(t),abortWaiting:n.abortWaiting.bind(n),onLp:t.onLp.bind(t),stop:n.stopConnection.bind(n),isEnabled:()=>!(!n||n.isStopped())}}(a.lpConfig):Sl(a);function m(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];c().onEvents(t,n)}g.onData(m),u&&Object(ul.imWeirdLog)("im_use_fc_longpoll",{},!1);var p=geByClass1("_im_dialogs_search",e),_=geByClass1("_im_dialogs_settings",e),v=Ke(geByClass1("_im_page_dcontent",e),t,c,p);v.updateStarPosition(),v.renderPeerTags(t);var y,O,C=lo(p,t,c),j=wo(_,t,c),E=Dl(t);(cur.imDb=Object(li.mount)(t.get().gid?-t.get().gid:vk.id),t.set(i.preloadSearchIndex.bind(null,cur.imDb)),Object(s.isClassicInterface)(t)&&j.updateSettings(t),Object(s.isClassicInterface)(t))&&(y=Nl(geByClass1("_im_ui_peers_list",e.parentNode),t),O=function(e,t,n,a){if(browser.mobile)return!1;var r=[t,n,geByClass1("_im_chat_input_w",a),geByClass1("_im_dialog_actions",a)],i=null,s=hasClass(e,"im-page--header_static"),o=ge("im-group-online-disabled-notice");function l(){var t=Object(T.getNativeOption)("scrollLeft"),n=hasClass(e,"im-page--header_static"),a=[];i!==t?a=r.slice().concat([e]):n!==s&&(a=[e]),i=t,s=n,a.length>0&&a.forEach(a=>{var r=e===a&&n?0:-t;setStyle(a,{[cssTransformProp]:0===r?"unset":"translateX("+r+"px)"})})}return o&&r.push(o),r=r.concat(geByClass("_im_aside_notice"),geByClass("_im_aside_promo_block")),addEvent(window,"scroll",l),l(),()=>{removeEvent(window,"scroll",l)}}(p,_,geByClass1("_im_right_menu",e.parentNode),e));Object(s.isClassicInterface)(t)&&a.peer&&v.deactivate(),a.gid||(n=rl(geByClass1("_im_dialogs_creation",e),t,c));var S=Is(geByClass1("_im_page_history",e),t,v,y,c),w=a.isCreating,I=w?"create":0===a.peer?"search":"default";w&&n.show(t,[]);var k=ol(t,I,v,S,C,n),M=Ul(t,k);S.renderPeerProfile(t),S.updateScroll();var A=pc.bind(null,c,t,k);a.peer&&t.set(i.prepareCasperMessagesFromMessages.bind(null,a.peer)),Object(s.isReservedPeer)(a.peer)||setTimeout(()=>tc(t,S),10);var L=new $l.default({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"}),P=Object(ya.debounce)(bc,300),N=hc.bind(null,e,t,S,v,n,!1,P),x=fc.bind(null,t,S.resendAll);t.setState({longpoll:g}),t.set(i.setExecStack.bind(null,[])),L.on("unidle",(function(){g.abortWaiting(),A()})),L.start(),nav.objLoc.box&&(Jl(t,nav.objLoc.box),Object(oi.updateLocation)({box:null})),nav.objLoc.mr&&Object(s.isChatPeer)(Number(nav.objLoc.mr))&&v.showInvitationBox(t,nav.objLoc.mr);var D,R=function(e){var t=e.get();return Object(s.isLocksAvailable)(e)?Object(wl.createWorker)(t.mutex_key,(function(e){t.longpoll.push([b.mutexEvent(e)])}),(function(e,n){return Object(i.getMutexQueue)(t.gid).then(e=>Yl(e,1)[0])})).stop:null}(t);if(Object(s.isLocksAvailable)(t)&&(D=setInterval(s.blockLatencyCompensation.bind(null,t,a.longpoll),2e3)),t.get().invitation&&Object(s.showInvitationBox)(t,t.get().invitation,i.leaveInvitation),Object(s.isClassicInterface)(t)&&Object(o.existsIncomingMessageRequest)(t)){var B=document.getElementById("ui_rmenu_mr");B&&B.classList.remove("unshown")}var F=Object(h.throttleAccumulate)(Xl.bind(null,t,S,v,y),200),H=s.hideTopNotice.bind(null,t),U=s.hideAsideNotice.bind(null,t);return zl.casperMessagesStore.subscribe(e=>function(e,t,n,a,r){var i=r.type,s=r.message;switch(i){case zl.EXPIRING:return t.updateCasperMessageStatus(s);case zl.EXPIRING_SOON:return t.updateCasperMessageStatus(s,!0);case zl.EXPIRED:Object(o.isCasperChat)(e,s.peerId)?a(s):(t.handleMessageExpiration(s),n.updateDialog(s.peerId,e))}}(t,S,v,F,e)),zl.casperMessagesStore.setTimeshift(a.timeshift),d(Object(f.createModule)({handlers:(t,n)=>{t(document,"mousemove mousedown keypress",A),t(window,"resize",N),t(window,"online",x),n(e,"click",s.HIDE_TOP_NOTICE_CLASS,H),n(gpeByClass("_im-page-wrap",e),"click",s.HIDE_ASIDE_NOTICE_CLASS,U),n(gpeByClass("_im-page-wrap",e),"click",s.HIDE_ASIDE_PROMO_BLOCK_CLASS,s.hideAsidePromoBlock),n(gpeByClass("_im-page-wrap",e),"click",s.INSTALL_VKADMIN_LINK,s.installVKAdminApp),browser.safari&&t(document,"visibilitychange",bc)}}),v,S,C,e,L,g,F,c,n,j,t,k,R,D,y,O,E,M,N,(function(){u?g.offData(m):g.stop()}))}var yc,Oc;function Cc(e){var t=ge("page_header"),n=window.clientHeight()-t.offsetHeight-30-2;setStyle(e,{height:Math.max(n,400)})}function jc(e){var t=Object(s.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function Ec(){nav.reload({force:!0})}function Tc(e){return{unmount(){clearInterval(Oc),clearTimeout(yc),Object(f.destroyModule)(e)}}}function Sc(e,t,n){Cc(e);var a,r,i=(0,Object(f.createMutations)(Tc).bindMutations)(Object(f.createModule)({handlers:(t,n)=>{t(e.querySelector("._im_sick_reload"),"click",Ec),t(window,"resize",Cc.bind(null,e))}})),s=(a=localStorage.getItem("im_sick_timer"),r=a?Math.min(2*parseInt(a),6e5):5e3,localStorage.setItem("im_sick_timer",r),r),o=e.querySelector("._im_sick_timer"),l=+new Date;return o.innerHTML=jc(s),Oc=setInterval(()=>{o.innerHTML=jc(l+s-new Date)},500),yc=setTimeout(Ec,s),i}var wc=n("f4YT"),Ic=a.Promise;window.IM={init(e){if(window.imwl=e.imwl,Object(ul.startLoggingAllUnhandled)(),addTemplates(wc),window.Promise||(window.Promise=Ic),window.cur.lang.dont_attach=getLang("mail_dont_add_media"),e.failed)return Sc(geByClass1("im-sick",ge("page_body")));localStorage.removeItem("im_sick_timer"),e.tabbedPeers=(e.tabbedPeers||[]).map(e=>({peer:e,type:"perm"})),cur.ctrl_submit=e.ctrl_submit,cur.module="im",cur.mutedPeers=e.mutedPeers,cur.gid=e.gid,cur.peer=e.peer,e.blockedFlagUpdates={},e.msgid=intval(nav.objLoc.msgid),cur.options={blacklist_hash:e.thash};var t=-10800-60*(new Date).getTimezoneOffset(),n=e.timeshift;e.timeshift=n-t,e.oCache={},e.ref_id=nav.objLoc.ref,e.ref_source=nav.objLoc.ref_source;var a=e.owners;e.owners=void 0;var o=Object(E.default)(e);a.forEach(e=>Object(W.oCacheAdd)(o,e)),a=void 0,Object(s.normalizeTabsGotFromServer)(o,o.get().tabs),cur.imClassicInterface=Object(s.isClassicInterface)(o);var l=vc(geByClass1("js-im-page",ge("page_body")),o);Object(i.updateMentions)(o.get()),window.IMBRIDGE={chatPhotoSaved(e){curBox()&&curBox().hide();var t=(e||{})[1];return t?(cur.pvShown&&layers.fullhide(!0,!0),"im"!=cur.module||o.get().peer!=t?nav.go("/im?sel=c"+(t-2e9)):void 0):nav.reload()},updateHistory(e){o.set(i.updateHistory.bind(null,e)).then(()=>{l.updateHistory(e)})},syncHistory(e){Object(r.isFunction)(e)||(e=function(){}),o.set(i.syncHistory.bind(null,e)).then(()=>{l.syncHistory(e)})},activateTab(e){o.get().gid||o.get().longpoll.push([Object(b.changePeer)(intval(e),!1,!1,!0)])}};var c=!1;cur.nav.push((function(){return!!c||(o.get().audio_msg&&o.get().audio_msg.isRecording&&l.cancelRecording(),AudioMessagePlayer.detachPlayer(),l.route.apply(null,arguments))})),cur.destroy.push((function(){if(c)return!0;l.unmount(),window.IMBRIDGE=void 0,o.unmount(),window.store=void 0,c=!0,e=!1,o=!1,l=!1,Object(ul.stopLoggingAllUnhandled)()}))}};try{stManager.done("imn.js")}catch(e){}},MCfn:function(e,t,n){"use strict";n.r(t),n.d(t,"connect",(function(){return l}));n("91GP");var a=n("q1tI");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var i=a.createContext(),s=i.Provider,o=i.Consumer;function l(e){return class extends a.Component{constructor(){super(...arguments),this.onUpdate=()=>{this.setState({})}}componentDidMount(){this.store.subscribe(this.onUpdate)}componentWillUnmount(){this.store.unsubscribe(this.onUpdate)}render(){return a.createElement(o,null,t=>(this.store||(this.store=t),a.createElement(e,r({},this.props,{store:t}))))}}}t.default=s},"MV/q":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.getRef=e=>{this.element=e},this.resize=()=>{var e=this.element;if(e){var t=e.offsetHeight,n=e.scrollHeight,a=0;n+a<=t&&(a=0),e.value&&this.setState({height:n-a}),this.setState({height:0},()=>{var t=e.scrollHeight-a;this.setState({height:t}),this.props.onResize(e)})}},this.onChange=e=>{this.props.grow&&this.resize(),this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.state={value:void 0===e.value?e.initialValue||"":void 0},void 0!==e.value&&(this.isControlledOutside=!0)}componentDidMount(){this.props.grow&&this.resize()}render(){var e=this.props,t=e.className,n=(e.initialValue,e.grow,e.style),o=(e.onResize,e.value),l=s(e,["className","initialValue","grow","style","onResize","value"]),c=this.isControlledOutside?o:this.state.value,d=this.state.height||n.height||66;return a.createElement("textarea",i({},l,{value:c,onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,ref:this.getRef,style:i({},n,{height:d}),className:Object(r.classNames)("Textarea",t)}))}}o.defaultProps={initialValue:"",grow:!0,onResize:()=>{},style:{}}},MhhX:function(e,t,n){"use strict";n.r(t),n.d(t,"isUnread",(function(){return i})),n.d(t,"isServiceMsg",(function(){return s})),n.d(t,"isCallMessage",(function(){return o})),n.d(t,"isOut",(function(){return l})),n.d(t,"hasReply",(function(){return c})),n.d(t,"isGraffiti",(function(){return u})),n.d(t,"isAudioMsg",(function(){return g})),n.d(t,"isSticker",(function(){return m})),n.d(t,"isGift",(function(){return p})),n.d(t,"isMoney",(function(){return _})),n.d(t,"isMoneyRequest",(function(){return h})),n.d(t,"isVKPay",(function(){return f})),n.d(t,"isImportant",(function(){return b})),n.d(t,"getUserId",(function(){return v})),n.d(t,"getAuthorId",(function(){return y})),n.d(t,"getAdminId",(function(){return O})),n.d(t,"wasEdited",(function(){return C})),n.d(t,"isMessageSelected",(function(){return j})),n.d(t,"isCasperMessage",(function(){return E})),n.d(t,"isMessageToBlockedCommunity",(function(){return T})),n.d(t,"hasPrivateStory",(function(){return S})),n.d(t,"isMessageEmpty",(function(){return w})),n.d(t,"getMessageTTL",(function(){return I})),n.d(t,"isExpiredCasperMessage",(function(){return k})),n.d(t,"MARKED_TYPE_MENTIONS",(function(){return M})),n.d(t,"MARKED_TYPE_CASPER",(function(){return A})),n.d(t,"getFromMessageMarkedDataByType",(function(){return L})),n.d(t,"getMentionsFromMessage",(function(){return P})),n.d(t,"hasUserMentions",(function(){return N}));n("OEbY");var a=n("f01n"),r=n("aong");function i(e,t){return"number"!=typeof t.messageId||(l(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function s(e){return e.kludges&&void 0!==e.kludges.source_act}function o(e){return"call"==e.kludges.attach1_type}function l(e){return e.flags&a.FLAG_OUTBOUND}function c(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&a.FLAG_HAS_REPLY&&t}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=e.attaches[0];return a&&(a.type===t||a.type===n)}function u(e){return d(e,"doc")&&"graffiti"===e.attaches[0].kind}function g(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function m(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function p(e){return d(e,"gift")}function _(e){return d(e,"money_transfer","money_request")}function h(e){return d(e,"money_request")}function f(e){return d(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function b(e){return e.flags&a.FLAG_IMPORTANT}function v(e){return l(e)?vk.id:e.userId}function y(e,t){var n=Object(r.unpackStore)(e);return l(t)?n.id:t.userId}function O(e,t){var n=Object(r.unpackStore)(e);return n.gid&&l(t)?+t.kludges.from_admin||-n.gid:0}function C(e){return e.update_time>0}function j(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function E(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&a.FLAG_DELETE_BY_TTL)}function T(e,t){return!(!e.blocked_community||!l(t))}function S(e){return!(!e||!e.kludges.has_private_story)}function w(e){return e.messageId<=0}function I(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function k(e){return!(!e.kludges||!e.kludges.is_expired)}var M=1,A=2;function L(e,t){var n=e.kludges&&e.kludges.marked_users,a=n&&n.find(e=>e[0]===t);return a?a[1]:void 0}function P(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=L(e,M);return t?Array.isArray(t)?t:[t]:[]}function N(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var n=e.kludges.marked_users?P(e):e.kludges.mentions;return!!n&&n.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,n){"use strict";function a(e){return"https://vk.com/web/away.php?to="+e}function r(e,t){var n=decodeURIComponent(e);return/^\/[^/]/.test(n)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(n)?e:"/away.php?to="+encodeURIComponent(n)+(t?"&utf=1":"")}n.r(t),n.d(t,"wrapAway",(function(){return a})),n.d(t,"wrapAwayIfExternal",(function(){return r}))},NsuH:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var a=n("q1tI"),r=(n("17x9"),n("pemR")),i=n("BN/X");class s extends a.PureComponent{constructor(e){super(e),this.onError=()=>{this.setState({errored:!0})},this.state={}}getPhotoImage(){var e=this.props,t=e.photo,n=e.title;return a.createElement("img",{src:this.state.errored?"/images/camera_c.gif":t,alt:n,onError:this.onError,className:"Entity__photo"})}render(){var e=this.props,t=e.className,n=e.style,s=e.size,o=e.photo,l=e.href,c=e.title,d=e.description,u=e.target,g={["Entity--size"+s]:!!s};return a.createElement("div",{className:Object(r.classNames)("Entity",t,g),style:n},a.createElement("div",{className:"Entity__aside"},"string"==typeof o?l?a.createElement("a",{href:l,target:u},this.getPhotoImage()):this.getPhotoImage():o),a.createElement("div",{className:"Entity__main"},c&&l?a.createElement("div",{className:"Entity__title"},a.createElement(i.default,{href:l,dangerouslySetInnerHTML:{__html:c},target:u})):a.createElement("div",{className:"Entity__title",dangerouslySetInnerHTML:{__html:c}}),"string"!=typeof d?a.createElement("div",{className:"Entity__description"},d):a.createElement("div",{className:"Entity__description",dangerouslySetInnerHTML:{__html:d}})))}}s.defaultProps={size:null,photo:"",title:"",description:"",href:"",target:null}},O8ze:function(e,t,n){"use strict";n.r(t),n.d(t,"statlogsForwardEvent",(function(){return s})),n.d(t,"statlogsForwardFromCommunityEvent",(function(){return o})),n.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return l})),n.d(t,"statlogsForwardFromChannel",(function(){return c})),n.d(t,"statlogsSendingTime",(function(){return u})),n.d(t,"statlogsSendingTimeStart",(function(){return g})),n.d(t,"statlogsSendingTimeEnd",(function(){return m})),n.d(t,"statlogsSendingError",(function(){return p})),n.d(t,"statlogsSendingQueueLength",(function(){return h})),n.d(t,"statlogsSendingRetry",(function(){return f})),n.d(t,"statlogsBrowserNotificationsUser",(function(){return b})),n.d(t,"statlogsBrowserNotificationsOn",(function(){return v})),n.d(t,"statlogsBrowserNotificationsOff",(function(){return y})),n.d(t,"statlogsCoronaBotLinkClickEvent",(function(){return O}));n("pIFo");var a=n("1y80"),r=n("aong"),i={};function s(e){Object(a.statlogsProbValueEvent)(.1,"im_forward_stat",d(e),!!e.get().gid)}function o(e,t){Object(a.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",d(e),!!e.get().gid,+t)}function l(){Object(a.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function c(){Object(a.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function d(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function u(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=1;if(!Object(a.randEnabled)(i))return()=>{};var s=+new Date,o=_(e);return function(){var e=+new Date-s;Object(a.statlogsValueEvent)("messages_send_time_web",e,t,n,o,r)}}function g(e,t,n,a){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var r=[t.messageId.replace("rid",""),n,a].join("_"),s=t.attaches.length>0;i[r]=u(e,n,a,s)}}function m(e,t,n,a){var r=[t.randomId,n,a].join("_"),s=i[r];s&&(s(),delete i[r])}function p(e,t,n,r){var i=_(e),s=""===t?"network":"unknown";Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_errors_web",s,n,r,i)}function _(e){var t=Object(r.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function h(e){var t=Object(r.unpackStore)(e),n=t.imQueue(t.peer).length;Object(a.randEnabled)(1)&&Object(a.statlogsValueEvent)("messages_send_queue_size",n)}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",n=1;Object(a.randEnabled)(n)&&Object(a.statlogsValueEvent)("messages_send_retry",1,t,e)}function b(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(a.statlogsValueEvent)(e,1))}function v(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function y(){Object(a.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}function O(){Object(a.statlogsValueEvent)("messages_corona_bot_entrypoint_click",1)}},P13b:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return s.getFirstUnread})),n.d(t,"isSearchShown",(function(){return s.isSearchShown})),n.d(t,"getPeer",(function(){return s.getPeer})),n.d(t,"getCurrentKeyboard",(function(){return s.getCurrentKeyboard})),n.d(t,"getKeyboard",(function(){return s.getKeyboard})),n.d(t,"getTab",(function(){return s.getTab})),n.d(t,"getCurrentTab",(function(){return s.getCurrentTab})),n.d(t,"getSelectedMessages",(function(){return s.getSelectedMessages})),n.d(t,"getMessageRangeFromSelection",(function(){return s.getMessageRangeFromSelection})),n.d(t,"countUnread",(function(){return s.countUnread})),n.d(t,"getMessageByRid",(function(){return s.getMessageByRid})),n.d(t,"isRidExist",(function(){return s.isRidExist})),n.d(t,"getLocalId",(function(){return s.getLocalId})),n.d(t,"getLastMessage",(function(){return s.getLastMessage})),n.d(t,"parserMessage",(function(){return s.parserMessage})),n.d(t,"getAuthorFullName",(function(){return s.getAuthorFullName})),n.d(t,"getMessage",(function(){return s.getMessage})),n.d(t,"getPreviousMessage",(function(){return s.getPreviousMessage})),n.d(t,"isClassicInterface",(function(){return s.isClassicInterface})),n.d(t,"isLocksAvailable",(function(){return s.isLocksAvailable})),n.d(t,"isFoldersAvailable",(function(){return s.isFoldersAvailable})),n.d(t,"isCommunityInterface",(function(){return s.isCommunityInterface})),n.d(t,"isChannelPeer",(function(){return s.isChannelPeer})),n.d(t,"getBareTab",(function(){return s.getBareTab})),n.d(t,"isReversedDialogs",(function(){return s.isReversedDialogs})),n.d(t,"isFullyLoadedTab",(function(){return s.isFullyLoadedTab})),n.d(t,"makeTabNotFullyLoaded",(function(){return s.makeTabNotFullyLoaded})),n.d(t,"isGoToEndVisible",(function(){return s.isGoToEndVisible})),n.d(t,"isGoToMentionVisible",(function(){return s.isGoToMentionVisible})),n.d(t,"getUnreadScrollBottom",(function(){return s.getUnreadScrollBottom})),n.d(t,"isSendingAvailable",(function(){return s.isSendingAvailable})),n.d(t,"isCommunityPeer",(function(){return s.isCommunityPeer})),n.d(t,"isCommunityBlocked",(function(){return s.isCommunityBlocked})),n.d(t,"checkVoiceMessageAvailable",(function(){return s.checkVoiceMessageAvailable})),n.d(t,"isSearching",(function(){return s.isSearching})),n.d(t,"getSearchText",(function(){return s.getSearchText})),n.d(t,"isSearchingValue",(function(){return s.isSearchingValue})),n.d(t,"isRecentSearchesActive",(function(){return s.isRecentSearchesActive})),n.d(t,"getPinnedMessage",(function(){return s.getPinnedMessage})),n.d(t,"doPopularSuggExist",(function(){return s.doPopularSuggExist})),n.d(t,"isAnyMessageBeingEdited",(function(){return s.isAnyMessageBeingEdited})),n.d(t,"getGroupId",(function(){return s.getGroupId})),n.d(t,"getTabDraft",(function(){return s.getTabDraft})),n.d(t,"getTemplates",(function(){return s.getTemplates})),n.d(t,"tabIsMessageRequest",(function(){return s.tabIsMessageRequest})),n.d(t,"tabIsMessageRequestToChat",(function(){return s.tabIsMessageRequestToChat})),n.d(t,"removeMessageRequestFolderFlags",(function(){return s.removeMessageRequestFolderFlags})),n.d(t,"isMessageRequestFolder",(function(){return s.isMessageRequestFolder})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return s.tabIsOutgoingMessageRequest})),n.d(t,"existsIncomingMessageRequest",(function(){return s.existsIncomingMessageRequest})),n.d(t,"isMessageRequestChangedEvent",(function(){return s.isMessageRequestChangedEvent})),n.d(t,"isCommunityChat",(function(){return s.isCommunityChat})),n.d(t,"isCommunityChatDeleted",(function(){return s.isCommunityChatDeleted})),n.d(t,"isClosedChat",(function(){return s.isClosedChat})),n.d(t,"isCasperChat",(function(){return s.isCasperChat})),n.d(t,"isCasperChatTab",(function(){return s.isCasperChatTab})),n.d(t,"isChatActive",(function(){return s.isChatActive})),n.d(t,"SENDING_CLASS",(function(){return P})),n.d(t,"FAILED_CLASS",(function(){return N})),n.d(t,"ORIGINAL_CLASS",(function(){return x})),n.d(t,"RESTORE_CLASS",(function(){return D})),n.d(t,"TYPING_CLASS",(function(){return R})),n.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return B})),n.d(t,"MESSAGE_STACK_CLASS",(function(){return F})),n.d(t,"MESSAGE_CLASS",(function(){return H})),n.d(t,"CREATE_CHAT_ACTION",(function(){return U})),n.d(t,"CHAT_TITLE_ACTION",(function(){return G})),n.d(t,"CHAT_INVITE_USER",(function(){return q})),n.d(t,"CHAT_KICK_USER",(function(){return K})),n.d(t,"CHAT_PHOTO_UPDATE",(function(){return V})),n.d(t,"CHAT_PHOTO_REMOVE",(function(){return W})),n.d(t,"CHAT_PIN_MESSAGE",(function(){return $})),n.d(t,"CHAT_UNPIN_MESSAGE",(function(){return z})),n.d(t,"CHAT_INVITE_BY_LINK",(function(){return Y})),n.d(t,"CHAT_SCREENSHOT",(function(){return Q})),n.d(t,"DESELECT_ALL_CLASS",(function(){return X})),n.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return J})),n.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return Z})),n.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return ee})),n.d(t,"INSTALL_VKADMIN_LINK",(function(){return te})),n.d(t,"CLEAR_RECENT_CLASS",(function(){return ne})),n.d(t,"TOGGLE_MR_TAB",(function(){return ae})),n.d(t,"MESSAGE_SEARCH_CLASS",(function(){return ie})),n.d(t,"PINNED_CONTAINER_CLASS",(function(){return oe})),n.d(t,"getClassicChatHeight",(function(){return le})),n.d(t,"setClassicChatHeight",(function(){return ce})),n.d(t,"applyInnerHtml",(function(){return de})),n.d(t,"compensateHistoryHeightChange",(function(){return ue})),n.d(t,"renderSticker",(function(){return ge})),n.d(t,"isAlreadyDeleted",(function(){return me})),n.d(t,"replaceMessageAttrs",(function(){return pe})),n.d(t,"isVoiceMessageAvailable",(function(){return _e})),n.d(t,"getAvailableMicrophones",(function(){return he})),n.d(t,"renderAttach",(function(){return fe})),n.d(t,"dayFromVal",(function(){return be})),n.d(t,"showInvisibleBar",(function(){return ve})),n.d(t,"updateMessageInCache",(function(){return ye})),n.d(t,"editAndReplaceMessage",(function(){return Oe})),n.d(t,"setCasperMessageExpiringStatusDOM",(function(){return Ce})),n.d(t,"renderMessage",(function(){return je})),n.d(t,"renderMessageMedia",(function(){return Ee})),n.d(t,"ensureDomHasActions",(function(){return Te})),n.d(t,"renderCallMessage",(function(){return Se})),n.d(t,"appendToHistory",(function(){return we})),n.d(t,"restoreQueue",(function(){return Ie})),n.d(t,"markMessagesAsRead",(function(){return ke})),n.d(t,"replaceAttaches",(function(){return Me})),n.d(t,"MSG_NEW",(function(){return Ae})),n.d(t,"MSG_DUPLICATE",(function(){return Le})),n.d(t,"MSG_LOCAL_DUPLICATE",(function(){return Pe})),n.d(t,"getMessageStoreStatus",(function(){return Ne})),n.d(t,"isChatPeer",(function(){return c.isChatPeer})),n.d(t,"isUserPeer",(function(){return c.isUserPeer})),n.d(t,"isReservedPeer",(function(){return c.isReservedPeer})),n.d(t,"isContactPeer",(function(){return De})),n.d(t,"isEmailPeer",(function(){return xe})),n.d(t,"isPeerActive",(function(){return Re})),n.d(t,"isFvkcomgroup",(function(){return Be})),n.d(t,"isTabLoaded",(function(){return Fe})),n.d(t,"isTabLoadedWithMessage",(function(){return He})),n.d(t,"parseMessage",(function(){return qe})),n.d(t,"convertPeerToUrl",(function(){return Ke})),n.d(t,"unUrlPeer",(function(){return Ve})),n.d(t,"simplifyCounter",(function(){return We})),n.d(t,"chatActions",(function(){return $e})),n.d(t,"renderPhotos",(function(){return Qe})),n.d(t,"renderPhotosFromTab",(function(){return Xe})),n.d(t,"renderBtnSearchOnlyMessages",(function(){return Je})),n.d(t,"renderMessagesSep",(function(){return Ze})),n.d(t,"renderConversationsSep",(function(){return et})),n.d(t,"renderPopularSuggSep",(function(){return tt})),n.d(t,"renderClearRecent",(function(){return nt})),n.d(t,"renderPopularSuggestions",(function(){return at})),n.d(t,"setMessageError",(function(){return rt})),n.d(t,"startResendMessage",(function(){return it})),n.d(t,"removeMessages",(function(){return st})),n.d(t,"removeExpiredMessagesStub",(function(){return ot})),n.d(t,"removeStartingFromMessage",(function(){return ct})),n.d(t,"removeMessagesWithRestore",(function(){return dt})),n.d(t,"restoreMessage",(function(){return ut})),n.d(t,"formatTyper",(function(){return gt})),n.d(t,"loadSummaryActivityType",(function(){return mt})),n.d(t,"renderEmptySearch",(function(){return _t})),n.d(t,"serviceLink",(function(){return ht})),n.d(t,"renderServiceMsg",(function(){return ft})),n.d(t,"addChatPhotoToUpdate",(function(){return bt})),n.d(t,"replaceSpecialSymbols",(function(){return vt})),n.d(t,"isSelfMessage",(function(){return yt})),n.d(t,"showVerifiedTooltip",(function(){return Ot})),n.d(t,"wrapLoading",(function(){return Ct})),n.d(t,"tabFromIds",(function(){return jt})),n.d(t,"checkSelectClick",(function(){return Et})),n.d(t,"renderGoTo",(function(){return Tt})),n.d(t,"showFlushChat",(function(){return St})),n.d(t,"showLeaveDialog",(function(){return wt})),n.d(t,"showUnpinDialog",(function(){return It})),n.d(t,"showMsgDeleteDialog",(function(){return kt})),n.d(t,"cleanHistory",(function(){return Mt})),n.d(t,"inviteUser",(function(){return At})),n.d(t,"toggleMessageRequestsTab",(function(){return Lt})),n.d(t,"showUnreadOnly",(function(){return Pt})),n.d(t,"changeTab",(function(){return Nt})),n.d(t,"isImportant",(function(){return xt})),n.d(t,"isUnrespond",(function(){return Dt})),n.d(t,"isPeerBlocked",(function(){return Rt})),n.d(t,"isPendingForward",(function(){return Bt})),n.d(t,"isPeerBlockedByMe",(function(){return Ft})),n.d(t,"blockLatencyCompensation",(function(){return Ht})),n.d(t,"showSpamLayer",(function(){return Ut})),n.d(t,"getLastSeenTextInHeader",(function(){return Gt})),n.d(t,"getLastSeenText",(function(){return qt})),n.d(t,"showBlacklistBoxUser",(function(){return Vt})),n.d(t,"showBlacklistBox",(function(){return Wt})),n.d(t,"getBaseLink",(function(){return $t})),n.d(t,"showFavvedBox",(function(){return zt})),n.d(t,"isEditableFocused",(function(){return Yt})),n.d(t,"updateStar",(function(){return Qt})),n.d(t,"removewNewUnreadBarAndMerge",(function(){return Xt})),n.d(t,"isMessagesVisible",(function(){return Jt})),n.d(t,"hideTopNotice",(function(){return Zt})),n.d(t,"hideAsideNotice",(function(){return en})),n.d(t,"hideAsidePromoBlock",(function(){return tn})),n.d(t,"installVKAdminApp",(function(){return nn})),n.d(t,"renderShortText",(function(){return rn})),n.d(t,"attachToText",(function(){return sn})),n.d(t,"lockButton",(function(){return on})),n.d(t,"unlockButton",(function(){return ln})),n.d(t,"renderPinnedMessage",(function(){return cn})),n.d(t,"renderPinnedMedia",(function(){return dn})),n.d(t,"showMessageInfoTooltip",(function(){return un})),n.d(t,"showEditTimeTooltip",(function(){return gn})),n.d(t,"showCasperExpiringTooltip",(function(){return mn})),n.d(t,"getHistoryTopIndent",(function(){return pn})),n.d(t,"getPinnedMessageHeight",(function(){return _n})),n.d(t,"boxHandleMessagesLabelsTooltips",(function(){return hn})),n.d(t,"showPinnedBox",(function(){return fn})),n.d(t,"showRepliedBox",(function(){return bn})),n.d(t,"isUserAliveInChat",(function(){return vn})),n.d(t,"getAliveMembersCount",(function(){return yn})),n.d(t,"normalizeTab",(function(){return On})),n.d(t,"normalizeTabsGotFromServer",(function(){return Cn})),n.d(t,"splitMessageToParts",(function(){return jn})),n.d(t,"isMessageTooLong",(function(){return En})),n.d(t,"showInvitationBox",(function(){return Tn})),n.d(t,"showWaitUntilUploadedBox",(function(){return wn})),n.d(t,"canMessageBeDeletedForAll",(function(){return In})),n.d(t,"getTopChatMembers",(function(){return kn})),n.d(t,"getChatMembersByIds",(function(){return Mn})),n.d(t,"getChatMembers",(function(){return An})),n.d(t,"formatTimespan",(function(){return Ln})),n.d(t,"focusOnMessage",(function(){return Pn})),n.d(t,"getNowEditingMessage",(function(){return Nn})),n.d(t,"checkMessageRequestsTab",(function(){return xn})),n.d(t,"updateMessageRequestsCounterInDOM",(function(){return Dn})),n.d(t,"hideAllBoxes",(function(){return Rn})),n.d(t,"getMessageRequestDateText",(function(){return Bn})),n.d(t,"canPinMessage",(function(){return Fn})),n.d(t,"canForwardMessages",(function(){return Hn})),n.d(t,"canMarkImportant",(function(){return Un})),n.d(t,"removeExpiredMessageIfNeed",(function(){return Gn})),n.d(t,"isPeerCurrentUser",(function(){return qn})),n.d(t,"isGiftOptionAvailableForPeer",(function(){return Kn})),n.d(t,"isMoneyOptionAvailableForPeer",(function(){return Vn})),n.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return Wn})),n.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return Qn})),n.d(t,"getChatMemberCount",(function(){return Xn})),n.d(t,"startCallFromIm",(function(){return Jn})),n.d(t,"isCallToPeerAvailable",(function(){return Zn}));n("rE2o"),n("ioFf"),n("HEwt"),n("Vd3H"),n("rGqo"),n("a1Th"),n("91GP"),n("pIFo"),n("KKXr"),n("VRzm"),n("Btvt");var a=n("f01n"),r=n("h++7"),i=n("bIHZ"),s=n("rHUl"),o=n("MhhX"),l=n("S2bU"),c=n("rudk"),d=n("pemR"),u=n("FWc3"),g=n("EasH"),m=n("1BRX"),p=n("v+DW"),_=n("vT4u"),h=n("ofcU");function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function v(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function y(e,t,n){var r=Object(h.createModule)({handlers:(r,i)=>{i(e,"click","_im_join_chat",e=>function(e,t){var n=domData(t,"chat-id"),r=domData(t,"hash");return Object(p.lockButton)(t),Object(_.joinChat)(n,r,e.get()).then(n=>{var r=f(n,1)[0];Object(p.unlockButton)(t);var i=e.get();i.longpoll.push([Object(a.changePeer)(r)]),i.onJoinChat&&i.onJoinChat(r)}).catch(e=>{Object(g.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(p.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_accept_mr",e=>function(e,t){var n=v(t);return Object(p.lockButton)(t),e.set(_.acceptMessageRequest.bind(null,n)).then(()=>{Object(p.unlockButton)(t),e.get().longpoll.push([Object(a.changePeer)(n)])}).catch(e=>{Rn(),Object(g.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(p.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_reject_mr",e=>function(e,t,n){var a=v(n);return Object(p.lockButton)(n),e.set(_.rejectMessageRequest.bind(null,a)).then(()=>{t.updateMenu(),t.updateList(),Object(p.unlockButton)(n),Rn()}).catch(e=>{Rn(),Object(g.showFastBox)(getLang("mail_error"),e),Object(p.unlockButton)(n)})}(t,n,e.target))}});return{unmount(){Object(h.destroyModule)(r)}}}var O=n("aong"),C=n("86+7"),j=n("Wu9C"),E=n("wSs/"),T=n("ERyv"),S=n("lJdi"),w=n("t7n3");var I=n("/eGY"),k=n("ambf"),M=n("Syd7");function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var P="_im_mess_sending",N="_im_mess_failed",x="_im_mess_original",D="_im_mess_restore",R="_im_typing",B="_im_mess_btn",F="_im_mess_stack",H="_im_mess",U="chat_create",G="chat_title_update",q="chat_invite_user",K="chat_kick_user",V="chat_photo_update",W="chat_photo_remove",$="chat_pin_message",z="chat_unpin_message",Y="chat_invite_user_by_link",Q="chat_screenshot",X="_im_deselect_all",J="_im_top_notice_hide",Z="_im_aside_notice_hide",ee="_im_aside_promo_block_hide",te="_im_vkadmin_promo_link",ne="_im_clear_recent",ae="_im_toggle_mr_tab",ie="_im_mess_search",oe="_im_pinned";function le(){return ls.get("chatPosition")||0}function ce(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function de(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function ue(e,t,n,a){var r=t&&!n?1:!t&&n?-1:0;r&&!Object(s.isClassicInterface)(e)&&a().compensateHistoryHeightChange(r)}function ge(e,t,n,a){var r=window.devicePixelRatio>=2?"256":"128",i="animation"===n,s="im_gift";i&&(s+=" sticker_img");var o=`<img height="128" class="${s}" src="${Stickers.getStickerUrl(intval(e),r)}"/>`;if(i){var l="animatedSticker"+a;o=`<div id="${l}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${a}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${o}</div>`;var c=!1;browser.msie?(0^a)===a&&(c=!0):c=Number.isInteger(a),c&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(l,10)}return t&&(o=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${o}</a>`),o=`<div class="im_sticker_row">${o}</div>`}function me(e,t,n){var a=e.get?e.get():e;if(Fe(a,t)){var r=a.tabs[t].deleted||[];return inArray(n,r)}return!1}function pe(e,t,n){var a=n.randomId,r=geByClass1("_im_mess_rid"+a,t);return r&&(t=we(e,n,t=lt([r],t),!0,!1)),t}function _e(e){var t=Object(s.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):he().then(e=>e.length>0).catch(e=>!1)}function he(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0;n<e.length;n++)"audioinput"==e[n].kind&&t.push(e[n]);return t})):Promise.reject(new Error("NotSupported"))}function fe(e){return getTemplate("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function be(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function ve(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function ye(e,t,n){var a=domData(n,"msgid"),r=geByClass1("_im_mess_"+a,t),i=n.cloneNode(!0);return r&&(r.parentNode.replaceChild(i,r),Te(t)),t}function Oe(e,t,n){var a=je(e,t),r=geByClass1("_im_mess_"+t.messageId,n);return r&&(r.parentNode.replaceChild(se(a),r),Te(n)),n}function Ce(e,t,n){var a=geByClass1("_im_mess_"+n,e);if(a){var r=a.closest("._im_mess_stack"),i=r&&r.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function je(e,t){var n=[],a=Object(o.isUnread)(e.tabs[t.peerId],t),r=Object(o.isCallMessage)(t),i=Object(o.hasReply)(t)?getTemplate("im_message_media",{type:"reply",messageId:t.messageId,attaches:fe("reply"),text:""}):"";r||n.push("_im_mess"),Object(o.isOut)(t)&&a&&!r&&n.push("im-mess_unread _im_mess_unread"),Object(o.isOut)(t)&&!r&&n.push("im-mess_out"),Object(o.wasEdited)(t)&&n.push("im-mess_was_edited"),Object(E.canMessageBeEdited)(e,t)&&n.push("im-mess_editable"),Object(o.isImportant)(t)&&n.push("im-mess_fav"),-1!=(e.selectedMessages||[]).indexOf(t.messageId)&&n.push("im-mess_selected");var d=Date.now()-1e3*t.date>1e3;t.local&&d&&n.push("im-mess_sending"),t.local&&n.push(""+P),t.local&&Object(o.wasEdited)(t)&&!a&&n.push("im-mess_unread im-mess_nobg"),t.failed&&n.push("im-mess_failed "+N),Object(o.isGift)(t)&&n.push("im-mess_gift"),r&&n.push("_im_mess_callsnippet"),Object(o.isCasperMessage)(t)&&n.push("im-mess_casper");var u=Ee(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(getTemplate("sImMessageKeyboard",{content:t.map(e=>getTemplate("sImMessageKeyboardRow",{content:e.map(e=>getTemplate("sImMessageKeyboardButton",{label:Object(I.getButtonLabel)(e),appearance:Object(I.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(I.getAttributesFromActionObject)(e.action),tagName:e.action.type===I.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),g=function(e,t){var n="",a=Object(O.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(o.wasEdited)(t)&&(n+=getTemplate("sImLblWasEdited",{update_time:t.update_time}));if(Object(s.isCommunityInterface)(e)&&a){var r=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(w.unclean)(r))).link&&i.info&&(i.link=Object(l.replaceHyperLinks)(Object(w.clean)(i.link),l.linksReplacer.bind(null,!1)),i=Object(w.clean)(langStr(getLang("mail_source_info"),"link",i.link,"info",Object(w.clean)(i.info))),n+=getTemplate("sImLblWasSourceInfo",{source:i}))}catch(e){}}return n}(e,t),m=i+qe(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(c.isChatPeer)(t.peerId)&&(m=getTemplate("im_topic",{topic:t.subject})+m);var p=Object(o.isGift)(t)?`<div class="im-mess--gift-lbl">${m}</div>`:"",_=u.length>0?getTemplate("im_message_media",{type:"media",messageId:t.messageId,attaches:u.join(""),text:p}):"";if(Object(o.isGift)(t)||(_=m+_),Object(o.isCallMessage)(t)){var h=Se(t,!1,!0,e),f=e.isCallsEnabled?"sImCallSnippet":"sImCallSnippetWithStub";_+=getTemplate(f,h)}return _+=g,getTemplate("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:a?`aria-label="${getLang("mail_unread_message")}"`:"",cls:n.join(" ")}).replace("%text%",()=>_)}function Ee(e){return e.attaches.reduce((t,n)=>!Object(o.hasReply)(e)||"mail"!==n.type&&"reply"!==n.type?("call"===n.type||("sticker"===n.type?e.messageId?t.push(ge(n.id,n.productId,n.kind,e.messageId)):t.push(ge(n.id,n.productId)):t.push(fe(n.type))),t):t,[])}function Te(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),n=t.length;n--;)hasClass(t[n],"im-mess_fwd")||t[n].insertAdjacentHTML("afterbegin",getTemplate("sImHistoryRowActions")),removeClass(t[n],"_im_mess_noa")}function Se(e,t,n,a){var r,i,s,o,l,c,d=vk.id,u=e.attaches[0],g=u.initiatorId,m=u.state,p=u.receiverId,_=d===g,h=Boolean(e.kludges.attach1_call_video),f={title:"",description:"",modifier:""},b=h?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),v=h?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming");switch(m){case"reached":var y=t?"":(i=u.duration,s=Math.floor(i/3600),o=Math.floor(i/60)-60*s,l=!1,c=!1,[s,o,i-3600*s-60*o].reduce((e,t)=>{if(0===t&&!c)return c=!0,e;l&&(t=t<10?"0"+t:t);var n=`${e}${""!==e?":":""}${t}`;return l=!0,c=!0,n},""));r=(r=_?getLang("mail_call_outgoing"):getLang("mail_call_incoming")).replace("{duration}",y),f.title=_?b:v,f.description=y;break;case"canceled_by_initiator":_?(r=getLang("mail_call_canceled"),f={title:b,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_canceled")})}):(r=getLang("mail_call_missed"),f=a.isCallsEnabled?{title:v,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_missed")})}:{title:getLang("mail_call_snippet_missed_call"),description:getTemplate("sImCallSnippetDMLink")});break;case"canceled_by_receiver":if(_){if(t)return getLang("mail_call_declined");var O=Object(C.oCacheGet)(a,p);r=O?langSex(O.sex,getLang("mail_call_declined_by","raw")).replace("{user_name}",O.first_name):getLang("mail_call_declined"),f={title:b,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_declined")})}}else r=getLang("mail_call_canceled"),f={title:v,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_canceled")})};break;default:r=getLang("mail_added_call"),f.title=getLang("mail_added_call")}return h&&(f.modifier="im-call-snippet_video"),f.type=h?"video":"audio",n?f:getTemplate("im_calls_link",{text:r})}function we(e,t,n){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,l=e.tabs[t.peerId];if(!n||geByClass1("_im_mess",n)||geByClass1("_im_bar_date",n)||(n.innerHTML=""),l.skipped>0)return n;var d=[];t.local||(d=e.imQueue(t.peerId,a)),d.length>0&&lt(d.map(e=>geByClass1("_im_mess_rid"+e.rid,n),n).filter(e=>e));var u=je(e,t),g=domLC(n);hasClass(g,"_im_mess_stack")||(g=domClosestSibling(g,"._im_mess_stack",-1));for(var p=Object(s.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&p&&!geByClass1("_im_mess_"+p.messageId);)p=Object(s.getLastMessage)(e,t.peerId,p.messageId);var _=geByClass1("_im_unread_bar_row",n),h=p?Ue(p.date,e):0,f=Object(c.isChatPeer)(t.peerId)&&Object(s.isCasperChat)(e,t.peerId);if(!p||Ge(l,p,t,e,r)){var b="",v=!1;if(_&&Object(o.isOut)(t)&&Xt(e,n,t.peerId),1===l.unread&&!Object(o.isOut)(t)&&r&&(b+=getTemplate("im_mess_bar",{}),v=!0,Xt(e,n,t.peerId)),!Object(m.isToday)(new Date(h))&&!f){var y=new Date,C=v?"im-page--history-new-bar_hide _im_invisible_bar":"";b+=getTemplate("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:y.getDate()+y.getMonth()+y.getFullYear()+" "+C})}if(Object(o.isServiceMsg)(t))b+=getTemplate("im_service_row",{text:ft(e,t,l),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var j=Yn(e,t);b+=getTemplate("im_mess_stack",Object.assign(j,{messages:u}))}Object(O.toArray)(sech(b)).forEach(e=>n&&n.appendChild(e))}else _&&e.peer===t.peerId&&!l.inplaceSearch&&Object(o.isOut)(t)&&Xt(e,n,t.peerId),geByClass1("_im_stack_messages",g).appendChild(se(u));return Object(o.isOut)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,n);hasClass(e,P)&&addClass(e,"im-mess_sending")},500),d=d.filter(e=>e.rid!==t.randomId),Te(n),Ie(d,e,n)}function Ie(e,t,n){var a;return(a="object"==typeof e?e:t.imQueue(e,!1)).length>0&&a.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(s.getMessage)(t,e.peerId,e.messageId)).forEach(e=>we(t,e,n,!1)),n}function ke(e,t,n){var a=e.tabs[t];return Object(O.toArray)(geByClass("_im_mess_unread",n)).forEach(e=>{var t,n=intval(domData(e,"msgid"));n>0&&a.out_up_to>=n&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),n}function Me(e,t,n){var a=t.peerId,r=t.messageId,i=geByClass1("_im_msg_reply"+r,e),s=geByClass1("_im_msg_media"+r,e),o=n.tabs[a].mediacontent[r][0];return i&&(i.innerHTML=o[0]),s&&(s.innerHTML=o[1]),e}var Ae=0,Le=1,Pe=2;function Ne(e,t){if(!Object(s.isFullyLoadedTab)(t,e.peerId))return Ae;var n=t.tabs[e.peerId];return n.msgs[e.messageId]?Le:n.msgs["rid"+e.randomId]?Pe:Ae}function xe(e){return e<-2e9}function De(e){return e>19e8&&e<2e9}function Re(e,t){return e===t.peer}function Be(e,t){return Object(S.doesChatTabHaveFlag)(Object(s.getTab)(e,t),1024)}function Fe(e,t){return!!e.tabs[t]}function He(e,t){return!!Fe(e,t)&&null!==e.tabs[t].lastmsg}function Ue(e,t){return 1e3*e+1e3*t.timeshift}function Ge(e,t,n,a,r){if(Object(o.getUserId)(t)!==Object(o.getUserId)(n))return!0;var i=Ue(t.date,a),l=Ue(n.date,a);if(!isSameDate(i,l))return!0;if(Object(s.isCommunityInterface)(a)&&intval(t.kludges.from_admin)!==intval(n.kludges.from_admin))return!0;if(n.date-t.date>300)return!0;if(Object(o.isServiceMsg)(t)||Object(o.isServiceMsg)(n))return!0;var c=Object(o.isCasperMessage)(t),d=Object(o.isCasperMessage)(n);if(c!==d)return!0;var u=t.kludges.is_expired,g=n.kludges.is_expired;return!(!c||!d||u===g)||(!(!c||!d||u||g)||!(c&&d&&u&&g)&&(!(!Object(o.isCallMessage)(n)&&!Object(o.isCallMessage)(t))||(!(!Object(o.isGift)(t)&&!Object(o.isGift)(n))||(!(!Object(o.isGraffiti)(t)&&!Object(o.isGraffiti)(n))||(!!Object(o.hasReply)(n)||!(Object(o.isUnread)(e,t)===Object(o.isUnread)(e,n)||!r||Object(o.isOut)(n)||yt(n.peerId,a.gid)))))))}function qe(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),o={},c=0;return t=(t=Object(l.replaceHyperLinks)(t||"",l.linksReplacer.bind(null,a))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${c}_${i}!`;return o[t]=e,c++,t}),t=Object(l.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(l.replaceMassMentions)(t)),t=Object(l.replaceEmailLinks)(t),t=Object(l.replaceHashtags)(t,t=>{var n=Object(s.getGroupId)(e);return`<a href="/${n?"gim"+n:"im"}?sel=${r||Object(s.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(o).forEach(e=>{t=t.replace(e,()=>o[e])}),n.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function Ke(e){return Object(c.isChatPeer)(e)?"c"+(e-2e9):xe(e)?"e"+Math.abs(e+2e9):De(e)?"mr"+(e-19e8):e}function Ve(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function We(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function $e(e,t){return{[_.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[_.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[_.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[_.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[_.CHAT_ACTION_CLEAR]:{name:xe(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[_.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[_.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[_.CHAT_ACTION_MEDIA]:{name:Object(s.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[_.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[_.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[_.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[_.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[_.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[_.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[_.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[_.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[_.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:"Аудиозвонок"},[_.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:"Видеозвонок"}}}function ze(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(n=getTemplate("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${n}\n    </div>\n  </div>`}function Ye(e,t){var n=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(n=getTemplate("im_dialogs_link",{href:t,photo:n})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${n}\n    </div>\n  </div>`}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,n)=>ze(e,t[n])).join("");case 3:return ze(e[0],t[0])+e.slice(1).map((e,n)=>Ye(e,t[n+1])).join("");case 4:return e.map((e,n)=>Ye(e,t[n])).join("")}}function Xe(e,t,n){if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(c.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return Qe(t.photo);var a=t.data.active.slice(0,4).map(C.oCacheGet.bind(null,e)).filter(e=>!!e);return Qe(a.map(e=>e.photo),n?[]:a.map(e=>e.link))}function Je(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${ie}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function Ze(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function et(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function tt(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function nt(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${ne} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function at(e){var t=e.get().popular_sugg,n=Object(s.isClassicInterface)(e)?8:5;return t.length>n&&(t=t.slice(0,n)),'<li class="im-popular clear_fix">'+t.map(t=>{var n=t.peerId,a=Object(C.oCacheGet)(e,n)||t,r=e.get().tabs[n]||t,i=(e.get().mutedPeers||[]).indexOf(n)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+n,r.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${n}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(r.online)}" href="${a.link}"><img class="im-popular--avatar" src="${a.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${a.link}">${a.first_name||a.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${We(r.unread)}</span>\n</div>`}).join("")+"</li>"}function rt(e,t,n){var a=geByClass1("_im_mess_"+t.messageId,n);if(a){attr(a,"aria-hidden","false"),addClass(a,"im-mess_failed "+N);var r=geByClass1("_im_mess_marker",a);attr(r,"aria-label",getLang("mail_send_message_error")),attr(r,"role","link")}return n}function it(e,t,n){var a=geByClass1("_im_mess_"+t,n);if(a){removeClass(a,"im-mess_failed"),attr(a,"aria-hidden","true"),removeClass(a,N);var r=geByClass1("_im_mess_marker",a);attr(r,"aria-label",""),attr(r,"role","")}return n}function st(e,t){return lt(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function ot(e,t){var n=t||document,a=[];return e.forEach(e=>{var t=n.querySelector("._im_expired_message_"+e);if(t){var r=+t.dataset.count;if(t.dataset.count=r-1,t.classList.remove("_im_expired_message_"+e),1===r)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else a.includes(t)||a.push(t)}}),a.length&&a.forEach(e=>{var t=+e.dataset.count;if(t>0){var n=$n(t),a=se(n);a.classList.add(...e.classList),e.replaceWith(a)}}),t}function lt(e,t){var n=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),n.filter(e=>0===domChildren(e).length).map(e=>gpeByClass("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function ct(e){for(var t=e;t;){var n=t;if(null===(t=t.previousElementSibling)){hasClass(n,"mess_srv")&&(t=n.parentNode);var a=gpeByClass("_im_mess_stack",n);a&&(t=a.previousElementSibling,1===domChildren(n.parentNode).length&&a.parentNode.removeChild(a))}hasClass(n,"_im_unread_bar_row")||n.parentNode.removeChild(n)}}function dt(e,t,n,a){return e.map(e=>geByClass1("_im_mess_"+e,a)).filter(e=>e).forEach(e=>{val(e,function(e,t,n){var a=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===n?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${D} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${x} im-mess--original">${a}</div>\n  </div>`}(t,e,n)),addClass(e,"im-mess_light")}),a}function ut(e,t,n){var a=geByClass1("_im_mess_"+e,n);if(a){var r=geByClass1(x,a);val(a,r.innerHTML),removeClass(a,"im-mess_light")}return n}function gt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return pt(e,t,n,a,!0,r);var s=60,o=pt(e,t,n,a,!1,r);return o.length>s?pt(e,t,n,a,!0,r):o}function mt(e){var t={[_.ACTIVITY_TYPE_TYPING]:1,[_.ACTIVITY_TYPE_RECORDING_AUDIO]:2},n=Object.keys(e).sort((e,n)=>t[n]-t[e]),a={},r=n.reduce((t,n)=>{var r=(e[n]||{}).userIds;return(void 0===r?[]:r).forEach(e=>{a[e]||(a[e]=!0,t[n]=!0)}),t},{}),i=n.filter(e=>!!r[e]);return i.length>1?"":i[0]}function pt(e,t,n,a,r,i){var o=function(e,t,n){var a=[],r={};return Object.keys(t).map(n=>{((t[n]||{}).userIds||[]).forEach(t=>{Object(C.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(r[t]=n):a.push(t)})}),a.length&&Object(_.loadChatMember)({[n]:a},e),Object.keys(r).sort((e,n)=>t[r[e]].ts-t[r[n]].ts)}(a,e,t);if(0===o.length)return"";var l=Object(c.isUserPeer)(t)||Object(s.isCommunityPeer)(t)?"first_name":r?"short_name":"name",d=mt(e),u="";d===_.ACTIVITY_TYPE_RECORDING_AUDIO?u=getLang("mail_recording_audio_several",o.length):d===_.ACTIVITY_TYPE_TYPING&&(u=getLang("mail_typing_several",o.length));var g=o.slice(0,Math.min(o.length-1,i)),m=g.map(e=>Object(C.oCacheGet)(a,e)[l]).join(", ");if(o.length>i+1){var p=function(e){var t={};return Object.keys(e).forEach(n=>{var a=e[n].userIds;(void 0===a?[]:a).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);m+=" "+getLang("mail_and_peer").replace("{count}",p-i).replace("{typing}",u)}else{if(o.length>1&&(m+=" "+getLang("mail_and_peer_one")),!Object(c.isChatPeer)(t)&&n)m+=" "+u;else m+=` ${Object(C.oCacheGet)(a,o[g.length])[l]} ${u}`}return m.trim()}function _t(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function ht(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return n?`<a class="im_srv_lnk ${a}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${a}">${t}</span>`}function ft(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t.kludges,i=r.source_act,s=intval(r.source_mid),o=intval(Object(c.isChatPeer)(n.peerId)?r.from:t.userId),l=o===s,d=Object(C.oCacheGet)(e,o),u="";switch(i){case U:u="mail_im_chat_created";break;case G:u=r.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case q:u=l?"mail_im_returned_to_chat":"mail_im_invited";break;case K:u=l?"mail_im_left":"mail_im_kicked_from_chat";break;case V:u="mail_im_photo_set";break;case W:u=r.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case $:u=r.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case z:u=r.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case Y:u="mail_im_invite_by_link";break;case Q:u=Object(O.unpackStore)(e).id===s?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;default:return"mail_no_support"}if(u=(u=langSex(d.sex,getLang(u,"raw"))).replace("{from}",ht(d.link,d.name,a)),s&&!l){var g=r.source_email;if(g)u=u.replace("{user}",ht("/im?email="+encodeURIComponent(g),"email",a));else{var m=Object(C.oCacheGet)(e,s),p=i===K?m.inv_name:m.kick_name;u=u.replace("{user}",ht(m.link,p,a))}}if(r.source_text){var _=r.source_old_text?`«<b class="im_srv_lnk">${r.source_old_text}</b>» &rarr; `:"";u=u.replace("{title}",_+`«<b class="im_srv_lnk">${r.source_text}</b>»`)}if(r.source_act===$||r.source_act===z)if(r.source_message){var h=vt(Emoji.emojiToHTML(stripHTML(r.source_message.replace(/<br\s?\/?>/gi," ")),!0)),f=ht("",h,!1,"im_srv_mess_link");u=u.replace("{msg}",f)}else u=u.replace(/{link}(.+){\/link}/i,(e,t)=>ht("",t,!1,"im_srv_mess_link"));return u}function bt(e,t,n,a){if(t===V){var r=geByClass1("_im_mess_"+e.messageId,a);if(r){var i=n.tabs[e.peerId];r.parentNode.innerHTML=getTemplate("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:ft(n,e,i)+n.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return a}function vt(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(r.MENTION_RAW,"$1$4")}function yt(e,t){return!t&&e===vk.id}function Ot(e,t){return Object(u.showTooltip)(e,{url:Object(s.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function Ct(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=se(getTemplate("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===n?"im-preloader_bottom":"im-preloader_top",a].join(" ")})),i=!1;function s(){i=!0,removeClass(r,"im-preloader_visible"),r.parentNode&&r.parentNode.removeChild(r)}setTimeout(()=>{i||("bottom"===n?e.appendChild(r):e.insertBefore(r,domFC(e)),addClass(r,"im-preloader_visible"))},0),t.then(s).catch(e=>{Object(T.imWeirdCatch)("wrapLoading",e),s()})}}function jt(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,a.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Et(e,t){if(!t&&!e)return!1;var n=e.target||e.srcElement,a=8,r=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!n||n.onclick||n.onmousedown||"A"==n.tagName||hasClass(n,"_im_no_select")||hasClass(n,"im_msg_media_link")||"IMG"==n.tagName&&!hasClass(n,"_im_graffiti")&&!hasClass(n,"emoji")&&!hasClass(n,"emoji_css")&&!hasClass(n,"im_gift")||"TEXTAREA"==n.tagName||hasClass(n,"play_new")||hasClass(n,"videoplayer")||(r=i.test(n.className)))break}while(a--&&(n=n.parentNode));return!r||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function Tt(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${Ke(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function St(e,t,n){var a=getLang("mail_deleteall1"),r=getLang("mail_sure_to_delete_all"),i=getLang("mail_delete");return Object(c.isChatPeer)(t)&&(Object(S.doesChatTabHaveFlag)(e,1024)?(a=getLang("mail_leave_channel"),r=getLang("mail_unfollow_channel_confirmation"),i=getLang("mail_unfollow_channel")):r=getLang("mail_chat_sure_to_delete_all")),Object(s.isCommunityPeer)(t)&&(r=getLang("mail_group_sure_to_delete_all")),Object(g.showFastBox)(a,r,i,n,getLang("global_cancel"))}function wt(e,t,n){var a=Object(s.getTab)(e,t),r=Object(c.isChatPeer)(t),i=r&&Object(s.isChannelPeer)(a),o=r&&Object(s.tabIsMessageRequestToChat)(a),l=getLang("mail_deleteall1"),d=getLang("mail_sure_to_delete_all"),u=getLang("mail_delete");if(r){if(!Object(s.isChatActive)(a))return St(a,t,n.bind(null,!0));i?(l=getLang("mail_leave_channel"),d=getLang("mail_vkcomgroup_leave_confirm"),u=getLang("mail_leave_channel")):o?(l=getLang("mail_reject_mr_confirmation_title"),d=getLang("mail_reject_mr_confirmation_text"),u=getLang("mail_message_request_reject")):(l=getLang("mail_leave_chat"),d=getLang("mail_chat_leave_confirm"),u=getLang("mail_leave_chat"))}Object(s.isCommunityPeer)(t)&&(d=getLang("mail_group_sure_to_delete_all"));var g=new MessageBox({title:l,width:i?450:500}).content(d).setButtons(u,()=>n(!!isChecked(geByClass1("_check_is_delete"))||!r),getLang("global_cancel")).show();return!r||i||o||g.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),g}function It(e){return Object(g.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function kt(e,t,n,a){var r=getLang("mail_dialog_msg_delete_N",t),i=Object(g.showFastBox)(getLang("mail_dialog_msg_delete_title"),r,getLang("mail_delete"),()=>a(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),s="",o=!1;return n&&(s=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,o=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(s),o&&checkbox(geByClass1("_check_forall")),i}function Mt(e,t,n,a,r){t.showProgress(),e.set(a.bind(null,r)).then(()=>{t.hideProgress(),t.hide(),n().removePeer(e,r),n().updateDialogFilters(e)})}function At(e,t,n,a){var r=e.get().tabs[t].memberIds;e.set(a.bind(null,"add_member",r)).then(n().showCreation)}function Lt(e,t,n){var a=e.get();if(a.active_tab===r.FOLDER_ALL&&0===a.dialog_tab_cts.mr)return!1;var i=a.active_tab===r.FOLDER_MESSAGE_REQUEST?r.FOLDER_ALL:r.FOLDER_MESSAGE_REQUEST;return e.set(n.bind(null,i)).then(e=>{t().restoreDialogs(e,!0)})}function Pt(e,t,n){if(e.get().active_tab===r.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var a=e.get().active_tab===r.FOLDER_UNREAD?r.FOLDER_ALL:r.FOLDER_UNREAD;return e.set(n.bind(null,a)).then(e=>{t().restoreDialogs(e,!0)})}function Nt(e,t,n,a){if(t.get().active_tab===e)return Promise.resolve(t);var r=Object(s.isReversedDialogs)(t);return t.set(a.bind(null,e)).then(e=>(n().restoreDialogs(e,!0,r!==Object(s.isReversedDialogs)(e)),e))}function xt(e,t){void 0===t&&(t=e.get().peer);var n=e.get().tabs[t];return r.FOLDER_MASKS[r.FOLDER_IMPORTANT]&n.folders}function Dt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(s.isFoldersAvailable)(e))return!1;var a=n||e.get().tabs[t];return r.FOLDER_MASKS[r.FOLDER_UNRESPOND]&a.folders}function Rt(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function Bt(e){return null!=e.get().pendingForward}function Ft(e,t){return(t.get().block_states[e]||{}).who===vk.id}function Ht(e,t){var n=e.get().block_states;Object.keys(n).forEach(r=>{n[r].time?!1===n[r].free&&Date.now()-n[r].time>=5e4&&t.push([a.mutexEvent([,1,"gim"+e.get().gid,r,0,""])]):n[r].time=Date.now()})}function Ut(e,t,n){var a;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(n,r)=>{r&&(a=t(n,e,r))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),a.unmount()}}},n)}function Gt(e,t){return qt(e.get(),t,Object(s.getTab)(e,t).last_seen)}function qt(e,t,n,a){if(n.platform)return getLang("mail_header_online_status")+(n.mobile?Kt(t,!1,!1,!0):"");if(!n.can_see){var r=Object(C.oCacheGet)(e,t),i=r||e.tabs[t];return function(e,t){var n;switch(e){case"recently":n=getLang("global_online_was_recently","raw");break;case"last_week":n=getLang("global_online_was_week","raw");break;case"last_month":n=getLang("global_online_this_month","raw");break;case"long_ago":n=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,n)}(n.status,i.sex)}if(!n.time||Date.now()-1e3*n.time>7776e6)return"";var s=getDateText(n.time,e.timeshift),o=langSex(Object(C.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",s);return n.mobile&&(o+=Kt(t,!1,!1,a)),o}function Kt(e,t,n,a){var r={mid:e};n||(r.was=1),t?r.forcetoup=!0:r.forcetodown=!0,r=Object.assign(r,a);var i=JSON.stringify(r).slice(1,-1).replace(/"/g,"&quot;");return getTemplate("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function Vt(e,t){var n=t.get().tabs[e];return showBox("al_settings.php",{act:"blacklist_box",q:n.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function Wt(e,t){return showBox("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function $t(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function zt(e,t,n,a){var r;hn(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(a,i)=>{i&&(r=n(a,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{r&&r.unmount()}}},a),e)}function Yt(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function Qt(e,t,n){var a=geByClass1("_im_mess_"+e,n);return a&&toggleClass(a,"im-mess_fav",t),n}function Xt(e,t,n){var a=geByClass1("_im_unread_bar_row",t);if(!a)return t;var r=domClosestSibling(a,"._im_mess_stack",-1),i=domClosestSibling(a,"._im_mess_stack"),o=r?geByClass("_im_mess",r).pop():null,l=i?geByClass1("_im_mess",i):null;if(re(a),ve(t),!l||!o)return t;var c=domData(l,"msgid"),d=Object(s.getPreviousMessage)(e,n,c),u=Object(s.getMessage)(e,n,c);if(!d||Ge(e.tabs[n],d,u,e))return t;var g=geByClass1("_im_stack_messages",r),m=geByClass1("_im_stack_messages",i).children;return Object(O.toArray)(m).forEach(e=>{re(e),g.appendChild(e)}),re(i),t}function Jt(e,t,n){var a=Object(s.getFirstUnread)(e,e.get().peer);if(!a)return[!1,0];var r=geByClass1("_im_mess_"+a,t);if(!r){var i=Object(s.getLastMessage)(e,e.get().peer,a);if(!i)return[!0,0];r=geByClass1("_im_mess_"+i.messageId,t)}var o=hasClass(r,"_im_mess_srv")?r:gpeByClass("_im_mess_stack",r);if(!o)return[!0,0];var l=r?r.offsetTop:0,c=o.offsetTop+l,d=n.contHeight();return c<=n.scrollTop()+n.getScrollHeight()?[!0,0]:[!1,Math.max(0,d-c)]}function Zt(e,t,n){cancelEvent(t);var a=gpeByClass("_im_top_notice",n);fadeOut(a,200,re.pbind(a));var r=gpeByClass("_im_page_dialogs",a);r&&hasClass(r,"im-page--dialogs-notice")&&removeClass(r,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:a.getAttribute("data-type"),hash:a.getAttribute("data-hash")})}function en(e,t,n){cancelEvent(t);var a=gpeByClass("_im_aside_notice",n);slideUp(a,200,re.pbind(a)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:a.getAttribute("data-type"),hash:a.getAttribute("data-hash")})}function tn(e,t){cancelEvent(e);var n=gpeByClass("_im_aside_promo_block",t);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function nn(e,t){gpeByClass("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function an(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function rn(e,t,n,a,r){if(n=n.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),n=Object(l.replaceMentions)(n,(e,t,n,a,r)=>r),a&&(n=Emoji.emojiToHTML(n,!0)),t&&"..."!==t.trim()&&!Object(c.isChatPeer)(e)&&(n=getTemplate("im_topic",{topic:t,cls:"im-topic_dialog"})+n),!n&&r.length>0){var i=an(r);n=getTemplate("im_dialog_media",{name:sn(i[0],i)})}return n}function sn(e,t){var n={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var a=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(a,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var r=t.filter(t=>t.type===e.type).length;return langNumeric(r,n[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function on(e){addClass(e,"im-send-btn_loading")}function ln(e){removeClass(e,"im-send-btn_loading")}function cn(e){var t=e.get(),n=Object(s.getPinnedMessage)(e);if(!n||!Object(j.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e)))return"";var a=Object(C.oCacheGet)(e,n.userId);if(!a)return"";var r=dn(e,n);if(!r)if(!(r=n.text)&&n.attaches.length){var i=an(n.attaches);r=getTemplate("im_pinned_message_media",{text:sn(i[0],i)})}else r=qe(e,r,n&&n.kludges||{})||"";return r=r.replace(/<br\s?\/?>/gi," "),getTemplate("im_pinned_message",{date:getSmDate(n.date,t.timeshift),content:r,link:a.link,name:a.name})}function dn(e,t){var n="";if(t&&Object(o.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var a="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(a=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var r=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,a,!0);n=getLang("mail_money_request_collected_amount_from").replace("{amount}",r).replace("{total_amount}",i)}else{var s=langNumeric(t.kludges.attach1_tr_amount/1e3,a,!0);n=getLang("mail_money_request_collected_amount").replace("{amount}",s)}if(intval(t.kludges.attach1_held_amount)){var l=langNumeric(t.kludges.attach1_held_amount/1e3,a,!0);n+=" "+getLang("mail_money_request_held_amount").replace("{amount}",l)}t.text&&(n+='<span class="divider"></span>'+qe(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(n+=getTemplate("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return n}function un(e,t,n){var a=n.getAttribute("data-info");a&&Object(u.showTooltip)(n,{text:a,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function gn(e,t,n){var a=+n.getAttribute("data-time");a&&Object(u.showTooltip)(n,{text:getLang("mail_message_edited")+" "+getSmDate(a,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function mn(e,t,n){var a=n.target,r=a.closest("."+F),i=r.querySelector("."+H);if(i){var s,o=Number(i.getAttribute("data-msgid")),l=k.casperMessagesStore.getExpireTime(o),c="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var d=t.querySelectorAll(".im-mess-stack--bomb");Array.from(d).forEach(e=>{e!==a&&tooltips.hide(e,{fasthide:!0})})}var g=pn(e);Object(u.showTooltip)(a,{text:p(formatTime(l)),className:"_im_history_tooltip "+c,appendParentCls:F,black:1,shift:[12,4],onShowStart:m,onShowEnd(){s=setTimeout(m,500)},onHide(){clearTimeout(s)},force:!0,toup:a.getBoundingClientRect().top>g+37,hasover:!0}),setTimeout(m,500)}function m(){var e=r.querySelector(`.${c} .tt_text`);e&&(e.innerHTML=p(formatTime(k.casperMessagesStore.getExpireTime(o)))),s=setTimeout(m,500)}function p(e){return`<div class="wrapped">${e}</div>`}}function pn(e){var t=Object(s.getPeer)(e),n=Object(s.getTab)(e,t),a=Object(j.isPinnedMessageVisibleInTab)(e,Object(s.getPeer)(e))||n&&n.top_banner,r=Object(M.getPeerProfileHeight)();return 105+(a?_n(e):0)+r}function _n(e){var t=Object(s.getPinnedMessage)(e);return t&&Object(o.isMoneyRequest)(t)?62:52}function hn(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?gn(t,0,e.target):hasClass(e.target,"_im_page_info")&&un(0,0,e.target)})}function fn(e,t,n,a,r){var i,s=e.get();hn(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:n,gid:e.get().gid,hash:s.tabs[n].hash},{onDone:(n,r)=>{r&&(i=a(n,e,t,r))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},r),e)}function bn(e,t,n){var a=e.get();hn(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:a.peer,msgid:t,gid:a.gid,hash:a.tabs[a.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},n),e)}function vn(e,t){return!(!Object(c.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function yn(e){return!Object(c.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function On(e,t){var n=Object(C.oCacheGet)(e,t.peerId),a=Object(s.getTab)(e,t.peerId)||{};return n&&(t.photo=t.photo||n.photo,t.name=t.name||n.name,t.href=t.link||n.link,t.sex=t.sex||n.sex),t.last_touched=a.last_touched||0,t.verified=!!t.verified,t.lastmsg=t.lastmsg||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(c.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||a.memberIds||null),t}function Cn(e,t){for(var n in t)t.hasOwnProperty(n)&&On(e,t[n])}function jn(e,t){var n=[],a=t.find(e=>"mail"===e[0]),r=a?a[1].split(";"):[];for(r.length>100&&(a[1]=r.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),n.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&n.push({msgText:e,attaches:t}),n.length||n.push({attaches:t}),r=r.slice(100);r.length;r=r.slice(100))n.push({attaches:[["mail",r.slice(0,100).join(";")]]});return n}function En(e){return e.length>4096}function Tn(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(Sn(t,a),{act:"a_chat_preview"}),s=!1;showBox("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(n),s&&s.unmount()}},onFail:e=>(setTimeout(()=>Object(g.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){s=y(t.bodyNode,e,r)}},{})}function Sn(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash}:e}function wn(){Object(g.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function In(e,t){var n=Object(s.getTab)(e,t.peerId)||{},a=e.get(),r=Object(c.isChatPeer)(t.peerId)&&Object(S.isUserAdminInChat)(n,a.id),i=Object(c.isChatPeer)(t.peerId)&&Object(S.isUserAdminInChat)(n,t.userId);if(!t)return!1;if(!Object(o.isOut)(t)&&(!r||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(me(e,t.peerId,t.messageId))return!1;if(Object(c.isChatPeer)(t.peerId)){if(!Object(s.isChatActive)(n))return!1}else if(n.block_error>0)return!1;return!0}function kn(e,t){var n=Object(s.getTab)(e,t),a=-1!==n.memberIds.indexOf(n.ownerId),r=a?[n.ownerId]:[];return(r=r.concat(n.memberIds.filter(t=>t!==n.ownerId&&Object(C.oCacheExists)(e,t)).slice(0,a?4:5))).map(t=>Object(C.oCacheGet)(e,t))}function Mn(e,t){return t.map(t=>Object(C.oCacheGet)(e,t))}function An(e,t){return Object(s.getTab)(e,t).memberIds.reduce((t,n)=>{var a=Object(C.oCacheGet)(e,n);return t[a.id]=a,t},{})}function Ln(e,t){if("number"!=typeof e||0===e)return"";var n,a=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],r=e,i=[];if(a.forEach(e=>{var t=A(e,2),n=t[0],a=t[1],s=Math.floor(r/n);r%=n,s>=1&&i.push(langNumeric(s,a))}),1===(n=i.length))return i.pop();var s=i.slice(0,n-1).join(", "),o=i.pop();return getLang("global_and").replace(/{before}/gi,s).replace(/{after}/gi,o)}function Pn(e,t,n,r){r&&!me(e,n,r)&&(Object(s.getMessage)(e,n,r)?(e.setState({msgid:r}),Object(i.updateLocation)({msgid:r}),t()):e.get().longpoll.push([a.changePeer(n,r)]))}function Nn(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var n=e.get().tabs[e.get().peer],a=Object(s.parserMessage)(n.msgs[domData(t,"msgid")]);return a&&a.peerId==e.get().peer?a:null}function xn(e,t){if(Object(s.isClassicInterface)(e)){var n=document.getElementById("ui_rmenu_mr");n&&(Object(s.existsIncomingMessageRequest)(e)?n.classList.remove("unshown"):n.classList.add("unshown"))}else t(e)}function Dn(e){var t=Object(O.unpackStore)(e),n=Number(t.dialog_tab_cts[r.FOLDER_MESSAGE_REQUEST]),a=n>0?n:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=a)}function Rn(){for(var e=curBox();e;)e.hide(),e=curBox()}function Bn(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function Fn(e,t){var n=Object(s.getPeer)(e),a=Object(s.getMessage)(e,n,t);return Object(S.canPinOrUnpin)(e,n)&&!Object(o.hasPrivateStory)(a)&&!Object(o.isCasperMessage)(a)}function Hn(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var a=Object(s.getMessage)(e,n,t);return Object(o.hasPrivateStory)(a)||Object(o.isCasperMessage)(a)})}function Un(e,t){var n=Object(s.getPeer)(e);return!t.find(t=>{var a=Object(s.getMessage)(e,n,t);return Object(o.isCasperMessage)(a)})}function Gn(e,t){var n=k.casperMessagesStore.isProcessed(e.messageId),a=k.casperMessagesStore.has(e.messageId),r=k.casperMessagesStore.getExpireTime(e.messageId)>k.MAX_DEVIATION;(!a&&!n||a&&r)&&t(e),a&&r&&k.casperMessagesStore.remove(e.messageId)}function qn(e){return e===vk.id}function Kn(e,t){return Object(c.isUserPeer)(t)&&!qn(t)&&!Object(s.isCommunityInterface)(e)&&!De(t)}function Vn(e,t){var n=e.get(),a=Object(s.isCommunityInterface)(e);return Object(c.isUserPeer)(t)&&!qn(t)&&!a&&!inArray(t,n.moneyTransferExcept)&&!De(t)||Object(s.isCommunityPeer)(t)&&n.moneyTransferCommAvail&&Object(s.getCurrentTab)(e).moneyTransferAvail&&!a||a&&n.moneyRequestAvail&&!Object(c.isChatPeer)(t)||Object(c.isChatPeer)(t)&&Object(s.getCurrentTab)(e).moneyRequestAvail&&!Object(s.isCasperChat)(e,t)}function Wn(e,t,n){var a=geByClass1("_im_mess_"+n.messageId,t),r=a&&a.closest("._im_mess_stack");if(!a||!r)return t;var i,s,o,l=Array.from(r.querySelectorAll("._im_mess")),c=A((s=(i=r).previousElementSibling,o=i.nextElementSibling,[s&&1===s.nodeType?s:null,o&&1===o.nodeType?o:null]),2),d=c[0],u=c[1],g=d&&d.classList.contains("im-expired-message"),m=u&&u.classList.contains("im-expired-message"),p=g&&0===l.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId),_=m&&l.findIndex(e=>+e.getAttribute("data-msgid")===n.messageId)===l.length-1,h=$n((p?+d.getAttribute("data-count"):0)+(_?+u.getAttribute("data-count"):0)+1,"_im_expired_message_"+n.messageId),f=se(h);if(p&&(f.classList.add(...d.classList),d.remove()),_&&(f.classList.add(...u.classList),u.remove()),1===l.length)r.replaceWith(f);else{var b=A(l.reduce((e,t)=>{var a=+t.getAttribute("data-msgid");return a<n.messageId&&e[0].push(t),a>n.messageId&&e[1].push(t),e},[[],[]]),2),v=b[0],y=b[1];r.replaceWith(se(zn(e,v))||"",f,se(zn(e,y))||"")}return t}function $n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return getTemplate("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(d.classNames)(t)})}function zn(e,t){if(0===t.length)return"";var n=+t[0].getAttribute("data-peer"),a=+t[0].getAttribute("data-msgid"),r=Object(s.getMessage)(e,n,a);return getTemplate("im_mess_stack",Object.assign(Yn(e,r),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function Yn(e,t){var n=Object(O.unpackStore)(e),a=t.peerId,r=t.messageId,i=Object(s.getTab)(e,a),l=Object(o.getUserId)(t),u=Object(o.getAdminId)(e,t),g=Object(C.oCacheGet)(n,u?-n.gid:l)||i,m=Object(c.isChatPeer)(a)?g.name:g.first_name,p=g.link||i.href,_=Object(c.isChatPeer)(a)&&g.covid_status?g.covid_status:"",h=getTemplate("im_mess_stack_name",{name:m+_,link:p,class:Object(o.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(o.isGift)(t)&&(h+=getTemplate("sImGiftLabel",{content:langSex(g.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(o.isMoney)(t)){var f=Object(o.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");h+=getTemplate("sImMoneyTransferLabel",{content:langSex(g.sex||0,f)})}var b=function(e,t){var n=Object(O.unpackStore)(e),a=t.peerId,r=t.messageId,i=Object(c.isChatPeer)(a)&&Object(s.isCasperChat)(n,a)?"":(m=t.date,p=n.timeshift,langDate(1e3*m,"{hour}:{minute} {am_pm}",1e3*p,[],!0)),l=Object(o.getAdminId)(e,t),u=Object(s.isCommunityInterface)(e)?"/gim"+n.gid:"/im",g=t.local?getTemplate("im_stack_date",{date:i,link:`${u}?sel=${a}&msgid=${r}`}):i;var m,p;if(l&&n.admins[l]){var _=n.admins[l],h=l===vk.id?getLang("mail_by_you"):_[0];g+=" "+getTemplate("im_admin_link",{name:h,href:_[1]})}return g+function(e,t){if(!Object(o.isCasperMessage)(t))return"";var n=A(k.casperMessagesStore.getTimings(t.messageId),3),a=n[0],r=n[1],i=n[2],l=Math.max(a+r-i,0);return getTemplate("sImBomb",{classnames:Object(d.classNames)({"im-mess-stack--bomb_hidden":Object(s.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":l<=k.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":l<=k.EXPIRING_SOON_TIME})})}(n,t)}(e,t);return{photo:g.photo,href:p,cls:"",date_attr:"",link:`/im?sel=${a}&msgid=${r}`,name:stripHTML(h),stack_name:h,peerId:l,messageMeta:b,admin:u}}function Qn(e,t){var n=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(n)).forEach(e=>{e.innerHTML=getTemplate("im_dialog_media",{name:getLang("mail_expired_message")})})}function Xn(e){return Object(c.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}function Jn(e,t,n){if(e.get().isCallsEnabled&&window.Calls&&window.Calls.call){var a=Object(C.oCacheGet)(e,t);window.Calls.call(t,n,a).catch(e=>Object(g.showFastBox)(getLang("global_error"),e))}}function Zn(e,t){var n=e.get(),a=Object(s.getTab)(e,t);return!!n.isCallsEnabled&&(!Object(s.isCommunityInterface)(e)&&(!!Object(c.isUserPeer)(t)&&!!a.can_start_call))}},PU8N:function(e,t,n){"use strict";function a(){return!!window.isMVK}function r(e){return void 0===e&&(e=""),new Promise((function(t,n){var a=document.createElement("video");a.addEventListener("loadedmetadata",(function(){return t(a.duration)}),{once:!0}),a.addEventListener("error",n,{once:!0}),a.crossOrigin="anonymous",a.preload="metadata",a.src=e}))}function i(e){return new Promise((function(t,n){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(){if(404===a.response.status)return n();t(a.response)},a.onerror=n,a.send()}))}function s(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}n.r(t),n.d(t,"isMvk",(function(){return a})),n.d(t,"getVideoDuration",(function(){return r})),n.d(t,"getMediaBlob",(function(){return i})),n.d(t,"getBlobType",(function(){return s})),n.d(t,"noop",(function(){return o})),n.d(t,"getAverageRGB",(function(){return l})),n.d(t,"loadImage",(function(){return c}));var o=function(){};function l(e){var t,n={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return n}for(var a=-4,r=0;(a+=20)<t.data.length;)++r,n.r+=t.data[a],n.g+=t.data[a+1],n.b+=t.data[a+2];return n.r=~~(n.r/r),n.g=~~(n.g/r),n.b=~~(n.b/r),n}function c(e){return new Promise((function(t,n){var a=new Image;a.crossOrigin="anonymous",a.onerror=function(){return n(new Error("Failed to load image's URL: "+e))},a.onload=function(){return t(a)},a.src=e}))}},PjZB:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));n("rGqo"),n("a1Th"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));class i extends a.Component{constructor(e){super(e),this.id=Math.round(1e6*Math.random()).toString(16),this.setSpinnerParams(e)}componentWillReceiveProps(e){this.setSpinnerParams(e)}setSpinnerParams(e){this.offset=Math.round(Math.PI*e.size),this.c=.5*e.size,this.animation=function(e,t){if(!e||!t)return"";var n=Object.keys(t).map(e=>e+" {"+Object.keys(t[e]).map(n=>n+":"+t[e][n]).join(";")+"}").join("");return`@-webkit-keyframes ${e} {${n}} @keyframes ${e} {${n}}`}("dash"+this.id,{"0%":{"stroke-dashoffset":this.offset},"50%":{"stroke-dashoffset":Math.round(.25*this.offset),transform:"rotate(135deg)"},"100%":{"stroke-dashoffset":this.offset,transform:"rotate(360deg)"}})}render(){var e=this.props,t=e.style,n=e.color,i=e.size,s=e.duration,o=e.strokeWidth,l=e.className,c=this.id,d=this.offset,u=this.animation,g=Object(r.classNames)("Spinner",l);return a.createElement("div",{className:g,style:t},a.createElement("svg",{className:"Spinner__svg",width:i,height:i,viewBox:`0 0 ${i} ${i}`,xmlns:"http://www.w3.org/2000/svg"},a.createElement("g",{style:{width:i,height:i,transformOrigin:.5*i+"px "+.5*i+"px"}},a.createElement("style",{dangerouslySetInnerHTML:{__html:u}}),a.createElement("circle",{className:"Spinner__path",fill:"none",stroke:n,strokeDasharray:d,strokeDashoffset:d,strokeWidth:o,style:{animationName:"dash"+c,animationTimingFunction:"ease-in-out",animationDuration:s+"s",animationIterationCount:"infinite"},cx:.5*i,cy:.5*i,r:.5*i-.5*o}))))}}i.defaultProps={color:"#5181b8",size:19,strokeWidth:2,duration:1.4,className:""}},RQ7Z:function(e,t,n){"use strict";n.r(t),n.d(t,"screenfull",(function(){return a}));var a=function(){var e=function(){for(var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],a=0,r=n.length,i={};a<r;a++)if((e=n[a])&&e[1]in document){for(a=0,t=e.length;a<t;a++)i[n[0][a]]=e[a];return i}return!1}(),t={request:function(t){var n=e.requestFullscreen;(t=t||document.documentElement)[n]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},S2bU:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceHyperLinks",(function(){return s})),n.d(t,"replaceEmailLinks",(function(){return o})),n.d(t,"replaceMentions",(function(){return l})),n.d(t,"replaceMassMentions",(function(){return c})),n.d(t,"replaceHashtags",(function(){return g})),n.d(t,"linksReplacer",(function(){return m}));var a,r=n("h++7"),i=n("t7n3");function s(e,t){for(var n,a=0,i=e;null!==(n=r.MESSAGE_REGEXP.exec(e));){var s=(n=d(n))[0].length,o=n.index+s,l=e[n.index-1],c=e[o-1],g=void 0!==l&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(l),m=void 0!==c&&/([:;$])/i.test(c);if(!g&&!m){var p=u(n),_=p.domain.toLowerCase();if(_.length<=r.MAX_DOMAIN_LENGTH&&r.TOP_DOMAINS.includes(_)){var h=t(p);i=i.slice(0,n.index+a)+h+i.slice(o+a),a+=h.length-s}}}return i}function o(e,t){return e.replace(r.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function l(e,t){return e.replace(r.MENTION,t||function(e,t,n,a,r){return'<a href="/'+(t+n)+'" class="mem_link" mention="'+Object(i.clean)(a||"")+'" mention_id="'+Object(i.clean)(t+n)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+r+"</a>"})}function c(e,t){return e.replace(r.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink">'+e+"</span>"}))}function d(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,n=e[6].length-1;return"."===e[0][t]&&"."===e[6][n]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,n)),e}function u(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function g(e,t){return e.replace((a||(a=new RegExp(r.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),a),(function(e,n,a,r,i){return(n||"")+t(a+(i||""))}))}function m(e,t){var n=t.url,a=t.full,s=t.protocol,o=t.query,l=t.domain;try{a=decodeURIComponent(a)}catch(e){}if(a.length>55&&(a=a.substr(0,53)+".."),a=Object(i.clean)(a).replace(/&amp;/g,"&"),!e&&l.match(r.OUR_DOMAINS)){var c=n=Object(i.replaceEntities)(n).replace(r.ENTITIES,encodeURIComponent),d=n.indexOf("#/"),u="";d>=0?c=n.substr(d+1):(d=n.indexOf("#!"))>=0&&(c="/"+n.substr(d+2).replace(/^\//,""));var g=c.match(r.VK_DOMAIN);return g&&g[1].length<32&&(u=' mention_id="'+g[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(s+n+o)+'" target="_blank" rel="noopener"'+u+">"+a+"</a>"}var m=Object(i.replaceEntities)(n+o).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(s+m))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.clean)((s+n+o).replace(/'/g,"\\'"))+"', {}, event);")+'">'+a+"</a>"}},Syd7:function(e,t,n){"use strict";n.r(t),n.d(t,"getPeerProfileHeight",(function(){return W})),n.d(t,"mount",(function(){return z}));var a=n("q1tI"),r=n("i8i4"),i=n("rHUl"),s=n("P13b"),o=(n("91GP"),n("17x9"),n("pemR")),l=n("ErRf"),c=n("nAFc"),d=n("ERyv"),u=n("4+be"),g=n("6krn"),m=n("BN/X"),p=n("6aSF"),_=n("XpgC"),h=n("vT4u"),f=n("EasH"),b=g.default.getLang;class v extends a.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(f.showFastBox)(b("mail_ad_tag_no_access_box_title"),b("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`;return a.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&a.createElement(m.default,{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},a.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},b("mail_ad_tag_text_prefix")," ",e.adId)),!e.hasAdAccess&&a.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},a.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},b("mail_ad_tag_no_access_text"))))}return a.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},a.createElement("span",null,Object(c.decodeHTMLEntities)(e.name)))}}var y=v,O=g.default.getLang;class C extends a.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,n=e.tags,r=e.isPeerProfileCollapsed,i=e.adId,s=e.hasAdAccess,o=e.toggleProfile,l=n.filter(e=>t.includes(e.id));i&&l.unshift({adId:i,hasAdAccess:s});var c=0;r&&this.state.isTagsCollapsed&&l.length>5&&(c=l.splice(5).length);return l=l.map((e,t)=>a.createElement(y,{key:t,data:e})),a.createElement("div",{className:"PeerProfileTagsList"},l.length>0&&l,c>0&&a.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+O("mail_im_peer_profile_extra_tags",c)),!l.length&&a.createElement("div",{className:"PeerProfileTagsListItem--empty"},O("mail_im_peer_profile_tags_empty")," ",a.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",a.createElement(m.default,{href:"#",className:"PeerProfileTagsList__toggleProfileLink",onClick:o},O(r?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var j=C,E=n("0Rlc");var T=function(e){var t=e.data,n=e.onCheckboxChange;return a.createElement("div",{className:"PeerProfileTagsGridItem"},a.createElement(E.default,{className:"PeerProfileTagsGridItem__checkbox",onChange:(e,a)=>n(t.id,a),checked:t.isChecked}),a.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),a.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(c.decodeHTMLEntities)(t.name)))};class S extends a.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return a.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>a.createElement(T,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var w=S,I=n("r7nW"),k=n("Ht+d"),M=n("6raB"),A=n("0toi"),L=g.default.getLang;class P extends a.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=a.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,n=e.data,r=e.onNameChange,i=e.onRemove;return a.createElement("div",{className:"PeerProfileTagsModalField"},a.createElement("input",{type:"hidden",value:n.id?n.id:""}),a.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(c.decodeHTMLEntities)(n.name),ref:this.inputRef,onChange:e=>r(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:L("mail_im_peer_profile_manage_tags_placeholder")}),a.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:n.color}}),a.createElement(_.default,{position:"t",text:L("mail_im_peer_profile_manage_tags_remove")},a.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}var N=P;function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var D=g.default.getLang,R=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],B=R[0];class F extends a.Component{constructor(e){super(e),this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():B,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return R.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var n=e.target.value;this.setState({tags:this.state.tags.map((e,a)=>a===t?x({},e,{name:n,state:e.state||"changed"}):e)})},this.onRemove=e=>{var t=this.state.tags[e];this.setState({tags:this.state.tags.filter((t,n)=>n!==e),deletedTags:[...this.state.deletedTags,x({},t,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.state={tags:e.tags.length?e.tags.map(e=>x({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1},this.inputsRef=a.createRef()}render(){return a.createElement(I.default,{onClose:this.props.onClose,className:"PeerProfileTagsModal",disableBackdropClick:!0,disableEscapeClose:!0},a.createElement("form",{onSubmit:this.onSubmit},a.createElement(A.default.Header,{title:D("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),a.createElement(A.default.Body,null,a.createElement(p.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},a.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>a.createElement(N,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?a.createElement(m.default,{href:"#",className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},D("mail_im_peer_profile_manage_tags_add_link")):""))),a.createElement(A.default.Footer,{actionButtons:[a.createElement(k.default,{key:"cancel",appearance:"secondary",onClick:this.props.onClose},D("global_cancel")),a.createElement(M.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},D("global_save"))]})))}}var H=F;function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var G=g.default.getLang;class q extends a.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var n=this.props.store,a=n.get().peer;this.setState(n=>({peerTags:t?[].concat(n.peerTags,e):n.peerTags.filter(t=>t!==e)}),()=>{n.set(h.peerProfileToggleTag.bind(null,e,t?"bind":"unbind",a,[...this.state.peerTags])).catch(e=>Object(d.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(h.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isModalOpened:!1}),showDoneBox(G("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(d.imWeirdCatch)("PeerProfile.manageTags",e))})},this.toggleModal=(e,t)=>{e&&e.preventDefault(),this.setState({isModalOpened:t}),t&&Object(l.cancelStackPush)("peer_profile_tags_modal",()=>{Object(l.cancelStackFilter)("peer_profile_tags_modal"),this.toggleModal(null,!1)})};var t=e.store.get(),n=t.peer,a=Object(i.getTab)(t,n);this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:a.peer_tags||[],isModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.getTab)(e,e.peer),n=this.state,r=n.isCollapsed,s=n.tags,l=n.peerTags,d=n.isModalOpened,g=s.length>0,h=g?s.reduce((e,t)=>(e[t.id]=!0,e),{}):[],f=l.filter(e=>h[e]),b=t.peer_profile_info,v=b&&(b.city||b.age),y=Object(o.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":r});return a.createElement("div",{className:y},a.createElement(p.default,{className:"PeerProfile__scroll",neverHide:!0},a.createElement("dl",{className:"PeerProfile__container"},a.createElement("dt",{className:"PeerProfile__label"},G("mail_im_peer_profile_tags_label"),":"),a.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},r&&!g&&!t.ad_id&&a.createElement(m.default,{href:"#",className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0)},G("mail_im_peer_profile_manage_tags")),(g||t.ad_id)&&a.createElement(j,{tags:s,peerTags:f,isPeerProfileCollapsed:r,adId:t.ad_id,hasAdAccess:t.has_ad_access,toggleProfile:this.toggleProfile}),!r&&a.createElement(w,{tags:[...s].map(e=>U({},e,{isChecked:l.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!r&&a.createElement(m.default,{href:"#",className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0)},G("mail_im_peer_profile_manage_tags")),d&&a.createElement(H,{tags:s,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1)})),a.createElement("dt",{className:"PeerProfile__label"},G("mail_im_peer_profile_info_label"),":"),a.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},v&&a.createElement(a.Fragment,null,b.city&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(b.city)),b.age&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(b.age)),b.likes_cnt&&a.createElement(_.default,{className:"PeerProfile__infoTooltip",position:"t",text:G("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},a.createElement("span",{className:"PeerProfile__infoItem"},b.likes_cnt&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(b.likes_cnt)),b.replies_cnt&&a.createElement("span",{className:"PeerProfile__infoItem"},Object(c.decodeHTMLEntities)(b.replies_cnt))))),!v&&a.createElement("span",null,G("mail_im_peer_profile_info_empty"))),a.createElement("dt",{className:"PeerProfile__label"},G("mail_im_peer_profile_join_date_label"),":"),a.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},b&&b.join_date?Object(c.decodeHTMLEntities)(b.join_date):Object(u.langSex)(t.sex,G("mail_im_peer_profile_join_date_empty_text","raw"))))),(g||t.ad_id)&&a.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var K=q;function V(){return document.querySelector("#PeerProfile")}function W(){var e=V();return e?e.offsetHeight:0}function $(e,t){if(t){var n=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=n+W()+"px"}else e.style.removeProperty("padding-top")}function z(e){return{render(t){var n=t.get(),o=V(),l=n.peer,c=Object(i.getTab)(n,l);n.is_peer_profile_enabled&&o&&Object(s.isFullyLoadedTab)(n,l)&&!Object(i.isChannelPeer)(c)&&!Object(i.isCommunityChat)(t,l)&&(o.innerHTML&&r.unmountComponentAtNode(o),r.render(a.createElement(K,{store:t}),o,()=>{$(e,!0)}))},destroy(){var t=V();t&&(r.unmountComponentAtNode(t),$(e,!1))}}}},ThPM:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("pemR"));class i extends a.Component{render(){var e=this.props,t=e.photos,n=e.links,i=e.linkTarget,s=e.onLinkClick,o=e.className,l=Object(r.classNames)("MembersGrid","MembersGrid--"+Math.min(t.length,4),o);return a.createElement("div",{className:l},t.map((e,t)=>{var r=n&&n[t]?n[t]:void 0,o=r?"a":"span";return a.createElement(o,{key:t,href:r,target:i,onClick:e=>s(e),className:"MembersGrid__i",style:{backgroundImage:`url(${e})`}})}))}}i.defaultProps={links:[],className:""}},UlUB:function(e,t,n){"use strict";function a(e,t){var n,a,r=!1;return function i(){if(r)return n=arguments,void(a=this);e.apply(this,arguments),r=!0,setTimeout((function(){r=!1,n&&(i.apply(a,n),n=a=null)}),t)}}n.r(t),n.d(t,"throttle",(function(){return a}))},V1Nw:function(e,t,n){"use strict";function a(e,t,n){var a=0,r=e,i=[],s=!1;function o(){!i.length||a>0||s||(t(i),i=[])}return{pause:function(){a++},resume:function(){a>0&&(a--,o())},onLp:function(e,t,a){s||(r>=e?(r=t,i.push.apply(i,a),o()):n&&(s=!0,n(r).then((function(e){var t=e[1],n=e[2];r=t,s=!1,i.push.apply(i,n),o()}))))}}}n.r(t),n.d(t,"createLongpollEventsQueue",(function(){return a}))},WDXI:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return l}));n("91GP");var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("pemR")),s=n("MV/q"),o={height:"auto"};class l extends a.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange?this.props.onChange(e):this.setState({value:e.target.value,changed:this.props.value!==this.state.value})},this.onClick=()=>{this.setState({editing:!0},()=>{this.textarea&&elfocus(this.textarea),this.props.onStartEdit&&this.props.onStartEdit()})},this.onBlur=()=>{this.state.changed||this.setState({editing:!1})},this.onSave=()=>{this.props.validate&&!this.props.validate(this.state.value)||(this.setState({editing:!1,changed:!1}),this.props.onSave&&this.props.onSave({value:this.state.value}))},this.onKeydown=e=>{this.state.editing&&(27===e.keyCode&&(this.props.onCancel&&this.props.onCancel(),this.setState({editing:!1,changed:!1,value:this.props.value}),e.preventDefault(),e.stopPropagation()),this.props.useEnter&&13===e.keyCode&&(this.onSave(),e.preventDefault(),e.stopPropagation()))},this.getRef=e=>{e&&e.element&&(this.textarea=e.element)},this.state={value:e.value,editing:!1,changed:!!e.onChange&&e.changed}}componentWillReceiveProps(e){this.setState({value:e.value,changed:e.onChange?e.changed:e.value===this.state.value})}componentDidMount(){this.el=r.findDOMNode(this),this.el.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.el.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.className,n=e.validate,r=e.placeholder,l=this.state,c=l.editing,d=l.changed,u=l.value,g=Object(i.classNames)("EditableLabel",{"EditableLabel--editing":c,"EditableLabel--changed":d,"EditableLabel--invalid":n&&!n(u),"EditableLabel--placeholder":!u.trim()&&r},t);return a.createElement("div",{className:g},c?a.createElement(a.Fragment,null,a.createElement(s.default,{className:"EditableLabel__textarea",onChange:this.onChange,onInput:this.onChange,onPaste:this.onChange,value:u,onBlur:this.onBlur,style:Object.assign({},o,this.props.textareaStyles),rows:"1",ref:this.getRef,placeholder:r}),d&&a.createElement("button",{className:"EditableLabel__save",onClick:this.onSave})):a.createElement("div",{className:"EditableLabel__text",onClick:this.onClick},u.trim()?u:r))}}l.defaultProps={value:"",changed:!1,useEnter:!1,textareaStyles:{},placeholder:""}},Wu9C:function(e,t,n){"use strict";n.r(t),n.d(t,"isPinnedMessageVisibleInTab",(function(){return g})),n.d(t,"pinnedMessageHide",(function(){return m})),n.d(t,"pinnedMessageUnHide",(function(){return p})),n.d(t,"pinnedMessageUnpin",(function(){return _})),n.d(t,"mount",(function(){return y}));var a=n("ofcU"),r=n("vT4u"),i=n("P13b");function s(e){return{unmount(){Object(a.destroyModule)(e)}}}function o(e,t,n,r){var o=Object(a.createMutations)(s).bindMutations,l=t=>{n().messageKeyboardButtonClick(t),e.hide()};return o(Object(a.createModule)({handlers:(t,n)=>{n(e.bodyNode,"click",i.MESSAGE_KEYBOARD_BUTTON_CLASS,l)}}))}var l=n("rHUl"),c=n("aong"),d=n("uytb"),u=n("FWc3");function g(e,t){if(Object(c.unpackStore)(e).searchShown)return!1;var n=Object(l.getTab)(e,t),a=n&&Object(l.parserMessage)(n.pinned);return!!a&&n.pinHideId!=a.chat_local_id}function m(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Object(l.getTab)(e,t),i=r&&Object(l.parserMessage)(r.pinned);r&&i&&(r.pinHideId=i.chat_local_id,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[r.peerId,r.pinHideId]),f(n,t,e),re(geByClass1("_im_pinned_tt")),a&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function p(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=Object(l.getTab)(e,t);r&&r.pinHideId&&(delete r.pinHideId,cur.imDb.update(d.PIN_HIDDEN_ID_OP,[r.peerId,void 0]),f(n,t,e),a&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function _(e,t,n){var a=f.bind(null,n,t),s=Object(i.showUnpinDialog)(()=>{s.hideProgress(),s.hide(),e.set(r.unpinMessageOptimistic.bind(null,t)).then(a).then(e=>e.set(r.unpinMessage.bind(null,t))).then(a)})}function h(e,t,n){var a=e.get().peer,r=Object(l.parserMessage)(Object(l.getTab)(e,a).pinned);if(n.target.classList.contains("_im_pin_hide"))r&&m(e,a,t);else if("A"!==n.target.tagName){var s=r&&r.messageId;s&&!Object(i.isAlreadyDeleted)(e,a,s)?Object(i.focusOnMessage)(e,t().focusOnMessage,a,s):Object(i.showPinnedBox)(e,t,a,o,n),statlogsValueEvent("im_pinned_messages","open")}}function f(e,t,n){return e().updateChatTopic(t,n),Object(r.setActions)(n.get()),e().updateActions(n),n}function b(e){Object(u.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function v(e){return{unmount(){Object(a.destroyModule)(e)}}}function y(e,t,n){var r=Object(a.createMutations)(v).bindMutations,i=h.bind(null,t,n),s=b.bind(null);return r(Object(a.createModule)({handlers:(t,n)=>{n(e,"click","_im_pinned_message",i),n(e,"mouseover","_im_pin_hide",s)}}))}},XTb9:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.onTransitionEnd=e=>{this.state.shown&&"opacity"===e.propertyName&&(this.timeout=setTimeout(()=>{this.setState({shown:!1}),this.props.callback()},this.props.duration))},this.state={shown:e.shown}}componentWillReceiveProps(e){!this.props.shown&&e.shown&&this.setState({shown:!0})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout)}render(){var e=this.props,t=(e.shown,e.callback,e.duration,e.className),n=e.children,o=s(e,["shown","callback","duration","className","children"]),l=Object(r.classNames)("BlinkText",{"BlinkText--shown":this.state.shown},t);return a.createElement("span",i({},o,{className:l,onTransitionEnd:this.onTransitionEnd,"aria-hidden":!0}),n)}}o.defaultProps={duration:2e3}},XpgC:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));n("91GP");var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("pemR")),s=n("clTp");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var l=e=>{var t=e.position,n=e.align,a=e.text,r=e.rect,i=e.marginTop,s=e.marginLeft,o=e.maxWidth,l=e.appearance,c=e.className,d=r.left,u=r.top;switch(t){case"t":d+=.5*r.width;break;case"r":d+=r.width,u+=.5*r.height;break;case"b":d+=.5*r.width,u+=r.height;break;case"l":u+=.5*r.height}return{tooltip:{position:t,align:n,text:a,x:d=Math.round(d+s),y:u=Math.round(u+i),maxWidth:o,appearance:l,className:c}}};class c extends a.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,n=t.text,a=t.position,r=t.align,i=t.marginTop,o=t.marginLeft,l=t.maxWidth,c=t.appearance,d=t.className,u=Object(s.default)(this.state.el);this.update({text:n,position:a,align:r,rect:u,marginTop:i,marginLeft:o,maxWidth:l,appearance:c,className:d})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,n=e.y,r=e.position,s=e.align,o=e.text,l=e.removed,c=e.maxWidth,d=e.appearance,u=e.className,g=Object(i.classNames)("Tooltip","Tooltip--"+r,"Tooltip--"+d,{"Tooltip--removed":!!l,["Tooltip--align-"+s]:"t"===r||"b"===r},u);return a.createElement("div",{className:g,style:{top:n,left:t},onTransitionEnd:this.onTransitionEnd},a.createElement("div",{className:"Tooltip__in",style:{maxWidth:c},dangerouslySetInnerHTML:{__html:o}}))},this.state={}}componentDidMount(){var e=r.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(n=>e[n]!==t.tooltip[n])?l(o({},e,{rect:Object(s.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(l(e))}render(){var e=this.renderTooltip();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),a.createElement(a.Fragment,null,this.props.children,r.createPortal(e,this.defaultNode))):this.props.children}}c.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},Ya1X:function(e,t,n){"use strict";n.r(t);n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}t.default=e=>{var t=e.className,n=s(e,["className"]);return a.createElement("div",i({className:Object(r.classNames)("HintIcon",t)},n))}},ZVxX:function(e,t,n){"use strict";n.r(t),n.d(t,"initFailBack",(function(){return a}));n("VRzm"),n("Btvt");function a(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(n,a){e?e.call(navigator,t,n,a):a(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}},ZoqV:function(e,t,n){"use strict";n.r(t),n.d(t,"mount",(function(){return pe}));var a=n("ofcU"),r=n("q1tI"),i=n("i8i4"),s=(n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY"),n("VRzm"),n("Btvt"),n("P13b")),o=n("vT4u"),l=n("f01n"),c=n("6krn"),d=n("gqqU"),u=n("Ht+d"),g=(n("pIFo"),n("pemR")),m=n("XpgC"),p=n("WDXI"),_=n("Ya1X"),h=n("lJdi"),f=n("ERyv"),b=c.default.getLang;class v extends r.PureComponent{constructor(e){super(e),this.onSaveTitle=e=>{var t=this.props.store,n=t.get(),a=e.value.trim().replace("\n","");a&&a!==unclean(this.props.title)&&(this.setState({titleChanged:!1}),t.set(o.updateChatTopic.bind(null,n.peer,a)))},this.onChangeTitle=e=>{if(this.state.title!==e.target.value){var t=e.target.value.replace("\n","");this.setState({title:t,titleChanged:unclean(this.props.title)!==t})}},this.onValidateTitle=e=>!!e.trim().replace("\n",""),this.onCancelTitle=()=>{this.setState({title:unclean(this.props.title),titleChanged:!1})},this.onSaveDescription=e=>{},this.onPhotoUpload=()=>{var e=this.props.store,t=e.get().peer;Object(h.canChangeTitle)(e)&&(cur.recieveCropResult=void 0,Page.ownerPhoto(t,{gid:e.get().gid}))},this.onPhotoRemove=()=>{var e=this.props.store,t=e.get().peer;Object(h.canChangeTitle)(e)&&e.set(o.removeChatPhoto.bind(null,t)).then(()=>e.set(o.getChatDetails.bind(null,t))).catch(e=>Object(f.imWeirdCatch)("onPhotoRemove",e))},this.state={title:unclean(e.title),titleChanged:!1}}getCasperInfo(){var e=b("mail_casper_chat_info");return r.createElement(r.Fragment,null,b("mail_casper_chat_label"),r.createElement(m.default,{text:e,position:"t",appearance:"light",maxWidth:280,marginTop:-6},r.createElement(_.default,{"aria-label":e,className:"ChatSettingsInfo__casperHint"})))}render(){var e=this.props,t=e.store,n=e.photo,a=e.title,i=e.description,s=e.grid,o=e.meta,l=e.isDefaultPhotoOwner,c=void 0!==l&&l,d=e.isCasper,u=void 0!==d&&d,_=unclean(a),f=Object(h.canChangeTitle)(t),v=Object(g.classNames)("ChatSettingsInfo",{"ChatSettingsInfo--editable":f}),y=Object(g.classNames)("ChatSettingsInfo__title",{"ChatSettingsInfo__title-service":64&this.props.flags});return r.createElement("div",{className:v},r.createElement("header",{className:"ChatSettingsInfo__header"},r.createElement("div",{className:"ChatSettingsInfo__photo"},r.createElement("div",{className:"ChatSettingsInfo__attach nim-peer nim-peer_larger","data-tip":b("mail_settings_photo"),onClick:this.onPhotoUpload},n?r.createElement("img",{src:n,width:"80",height:"80",alt:_,className:"ChatSettingsInfo__photoSelf"}):r.createElement("div",{className:"nim-peer--photo-w"},r.createElement("div",{className:"ChatSettingsInfo__photoGrid nim-peer--photo",dangerouslySetInnerHTML:{__html:s}}))),n&&f&&!c&&r.createElement(m.default,{text:b("mail_settings_remove_photo"),position:"t",align:"left"},r.createElement("button",{onClick:this.onPhotoRemove,className:"ChatSettingsInfo__photoRemove"}))),r.createElement("h3",{className:y},f?r.createElement(p.default,{value:this.state.title,changed:this.state.titleChanged,useEnter:!0,onSave:this.onSaveTitle,onChange:this.onChangeTitle,onCancel:this.onCancelTitle,validate:this.onValidateTitle}):_),r.createElement("div",{className:"ChatSettingsInfo__meta"},r.createElement("span",{className:"ChatSettingsInfo__metaItem"},o),u&&r.createElement("span",{className:"ChatSettingsInfo__metaItem"},this.getCasperInfo()))),i&&r.createElement("div",{className:"ChatSettingsInfo__description"},f?r.createElement(p.default,{value:i,onSave:this.onSaveDescription}):i))}}n("KKXr");var y=n("dLHM"),O=n("XTb9"),C=n("BN/X"),j=c.default.getLang;class E extends r.Component{constructor(e){super(e),this.onCopy=()=>{this.input&&(elfocus(this.input,0,this.input.value.length),document.execCommand("copy"),this.setState({copied:!0}))},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getInputRef=e=>{e&&e.element&&(this.input=e.element)},this.state={copied:!1}}componentDidMount(){this.input&&elfocus(this.input,0,this.input.value.length)}render(){var e=this.props,t=e.onReset,n=e.invitationLink,a=e.store,i=j("mail_invite_link_reset_explainer").split("{reset_link}"),o=!Object(s.isFvkcomgroup)(a,a.get().peer);return r.createElement("div",{className:"ChatSettingsInvitationLink"},this.props.reseted&&r.createElement("div",{className:"ChatSettingsInvitationLink__reseted"},j("mail_invite_link_reseted_explainer")),r.createElement("p",null,j("mail_invite_link_explainer")),r.createElement("div",{className:"ChatSettingsInvitationLink__main"},r.createElement(y.default,{ref:this.getInputRef,readOnly:"readonly",className:"ChatSettingsInvitationLink__input",value:n}),r.createElement(u.default,{onClick:this.onCopy},j("mail_get_invite_link_copy")),r.createElement(O.default,{className:"ChatSettingsInvitationLink__copied",shown:this.state.copied,callback:this.onBlinkTextHide},j("mail_invite_link_copied"))),o&&r.createElement("p",null,i[0],r.createElement(C.default,{className:"ChatSettingsInvitationLink__reset",onClick:t},j("mail_invite_reset_link")),i[1]))}}var T=n("6raB"),S=n("hIV1"),w=c.default.getLang;class I extends r.Component{constructor(e){super(e),this.onConfirm=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onConfirm().then(()=>{this.setState({loading:!1}),this.props.onCancel()}).catch(()=>this.setState({loading:!1})))},this.state={}}render(){return r.createElement("div",{className:"ChatSettingsResetInvitationLink"},r.createElement("div",{className:"ChatSettingsResetInvitationLink__text",dangerouslySetInnerHTML:{__html:w("mail_chat_reset_link_warning")}}),r.createElement(S.default,{alignment:"right"},r.createElement(u.default,{appearance:"tertiary",onClick:this.props.onCancel},w("global_cancel")),r.createElement(T.default,{onClick:this.onConfirm,loading:this.state.loading},w("mail_chat_reset_link_confirm"))))}}n("91GP");var k=n("enZq"),M=n("p+C8"),A=n("NsuH"),L=n("aFGQ"),P=n("+tmx");n("17x9");function N(e){return r.createElement("div",{className:Object(g.classNames)("ChatSettingsRoundedIcon","ChatSettingsRoundedIcon--"+e.type)})}var x=n("rHUl"),D=c.default.getLang,R=()=>[{label:D("mail_settings_time_one_hour"),value:P.HOUR},{label:D("mail_settings_time_eight_hours"),value:8*P.HOUR},{label:D("mail_settings_time_day"),value:P.DAY},{label:D("mail_settings_time_week"),value:P.WEEK},{label:D("mail_settings_time_forever"),value:-1}];class B extends r.Component{constructor(e){super(e),this.onCopyInviteLink=e=>{this.input&&(this.input.focus(),this.input.select(),document.execCommand("copy"),this.setState({copied:!0})),e.preventDefault(),e.stopPropagation()},this.onBlinkTextHide=()=>{this.setState({copied:!1})},this.getHiddenInput=e=>{this.input=e},this.onDisabledSettingsChange=e=>{var t=e.selected.value,n=t>0?Math.floor((Date.now()+t)/1e3):t,a=0!==n;this.setState({push_disabled_until:n,push_disabled:a,disabledPlaceholder:this.getDisabledPlaceholder(n)},()=>{this.props.onUpdateNotificationSettings(a,Math.floor(t/1e3)).then(()=>{this.props.afterDisableUntilUpdated()})})},this.onMentionSettingsChange=e=>{var t=e.selected.value;this.setState({mentions_push_disabled:t},()=>{this.props.onUpdateMentionNotificationSettings(t).then(()=>{this.props.afterNotificationSettingsUpdated()})})},this.onShowInviteLink=()=>{Object(h.canChangeInviteLink)(this.props.store)&&this.props.showInvitationLink()};var t=this.getPushSettingsFromProps(e),n=t.push_disabled_until,a=n>0?+new Date(n):n;this.state=Object.assign({pushDisabled:n,disabledPlaceholder:this.getDisabledPlaceholder(a),copied:!1},t)}getPushSettingsFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications}getPushDisabledFromProps(e){var t=e.store.get();return t.tabs[t.peer].notifications.push_disabled}getDisabledPlaceholder(e){if(!e||0===e)return D("mail_settings_configure");if(-1===e)return D("mail_settings_time_forever");var t=getShortDateWithTime(e,0,!1);return`${D("mail_settings_until")} ${t}`}getDisabledOptions(){return this.state.push_disabled_until?[].concat(R(),[{label:D("mail_settings_time_cancel"),value:0}]):R()}render(){var e=this.props,t=e.store,n=e.flagsUpdated,a=e.notificationSettingsUpdated,i=e.disableUntilUpdated,o=e.onHideStatus,l=t.get(),c=l.tabs[l.peer],d=Object(s.isFvkcomgroup)(l,l.peer),u=Object(x.isCommunityChat)(l,l.peer),m=c.inviteLink&&Object(h.canSeeInviteLink)(t)||Object(h.canChangeInviteLink)(t),p=Object(h.canSeeSettingsItem)(t,l.peer,l.id),_=Object(g.classNames)("ChatSettingsMenu",{"ChatSettingsMenu--copied":this.state.copied}),f=l.isMassMentionsMessageAllowed;return r.createElement("div",{className:"ChatSettings__pane"},u&&r.createElement(k.default,{className:_},r.createElement(M.default,{onClick:e=>nav.go(c.owner.link,e),chevron:!0,className:"ChatSettingsMenu__owner"},r.createElement(A.default,{size:"28",title:c.owner.title,photo:c.owner.photo,href:c.owner.link,description:c.owner.description}))),r.createElement(k.default,{className:_},r.createElement(M.default,{onClick:this.props.showAttachments,chevron:!0},r.createElement(N,{type:"attach"}),D("mail_im_show_media_history"))),r.createElement(k.default,{className:_},f&&r.createElement(r.Fragment,null,r.createElement(M.default,{selectable:!1,chevron:!1,aside:r.createElement(r.Fragment,null,r.createElement(O.default,{shown:a,callback:o},D("global_changes_saved_short")),r.createElement(L.default,{className:"ChatSettingsMenu__select",onChange:this.onMentionSettingsChange,options:[{label:D("mail_settings_mentions_all"),value:0},{label:D("mail_settings_mentions_except"),value:1},{label:D("mail_settings_mentions_disable"),value:2}],value:this.state.mentions_push_disabled}))},r.createElement(N,{type:"mention"}),D("mail_settings_mentions")),r.createElement(M.default,{selectable:!1,aside:r.createElement(r.Fragment,null,r.createElement(O.default,{shown:i,callback:o},D("global_changes_saved_short")),r.createElement(L.default,{className:"ChatSettingsMenu__select",onChange:this.onDisabledSettingsChange,options:this.getDisabledOptions(),placeholder:this.state.disabledPlaceholder}))},r.createElement(N,{type:"notice"}),D("mail_settings_notices"))),(m||p)&&r.createElement(r.Fragment,null,m&&r.createElement(M.default,{onClick:this.onShowInviteLink,chevron:Object(h.canChangeInviteLink)(t)},r.createElement(N,{type:"link"}),D(d?"mail_vkcomgroup_invite_link":"mail_chat_invite_link"),c.inviteLink&&r.createElement("span",{className:"ChatSettingsMenu__invite"},r.createElement("span",{className:"ChatSettingsMenu__hidden"},r.createElement("input",{type:"text",readOnly:!0,value:c.inviteLink,ref:this.getHiddenInput})),r.createElement(O.default,{className:"ChatSettingsMenu__copied",shown:this.state.copied,callback:this.onBlinkTextHide},D("mail_invite_link_copied")),r.createElement(C.default,{className:"ChatSettingsMenu__copy",onClick:this.onCopyInviteLink},D("mail_get_invite_link_copy")))),p&&r.createElement(M.default,{onClick:this.props.showSettings,chevron:!0,aside:r.createElement(O.default,{shown:n,callback:o},D("global_changes_saved"))},r.createElement(N,{type:"gear"}),D("mail_settings_options")))))}}n("OG14"),n("Vd3H");var F=n("uW+i"),H=n("As6E"),U=c.default.getLang;class G extends r.Component{constructor(){super(...arguments),this.toggleAdmin=()=>{var e=this.props,t=e.store,n=e.mid,a=e.adminMap,r=t.get().peer,i=!a[n];t.set(o.toggleAdminOptimisticly.bind(null,r,n,i)),t.set(o.toggleAdmin.bind(null,r,n,i))},this.kick=()=>{var e=this.props.store,t=e.get().peer,n=this.props.mid;e.set(o.kickUserOptimisticly.bind(null,t,n)),e.set(o.kickUser.bind(null,t,n)).catch(e=>{Object(f.imWeirdCatch)("ChatSettingsMemberEdit.kick",e)})},this.cancelMessageRequest=()=>{var e=this.props.store,t=e.get().peer,n=this.props.mid;e.set(o.cancelMessageRequest.bind(null,t,n)).catch(e=>{Object(f.imWeirdCatch)("ChatSettingsMemberEdit.cancel",e)})},this.changeAccess=e=>{var t=this.props.store,n=t.get().peer,a=this.props.mid;t.set(o.changeCommunityAccess.bind(null,n,a,!e)).catch(e=>{Object(f.imWeirdCatch)("ChatSettingsMemberEdit.changeAccess",e)})}}getMemberRole(e,t){var n=this.props.storeData,a=n.peer;return t===n.tabs[a].ownerId?U("mail_settings_owner"):e[t]?U("mail_settings_admin"):null}getActions(e){var t=window.vk.id,n=this.props,a=n.store,r=n.mid,i=t===r,s=[],o=Object(x.isCommunityChat)(a,a.get().peer);if(i)return o&&Object(x.isCommunityInterface)(a)?[]:[{text:U("mail_leave_chat"),onClick:this.props.onLeave}];if(Object(h.canAddAdmin)(a,r)&&s.push({text:e[r]?U("mail_chat_remove_admin"):U("mail_settings_appoint_admin"),onClick:this.toggleAdmin}),Object(h.canKickUser)(a,r)&&s.push({text:U("mail_settings_kick"),onClick:this.kick}),Object(x.isCommunityPeer)(r)&&!e[r]){var l=Object(h.canSeeAllMessages)(a,a.get().peer,r),c=l?"mail_settings_community_mentions_only":"mail_settings_community_full_access";s.push({text:U(c),onClick:this.changeAccess.bind(this,l)})}return s}render(){var e=window.vk.id,t=this.props,n=t.adminMap,a=t.storeData,i=t.mid,s=t.isContact,o=!!n[e],l=this.getMemberRole(n,i),c=e===i,d=o&&this.getActions(n);return s?r.createElement(m.default,{text:U("mail_cancel_invitation"),position:"t",align:"right"},r.createElement("span",{onClick:this.cancelMessageRequest,className:"ChatSettingsMembersEdit__kick"})):r.createElement(r.Fragment,null,l&&r.createElement("span",{className:"ChatSettingsMembersEdit__role"},l),d&&d.length>0&&r.createElement(H.default,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,data:this.getActions(n)},r.createElement("span",{className:"ChatSettingsMembersEdit__actions"})),!o&&!c&&Object(h.canKickUser)(a,i)&&r.createElement(m.default,{text:U("mail_settings_kick"),position:"t",align:"right"},r.createElement("span",{onClick:this.kick,className:"ChatSettingsMembersEdit__kick"})),!o&&c&&r.createElement(m.default,{text:U("mail_leave_chat"),position:"t",align:"right"},r.createElement("span",{onClick:this.props.onLeave,className:"ChatSettingsMembersEdit__kick"})))}}var q={appendParentCls:"ChatSettingsWrapper"},K=c.default.getLang,V={all:"allShowMore",admins:"adminsShowMore",invitedByMRShowMore:"invitedByMRShowMore"};class W extends r.Component{constructor(e){super(e),this.onToggleSearch=()=>{this.state.showSearch?this.setState({showSearch:!1,searchQuery:""}):(this.setState({showSearch:!0}),requestAnimationFrame(()=>{this.searchInput.focus()}))},this.onSearchChange=e=>{e.target.value!==this.state.searchQuery&&this.setState({searchQuery:e.target.value})},this.onShowMore=()=>{var e=V[this.state.current];this.state[e]&&this.setState({[e]:!1})},this.onTabClick=(e,t)=>{e.preventDefault(),this.state.current!==t&&this.setState({current:t})},this.handleDocumentClick=e=>{!this.state.showSearch||this.state.searchQuery||e.target.closest(".ChatSettingsMembersWidget__search")||e.target.closest(".ChatSettingsMembersWidget__searchIcon")||this.setState({showSearch:!1})},this.onKeydown=e=>{this.state.showSearch&&27===e.keyCode&&(this.searchInput.blur(),this.setState({showSearch:!1,searchQuery:""}),e.preventDefault(),e.stopPropagation())},this.getInviter=e=>{if(this.invitersCache[e])return this.invitersCache[e];var t=this.props.store.get(),n=t.peer,a=t.tabs[n],r=a.inviters;if(!r[e])return"";var i=Object(s.getChatMembersByIds)(t,[r[e][0]])[0],o=getSmDate(r[e][2],t.timeshift,!0);if(Object(h.isUserOwnerInChat)(a,e))return this.invitersCache[e]=K("mail_settings_owner"),K("mail_settings_owner");if(!i)return this.invitersCache[e]=o,o;var l=langSex(r[e][1],K("mail_chat_member_invited_by_X","raw")).replace(/{inviter}/,replaceEntities(i.name))+" "+o;return this.invitersCache[e]=l,l},this.isAddMemberWidgetShown=()=>{var e=window.vk.id,t=this.props.store,n=t.get().peer,a=this.state,r=a.current,i=a.showSearch,s=a.searchQuery;return"all"===r&&!(i&&""!==s)&&Object(h.canInviteUser)(t,n,e)},this.searchInputRef=e=>{this.searchInput=e};var t=e.store.get(),n=this.getMembers(t),a=this.getAdmins(t),r=this.getInvitedByMessageRequests(t);this.state={showSearch:!1,searchQuery:"",current:"all",all:n,allShowMore:n.length>50,admins:a,adminsShowMore:a.length>50,invitedByMR:r,invitedByMRShowMore:r.length>50},this.membersMap=n.reduce((e,t)=>(e[t]=!0,e),{}),this.searchIndexPromise=this.getSearchIndex(n).then(e=>{this.searchIndex=e}),this.invitersCache={}}componentWillReceiveProps(e){var t=e.store.get(),n=this.getMembers(t),a=this.getAdmins(t),r=this.getInvitedByMessageRequests(t),i={removes:[],additions:[]},s=n.reduce((e,t)=>(e[t]=!0,e),{});n.forEach(e=>{this.membersMap[e]||i.additions.push(e)}),Object.keys(this.membersMap).forEach(e=>{s[e]||i.removes.push(e)}),(i.removes.length||i.additions.length)&&(this.updateSearchIndex(t,i),this.membersMap=s);var o={all:n,allShowMore:this.state.allShowMore&&n.length>50,admins:a,adminsShowMore:this.state.adminsShowMore&&a.length>50,invitedByMR:r,invitedByMRShowMore:this.state.invitedByMRShowMore&&r.length>50};o.current=o[this.state.current].length>0?this.state.current:"all",this.setState(o)}getMembers(e){var t=e.peer,n=e.tabs[t],a=-1!==(n.memberIds||[]).indexOf(n.ownerId),r=(n.adminIds||[]).reduce((e,t)=>(e[t]=!0,e),{});return(a?[n.ownerId]:[]).concat((n.adminIds||[]).filter(e=>e!==n.ownerId),(n.memberIds||[]).filter(e=>e!==n.ownerId&&!r[e]))}getAdmins(e){var t=e.peer,n=e.tabs[t];return(-1!==(n.memberIds||[]).indexOf(n.ownerId)?[n.ownerId]:[]).concat((n.adminIds||[]).filter(e=>e!==n.ownerId))}getInvitedByMessageRequests(e){var t=e.peer;return e.tabs[t].invitedByMessageRequest.sort((function(e,t){return e.date-t.date}))}getInvitedByMessageRequestList(e){return e.map(e=>({isContact:!0,id:e.id,photo:"/images/contact_icon.svg",name:e.name,date:e.date}))}getCurrentList(){var e=this.props.store,t=this.state,n=t.current,a=t.showSearch,r=t.searchQuery,i=t.invitedByMR;if(a&&r&&this.searchIndex){var o=this.getInvitedByMessageRequestList(i.filter(e=>!!e.name.toLowerCase().trim().split(/\s+/).find(e=>0===e.indexOf(r.toLowerCase()))));return this.searchIndex.search(r).concat(o)}var l=this.state[n],c="invitedByMR"===n?this.getInvitedByMessageRequestList(l):Object(s.getChatMembersByIds)(e.get(),l);return this.state[n+"ShowMore"]?c.slice(0,50):c}getSearchIndex(e){var t=window.vkIndexer,n=Object(s.getChatMembersByIds)(this.props.store.get(),e);return this.membersMap=n.reduce((e,t)=>(e[t.id]=!0,e),{}),new Promise((e,a)=>{var r=new t(n,e=>e.name,()=>{e(r)})})}updateSearchIndex(e,t){var n=Object(s.getChatMembersByIds)(e,t.removes),a=Object(s.getChatMembersByIds)(e,t.additions);(this.searchIndex?Promise.resolve(this.searchIndex):this.searchIndexPromise).then(e=>{n.forEach(t=>{e.remove(t)}),a.forEach(t=>{e.add(t)})})}componentDidMount(){this.searchInput.addEventListener("keydown",this.onKeydown)}componentWillUnmount(){this.searchInput.removeEventListener("keydown",this.onKeydown)}render(){var e=this.props,t=e.store,n=e.membersCount,a=e.membersAdded,i=e.onHideStatus,o=this.state,l=o.current,c=o.showSearch,d=o.searchQuery,u=o.admins,m=o.invitedByMR,p=t.get(),_=p.peer,h=p.tabs[_],f=this.getCurrentList(),b=this.isAddMemberWidgetShown()?["add"].concat(f):f,v=this.state[V[l]],y=h.membersLastSeen,C={"ChatSettingsMembersWidget--search":!!c},j=h.adminIds.reduce((e,t)=>(e[t]=!0,e),{});return r.createElement("div",{className:Object(g.classNames)("ChatSettingsMembersWidget",C)},r.createElement("header",{className:"ChatSettingsMembersWidget__header"},r.createElement("input",{placeholder:K("mail_members_search"),className:"ChatSettingsMembersWidget__search",onChange:this.onSearchChange,onInput:this.onSearchChange,onPaste:this.onSearchChange,value:this.state.searchQuery,ref:this.searchInputRef}),r.createElement("button",{className:"ChatSettingsMembersWidget__searchIcon",onClick:this.onToggleSearch}),r.createElement(F.default,{className:"ChatSettingsMembersWidget__tabs",onTabClick:this.onTabClick},r.createElement("span",{key:"all"},K("mail_settings_everyone")+" ",r.createElement("span",{className:"Tabs__desc"},Object(s.getAliveMembersCount)(h))),u.length>0&&r.createElement("span",{key:"admins"},K("mail_settings_admins")+" ",r.createElement("span",{className:"Tabs__desc"},u.length)),m.length>0&&r.createElement("span",{key:"invitedByMR"},K("mail_invited_members")+" ",r.createElement("span",{className:"Tabs__desc"},m.length)))),r.createElement("div",{className:"ChatSettingsMembersWidget__list"},r.createElement(k.default,{border:!1},b.length>0&&b.map(e=>{if("add"===e)return r.createElement(M.default,{selectable:!1,border:!1,key:"add",onClick:this.props.showMembersSettings,aside:r.createElement(O.default,{className:"ChatSettingsMembersWidget__blink",shown:a,callback:i},langNumeric(n||0,K("mail_settings_members_added","raw")))},r.createElement("span",{className:"ChatSettingsMembersWidget__add"},r.createElement("span",null,K("mail_settings_add_members"))));var o=this.getInviter(e.id),l=e.isContact,c=e.covid_status?e.name+`<span class="ChatSettingsMembersWidget__covidStatus">${e.covid_status}</span>`:e.name,d="";return y&&y[e.id]?d=Object(s.getLastSeenText)(p,e.id,y[e.id],q):l&&(d=Object(s.getMessageRequestDateText)(e.date,t.get().timeshift)),r.createElement(M.default,{selectable:!1,border:!1,aside:r.createElement(G,{adminMap:j,store:t,storeData:p,mid:e.id,onLeave:this.props.onLeave,isContact:l}),key:e.id},r.createElement(A.default,{photo:e.photo,title:c,description:r.createElement("span",{title:o,dangerouslySetInnerHTML:{__html:d}}),href:e.link}))}),!b.length&&c&&d&&r.createElement("div",{className:"ChatSettingsMembersWidget__empty"},K("mail_settings_not_found")),!(c&&d)&&v&&r.createElement("div",{className:"ChatSettingsMembersWidget__more",onClick:this.onShowMore},K("mail_settings_show_all_members")))))}}var $=n("FABD"),z=n("0Rlc"),Y=n("EasH"),Q=n("DM26"),X=c.default.getLang,J=()=>{};class Z extends r.Component{constructor(e){super(e),this.onChange=e=>{var t=this.props.store.get(),n=e.target.value;Object(o.searchLocalHints)(n,t).then(e=>(this.setSearchResults({},!1,n,e),n?(this.isSearching=!0,this.serverSearch(n,e.map(e=>e.peerId))):Promise.resolve([]))).then(this.appendSearchResults).catch(()=>{})},this.serverSearch=Object(Q.debouncedPromise)((e,t)=>{var n=this.props.store;return Object(o.searchHints)(e,t,"friends",n.get())},300),this.onRemoveToken=e=>new Promise(t=>{var n=this.state.selected.filter(t=>t!==e);this.selected=n.reduce((e,t)=>(e[t]=!0,e),{}),this.setState({selected:n},t)}),this.onSelect=e=>new Promise(t=>{var n=this.selected[e]?this.state.selected.filter(t=>t!==e):[].concat(this.state.selected,e).filter((e,t,n)=>n.indexOf(e)===t);this.selected=n.reduce((e,t)=>(e[t]=!0,e),{}),this.resetSearch({selected:n,value:""},t)}),this.onShowHistoryToggle=()=>{this.setState({isShowHistoryChecked:!this.state.isShowHistoryChecked})},this.onAddPeople=()=>{var e=this.props.store,t=e.get().peer,n=this.state.selected.map(e=>parseInt(e)),a=this.state.isShowHistoryChecked;this.setState({loading:!0}),e.set(o.addNewMember.bind(null,t,n,a)).then(()=>e.set(o.getChatDetails.bind(null,t)).then(()=>{this.selected={},this.resetSearch({selected:[],loading:!1},()=>{this.props.afterSave(n.length)})})).catch(e=>{this.selected={},this.resetSearch({selected:[],loading:!1}),Object(Y.showFastBox)(X("global_error"),e)})},this.setSearchResults=(e,t,n,a)=>{var r=this.props.store.get(),i=Object(x.getTab)(r,r.peer),s=[];a.forEach(e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===i.memberIds.indexOf(e.peerId)&&s.push(e.peerId)}),this.setState(Object.assign({},e,{found:s,value:n}),t||J)},this.appendSearchResults=e=>{var t=this.props.store.get(),n=Object(x.getTab)(t,t.peer),a=this.state.found;e.forEach(e=>{this.data[e.peerId]||(this.data[e.peerId]=e),-1===n.memberIds.indexOf(e.peerId)&&-1===a.indexOf(e.peerId)&&a.push(e.peerId)}),this.isSearching=!1,this.setState({found:a})},this.state={selected:[],value:"",loading:!1,found:[],isShowHistoryChecked:!0},this.data={},this.selected={}}resetSearch(e,t){return Object(o.searchLocalHints)("",this.props.store.get()).then(this.setSearchResults.bind(this,e,t,""))}componentDidMount(){this.resetSearch()}render(){var e=Object.keys(this.state.selected).length;return r.createElement("div",{className:"ChatSettingsMembers"},r.createElement($.default,{className:"ChatSettingsMembers__multiSelect",tokens:this.state.selected.map(e=>({text:unclean(this.data[e].name),id:e})),removeTokenPlaceholder:X("mail_create_chat_remove_user"),onRemoveToken:this.onRemoveToken,placeholder:X("mail_search_creation"),value:this.state.value,onChange:this.onChange,onSelect:this.onSelect,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:()=>{},notFoundText:X("mail_not_found"),autoFocus:!0,isSearching:this.isSearching},this.state.found.map(e=>r.createElement("div",{className:Object(g.classNames)("ChatSettingsMembers__entity",{"ChatSettingsMembers__entity--selected":this.selected[e]}),key:e,"data-id":e},r.createElement(A.default,{size:"34",title:this.data[e].name,photo:this.data[e].photo})))),r.createElement(S.default,{alignment:"right",className:"ChatSettingsMembers__submitArea"},r.createElement(z.default,{checked:this.state.isShowHistoryChecked,onChange:this.onShowHistoryToggle,className:"ChatSettingsMembers__showHistory"},X("mail_im_chat_add_members_show_history")),r.createElement(T.default,{disabled:0===e,onClick:this.onAddPeople,loading:this.state.loading,className:"ChatSettingsMembers__confirm"},X(e<2?"mail_append_chat":"mail_im_create_chat_with"))))}}var ee=Math.log2||(e=>Math.log(e)/Math.LN2),te=c.default.getLang;class ne extends r.Component{constructor(e){super(e),this.onChange=e=>{var t=e.name,n=e.selected.value,a=this.state.flags;this.setState({flags:n?a|1<<t:a&~(1<<t)})},this.onCancel=()=>{this.setState({flags:this.props.tab.data.flags}),this.props.back()},this.onSave=()=>{this.state.loading||(this.setState({loading:!0}),this.props.onSave(this.state.flags).then(()=>{this.setState({loading:!1},this.props.afterSave)}).catch(e=>{this.setState({loading:!1,flags:this.props.tab.data.flags})}))},this.isAllowed=e=>{var t=this.props.tab.allowedUpdateFlags;return null===t||t.includes(e)},this.state={flags:e.tab.data.flags,loading:!1}}render(){var e=this.props.tab,t=this.state.flags,n=[{value:!0,label:te("mail_settings_only_admins")},{value:!1,label:te("mail_settings_all_members")}],a=e.serverSettings;return r.createElement("div",{className:"ChatSettingsOptions"},r.createElement(k.default,null,this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)&&r.createElement(M.default,{selectable:!1,aside:r.createElement(L.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:ee(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE),options:n,value:!!(t&h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE)})},r.createElement(N,{type:"plus"}),te("mail_settings_can_invite")),this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)&&r.createElement(M.default,{selectable:!1,aside:r.createElement(L.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:ee(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE),options:n,value:!!(t&h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE)})},r.createElement(N,{type:"pencil"}),te("mail_settings_can_edit_info")),this.isAllowed(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)&&r.createElement(M.default,{selectable:!1,aside:r.createElement(L.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:ee(h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN),options:n,value:!!(t&h.MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN)})},r.createElement(N,{type:"pin"}),te("mail_settings_can_pin")),this.isAllowed(h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)&&r.createElement(M.default,{selectable:!1,aside:r.createElement(L.default,{className:"ChatSettingsOptions__longselect",onChange:this.onChange,name:ee(h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS),options:[{value:!1,label:te("mail_settings_only_owner")},{value:!0,label:te("mail_settings_owner_and_admins")}],value:!!(t&h.MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS)})},r.createElement(N,{type:"user"}),te("mail_settings_admins_can_add_admins")),a.map(e=>this.isAllowed(e.bit)&&r.createElement(M.default,{selectable:!1,key:e.name,aside:r.createElement(L.default,{className:"ChatSettingsOptions__select",onChange:this.onChange,name:ee(e.bit),options:e.options,value:!!(t&e.bit)})},r.createElement(N,{type:e.icon}),e.name))),r.createElement(S.default,{alignment:"right"},r.createElement(u.default,{appearance:"tertiary",onClick:this.onCancel},te("global_cancel")),r.createElement(T.default,{onClick:this.onSave,loading:this.state.loading},te("global_save"))))}}function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return re(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ie=c.default.getLang;class se extends r.Component{constructor(e){super(e),this.showInvitationLink=()=>{var e=this.props.store.get(),t=e.peer;return this.setState({invitationLoading:!0}),Object(o.getInviteLink)(t-2e9,e).then(e=>{var t=ae(e,1)[0];this.setState({section:2,invitationLoading:!1,invitationLink:t})})},this.onUpdateNotificationSettings=(e,t)=>{var n=this.props,a=n.store,r=n.parentMutations,i=a.get().peer;return a.set(o.toggleMutePeer.bind(null,i,e,t)).then(r().updateState.bind(null,i))},this.onUpdateMentionNotificationSettings=e=>{var t=this.props,n=t.store,a=t.parentMutations,r=n.get().peer;return n.set(o.toggleMuteMentionsPeer.bind(null,r,e)).then(a().updateState.bind(null,r))},this.onUpdateFlags=e=>{var t=this.props.store.get(),n=t.peer,a=t.hasOwnProperty("onUpdateFlags")?t.onUpdateFlags.bind(null,n,e):e=>Promise.resolve(e);return Object(o.updateFlags)(n,e,t).then(a)},this.afterFlagsUpdated=()=>{this.go(0,()=>this.setBlinkStatus({flagsUpdated:!0}))},this.afterMembersAdded=e=>{this.go(0,()=>this.setBlinkStatus({membersAdded:!0,membersCount:e}))},this.afterNotificationSettingsUpdated=()=>{this.setBlinkStatus({notificationSettingsUpdated:!0})},this.afterDisableUntilUpdated=()=>{this.setBlinkStatus({disableUntilUpdated:!0})},this.setBlinkStatus=e=>{this.timers.push(setTimeout(()=>this.setState(e),300))},this.onHideStatus=()=>{this.setState({membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1})},this.onLeave=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(s.isFvkcomgroup)(t,a),i=Object(Y.showFastBox)({title:ie(r?"mail_leave_channel":"mail_chat_leave_title"),dark:1},ie(r?"mail_vkcomgroup_leave_confirm":"mail_chat_leave_confirm"),ie(r?"mail_leave_channel":"mail_leave_chat"),(function(){t.set(o.unpinMessageOptimistic.bind(null,a)),t.set(o.leaveChat.bind(null,a)),i.hide(),n(),t.get().longpoll.push([Object(l.resetPeer)()])}),ie("global_cancel"),(function(){i.hide()}))},this.onChatClose=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(x.getTab)(t,a).data.flags,i=r&h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?r&~h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:r|h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE,o=Object(Y.showFastBox)({title:ie("global_warning"),dark:1},ie("mail_chat_close_confirm"),ie("mail_close_chat"),()=>{this.onUpdateFlags(i).then(()=>{o.hide(),n(),Object(s.isCommunityInterface)(t)||t.get().longpoll.push([Object(l.resetPeer)()])})},ie("global_cancel"),(function(){o.hide()}))},this.onChatRestore=()=>{var e=this.props,t=e.store,n=e.closePopup,a=t.get().peer,r=Object(x.getTab)(t,a).data.flags,i=r&h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE?r&~h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE:r|h.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE;this.onUpdateFlags(i).then(n)},this.onResetLink=()=>{var e=this.props.store.get(),t=e.peer;return Object(o.resetInviteLink)(t,e).then(e=>{var t=ae(e,1)[0];this.setState({invitationLink:t,invitationLinkReseted:!0})})},this.onShowAttachments=()=>{var e=this.props.store.get().peer;this.props.closePopup(),window.showWiki({w:"history"+Object(s.convertPeerToUrl)(e)+"_photo"},null,{})},this.state={section:0,invitationLink:null,invitationLinkReseted:!1,membersAdded:!1,flagsUpdated:!1,notificationSettingsUpdated:!1,disableUntilUpdated:!1},this.timers=[]}go(e,t){this.setState({section:e},()=>{this.props.updatePopup(),t&&t()})}getPopupTitle(){switch(this.state.section){case 1:return ie("mail_settings_add_members");case 2:case 3:return ie("mail_chat_invite_link");case 6:return ie("mail_settings_options");default:return ie("mail_settings_title")}}componentWillReceiveProps(e){var t=e.store.get(),n=t.peer,a=t.tabs[n];a.photoLarge||a.photoGrid||this.resync||(this.resync=!0,e.store.set(o.getChatDetails.bind(null,n)).then(()=>{this.resync=!0}))}componentDidMount(){this.props.updatePopup()}componentWillUnmount(){this.timers.forEach(clearTimeout)}render(){var e=this.props,t=e.store,n=e.closePopup,a=t.get(),i=a.peer,o=a.tabs[i],l=Object(s.isFvkcomgroup)(t,i),c=Object(x.isCasperChat)(t,i),g=Object(x.isCommunityChat)(t,i),m=!l&&!g||!t.get().gid,p=Object(h.canCloseChat)(t,i,a.id),_=Object(x.isClosedChat)(t,i),f=ie(l?"mail_im_n_vkcomgroup_members":"mail_im_n_chat_members",Object(s.getAliveMembersCount)(o));return r.createElement("section",{className:"ChatSettings"},r.createElement(d.default,{title:this.getPopupTitle(),back:0!==this.state.section?ie("global_back"):void 0,onCloseClick:n,onBackClick:()=>this.go(0)}),0===this.state.section&&r.createElement("div",{className:"ChatSettings__content"},r.createElement(v,{store:t,photo:o.photoLarge,grid:o.photoGrid,title:o.name,flags:o.data.flags,isDefaultPhotoOwner:o.isDefaultPhotoOwner,isCasper:c,meta:f,description:""}),r.createElement(B,{store:t,showMembersSettings:()=>this.go(1),showAttachments:this.onShowAttachments,showInvitationLink:this.showInvitationLink,showSettings:()=>this.go(6),notificationSettingsUpdated:this.state.notificationSettingsUpdated,disableUntilUpdated:this.state.disableUntilUpdated,flagsUpdated:this.state.flagsUpdated,onHideStatus:this.onHideStatus,onUpdateNotificationSettings:this.onUpdateNotificationSettings,onUpdateMentionNotificationSettings:this.onUpdateMentionNotificationSettings,afterNotificationSettingsUpdated:this.afterNotificationSettingsUpdated,afterDisableUntilUpdated:this.afterDisableUntilUpdated}),l?null:r.createElement("div",{className:"ChatSettings__pane"},r.createElement(W,{store:t,onLeave:this.onLeave,showMembersSettings:()=>this.go(1),membersAdded:this.state.membersAdded,onHideStatus:this.onHideStatus,membersCount:this.state.membersCount})),m&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(u.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__leave",onClick:this.onLeave},ie(l?"mail_leave_channel":"mail_settings_leave"))),p&&!_&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(u.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__close",onClick:this.onChatClose},ie("mail_settings_close"))),p&&_&&r.createElement("div",{className:"ChatSettings__pane"},r.createElement(u.default,{appearance:["link","mobile"],className:"ChatSettings__criticalAction ChatSettings__restore",onClick:this.onChatRestore},ie("mail_settings_restore")))),1===this.state.section&&r.createElement(Z,{store:t,afterSave:this.afterMembersAdded}),6===this.state.section&&r.createElement(ne,{tab:o,back:()=>this.go(0),onSave:this.onUpdateFlags,afterSave:this.afterFlagsUpdated}),2===this.state.section&&r.createElement(E,{store:t,onReset:()=>this.go(3),reseted:this.state.invitationLinkReseted,invitationLink:this.state.invitationLink}),3===this.state.section&&r.createElement(I,{onConfirm:this.onResetLink,onCancel:()=>this.go(2)}))}}var oe,le=n("aong");function ce(e,t){var n=ge();n&&i.render(r.createElement(se,{store:e,closePopup:de.bind(null,e),updatePopup:ue,parentMutations:t}),n)}function de(e){oe&&oe.hide();var t=e.get();t.hasOwnProperty("onClose")&&t.onClose()}function ue(){oe&&oe.updateBoxCoords()}function ge(){return document.querySelector("#ChatSettings")}function me(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),r=isVisible(t);return{unmount(){var t=ge();t&&i.unmountComponentAtNode(t),Object(a.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),r||show(t)},hideLoader(){hide(n),r||hide(t)}}}function pe(e,t,n){var r=Object(a.createMutations)(me).bindMutations,i=t.get(),s=Object(a.createModule)({handlers:(e,t)=>{}}),l=i.peer,c=r(s);var d=function(e,t){t.get().peer===l?function(e,t){var n=Object(x.getTab)(e,e.get().peer);n&&n.data&&Object(x.isChatActive)(n)?ce(e,t):de(e)}(t,n):e.unmount()}.bind(null,c),u={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:560,onShow(){ce(t,n),t.subscribe(d),requestAnimationFrame(()=>oe.updateBoxCoords())},onHideAttempt:()=>(t.unsubscribe(d),c.unmount(),!0)};return c.showLoader(),t.set(o.getChatDetails.bind(null,l)).then(e=>{c.hideLoader();var t=Object(le.unpackStore)(e).peer;t&&t===l?oe=new MessageBox(u).content('<div id="ChatSettings" class="ChatSettingsWrapper"></div>').show():c.unmount()}),c}},aFGQ:function(e,t,n){"use strict";n.r(t);var a,r=n("q1tI"),i=n("i8i4"),s=n("pemR"),o=(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(){return(l=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=n("dLHM").default,d=function(e){function t(t){var n,a=e.call(this,t)||this;return a.handleMouseDown=function(e){a.props.onFocus&&"function"==typeof a.props.onFocus&&a.props.onFocus(a.state.opened),"mousedown"===e.type&&0!==e.button||(e.stopPropagation(),e.preventDefault(),a.props.disabled||a.props.alwaysOpened||a.toggle(!a.state.opened))},a.getOptionByValue=function(e,t){return e.find((function(e){return"object"!=typeof e?e===t:e.value===t}))},a.setValue=function(e,t){"object"==typeof t&&a.props.searchable&&(t=t.props.title);var n={value:e,label:t.toString()},r={selected:n,opened:!a.props.alwaysOpened};a.fireChangeEvent(n),a.setState(r),a.toggle(!1)},a.fireChangeEvent=function(e){e!==a.state.selected&&a.props.onChange&&a.props.onChange({name:a.props.name,selected:e})},a.renderOption=function(e){var t=Object(s.classNames)("Select__option",{"Select__option--selected":e===a.state.selected}),n=void 0!==e.value?e.value:e.label||e,i=void 0!==e.label?e.label:e;return r.createElement("div",{key:n,className:t,onMouseDown:function(){return a.setValue(n,i)},onClick:function(){return a.setValue(n,i)},title:e.title},i)},a.buildMenu=function(){var e=a.state.filteredOptions.map((function(e){return"string"!=typeof e&&"group"===e.type?r.createElement("div",{className:"Select__group",key:e.name},e.name&&r.createElement("div",{className:"Select__title"},e.name),e.items&&e.items.map((function(e){return a.renderOption(e)}))):a.renderOption(e)}));return e.length?e:r.createElement("div",{className:"Select__noresults"},a.props.searchPlaceholder)},a.filterOptions=function(e,t){var n=e.toLowerCase();return t.filter((function(e){return"string"==typeof e?e.toLowerCase().includes(n):"string"==typeof e.label?e.label.toLowerCase().includes(n):"object"==typeof e.label?e.label.props.title.toLowerCase().indexOf(n)>=0:void 0}))},a.handleSearchType=function(e){var t=a.filterOptions(e.target.value,a.state.allOptions);a.setState({selected:{value:e.target.value,label:e.target.value},filteredOptions:t}),a.toggle(!0),a.props.onType&&a.props.onType(e.target.value)},a.handleEditableType=function(e){a.setState({opened:!0}),a.props.onEdit&&a.props.onEdit(e.target.value)},a.buildControl=function(e){var t,n="",i=a.props,s=i.searchable,o=i.editable;return e&&"string"==typeof e&&(n=e),e&&"object"==typeof e&&(e&&"string"==typeof e.label&&(n=e.label),e&&"object"==typeof e.label&&s&&(n=e.label.props.title||""),e&&"object"==typeof e.label&&!s&&(t=e.label)),s?r.createElement(c,l({placeholder:a.props.placeholder,className:"Select__input",value:n||"",onClick:a.handleMouseDown,onChange:a.handleSearchType.bind(a),onFocus:a.props.onInputFocus,onBlur:a.props.onInputBlur,disabled:a.props.disabled,isControlledOutside:!0},a.props.inputOtherProps)):o?r.createElement("div",{className:"Select__control",onClick:a.handleMouseDown},r.createElement(c,l({placeholder:a.props.placeholder,className:"Select__input Select__input--editable",id:a.props.id,value:n||"",onChange:a.handleEditableType,onFocus:a.props.onInputFocus,onBlur:a.props.onInputBlur,disabled:a.props.disabled,isControlledOutside:!0,autoComplete:"off"},a.props.inputOtherProps)),r.createElement("span",{className:"Select__arrow"})):r.createElement("div",{className:"Select__control",onClick:a.handleMouseDown},r.createElement("div",{className:"Select__placeholder"},n||t),r.createElement("span",{className:"Select__arrow"}))},a.handleDocumentClick=function(e){a.mounted&&a.state.opened&&a.el&&!a.el.contains(e.target)&&a.toggle(!1)},n=void 0!==t.value?t.editable&&void 0!==t.customValue?{label:t.customValue,value:t.customValue}:a.getOptionByValue(t.options,t.value):{label:a.getLabel(t),value:""},a.state={filteredOptions:t.options,allOptions:t.options,selected:n,opened:!!t.alwaysOpened},a.mounted=!0,a}return o(t,e),t.prototype.getLabel=function(e){return this.props.searchable?this.props.value||"":e.placeholder||"Select..."},t.prototype.componentWillReceiveProps=function(e){this.setState({filteredOptions:e.options,allOptions:e.options}),this.props.editable&&void 0!==e.customValue?this.setState({selected:{label:e.customValue,value:e.customValue}}):void 0!==e.value&&e.value!==this.state.selected?this.setState({selected:this.getOptionByValue(e.options,e.value)}):void 0===e.value&&this.setState({selected:{label:this.getLabel(e),value:""}})},t.prototype.componentDidMount=function(){this.el=i.findDOMNode(this),document.addEventListener("click",this.handleDocumentClick,!1),document.addEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.componentWillUnmount=function(){this.mounted=!1,document.removeEventListener("click",this.handleDocumentClick,!1),document.removeEventListener("touchend",this.handleDocumentClick,!1)},t.prototype.toggle=function(e){var t=this;this.setState({opened:e},(function(){t.state.opened?t.props.onShow():t.props.onHide()}))},t.prototype.render=function(){var e=this.props,t=e.className,n=e.appearance,a=e.style,i=e.searchable,o=e.editable,l=e.disabled,c=this.state,d=c.selected,u=c.opened,g=d&&"object"==typeof d&&!d.value||!1,m=i||o?"secondary":n,p=Object(s.classNames)("Select","Select--"+m,{"Select--opened":!!u,"Select--disabled":!!l,"Select--empty":g},t),_=this.buildControl(d);return r.createElement("div",{className:p,style:a},_,this.state.opened&&r.createElement("div",{className:"Select__menu"},this.buildMenu()))},t.defaultProps={appearance:"primary",searchPlaceholder:"No options found",searchable:!1,editable:!1,inputOtherProps:{},onShow:function(){},onHide:function(){}},t}(r.Component);t.default=d},ambf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_DEVIATION",(function(){return s})),n.d(t,"EXPIRING_TIME",(function(){return o})),n.d(t,"EXPIRING_SOON_TIME",(function(){return l})),n.d(t,"EXPIRING",(function(){return c})),n.d(t,"EXPIRING_SOON",(function(){return d})),n.d(t,"EXPIRED",(function(){return u})),n.d(t,"casperMessagesStore",(function(){return h}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("MhhX");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s=2e3,o=6e4,l=1e4,c="expiring",d="expiring_soon",u="expired",g=[],m={},p={},_=0,h={add(e){var t=r(b(e),3),n=t[0],a=t[1],i=t[2],s=Math.max(n+a-o-i,0),g=Math.max(n+a-l-i,0),_=Math.max(n+a-i,0),h=setTimeout(()=>{f({type:c,message:e})},s),v=setTimeout(()=>{f({type:d,message:e})},g),y=setTimeout(()=>{f({type:u,message:e}),p[e.messageId]=!0,delete m[e.messageId]},_);m[e.messageId]={message:e,expiringTime:s,expiredTime:_,timers:[h,v,y]}},remove(e){this.has(e)&&(m[e].timers.forEach(clearTimeout),delete m[e])},setTimeshift(e){_=1e3*(e||0)},getTimings:e=>m[e]?b(m[e].message):[0,0,0],getExpireTime(e){if(!m[e])return 0;var t=r(b(m[e].message),3),n=t[0],a=t[1],i=t[2];return Math.max(Math.floor((n+a-i)/1e3),0)},isProcessed:e=>!!p[e],subscribe(e){g.push(e)},unsubscribe(e){g=g.filter(t=>t!==e)},has:e=>!!m[e],destroy(){m={},g=[],p={}}};function f(e){g.forEach(t=>t(e))}function b(e){return[1e3*e.date+_,1e3*(Object(a.getMessageTTL)(e)||0),Date.now()]}},bIHZ:function(e,t,n){"use strict";n.r(t),n.d(t,"updateLocation",(function(){return r})),n.d(t,"updateLazyLocation",(function(){return i}));var a=n("t7n3");function r(e){var t=Object(a.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var n=window.nav.toStr(t);window.nav.setLoc(n)}function i(){var e={};return{scheduleNav:function(t){e=Object(a.extend)(e,t)},commitNav:function(){r(e),e={}},scheduleNavWithTimeOut:function(t,n){void 0===n&&(n=100),e=Object(a.extend)(e,t),setTimeout((function(){r(e),e={}}),n)}}}},bP5l:function(e,t,n){"use strict";n.r(t),n.d(t,"lpLogFc",(function(){return i})),n.d(t,"longpollTestingOnFcEvents",(function(){return g})),n.d(t,"longpollTestingOnImEvents",(function(){return m}));var a=n("ERyv"),r=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var a=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,r++)a[r]=i[s];return a};function i(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(window.vk.lpConfig.debug){var i="background: "+e+"; color: white",s=new Date,o=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,r(["%c "+s.getHours()+":"+o(s.getMinutes())+":"+o(s.getSeconds())+":"+s.getMilliseconds()+" "+t+" ",i],n))}}function s(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function o(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function l(e,t){window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:window.curNotifier.is_server}),setTimeout(c,1e4)}function c(){window.lpWeird&&window.lpWeird.length&&(Object(a.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function d(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function u(){var e;d()&&(o().forEach((function(e){!s().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev),Object(a.isWeirdLogging)()&&l("im not fc",e.ev))})),s().forEach((function(e){var t=o().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev),Object(a.isWeirdLogging)()&&l("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=s().filter((function(t){return t.time>e})),window.lpBufferIm=o().filter((function(t){return t.time>e}))}function g(e){var t;d()&&((t=s()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,0)),i.apply(void 0,r(["green","fc"],e))}function m(e){var t;d()&&((t=o()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(u,1100)),i.apply(void 0,r(["blue","im"],e))}window.longpollTestingOnImEvents=m},clTp:function(e,t,n){"use strict";function a(e){var t=e.getBoundingClientRect(),n=document.body,a=document.documentElement,r=window.pageYOffset||a.scrollTop||n.scrollTop,i=window.pageXOffset||a.scrollLeft||n.scrollLeft,s=a.clientTop||n.clientTop||0,o=a.clientLeft||n.clientLeft||0;return{top:Math.round(t.top+r-s),left:Math.round(t.left+i-o),width:e.offsetWidth,height:e.offsetHeight}}n.r(t),n.d(t,"default",(function(){return a}))},dLHM:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}class o extends a.Component{constructor(e){super(e),this.onChange=e=>{this.isControlledOutside||this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e)},this.getRef=e=>{this.element=e},void 0!==e.value||e.isControlledOutside?this.isControlledOutside=!0:this.state={value:e.initialValue||""}}render(){var e=this.props,t=e.alignment,n=e.value,o=(e.onChange,e.initialValue,e.className),l=(e.isControlledOutside,s(e,["alignment","value","onChange","initialValue","className","isControlledOutside"])),c={"Input--left":"left"===t,"Input--center":"center"===t,"Input--right":"right"===t};return a.createElement("input",i({},l,{className:Object(r.classNames)("Input",c,o),ref:this.getRef,value:this.isControlledOutside?n:this.state.value,onChange:this.onChange}))}}o.defaultProps={type:"text",initialValue:"",alignment:"left"}},enZq:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(e){var t={"List--border":!!e.border};return a.createElement("ul",{className:Object(r.classNames)("List",t,e.className),style:e.style},e.children)}i.defaultProps={border:!0}},f01n:function(e,t,n){"use strict";n.r(t),n.d(t,"DELETE",(function(){return s})),n.d(t,"SET_FLAGS",(function(){return o})),n.d(t,"REPLACE_FLAGS",(function(){return l})),n.d(t,"RESET_FLAGS",(function(){return c})),n.d(t,"ADD_MESSAGE",(function(){return d})),n.d(t,"READ_INBOUND",(function(){return u})),n.d(t,"READ_OUTBOUND",(function(){return g})),n.d(t,"GOT_ONLINE",(function(){return m})),n.d(t,"GOT_OFFLINE",(function(){return p})),n.d(t,"CHAT_CHANGED",(function(){return _})),n.d(t,"CONVERSATION_UPDATED",(function(){return h})),n.d(t,"TYPING",(function(){return f})),n.d(t,"RECORDING_AUDIO",(function(){return b})),n.d(t,"VIDEO_CALL",(function(){return v})),n.d(t,"UNREAD_COUNT",(function(){return y})),n.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return O})),n.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return C})),n.d(t,"EMPTY",(function(){return j})),n.d(t,"RESET_DIRECTORIES",(function(){return E})),n.d(t,"REPLACE_DIRECTORIES",(function(){return T})),n.d(t,"SET_DIRECTORIES",(function(){return S})),n.d(t,"RESYNC",(function(){return w})),n.d(t,"REFRESH_LP_KEY",(function(){return I})),n.d(t,"TRANSITION",(function(){return k})),n.d(t,"RESET_PEER",(function(){return M})),n.d(t,"MUTEX",(function(){return A})),n.d(t,"CHANGE_PEER",(function(){return L})),n.d(t,"CHANGE_TAB",(function(){return P})),n.d(t,"FAILED_MESSAGE",(function(){return N})),n.d(t,"RESEND",(function(){return x})),n.d(t,"DELETE_DIALOG",(function(){return D})),n.d(t,"EDIT_MESSAGE",(function(){return R})),n.d(t,"REPLACE_MESSAGE",(function(){return B})),n.d(t,"INVALIDATE_MESSAGE",(function(){return F})),n.d(t,"AUDIO_START",(function(){return H})),n.d(t,"WAITING_FOR_RECONNECT",(function(){return U})),n.d(t,"RECONNECTING",(function(){return G})),n.d(t,"RECONNECTED",(function(){return q})),n.d(t,"INCOMING_CALL",(function(){return K})),n.d(t,"FLAG_UNREAD",(function(){return V})),n.d(t,"FLAG_OUTBOUND",(function(){return W})),n.d(t,"FLAG_IMPORTANT",(function(){return $})),n.d(t,"FLAG_CHAT",(function(){return z})),n.d(t,"FLAG_FRIENDS",(function(){return Y})),n.d(t,"FLAG_SPAM",(function(){return Q})),n.d(t,"FLAG_DELETED",(function(){return X})),n.d(t,"FLAG_MEDIA",(function(){return J})),n.d(t,"FLAG_STEALTH",(function(){return Z})),n.d(t,"FLAG_HAS_REPLY",(function(){return ee})),n.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return te})),n.d(t,"FLAG_DELETE_BY_TTL",(function(){return ne})),n.d(t,"FOLDER_IMPORTANT",(function(){return ae})),n.d(t,"FOLDER_UNRESPOND",(function(){return re})),n.d(t,"FOLDER_HAS_BANNER",(function(){return ie})),n.d(t,"FOLDER_AD_TAG",(function(){return se})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return oe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return le})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return ce})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return de})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return ue})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return ge})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return me})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return pe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return _e})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return he})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return fe})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return be})),n.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return ve})),n.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return ye})),n.d(t,"deleteEvent",(function(){return Oe})),n.d(t,"replaceFlagsEvent",(function(){return Ce})),n.d(t,"setFlagsEvent",(function(){return je})),n.d(t,"resetFlagsEvent",(function(){return Ee})),n.d(t,"addMessageEvent",(function(){return Te})),n.d(t,"editMessageEvent",(function(){return Se})),n.d(t,"replaceMessageEvent",(function(){return we})),n.d(t,"invalidateMessageEvent",(function(){return Ie})),n.d(t,"editMessageLocallyEvent",(function(){return ke})),n.d(t,"readInboundEvent",(function(){return Me})),n.d(t,"readOutboundEvent",(function(){return Ae})),n.d(t,"gotOnlineEvent",(function(){return Le})),n.d(t,"gotOfflineEvent",(function(){return Pe})),n.d(t,"resetDirectoriesEvent",(function(){return Ne})),n.d(t,"replaceDirectoriesEvent",(function(){return xe})),n.d(t,"setDirectoriesEvent",(function(){return De})),n.d(t,"deleteDialogEvent",(function(){return Re})),n.d(t,"chatChangedEvent",(function(){return Be})),n.d(t,"chatUpdatedEvent",(function(){return Fe})),n.d(t,"typingEvent",(function(){return He})),n.d(t,"recordingAudioEvent",(function(){return Ue})),n.d(t,"videoCallEvent",(function(){return Ge})),n.d(t,"unreadCountEvent",(function(){return qe})),n.d(t,"notifySettingsChangedEvent",(function(){return Ke})),n.d(t,"incomingCallEvent",(function(){return Ve})),n.d(t,"refreshMessageEvent",(function(){return We})),n.d(t,"audioStartEvent",(function(){return $e})),n.d(t,"keyboardCallbackReceivedEvent",(function(){return ze})),n.d(t,"emptyEvent",(function(){return Ye})),n.d(t,"transitionEvent",(function(){return Qe})),n.d(t,"resyncEvent",(function(){return Xe})),n.d(t,"refreshLpKeyEvent",(function(){return Je})),n.d(t,"waitingForReconnectEvent",(function(){return Ze})),n.d(t,"reconnectingEvent",(function(){return et})),n.d(t,"reconnectedEvent",(function(){return tt})),n.d(t,"resetPeer",(function(){return nt})),n.d(t,"changePeer",(function(){return at})),n.d(t,"changeTab",(function(){return rt})),n.d(t,"failedMessage",(function(){return it})),n.d(t,"mutexEvent",(function(){return st})),n.d(t,"resendEvent",(function(){return ot}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf"),n("OEbY");var a=n("rudk");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s="event_delete",o="event_set_flags",l="event_replace_flags",c="event_reset_flags",d="event_add_message",u="event_read_inbound",g="event_read_outbound",m="event_got_online",p="event_got_offline",_="event_chat_changed",h="event_chat_updated",f="event_typing",b="event_recoding_audio",v="event_video_call",y="event_unread_count",O="event_notify_settings_changed",C="event_keyboard_callback_received",j="event_empty",E="event_reset_directories",T="event_replace_directories",S="event_set_directories",w="event_resync",I="event_refresh_lp_key",k="transition_event",M="reset_peer",A="mutex",L="change_peer",P="event_change_tab",N="event_failed_message",x="event_resend",D="event_delete_dialog",R="event_edit_message",B="event_replace_message",F="event_invalidate_event",H="event_audio_start",U="event_waiting_for_reconnect",G="event_reconnecting",q="event_reconnected",K="incoming_call",V=1,W=2,$=8,z=16,Y=32,Q=64,X=128,J=512,Z=65536,ee=1<<21,te=4096,ne=1<<22,ae=1,re=2,ie=8,se=32768,oe=1,le=2,ce=3,de=4,ue=5,ge=6,me=7,pe=8,_e=9,he=10,fe=11,be=12,ve=13,ye=3;function Oe(e){var t=r(e,2)[1];return{type:s,localId:t}}function Ce(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:l,messageId:n,mask:a,peerId:i}}function je(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:o,messageId:n,flags:a,peerId:i}}function Ee(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:c,messageId:n,flags:a,peerId:i}}function Te(e){var t=r(e,11),n=t[1],i=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],g=t[8],m=t[9],p=t[10],_=extend(c,u||void 0);return{type:d,messageId:intval(n),flags:intval(i),peerId:intval(s),date:intval(o),attaches:Object(a.convertKludgesToAttaches)(_,n),subject:c.title||"",text:l,kludges:_,randomId:intval(g),userId:Object(a.isChatPeer)(s)?intval(_.from):intval(s),update_time:p,chat_local_id:m}}function Se(e){var t=Te(e);return t.type=R,t}function we(e){var t=Te(e);return t.type=B,t}function Ie(e){var t=Te(e);return t.type=F,t}function ke(e){return extend({},e,{type:R})}function Me(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:u,peerId:n,upToId:a,unread:i}}function Ae(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:g,peerId:n,upToId:a,unread:i}}function Le(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:m,userId:-n,platform:a,lastSeenTs:i}}function Pe(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:p,userId:-n,reason:a,lastSeenTs:i}}function Ne(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:E,peerId:n,mask:a,local:void 0!==i&&i}}function xe(e){var t=r(e,3),n=t[1],a=t[2];return{type:T,peerId:n,mask:a}}function De(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:S,peerId:n,mask:a,local:void 0!==i&&i}}function Re(e){var t=r(e,3),n=t[1],a=t[2];return{type:D,peerId:n,localId:a}}function Be(e){var t=r(e,3),n=t[1],a=t[2];return{type:_,chatId:n,self:a}}function Fe(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:h,peerId:a,updateType:n,updateArg:i}}function He(e){var t=r(e,5),n=t[1],a=t[2],i=t[3],s=t[4];return{type:f,peerId:n,userIds:a,totalCount:i,ts:s}}function Ue(e){var t=r(e,5),n=t[1],a=t[2],i=t[3],s=t[4];return{type:b,peerId:n,userIds:a,totalCount:i,ts:s}}function Ge(e){var t=r(e,3),n=t[1],a=t[2];return{type:v,userId:n,callId:a}}function qe(e){var t=r(e,4),n=t[1],a=t[2],i=t[3];return{type:y,count:n,countNotMuted:a,showOnlyNotMuted:i}}function Ke(e){var t=r(e,2)[1],n=void 0===t?{}:t;return{type:O,peerId:n.peer_id,sound:n.sound,disabledUntil:n.disabled_until}}function Ve(e){var t=r(e,2)[1];return{type:K,payload:t}}function We(e){var t=r(e,2)[1],n=void 0===t?{}:t,a=Te([!1,n.id,n.flags,n.peer_id,n.date,n.message,extend(n.kludges,{title:n.title||""}),{},n.random_id,n.chat_local_id,n.update_time]);return a.type=R,a}function $e(e){var t=r(e,2)[1],n=void 0===t?{}:t;return{type:H,uuid:n.uuid,deviceName:n.device_name||""}}function ze(e){var t=r(e,2)[1],n=t.event_id,a=t.owner_id,i=t.peer_id,s=t.action;return{type:C,event_id:n,owner_id:a,peer_id:i,action:s}}function Ye(e){return{type:j,params:e}}function Qe(e){return{type:k,state:e}}function Xe(){return{type:w}}function Je(e){var t=r(e,3),n=t[1],a=t[2];return{type:I,key:n,url:a}}function Ze(e){var t=r(e,2)[1];return{type:U,timeout:t}}function et(){return{type:G}}function tt(){return{type:q}}function nt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:M,cancelSearch:e,removeActivePeer:t}}function at(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:L,peerId:e,msgid:t,forward:n,cancelSearch:a,entryPoint:r}}function rt(e){return{type:P,tab:e}}function it(e,t,n){return{type:N,message:t,peer:e,error:n}}function st(e){var t=r(e,6),n=(t[0],t[1]),a=t[2],i=t[3],s=t[4],o=t[5];return{type:A,free:!!intval(n)||intval(s)===vk.id,resource:a,peerId:intval(i),who:intval(s),name:o}}function ot(e,t){return{type:x,message:t,peerId:e}}},f4YT:function(e,t){e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%"%attrs%>\n  <span>%label%</span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<span class="ui_rmenu_count im-right-menu--count _im_r_ct">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"></button><span class="im-right-menu--text _im_r_tx">%name%</span>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> </span> %ad_tag_html% </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> </div>"},im_simple_name_ad_tag:function(){return' <div class="im-page--title-main-ad-tag _im_dialog_ad_tag"> <a href="ads?act=office&union_id=%ad_id%&utm_medium=community_messages_ad_tag&utm_source=dialog" target="_blank" class="im-page--title-main-ad-tag_link"> <span>AD %ad_id%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="im-page--title-main-ad-tag_alert"> <span>'+getLang("mail_ad_tag_no_access_text")+"</span> </button> </div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> %msg%</li>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="%list_id%"> %msg%</li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice"> %msg% </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody%</span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd %modifier%"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%text%</span> <span class="im-fwd--date">%date%</span></span> <span class="im-fwd--close _im_fwd_close"></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> <a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a> </div> </div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date _im_dialog_date">%date%</div> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <button type="button" class="nim-dialog--markre _im_dialog_markre"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--mute"></span> <button type="button" class="nim-dialog--star _im_dialog_star"></button> %ad_tag_html% <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_ad_tag:function(){return' <div class="nim-dialog--ad-tag _im_dialog_ad_tag"> <a href="ads?act=office&union_id=%ad_id%&utm_medium=community_messages_ad_tag&utm_source=dialogs_list" target="_blank" class="nim-dialog--ad-tag_link"> <span>AD %ad_id%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="nim-dialog--ad-tag_alert"> <span>'+getLang("mail_ad_tag_no_access_text")+"</span> </button> </div>"},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"></div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"></div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"></span> </div> <div class="im-mess--check fl_l"></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner">\n  %icon%\n  <div class="im-top-banner--text"><div>%text%</div></div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"></button>',im_calls_link:'<button class="im_srv_lnk_light">%text%</button>',sImPeerMuteUnmute:'<a href="#" class="_im_peer_mute_unmute ui_actions_menu_item im-action nohover %cls%">%text%</a>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<a href="#" class="_im_peer_return_to_chat">%text%</a>',sImCallSnippet:' <button class="im-call-snippet _im-call-snippet %modifier%" data-type="%type%"> <div class="im-call-snippet--title">%title%</div> <div class="im-call-snippet--desc">%description%</div> </button>',sImCallSnippetWithStub:' <a href="/calls" onclick="return showWiki({ w: \'calls\'});" class="im-call-snippet %modifier%"> <div class="im-call-snippet--title">%title%</div> <div class="im-call-snippet--desc">%description%</div> </a>',sImCallSnippetDMLink:function(){return' <object type="internal/link" class="im-call-snippet--guard"> <a href="/messenger" target="_blank" onclick="return event.stopPropagation();" class="im-call-snippet--link"> '+getLang("mail_call_snippet_call_back")+" </a> </object>"},sImCallSnippetCanceled:'<span class="im-call-snippet--canceled">%text%</span>',sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:' <span class="MessageKeyboard__cell"> <%tagName% class="MessageKeyboard__button MessageKeyboard__button--%modifier% Button Button--size-s Button--%appearance% _im_mess_btn" %attributes% > <span class="MessageKeyboard__label">%label%</span> </%tagName%> </span>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message %id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item _im_action im-action im-action_%icon%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">'+getLang("mail_ad_tag_text_prefix")+" %ad_id%</span> </a> <button onclick=\"return showFastBox('"+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">'+getLang("mail_ad_tag_no_access_text")+"</span> </button> </div>"},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>'}},"fD+e":function(e,t,n){"use strict";n.r(t),n.d(t,"TemplatesDropDown",(function(){return d}));var a=n("q1tI"),r=(n("17x9"),n("6aSF")),i=n("6krn"),s=n("MCfn"),o=n("BN/X"),l=n("pemR"),c=i.default.getLang;class d extends a.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,n=e.showSettingsPopup,i=e.showCreatingTemplatePopup,s=e.isNeededRendering,d=this.state.isShowDropDown;if(!s())return null;var u=t();return a.createElement("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1)},a.createElement("div",{className:Object(l.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":d}),"aria-hidden":d},a.createElement("div",{className:"TemplatesDropDown__container"},a.createElement(r.default,{className:"TemplatesDropDown__scroll-wrapper"},a.createElement("div",null," ",a.createElement("header",{className:"TemplatesDropDown__header"},a.createElement("h2",{className:"TemplatesDropDown__title"},c("mail_community_templates")),a.createElement("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:n},c("mail_settings_configure"))),u.length?a.createElement("ul",{className:"TemplatesDropDown__list"},u.map(e=>a.createElement("li",{key:e.id,className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id)},a.createElement("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})))):a.createElement("div",{className:"TemplatesDropDown__not-found-container"},a.createElement("span",null,c("mail_community_templates_not_found")),a.createElement(o.default,{onClick:i},c("mail_add_community_template"))))))),a.createElement("button",{className:"TemplatesDropDown__icon"}))}}t.default=Object(s.connect)(d)},g1O2:function(e,t,n){"use strict";n.r(t),n.d(t,"setHTML",(function(){return s}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI");n("17x9");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s(e,t){var n=!!window.getSelection&&window.getSelection(),a=!1;if(n&&n.rangeCount){var r=n.getRangeAt(0);a=r.commonAncestorContainer?r.commonAncestorContainer:r.parentElement?r.parentElement():r.item(0)}for(var i=a;i&&i!=e;)i=i.parentNode;i||Emoji.editableFocus(e,!1,!0),Emoji.insertHTML(t)}class o extends a.Component{constructor(){super(...arguments),this.onChange=()=>{this.props.onChange&&this.props.onChange(Emoji.val(this.container))},this.containerRef=a.createRef(),this.state={value:this.props.initialValue}}componentDidMount(){if(this.container=this.containerRef.current,this.container&&!this.isMount){this.isMount=!0;var e=this.props.initialValue;Emoji.val(this.container,Emoji.emojiToHTML(e)),Emoji.init(this.container,{noStickers:!0,onSend:()=>{},ctrlSend:()=>!0,onChange:this.onChange,noLineBreaks:!this.props.isMultiLine})}}componentWillUnmount(){this.container&&this.isMount&&(this.isMount=!1)}render(){var e=this.props,t=e.tabIndex,n=e.isMultiLine,s=(e.initialValue,i(e,["tabIndex","isMultiLine","initialValue"]));return a.createElement("div",r({role:"textbox",ref:this.containerRef,tabIndex:t,contentEditable:!0,"aria-multiline":n},s))}}o.defaultProps={isMultiLine:!1,tabIndex:0,initialValue:""},t.default=o},gF8j:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s})),n.d(t,"getVisibilityState",(function(){return c})),n.d(t,"getVisiblityEvent",(function(){return d}));var a=n("uQjJ"),r=n("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function s(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function o(e,t,n){Object(r.isMvk)()?window.addEvent(e,t,n,{passive:!0}):window.addEvent(e,t,n)}function l(e,t,n){Object(r.isMvk)()?window.removeEvent(e,t,n,{passive:!0}):window.removeEvent(e,t,n)}function c(){return document.visibilityState||document.webkitVisibilityState}function d(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(s.prototype,a.default.prototype),extend(s.prototype,{stop:function(){this.started=!1,l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(r.isMvk)()&&this._isTopLevel()&&d()&&l(document,d(),this.onVisiblityChange),Object(r.isMvk)()&&i||(l(this.opts.focusElement,"focus",this.cbActiveB),l(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(r.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(r.isMvk)()&&this._isTopLevel()&&d()&&o(document,d(),this.onVisiblityChange),Object(r.isMvk)()&&i||(o(this.opts.focusElement,"focus",this.cbActiveB),o(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(o(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),l(this.opts.element,this.opts.triggerEvents,this.cbActiveB),o(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===c()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=c();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},gqqU:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=(n("17x9"),n("pemR"));function i(e){return a.createElement("header",{className:Object(r.classNames)("PopupHeader",e.className),style:e.style},e.back&&a.createElement("div",{className:"PopupHeader__back",onClick:e.onBackClick},a.createElement("button",{className:"PopupHeader__backBtn",onClick:e.onBackClick},e.back)),a.createElement("h2",{className:"PopupHeader__title"},e.title),a.createElement("div",{className:"PopupHeader__close"},a.createElement("button",{className:"PopupHeader__closeBtn",onClick:e.onCloseClick})))}i.defaultProps={back:null,title:"",onCloseClick:()=>{}}},"h++7":function(e,t,n){"use strict";n.r(t),n.d(t,"OUR_DOMAINS",(function(){return a})),n.d(t,"ENTITIES",(function(){return r})),n.d(t,"VK_DOMAIN",(function(){return i})),n.d(t,"MENTION",(function(){return s})),n.d(t,"MENTION_RAW",(function(){return o})),n.d(t,"ARROW_UP",(function(){return l})),n.d(t,"ARROW_DOWN",(function(){return c})),n.d(t,"PAGE_UP",(function(){return d})),n.d(t,"PAGE_DOWN",(function(){return u})),n.d(t,"END_KEY",(function(){return g})),n.d(t,"HOME",(function(){return m})),n.d(t,"ENTER",(function(){return p})),n.d(t,"ESC",(function(){return _})),n.d(t,"UNPRINTABLE_KEYS",(function(){return h})),n.d(t,"UP_DOWN_CONTROLS",(function(){return f})),n.d(t,"PRINTABLE",(function(){return b})),n.d(t,"FOLDER_UNREAD",(function(){return v})),n.d(t,"FOLDER_ALL",(function(){return y})),n.d(t,"FOLDER_UNRESPOND",(function(){return O})),n.d(t,"FOLDER_IMPORTANT",(function(){return C})),n.d(t,"FOLDER_MESSAGE_REQUEST",(function(){return j})),n.d(t,"FOLDER_MESSAGE_REQUEST_REJECTED",(function(){return E})),n.d(t,"FOLDER_AD_TAG",(function(){return T})),n.d(t,"FOLDERS",(function(){return S})),n.d(t,"FOLDER_MASKS",(function(){return w})),n.d(t,"TOP_DOMAINS",(function(){return I})),n.d(t,"MAX_DOMAIN_LENGTH",(function(){return k})),n.d(t,"EMAIL",(function(){return M})),n.d(t,"MESSAGE_REGEXP",(function(){return A})),n.d(t,"RE_HASHTAG_EXTRACTION_PATTERN",(function(){return P})),n.d(t,"RE_MASSMENTION",(function(){return N})),n.d(t,"LINE_FEED",(function(){return x}));n("Oyvg");var a=/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/,r=/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,i=/^(?:https?:\/\/)?(?:vk\.com|vkontakte\.ru)?\/([a-zA-Z0-9\._]+)\??$/,s=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,o=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,l=38,c=40,d=33,u=34,g=35,m=36,p=13,_=27,h=[l,c,d,u,p,_,g,m],f=[d,u,c,l,m,g],b="printable",v="unread",y="all",O="unrespond",C="important",j="mr",E="mr_rejected",T="ad_tag",S=[y,v,O,C,j,T],w={[O]:2,[C]:1,[j]:256,[E]:512,[T]:32768},I=[].concat("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(","),"бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(","),"qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map(e=>"xn--"+e)),k=I.reduce((e,t)=>Math.max(e,t.length),0),M=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})))","ig"),A=new RegExp("(https?:\\/\\/)?(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})(?:\\:(\\d{2,5}))?)(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?","ig"),L="(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))",P=`(^|[s.,:'";>)(]?)(${`(#${L}{0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))${L}{0,100})`})(@((?:[a-z0-9_]*[a-z0-9])?(?:(?:.[a-z](?:[a-z0-9_]+[a-z0-9])?)*.[a-z][a-z0-9_]{2,40}[a-z0-9])?))?(?=$|[s.,:'"&;?<)(]?)`,N=/@all|@everyone|@все|@online|@here|@здесь|@тут/gi,x=10},hIV1:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var a=n("q1tI"),r=n("pemR");function i(e){var t={"SubmitArea--left":!e.alignment||"left"===e.alignment,"SubmitArea--center":"center"===e.alignment,"SubmitArea--right":"right"===e.alignment};return a.createElement("div",{className:Object(r.classNames)("SubmitArea",t,e.className),style:e.style},e.children)}},hOuX:function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_SAFE_INTEGER",(function(){return a})),n.d(t,"MAX_INTERGER",(function(){return r})),n.d(t,"random",(function(){return i}));n("tuSo");var a=9007199254740991,r=2147483647;function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((e,t)=>e+t))}}catch(e){}return intval(rand(0,r).toFixed(0))}},lJdi:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return s})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return o})),n.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return l})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return c})),n.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return d})),n.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return u})),n.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return g})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return m})),n.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return p})),n.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return _})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return h})),n.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return f})),n.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return b})),n.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return v})),n.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return y})),n.d(t,"canSeeInviteLink",(function(){return C})),n.d(t,"canChangeInviteLink",(function(){return j})),n.d(t,"canAddAdmin",(function(){return E})),n.d(t,"canInviteUser",(function(){return T})),n.d(t,"canKickUser",(function(){return S})),n.d(t,"canPinOrUnpin",(function(){return w})),n.d(t,"canChangeTitle",(function(){return I})),n.d(t,"canChangeAvatar",(function(){return k})),n.d(t,"canSeeAllMessages",(function(){return M})),n.d(t,"canSeeSettingsItem",(function(){return A})),n.d(t,"canCloseChat",(function(){return L})),n.d(t,"checkChatRights",(function(){return P})),n.d(t,"doesChatTabHaveFlag",(function(){return N})),n.d(t,"isUserAdminInChat",(function(){return x})),n.d(t,"isUserOwnerInChat",(function(){return D})),n.d(t,"isUserInvitedByMe",(function(){return R}));n("OEbY");var a=n("rHUl"),r=n("aong"),i=n("P13b"),s=1,o=4,l=8,c=16,d=32,u=16384,g=32768,m=1<<17,p=1<<18,_="see_invite_link",h="change_invite_link",f="invite_user",b="pin_unpin",v="change_title",y="add_admin",O={[_]:d,[h]:d,[y]:c,[f]:s,[b]:o,[v]:l};function C(e,t,n){return P(e,_,t,n)}function j(e,t,n){return P(e,h,t,n)}function E(e,t,n,i){var s=Object(r.unpackStore)(e);return!D(Object(a.getTab)(s,n||s.peer),t)&&P(e,y,n,i)}function T(e,t,n){return P(e,f,t,n)}function S(e,t,n,s){var o=Object(r.unpackStore)(e);if(function(e,t){var n=Object(r.unpackStore)(e);return void 0!==n.service&&(n.service&t)>0}(e,1))return!0;var l=Object(a.getTab)(o,n||o.peer);return!(l.data.kicked&&!l.data.closed)&&(!Object(i.isFvkcomgroup)(e,n)&&(!D(l,t)&&(!!D(l,s=void 0===s?window.vk.id:s)||(x(l,s)||R(l,t))&&!x(l,t))))}function w(e,t,n){return P(e,b,t,n)}function I(e,t,n){return P(e,v,t,n)}function k(e,t,n){return I(e,t,n)&&!Object(i.isFvkcomgroup)(e,t)}function M(e,t,n){return!Object(a.isCommunityPeer)(n)||!!Object(a.getTab)(e,t).caccess[n]}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,s=Object(r.unpackStore)(e),o=Object(i.isFvkcomgroup)(s,t),l=s.tabs[s.peer];if(Object(a.isCommunityChat)(s,t)){var c=l&&l.data&&Object(a.isChatActive)(l),d=D(l,-s.gid)&&c,g=d||x(l,n)&&c,m=l.allowedUpdateFlags?l.allowedUpdateFlags.filter(e=>e!==u):[];return!(!g||!m.length)}return D(l,n)&&!o}function L(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,i=Object(r.unpackStore)(e),s=Object(a.isCommunityChat)(i,t),o=Object(a.isCommunityChatDeleted)(i,t),l=i.tabs[i.peer],c=l&&l.data&&Object(a.isChatActive)(l),d=D(l,-i.gid)&&c,g=d||x(l,n)&&c;return s&&!o&&g&&l.allowedUpdateFlags&&l.allowedUpdateFlags.includes(u)}function P(e,t,n,s){var o=Object(r.unpackStore)(e);s=void 0===s?window.vk.id:s,n=void 0===n?o.peer:n;var l=Object(a.getTab)(o,n),c=l&&l.data&&Object(a.isChatActive)(l),d=O[t];if(Object(i.isFvkcomgroup)(e,n))switch(t){case y:case f:return!1;case _:return c;default:return o.gid>0}else if(Object(a.isCommunityChat)(e,n)){if(Object(a.isClosedChat)(e,n))return!1;var u=D(l,-o.gid)&&c,g=u||x(l,s)&&c;switch(t){case _:case h:case y:return N(l,d)?g:u;case f:return!u&&(N(l,d)?g:c);case b:case v:return g;default:return!1}}switch(t){case _:case h:case y:return N(l,d)?x(l,s)&&c:D(l,s);case f:case b:case v:return N(l,d)?x(l,s)&&c:c}return!1}function N(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function x(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function D(e,t){return e.ownerId===t}function R(e,t){return-1!==e.invitedByMe.indexOf(t)}},m5nf:function(e,t,n){"use strict";n.r(t),n.d(t,"MAIN",(function(){return _})),n.d(t,"EDIT",(function(){return h}));n("pIFo"),n("91GP"),n("VRzm"),n("Btvt");var a=n("q1tI"),r=(n("17x9"),n("6krn")),i=n("gqqU"),s=n("MCfn"),o=n("Ht+d"),l=n("6aSF"),c=n("BN/X"),d=n("g1O2"),u=n("LYnS"),g=n("vT4u"),m=n("nAFc"),p=n("EasH"),_="main",h="edit";class f extends a.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,n=e.name,a=e.text;return new Promise(e=>this.setState({editableMessage:{id:t,name:n,text:a}},e))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:Object(m.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then(()=>this.state.section!==_?this.go(_):Promise.resolve()).then(()=>this.props.store.set(g.deleteTemplate.bind(null,e))).catch(()=>{Object(p.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_community_templates_delete_error"))}),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,n=t.name,a=t.text;n.length>200||n.length<2||n.length>2e3||a.length<5?Object(p.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch(()=>{Object(p.showFastBox)(Object(r.getLang)("mail_error"),Object(r.getLang)("mail_community_templates_save_error"))}).then(()=>this.go(_))},this.addHint=(e,t)=>{t.preventDefault();var n=this.state.editableMessage,a=n.id,r=void 0===a?null:a,i=n.name,s=n.text;return Object(d.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:r,name:i,text:`${s}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.id,a=void 0===n?null:n,r=t.name,i=void 0===r?"":r,s=t.text,o=void 0===s?"":s;return new Promise(t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:a,name:i,text:o}},()=>{this.props.popup.updateBoxCoords(),t()}):t()})}render(){var e=this.props,t=e.getTemplates,n=e.closePopup,s=this.state,g=s.section,m=s.editableMessage,p=t();return a.createElement("section",{className:"TemplatesSettings"},a.createElement(i.default,{title:a.createElement("span",{className:"TemplatesSettings__title"},g===_&&Object(r.getLang)("mail_community_templates"),g===h&&Object(r.getLang)("mail_add_community_template")),onCloseClick:n}),a.createElement("main",{className:"TemplatesSettings__content"},g===_&&(p.length?a.createElement(l.default,{className:"TemplatesSettings__scroll-wrapper"},a.createElement("div",{className:"TemplatesSettings__list"},p.map(e=>a.createElement("section",{key:e.id,className:"TemplatesSettings__item"},a.createElement("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),a.createElement("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),a.createElement("div",{className:"TemplatesSettings__buttons-row"},a.createElement(c.default,{onClick:()=>this.go(h,e),className:"TemplatesSettings__item-button"},Object(r.getLang)("mail_settings_edit")),a.createElement("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true"}," · "),a.createElement(c.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button"},Object(r.getLang)("mail_delete"))))))):a.createElement("div",{className:"TemplatesSettings__not-found-container"},a.createElement("span",null,Object(r.getLang)("mail_community_templates_not_found")),a.createElement(c.default,{onClick:()=>this.go(h)},Object(r.getLang)("mail_add_community_template")))),g===h&&a.createElement("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate},a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"name"},Object(r.getLang)("mail_name"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.default,{id:"name",type:"text",initialValue:m.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.getLang)("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label",htmlFor:"text"},Object(r.getLang)("mail_text"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},a.createElement(d.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:m.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")}),a.createElement("span",{className:"TemplatesSettings__notice"},Object(r.getLang)("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")))),a.createElement("div",{className:"TemplatesSettings__form-row"},a.createElement("label",{className:"TemplatesSettings__label"},Object(r.getLang)("mail_hints"),":"),a.createElement("div",{className:"TemplatesSettings__input-container"},Object(u.default)().map(e=>a.createElement(o.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",key:e.id},e.label)))))),a.createElement("footer",{className:"TemplatesSettings__footer"},g===_&&a.createElement(a.Fragment,null,a.createElement(c.default,{onClick:()=>this.go(h)},Object(r.getLang)("mail_add_community_template")),a.createElement(o.default,{onClick:n},Object(r.getLang)("mail_close"))),g===h&&a.createElement(a.Fragment,null,a.createElement("div",null,m.id&&a.createElement(c.default,{onClick:this.deleteTemplate.bind(null,m.id)},Object(r.getLang)("mail_delete_community_template"))),a.createElement("div",null,a.createElement(o.default,{appearance:"tertiary",onClick:()=>this.go(_)},Object(r.getLang)("mail_cancel")),a.createElement(o.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit"},Object(r.getLang)("mail_save"))))))}}f.defaultProps={section:_},t.default=Object(s.connect)(f)},nJdr:function(e,t,n){"use strict";n.r(t),n.d(t,"createLongpoll",(function(){return h}));var a=n("DM26"),r=n("BxOC"),i=n("f01n");function s(e,t){e.waitAbortFns.push(t)}function o(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=Object(r.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),n=t.request,i=t.cancel;return e.stopFn=i,n.then((function(t){var n=t[0],a=t[1];return e.onData(e,a),e.waitTimeout=2,JSON.parse(n)})).catch((function(t){var n=t[1];return e.onData(e,n),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var n=t.failed?Object(a.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},r=n.abort,i=n.pause;switch(t.failed){case 1:return s(e,r),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(i).then((function(){return o(e)}));case 2:return s(e,r),e.onKeyExpired(e,t).then((function(t){var n=t[0],a=t[1],r=t[2],i=t[3];return e.onResult({ts:+i,updates:[[-2,n,a+"/"+r],[-1]]})})).then(i).then((function(){return o(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function l(e){e.isStoppedFn()||o(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&c(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),c(e,-3);var n=Object(a.abortablePause)(e.waitTimeout,null),r=n.abort,i=n.pause;return s(e,r),i().then((function(){return c(e,-4)}))}(e,t)})).then((function(){return l(e)}))}function c(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function d(e,t){var n=!!e.stopped,a={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||9,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return n},onResult:function(e){e.ts&&s(a.ts,e.ts,e.updates.map((function(e){switch(e[0]){case 0:return i.deleteEvent(e);case 1:return i.replaceFlagsEvent(e);case 2:return i.setFlagsEvent(e);case 3:return i.resetFlagsEvent(e);case 4:return i.addMessageEvent(e);case 5:return i.editMessageEvent(e);case 6:return i.readInboundEvent(e);case 7:return i.readOutboundEvent(e);case 8:return i.gotOnlineEvent(e);case 9:return i.gotOfflineEvent(e);case 10:return i.resetDirectoriesEvent(e);case 11:return i.replaceDirectoriesEvent(e);case 12:return i.setDirectoriesEvent(e);case 13:return i.deleteDialogEvent(e);case 18:return i.replaceMessageEvent(e);case 51:return i.chatChangedEvent(e);case 52:return i.chatUpdatedEvent(e);case 63:return i.typingEvent(e);case 64:return i.recordingAudioEvent(e);case 70:return i.videoCallEvent(e);case 80:return i.unreadCountEvent(e);case 114:return i.notifySettingsChangedEvent(e);case 115:return i.incomingCallEvent(e);case 116:return i.refreshMessageEvent(e);case 117:return i.audioStartEvent(e);case 119:return i.keyboardCallbackReceivedEvent(e);case-1:return i.resyncEvent();case-2:return i.refreshLpKeyEvent(e);case-3:return i.waitingForReconnectEvent(e);case-4:return i.reconnectingEvent();case-5:return i.reconnectedEvent();default:return i.emptyEvent(e)}})))},onData:u(t.onData),onRequestError:u(t.onRequestError),onHistoryLost:g(t.onHistoryLost),onKeyExpired:g(t.onKeyExpired),onLpBroken:g(t.onHistoryLost)},r=t.onEvents;function s(e,t,n){a.ts=t;for(var s=0;s<n.length;++s)n[s].type===i.REFRESH_LP_KEY&&(a.key=n[s].key||"",a.url=n[s].url||"");r(e,t,n)}var o={options:a,isStopped:function(){return n},stopConnection:function(){n=!0,a.stopFn&&a.stopFn(),a.stopFn=void 0,document.removeEventListener("resume",d),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",d),c(a,-4),n=!1,l(a)},abortWaiting:function(){a.waitAbortFns.forEach((function(e){return e()})),a.waitAbortFns=[],a.waitTimeout=2},onLp:s};function d(){o.abortWaiting()}return document.addEventListener("resume",d),l(a),o}function u(e){return e||function(){}}function g(e){return e?function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}var m=n("bP5l"),p=n("vT4u"),_=n("XzvV");function h(e,t){return d(e,{onEvents:t,onData:v,onRequestError:y,onHistoryLost:O,onKeyExpired:C,onLpBroken:j})}var f={},b=Date.now();function v(e,t){if(t&&t.status&&e.lpstat){var n=t.status.toString();t.status>=500&&t.status<600&&Object(_.statlogsValueEvent)("fc_longpoll",1,n,t.getResponseHeader("x-frontend")||""),f[n]=n in f?f[n]+1:1,Date.now()-b>=3e4&&(Object.keys(f).forEach((function(e){Object(_.statlogsValueEvent)("fc_longpoll",f[e],e,t.getResponseHeader("x-frontend")||"")})),f={},b=Date.now())}}function y(e){Object(m.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function O(e,t){Object(m.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function C(e){return Object(m.lpLogFc)("red","LP failed: key is incorrect; refresh key"),Object(r.post)(p.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0})}function j(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},ofcU:function(e,t,n){"use strict";n.r(t),n.d(t,"createMutations",(function(){return l})),n.d(t,"createModule",(function(){return u})),n.d(t,"destroyModule",(function(){return g}));n("HEwt"),n("a1Th"),n("rE2o"),n("ioFf"),n("rGqo"),n("Btvt"),n("KKXr");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var i=new window.Map;function s(e){var t=i.get(e.currentTarget);if(t){var n=t[e.type];if(n)for(var r,s=0;s<n.length;s++){var o=a(n[s],2),l=o[0],c=o[1],d=void 0;if(hasClass(e.target,l)?d=c(e,e.target):(r=gpeByClass(l,e.target,e.currentTarget))&&(d=c(e,r)),!1===d)break}}}var o=n("Egk5");function l(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function c(e,t,n,a){Object(o.addEvent)(t,n,a),e._registeredHandlers.push({handlerType:"bind",elem:t,types:n,handler:a})}function d(e,t,n,a,r){!function(e,t,n,a){var r=i.get(e);r||(i.set(e,{}),r=i.get(e));for(var o=t.split(" "),l=0;l<o.length;l++){var c=o[l];r[c]||(r[c]=[],addEvent(e,c,s)),r[c].push([n,a])}}(t,n,a,r),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:n,selector:a,handler:r})}function u(e){var t={_registeredHandlers:[]};return e.handlers(c.bind(null,t),d.bind(null,t)),t}function g(e){e._registeredHandlers.forEach((function(e){var t,n,a,r,l;"delegate"===e.handlerType?(t=e.elem,n=e.types,a=e.selector,r=e.handler,(l=i.get(t))&&(n.split(" ").forEach(e=>{l[e]&&(l[e]=l[e].filter(e=>e[0]!==a||e[1]!==r),0===l[e].length&&removeEvent(t,e,s))}),0===Object.keys(l).map(e=>l[e].length).reduce((e,t)=>e+t)&&i.delete(t))):Object(o.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},"p+C8":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));n("91GP"),n("ioFf"),n("rGqo"),n("Btvt");var a=n("q1tI"),r=n("pemR");n("17x9");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o(e){var t=e.icon,n=e.aside,o=e.chevron,l=e.selectable,c=e.border,d=e.className,u=e.children,g=e.active,m=e.canBeHovered,p=void 0===m||m,_=s(e,["icon","aside","chevron","selectable","border","className","children","active","canBeHovered"]),h={"ListItem--chevron":!!o,"ListItem--selectable":!!l,"ListItem--border":!!c,"ListItem--active":!!g,"ListItem--can-be-hovered":p};return a.createElement("li",i({},_,{className:Object(r.classNames)("ListItem",h,d)}),t&&a.createElement("div",{className:"ListItem__icon"},t),a.createElement("div",{className:"ListItem__main"},u),a.createElement("div",{className:"ListItem__aside"},n))}o.defaultProps={onClick:()=>{},icon:null,aside:null,chevron:!1,selectable:!0,border:!0}},r7nW:function(e,t,n){"use strict";n.r(t);var a=n("q1tI"),r=n("i8i4"),i=(n("17x9"),n("pemR"));class s extends a.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,n=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+n+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),n&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,n=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),n&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(i.classNames)("BaseModal",e);return a.createElement("div",{className:t,"aria-modal":"true"},a.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),a.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return r.createPortal(this.renderModal(),document.body)}}s.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=s},rCUf:function(e,t,n){"use strict";n.r(t),n.d(t,"getUploadVideoExtMasks",(function(){return i})),n.d(t,"getUploadModule",(function(){return o})),n.d(t,"onVideoUploaded",(function(){return l}));n("91GP"),n("pIFo");var a=n("EasH"),r=n("8h6g");function i(e){var t=r.VIDEO_UPLOAD_EXTS.slice(0,r.VIDEO_UPLOAD_EXTS.length);if("types"===e){for(var n=t.length,a=0;a<n;++a)t.push(t[a].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+r.VIDEO_UPLOAD_EXTS.join(",."):""}function s(e){if(!cur.leaving){var t=getLang("video_upload_changed"),n=!1;if(each(window.cur.videoUploaders,(e,t)=>{Upload.isSomethingUploading(t)&&(n=!0)}),1===e){if(!n)return!0;var r=Object(a.showFastBox)({title:getLang("global_warning"),dark:!0},t,getLang("global_continue"),(function(){cur.leaving=!0,r.hide(),cur.onContinueCb&&cur.onContinueCb()}),getLang("global_cancel"),(function(){r.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return n?winToUtf(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function o(e,t,n,o,c){if(n){o=o||cur,(c=c||{}).onUploadStart||(c.onUploadStart=e=>{boxQueue.hideLast(),cur.nav.push((function(e,t,n){if(!1===s(1))return cur.onContinueCb=nav.go.pbind(n),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=s,c.onUploadProgress(e,0,0),Wall.showEditPost&&Wall.showEditPost(),c.onUploadStartDone&&c.onUploadStartDone()}),c.onUploadComplete||(c.onUploadComplete=(e,t)=>{var n=window.parseJSON(t);n.video_id?l(e,n,o):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);c.onUploadCompleteDone&&c.onUploadCompleteDone(),setTimeout(()=>{c.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&c.onUploadAllCompleteDone()})}),c.onUploadProgress||(c.onUploadProgress=(e,t,n)=>{var a=void 0!==e.ind?e.ind:e;show("_im_media_preview"),o.showMediaProgress&&o.showMediaProgress("video",a,function(e,t,n){return{loaded:t,total:n,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,n))}),c.onUploadError||(c.onUploadError=(e,t)=>{statlogsValueEvent("upload_video_fails",1,n.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,n=e.fileName?t+"_"+e.fileName:e;if(re("upload"+n+"_progress_wrap"),!geByClass1("popup_box_container")){var r=getLang("video_upload_error");setTimeout(Object(a.showFastBox)({title:getLang("global_error")},r).hide,2e3)}topError("Upload failed",{dt:-1,type:102,url:(ge("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var d=cur.maxFiles-(cur.savedVideos||[]).length,u=browser.safari?"":"video/*,"+i("accept");n.lang&&(cur.lang=extend(cur.lang||{},n.lang));var g={accept:u,file_input:null,file_name:"video_file",file_size_limit:1024*(n.options.file_size_limit_in_GB||r.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:i("types"),chooseBox:1,chunked:1,chunkSize:r.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:bodyNode,dropbox:t,from:n.vars.from,lang:n.lang,max_attempts:3,max_files:d,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!n.options.hasOwnProperty("visible_dropbox")||n.options.visible_dropbox},m=Upload.init(e,"",{},Object.assign(g,c));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(m),m}}function l(e,t,n,r){n=n||cur;var i=void 0!==e.ind?e.ind:e,s=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),o=s?i+"_"+s:e,l=t.owner_id+"_"+t.video_id,c=ge("upload"+o+"_progress_wrap");c&&hide(geByClass1("progress_x",c)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:l},{onDone:e=>{n.chooseMedia("video",l,extend(e[l],{upload_ind:o,upload_new:!0}));var i=t.owner_id,s=t.video_id,c=t.video_hash,d=0,u=()=>{ajax.post("al_video.php?act=encode_progress",{oid:i,vid:s,hash:c,need_thumb:1},{onDone:t=>{var c,d=!0;if(t){if(t.error)return c=getLang("video_upload_encode_error"),void setTimeout(Object(a.showFastBox)({title:getLang("global_error")},c).hide,2e3);t.thumb&&(d=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:i,vid:s},{onDone:t=>{n.hasChosenMedia("video",l)?n.updateChosenMedia("video",l,extend(t,{upload_ind:o,upload_new:!0})):r&&r(e,l)}}))}d&&n.hasChosenMedia("video",l)&&setTimeout(u,1e3)},onFail:()=>{++d<3&&setTimeout(u,2e3*d)}})};u()}})}t.default={getUploadModule:(e,t,n,a,r)=>o(e,t,n,a,r),initModalVideoUploader(){var e=cur.videoUploadParams,t=ge("choose_video_upload");return!!t&&(this.initDragEvents(),o(t,boxLayerWrap,e))},initDragEvents(){var e=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=ge("video_choose_upload_area_wrap");if(!hasClass(t,"video_choose_upload_area_enter")){addClass(t,"video_choose_upload_area_enter");var n=ge("video_choose_wrap"),a=getXY(n)[1],r=getSize(t)[1];return hide("video_choose_wrap"),setStyle(t,"height",scrollGetY()+window.clientHeight()-a+r),cancelEvent(e)}},t=e=>cancelEvent(e),n=e=>{if(t(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),cancelEvent(e)},a=()=>{addEvent(boxLayerWrap,"dragenter dragover",e),addEvent(boxLayerWrap,"dragleave",t),addEvent(boxLayerWrap,"drop",n)};a(),setTimeout(curBox().setOptions.pbind({onHide:()=>{removeEvent(boxLayerWrap,"dragenter dragover",e),removeEvent(boxLayerWrap,"dragleave",t),removeEvent(boxLayerWrap,"drop",n)},onShow:()=>{a()}}),0)}}},rHUl:function(e,t,n){"use strict";n.r(t),n.d(t,"getFirstUnread",(function(){return u})),n.d(t,"isSearchShown",(function(){return g})),n.d(t,"getPeer",(function(){return m})),n.d(t,"getCurrentKeyboard",(function(){return p})),n.d(t,"getKeyboard",(function(){return _})),n.d(t,"getTab",(function(){return h})),n.d(t,"getCurrentTab",(function(){return f})),n.d(t,"getSelectedMessages",(function(){return b})),n.d(t,"getMessageRangeFromSelection",(function(){return v})),n.d(t,"countUnread",(function(){return y})),n.d(t,"getMessageByRid",(function(){return O})),n.d(t,"isRidExist",(function(){return C})),n.d(t,"getLocalId",(function(){return j})),n.d(t,"getLastMessage",(function(){return E})),n.d(t,"parserMessage",(function(){return T})),n.d(t,"getAuthorFullName",(function(){return S})),n.d(t,"getMessage",(function(){return w})),n.d(t,"getPreviousMessage",(function(){return I})),n.d(t,"isClassicInterface",(function(){return k})),n.d(t,"isLocksAvailable",(function(){return M})),n.d(t,"isFoldersAvailable",(function(){return A})),n.d(t,"isCommunityInterface",(function(){return L})),n.d(t,"isChannelPeer",(function(){return P})),n.d(t,"getBareTab",(function(){return N})),n.d(t,"isReversedDialogs",(function(){return x})),n.d(t,"isFullyLoadedTab",(function(){return D})),n.d(t,"makeTabNotFullyLoaded",(function(){return R})),n.d(t,"isGoToEndVisible",(function(){return B})),n.d(t,"isGoToMentionVisible",(function(){return F})),n.d(t,"getUnreadScrollBottom",(function(){return H})),n.d(t,"isSendingAvailable",(function(){return U})),n.d(t,"isCommunityPeer",(function(){return G})),n.d(t,"isCommunityBlocked",(function(){return q})),n.d(t,"checkVoiceMessageAvailable",(function(){return K})),n.d(t,"isSearching",(function(){return V})),n.d(t,"getSearchText",(function(){return W})),n.d(t,"isSearchingValue",(function(){return $})),n.d(t,"isRecentSearchesActive",(function(){return z})),n.d(t,"getPinnedMessage",(function(){return Y})),n.d(t,"doPopularSuggExist",(function(){return Q})),n.d(t,"isAnyMessageBeingEdited",(function(){return X})),n.d(t,"getGroupId",(function(){return J})),n.d(t,"getTabDraft",(function(){return Z})),n.d(t,"getTemplates",(function(){return ee})),n.d(t,"tabIsMessageRequest",(function(){return te})),n.d(t,"tabIsMessageRequestToChat",(function(){return ne})),n.d(t,"removeMessageRequestFolderFlags",(function(){return ae})),n.d(t,"isMessageRequestFolder",(function(){return re})),n.d(t,"tabIsOutgoingMessageRequest",(function(){return ie})),n.d(t,"existsIncomingMessageRequest",(function(){return se})),n.d(t,"isMessageRequestChangedEvent",(function(){return oe})),n.d(t,"isCommunityChat",(function(){return le})),n.d(t,"isCommunityChatDeleted",(function(){return ce})),n.d(t,"isClosedChat",(function(){return de})),n.d(t,"isCasperChat",(function(){return ue})),n.d(t,"isCasperChatTab",(function(){return ge})),n.d(t,"isChatActive",(function(){return me}));n("Vd3H"),n("rGqo"),n("Btvt");var a=n("MhhX"),r=n("f01n"),i=n("h++7"),s=n("86+7"),o=n("rjmT"),l=n("aong"),c=n("lJdi"),d=n("rudk");function u(e,t){var n=Object(l.unpackStore)(e),r=n.tabs[n.peer];return Object.keys(r.msgs).filter(n=>{var i=w(e,t,n);return!Object(a.isOut)(i)&&intval(n)>r.in_up_to})[0]}function g(e){return Object(l.unpackStore)(e).searchShown}function m(e){return Object(l.unpackStore)(e).peer}function p(e){return _(e,m(e))}function _(e,t){var n=(h(e,t)||{}).keyboard;if(!n||!n.buttons||n.buttons.length)return n}function h(e,t){var n=Object(l.unpackStore)(e);return n.tabs&&n.tabs[t]}function f(e){var t=Object(l.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function b(e){return Object(l.unpackStore)(e).selectedMessages}function v(e,t,n){var r=h(e,t),i=b(e)[0];if(void 0===i)return[n];var s=Math.min(n,i),o=Math.max(n,i);return Object.keys(r.msgs).filter(e=>e>=s&&e<=o).filter(t=>{var n=w(e,e.get().peer,t);return!Object(a.isServiceMsg)(n)&&!Object(a.isCallMessage)(n)}).map(intval)}function y(e,t){var n=h(Object(l.unpackStore)(t),e),r=0;for(var i in n.msgs)if(n.msgs.hasOwnProperty(i)){var s=w(t,e,i);Object(a.isOut)(s)||(r+=Object(a.isUnread)(n,s)?1:0)}return r}function O(e,t,n){var a=h(e,t);return Object.keys(a.msgs).filter(a=>intval(w(e,t,a).randomId)===n).length>0}function C(e,t,n){return!!O(e,t,n)}function j(e,t){var n=Object(l.unpackStore)(e),a=n.msg_local_ids_sort&&n.msg_local_ids_sort[t];return void 0!==a?2e9+a:t}function E(e,t,n){var a=h(e,t),i=w(e,t,n),s=Object.keys(a.msgs).filter(n=>{var a=w(e,t,n),s=a.local&&a.type!==r.EDIT_MESSAGE;return!(!i.local&&s)&&(!(!i.local||s)||j(e,i.messageId)>j(e,a.messageId))}).pop();return s?w(e,t,s):null}function T(e){return e&&e.length>0?r.addMessageEvent([0].concat(e)):e}function S(e,t,n){var r=h(e,t),i=w(e,t,n),o=Object(l.unpackStore)(e);return Object(a.isOut)(i)?Object(s.oCacheGet)(e,o.id).name:i.userId!==i.peerId?!!Object(s.oCacheExists)(e,i.userId)&&Object(s.oCacheGet)(e,i.userId).name:r.tab}function w(e,t,n){var a=h(e,t),r=a&&a.msgs&&a.msgs[n];return r?T(r):null}function I(e,t,n){var a=h(e,t),r=a&&a.msgs&&Object.keys(a.msgs).sort((e,t)=>+e-t);if(!r)return null;var i=r&&r.indexOf(""+n),s=i>-1?r[i-1]:null;return a.msgs[s]}function k(e){var t=Object(l.unpackStore)(e);return t.gid||t.isClassic}function M(e){return Object(l.unpackStore)(e).gid}function A(e){return Object(l.unpackStore)(e).gid}function L(e){return!!Object(l.unpackStore)(e).gid}function P(e){return!!(e.peerId>2e9&&Object(c.doesChatTabHaveFlag)(e,1024))}function N(e,t){var n=Object(l.unpackStore)(t);return n.tabs[e]||n.mapped_index[e]}function x(e){var t=Object(l.unpackStore)(e);return!!L(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===i.FOLDER_UNRESPOND||t.active_tab===i.FOLDER_UNREAD))}function D(e,t){var n=(e=Object(l.unpackStore)(e)).tabs;return!(!n||!n[t]||void 0===n[t].history||!n[t].msgs)}function R(e,t){var n=h(e,t);n&&(n.msgs=void 0,n.msgid=void 0,n.scrollTop=void 0,n.scrollBottom=void 0,n.contHeight=void 0,n.offset=void 0,n.skipped=void 0)}function B(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function F(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function H(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function U(e){return!Object(l.unpackStore)(e).lockedSending}function G(e){return e>-2e9&&e<0}function q(e,t){return!!G(t)&&!!h(e,t).blocked_community}function K(e){return Object(l.unpackStore)(e).voice_message_available}function V(e){var t=Object(l.unpackStore)(e);return!(!W(t)&&!t.recentSearch)}function W(e){return Object(l.unpackStore)(e).searchText}function $(e,t){var n=Object(l.unpackStore)(e);return!!(t&&t!==W(e)||n.recentSearch)}function z(e){return Object(l.unpackStore)(e).recentSearch}function Y(e){var t=f(e);return t&&t.pinned&&T(t.pinned)}function Q(e){var t=e.get().popular_sugg;return t&&t.length>0}function X(e){return 1==Object(l.unpackStore)(e).isEditing}function J(e){return Object(l.unpackStore)(e).gid}function Z(e){return e.draft||(e.draft=Object(o.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(l.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function ne(e){return Object(d.isChatPeer)(e.peerId)&&te(e)}function ae(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]}function re(e){return Object(l.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function ie(e){return e.peerId>19e8&&e.peerId<2e9}function se(e){return!!Object(l.unpackStore)(e).dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]}function oe(e){var t=e.type,n=e.updateType;return t===r.CONVERSATION_UPDATED&&(n===r.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||n===r.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function le(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function ce(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function de(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function ue(e,t){return Object(c.doesChatTabHaveFlag)(h(e,t),c.MAIL_CHAT_FLAG_IS_CASPER)}function ge(e){return Object(c.doesChatTabHaveFlag)(e,c.MAIL_CHAT_FLAG_IS_CASPER)}function me(e){return!e.data.closed&&!e.data.kicked}},rjmT:function(e,t,n){"use strict";n.r(t),n.d(t,"ImDraft",(function(){return l})),n.d(t,"loadDraftForPeer",(function(){return d}));n("HEwt"),n("a1Th"),n("rGqo"),n("rE2o"),n("ioFf"),n("KKXr"),n("VRzm"),n("Btvt"),n("OEbY"),n("pIFo");var a=n("BxOC"),r=n("f01n"),i=n("vT4u");function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function l(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function c(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function d(e,t){return new l(e,"draft_"+t)}l.prototype.dump=function(){var e;this._key&&this._db.updateByKey(this._key,{txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0})},l.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},l.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},l.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},l.prototype.addAttach=function(e,t,n){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var a=this.dData.attaches.findIndex(n=>n.type===e&&n.id===t);-1===a?(this.dData.attaches.push({type:e,id:t,object:n}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[a]={type:e,id:t,object:n},this.dump())},l.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=s(e,2),n=t[0],a=t[1];return this.dData.attaches.find(e=>e.type==n&&e.id==a)||{type:n,id:a}})),this.dump()},l.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},l.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},l.prototype.addBindUrl=function(e,t,n){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:n}),this.dump())},l.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},l.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},l.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&r.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},l.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},l.prototype.hasAttaches=function(){return this.dData.attaches.length>0},l.prototype.destroy=function(){this.dData={},this._key=this._db=null},l.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(c)?Object(a.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=s(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},l.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},l.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,n){"use strict";n.r(t),n.d(t,"parseFwd",(function(){return s})),n.d(t,"convertKludgesToAttaches",(function(){return o})),n.d(t,"isReservedPeer",(function(){return l})),n.d(t,"isUserPeer",(function(){return c})),n.d(t,"isChatPeer",(function(){return d})),n.d(t,"convertAttachesToPhpMedia",(function(){return u}));var a=n("jE6c");function r(e,t){void 0===t&&(t=[]);var n=e.split("_");return[n[0],n[1],t]}var i={};function s(e){if(i[e])return i[e];for(var t=e?e.length:0,n=[],a=[],s="",o=0;o<t;o++){var l=e[o],c=l.charCodeAt(0);c>=48&&c<=57||"_"===l||"-"===l?s+=l:"("!==l&&")"!==l&&":"!==l&&","!==l||(""!==s&&(a.push(s),n.push("id"),s=""),a.push(l),n.push(l))}s.length>0&&(a.push(s),n.push("id"));var d=function e(t,n,a,i){if(void 0===a&&(a=0),void 0===i&&(i=0),i>50)return[[],t.length];for(var s=[],o="";a<t.length;){var l=t[a];if("id"===l)o=n[a];else if(","===l&&o)s.push(r(o)),o="";else if("("===l){var c=e(t,n,a+1,i+1),d=c[0];a=c[1],s.push(r(o,d)),o=""}else if(")"===l)return""!==o&&s.push(r(o)),[s,a];a++}return o&&s.push(r(o)),[s,a]}(n,a)[0];return Object.keys(i).length>300&&(i={}),i[e]=d,d}function o(e,t){var n=[];e.fwd_count?n.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&n.push({type:"mail",id:-t,object:{fwd_count:s(e.fwd).length}});for(var r=1;e["attach"+r+"_type"];++r)"call"===e["attach"+r+"_type"]?n.push({type:e["attach"+r+"_type"],id:e["attach"+r],initiatorId:Object(a.intval)(e["attach"+r+"_call_initiator_id"]),state:e["attach"+r+"_call_state"],duration:Object(a.intval)(e["attach"+r+"_call_duration"]),receiverId:Object(a.intval)(e["attach"+r+"_call_receiver_id"])}):n.push({type:e["attach"+r+"_type"],id:e["attach"+r],kind:e["attach"+r+"_kind"],productId:e["attach"+r+"_product_id"]});return e.geo&&n.push({type:"geo",id:e.geo}),n}function l(e){return 0==e}function c(e){return e>0&&e<2e9}function d(e){return e>2e9}function u(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},s5qY:function(e,t,n){var a=n("0/R4");e.exports=function(e,t){if(!a(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},tuSo:function(e,t,n){n("7DDg")("Int32",4,(function(e){return function(t,n,a){return e(this,t,n,a)}}))},"uW+i":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));n("rGqo"),n("Btvt"),n("hhXQ");var a=n("q1tI"),r=(n("17x9"),n("pemR"));class i extends a.Component{constructor(e){super(e),this.getActiveTab=()=>{var e=this.props.active,t=[],n=null;return this.props.children.forEach(a=>{a.key===e?n=a:t.push(a)}),n||(Number.isInteger(e)&&t.length>e?t[e]:t[0])},this.onClick=(e,t)=>{if(t!==this.state.active){var n=this.refsStore[t],a=this.getTransform(n);this.setState({active:t,isAnimating:!0,transform:a}),this.props.onTabClick(e,t)}},this.onTransitionEnd=e=>{"transform"===e.propertyName&&this.setState({isAnimating:!1})},this.getRef=(e,t)=>{this.refsStore[e]=t};var t=this.getActiveTab();this.refsStore={},this.state={isAnimating:!1,active:t.key}}static reactifyTabs(e){return(Array.isArray(e)?e:Object.values(e)).map(e=>a.createElement("a",{key:e[0],href:e[2],onClick:()=>{}},e[1]?unclean(e[1]):""))}componentDidUpdate(e,t,n){this.props.active!==e.active&&this.setState({active:this.props.active})}getTransform(e){var t=e.offsetWidth;return`translateX(${e.offsetLeft-50+.5*t}px) scaleX(${t/100})`}componentDidMount(){var e=this.refsStore[this.state.active];this.setState({transform:this.getTransform(e)})}render(){var e={"Tabs--animating":this.state.isAnimating};return a.createElement("nav",{className:Object(r.classNames)("Tabs",this.props.className,e),style:this.props.style},a.createElement("ul",{className:"Tabs__list"},this.props.children.map((e,t)=>a.createElement("li",{className:Object(r.classNames)("Tabs__item",{"Tabs__item--active":this.state.active===(e.key||t)}),onClick:n=>this.onClick(n,e.key||t),ref:n=>this.getRef(e.key||t,n),key:e.key||t},e))),a.createElement("div",{style:{transform:this.state.transform},className:"Tabs__divider",onTransitionEnd:this.onTransitionEnd}))}}i.defaultProps={onTabClick:()=>{},active:0}},uytb:function(e,t,n){"use strict";n.r(t),n.d(t,"RECENT_SEARCH_OP",(function(){return s})),n.d(t,"PIN_HIDDEN_ID_OP",(function(){return o})),n.d(t,"deleteOldStoredFormat",(function(){return u})),n.d(t,"mount",(function(){return m}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("BJj/");function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var s="recent_search",o="pin_hide";function l(e){return"im_store_"+e}function c(e){return ls.get(l(e))||{}}function d(e,t,n){if(ls.checkVersion()){var a=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",a.length),n(l(e),a)}}function u(e,t){for(var n=["fwd","draft","bind_attach"],a=c(e),r=!1,i=n.length;i--;)n[i]in a&&(delete a[n[i]],r=!0);r&&d(e,a,t)}function g(e,t,n){n.key===l(e)&&(t.db=JSON.parse(n.newValue),t.checkTime=Date.now())}function m(e){var t=Object(a.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&u(e,t);var n={db:c(e),checkTime:Date.now()},i=g.bind(null,e,n);return window.addEventListener("storage",i,!1),{select:(t,a)=>(Date.now()-n.checkTime>1e3&&(n.db=c(e)),function(e,t,n){return t===s?e[t]||[]:t===o?e[t]&&e[t][n]:e[t]?extend(!0,{},e[t][n]):null}(n.db,t,a)),selectByKey:t=>(Date.now()-n.checkTime>1e3&&(n.db=c(e)),n.db[t]),update(a,i){var l=function(e,t,n){switch(e[t]||(e[t]={}),t){case s:var a=n;a&&a.length>0?e[t]=a:delete e[t];break;case o:var i=r(n,2),l=i[0],c=i[1];c?e[t][l]=+c:delete e[t][l]}return e}(n.db,a,i);return n.db=l,n.checkTime=Date.now(),d(e,l,t)},updateByKey:(a,r)=>(n.db[a]=r,n.checkTime=Date.now(),d(e,n.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vRp6:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));n("HEwt"),n("a1Th"),n("Btvt"),n("rGqo"),n("rE2o"),n("ioFf");var a=n("q1tI"),r=(n("17x9"),n("UlUB")),i=n("PjZB"),s=n("pemR");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}class c extends a.Component{constructor(e){super(e),this.checkLoad=Object(r.throttle)(e=>{var t=o(e,3),n=t[0],a=t[1],r=t[2];if(!this.loading)return this.props.virtualized||this.props.hasMore?void(a-n-r<=this.props.threshold&&(this.loading=!0,this.props.loadMore().then(()=>{this.loading=!1}))):this.detachListeners()},34),this.onScroll=e=>{var t=this.getScrollData();this.props.virtualized&&this.processChildren(this.props.children,t),this.props.hasMore&&this.checkLoad(t)},this.getRef=e=>{this.container=e,this.props.virtualized&&this.setState(this.getChildrenData(this.props.children,this.getScrollData()))},this.useWindowScroll=e.useWindowScroll,e.virtualized&&(this.state={before:0,after:e.children.length,start:0,end:0})}getScrollData(){var e=this.useWindowScroll?document.documentElement:this.container;return[this.getScrollTop(),e?e.scrollHeight:0,e?e.clientHeight:0]}getScrollTop(){var e=document.documentElement||document.body.parentNode||document.body;return this.useWindowScroll?void 0!==window.pageYOffset?window.pageYOffset:e.scrollTop:this.container?this.container.scrollTop:0}attachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.addEventListener("scroll",this.onScroll,this.props.useCapture),e.addEventListener("resize",this.onScroll,this.props.useCapture))}detachListeners(){var e=this.useWindowScroll?window:this.container;this.container&&(e.removeEventListener("scroll",this.onScroll,this.props.useCapture),e.removeEventListener("resize",this.onScroll,this.props.useCapture))}processChildren(e,t){var n=this.state,a=this.getChildrenData(e,t||this.getScrollData()),r=a.start,i=a.end,s=a.before,o=a.after;r===n.start&&i===n.end&&s===n.before&&o===n.after||this.setState(a)}getChildrenData(e,t){var n=o(t,3),a=n[0],r=n[1],i=n[2],s=this.useWindowScroll?window:this.container,l=s&&s.offsetHeight;if(!s||0===r||0===i)return{start:0,end:0,before:0,after:e.length};i=Math.max(i,l);var c=e.length,d=Math.max(Math.floor(a/this.props.itemHeight)-1,0),u=Math.min(Math.floor((a+2*i)/this.props.itemHeight+1),c);return{start:d,end:u,before:d,after:c-u}}componentWillReceiveProps(e){this.props.virtualized&&this.processChildren(e.children)}componentDidMount(){this.attachListeners()}componentWillUnmount(){this.detachListeners()}render(){return a.createElement("div",{className:Object(s.classNames)("InfiniteScroll",this.props.className),ref:this.getRef,style:this.props.style},this.props.virtualized&&this.state.before>0&&a.createElement("div",{style:{height:this.state.before*this.props.itemHeight},key:"before"}),this.props.virtualized?[].concat(this.props.children).slice(this.state.start,this.state.end):this.props.children,this.props.virtualized&&this.state.after>0&&a.createElement("div",{style:{height:this.state.after*this.props.itemHeight},key:"after"}),this.props.hasMore&&(this.props.loader||a.createElement("div",{className:"InfiniteScroll__loader",key:"loader"},a.createElement(i.default,null))))}}c.defaultProps={useWindowScroll:!1,virtualized:!1,hasMore:!0,useCapture:!1,threshold:100,itemHeight:55}},vT4u:function(e,t,n){"use strict";n.r(t),n.d(t,"CONTROLLER",(function(){return T})),n.d(t,"ACTIVITY_PERIOD",(function(){return S})),n.d(t,"ACTIVITY_TYPE_TYPING",(function(){return w})),n.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return I})),n.d(t,"CHAT_ACTION_SETTINGS",(function(){return P})),n.d(t,"CHAT_ACTION_BLOCK",(function(){return N})),n.d(t,"CHAT_ACTION_INVITE",(function(){return x})),n.d(t,"CHAT_ACTION_MEDIA",(function(){return D})),n.d(t,"CHAT_ACTION_SEARCH",(function(){return R})),n.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return B})),n.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return F})),n.d(t,"CHAT_ACTION_UNPIN",(function(){return H})),n.d(t,"CHAT_ACTION_MUTE",(function(){return U})),n.d(t,"CHAT_ACTION_UNMUTE",(function(){return G})),n.d(t,"CHAT_ACTION_CLEAR",(function(){return q})),n.d(t,"CHAT_ACTION_LEAVE",(function(){return K})),n.d(t,"CHAT_ACTION_RETURN",(function(){return V})),n.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return W})),n.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return $})),n.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return z})),n.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return Y})),n.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return Q})),n.d(t,"ACTION_PRIORITIES",(function(){return X})),n.d(t,"loadHashes",(function(){return J})),n.d(t,"strHistory",(function(){return ne})),n.d(t,"updateBlockStates",(function(){return ae})),n.d(t,"loadPeer",(function(){return re})),n.d(t,"restoreHistoryQueue",(function(){return ie})),n.d(t,"removeFailed",(function(){return se})),n.d(t,"removeExpiredFailed",(function(){return oe})),n.d(t,"selectPeer",(function(){return ce})),n.d(t,"selectPeerOnMessage",(function(){return ue})),n.d(t,"changePeer",(function(){return ge})),n.d(t,"updateMentions",(function(){return me})),n.d(t,"setActions",(function(){return pe})),n.d(t,"loadMoreHistory",(function(){return _e})),n.d(t,"loadLessHistory",(function(){return he})),n.d(t,"readLastMessages",(function(){return be})),n.d(t,"readTillSpecificMessage",(function(){return ve})),n.d(t,"markAudioMessageAsListened",(function(){return ye})),n.d(t,"loadLongPollKey",(function(){return Oe})),n.d(t,"loadLongPollTs",(function(){return Ce})),n.d(t,"setMessageErrored",(function(){return je})),n.d(t,"resendMessage",(function(){return Ee})),n.d(t,"loadAdmins",(function(){return Se})),n.d(t,"updateVideoThumb",(function(){return ke})),n.d(t,"editMessage",(function(){return Me})),n.d(t,"addMessage",(function(){return Ae})),n.d(t,"markInboundMessagesAsRead",(function(){return xe})),n.d(t,"markOutboundMessagesAsRead",(function(){return De})),n.d(t,"initTextStore",(function(){return Re})),n.d(t,"processFwd",(function(){return Be})),n.d(t,"mergeTabs",(function(){return Fe})),n.d(t,"updateOnline",(function(){return He})),n.d(t,"setActivity",(function(){return Ue})),n.d(t,"updateActivity",(function(){return Ge})),n.d(t,"waitActivity",(function(){return qe})),n.d(t,"sendMessage",(function(){return Ve})),n.d(t,"deliverMessage",(function(){return We})),n.d(t,"deliverEditedMessage",(function(){return $e})),n.d(t,"addSelection",(function(){return ze})),n.d(t,"cleanSelected",(function(){return Ye})),n.d(t,"dropSelection",(function(){return Qe})),n.d(t,"replaceMessage",(function(){return Xe})),n.d(t,"saveMedia",(function(){return Je})),n.d(t,"loadMedia",(function(){return Ze})),n.d(t,"addAttachmentsToStoreData",(function(){return et})),n.d(t,"replaceMediaAttachesStore",(function(){return tt})),n.d(t,"setCurrentSearchDate",(function(){return nt})),n.d(t,"setInplaceSearch",(function(){return at})),n.d(t,"setCurrentSearch",(function(){return rt})),n.d(t,"searchHints",(function(){return it})),n.d(t,"searchHintsIndex",(function(){return st})),n.d(t,"localIndexToDialog",(function(){return ot})),n.d(t,"searchTopConv",(function(){return ct})),n.d(t,"searchImTopConv",(function(){return dt})),n.d(t,"searchLocalHints",(function(){return ut})),n.d(t,"preloadSearchIndex",(function(){return gt})),n.d(t,"loadDialogs",(function(){return mt})),n.d(t,"searchMessages",(function(){return pt})),n.d(t,"isSearchAllLoaded",(function(){return _t})),n.d(t,"isSearchingInplace",(function(){return ht})),n.d(t,"cancelSearch",(function(){return ft})),n.d(t,"clearDate",(function(){return bt})),n.d(t,"searchInplaceStart",(function(){return vt})),n.d(t,"searchMessagesInplace",(function(){return yt})),n.d(t,"loadImportant",(function(){return Ot})),n.d(t,"loadActualLastMessage",(function(){return Ct})),n.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return jt})),n.d(t,"removeMessagesMarkDeleted",(function(){return Et})),n.d(t,"removeMessages",(function(){return Tt})),n.d(t,"removeMessageSend",(function(){return St})),n.d(t,"removeMessagesWithRestore",(function(){return wt})),n.d(t,"restoreMessage",(function(){return It})),n.d(t,"restoreMessageSend",(function(){return kt})),n.d(t,"acceptMessageRequest",(function(){return At})),n.d(t,"rejectMessageRequest",(function(){return Lt})),n.d(t,"cancelMessageRequest",(function(){return Pt})),n.d(t,"sendTyping",(function(){return Nt})),n.d(t,"sendRecordingAudio",(function(){return xt})),n.d(t,"forwardMessages",(function(){return Dt})),n.d(t,"prepareForward",(function(){return Rt})),n.d(t,"deletedDialog",(function(){return Bt})),n.d(t,"flushHistory",(function(){return Ft})),n.d(t,"updateChatTopic",(function(){return Ht})),n.d(t,"loadChatInfo",(function(){return Ut})),n.d(t,"addNewMemberOptimisticly",(function(){return Gt})),n.d(t,"addNewMember",(function(){return qt})),n.d(t,"loadChatMember",(function(){return Kt})),n.d(t,"checkNewPeople",(function(){return Vt})),n.d(t,"loadNewPeople",(function(){return Wt})),n.d(t,"updateChatPhoto",(function(){return $t})),n.d(t,"updateActions",(function(){return zt})),n.d(t,"leaveChat",(function(){return Yt})),n.d(t,"returnToChat",(function(){return Qt})),n.d(t,"toggleMutePeer",(function(){return Xt})),n.d(t,"toggleMuteMentionsPeer",(function(){return Jt})),n.d(t,"setMutedPeer",(function(){return Zt})),n.d(t,"setExecStack",(function(){return en})),n.d(t,"favMessage",(function(){return tn})),n.d(t,"updateFavMessage",(function(){return nn})),n.d(t,"updateImportant",(function(){return an})),n.d(t,"loadSpam",(function(){return rn})),n.d(t,"flushSpam",(function(){return sn})),n.d(t,"setCreationType",(function(){return on})),n.d(t,"getOwnerPhoto",(function(){return ln})),n.d(t,"presetAvatar",(function(){return cn})),n.d(t,"setChatPhoto",(function(){return dn})),n.d(t,"createChat",(function(){return un})),n.d(t,"createCommunityChat",(function(){return gn})),n.d(t,"resync",(function(){return mn})),n.d(t,"toggleSendingAbility",(function(){return pn})),n.d(t,"setDelayedMessage",(function(){return _n})),n.d(t,"isAnythingLoading",(function(){return hn})),n.d(t,"updateUnreadCount",(function(){return fn})),n.d(t,"changeSubmitSettings",(function(){return bn})),n.d(t,"updateFavAndTitle",(function(){return vn})),n.d(t,"saveHistoryScroll",(function(){return yn})),n.d(t,"filterFromTab",(function(){return On})),n.d(t,"changeDialogsTab",(function(){return Cn})),n.d(t,"updateFolderState",(function(){return En})),n.d(t,"toggleDialogImportant",(function(){return Tn})),n.d(t,"markDialogAnswered",(function(){return Sn})),n.d(t,"getMutexQueue",(function(){return wn})),n.d(t,"releaseBlock",(function(){return In})),n.d(t,"toggleCommunityMute",(function(){return kn})),n.d(t,"deleteDialog",(function(){return Mn})),n.d(t,"restoreDialog",(function(){return An})),n.d(t,"spamDialog",(function(){return Ln})),n.d(t,"updateTabbedPeers",(function(){return Pn})),n.d(t,"isEverythingLoaded",(function(){return Nn})),n.d(t,"cleanTab",(function(){return xn})),n.d(t,"stringifyTab",(function(){return Dn})),n.d(t,"updateGoToEndVisibility",(function(){return Rn})),n.d(t,"updateGoToMentionVisibility",(function(){return Bn})),n.d(t,"toggleCommunityMessages",(function(){return Fn})),n.d(t,"updateHistory",(function(){return Hn})),n.d(t,"syncHistory",(function(){return Un})),n.d(t,"startRecording",(function(){return Gn})),n.d(t,"cancelRecording",(function(){return qn})),n.d(t,"setVoiceMessageAvail",(function(){return Kn})),n.d(t,"toggleConversation",(function(){return Vn})),n.d(t,"updateSearchQuery",(function(){return Wn})),n.d(t,"initializeChatResize",(function(){return $n})),n.d(t,"joinChat",(function(){return zn})),n.d(t,"getInviteLink",(function(){return Yn})),n.d(t,"resetInviteLink",(function(){return Qn})),n.d(t,"leaveInvitation",(function(){return Xn})),n.d(t,"saveRecentSearchPeer",(function(){return Jn})),n.d(t,"resetRecentSearch",(function(){return Zn})),n.d(t,"removeFromRecentSearch",(function(){return ea})),n.d(t,"pinMessageOptimistic",(function(){return ta})),n.d(t,"unpinMessageOptimistic",(function(){return na})),n.d(t,"pinMessage",(function(){return aa})),n.d(t,"unpinMessage",(function(){return ra})),n.d(t,"getPinnedMessage",(function(){return ia})),n.d(t,"getMessageLocalId",(function(){return sa})),n.d(t,"getChatMembers",(function(){return oa})),n.d(t,"getChatDetails",(function(){return la})),n.d(t,"updateFlags",(function(){return ca})),n.d(t,"removeChatPhoto",(function(){return da})),n.d(t,"kickUserOptimisticly",(function(){return ua})),n.d(t,"kickUser",(function(){return ga})),n.d(t,"toggleAdminOptimisticly",(function(){return ma})),n.d(t,"toggleAdmin",(function(){return pa})),n.d(t,"checkChatMember",(function(){return _a})),n.d(t,"hidePromoTooltip",(function(){return ha})),n.d(t,"videoAutoPlayHandler",(function(){return fa})),n.d(t,"hideTopBannerAction",(function(){return ba})),n.d(t,"callbackTopBannerAction",(function(){return va})),n.d(t,"loadBanner",(function(){return ya})),n.d(t,"setKeyboard",(function(){return Oa})),n.d(t,"deleteKeyboard",(function(){return Ca})),n.d(t,"toggleKeyboard",(function(){return ja})),n.d(t,"loadKeyboard",(function(){return Ea})),n.d(t,"changeCommunityAccess",(function(){return Ta})),n.d(t,"deleteTemplate",(function(){return Sa})),n.d(t,"createTemplate",(function(){return wa})),n.d(t,"updateTemplate",(function(){return Ia})),n.d(t,"resetTabAll",(function(){return ka})),n.d(t,"updateMessageRequestsCounter",(function(){return Ma})),n.d(t,"updateCasperMessageExpiringStatus",(function(){return Aa})),n.d(t,"prepareCasperMessagesFromMessages",(function(){return La})),n.d(t,"peerProfileToggleTag",(function(){return Pa})),n.d(t,"peerProfileManageTags",(function(){return Na}));n("HEwt"),n("rE2o"),n("ioFf"),n("hhXQ"),n("a1Th"),n("OG14"),n("OEbY"),n("Vd3H"),n("91GP"),n("SRfc"),n("rGqo"),n("VRzm"),n("Btvt");var a=n("BxOC"),r=n("bIHZ"),i=n("f01n"),s=n("DM26"),o=n("rudk"),l=n("aong"),c=n("uytb"),d=n("P13b"),u=n("h++7"),g=n("rHUl"),m=n("MhhX"),p=n("86+7"),_=n("ERyv"),h=n("Wu9C"),f=n("lJdi"),b=n("O8ze"),v=n("zxIV"),y=n("XzvV"),O=n("ambf");function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);a=!0);}catch(e){r=!0,i=e}finally{try{a||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var T="al_im.php",S=5,w="typing",I="audiomessage",k=Object(r.updateLazyLocation)(),M=k.scheduleNav,A=k.commitNav,L=k.scheduleNavWithTimeOut;var P="settings",N="block",x="invite",D="media",R="search",B="pin_hide",F="pin_unhide",H="unpin",U="mute",G="unmute",q="clear",K="leave",V="return",W="block_community",$="allow_community",z="block_notify",Y="call_audio",Q="call_video",X={[P]:0,[N]:1,[x]:2,[D]:3,[R]:6,[B]:7,[F]:7,[H]:8,[U]:10,[G]:10,[q]:11,[K]:12,[V]:12,[W]:12,[$]:12,[z]:12};function J(e,t,n){return Object(a.post)(T,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:n.gid})}function Z(e,t,n){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(a=>a?t(...n):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var n=Object.keys(e.tabs).filter(t=>Object(d.isFullyLoadedTab)(e,t));e.renew_hashes=J(n,{},e).then(t=>{var a=j(t,3),r=a[0],i=a[1],s=a[2];return n.forEach(t=>{e.tabs[t].hash=r[t]}),e.writeHash=i,e.manageTagsHash=s,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...n)))}function ee(e){return function(){var t=arguments,n=t[t.length-1];return e(...t).catch(a=>{if(a&&a.match&&a.match(/1001;/))return Z(n,e,t);throw a})}}function te(e){return"string"==typeof e?Object(v.se)(`<div>${e}</div>`):e}function ne(e){return"string"==typeof e?e:e.innerHTML}function ae(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function re(e,t,n,r,i){return i.tabHistoryNotChanged=!1,Object(s.retryFn)(a.post,3,e=>e-1)(T,{act:"a_start",peer:e,msgid:n,history:t,prevpeer:i.prevPeer,gid:i.gid,block:r}).then(t=>{var a=j(t,6),r=a[0],s=a[1],o=a[2],l=a[3],c=a[4],g=a[5];if(s.forEach(e=>Object(p.oCacheAdd)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},c,{[u.FOLDER_MESSAGE_REQUEST]:i.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]}),i.tabs[e]||(i.tabs[e]=Object(d.normalizeTab)(i,r)),ae(l,i),n){if(i.tabs[e]){var m=i.tabs[e].lastmsg,_=i.tabs[e].lastmsg_meta;extend(i.tabs[e],r),i.tabs[e].lastmsg=m,i.tabs[e].lastmsg_meta=_}}else extend(i.tabs[e],r);return i.admins=extend(i.admins,o),i.imQueue(e,!1),fa(),g&&(i.tabs[e].peer_profile_info=g),ie(e,i)}).catch(e=>Object(_.imWeirdCatch)("loadPeer",e))}function ie(e,t){var n=t.imQueue(e,!1),a=t.tabs[e],r=n.filter(n=>!Object(g.isRidExist)(t,e,n.rid));return a.msgs=r.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),a.msgs),t.imQueueSet(e,r),t.tabs[e].history=Object(d.restoreQueue)(r,t,te(t.tabs[e].history)),Promise.resolve(t)}function se(e,t,n,a){var r=a.imQueue(t),i=[],s=[];return r.forEach(e=>{e.failed&&n&&e.mess.messageId!==n&&s.push(e),!e.failed||n&&e.mess.messageId!==n||i.push("rid"+e.rid)}),a.imQueueSet(t,s),a.tabs[t].history=Object(d.removeMessages)(i,te(a.tabs[t].history)),Object(d.removeMessages)(i,e),Promise.resolve(a)}function oe(e,t,n){var a=n.imQueue(t),r=[],i=[],s=Date.now();return a.forEach(e=>{e.failed&&s-e.ts<864e5&&i.push(e),e.failed&&s-e.ts>=864e5&&r.push("rid"+e.rid)}),n.imQueueSet(t,i),n.tabs[t].history=Object(d.removeMessages)(r,te(n.tabs[t].history)),Object(d.removeMessages)(r,e),Promise.resolve(n)}function le(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(a.post)(T,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ae(j(e,1)[0],t))}function ce(e,t){var n=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(d.isFullyLoadedTab)(t,n)&&!t.tabs[n].msgid?(t.gid&&le(n,t),Promise.resolve(t).then(pe)):(Object(d.isFullyLoadedTab)(t,n)&&(t.tabs[n].msgid=!1),re(n,e,!1,!0,t)))).then(pe).then(de.bind(null,n))}function de(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(d.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(d.isTabLoaded)(t,e)&&n&&(t.tabs[e].last_visited=Date.now()),t}function ue(e,t,n){var a=n.msgid,r=n.peer;return!e&&Object(d.isFullyLoadedTab)(n,r)&&n.tabs[r].msgs[a]?(t===n.peer?n.tabHistoryNotChanged=!0:n.tabHistoryNotChanged=!1,n.gid&&le(r,n),Promise.resolve(n).then(pe).then(de.bind(null,r))):re(r,!0,a,!0,n).then(pe).then(()=>(Object(g.getTab)(n,r).msgid=a,n)).then(de.bind(null,r))}function ge(e,t,n,a){if(hn(a))throw Object(d.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var r=a.gid?"gim"+a.gid:"im";if(a.prevPeer=a.peer,a.peer=e,a.msgid=t||"",a.currentEntryPoint=n,cur.peer=e,M({sel:e?Object(d.convertPeerToUrl)(e):null,msgid:a.msgid,email:"",0:r}),0!=a.prevPeer&&de(a.prevPeer,a,!0),0!==e){Object(d.isTabLoaded)(a,e)&&de(e,a,!0),Pn(a.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(a.tabbedPeers):a.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,a)}else Pn(a.tabbedPeers,!1,a);return A(),ft(a.prevPeer,a)}function me(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((n,a)=>{if(cur.wallMentions=[],!Object(d.isChatPeer)(e.peer)||!Object(d.isFullyLoadedTab)(e,e.peer)||Object(d.isFvkcomgroup)(e,e.peer))return a();var r=e.tabs[e.peer];function i(){var a=[];Object.keys(r.msgs||{}).reverse().forEach(e=>{var t=Object(g.parserMessage)(r.msgs[e]),n=t&&t.userId;n&&n!=vk.id&&-1===a.indexOf(n)&&Object(d.isUserAliveInChat)(r,n)&&a.push(n)}),(r.memberIds||[]).forEach(e=>{-1===a.indexOf(e)&&a.push(e)});var i=[];a.forEach(t=>{if(Object(p.oCacheExists)(e,t)){var n=Object(p.oCacheGet)(e,t),a=n.link.substring(1);i.push([n.id,n.name,"@"+a,n.photo,void 0,void 0,void 0,a,n.first_name,""])}});var s=getLang("mail_im_mention_all"),o=getLang("mail_im_mention_online");t&&i&&i.length>1&&i.push(["online",o,"@online","/images/mention_online.svg",void 0,void 0,void 0,"online","online","here"],["all",s,"@all","/images/mention_all.svg",void 0,void 0,void 0,"all","all","everyone"]),n(i)}r.membersLoaded?i():oa(e.peer,e).then(i)})}function pe(e){var t=e.peer;if(0===t)return Promise.resolve(e);var n=e.tabs[t],a=Object(d.isChatPeer)(t),r=Object(g.isChannelPeer)(n),i=Object(g.isCommunityChat)(e,t),s=a&&!Object(g.isChatActive)(n),o=!!n.offset,l=[];o&&l.push(D),o&&l.push(R),!Object(d.isEmailPeer)(t)&&!o||r||l.push(q),!Object(d.isCommunityInterface)(e)||r||i||l.push(N),r&&!s&&l.push(P),Object(d.isCommunityPeer)(t)&&(n.can_send_notify?l.push(z):l.push(n.blocked_community?$:W)),!Object(d.isCommunityInterface)(e)&&(a||Object(d.isUserPeer)(t)||Object(d.isCommunityPeer)(t))&&(!a||!s)&&l.push(inArray(t,e.mutedPeers)?G:U);var c=!Object(d.isCommunityInterface)(e)&&Object(d.isUserPeer)(t)&&n.is_friend&&!n.block_error,u=a&&!s&&Object(f.canInviteUser)(e);(c||u)&&l.push(x),!a||s||Object(d.isCommunityInterface)(e)||l.push(K),a&&n.data.closed&&!n.data.kicked&&l.push(V),a&&n.pinned&&(l.push(Object(h.isPinnedMessageVisibleInTab)(e,t)?B:F),Object(f.canPinOrUnpin)(e)&&l.push(H));var m=Object(d.chatActions)(e,r);return e.curActions=l.sort((e,t)=>X[e]-X[t]).reduce((e,t)=>(e[t]=m[t],e),{}),Promise.resolve(e)}function _e(e,t,n){var r=n.tabs[n.peer];return Object(a.post)(T,{peer:n.peer,whole:e,act:"a_history",offset:r.offset+(r.skipped||0),toend:t,gid:n.gid}).then(e=>{var t=j(e,4),a=t[0],i=t[1],s=t[2],o=t[3];return r.allShown=s,n.admins=extend(n.admins,o),r.history=a+ne(r.history),r.historyToAppend=a,r.offset+=Object.keys(i).length,r.msgs=extend(r.msgs,i),n})}function he(e){var t=e.tabs[e.peer];return Object(a.post)(T,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(n=>{var a=j(n,5),r=a[0],i=a[1],s=a[2];a[3],a[4];t.allShown=t.allShown||s,t.history=ne(t.history)+r,t.historyToAppend=r;var o=Object.keys(i).length;return t.skipped-=o,t.offset+=o,t.msgs=extend(t.msgs,i),e})}function fe(e,t,n,a){var r=e.tabs[t];return a===i.FLAG_OUTBOUND&&r.out_up_to>n||(a===i.FLAG_OUTBOUND?r.out_up_to=n:r.in_up_to=n),e}var be=ee((function(e,t){if(Object(d.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var n=t.tabs[e],r=n.msgs||{},s=Object.keys(r).map(n=>Object(g.getMessage)(t,e,n)).filter(e=>!Object(m.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return n.skipped>0&&(s=s.filter(e=>intval(e)<=n.lastmsg-n.skipped)),(s=intval(s.shift()))<=n.in_up_to?Promise.resolve(t):(t.longpoll.push([i.readInboundEvent([6,e,s,null])]),Object(a.post)(T,{peer:e,ids:[s],hash:n.hash,act:"a_mark_read",gid:t.gid}).then(()=>fe(t,e,s,i.FLAG_OUTBOUND)).catch(()=>t))})),ve=ee((function(e,t,n){if(Object(d.tabIsMessageRequest)(n.tabs[t]))return Promise.resolve(n);var r=n.tabs[t];return e<=r.in_up_to?Promise.resolve(n):(n.longpoll.push([i.readInboundEvent([6,t,e,null])]),Object(a.post)(T,{peer:t,ids:[e],hash:r.hash,act:"a_mark_read",gid:n.gid}).then(()=>fe(n,t,e,i.FLAG_OUTBOUND)))})),ye=ee((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{peer:e,id:t,hash:r.hash,act:"a_mark_listened",gid:n.gid})}));function Oe(e){return Object(a.post)(T,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var n=j(t,3),a=n[0],r=n[1],i=n[2];return extend({},e,{imKey:a,imUrl:r,imPart:i})})}function Ce(e){return Object(a.post)(T,{act:"a_get_ts",gid:e.gid}).then(t=>{var n=j(t,1)[0];return extend({},e,{imTs:n})})}function je(e,t,n){var a=n.tabs[e];return a.msgs[t.messageId]&&(a.msgs[t.messageId].errored=1,a.history=Object(d.setMessageError)(e,t,te(a.history))),Promise.resolve(n)}function Ee(e,t,n,a){var r=a.tabs[e];return r.msgs[t]&&(r.msgs[t].errored=0,r.lastmsg_meta=n,r.lastmsg=t,r.history=Object(d.startResendMessage)(e,t,te(r.history))),Promise.resolve(a)}function Te(e,t,n,a){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,i)=>(!n&&!On(i)(t)||r&&!r(i,e[i],t)||(e[i]=Object(l.arrayUnique)(a(e[i],i))),e),e.dialog_tabs))}function Se(e,t){return 0===e.length?Promise.resolve(t):Object(a.post)(T,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var n=j(e,1)[0];return t.admins=extend(t.admins,n),t})}function we(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var n={peer:e,type:"temp"};Pn(t.tabbedPeers.concat([n]),!1,t)}}function Ie(e,t,n){return Object(d.isReversedDialogs)(n)?t.concat([e]):[e].concat(t)}function ke(e,t){var n=e.get().peer,a=Object(g.getTab)(e,n);if(Object(d.isFullyLoadedTab)(e,n)){var r=te(a.history);a.history=Object(d.updateMessageInCache)(e,r,t)}}function Me(e,t){var n=Object(g.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var a=te(n.history);n.msgs[e.messageId]=extend(!0,{},e),n.history=Object(d.editAndReplaceMessage)(t,e,a)}n&&n.lastmsg===e.messageId&&(n.lastmsg_meta=e);var r=n&&n.pinned&&Object(g.parserMessage)(n.pinned);r&&r.messageId===e.messageId&&(n.pinned=e);var i=!Object(m.isOut)(e)&&Object(m.isUnread)(n,e),s=n.mentions&&n.mentions.includes(e.messageId),o=i&&Object(m.hasUserMentions)(e,t.id)&&!s,l=i&&!Object(m.hasUserMentions)(e,t.id)&&s;return o?(n.mentions||(n.mentions=[]),n.mentions.push(e.messageId)):l&&Ne(e.peerId,t=>t!==e.messageId,t),Promise.resolve(t)}function Ae(e,t){var n=e.flags&i.FLAG_OUTBOUND,a=e.peerId;if(Object(d.isTabLoaded)(t,a)){var r=t.tabs[a];if(r.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),n||Object(d.tabIsMessageRequest)(r)?r.unread=0:(r.lastmsg===e.messageId&&r.unread?Le(t,1,e.peerId):(!r.unread&&Le(t,1,e.peerId),r.unread++),O.casperMessagesStore.has(e.messageId)&&!Object(g.isCasperChatTab)(r)&&(r.expiring_messages||(r.expiring_messages=[]),r.expiring_messages.push(e.messageId)),Object(m.hasUserMentions)(e,t.id)&&(r.mentions||(r.mentions=[]),r.mentions.push(e.messageId)),we(e.peerId,t)),Object(d.isFullyLoadedTab)(t,a)){var s=Object(m.isMessageToBlockedCommunity)(r,e),o=s||0===r.offset;s&&(r.blocked_community=0),r.skipped>0&&r.skipped++,r.offset++,r.msgs[e.messageId]=extend(!0,{},e);var l=te(r.history);r.history=Object(d.appendToHistory)(t,e,l,!0,!0,!0),o&&pe(t)}if(r.typing){var c=r.typing.userIds.indexOf(e.userId);c>=0&&r.typing.userIds.splice(c,1)}return r.lastmsg=e.messageId,r.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(r.minor_sort_id||0)&&(r.minor_sort_id=e.messageId),de(e.peerId,t),Te(t,r,!1,Ie.bind(null,a),jn.bind(null,t)),Promise.resolve(t)}return re(a,0,0,0,t).then(t=>(Te(t,t.tabs[a],!1,Ie.bind(null,a),jn.bind(null,t)),de(e.peerId,t),n||we(e.peerId,t),t))}function Le(e,t,n){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[n],e.unread_cnt+=t}function Pe(e,t,n){var a=n.tabs[e];return a.expiring_messages&&(a.expiring_messages=a.expiring_messages.filter(t),a.expiring_messages.length||delete a.expiring_messages),n}function Ne(e,t,n){var a=n.tabs[e];return a.mentions&&(a.mentions=a.mentions.filter(t),a.mentions.length||delete a.mentions),n}function xe(e,t){var n=Object(g.getTab)(t,e.peerId);if(Object(d.isFullyLoadedTab)(t,e.peerId)){var a=n.unread;if(t=fe(t,e.peerId,e.upToId,0),null!==e.unread?n.unread=e.unread:n.unread=e.upToId>=n.lastmsg?0:Object(g.countUnread)(e.peerId,t)+(n.unread>0?+n.skipped:0),a>0&&!n.unread&&Le(t,-1,e.peerId),!n.skipped){var r=te(n.history);n.history=Object(d.removewNewUnreadBarAndMerge)(t,r,e.peerId)}}else Object(d.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&Le(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(d.isTabLoaded)(t,e.peerId)&&e.upToId>=n.lastmsg&&(t.dialog_tabs[u.FOLDER_UNREAD]=t.dialog_tabs[u.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(d.isTabLoaded)(t,e.peerId)&&(Pe(e.peerId,t=>t>e.upToId,t),Ne(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==u.FOLDER_UNREAD||t.gid?Promise.resolve(t):Cn(u.FOLDER_ALL,t)}function De(e,t){var n=t.tabs[e.peerId];if(Object(d.isTabLoaded)(t,e.peerId)&&fe(t,e.peerId,e.upToId,i.FLAG_OUTBOUND),Object(d.isFullyLoadedTab)(t,e.peerId)){var a=te(n.history);n.history=Object(d.markMessagesAsRead)(t,e.peerId,a)}return Promise.resolve(t)}function Re(e,t,n,a,r){return r.text={},r.imQueue=e,r.imQueueResend=t,r.imQueueSet=n,r.imQueueComplete=a,Promise.resolve(r)}function Be(e,t,n){function a(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var r=e[0],i=Object(g.getMessage)(n,t,r),s=Object(g.getAuthorFullName)(n,t,r);return!1===s?n.set(Kt.bind(null,{[t]:[i.userId]})).then(n=>{var s=Object(g.getAuthorFullName)(n,t,r);return{msgIds:e,object:a(i,s)}}):Promise.resolve({msgIds:e,object:a(i,s)})}return Promise.resolve({msgIds:e})}function Fe(e,t){Object(d.normalizeTabsGotFromServer)(t,e);var n=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((n,a)=>{var r=t.tabs[a]?t.tabs[a].msgs:{},i=extend({},r||{},e[a].msgs||{});return n[a]=extend(t.tabs[a]||{},e[a]),i&&(n[a].msgs=i),e[a].lastmsg||(n[a].lastmsg=!1),n},t.tabs),n&&(t.tabs[t.peer]=n),Promise.resolve(t)}function He(e,t,n,a){var r=Object(g.getTab)(a,e);if(r&&r.last_seen&&r.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:r.last_seen.mobile;r.online=t,r.last_seen={platform:t,time:n||r.last_seen.time,mobile:i,can_see:r.last_seen.can_see}}return Promise.resolve(a)}function Ue(e,t,n){var a=Object(g.getTab)(n,e.peerId);return a&&(e.ts=Date.now()/1e3,a.activity||(a.activity={}),a.activity[t]=e,a.typing===w&&(a.typing=e)),Promise.resolve(n)}function Ge(e,t){var n=Object(g.getTab)(t,e.peerId),a=Object(m.isAudioMsg)(e)?"audiomessage":"typing";return n&&n.activity&&n.activity[a]&&(n.activity[a].userIds=n.activity[a].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function qe(e,t,n){var a=e.peerId;return Object(s.pause)(S+2).then(()=>{if(Object(d.isTabLoaded)(n,a)){var e=n.tabs[a];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*S&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*S&&(e.typing=void 0)}return n})}function Ke(e){var t={},n=e.find(e=>"poll"===e[0]);if(n){var a=j(n,3)[2];Object.assign(t,a)}return t}var Ve=function(e,t,n,r){var i=Date.now()+rand(0,100).toFixed(0),s=r.ref_id,l=r.ref_source;r.ref_source=void 0,r.ref_id=void 0,(l||s)&&(M({ref_source:null,ref:null}),A()),Object(b.statlogsSendingQueueLength)(r);var c=t.attaches.length>0,d=Object(b.statlogsSendingTime)(r,"send","server",c),u=Object.assign({act:"a_send",to:e,hash:n.hash,ref_source:l,ref:s,msg:t.message,payload:t.payload,media:Object(o.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:n.hidegid?void 0:r.gid,entrypoint:r.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},n.external,Ke(t.attaches));return Object(a.post)(T,u,2e4).then(e=>{var t=j(e,1)[0];return d(),r.version!==t.version&&nav.reload({force:!0}),r.currentEntryPoint="",r}).catch(e=>{throw Object(b.statlogsSendingError)(r,e,"send","server_send"),e})},We=ee((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=a.tabs[e];return Ve(e,t,C({hash:r.hash},n),a)})),$e=ee((function(e,t,n){var r=t.attaches.length>0,i=Object(b.statlogsSendingTime)(n,"edit","server",r);return Object(a.post)(T,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:n.gid,msg:t.origText,media:Object(o.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Ke(t.attaches)),2e4).then(e=>{j(e,1)[0];return i(),n}).catch(e=>{throw Object(b.statlogsSendingError)(n,e,"edit","server_send"),e})}));function ze(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var n=t.selectedMessages.concat(e);t.selectedMessages=Object(l.arrayUnique)(n).sort((e,t)=>e-t)}return Promise.resolve(t)}function Ye(e){return e.selectedMessages=[],Promise.resolve(e)}function Qe(e){return e.selectedMessages=[],Promise.resolve(e)}function Xe(e,t){if(Object(d.isFullyLoadedTab)(t,e.peerId)){var n=t.tabs[e.peerId],a=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,a),t.imQueueComplete(e.peerId,e.randomId),n.lastmsg_meta=e,n.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>n.minor_sort_id&&(n.minor_sort_id=e.messageId),n.msgs["rid"+e.randomId]&&(n.msgs[e.messageId]=e,delete n.msgs["rid"+e.randomId]),n.history=Object(d.replaceMessageAttrs)(t,te(n.history),e)}return Promise.resolve(t)}function Je(e,t){return Promise.resolve()}function Ze(e,t){var n=Object(b.statlogsSendingTime)(t,"unknown","attach"),r={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(s.retryFn)(a.post,3,e=>e*e)(T,r).then(a=>(n(),et(e,a,t))).catch(n=>(Object(b.statlogsSendingError)(t,n,"unknown","server_load_attach"),et(e,null,t)))}function et(e,t,n){var a=n.tabs[e.peerId],r=t[2];return a.mediacontent||(a.mediacontent={}),a.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],r&&(r.no_forward&&(a.msgs[e.messageId].kludges.no_forward=!0),r.no_pin&&(a.msgs[e.messageId].kludges.no_pin=!0)),tt(e,n)}function tt(e,t){var n=t.tabs[e.peerId];return n.history=Object(d.replaceAttaches)(te(n.history),e,t),Promise.resolve(t)}function nt(e,t,n){var a=Object(d.dayFromVal)(t),r=n.tabs[e];return r.searchDay=a,r.searchOffset=0,r.searchAllLoaded=!1,r.searchMsgs=[],Promise.resolve(n)}function at(e,t,n){return n.tabs[t].searchText=e,vt(t,n),n}function rt(e,t,n){if(t){var a=n.tabs[t];a.searchText=e,a.searchOffset=0,a.searchAllLoaded=!1}else n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1;return Promise.resolve(n)}function it(e,t,n,r,i){var s=+new Date;return Object(a.post)(T,{act:"a_hints",str:e,gid:r.hidegid?0:i.gid,query:n,peerIds:t.join(",")}).then(t=>{var n=j(t,3),a=n[0],r=n[1];return ae(n[2],i),r.forEach(e=>Object(p.oCacheAdd)(i,e)),Fe(a,i),Object(y.saveSearchAttemptStats)(y.serviceMessages,s,a&&a.length,e),Object.keys(a).sort((e,t)=>a[e].order-a[t].order).map(e=>a[e])})}function st(e,t,n,a){return it(e,t,n,{},a).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===n})))}function ot(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function lt(e){return(t,n)=>e(n).then(e=>{var a=(t?e.search(t):e.list).map(ot);return n.mapped_index||(n.mapped_index={}),a.forEach(e=>{n.mapped_index[e.peerId]=e}),a})}var ct=lt(e=>e.topConvTree),dt=lt(e=>e.imTopConvTree),ut=lt(e=>e.hintsTree);function gt(e,t){var n,r,i;t.topConvTree=new Promise(e=>{n=e}),t.hintsTree=new Promise(e=>{r=e}),t.imTopConvTree=new Promise(e=>{i=e});var o=e.select(c.RECENT_SEARCH_OP);return Object(s.retryFn)(a.post,1,()=>4)(T,{act:"a_dialogs_preload",rs:o.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var a=j(e,4),s=a[0],o=a[1],l=a[2],c=a[3];return t.popular_sugg=l,new vkIndexer(s,e=>e[1],n),new vkIndexer(o,e=>e[1],r),c&&c.length>0?new vkIndexer(c,e=>e[1],i):i(),t})}function mt(e){var t,n,r=e.active_tab,i=e.dialog_tabs[r];return i.length>0?i.forEach(a=>{var r=e.tabs[a],i=r.minor_sort_id,s=r.major_sort_id;void 0===t||t>s?(t=s,n=i):t===s&&n>i&&(n=i)}):(t=0,n=0),Object(a.post)(T,{act:"a_get_dialogs",start_message_id:n,major_sort_id:t,tab:r,gid:e.gid}).then(t=>{var n=j(t,4),a=n[0],s=n[1],o=n[2],l=n[3];return o.forEach(t=>Object(p.oCacheAdd)(e,t)),ae(l,e),Fe(s,e),e.dialog_tabs[r]=i.concat(Object.keys(s).map(intval)),e.dialog_tabs_all[r]=!a.has_more,Promise.resolve(e)})}var pt=ee((function(e,t){return Object(a.post)(T,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(n=>{var a=j(n,5),r=a[0],i=a[1],s=a[2],o=a[3],l=a[4];return i.forEach(e=>Object(p.oCacheAdd)(t,e)),Object(d.normalizeTabsGotFromServer)(t,r),e===t.searchText&&(t.searchOffset=o,t.searchAllLoaded=l),Object.keys(r).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=r[e]}),[r,s]})}));function _t(e,t){return t.tabs[e].searchAllLoaded}function ht(e,t){return!(t.peer!==e||!Object(d.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function ft(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.inplaceSearch,delete n.searchOffset,delete n.searchAllLoaded,delete n.searchText,delete n.searchDay,delete n.searchMsgs,M({st:""}),A()}return Promise.resolve(t)}function bt(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=t.tabs[e];delete n.searchDay,n.searchOffset=0,n.searchAllLoaded=!1,n.searchMsgs=[]}return Promise.resolve(t)}function vt(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var yt=ee((function(e,t){var n=t.tabs[e],r="";if(vt(e,t),n.searchDay&&(r="day:"+n.searchDay),!r&&!n.searchText)return Promise.reject();var i=`in:${e} ${r} ${n.searchText||""}`;return M({st:n.searchText}),A(),Object(a.post)(T,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:n.searchOffset||0}).then(e=>{var t=j(e,4),a=t[0],r=t[1],i=t[2],s=t[3];return n.searchOffset=r,n.searchAllLoaded=i,n.searchMsgs=(n.searchMsgs||[]).concat(s),a})}));function Ot(e){return Object(a.post)(T,{act:"a_important",offset:e,part:e>0})}function Ct(e,t){var n=Object(g.getTab)(e,t);return Object(a.post)(T,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(a=>{var r=j(a,4),i=r[0],s=r[1],o=r[2],l=r[3],c=intval(i[0]);n.lastmsg=c||!1,n.lastmsg_meta=i,(!Object(g.isCasperChat)(e,t)||c>n.minor_sort_id)&&(n.minor_sort_id=c);var d=j(s,3);n.unread=d[0],n.in_up_to=d[1],n.out_up_to=d[2],o?n.mentions=o:n.mentions&&delete n.mentions,l?n.expiring_messages=l:n.expiring_messages&&delete n.expiring_messages,n.unread||(e.get().dialog_tabs[u.FOLDER_UNREAD]=e.get().dialog_tabs[u.FOLDER_UNREAD].filter(e=>e!=t)),Te(e.get(),n,!1,Ie.bind(null,t),jn.bind(null,e.get()))})}function jt(e,t,n){n.tabs[e].unread-=t.length;var a=t.reduce((e,t)=>(e[t]=!0,e),{});return Pe(e,e=>!a[e],n),Ne(e,e=>!a[e],n),Promise.resolve(n)}function Et(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e}return Promise.resolve(n)}function Tt(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];if(a.history=Object(d.removeMessages)(e,te(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length,e.forEach(e=>delete a.msgs[e]),e.forEach(e=>{var t=(n.selectedMessages||[]).indexOf(e);-1!=t&&n.selectedMessages.splice(t,1)}),a.inplaceSearch){var r=e.reduce((e,t)=>(e[t]=!0,e),{});a.searchMsgs=a.searchMsgs.filter(e=>!r[e]),a.searchOffset=a.searchMsgs.length}}return Promise.resolve(n)}var St=ee((function(e,t,n,r,i){return Object(a.post)(T,{act:"a_mark",peer:t,hash:n||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:r})}));function wt(e,t,n,a){if(Object(d.isFullyLoadedTab)(a,t)){var r=a.tabs[t];r.deleted=r.deleted?r.deleted.concat(e):e,r.history=Object(d.removeMessagesWithRestore)(e,t,n,te(r.history)),r.offset-=e.filter(e=>r.msgs[e]).length}return Promise.resolve(a)}function It(e,t,n){if(Object(d.isFullyLoadedTab)(n,t)){var a=n.tabs[t];a.deleted&&(a.deleted=a.deleted.filter(t=>t!==e)),a.history=Object(d.restoreMessage)(e,t,te(a.history)),a.offset++}return Promise.resolve(n)}function kt(e,t,n,r){return Object(a.post)(T,{act:"a_restore",id:e,peer:t,hash:n,gid:r})}var Mt=ee((function(e,t,n){return Object(d.tabIsMessageRequest)(n.tabs[e])?Promise.resolve(n):(n.tabs[e].lastTyping=Date.now(),Object(a.post)(T,{act:"a_activity",type:t,peer:e,gid:n.gid,hash:n.tabs[e].hash}).then(()=>n,()=>n))})),At=ee((e,t)=>Object(a.post)(T,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var n=t.tabs[e];return n.is_message_request=!1,n.folders=Object(g.removeMessageRequestFolderFlags)(n.folders),t})),Lt=ee((e,t)=>Object(a.post)(T,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(Te(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),Pn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Pt=ee((e,t,n)=>Object(a.post)(T,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:n.tabs[e].hash}).then(()=>{var a=n.tabs[e];return a&&a.invitedByMessageRequest&&(a.invitedByMessageRequest=a.invitedByMessageRequest.filter(e=>e.id!==t)),n})),Nt=ee((function(e,t){return Mt(e,w,t)})),xt=ee((function(e,t){return Mt(e,I,t)}));function Dt(e,t,n,a){return t&&(a.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(n?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(a)}function Rt(e,t){return t.pendingForward=e,Promise.resolve(t)}function Bt(e,t,n){if(!Object(d.isTabLoaded)(n,e))return n;n.blockedFlagUpdates||(n.blockedFlagUpdates={}),n.blockedFlagUpdates[e]=!0;var a=n.tabs[e];return Te(n,a,!0,t=>t.filter(t=>t!==e)),a.unread>0&&!Object(d.tabIsMessageRequest)(a)&&Le(n,-1,e),a.deletedDialog=!0,Pn(n.tabbedPeers.filter(t=>t.peer!==e),!0,n),t.then(t=>{var r=j(t,2);r[0],r[1];return delete n.blockedFlagUpdates[e],a.msgs=null,a.history=null,a.unread=0,a.lastmsg=!1,a.lastmsg_meta=null,a.minor_sort_id=0,n})}var Ft=ee((function(e,t){return Bt(e,Object(a.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Ht=ee((function(e,t,n){return Object(a.post)(T,{act:"a_set_chat_title",peer:e,new_title:t,gid:n.gid,hash:n.tabs[e].hash}).then(()=>(n.onUpdate&&n.onUpdate(),n))})),Ut=ee((function(e,t){return Object(a.post)(T,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var a=j(n,1)[0];return t.tabs[e]=extend(t.tabs[e],a),t})}));function Gt(e,t,n){var a=n.tabs[e];return a.memberIds=[].concat(a.memberIds,t).filter((e,t,n)=>n.indexOf(e)===t),a.membersCount=a.memberIds.length,Promise.resolve(n)}var qt=ee((function(e,t,n,r){return Object(a.post)(T,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:r.gid,hash:r.tabs[e].hash,show_history:n?1:0}).then(e=>r)}));function Kt(e,t){if(isEmpty(e))return Promise.resolve(t);var n=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(a.post)(T,{act:"a_load_member",need:n,gid:t.gid}).then(e=>(j(e,1)[0].forEach(e=>Object(p.oCacheAdd)(t,e)),t))}function Vt(e,t,n){var a={},r=n.get();function s(e,t){Object(d.isChatPeer)(e)&&t&&!Object(p.oCacheExists)(r,t)&&(a[e]?-1===a[e].indexOf(t)&&a[e].push(t):a[e]=[t])}var o=t.filter(e=>!Object(d.isTabLoaded)(r,e.peerId)).map(e=>e.peerId);t.forEach(e=>{s(e.peerId,e.userId)}),e.forEach(e=>{s(e.peerId,+e.kludges.source_mid)});var l=t.filter(e=>e.flags&i.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!r.admins[e]);return 0===Object.keys(a).length&&0===l.length&&0===o.length?Promise.resolve(r):{shouldLoad:Object.keys(a).length>0||l.length>0||o.length>0,needMembers:a,needAdminIds:l,needPeers:o}}function Wt(e,t,n){var a=e.needMembers,r=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([Kt(a,n),Se(r,n),Promise.all(i.map(e=>re(e,0,0,0,n)))]).catch(()=>n).then(()=>t.resume()).then(()=>n)}var $t=ee((function(e,t){return e.kludges.source_act===d.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(a.post)(T,{act:"a_get_chat_photo",msg_id:e.messageId}).then(n=>{var a=j(n,2),r=a[0],i=a[1];t.chat_photo_msg=i;var s=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=r[0],t.tabs[e.peerId].photoLarge=r[1],Object(d.isFullyLoadedTab)(t,e.peerId)){var o=e.kludges.source_act;s.history=Object(d.addChatPhotoToUpdate)(e,o,t,te(s.history))}return t}))}));function zt(e,t,n,a){return t!==vk.id||Object(d.isTabLoaded)(a,n)&&a.peer==n&&(a=pe(a)),Promise.resolve(a)}var Yt=ee((function(e,t){return Object(a.post)(T,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(zt.bind(null,d.CHAT_KICK_USER,vk.id,e,t))})),Qt=ee((function(e,t){return Object(a.post)(T,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then(zt.bind(null,d.CHAT_INVITE_USER,vk.id,e,t))})),Xt=ee((function(e,t,n,r){return Object(a.post)(T,{act:"a_mute",peer:e,hash:r.tabs[e].hash,gid:r.gid,value:Number(t),until:n}).then(()=>{var n=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:n,peer:e}),r}).then(Zt.bind(null,e,t))})),Jt=ee((function(e,t,n){return Object(a.post)(T,{act:"a_mute_mentions",peer:e,hash:n.tabs[e].hash,gid:n.gid,value:Number(t)}).then(()=>n)}));function Zt(e,t,n){var a=n.mutedPeers.filter(t=>t!==e);return t&&a.push(e),n.mutedPeers=a,cur.mutedPeers=n.mutedPeers,pe(n)}function en(e,t){return t.stack=e,Promise.resolve(t)}var tn=ee((function(e,t,n,r){return nn(e,n,t,r),Object(a.post)(T,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:r.gid,peer:n,hash:r.tabs[n].hash}).then(()=>r)}));function nn(e,t,n,a){if(Object(d.isFullyLoadedTab)(a,t)){var r=a.tabs[t];e.filter(e=>r.msgs[e]).forEach(e=>{var s=Object(g.getMessage)(a,t,e),o=n?s.flags|i.FLAG_IMPORTANT:s.flags&~i.FLAG_IMPORTANT;s.flags=o,r.msgs[e]=s,r.history=Object(d.updateStar)(e,n,te(r.history))})}return Promise.resolve(a)}function an(e,t,n){return n.importants||(n.importants={}),(n.importants[t]||0)!==e&&(n.important_cnt+=e,n.importants[t]=e),Promise.resolve(n)}function rn(e,t){return Object(a.post)(T,{act:"a_spam",offset:e,gid:t,part:e>0})}function sn(e,t){return Object(a.post)(T,{act:"a_flush_spam",gid:t,hash:e})}function on(e,t,n){return n.creationType=e,n.creationFilter=t,Promise.resolve(n)}function ln(e,t){return Object(a.post)(T,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function cn(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function dn(e,t,n){return Object(a.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:n.gid}).then(e=>n)}var un=ee((function(e,t,n,r){return r.creating=!0,r.longpoll.pause(),Object(a.post)(T,{act:"a_multi_start",hash:r.writeHash,peers:t.join(","),title:n}).then(e=>{var t=j(e,1)[0];return r.next_peer=t.peerId,r.tabs[t.peerId]=t,Te(r,t,!1,e=>[t.peerId].concat(e)),r.longpoll.resume(),r}).then(t=>e?dn(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw r.creating=!1,r.longpoll.resume(),e})})),gn=ee((function(e,t,n){return n.creating=!0,Object(a.post)(T,{act:"a_multi_start",hash:n.writeHash,peers:[],title:t,gid:n.gid,is_community_chat:1}).then(t=>{var a=j(t,1)[0].peer_id;if(!a)throw new Error("No peer_id");return e?dn(a,e,n):n}).then(e=>(e.creating=!1,e)).catch(e=>{throw n.creating=!1,e})}));function mn(e){var t;e.resync_in_process=new Promise(e=>{t=e});var n=Object.keys(e.tabs).length,r=e.active_tab;return Object(a.post)(T,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:n,tab:r,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(n=>{var a=j(n,5),i=a[0],s=a[1],o=a[2],c=a[3],g=a[4];s.forEach(t=>Object(p.oCacheAdd)(e,t)),Object(d.normalizeTabsGotFromServer)(e,i),o.user_unread&&handlePageCount("msg",o.user_unread),Object(l.lplog)("Resync success","success");var m,_=e.peer;if(Object(d.isReservedPeer)(_))m=Promise.resolve(!1);else{var h={tabs:{[_]:e.tabs[_]},oCache:{}};m=Fe({[_]:i[_]},h)}return m.then(n=>{e.tabs=i,e.admins=extend(e.admins,c),n&&(e.tabs[_]=n.tabs[_],e.tabs[_].history=Object(d.restoreQueue)(_,e,te(e.tabs[_].history))),e.loadingDialogs=!1,e.mutedPeers=o.mutedPeers,e.lastDialogsOptions={has_more:o.has_more},e.dialog_tab_cts=Object.assign({},o.folder_cts,{[u.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[r]=g.map(intval);var a=e.dialog_tabs[r].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=r).forEach(t=>{r==u.FOLDER_ALL?e.dialog_tabs[t]=a.filter(On(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),fn(intval(o.unread),e)})}).catch(t=>(Object(l.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(s.pause)(2).then(mn.bind(null,e))))}function pn(e,t){return t.lockedSending=e,Promise.resolve(t)}function _n(e,t,n){return e&&!n.delayed_message?(n.delayed_message=e,n.delayed_ts=t):e||(n.delayed_message=e,n.delayed_ts=t),Promise.resolve(n)}function hn(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function fn(e,t){return t.unread_cnt=e,t.dialog_tab_cts[u.FOLDER_UNREAD]=e,Promise.resolve(t)}function bn(e,t){return t.ctrl_submit=!!e,Object(a.post)(T,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function vn(e,t,n){n.cur_unread_cnt||(n.cur_unread_cnt={}),t&&!inArray(e,n.mutedPeers)&&(n.cur_unread_cnt[e]=!0);var a=document.title,r=window.devicePixelRatio>=2?"_2x":"";if(t&&!n.update_title_to){var i=function(e,t,n){return function(){n.update_old_title=e;var a=Object.keys(n.cur_unread_cnt).length;if(0===a)return Object(v.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(n.update_title_to),void(n.update_title_to=!1);e?(Object(v.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(a>9?10:a)+t+".ico"),Object(v.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",a))))}}(a,r,n);n.update_title_to=setInterval(i,1e3),i()}else!t&&n.update_old_title&&(Object(v.setDocumentTitle)(n.update_old_title),n.cur_unread_cnt={},a=!1,n.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+r+".ico"),clearInterval(n.update_title_to),n.update_title_to=!1);return Promise.resolve(n)}function yn(e,t,n,a,r){return Object(d.isFullyLoadedTab)(r,e)&&(r.tabs[e].scrollTop=intval(t),r.tabs[e].scrollBottom=intval(n),r.tabs[e].contHeight=intval(a)),Promise.resolve(r)}function On(e){return e===u.FOLDER_ALL?e=>!Object(d.tabIsMessageRequest)(e):e===u.FOLDER_UNREAD?e=>!Object(d.tabIsMessageRequest)(e)&&e.unread>0:e===u.FOLDER_MESSAGE_REQUEST?e=>Object(d.tabIsMessageRequest)(e):t=>t.folders&u.FOLDER_MASKS[e]}function Cn(e,t){t.active_tab=e,Object(r.updateLocation)({tab:e===u.FOLDER_ALL?null:e});var n=[];if(e!==u.FOLDER_ALL&&!Object(d.isReversedDialogs)(t)){var a=t.dialog_tabs[e];n=t.dialog_tabs[u.FOLDER_ALL].map(e=>t.tabs[e]).filter(On(e)).map(e=>e.peerId),t.dialog_tabs[e]=a.length>=n.length?a:n}return Promise.resolve(t)}function jn(e,t,n,a){var r=e.dialog_tabs_all;return!(!r[u.FOLDER_ALL]&&!r[t])||(!!n.includes(a.peerId)||("r"===a.lastmsg[0]||n.map(t=>e.tabs[t.toString()]).filter(t=>Object(d.isReversedDialogs)(e)?t.minor_sort_id>a.minor_sort_id:t.minor_sort_id<a.minor_sort_id).length>0))}function En(e,t,n,a,r,s){if(Object(d.isTabLoaded)(s,e)&&!r){var o=s.tabs[e];return n===i.REPLACE_DIRECTORIES&&(t^=o.folders),function(e,t,n){return!(e===i.SET_DIRECTORIES&&n.folders&t)&&(!!(e!==i.RESET_DIRECTORIES||n.folders&t)&&!Object(d.tabIsMessageRequest)(n))}(n,t,o)&&Object.keys(u.FOLDER_MASKS).filter(e=>u.FOLDER_MASKS[e]&t).forEach(e=>{s.dialog_tab_cts[e]+=function(e,t,n){return t!==i.RESET_DIRECTORIES||e.folders&u.FOLDER_MASKS[n]?t===i.REPLACE_DIRECTORIES?e.folders&u.FOLDER_MASKS[n]?-1:1:t===i.SET_DIRECTORIES?1:-1:0}(o,n,e)}),n===i.SET_DIRECTORIES?s.tabs[e].folders|=t:n===i.RESET_DIRECTORIES?s.tabs[e].folders&=~t:s.tabs[e].folders=t^=o.folders,Te(s,s.tabs[e],!0,(t,n)=>t.concat([e]).map(e=>s.tabs[e]).filter(On(n)).map(e=>e.peerId),jn.bind(null,s)),Promise.resolve(s)}return re(e,0,0,0,s).then(En.bind(null,e,t,n,null,!1,s))}var Tn=ee((function(e,t){var n=u.FOLDER_MASKS[u.FOLDER_IMPORTANT],r=t.tabs[e].folders&n,s=r?i.resetDirectoriesEvent:i.setDirectoriesEvent;return t.longpoll.push([s([0,e,n,!0])]),Object(a.post)(T,{act:"a_dialog_star",val:r?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),Sn=ee((function(e,t,n){var r=u.FOLDER_MASKS[u.FOLDER_UNRESPOND];return n.longpoll.push([i.resetDirectoriesEvent([0,e,r,!0]),i.readInboundEvent([6,e,t,null])]),Object(a.post)(T,{act:"a_mark_answered",peer:e,lastmsg:t,hash:n.tabs[e].hash,gid:n.gid}).then(()=>n)}));function wn(e){return Object(a.post)(T,{act:"a_get_mutex_key",gid:e})}function In(e,t){return ae({[e]:{free:!0}},t),Object(a.post)(T,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function kn(e,t){var n=ls.get("comm_mute_"+t.gid)?1:0;return e&&(n^=1),ls.set("comm_mute_"+t.gid,n),t.mute=n,Promise.resolve(t)}var Mn=ee((function(e,t){return Te(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(a.post)(T,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>(n[0]?(Pn(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,Te(t,t.tabs[e],!1,Ie.bind(null,e),jn.bind(null,t))),n))}));function An(e,t,n,r){return Object(a.post)(T,{act:"a_restore_dialog",hash:t,gid:r.gid,spam:n?1:0,peer:e}).then(t=>(r.tabs[e].deletedDialog=!1,Te(r,r.tabs[e],!1,t=>[e].concat(t)),r.tabs[e].unread=t,r))}function Ln(e,t,n){return Object(a.post)(T,{act:"a_spam_dialog",peer:e,gid:n.gid,hash:t})}function Pn(e,t,n){return n.tabbedPeers=e,Object(d.isClassicInterface)(n)&&(M({peers:n.tabbedPeers.filter(e=>{var t=e.peer,a=e.type;return t!==n.peer&&"perm"===a}).map(e=>Object(d.getBareTab)(e.peer,n)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(d.convertPeerToUrl).join("_"),to:""}),t&&A()),Promise.resolve(n)}function Nn(e){return!e.peer||(ht(e.peer,e)?_t(e.peer,e):!!Object(d.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function xn(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.skipped=null,n.msgs=null,n.offset=null,n.allShown=null,n.history=null),Promise.resolve(t)}function Dn(e,t){var n=t.tabs[e];return Object(d.isFullyLoadedTab)(t,e)&&(n.history=ne(n.history)),Promise.resolve(t)}function Rn(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Bn(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Fn(e,t,n){if(!Object(d.isCommunityPeer)(t))return Promise.resolve(n);var r=Object(g.getTab)(n,t);return r.blocked_community=!e,!1===e&&(r.can_send_notify=!1),Object(a.post)(T,{act:"a_toggle_community",peer_id:t,hash:r.hash,state:e?1:0}).then(()=>pe(n))}function Hn(e,t){if(0!==t.peer&&Object(d.isFullyLoadedTab)(t,t.peer)){var n=Object(g.getTab)(t,t.peer);n.history=te(n.history),e(n.history)}return Promise.resolve(t)}function Un(e,t){if(0!==t.peer&&Object(d.isFullyLoadedTab)(t,t.peer)){var n=Object(g.getTab)(t,t.peer),a=geByClass1("_im_peer_history");a&&(n.history=te(a.innerHTML)),e(n.history)}return Promise.resolve(t)}function Gn(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function qn(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Kn(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Vn(e){M({act:e?"create":null}),A()}function Wn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;M({q:e}),A()}function $n(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(d.getClassicChatHeight)()>window.clientHeight()&&Object(d.setClassicChatHeight)(0)),Promise.resolve(e)}var zn=ee((function(e,t,n){return Object(a.post)(T,{act:"a_join_chat",chat_id:e,hash:t,write_hash:n.writeHash}).then(e=>{var t=j(e,4),a=t[0],r=t[1],i=t[2],s=t[3];return i.forEach(e=>Object(p.oCacheAdd)(n,e)),n.tabs[a]=r,Te(n,r,!1,Ie.bind(null,a),jn.bind(null,n)),n.admins=extend(n.admins,s),[a]})}));function Yn(e,t){return Object(a.post)(T,{act:"a_get_link",gid:t.gid,chat_id:e})}var Qn=ee((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(n.inviteLink=e[0],e))}));function Xn(e){return L({invite_chat_id:null,invite_hash:null,mr:null}),e.invitation=void 0,Promise.resolve(e)}function Jn(e,t){var n=Object(l.arrayUnique)([e].concat(t.select(c.RECENT_SEARCH_OP))).slice(0,500);t.update(c.RECENT_SEARCH_OP,n)}function Zn(e){e.update(c.RECENT_SEARCH_OP,[])}function ea(e,t){var n=t.select(c.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(c.RECENT_SEARCH_OP,n),n}function ta(e,t,n){var a=n.tabs[t],r=Object(g.getMessage)(n,t,e);return Object(g.isChatActive)(a)&&!r.kludges.source_act&&(a.pinned=r),Promise.resolve(n)}function na(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var aa=ee((function(e,t,n){var r=n.tabs[t];return Object(g.isChatActive)(r)?Object(a.post)(T,{act:"a_pin_message",msgid:e,chat:t,gid:n.gid,hash:n.tabs[t].hash}).then(e=>{var a=j(e,1)[0];return n.tabs[t]=Object.assign({},r,a),n}):Promise.resolve(n)})),ra=ee((function(e,t){var n=t.tabs[e];return Object(g.isChatActive)(n)?Object(a.post)(T,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(a=>{var r=j(a,1)[0];return t.tabs[e]=Object.assign({},n,r),t}):Promise.resolve(t)})),ia=ee((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var a=j(e,1)[0];return n.pinned=a||null,t})})),sa=ee((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:r.hash})})),oa=ee((function(e,t){var n=t.tabs[e];return n.membersLoaded?Promise.resolve(t):Object(a.post)(T,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var a=j(e,1),r=j(a[0],3),i=r[0],s=r[1],o=r[2];return n.memberIds=i,n.adminIds=s,o.forEach(e=>Object(p.oCacheAdd)(t,e)),n.membersLoaded=!0,t})})),la=ee((function(e,t){return Promise.all([oa(e,t),function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:n.hash}).then(e=>{var a=j(e,1)[0];return n.photoGrid=a.grid,n.photoLarge=a.photo,n.membersLastSeen=a.lastSeen||null,n.inviters=a.inviters,n.caccess=a.caccess,n.invitedByMe=a.invitedByMe||[],n.inviteLink=a.link||null,n.invitedByMessageRequest=a.invitedByMessageRequest,n.serverSettings=a.serverSettings||null,n.isDefaultPhotoOwner=a.isDefaultPhotoOwner||null,n.owner=a.owner||null,n.allowedUpdateFlags=a.allowedUpdateFlags,n.canInvite=a.canInvite||null,n.notifications=a.notifications,t})}(e,t)]).then(()=>t)})),ca=ee((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_update_flags",chat:e,gid:n.gid,hash:r.hash,flags:t}).then(e=>(n.onUpdate&&n.onUpdate(),e))})),da=ee((function(e,t){var n=t.tabs[e];return Object(a.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:n.photoHash}).then(()=>(n.photo=null,n.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function ua(e,t,n){var a=n.tabs[e];return a.memberIds=a.memberIds.filter(e=>e!==t),a.adminIds=a.adminIds.filter(e=>e!==t),a.membersCount=a.memberIds.length,Promise.resolve(n)}var ga=ee((function(e,t,n){var r=n.tabs[e];return Object(a.post)(T,{act:"a_kick_user",chat:e,hash:r.hash,mid:t,gid:n.gid}).then(()=>(r.memberIds=r.memberIds.filter(e=>e!==t),r.adminIds=r.adminIds.filter(e=>e!==t),r.membersCount=r.memberIds.length,n))}));function ma(e,t,n,a){var r=a.tabs[e];return r.adminIds=n?[].concat(r.adminIds,t).filter((e,t,n)=>n.indexOf(e)===t):r.adminIds.filter(e=>e!==t),Promise.resolve(a)}var pa=ee((function(e,t,n,r){var i=r.tabs[e];return Object(a.post)(T,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+n,gid:r.gid}).then(()=>ma(e,t,n,r))}));function _a(e,t,n,a){var r=Object(g.getMessage)(e,n,t).userId;return Object(p.oCacheGet)(a,r)?Promise.resolve(a):Kt({[n]:[r]},a)}function ha(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function fa(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var ba=ee((function(e,t){return t.tabs[e].top_banner=void 0,Object(a.post)(T,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),va=ee((function(e,t,n){n.tabs[e].top_banner=void 0;var r=n.tabs[e];return Object(a.post)(T,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:r.hash}).then(()=>n)}));function ya(e,t){return Object(a.post)(T,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(n=>{var a=j(n,1)[0];return t.tabs[e].top_banner=a,t})}function Oa(e,t,n){return n.tabs[e].keyboard=t&&t.buttons?t:null,ja(e,!1,!0,n)}function Ca(e,t){return Oa(e,null,t)}function ja(e,t,n,a){return((a.tabs||{})[e]||{}).keyboard&&(a.tabs[e].keyboard.hide=t,n&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(a)}var Ea=ee((function(e,t){var n=t.tabs[e];return Object(a.post)(T,{act:"a_get_keyboard",peer_id:e,hash:n.hash}).then(n=>{var a=j(n,1)[0];return Oa(e,a,t)})}));function Ta(e,t,n,r){var i=r.tabs[e];return i.caccess[t]=n,Object(a.post)(T,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:n?1:0,gid:r.gid}).then(()=>r).catch(e=>{throw i.caccess[t]=!n,e})}var Sa=ee((function(e,t){var n=t.tabs[t.peer];return Object(a.post)(T,{act:"a_delete_template",template_id:e,hash:n.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var n=t.templates.find(t=>t.id===e);return n&&(n.deleted=!0),t})}));function wa(e,t,n){var r=n.tabs[n.peer];return Object(a.post)(T,{act:"a_create_template",hash:r.hash,gid:n.gid,peer_id:n.peer,name:e,text:t}).then(e=>(n.templates.unshift(e[0]),n))}function Ia(e,t,n,r){var i=r.tabs[r.peer];return Object(a.post)(T,{act:"a_update_template",template_id:e,hash:i.hash,gid:r.gid,peer_id:r.peer,group_id:r.gid,name:t,text:n}).then(t=>{var n=r.templates.find(t=>t.id===e);return n&&Object.assign(n,t[0]),r})}function ka(e,t){if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(g.getTab)(t,e);n.allShown=!1,n.lastReset=Date.now()}return t}function Ma(e,t){var n=e.updateType,a=e.updateArg,r=0;return n===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(r=a===i.MESSAGE_REQUEST_STATUS_NEW?1:-1),n===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(r=-1),t.dialog_tab_cts[u.FOLDER_MESSAGE_REQUEST]+=r,Promise.resolve(t)}function Aa(e,t,n){if(Object(d.isFullyLoadedTab)(n,e.peerId)){var a=Object(g.getTab)(n,e.peerId);a.history=Object(d.setCasperMessageExpiringStatusDOM)(a.history,t,e.messageId)}return Promise.resolve(n)}function La(e,t){return Promise.resolve().then(()=>{if(Object(d.isFullyLoadedTab)(t,e)){var n=Object(g.getTab)(t,e);Object.values(n.msgs).forEach(e=>{var t=Object(g.parserMessage)(e);Object(m.isCasperMessage)(t)&&!O.casperMessagesStore.has(t.messageId)&&O.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var Pa=ee((function(e,t,n,r,i){return Object(a.post)(T,{act:"a_peer_profile_toggle_tag",hash:i.manage_tags_hash,group_id:i.gid,peer_id:n,tag_id:e,action:t}).then(()=>(i.tabs[n].peer_tags=r,i))})),Na=ee((function(e,t){return Object(a.post)(T,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t))}))},"wSs/":function(e,t,n){"use strict";n.r(t),n.d(t,"canMessageBeEdited",(function(){return l})),n.d(t,"convertEmojiHtmlToRegularText",(function(){return c})),n.d(t,"findLastMessageToEdit",(function(){return d})),n.d(t,"wasMessageReallyModified",(function(){return u})),n.d(t,"replaceMsgAfterEdit",(function(){return g}));n("Vd3H"),n("rGqo"),n("Btvt"),n("pIFo");var a=n("rHUl"),r=n("MhhX"),i=n("P13b"),s=n("rudk"),o=n("aong");function l(e,t){t=Object(a.parserMessage)(t);var n=vk.id==t.peerId&&!Object(o.unpackStore)(e).gid;return 333!=t.peerId&&(!(!n&&!Object(r.isOut)(t))&&(!Object(r.isServiceMsg)(t)&&(!(Date.now()/1e3-t.date>86400)&&(!(Object(r.isGift)(t)||Object(r.isSticker)(t)||Object(r.isAudioMsg)(t)||Object(r.isGraffiti)(t)||Object(r.isMoney)(t)||Object(r.isVKPay)(t)||Object(r.isCallMessage)(t))&&!Object(i.isAlreadyDeleted)(e,t.peerId,t.messageId)))))}function c(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function d(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(n=>l(e,t.msgs[n]))||null}function u(e,t,n){var a=Object(s.convertKludgesToAttaches)(t.kludges,t.messageId),r=n.dData.attaches;if(c(t.text)!==n.dData.txt||a.length!==r.length)return!0;for(var i=a.length;i--;){var o=a[i],l=r[i];if(o.id!=l.id||o.type!=l.type||"poll"==o.type&&l.object&&l.object.poll_is_edited)return!0}return!1}function g(e,t,n,a,r,s){t.origText=n,t.text=Object(i.replaceSpecialSymbols)(clean(n)).replace(/\n/gi,"<br>"),t.attaches=a,t.kludges.emoji=1,t.local=1,t.share_url=r,t.cancelled_shares=s,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},wmvG:function(e,t,n){"use strict";var a=n("hswa").f,r=n("Kuth"),i=n("3Lyj"),s=n("m0Pp"),o=n("9gX7"),l=n("SlkY"),c=n("Afnz"),d=n("1TsA"),u=n("elZq"),g=n("nh4g"),m=n("Z6vF").fastKey,p=n("s5qY"),_=g?"_s":"size",h=function(e,t){var n,a=m(t);if("F"!==a)return e._i[a];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var d=e((function(e,a){o(e,d,t,"_i"),e._t=t,e._i=r(null),e._f=void 0,e._l=void 0,e[_]=0,null!=a&&l(a,n,e[c],e)}));return i(d.prototype,{clear:function(){for(var e=p(this,t),n=e._i,a=e._f;a;a=a.n)a.r=!0,a.p&&(a.p=a.p.n=void 0),delete n[a.i];e._f=e._l=void 0,e[_]=0},delete:function(e){var n=p(this,t),a=h(n,e);if(a){var r=a.n,i=a.p;delete n._i[a.i],a.r=!0,i&&(i.n=r),r&&(r.p=i),n._f==a&&(n._f=r),n._l==a&&(n._l=i),n[_]--}return!!a},forEach:function(e){p(this,t);for(var n,a=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(a(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!h(p(this,t),e)}}),g&&a(d.prototype,"size",{get:function(){return p(this,t)[_]}}),d},def:function(e,t,n){var a,r,i=h(e,t);return i?i.v=n:(e._l=i={i:r=m(t,!0),k:t,v:n,p:a=e._l,n:void 0,r:!1},e._f||(e._f=i),a&&(a.n=i),e[_]++,"F"!==r&&(e._i[r]=i)),e},getEntry:h,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?d(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,d(1))}),n?"entries":"values",!n,!0),u(t)}}}});