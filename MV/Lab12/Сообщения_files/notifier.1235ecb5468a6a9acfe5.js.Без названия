!function(e){function t(t){for(var n,o,s=t[0],c=t[1],u=t[2],d=0,_=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&_.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);_.length;)_.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,s=1;s<r.length;s++){var c=r[s];0!==a[c]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={"web/notifier":0},i=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/js/cmodules/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([201,"bundles/common","bundles/vendors","bundles/1c6a9b415901224f27daf60c6bc90be0"]),r()}({"+/AQ":function(e,t,r){"use strict";r.r(t),r.d(t,"getNativeOption",(function(){return a})),r.d(t,"setNativeOption",(function(){return i})),r.d(t,"createScroll",(function(){return u}));var n=r("ofcU");function a(e,t){return bodyNode[e]||document.documentElement[e]}function i(e,t,r){"scrollTop"===e&&window.scrollTo(0,t)}class o{constructor(e,t){this.el=e,this.opts=t,this.module=Object(n.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return a("scrollTop",this.el);i("scrollTop",e,this.el)}contHeight(){return a("scrollHeight")}smoothScroll(e){scrollToY(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();var t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){var t=()=>{Date.now()-r<500&&this.scrollBottom(e),window.removeEventListener("scroll",t)},r=Date.now();window.addEventListener("scroll",t),this.scrollBottom(e)}onScroll(e){var t=this.scrollTop(),r=t-this.prevScroll,n=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-r,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&n-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){Object(n.destroyModule)(this.module)}}class s{constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{var r=this.scrollTop(),n=this.prevTop-r;this.prevTop=r,t.scrollChange&&t.scrollChange(r),t.onScroll&&t.onScroll(n,this)}})}update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){var t=Date.now();this.scroll.emitter.addOnceListener("resize",()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)}),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}}class c{constructor(e,t){this.el=e}update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}}function u(e,t){return t.noScroll?new c(e):t.nativeScroll?new o(e,t):new s(e,t)}},"/eGY":function(e,t,r){"use strict";r.r(t),r.d(t,"VKPAY_APP_ID",(function(){return l})),r.d(t,"BUTTON_TYPE_TEXT",(function(){return d})),r.d(t,"BUTTON_TYPE_VKPAY",(function(){return _})),r.d(t,"BUTTON_TYPE_LOCATION",(function(){return f})),r.d(t,"BUTTON_TYPE_OPEN_APP",(function(){return h})),r.d(t,"BUTTON_TYPE_OPEN_LINK",(function(){return p})),r.d(t,"BUTTON_COLOR_DEFAULT",(function(){return g})),r.d(t,"BUTTON_COLOR_SECONDARY",(function(){return m})),r.d(t,"BUTTON_COLOR_PRIMARY",(function(){return b})),r.d(t,"BUTTON_COLOR_NEGATIVE",(function(){return v})),r.d(t,"BUTTON_COLOR_POSITIVE",(function(){return C})),r.d(t,"handleButtonClick",(function(){return T})),r.d(t,"getButtonAppearance",(function(){return E})),r.d(t,"getButtonLabel",(function(){return O})),r.d(t,"getActionObjectFromElement",(function(){return k})),r.d(t,"getAttributesFromActionObject",(function(){return N}));r("HEwt"),r("a1Th"),r("rE2o"),r("ioFf"),r("rGqo"),r("Btvt"),r("/8Fb"),r("pIFo");var n=r("t7n3"),a=r("nAFc"),i=r("/PiP"),o=r("EasH"),s=r("N4ZS");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var l=6217559,d="text",_="vkpay",f="location",h="open_app",p="open_link",g="default",m="secondary",b="primary",v="negative",C="positive",y=["app-id","owner-id","type","payload","hash","label"];function T(e,t,r,n){var a=e.app_id,s=e.owner_id,c=e.type,u=e.payload,g=e.hash,m=void 0===g?"":g;switch(c){case p:break;case _:case h:var b="app"+(c===_?l:a)+(s?"_"+s:"");Object(i.showWiki)({w:b+encodeURIComponent("#"+m),from_keyboard:1,app_hash:r});break;case f:cur.sendLocation=function(e,r){r(),t({keyboardAuthorId:n,action:{label:"",attaches:[e],payload:u}})},Object(o.showBox)("al_places.php",{act:"a_choose_place_box",from_keyboard:1},{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case d:t({action:e,appHash:r,keyboardAuthorId:n});break;default:e.payload=JSON.stringify({command:"not_supported_button",button_type:c,payload:e.payload}),t({action:e,appHash:r,keyboardAuthorId:n})}}function E(e){return w(e)?b:e.color.toLowerCase().replace(g,m)}function O(e){var t=e.action,r=t.label;return t.type===f?getLang("mail_keyboard_label_location"):w(e)?getLang("mail_keyboard_label_vkpay").replace(/ VK Pay$/,""):function(e){var t=e;return t=Object(a.decodeHTMLEntities)(t||""),t=Object(n.clean)(t).replace(/\n(\r)?/gi," "),t=Emoji.emojiToHTML(t,!0)}(r)}function w(e){var t=e.action,r=t.app_id,n=t.type;return n===_||n===h&&r===l}function k(e){return y.reduce((t,r)=>(t[r.replace("-","_")]=e.getAttribute("data-"+r)||void 0,t),{})}function N(e){var t=Object.entries(e).reduce((e,t)=>{var r=c(t,2),a=r[0],i=r[1];return e+` data-${a.replace("_","-")}="${Object(n.clean)(""+i)}"`},"");e.type===p&&(t+=` href="${Object(s.wrapAwayIfExternal)(encodeURI(e.link),!0)}" target="_blank" rel="nofollow noopener"`);return t}},"0Rlc":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),a=(r("17x9"),r("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}class s extends n.Component{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange&&this.props.onChange(this.props.name,e.target.checked,e)}}render(){var e=this.props,t=e.children,r=e.checked,s=e.disabled,c=e.indeterminate,u=e.name,l=e.id,d=o(e,["children","checked","disabled","indeterminate","name","id"]),_=Object(a.classNames)("CheckBox",d.className,{"CheckBox--disabled":s,"CheckBox--indeterminate":c});return n.createElement("label",{className:_},n.createElement("input",i({},d,{className:"CheckBox__input",id:l,type:"checkbox",checked:r,name:u,disabled:s,onChange:this.onChange})),n.createElement("span",{className:"CheckBox__indicator","aria-hidden":!0}),t)}}},"0toi":function(e,t,r){"use strict";r.r(t);r("91GP");var n=r("q1tI"),a=(r("17x9"),r("r7nW")),i=r("6aSF"),o=r("pemR");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=e=>{var t=e.title,r=e.onClose,a=e.appearance,i=Object(o.classNames)("Modal__header","Modal__header--"+a);return n.createElement("div",{className:i},n.createElement("div",{className:"Modal__headerInner"},n.createElement("h1",{className:"Modal__headerTitle"},t),n.createElement("button",{className:"Modal__headerCross",type:"button",onClick:r},"Закрыть")))};c.defaultProps={appearance:"white"};var u=e=>n.createElement(i.default,{className:"Modal__body"},e.children);u.defaultProps={children:null};var l=e=>{var t=e.className,r=e.appearance,i=e.title,c=e.actionButtons,u=e.onClose,d=e.children,_=e.footerHint,f=Object(o.classNames)("Modal","Modal--"+r,t);return n.createElement(a.default,s({},e,{className:f}),n.createElement(l.Header,{title:i,onClose:u,appearance:r}),Boolean(d)&&n.createElement(l.Body,null,d),n.createElement(l.Footer,{actionButtons:c,hint:_}))};l.Header=c,l.Body=u,l.Footer=e=>{var t=e.actionButtons,r=e.hint;return n.createElement("div",{className:"Modal__footer"},n.createElement("div",{className:"Modal__footerInner"},r&&n.createElement("div",{className:"Modal__footerHint"},r),t))},l.defaultProps=s({},a.default.defaultProps,{appearance:"white"}),t.default=l},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,a){return window.statlogsValueEvent(e,t,r,n,a)}function a(e){return Math.random()<e}function i(e,t,r,i,o,s){a(e)&&n(t,r,i,o,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return a})),r.d(t,"statlogsProbValueEvent",(function(){return i}))},201:function(e,t,r){e.exports=r("8S/u")},"4KwC":function(e,t,r){"use strict";r.r(t),r.d(t,"lpSingletonGetInstance",(function(){return m})),r.d(t,"lpSingletonOnTabInitialLoaded",(function(){return b})),r.d(t,"lpSingletonSyncWithNotifier",(function(){return v})),r.d(t,"lpSingletonOnNotifierRecv",(function(){return C}));var n=r("nJdr"),a=r("V1Nw"),i=r("bP5l"),o=r("ERyv"),s=r("gdug"),c=r("t7n3"),u=r("4O8T"),l=r.n(u),d=window.lpConnect,_=window.lpInstance;function f(){return window.vk.id>0}function h(){return window.curNotifier&&window.curNotifier.lp_connected}function p(){return window.curNotifier&&window.curNotifier.is_server||s.browser.safari}function g(e,t,r){_.onLp(e,t,r),h()&&p()&&(e!=t||r.length)&&function(e,t,r){window.Notifier.lcSend("lp_data",{tsOld:e,tsNow:t,evs:r}),Object(i.lpLogFc)("silver","broadcast to others",e,t,r)}(e,t,r)}function m(){return f()?(_||(window.vk.lpConfig.id=window.vk.id,window.lpConnect=d=Object(n.createLongpoll)(window.vk.lpConfig,g),e=new l.a,t=Object(a.createLongpollEventsQueue)(window.vk.lpConfig.ts,(function(t){Object(i.longpollTestingOnFcEvents)(t),e.trigger("data",t)}),y),window.lpInstance=_={onData:function(t){e.on("data",t)},offData:function(t){e.off("data",t)},pause:function(){t.pause()},resume:function(){t.resume()},push:function(t){e.trigger("data",t)},abortWaiting:function(){d.abortWaiting()},onLp:function(e,r,n){t.onLp(e,r,n)},isEnabled:function(){return d&&!d.isStopped()}}),_):null;var e,t}function b(){f()&&(Object(i.lpLogFc)("orange","init longpoll connection on load"),m(),window.curNotifier.idle_manager.on("unidle",(function(){d.abortWaiting()})),v())}function v(){f()&&(h()?d.isStopped()&&p()?(Object(i.lpLogFc)("orange","now master, init connection"),Object(o.imWeirdLog)("fc_longpoll_master",{},!1),d.reinitConnection()):d.isStopped()||p()||(Object(i.lpLogFc)("orange","now slave, stop connection"),Object(o.imWeirdLog)("fc_longpoll_slave",{},!1),d.stopConnection()):setTimeout(v,500))}function C(e){h()&&!p()&&f()&&(Object(i.lpLogFc)("silver","recv from master",e.tsOld,e.tsNow,e.evs),d.onLp(e.tsOld,e.tsNow,e.evs))}function y(e){var t=Object(c.extend)({},window.lpConnect.options,{ts:e});return Object(i.lpLogFc)("orange","createLongpoll to load from",e),new Promise((function(e){var r=Object(n.createLongpoll)(t,(function(t,n,a){Object(i.lpLogFc)("orange","Loaded ["+t+","+n+")"),r.stopConnection(),e([t,n,a])}))}))}},"6aSF":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return c}));r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),a=(r("17x9"),r("+/AQ")),i=r("pemR");function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}class c extends n.Component{constructor(){super(...arguments),this.getWrapperRef=e=>{this.wrapper=e}}componentDidMount(){var e=this.props,t=e.isNative,r=e.isShadows,n=e.neverHide,i=e.onScroll;this.scroller||(this.scroller=Object(a.createScroll)(this.wrapper,{shadows:r,nativeScroll:t,hidden:!n,onScroll:i}))}componentDidUpdate(){this.scroller.update()}componentWillUnmount(){this.scroller.destroy(),this.scroller=null}render(){var e=this.props,t=e.children,r=(e.isNative,e.isShadows,e.neverHide,e.className),a=void 0===r?"":r,c=s(e,["children","isNative","isShadows","neverHide","className"]);return n.createElement("div",o({},c,{className:Object(i.classNames)("Scroll",a),ref:this.getWrapperRef}),t)}}c.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},"6krn":function(e,t,r){"use strict";r.r(t),r.d(t,"getLang",(function(){return o}));var n=r("nAFc"),a=r("4+be"),i={};function o(e,t,r){void 0===t&&(t=!1);var o="number"==typeof t,s=t||o,c=e+(s?".raw":"");if(void 0===i[c]){var u=s?Object(a.getLang)(e,"raw"):Object(a.getLang)(e);"string"==typeof u?i[c]=Object(n.decodeHTMLEntities)(u):Array.isArray(u)&&(i[c]=u.map(n.decodeHTMLEntities))}if(o){var l=t;return Object(a.langNumeric)(l,i[c],r)}return i[c]||""}t.default={getLang:o}},"86+7":function(e,t,r){"use strict";r.r(t),r.d(t,"oCacheExists",(function(){return a})),r.d(t,"oCacheGet",(function(){return i})),r.d(t,"oCacheAdd",(function(){return o}));r("KKXr");var n=r("aong");function a(e,t){return t in Object(n.unpackStore)(e).oCache}function i(e,t){var r=Object(n.unpackStore)(e).oCache[t];return r&&!r._n&&(!function(e){if(!e.first_name){var t=e.name.split(" ",2);e.first_name=t[0],e.short_name=t[1]?t[0]+" "+t[1].substr(0,1)+".":t[0]}e.inv_name||(e.inv_name=e.name),e.kick_name||(e.kick_name=e.inv_name)}(r),r._n=1),r}function o(e,t){var r=Object(n.unpackStore)(e);r.oCache||(r.oCache={}),t.id&&(r.oCache[t.id]=t)}},"8S/u":function(e,t,r){"use strict";r.r(t);var n=r("v+DW"),a=r("gF8j");function i(e,t){var r,n,a=!1;if(!e)throw new Error("Undefined filename");t=t||{};try{a=!!(n=ce("audio")).canPlayType,"no"!=n.canPlayType("audio/mpeg")&&""!=n.canPlayType("audio/mpeg")?r=".mp3?1":"no"==n.canPlayType('audio/ogg; codecs="vorbis"')||""==n.canPlayType('audio/ogg; codecs="vorbis"')||t.forceMp3?a=!1:r=".ogg?1"}catch(e){}var i=t.forcePath||"/"+e+r;if(a){n.src=i;var o=!1;n.addEventListener("ended",(function(){o=!0}),!0),n.load(),this.playSound=function(){o&&n.load();try{var e=n.play();e&&e.catch(e=>{debugLog(e)})}catch(e){}o=!1},this.pauseSound=function(){var e=n.pause();e&&e.catch(e=>{debugLog(e)})}}else{cur.__sound_guid=cur.__sound_guid||0;var s=ge("flash_sounds_wrap")||utilsNode.appendChild(ce("span",{id:"flash_sounds_wrap"})),c="flash_sound_"+cur.__sound_guid++;if(renderFlash(s,{url:"/swf/audio_lite.swf?4",id:c},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{})){var u=browser.msie?window[c]:document[c],l=!1,d=setInterval((function(){if(u&&u.paused)try{u.setVolume(1),u.loadAudio(i),u.pauseAudio()}catch(e){debugLog(e)}l=!0,clearInterval(d)}),300);this.playSound=function(){l&&u.playAudio(0)},this.pauseSound=function(){l&&u.pauseAudio()}}}}i.prototype={play:function(){try{this.playSound()}catch(e){}},pause:function(){try{this.pauseSound()}catch(e){}}},window.Sound=i;r("a1Th"),r("Btvt");var o=r("jE6c");window.curRBox||(window.curRBox={guid:0,active:!1,focused:[],tabs:{}});function s(e,t){var r=this;r.options=t=extend({minH:50,minW:50},t),r.content=e;var a=r.id="rb_box_"+(t.id||curRBox.guid++);r.wrap=ce("div",{id:a,className:"rb_box_wrap fixed"+(t.fixed?" fc_fixed":"")}),r.wrap.innerHTML+='<div class="tt-fastchat-wrap"></div>';var i={};r.toBottom=r.toRight=!1,t.fixed?(i.bottom=0,i.right=72):(void 0!==t.startTop?i.top=t.startTop:void 0!==t.startBottom&&(i.bottom=t.startBottom),void 0!==t.startLeft?i.left=t.startLeft:void 0!==t.startRight&&(i.right=t.startRight)),setStyle(r.wrap,i),t.movable&&addEvent(t.movable,"mousedown",r._head_mdown.bind(r)),r.resizeableH=t.resizeableH||e,t.startHeight&&setStyle(r.resizeableH,"height",t.startHeight),r.resizeableW=t.resizeableW||e,t.startWidth&&setStyle(r.resizeableW,"width",t.startWidth),addEvent(e,"mousedown",r._cont_mdown.bind(r)),t.closer&&(addEvent(t.closer,"mousedown",r._close_mdown.bind(r)),addEvent(t.closer,"click",r._close_click.bind(r))),t.hider&&(addEvent(t.hider,"mousedown",r._close_mdown.bind(r)),addEvent(t.hider,"click",r._hide_click.bind(r))),t.minimizer&&!0!==t.minimizer&&(addEvent(t.minimizer,"mousedown",r._close_mdown.bind(r)),addEvent(t.minimizer,"click",r._min_toggle.bind(r))),r.wrap.appendChild(e),!1!==t.resize&&(r.resizeWrap=ce("div",{className:"rb_resize_wrap",innerHTML:'<div class="chats_sp rb_resize"></div>'}),r.wrap.appendChild(r.resizeWrap),addEvent(r.resizeWrap,"mousedown",r._resize_mdown.bind(r))),t.minimized&&(addClass(r.wrap,"rb_minimized"),r.minimized=!0),bodyNode.insertBefore(r.wrap,ge("page_wrap"));var o=getStyle(r.wrap,"top"),s=getStyle(r.wrap,"bottom"),c=getStyle(r.wrap,"left"),u=getStyle(r.wrap,"right");this.toBottom=("auto"===o||""===o||browser.msie&&0===o)&&"auto"!=s&&""!==s&&!(browser.msie&&0===s),this.toRight=("auto"===c||""===c||browser.msie&&0===c)&&"auto"!=u&&""!==u&&!(browser.msie&&0===u),this.toRight&&setStyle(r.wrap,{marginRight:lastWndScroll[0]?Object(n.sbWidth)():0}),(t.nofocus||t.noshow)&&addClass(r.wrap,"rb_inactive"),this.toBottom&&(setStyle(r.wrap,{marginRight:lastWndScroll[0]?Object(n.sbWidth)():0}),addClass(r.wrap,"fc_tobottom")),this.options.marginFixedToLayer&&setStyle(r.wrap,{marginRight:hasClass(document.body,"layers_shown")?Object(n.sbWidth)():0}),curRBox.tabs[a]=r,r.pos=!1,t.noshow?(setStyle(r.wrap,{visibility:"hidden",display:"block"}),r._update_pos(),setStyle(r.wrap,{visibility:"",display:""})):r.show(!1,t.nofocus)}extend(s.prototype,{show:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var r=this;void 0===e&&(e=0),e?(setStyle(r.wrap,{opacity:0,display:"block"}),r.visible=!0,!t&&r.focus(),animate(r.wrap,{opacity:1},e,(function(){setStyle(r.wrap,browser.msie?{filter:"none"}:{opacity:""}),r._update_pos()}))):(show(r.wrap),r.visible=!0,!t&&r.focus(),r._update_pos()),r.options.onShow&&r.options.onShow()})),hide:function(e){function t(t,r,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,r){var n=this;if(!t&&n.options.onBeforeHide&&n.options.onBeforeHide())return!0;void 0===e&&(e=0),e?(setStyle(n.wrap,{opacity:1,display:"block"}),animate(n.wrap,{opacity:0},e,(function(){hide(n.wrap),setStyle(n.wrap,browser.msie?{filter:"none"}:{opacity:""})}))):hide(n.wrap),n.visible=!1,!t&&n.options.onHide&&n.options.onHide(r||{})})),_head_mdown:function(e){if(!checkEvent(e)){(e.originalEvent||e).cancelBubble=!0;var t,r,a=this,i=e.target,o=getWndInner(),s=curRBox.active==a.id,c=e.pageY,u=e.pageX,l=a.wrap.offsetHeight,d=a.wrap.offsetWidth,_=0,f=0,h=o[0]-l,p=o[1]-d,g=browser.msie?"selectstart":"mousedown";a.options.fixed&&FastChat.pinTab(a.options.peer||-1,e,!0),s||a.focus(e),a.toBottom?(a.toBottom=!1,t=o[0]-intval(getStyle(a.wrap,"bottom"))-l,setStyle(a.wrap,{top:t,bottom:"auto"}),removeClass(a.wrap,"fc_tobottom")):t=intval(getStyle(a.wrap,"top")),a.toRight?(a.toRight=!1,r=o[1]-intval(getStyle(a.wrap,"right"))-d,setStyle(a.wrap,{left:r,right:"auto"})):r=intval(getStyle(a.wrap,"left")),_=t,f=r,cur._fcdrag=1;var m=function(e){return _=Math.max(0,Math.min(h,t+e.pageY-c)),h-_<10?_=h:_<10&&(_=0),a.wrap.style.top=_+"px",f=Math.max(0,Math.min(p,r+e.pageX-u)),p-f<10?f=p:f<10&&(f=0),a.wrap.style.left=f+"px",cancelEvent(e)};return addEvent(document,"mousemove",m),addEvent(document,"mouseup",(function e(t){cur._fcdrag=0,removeEvent(document,"mousemove",m),removeEvent(document,"mouseup",e),removeEvent(document,g,cancelEvent),setStyle(bodyNode,"cursor",""),setStyle(i,"cursor",""),(a.toBottom=_>=h-5)&&(setStyle(a.wrap,{top:"auto",bottom:0}),addClass(a.wrap,"fc_tobottom")),(a.toRight=f>=p-5)&&setStyle(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?Object(n.sbWidth)():0}),a._update_pos();var r=Math.abs(t.pageY-c)<3&&Math.abs(t.pageX-u)<3;cur._fcpromo>0?cur._fcpromo=r?0:-1:a.options.minimizer&&r?!a.minimized&&s?a.minimize(!0):a.minimized&&a.unminimize(!0):a.options.onDragEnd&&a.options.onDragEnd(a.toBottom?-1:_/o[0],a.toRight?-1:f/o[1])})),addEvent(document,g,cancelEvent),setStyle(bodyNode,"cursor","move"),setStyle(i,"cursor","move"),!1}},_resize_mdown:function(e){if(!checkEvent(e)){this.focus(e);var t,r,a=this,i=e.target,o=getWndInner(),s=e.pageY,c=e.pageX,u=a.wrap.offsetHeight,l=a.wrap.offsetWidth,d=0,_=0,f=a.resizeableH.clientHeight-intval(getStyle(a.resizeableH,"paddingBottom"))-intval(getStyle(a.resizeableH,"paddingTop")),h=a.resizeableW.clientWidth-intval(getStyle(a.resizeableW,"paddingRight"))-intval(getStyle(a.resizeableW,"paddingLeft")),p=browser.msie?"selectstart":"mousedown",g=!browser.msie&&a.options.onResize||!1;a.toBottom?(a.toBottom=!1,t=o[0]-intval(getStyle(a.wrap,"bottom"))-u,setStyle(a.wrap,{top:t,bottom:"auto"}),removeClass(a.wrap,"fc_tobottom")):t=intval(getStyle(a.wrap,"top")),a.toRight?(a.toRight=!1,r=o[1]-intval(getStyle(a.wrap,"right"))-l,setStyle(a.wrap,{left:r,right:"auto"})):r=intval(getStyle(a.wrap,"left")),a.options.onResizeStart&&a.options.onResizeStart(f,h);var m=f+o[0]-t-u,b=h+o[1]-r-l,v=function(e){return d=Math.max(a.options.minH,Math.min(m,f+e.pageY-s)),m-d<10&&(d=m),a.resizeableH.style.height=d+"px",_=Math.max(a.options.minW,Math.min(b,h+e.pageX-c)),b-_<10&&(_=b),a.resizeableW.style.width=_+"px",g&&g(d,_),cancelEvent(e)};return addEvent(document,"mousemove",v),addEvent(document,"mouseup",(function e(t){removeEvent(document,"mousemove",v),removeEvent(document,"mouseup",e),removeEvent(document,p,cancelEvent),setStyle(bodyNode,"cursor",""),setStyle(i,"cursor",""),(a.toBottom=d==m)&&(setStyle(a.wrap,{top:"auto",bottom:0}),addClass(a.wrap,"fc_tobottom")),(a.toRight=_==b)&&setStyle(a.wrap,{left:"auto",right:0,marginRight:lastWndScroll[0]?Object(n.sbWidth)():0}),a._update_pos(),a.options.onResizeEnd&&a.options.onResizeEnd(d,_,o[0],o[1],a.toBottom,a.toRight)})),addEvent(document,p,cancelEvent),setStyle(bodyNode,"cursor","move"),setStyle(i,"cursor","move"),!1}},_update_pos:function(){var e=this;e.pos=[e.wrap.offsetTop,e.wrap.offsetLeft,e.wrap.offsetHeight,e.wrap.offsetWidth]},_wnd_resize:function(e,t,r){var n=this;n.toBottom&&(n.pos[0]=n.wrap.offsetTop),n.toRight&&(n.pos[1]=n.wrap.offsetLeft);var a={},i=!1,o=!1,s=n.pos[0]+n.pos[2]-e,c=n.pos[0],u=n.resizeableH.clientHeight-n.options.minH,l=n.pos[1]+n.pos[3]-t,d=n.pos[1],_=!1!==n.options.resize?n.resizeableW.clientWidth-n.options.minW:0;r&&(_<0&&setStyle(n.resizeableW,n.options.minW),u<0&&setStyle(n.resizeableH,n.options.minH)),(s<=0||c<=0&&u<=0)&&(l<=0||d<=0&&_<=0)||(s>0&&c>0&&(s-=c=Math.min(s,c),a.top=n.pos[0]-c,a.bottom=""),s>0&&u>0&&(u=Math.min(s,u),i=n.resizeableH.clientHeight-u),l>0&&d>0&&(l-=d=Math.min(l,d),a.left=n.pos[1]-d,a.right=""),l>0&&_>0&&(_=Math.min(l,_),o=n.resizeableW.clientWidth-_),!1!==o&&setStyle(n.resizeableW,"width",o),!1!==i&&setStyle(n.resizeableH,"height",i),setStyle(n.wrap,a),n._update_pos(),n.options.onResize&&n.options.onResize(n.resizeableH.clientHeight,n.resizeableW.clientWidth))},_cont_mdown:function(e){if(curRBox.active!=this.id&&(this.focus(e),!hasClass(e.target,"fc_editable")))return cancelEvent(e)},_focus:function(){var e=this,t=indexOf(curRBox.focused,e.id),r=curRBox.active,n=r&&curRBox.tabs[r];if(r!=e.id){n&&Object(o.isFunction)(n.options.onBlur)&&n.options.onBlur(),-1!=t&&curRBox.focused.splice(t,1),curRBox.focused.unshift(e.id);var a=1e4+curRBox.focused.length,i=!0;each(curRBox.focused,(function(e,t){var r=curRBox.tabs[t].wrap;i?(addClass(r,"rb_active"),removeClass(r,"rb_inactive"),curRBox.active=t,i=!1):(removeClass(r,"rb_active"),addClass(r,"rb_inactive")),setStyle(r,"zIndex",a),a--}))}},_hide_click:function(){this.hide()},minimize:function(e){var t=this,r=t.wrap;if(t.options.fixed)return!1;addClass(r,"rb_minimized"),t.minimized=!0,t._update_pos(),e&&t.options.onMinimize&&t.options.onMinimize(0)},unminimize:function(e){var t=this,r=t.wrap,n=getWndInner();removeClass(r,"rb_minimized"),t.minimized=!1,t._update_pos(),t._wnd_resize(n[0],n[1],!0),curRBox.active=!1,t.focus(),e&&t.options.onMinimize&&t.options.onMinimize(1)},_min_toggle:function(e){var t=this;setTimeout((function(){t.minimized?t.unminimize(!0):t.minimize(!0)}),50)},destroy:function(){var e=this,t=indexOf(curRBox.focused,e.id);-1!=t&&curRBox.focused.splice(t,1),cleanElems(e.wrap,e.resizeWrap,e.content,e.options.movable,e.options.closer,e.options.hider),re(e.wrap),delete curRBox.tabs[e.id]},_close_mdown:function(e){(e.originalEvent||e).cancelBubble=!0},_close_click:function(e){this.close()},_close:function(e){this.destroy(),curRBox.focused[0]&&!0!==e&&curRBox.tabs[curRBox.focused[0]].focus()},focus:function(e){var t=this,r=curRBox.active!=t.id||!0;return t._focus(),r&&Object(o.isFunction)(t.options.onFocus)&&t.options.onFocus(e),r},close:function(){var e=this,t=e.pos;e._close(),Object(o.isFunction)(e.options.onClose)&&e.options.onClose(t)}}),window.RBox=s;r("zNZe"),r("HEwt"),r("rE2o"),r("ioFf"),r("Vd3H"),r("SRfc"),r("Oyvg"),r("KKXr"),r("pIFo"),r("91GP"),r("rGqo"),r("OEbY"),r("VRzm");var c=r("FWc3"),u=r("4+be"),l=r("uytb"),d=r("rjmT"),_=r("S2bU"),f=r("f01n"),h=r("hOuX"),p=r("BxOC"),g=r("DM26"),m=r("XzvV"),b=r("MhhX"),v=r("P13b"),C=r("vT4u");function y(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function E(){return!curFastChat.version||!curFastChat.tabs}window.curFastChat||(window.curFastChat={}),window.FastChat={init:function(e){var t=this;0!==vk.id&&(extend(curFastChat,{tabs:{},needPeers:{},gotPeers:{},needMedia:{},gotMedia:{},ldb:Object(l.mount)(vk.id),myTypingEvents:{},typingEvents:{},inited:!0,options:e,posSeq:0,error_timeout:1,lpInstance:Notifier.getLpInstance()}),delete curFastChat.standby,delete curFastChat.standbyTO,curFastChat.lpInstance.onData((function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var a=t.getResourcesThatShouldBeLoaded(r),i=a.shouldLoad?t.loadResources(a):Promise.resolve();i.then(()=>{r.forEach(e=>{switch(e.type){case f.TYPING:var r=t.getTab(e.peerId);t.setTyping(e),r&&(t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.blinkTyping(e.peerId);break;case f.ADD_MESSAGE:var n=t.getTab(e.peerId);t.setTyping(e),n&&(t.addMessage(t.prepareMessageData(e)),t.scroll(e.peerId),t.blinkTab(e.peerId),t.updateTypings(),t.waitTyping(e).then(t.updateTypings)),t.updateTabUnreadCounter(n,e);break;case f.EDIT_MESSAGE:case f.REPLACE_MESSAGE:var a=e.peerId,i=e.messageId,o=t.getTab(a);o&&o.msgs[i]&&(delete curFastChat.gotMedia[i],t.editMessage(t.prepareMessageData(e)));break;case f.REPLACE_FLAGS:case f.SET_FLAGS:case f.RESET_FLAGS:e.flags&f.FLAG_DELETED&&t.deleteMessage(t.prepareMessageData(e));break;case f.READ_INBOUND:case f.READ_OUTBOUND:t.markMessagesAsRead(e);break;case f.CHAT_CHANGED:case f.CONVERSATION_UPDATED:var s=t.getTab(e.peerId);t.handleEventChatUpdated(s,e);break;case f.VIDEO_CALL:case f.UNREAD_COUNT:case f.NOTIFY_SETTINGS_CHANGED:case f.EMPTY:case f.RESYNC:case f.REFRESH_LP_KEY:case f.TRANSITION:case f.RESET_PEER:case f.MUTEX:case f.CHANGE_PEER:case f.CHANGE_TAB:case f.FAILED_MESSAGE:case f.RESEND:case f.DELETE_DIALOG:}})})})),Notifier.addRecvClbk("fastchat",0,FastChat.lcRecv,!0),Notifier.addRecvClbk("logged_off",0,FastChat.standby,!0),FastChat.lcSend("needSettings",{version:e.version,lang_id:langConfig.id}),clearTimeout(curFastChat.getSettingsTO),curFastChat.getSettingsTO=setTimeout(FastChat.getSettings,300))},getSettings:function(){var e=ls.get("fcFriends"+vk.id);ajax.post("al_im.php",{act:"a_get_fast_chat",friends:e&&e.version,cache_time:FastChat.cachedStickersKeywordsTime()},{onDone:function(t){-1==t.friends?(t.friends_version=e.version,t.friends=e.list):ls.set("fcFriends"+vk.id,{version:t.friends_version,list:t.friends}),FastChat.gotSettings(t),FastChat.sendSettings()},onFail:function(){return!0}})},cachedStickersKeywordsTime:function(){var e=ls.get("stickers_keywords");return e&&e.time?Math.floor(e.time/1e3):0},gotSettings:function(e){e.emoji_stickers&&(window.emojiStickers=e.emoji_stickers),window.Emoji&&Emoji.updateTabs(),e.autoplay_animations&&window.StickersSettings.setAutoplay(e.autoplay_animations),clearTimeout(curFastChat.getSettingsTO),window.lang=extend(window.lang||{},e.lang),extend(curFastChat,e,{lang_id:langConfig.id}),curFastChat.friendsCnt=Object.keys(curFastChat.friends),setTimeout(FastChat.clistCache.pbind(!1),10),FastChat.initUI()},sendSettings:function(){clearTimeout(curFastChat.sendSettingsTO);var e=["friends","friends_version","onlines","tpl","lang","me","version"].reduce((e,t)=>(e[t]=curFastChat[t],e),{});curFastChat.sendSettingsTO=setTimeout((function(){FastChat.lcSend("settings",{settings:e})}),curNotifier.is_server?0:irand(50,100))},destroy:function(){return!!curFastChat.inited&&(curFastChat.ldb.unmount(),each(curFastChat.tabs||{},(function(e,t){t.box.destroy()})),curFastChat.clistBox&&curFastChat.clistBox.destroy(),each(curFastChat.el||{},(function(){cleanElems(this)})),clearInterval(curFastChat.updateFriendsInt),clearTimeout(curFastChat.correspondentsTO),clearTimeout(curFastChat.lp_error_to),curFastChat={inited:!1},!0)},isChatOpen:function(e){if(window.curFastChat&&curFastChat.inited&&e){var t=curFastChat.tabs,r=curFastChat.clistBox;if(t&&t[e]&&t[e].box.visible||r&&r.visible)return!0}return!1},standby:function(e){FastChat.destroy(),curFastChat.standby=!0;var t=1;!function r(){if(!curNotifier.is_server)return clearTimeout(curFastChat.standbyTO),void(curFastChat.standbyTO=setTimeout(r,1e3*t));ajax.post("notifier.php?act=a_get_reload",{version:e},{onDone:function(e,t){FastChat.lcSend("gotConfig",{navVersion:e,config:t}),FastChat.gotConfig(e,t)},onFail:function(){return t*=2,clearTimeout(curFastChat.standbyTO),curFastChat.standbyTO=setTimeout(r,1e3*t),!0}})}()},gotConfig:function(e,t){clearTimeout(curFastChat.standbyTO),curFastChat.standby&&setTimeout((function(){e>stVersions.nav&&(debugLog("appending al loader"),headNode.appendChild(ce("script",{type:"text/javascript",src:"/js/loader_nav"+e+"_"+vk.lang+".js"}))),setTimeout((function(){e<=stVersions.nav?stManager.add(["notifier.js","notifier.css",jsc("web/emoji.js")],(function(){FastChat.init(t)})):setTimeout(arguments.callee,100)}),0)}),curNotifier.is_server?0:irand(1e3,2e3))},updateVersion:function(e){FastChat.lcSend("standby",{version:e}),FastChat.standby(e)},lcSend:function(e,t){Notifier.lcSend("fastchat",extend({act:e,__id:curFastChat.me&&curFastChat.me.id||vk.id},t))},lcRecv:function(e){if(!isEmpty(e)){var t=e.act;e.__id===(curFastChat.me&&curFastChat.me.id||vk.id)&&(delete e.act,delete e.__id,FastChat.lcFeed(t,e))}},lcFeed:function(e,t){switch(e){case"needSettings":curFastChat.version<t.version||t.lang_id==curFastChat.lang_id&&FastChat.sendSettings();break;case"settings":!curFastChat.version&&curFastChat.options&&t.settings.version==curFastChat.options.version&&FastChat.gotSettings(t.settings),clearTimeout(curFastChat.sendSettingsTO);break;case"standby":E()||FastChat.standby(t.version);break;case"gotConfig":FastChat.gotConfig(t.navVersion,t.config);break;case"clistOnlines":E()||FastChat.clistGotOnlines(t);break;case"needPeer":if(E())break;var r,n=t.id,a=curFastChat.tabs[n],i=!1;if(void 0!==a?(i={name:a.name,photo:a.photo,fname:a.fname,hash:a.hash,sex:a.sex,data:a.data,online:a.online},Object.keys(a.msgs).length>0&&(i.history=[a.log.innerHTML,a.msgs])):(r=curFastChat.friends[n+"_"])&&(i={name:r[0],photo:r[1],fname:r[2],hash:r[3],data:r[4],online:curFastChat.onlines[n]}),!1===i)break;curFastChat.gotPeers[n]=setTimeout((function(){var e={};e[n]=i,FastChat.lcSend("gotPeers",e)}),curNotifier.is_server?0:irand(50,100));break;case"fetchingPeers":if(E())break;each(t,(function(e,t){var r=curFastChat.needPeers[e];r&&(t&r[0])==r[0]&&clearTimeout(r[2])}));break;case"gotPeers":E()||FastChat.gotPeers(t);break;case"stateChange":E()||FastChat.onStateChanged(t);break;case"needMedia":var o=t.msgId,s=curFastChat.gotMedia[o];if(void 0===s||0===s)break;curFastChat.gotMedia[o][3]=setTimeout((function(){FastChat.lcSend("gotMedia",{msgId:o,peer:s[0],text:s[1],msgOpts:s[2]})}),curNotifier.is_server?0:irand(50,100));break;case"fetchingMedia":var c=t.msgId,u=curFastChat.needMedia[c];if(void 0===u||0===curFastChat.gotMedia[c])break;clearTimeout(u[1]),u[1]=setTimeout(FastChat.loadMsgMedia.pbind(u[0],c),1e3);break;case"gotMedia":var l=t.msgId,d=curFastChat.gotMedia[l];isArray(d)&&clearTimeout(d[3]),FastChat.gotMsgMedia(t.peer,l,t.text,t.msgOpts)}},getResourcesThatShouldBeLoaded(e){var t={},r=e.filter(e=>e.type===f.ADD_MESSAGE),n=e.filter(b.isServiceMsg),a=r.filter(e=>!this.isTabLoaded(e.peerId)).map(e=>e.peerId);function i(e,r){var n=FastChat.getTab(e);Object(v.isChatPeer)(e)&&r&&n&&!n.data.members[r]&&(t[e]?-1===t[e].indexOf(r)&&t[e].push(r):t[e]=[r])}return r.forEach(e=>{this.isTabLoaded(e.peerId)&&i(e.peerId,e.userId)}),n.forEach(e=>{i(e.peerId,+e.kludges.source_mid)}),{shouldLoad:Object.keys(t).length>0||a.length>0,needPeers:a,needMembers:t}},loadResources(e){var t=e.needMembers,r=curFastChat.lpInstance;return r.pause(),this.loadMembers(t).then(()=>r.resume())},loadMembers(e){if(0===Object.keys(e).length)return Promise.resolve();var t=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(p.post)(C.CONTROLLER,{act:"a_load_member",need:t}).then(t=>{var r=y(t,1)[0];Object.keys(e).forEach(t=>{var n=this.getTab(t);n&&n.data&&n.data.members&&(n.data.members=e[t].reduce((e,t)=>{var n=r.find(e=>e.id===t);return e[t]=Object.assign({name_inv_case:n.inv_name,name_kick_case:n.kick_name},n),e},n.data.members))})})},handleEventChatUpdated(e,t){switch(t.updateType){case f.MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED:var r=[t.peerId,0].join(",");this.loadPeers(r,e=>{this.updateChatInfo(t.peerId,e)});break;case f.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case f.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_PINNED:case f.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:case f.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case f.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:case f.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:case f.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:case f.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:}},updateChatInfo(e,t){var r=this.getTab(e),n=t[e],a=n.photo,i=n.grid,o=n.name,s=document.querySelector(`#chat_tab_icon_${e} .chat_tab_img`),c=document.createElement(a?"img":"div"),u=r&&r.unread?" ("+r.unread+")":"";r&&r.title&&(r.name=o,r.title.innerHTML=o+u),c.classList.add("chat_tab_img"),i?c.innerHTML=`<div class="chat_tab_grid">${i}</div>`:a&&(c.id="im_dialog_ph"+(e-2e9),c.src=a),s&&s.parentNode.replaceChild(c,s)},blinkEl:function(e,t,r){if(t>10)return r(),!1;t%2==0?animate(e,{opacity:0},400,(function(){FastChat.blinkEl(e,t+1,r)})):animate(e,{opacity:1},400,(function(){setTimeout((function(){FastChat.blinkEl(e,t+1,r)}),400)}))},blinkTyping:function(e){var t=ge("chat_tab_icon_"+e);if(t){var r=geByClass1("chat_tab_typing_wrap",t);fadeIn(r,150,(function(){FastChat.blinkEl(r.firstChild,0,(function(){fadeOut(r,150)}))}))}},imFeed:function(e,t){var r=this.getTab(e);if(!r)return!1;r.auto&&!r.unread&&(r.box._close(!0),delete curFastChat.tabs[e])},tabNotify:function(e,t,r){var n,a=curFastChat.tabs[e];if(e>0&&e<2e9&&Object(o.isFunction)(cur.onPeerStatusChanged)&&cur.onPeerStatusChanged(e,t,r),!(e<=0)&&a&&a.box&&!a.box.minimized){switch(clearTimeout(a.hideNotifyTO),t){case"online":n=Object(u.getLang)("mail_im_user_became_online",3-a.sex),FastChat.blinkTab(e);break;case"offline":n=Object(u.getLang)("mail_im_user_became_offline",3-a.sex),FastChat.blinkTab(e);break;case"unavail":n=Object(u.getLang)("mail_im_not_online",3-a.sex).replace(/\.$/,"")}n=n.replace("{user}",a.fname),val(a.notify,'<div class="fc_tab_notify fc_tab_notify_'+t+'">'+n+"</div>");var i=a.notify.firstChild;clearTimeout(a.hideNotifyTO),a.hideNotifyTO=setTimeout((function(){fadeOut(i,200,(function(){val(a.notify,"")}))}),5e3)}},hideChatCtrl:function(){removeClass(Chat.wrap,"chat_active"),removeEvent(document,"mousedown",FastChat.onDocClick)},showChatCtrl:function(){addClass(Chat.wrap,"chat_active"),setTimeout((function(){addEvent(document,"mousedown",FastChat.onDocClick)}),0)},hideUI:function(){addClass(bodyNode,"chat_onl_hidden")},showUI:function(){removeClass(bodyNode,"chat_onl_hidden")},initUI:function(){if(curFastChat.options){var e=curFastChat.el={},t=getWndInner();re("rb_box_fc_clist"),e.clistWrap=se(curFastChat.tpl.clist),e.clist=geByClass1("fc_contacts",e.clistWrap,"div"),e.clistTitle=geByClass1("fc_tab_title",e.clistWrap,"div"),e.clistOnline=geByClass1("fc_clist_online",e.clistWrap,"div");var r=curFastChat.options.state||!1,n=!curFastChat.friendsCnt||(r&&void 0!==r.clist.min?r.clist.min:t[1]<1200||curFastChat.friendsCnt<5);curFastChat.clistW=270,curFastChat.clistH=299;var a={id:"fc_clist",movable:geByClass1("fc_tab_head",e.clistWrap),hider:geByClass1("fc_tab_close_wrap",e.clistWrap,"a"),startHeight:curFastChat.clistH,startWidth:curFastChat.clistW,resizeableH:e.clist,resize:!1,minH:150,fixed:n,onHide:function(){val("fc_clist_filter",curFastChat.q=""),addClass(curFastChat.clistBox.wrap,"fc_fixed"),curFastChat.clistBox.fixed=!0,FastChat.stateChange({op:"clist_toggled",val:0}),setStyle(curFastChat.clistBox.wrap,{top:"auto",bottom:0,right:72,left:"auto"}),show(e.topLink),FastChat.hideChatCtrl()},onShow:function(){FastChat.showChatCtrl()},onDragEnd:function(e,t){FastChat.stateChange({op:"clist_moved",y:e,x:t})},onResize:function(){curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0)}};r&&!n&&(!1!==r.clist.x&&(-1==r.clist.x?a.startRight=0:a.startLeft=t[1]*r.clist.x),!1!==r.clist.y&&(-1==r.clist.y?a.startBottom=0:a.startTop=t[0]*r.clist.y)),n&&(a.noshow=!0),void 0===a.startTop&&void 0===a.startBottom&&(a.startTop=t[0]<800?0:.1*t[0]),void 0===a.startLeft&&void 0===a.startRight&&(a.startRight=0),curFastChat.clistBox=new RBox(e.clistWrap,a),a.noshow||void 0===a.startLeft&&void 0===a.startTop||curFastChat.clistBox._wnd_resize(t[0],t[1],!0),curFastChat.clistBoxScroll=new Scrollbar(e.clist,{prefix:"fc_",scrollChange:FastChat.clistShowMore,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto"}),curFastChat.updateFriendsInt=setInterval(FastChat.clistUpdate,18e4);var i,o=ge("fc_clist_filter");if(placeholderInit(o,{global:!0}),curFastChat.q="",addEvent(o,"keyup "+(browser.opera?"keypress":"keydown"),(function(e){if(e.keyCode===KEY.ESC)return FastChat.clistHide(),cancelEvent(e);var t=FastChat.clistFilterKey(e);if(void 0!==t)return t;curFastChat.q=trim(val(this)),FastChat.clistRender()})),e.clistOnline)bodyNode.appendChild(i=ce("nobr",{className:"fl_l",innerHTML:Object(u.getLang)("mail_im_clist_onlines")},{visibility:"hidden",position:"absolute"})),re(i),addEvent(e.clistOnline,"mouseover",(function(t){Object(c.showTooltip)(this,{text:Object(u.getLang)("mail_im_clist_onlines"),forcetoup:1,shift:[12,4,3],className:"tt_fc_onlines",init:function(){browser.msie&&(e.clistOnline.tt.isFixed=!1)},black:1})})),addEvent(e.clistOnline,"click",(function(e){(e.originalEvent||e).cancelBubble=!0,FastChat.clistToggleOnlines(),FastChat.clistRender()})),r&&r.clist&&r.clist.onlines&&FastChat.clistToggleOnlines(!0);n?FastChat.clistUpdateTitle():FastChat.clistRender(),curFastChat.ready=!0,r&&r.tabs&&each(r.tabs,(function(e,r){e=intval(e);var n={nofocus:1};this.min&&(n.minimized=!0),this.h&&(n.startHeight=this.h*t[0]),this.w&&(n.startWidth=this.w*t[1]),void 0!==this.x&&this.x<=1&&(this.x<0?n.startRight=0:n.startLeft=t[1]*this.x),void 0!==this.y&&this.y<=1&&(this.y<0?n.startBottom=0:n.startTop=t[0]*this.y),r.fx?(n.fixedLoad=!0,FastChat.prepareTabIcon(e,n,!0)):(n.noAnim=!0,FastChat.addPeer(e,!1,!1,n))})),addEvent(Chat.itemsCont,"mouseover",FastChat.itemsTT),addEvent(Chat.itemsCont,"mouseout",FastChat.itemsOut)}},itemsOffset:12,itemsTT:function(e){for(var t=e.target,r=!1;t&&t!=Chat.itemsCont;){if(hasClass(t,"chat_tab_wrap")){r=t;break}t=t.parentNode}if(!r)return clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,!1;var n=r.id.split("_")[3],a=Chat.tabs[n];return!!a&&(curFastChat.activeBox&&curFastChat.activeBox.visible&&curFastChat.activeBox.options.peer==n?(FastChat.itemsOut(),!1):(clearTimeout(Chat.ttOutTimeout),Chat.ttOutTimeout=!1,Object(c.showTooltip)(r,{text:a.name,slideX:15,black:1,asrtl:1,appendEl:Chat.ttNode,className:"tt_black_side",shift:[-58,-37,0],zIndex:10201}),void(Chat.ttPeer=r)))},itemsOut:function(){if(Chat.ttOutTimeout)return!1;Chat.ttOutTimeout=setTimeout((function(){if(Chat.ttOutTimeout=!1,!Chat.ttPeer)return!1;triggerEvent(Chat.ttPeer,"mouseout"),Chat.ttPeer=!1}),0)},stateChange:function(e){ajax.post("al_im.php",extend({act:"a_state_fc",hash:curFastChat.options.state_hash||""},e),{onFail:function(){return!0}}),FastChat.lcSend("stateChange",e)},onStateChanged:function(e){var t=!!e.peer&&curFastChat.tabs[e.peer],r=e.peer?t&&t.box:curFastChat.clistBox,n=getWndInner();switch(e.op){case"added":if(t){delete t.auto;break}e.fixed?FastChat.prepareTabIcon(e.peer,{fixedLoad:!0}):FastChat.addPeer(e.peer);break;case"unfixed":var a={startHeight:intval(n[0]*e.h),startWidth:intval(n[1]*e.w)};-1==e.y?a.startBottom=0:a.startTop=intval(n[0]*e.y),-1==e.x?a.startRight=0:a.startLeft=intval(n[1]*e.x),FastChat.addPeer(e.peer,!1,!1,a);break;case"closed":if(Chat.tabs[e.peer]&&FastChat.closeTabIcon(e.peer),!t||!r)break;r.close();break;case"hidden":if(!t||!r)break;r.close();break;case"minimized":if(!t||!r)break;e.val?r.unminimize():r.minimize();break;case"moved":setStyle(r.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(n[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(n[1]*e.x):"auto"}),r.toBottom=-1==e.y,r.toRight=-1==e.x;break;case"resized":setStyle(r.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(n[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(n[1]*e.x):"auto"}),r.toBottom=-1==e.y,r.toRight=-1==e.x;var i=intval(n[1]*e.w);setStyle(r.resizeableH,"height",intval(n[0]*e.h)),setStyle(r.resizeableW,"width",i),FastChat.fixResized(t,i);break;case"clist_toggled":e.val?r.show(0,!0):r.hide(0,!0),toggle(curFastChat.el.topLink,!e.val);break;case"clist_moved":setStyle(r.wrap,{bottom:-1==e.y?0:"auto",top:-1!=e.y?intval(n[0]*e.y):"auto",right:-1==e.x?0:"auto",left:-1!=e.x?intval(n[1]*e.x):"auto"}),r.toBottom=-1==e.y,r.toRight=-1==e.x;break;case"onlines_toggled":FastChat.clistToggleOnlines(e.val),FastChat.clistRender()}},onUnidle:function(){curNotifier.version&&curFastChat.clistBox&&(curFastChat.clistBox.visible&&(curFastChat.el.clist.scrollTop<100||curRBox.active!=curFastChat.clistBox.id)?FastChat.clistRender():FastChat.clistUpdateTitle(),each(curFastChat.tabs,(function(e){FastChat.restoreDraft(e)})))},clistUpdate:function(){var e=vkNow();if(curNotifier.is_server&&!(curFastChat.clistUpdatedTs&&e-curFastChat.clistUpdatedTs<6e4)){curFastChat.clistUpdatedTs=e;var t=Object.keys(curFastChat.tabs).concat(Object.keys(Chat.tabs)).join();ajax.post("al_im.php",{act:"a_onlines",peer:t},{onDone:function(e){FastChat.clistGotOnlines(e),FastChat.lcSend("clistOnlines",e)},onFail:()=>!0})}},clistGotOnlines:function(e){var t=curFastChat.onlines,r=[];curFastChat.onlines=e,curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||!curFastChat.tabs&&Chat.tabs||(each(curFastChat.tabs,(function(n){curFastChat.onlines[n]!=t[n]&&(FastChat.tabNotify(n,e[n]?"online":"offline",e[n]),e[n]||(r[n]=1))})),each(Chat.tabs,(function(r){if(curFastChat.onlines[r]!=t[r]){var n=geByClass1("_chat_tab_image",ge("chat_tab_icon_"+r));toggleClass(n,"online",e[r]),toggleClass(n,"mobile",e[r]&&mobPlatforms[e[r]])}})),r=arrayKeyDiff(t,e,r),each(r,(function(e){FastChat.tabNotify(e,"offline")})),FastChat.clistRender())},clistShow:function(){var e=hasClass(Chat.wrap,"chat_active");FastChat.clistRender(),curFastChat.clistBox.visible?curFastChat.clistBox.focus():(curFastChat.activeBox&&curFastChat.activeBox!=curFastChat.clistBox&&curFastChat.activeBox.hide(),curFastChat.clistBox.show(),FastChat.setActive(curFastChat.clistBox),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update(!1,!0),curFastChat.el.topLink&&hide(curFastChat.el.topLink)),elfocus("fc_clist_filter"),FastChat.movePointer(!1,e)},clistHide:function(){curFastChat.clistBox.hide(),curFastChat.activeBox==curFastChat.clistBox&&FastChat.setActive(!1)},clistRender:function(e){var t=[],r=!e,n=1+(e?40:20),a=!1,i=!1,o=!1,s=curFastChat.q;if(s?(o=[],each(FastChat.clistCache(s),(function(){o.push(escapeRE(this))})),o=new RegExp("([ -]|^|s|&nbsp;|\b)("+o.join("|")+")","gi"),a=curFastChat.clistCache[s]||{}):curFastChat.clOnlines&&(a=curFastChat.onlines),curFastChat.clHasMore=!1,each(curFastChat.friends,(function(e){var s=intval(e),c=!a||a[s];if(r){if(c){if(!--n)return curFastChat.clHasMore=!0,!1;t.push(FastChat.clistWrapPeer(s,this,o)),i=s}}else s==curFastChat.clOffset&&(r=!0)})),!1!==i||e||s?s&&!curFastChat.clHasMore&&t.push(FastChat.getCorrespondents(s,o,!1===i)):t.push('<div class="fc_clist_empty">'+Object(u.getLang)(s?"mail_im_clist_notfound":"mail_im_clist_empty")+"</div>"),curFastChat.clOffset=i,e){for(var c=ce("div",{innerHTML:t.join("")}),l=document.createDocumentFragment();c.firstChild;)l.appendChild(c.firstChild);curFastChat.el.clist.appendChild(l),curFastChat.clHasMore||FastChat.clistUpdateTitle(!0)}else val(curFastChat.el.clist,t.join("")),FastChat.clistUpdateTitle(!0),(browser.chrome||browser.safari)&&setTimeout((function(){setStyle(curFastChat.el.clist.firstChild,{width:curFastChat.el.clist.firstChild.clientWidth}),setTimeout((function(){setStyle(curFastChat.el.clist.firstChild,{width:""})}),0)}),0);if(curFastChat.clSel){var d=ge("fc_contact"+curFastChat.clSel);d?FastChat.clistPeerOver(d,1):curFastChat.clSel=!1}else{var _=geByClass1("fc_contact",curFastChat.el.clist);FastChat.clistPeerOver(_,1)}curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()},clistWrapPeer:function(e,t,r){var n,a,i=curFastChat.tabs[e]?curFastChat.tabs[e].unread:0,o=curFastChat.onlines[e],s=onlinePlatformClass(o),c=(t[0]||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return r&&(c=c.replace(r,'$1<em class="fc_clist_hl">$2</em>')),e>0&&e<2e9?(n="/id"+e,a='onmousemove="FastChat.clistPeerOver(this.parentNode, 2);"  onmouseout="FastChat.clistPeerOver(this.parentNode, 1);"'):(n="/im?sel="+e,a=""),'<a href="'+n+'" class="fc_contact clear_fix" id="fc_contact'+e+'" onclick="return FastChat.selectPeer('+e+', event, { entrypoint: \'fastchat_search\' });" onmousedown="event.cancelBubble = true;" onmouseover="FastChat.clistPeerOver(this, 1, event);"  onmouseout="FastChat.clistPeerOver(this, 0, event);"><span class="fc_contact_photo'+s+'" '+a+">"+(e>2e9&&t[3]?t[3]:'<img src="'+Notifier.fixPhoto(t[1])+'" class="fc_contact_photo"/>')+'</span><span class="fc_contact_status"></span><span class="fc_contact_name">'+c+'<span id="fc_contact_unread'+e+'" class="fc_contact_unread">'+(i?" <b>+"+i+"</b>":"")+"</span></span></a>"},clistPeerOver:function(e,t,r){if(e&&checkOver(r,e)){var n=e.id.substr(10);curFastChat.clSel&&t&&curFastChat.clSel!=n&&FastChat.clistPeerOver(ge("fc_contact"+curFastChat.clSel),0),toggleClass(e,"fc_contact_over",t),t?curFastChat.clSel=n:curFastChat.clSel==n&&(curFastChat.clSel=!1)}},authorOver:function(e){var t=gpeByClass("fc_tab_log",e),r=e.getBoundingClientRect().top,n=t.getBoundingClientRect().top,a=e.getAttribute("data-title"),i=!1;if(r-n<10&&(i=!0),a){var o=e.getAttribute("data-date");o&&(a+="<br>"+o);var s=gpeByClass("rb_box_wrap",e).querySelector(".tt-fastchat-wrap");Object(c.showTooltip)(e,{text:'<div class="fc_author_tt">'+a+"</div>",black:1,center:1,forcetodown:i,appendEl:s,shift:[1,8,0]})}},getCorrespondents:function(e,t,r){return clearTimeout(curFastChat.correspondentsTO),curFastChat.correspondents&&void 0!==curFastChat.correspondents[e]?FastChat.wrapCorrespondents(curFastChat.correspondents[e])||r&&'<div class="fc_clist_empty">'+Object(u.getLang)("mail_im_clist_notfound")+"</div>"||"":(curFastChat.correspondentsTO=setTimeout(FastChat.loadCorrespondents.pbind(e,t),100),'<div id="fc_correspondents"></div>')},loadCorrespondents:function(e,t){e==curFastChat.q&&ajax.post("hints.php",{act:"a_json_friends",str:e,from:"fc",allow_multi:1},{onDone:function(r){curFastChat.correspondents||(curFastChat.correspondents={});var n,a={};if(each(r,(function(){n=this[3]+"_",curFastChat.friends[n]||(a[n]=[this[1],this[2],this[3],this[4]||""])})),curFastChat.correspondents[e]=a,e==curFastChat.q){var i=ge("fc_correspondents");if(i){var o=i.parentNode,s=ce("div",{innerHTML:FastChat.wrapCorrespondents(a,t)}),c=document.createDocumentFragment();if(s.firstChild)for(;s.firstChild;)c.appendChild(s.firstChild);else o.firstChild==i&&c.appendChild(ce("div",{className:"fc_clist_empty",innerHTML:Object(u.getLang)("mail_im_clist_notfound")}));o.replaceChild(c,i),FastChat.clistUpdateTitle(!0),curFastChat.clistBoxScroll&&curFastChat.clistBoxScroll.update()}}}})},wrapCorrespondents:function(e,t){var r=[];return each(e,(function(e){r.push(FastChat.clistWrapPeer(intval(e),this,t))})),r.join("")},updateFriends:function(e){if(window.Chat&&Chat.inited){var t=Chat.onl;t&&(e>0?(val(t,e),show(Chat.wrap)):hide(Chat.wrap))}},onDocClick:function(e){if(curFastChat.activeBox){var t=e.target;if(curBox())return!0;for(;t;){if("fc_tab_wrap"==t.className||-1!==["chat_onl_wrap","custom_menu_cont","layer_wrap","box_layer_wrap","wk_layer_wrap"].indexOf(t.id))return!0;t=t.parentNode}var r=curFastChat.tabs[curFastChat.activeBox.options.peer];if(r&&(trim(Emoji.editableVal(r.txt))||r.imMedia&&r.imMedia.getMedias().length))return!0;curFastChat.activeBox.hide()}},clistCache:function(e){if(e){var t,r,n,a,i,o,s=[e];if((r=Object(u.parseLatin)(e))&&s.push(r),(r=Object(u.parseLatKeys)(e))&&s.push(r),(r=Object(u.parseCyr)(e))&&s.push(r),void 0!==curFastChat.clistCache[e])return s;for(var c in o=curFastChat.clistCache[e]={},s)if(s.hasOwnProperty(c)&&(t=s[c],n=curFastChat.clistCache[" "+t.charAt(0).toLowerCase()]))for(var l in a=new RegExp("(^|\\s|\\()"+escapeRE(t),"gi"),n)if(n.hasOwnProperty(l)){if(i=curFastChat.friends[l+"_"],!isArray(i))continue;null!==i[0].match(a)&&(o[l]=1)}return o._num=Object.keys(o).length,s}var d,_,f;for(var h in curFastChat.clistCache={},curFastChat.friends)if(curFastChat.friends.hasOwnProperty(h))for(d=curFastChat.friends[h][0],h=intval(h),_=0;f=" "+d.charAt(_).toLowerCase(),curFastChat.clistCache[f]||(curFastChat.clistCache[f]={}),curFastChat.clistCache[f][h]=1,-1!==(_=d.indexOf(" ",_+1));)++_},clistShowMore:function(){if(curFastChat.clHasMore){var e=curFastChat.el.clist;e.scrollTop+3*e.clientHeight>e.scrollHeight&&FastChat.clistRender(!0)}},clistUpdateTitle:function(e){var t=0,r=0;for(var n in curFastChat.friends)curFastChat.onlines[intval(n)]?(r++,t++):curFastChat.clOnlines||t++;var a=window.newVal=(r?Object(u.getLang)("mail_im_X_onlines_title",r):Object(u.getLang)("mail_im_onlines_title")).toString();FastChat.updateFriends(r),val(curFastChat.el.clistTitle,a),val(curFastChat.el.topLink,a.toLowerCase()),curFastChat.clistBoxScroll&&(!curFastChat.clHasMore&&e?t=curFastChat.el.clist.childNodes.length:curFastChat.q&&(t=intval((curFastChat.clistCache[curFastChat.q]||{})._num)),curFastChat.clistBoxScroll.options.contHeight=50*t)},clistToggleOnlines:function(e){void 0===e&&(e=!curFastChat.clOnlines,FastChat.stateChange({op:"onlines_toggled",val:e?1:0})),toggleClass(curFastChat.el.clistOnline,"fc_clist_online_active",e),curFastChat.clOnlines=e},clistFilterKey:function(e){var t;switch(e.keyCode){case KEY.DOWN:case KEY.UP:if("keyup"!==e.type){var r;if(t=curFastChat.clSel&&ge("fc_contact"+curFastChat.clSel)){var n=e.keyCode===KEY.DOWN?"nextSibling":"previousSibling";r=t;do{r=r[n]}while(r&&(1!==r.nodeType||!hasClass(r,"fc_contact")))}else curFastChat.clSel||e.keyCode!==KEY.DOWN||(r=geByClass1("fc_contact",curFastChat.el.clist,"a"));if(r&&r!==t){FastChat.clistPeerOver(r,1);var a=curFastChat.el.clist;r.offsetTop+16>a.clientHeight+a.scrollTop?(a.scrollTop=r.offsetTop+16-a.clientHeight,curFastChat.clistBoxScroll.update()):r.offsetTop-36<a.scrollTop&&(a.scrollTop=r.offsetTop-36,curFastChat.clistBoxScroll.update())}}break;case KEY.LEFT:case KEY.RIGHT:return!0;case KEY.ENTER:if("keyup"==e.type||!(t=curFastChat.clSel&&ge("fc_contact"+curFastChat.clSel)))break;e.ctrlKey||e.metaKey&&browser.mac?nav.go(t.href.match(/\b(vkontakte\.ru|vk\.com)(\/[^\/]+?)$/)[2]):FastChat.selectPeer(curFastChat.clSel);case KEY.ESC:if("keyup"!=e.type){var i=ge("fc_clist_filter"),o=val(i)||curFastChat.clSel;i.blur(),val(i,curFastChat.q=""),curFastChat.clSel=!1,o&&FastChat.clistRender()}break;default:return}return cancelEvent(e)},prepareTabIcon:function(e,t,r){var n=curFastChat.friends&&curFastChat.friends[e+"_"];if(n){var a={name:n[0],photo:n[1],online:curFastChat.onlines[e]};FastChat.addTabIcon(e,a,r)}else{curFastChat.needPeers[e]=[3,!1,setTimeout(FastChat.getPeers,irand(150,200)),t]}},addTabIcon:function(e,t,r){if(Chat.itemsCont&&!Chat.tabs[e]){var n=e>2e9,a=n?t.data.members_grid_fc||"":`<img class="chat_tab_img" src="${t.photo}"/>`,i=n?"im?sel=c"+(e-2e9):t.alink||"/id"+e,o=onlinePlatformClass(t.online),s=se('<a class="chat_tab_wrap'+(r?"":" chat_tab_beforeanim")+'" id="chat_tab_icon_'+e+'" href="'+i+'" onclick="FastChat.itemsOut();return FastChat.togglePeer('+e+', event);"><div class="chat_tab_imgcont _chat_tab_image'+o+'"><div class="chat_tab_close" onclick="return FastChat.closeTabIcon('+e+', event)"></div>'+a+'</div><div class="chat_tab_typing_wrap"><div class="chats_sp chat_tab_typing_icon"></div></div><div class="chat_tab_counter"></div></a>');Chat.itemsCont.insertBefore(s,Chat.itemsCont.firstChild),Chat.tabs[e]={el:s,name:t.name},addClass(Chat.wrap,"chat_expand"),r||removeClass(s,"chat_tab_beforeanim"),FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=0}},checkChatHeight:function(){var e=getSize(Chat.itemsCont)[1];function t(){addEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap)}function r(){removeEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap)}Chat.lastHeight=e,e>Chat.maxHeight?(Chat.fixH||(Chat.fixH=!0,addClass(Chat.scrollNode,"chat_fix_height"),setStyle(Chat.scrollNode,{height:Chat.maxHeight}),addEvent(Chat.scrollNode,"mouseenter",t),addEvent(Chat.scrollNode,"mouseleave",r),FastChat.checkShadow()),Chat.scrollNode.scrollTop=e-Chat.maxHeight):Chat.fixH&&(Chat.fixH=!1,removeClass(Chat.scrollNode,"chat_fix_height"),setStyle(Chat.scrollNode,{height:"auto"}),removeEvent(Chat.scrollNode,browserFeatures.wheelEvent,FastChat.scrollWrap),removeEvent(Chat.scrollNode,"mouseenter",t),removeEvent(Chat.scrollNode,"mouseleave",r),FastChat.checkShadow())},checkShadow:function(){var e=intval(Chat.scrollNode.scrollTop);e&&Chat.fixH?Chat.shadowTop||(addClass(Chat.wrap,"chat_scroll_top"),fadeIn(geByClass1("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!0):Chat.shadowTop&&(fadeOut(geByClass1("chat_cont_sh_top",Chat.wrap),200),Chat.shadowTop=!1),Chat.lastHeight-e>Chat.maxHeight&&Chat.fixH?Chat.shadowBottom||(fadeIn(geByClass1("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!0):Chat.shadowBottom&&(fadeOut(geByClass1("chat_cont_sh_bottom",Chat.wrap),200),Chat.shadowBottom=!1)},scrollWrap:function(e){e||(e=window.event);var t=0;return e.wheelDeltaY||e.wheelDelta?t=(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&(t=10*-e.detail),Chat.scrollNode.scrollTop-=t,curFastChat.activeBox==curFastChat.clistBox?(curFastChat.pointerMargin=0,FastChat.setPointer(!1,curFastChat.pointerMargin,curFastChat.prevPointer)):(curFastChat.pointerMargin=-Chat.scrollNode.scrollTop,FastChat.setPointer(!0,curFastChat.pointerMargin,curFastChat.prevPointer)),FastChat.checkShadow(),setStyle(Chat.ttNode,{top:-Chat.scrollNode.scrollTop}),cancelEvent(e)},togglePeer:function(e,t){return curFastChat.activeBox&&curFastChat.activeBox.options.peer==e?(curFastChat.activeBox.hide(),FastChat.setActive(!1),!1):FastChat.selectPeer(e,t,{entrypoint:"fastchat_icon"})},selectPeer:function(e,t,r){if(checkEvent(t))return!0;var n=hasClass(Chat.wrap,"chat_active");if(curFastChat.tabs&&curFastChat.tabs[e]){var a=curFastChat.tabs[e].box;a.minimized&&a.unminimize(!0),FastChat.activateTab(e),FastChat.movePointer(e,n)}else r||(r={}),r.fixed=!0,r.onPeerAdded=function(){FastChat.movePointer(e,n)},r.onHistoryLoaded=FastChat.readLastMessages.pbind(e),FastChat.addPeer(e,!1,!0,r);return curFastChat.tabs[e]&&curFastChat.tabs[e].iman&&(curFastChat.tabs[e].entrypoint=r&&r.entrypoint,curFastChat.tabs[e].iman.unidle()),FastChat.trackActivity("open"),!1},closeTabIcon:function(e,t,r){curFastChat.activeBox&&curFastChat.activeBox.options.peer==e&&!r&&(curFastChat.activeBox.hide(),FastChat.setActive(!1));var n=ge("chat_tab_icon_"+e);addClass(n,"chat_tab_hiding"),delete Chat.tabs[e],curFastChat.tabs[e]&&curFastChat.tabs[e].box.options.fixed&&(curFastChat.tabs[e].iman.stop(),delete curFastChat.tabs[e]);return animate(n,{height:0,opacity:0},{duration:100,onComplete:function(){re(n),n&&(n=!1,curFastChat.activeBox&&FastChat.movePointer(curFastChat.activeBox.options.peer,!0));var e=Chat.scrollNode.scrollTop;FastChat.checkChatHeight(),Chat.scrollNode.scrollTop=e}}),r||FastChat.stateChange({op:"closed",peer:e}),Object.keys(Chat.tabs).length||removeClass(Chat.wrap,"chat_expand"),FastChat.itemsOut(),cancelEvent(t)},getPointerShift:function(e,t,r){var n=r-t,a=Chat.maxHeight+32;return e&&n<62?n-62:e&&n>a?n-a:0},setPointer:function(e,t,r){if(!curFastChat.activeBox)return!1;var n=FastChat.getPointerShift(e,t,r),a=geByClass1("fc_tab_pointer",curFastChat.activeBox.wrap);return setStyle(a,{marginTop:t+n}),n},movePointer:function(e,t){if(!curFastChat.activeBox)return!1;var r,n,a=geByClass1("fc_pointer_offset",curFastChat.activeBox.wrap);if(e){var i,o=ge("chat_tab_icon_"+e);if(!o)return!1;i=!Chat.fixH&&o.nextSibling?getXY(o.nextSibling)[1]-50:o.nextSibling||Chat.fixH?getXY(o)[1]+Chat.scrollNode.scrollTop:getXY(ge("chat_tab_wrap"))[1]-50,r=23+getXY(Chat.cont)[1]-i,n=-Chat.scrollNode.scrollTop}else r=28,n=0;var s=FastChat.setPointer(e,n,r);if(t){if(curFastChat.prevPointer){var c=FastChat.getPointerShift(!0,n+s,curFastChat.prevPointer);setStyle(a,{bottom:curFastChat.prevPointer-c+s})}animate(a,{bottom:r},{duration:100})}else setStyle(a,{bottom:r});curFastChat.prevPointer=r},setActive:function(e){curFastChat.activeBox=e,e&&FastChat.moveBoxesLeft(e.pos[1])},moveBoxesLeft:function(e,t){e-=8;var r=!1,n=0;for(var a in curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(a)){var i=curFastChat.tabs[a];if(t||(i.box.movedLeft=!1),!i||i.box.options.fixed||!i.box.toBottom||i.box.movedLeft||i.box.noMove)continue;var o=i.box.pos;o[1]+o[3]>=e&&o[1]>n&&(r=i,n=o[1])}if(r){var s=e-r.box.pos[3],c=r.box.pos[0];s<0&&(s=0),r.box.movedLeft=!0,animate(r.box.wrap,{left:s},200),r.box.pos=[c,s,r.box.pos[2],r.box.pos[3]];var u=getWndInner();FastChat.stateChange({op:"moved",peer:r.box.options.peer,y:c/u[0],x:s/u[1]}),s&&FastChat.moveBoxesLeft(s,!0)}else FastChat.moveLeftY=0},moveBoxAway:function(e,t){for(var r=e.pos[3],n=t-e.pos[3]-20,a=e.pos[0],i=!1;n>0&&!i;)for(var o in i=!0,curFastChat.tabs)if(curFastChat.tabs.hasOwnProperty(o)){var s=curFastChat.tabs[o].box.pos;s[0]+s[2]/2>a&&s[1]+s[3]>n&&s[1]<n+r&&(n-=s[3],i=!1)}n<0&&(n=positive(Math.random()*t)),animate(e.wrap,{left:n},300);var c=getWndInner();FastChat.stateChange({op:"moved",peer:e.options.peer,y:a/c[0],x:n/c[1]})},pinTab:function(e,t,r){var n=-1==e?curFastChat.clistBox:curFastChat.tabs[e].box;n.options.fixed=!1,removeClass(n.wrap,"fc_fixed"),FastChat.hideChatCtrl(),FastChat.setActive(!1);var a=n.wrap.offsetTop,i=n.wrap.offsetLeft-10;setStyle(n.wrap,{left:n.wrap.offsetLeft,top:n.wrap.offsetTop,right:"auto",bottom:"auto"}),r||animate(n.wrap,{left:i,top:a},300),n.pos=[a,i,n.pos[2],n.pos[3]],n.toRight=!1,n.toBottom=!0,addClass(n.wrap,"fc_tobottom");var o=n.resizeableW.clientWidth-intval(getStyle(n.resizeableW,"paddingRight"))-intval(getStyle(n.resizeableW,"paddingLeft")),s=n.resizeableH.clientHeight-intval(getStyle(n.resizeableH,"paddingBottom"))-intval(getStyle(n.resizeableH,"paddingTop")),c=getWndInner();-1==e?FastChat.stateChange({op:"clist_toggled",val:1,y:n.toBottom?-1:n.pos[0]/c[0],x:n.toRight?-1:n.pos[1]/c[1]}):FastChat.stateChange({op:"unfixed",peer:e,y:n.toBottom?-1:n.pos[0]/c[0],x:n.toRight?-1:n.pos[1]/c[1],h:s/c[0],w:o/c[1]}),n.noMove=!0,FastChat.moveBoxesLeft(i),n.noMove=!1},addPeer:function(e,t,r,n){n||(n={});var a=curFastChat.friends&&curFastChat.friends[e+"_"],i=0;if(r?FastChat.stateChange({op:"added",peer:e,fixed:n.fixed}):curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&t&&(r=!0),a){var o={name:a[0],photo:a[1],fname:a[2],hash:a[3],online:curFastChat.onlines[e],sex:a[4]};FastChat.addTabIcon(e,o,n.noAnim),FastChat.addBox(e,o,n),t?(curFastChat.tabs[e].auto=1,FastChat.imFeed(e,t)):(n&&n.nofocus||FastChat.activateTab(e),curFastChat.onlines[e]||FastChat.tabNotify(e,"unavail"),i|=2)}else i=3;i&&(r?(curFastChat.needPeers[e]=[i,t,!1,n],FastChat.getPeers()):(curFastChat.needPeers[e]=[i,t,setTimeout(FastChat.getPeers,irand(150,200)),n],FastChat.lcSend("needPeer",{id:e,mask:i})))},getPeers(){var e=[],t={};Object.keys(curFastChat.needPeers||{}).forEach(r=>{var n=y(curFastChat.needPeers[r],3),a=n[0],i=n[2];e.push(r,a),i&&clearTimeout(i),t[r]=a}),e.length&&(FastChat.lcSend("fetchingPeers",t),FastChat.loadPeers(e.join(","),(function(e){FastChat.gotPeers(e),FastChat.lcSend("gotPeers",e)})))},gotPeers:function(e){E()||each(curFastChat.needPeers,(function(t){if(e[t]){e[t]<2e9&&(curFastChat.friends[t+"_"]=[e[t].name,e[t].photo,e[t].fname,e[t].hash,intval(e[t].sex)]);var r=this[1],n=this[3];2&this[0]&&void 0===e[t].history||(clearTimeout(this[2]),delete curFastChat.needPeers[t]),curFastChat.tabs[t]?FastChat.gotHistory(t,e[t].history):n.fixedLoad?FastChat.addTabIcon(t,e[t]):(FastChat.addTabIcon(t,e[t]),FastChat.addBox(t,e[t],n),r?(curFastChat.tabs[t].auto=1,FastChat.imFeed(t,r)):(2&this[0]&&FastChat.gotHistory(t,e[t].history),n&&n.nofocus||FastChat.activateTab(t))),n.onHistoryLoaded&&n.onHistoryLoaded()}}))},gotHistory:function(e,t){if(isArray(t)&&t.length&&t[0]){var r=curFastChat.tabs[e],n=t[0],a=t[1];r.offset=t[2],extend(r.msgs,a),each(a,(function(e,t){!t[0]&&t[1]&&r.unread++})),val(r.log,n),r.logWrap.scrollTop=r.logWrap.scrollHeight,setTimeout((function(){r.logWrap.scrollTop=r.logWrap.scrollHeight,r.scroll&&r.scroll.update(!1,!0)}),10)}},decHashCb:function(e){var t;t=e,curFastChat.decodedHashes[t]=function(e){for(var t=ge?"":"___",r=0;r<e.length;++r)t+=e.charAt(e.length-r-1);return geByClass?t:"___"}(t.substr(t.length-5)+t.substr(4,t.length-12))},decodehash:function(e){return curFastChat.decodedHashes||(curFastChat.decodedHashes={}),curFastChat.decodedHashes[e]||FastChat.decHashCb(e),curFastChat.decodedHashes[e]},loadPeers(e,t){ajax.post("al_im.php",{act:"a_get_fc_peers",peers:e},{onDone:t})},sendTyping:function(e){var t=intval(e),r=this.getTab(t),n=Date.now();t<=-2e9||!r||curFastChat.myTypingEvents[t]&&n-curFastChat.myTypingEvents[t]<5e3||(curFastChat.myTypingEvents[t]=n,ajax.post("al_im.php",{act:"a_activity",type:"typing",peer:t,hash:r.sendhash,from:"fc"}))},setTyping(e){var t=this.getTab(e.peerId),r=e.type===f.ADD_MESSAGE;if(t&&t.typing&&r){var n=t.typing.userIds.filter((t,r)=>t!==e.userId);0===n.length?delete t.typing:t.typing=Object.assign(t.typing,{userIds:n})}else t&&!r&&(e.ts=Date.now()/1e3,t.typing=Object.assign(e,{userIds:(e.userIds||[]).filter((e,t)=>e!==vk.id)}))},waitTyping(e){return Object(g.pause)(C.ACTIVITY_PERIOD+2).then(()=>{var t=this.getTab(e.peerId);t&&t.typing&&(Date.now()-1e3*t.typing.ts>=1e3*C.ACTIVITY_PERIOD&&delete t.typing)})},updateTypings(){var e=curFastChat.tabs||{};Object.keys(e).forEach(e=>{FastChat.updateTyping(e)})},updateTyping(e,t){var r=this.getTab(e),n=ge("fc_tab_typing"+e),a=geByClass1("_fc_tab_typing_progress",n),i=geByClass1("_fc_tab_typing_name",n);if(r.typing&&r.typing.userIds.length>0){var o=this.formatTyping(r.typing);val(i,o),show(a)}else val(i,""),hide(a);t?setStyle(n,"opacity",1):fadeTo(n,200,1)},formatTyping(e){var t=e.peerId,r=e.userIds,n=this.getTab(t),a=r[0],i=Object(v.isChatPeer)(t)?n.data.members[a]:n,o=e=>e.fname||e.name||"";if(1===r.length||!Object(v.isChatPeer)(t))return langSex(i.sex,Object(u.getLang)("mail_im_typing")).replace("{user}",o(i));var s=r[r.length-1],c=Object(v.isChatPeer)(t)?n.data.members[s]:n;return Object(u.getLang)("mail_im_multi_typing").replace("{users}",o(i)).replace("{last_user}",o(c))},markMessagesAsRead(e){var t=e.type,r=e.peerId,n=e.upToId,a=e.unread,i=this.getTab(r);i&&(t===f.READ_INBOUND&&(i.inUpTo=n),t===f.READ_OUTBOUND&&(i.outUpTo=n),i.unread=a,this.updateUnreadMessagesInTab(r,n,t===f.READ_OUTBOUND)),this.updateTabUnreadCounterElement(i||{unread:0},r)},updateUnreadMessagesInTab(e,t,r){var n=this.getTab(e),a=r?".fc_msgs_unread.fc_msgs_out":".fc_msgs_unread:not(.fc_msgs_out)";if(n&&n.log){var i=n.log.querySelectorAll(a);Array.prototype.forEach.call(i,e=>{+e.getAttribute("data-message-id")<=t&&e.classList.remove("fc_msgs_unread")})}},readLastMessages(e){var t=FastChat.getTab(e);if(e&&t){if(!t.markingRead&&t.unread){var r=[];for(var n in t.msgs)!t.msgs[n][0]&&t.msgs[n][1]&&r.push(n);r.length>0&&FastChat.markRead(e,r)}t.unread=0,FastChat.updateTabUnreadCounterElement(t,e)}},markRead:function(e,t){var r=this.getTab(e);r.markingRead=!0,ajax.post("al_im.php",{act:"a_mark_read",peer:e,ids:t,hash:r.sendhash,from:"fc"},{onDone:function(n){for(var a in r.markingRead=!1,t){if(t.hasOwnProperty(a))if("continue"===function(){var e=t[a],n=ge("fc_msg"+e),i=n&&n.parentNode;if(!n)return"continue";r.msgs[e]&&r.msgs[e][1]&&(r.msgs[e][1]=0,r.msgs[e][0]||r.unread--),removeClass(n,"fc_msg_unread"),hasClass(i.parentNode,"fc_msgs_unread")&&each(i.childNodes,(function(){if(!hasClass(this,"fc_msg_unread"))return removeClass(i.parentNode,"fc_msgs_unread"),!1}))}())continue}r.unread=0,FastChat.updateTabUnreadCounterElement(r,e)},onFail:function(){r.markingRead=!1}})},getMessageText(e,t){var r=e||"",n=Math.round(1e9*Math.random()).toString(16),a={},i=0;return r=(r=Object(_.replaceHyperLinks)(r,_.linksReplacer.bind(null,!1))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${i}_${n}!`;return a[t]=e,i++,t}),r=Object(_.replaceMentions)(r),r=Object(_.replaceEmailLinks)(r),r=Object(_.replaceHashtags)(r,e=>`<a href="/im?sel=${t}&st=${encodeURIComponent(e)}">${e}</a>`),Object.keys(a).forEach(e=>{r=r.replace(e,a[e])}),r=Emoji.emojiToHTML(r,1)},getEditCont:function(e){return stManager.add([jsc("web/emoji.js")]),'<div class="emoji_cont _emoji_field_wrap">'+Emoji.tplSmile(Object(u.getLang)("mail_emoji_hint"))+'<div class="fc_editable dark" tabindex="0" contenteditable="true" placeholder="'+Object(u.getLang)("mail_chat_placeholder")+'"></div></div>'},getInputValue:function(e){return Emoji?Emoji.editableVal(e):""},onTxtResize:function(e){var t=curFastChat.tabs[e],r=geByClass1("fc_tab_txt",t.wrap),n=getSize(r)[1];if(n>40){var a=positive(n-40),i=intval(getSize(t.box.resizeableH)[1]);i+t.hDiff-a<40&&(a=i+t.hDiff-40),setStyle(t.box.resizeableH,{height:i+(t.hDiff||0)-a}),t.hDiff=a,FastChat.fixResized(t,t.wrap.clientWidth,!0)}else if(t.hDiff){var o=intval(getSize(t.box.resizeableH)[1]);setStyle(t.box.resizeableH,{height:o+t.hDiff}),t.hDiff=0,FastChat.fixResized(t,t.wrap.clientWidth,!0)}},initTab:function(e,t,r){var n=geByClass1("fc_editable",r),a=curFastChat.tabs[e]={name:t.name,fname:t.fname,photo:t.photo,link:t.alink||"/id"+e,hash:t.hash,sendhash:FastChat.decodehash(t.hash),sex:t.sex||0,data:t.data||{},online:t.online,msgs:{},msgscount:0,unread:0,box:!1,wrap:r,editable:1,txt:n,txtWrap:n.parentNode.parentNode,logWrap:geByClass1("fc_tab_log",r),log:geByClass1("fc_tab_log_msgs",r),notify:geByClass1("fc_tab_notify_wrap",r),title:geByClass1("fc_tab_title",r)},i=30;if(a.addMediaBtn=geByClass1("fc_tab_attach",r),a.editable)cur.t=a,a.emojiId=Emoji.init(a.txt,{controlsCont:geByClass1("fc_tab_txt_wrap",r),ttDiff:-46,ttShift:0,rPointer:!0,global:!0,noRce:!0,peer:e,isChat:!0,noCtrlSend:!0,ref:"fast_chat",onSend:FastChat.send.pbind(e),checkEditable:FastChat.checkEditable,onResize:function(){FastChat.onTxtResize(e)},addMediaBtn:a.addMediaBtn,onShow:function(){cssAnim(a.scroll.scrollbar,{opacity:0},{duration:400})},onHide:function(){cssAnim(a.scroll.scrollbar,{opacity:1},{duration:400})},onEsc:function(e){return a.box.hide(),cancelEvent(e)},onStickerSend:function(t,r){FastChat.send(e,t,r)}});else{autosizeSetup(a.txt,{minHeight:15,maxHeight:42}),a.txt.autosize.options.onResize=function(e){if(!a.box.minimized){var t=42==e?42:15;t!=e&&setStyle(a.txt,"height",t),t!=i&&(setStyle(a.logWrap,"height",a.logWrap.clientHeight-t+i),i=t,a.scroll&&a.scroll.update(!1,!0))}}}return a.imPeerMedias={},a.imSortedMedias={},a.previewEl=geByClass1("fc_tab_preview",r),stManager.add(["page.js","page.css",jsc("web/ui_media_selector.js"),"ui_media_selector.css"],(function(){var t=[["photo",Object(u.getLang)("profile_wall_photo")],["video",Object(u.getLang)("profile_wall_video")],["audio",Object(u.getLang)("profile_wall_audio")],["doc",Object(u.getLang)("profile_wall_doc")],["map",Object(u.getLang)("profile_wall_map")]];a.imMedia=new MediaSelector(a.addMediaBtn,a.previewEl,t,{limit:10,hideAfterCount:0,maxShown:0,mail:1,tooltip:1,topOffset:0,forceUp:1,global:1,toId:vk.id}),a.imMedia.onChange=setTimeout.pbind((function(){if(curFastChat.sendOnUpload)FastChat.send(curFastChat.sendOnUpload),curFastChat.sendOnUpload=void 0;else{var t=Object(d.loadDraftForPeer)(curFastChat.ldb,e);t.removeAllAttaches(),a.imMedia.getMedias().forEach(e=>t.addAttach(e[0],e[1])),t.destroy()}FastChat.onTxtResize(e)}),0)})),a},addBox:function(e,t,r){if(void 0===curFastChat.tabs[e]){var i=FastChat.getEditCont(Emoji.last);r=r||{},curFastChat.tabs[e]={};var o=se(rs(FastChat.tplBox,{id:e,name:t.name,myphoto:Notifier.fixPhoto(curFastChat.me.photo,!0),cont:i}));r.fixed&&curFastChat.activeBox&&curFastChat.activeBox.hide(0,!1,{noState:!0});var s=FastChat.initTab(e,t,o),c=getWndInner(),u={id:"fc_peer"+e,marginFixedToLayer:!0,peer:e,movable:geByClass1("fc_tab_head",o),closer:geByClass1("fc_tab_close_wrap",o,"a"),resizeableH:s.logWrap,startHeight:250,startWidth:270,fixed:r.fixed,minH:150,minW:270,nofocus:!0,onFocus:function(t){s.auto&&(FastChat.stateChange({op:"added",peer:e}),delete s.auto),FastChat.restoreDraft(e),s.editable?Emoji.editableFocus(s.txt,!1,!0):elfocus(s.txt),s.wrap.clientWidth&&setStyle(s.title,{maxWidth:s.wrap.clientWidth-71}),s.editable||setStyle(s.txt.autosize.helper,{width:getStyle(s.txt,"width",!1)}),s.scroll&&s.scroll.update(!1,!0),setTimeout(elfocus.pbind(s.txt),10)},onHide:function(){r.fixed&&FastChat.hideChatCtrl(),curFastChat.activeBox&&e==curFastChat.activeBox.options.peer&&FastChat.setActive(!1)},onClose:function(t){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),this.onHide(),r&&r.beforeClose&&r.beforeClose();var n=curFastChat.tabs,a=n[e].posSeq;if(delete n[e],curNotifier.isIdle||FastChat.stateChange({op:"hidden",peer:e}),a){var i,o,s,c,u,l={},d=[];for(each(n,(function(){this.posSeq>a&&(l[this.posSeq]=this,d.push(this.posSeq))})),d.unshift(a),d.sort(),u=!browser.msie&&d.length<10,i=1;i<d.length;i++)o=d[i],s=l[o].box,c=i>1?l[d[i-1]].box.pos:t,u?animate(s.wrap,{left:c[1]},100,function(e){e._update_pos()}.pbind(s)):setStyle(s.wrap,{left:c[1]});if(!u)for(i=1;i<d.length;i++)(s=l[d[i]].box)._update_pos()}},onMinimize:function(t){FastChat.stateChange({op:"minimized",peer:e,val:t}),FastChat.fixResized(s,s.wrap.clientWidth,!0),t||(s.txt.blur(),FastChat.restoreDraft(e))},onResizeEnd:function(t,r){var n=getWndInner(),a=s.box.pos;s.scroll&&s.scroll.show(),FastChat.fixResized(s,r,!0),FastChat.stateChange({op:"resized",peer:e,h:t/n[0],w:r/n[1],y:s.box.toBottom?-1:a[0]/n[0],x:s.box.toRight?-1:a[1]/n[1]})},onResize:function(e,t){FastChat.fixResized(s,t);var r=geByClass1("fc_tab_title",s.box.content);setStyle(r,{width:t-78})},onResizeStart:function(){delete s.posSeq,s.scroll&&s.scroll.hide(),val(s.notify,""),clearTimeout(s.hideNotifyTO)},onDragEnd:function(t,r){delete s.posSeq,FastChat.stateChange({op:"moved",peer:e,y:t,x:r})}};if(r&&extend(u,r),void 0===u.startLeft&&void 0===u.startRight){var l=[],d=c[0]-350,_=curFastChat.clistBox.pos,f=!1;if(window.Call&&(Call.box||Call.invitation)){var h=Call.calcBoxPos();l.push([h.x,h.x+h.w]),f=!0}_[0]+_[2]>d&&(curFastChat.clistBox.visible||!f)&&l.push([_[1],_[1]+_[3]]),each(curFastChat.tabs,(function(t){(_=this.box&&this.box.pos)&&t!=e&&_[0]+_[2]>d&&l.push([_[1],_[1]+_[3]])}));var p,g,m,b=lastWindowWidth-262-Object(n.sbWidth)(),v=!1,C=!1,y=0>b?1:-1;for(p=b;y*p<0*y;p+=135*y){for(g=0,m=0;m<l.length;m++)p>l[m][0]-260&&p<l[m][1]&&g++,p>l[m][0]-10&&p<l[m][0]+10&&(g+=1.1);(!1===v||g<C)&&(v=p,C=g)}f&&C&&(v=b),extend(u,{startBottom:0,startLeft:v})}var T,E=!0;for(T in r||{})if("nofocus"!=T){E=!1;break}E&&(s.posSeq=++curFastChat.posSeq),u.fixed&&(u.startHeight=curFastChat.clistH,u.startWidth=curFastChat.clistW,u.onShow=FastChat.showChatCtrl),s.box=new RBox(o,u),s.iman=new a.default({id:"tab"+e,element:s.box.content,onUnIdleCb:function(){FastChat.readLastMessages(e)},parentManager:curNotifier.idle_manager,idleTimeout:1e4}),curFastChat.tabs[e].iman.start(),u.fixed&&FastChat.setActive(s.box),s.scroll=new Scrollbar(s.logWrap,{prefix:"fc_",nomargin:!0,nokeys:!0,global:!0,right:vk.rtl?"auto":1,left:vk.rtl?1:"auto",onScroll:FastChat.onScroll.pbind(s)}),u.minimized||!r||void 0===r.startLeft&&void 0===r.startTop&&void 0===r.startWidth&&void 0===r.startHeight||s.box._wnd_resize(c[0],c[1],!0),s.wrap.clientWidth&&setStyle(s.title,{maxWidth:s.wrap.clientWidth-71}),addEvent(s.txt,"keydown",this.onInputKeydown.bind(this,s)),addEvent(s.txt,"keyup",this.onInputKeyUp.bind(this,s,e)),addEvent(s.txt,"focus",this.onInputFocus.bind(this,e)),FastChat.restoreDraft(e),u.onPeerAdded&&u.onPeerAdded()}},onInputFocus(e){curFastChat.peer=e},onInputKeydown(e,t){if(t.ctrlKey&&t.keyCode===KEY.RETURN){var r=t.target,n=r.value;if("number"==typeof r.selectionStart&&"number"==typeof r.selectionEnd){var a=r.selectionStart;r.value=n.slice(0,a)+"\n"+n.slice(r.selectionEnd),r.selectionStart=r.selectionEnd=a+1}else if(document.selection&&document.selection.createRange){r.focus(t);var i=document.selection.createRange();i.text="\r\n",i.collapse(!1),browser.opera&&(i.moveEnd("character",0),i.moveStart("character",0)),i.select()}e.editable?this.checkEditable(e.emojiId,e.txt):(e.txt.autosize.update(),setTimeout(()=>e.txt.autosize.update(),0))}},onInputKeyUp(e,t){var r=e.lastValue||"",n=this.getInputValue(e.txt);n.length===r.length&&n===r||(n&&this.sendTyping(t),e.lastValue=n),clearTimeout(e.saveDraftTO),e.saveDraftTO=setTimeout(this.saveDraft.pbind(t),n.length?300:0),this.checkEditable(e.emojiId,e.txt)},onScroll:function(e){var t=e.scroll.obj.scrollTop,r=geByClass1("_fc_msgs_more",e.logWrap);t<200&&isVisible(r)&&r.click()},loadMore:function(e,t){var r=curFastChat.tabs[e],a=r.offset;if(r.moreLoading)return!1;r.moreLoading=!0,ajax.post("al_im.php",{act:"a_history",peer:e,offset:a,from:"fc"},{onDone:function(e){e[3]||hide(t);var n=t.parentNode,a=n.clientHeight;n.insertBefore(cf(e[0]),t.nextSibling);var i=n.clientHeight-a;i&&(r.logWrap.scrollTop+=i),r.scroll.update(),r.offset=e[2],r.moreLoading=!1,FastChat.onScroll(r)},onFail:function(){r.moreLoading=!1},showProgress:n.lockButton.pbind(t),hideProgress:n.unlockButton.pbind(t)})},sendOnResponse:function(e,t,r){if(e.version&&intval(e.version)>curFastChat.version)FastChat.updateVersion(e.version);else{var n=ge("fc_msg"+t),a=e.msg_id,i=indexOf(t,r.newmsgs);if(n){if(e.media){var o={sticker:intval(e.sticker)};FastChat.lcSend("gotMedia",{msgId:t,peer:r.box.options.peer,text:e.media,msgOpts:o}),FastChat.gotMsgMedia(r.box.options.peer,t,e.media,o)}++r.msgscount,-1!=i&&r.newmsgs.splice(i,1),n.id="fc_msg"+a,r.msgs[a]=[1,1]}}},checkEditable:function(e,t){Emoji.checkEditable(e,t,{height:52})},fixResized:function(e,t,r){e&&(e.logWrap.scrollTop=e.logWrap.scrollHeight,t>0&&setStyle(e.title,{maxWidth:t-71}),r&&(e.editable||setStyle(e.txt.autosize.helper,{width:getStyle(e.txt,"width",!1)}),e.scroll&&e.scroll.update(!1,!0)))},activateTab:function(e){var t=curFastChat.tabs[e].box;curFastChat.activeBox&&curFastChat.activeBox!=t&&curFastChat.activeBox.hide(0,!1,{noState:!0}),t.show(),t.options.fixed&&FastChat.setActive(t)},blinkTab:function(e){var t=this.getTab(e);if(!t.blinking&&curFastChat.peer!=e){t.blinking=!0,clearTimeout(t.blinkingTO);var r=t.box.wrap,n=r.className,a=Math.min(1e4,intval(getStyle(r,"zIndex")));setStyle(r,{zIndex:1e4}),removeClass(r,"rb_inactive"),t.blinkingTO=setTimeout((function(){delete t.blinking,delete t.blinkingTO,1e4==getStyle(r,"zIndex")&&(setStyle(r,{zIndex:a}),r.className=n)}),2e3)}},createProgress:function(e,t,r){var n=ce("span",{innerHTML:rs(vk.pr_tpl,{id:"",cls:""}),className:"fc_msg_progress",id:"fc_msg_progress"+t});return e.insertBefore(n,r),n},removeProgress:function(e){re("fc_msg_progress"+e)},send:function(e,t,r){var n=curFastChat.tabs[e],a=trim(n.editable?Emoji.editableVal(n.txt):val(n.txt)),i="";t?(i=[["sticker",t]],a=""):i=n.imMedia?n.imMedia.getMedias():[];var o=ge("fc_tab_typing"+e),s=geByClass1("page_progress_preview",n.wrap);if(s&&s.childNodes.length>0){curFastChat.sendOnUpload=e;var c=geByClass("fc_tab_log",n.wrap)[0];return FastChat.createProgress(c,e,c.lastChild),void(o.style.visibility="hidden")}if(curFastChat.sendOnUpload=!1,FastChat.removeProgress(e),o.style.visibility="visible",a||i.length){var l=Object(h.random)(),d={act:"a_send",to:e,hash:n.sendhash,msg:a,from:"fc",entrypoint:curFastChat.tabs[e].entrypoint,media:[],random_id:l};r&&(d.sticker_referrer=r);for(var _,f=0,p=i.length;f<p;++f)(_=i[f])&&d.media.push(_[0]+":"+_[1]);d.media=d.media.join(","),n.sending=!0,Emoji.ttHide(n.emojiId),curFastChat.tabs[e].entrypoint=!1,ajax.post("al_im.php",d,{onDone:function(t){clearTimeout(n.saveDraftTO),FastChat.saveDraft(e),FastChat.sendOnResponse(t,l,n)},onFail:function(t){FastChat.error(e,t||Object(u.getLang)("global_unknown_error")),elfocus(n.txt),val(n.txt,clean(a)),n.editable?FastChat.checkEditable(n.emojiId,n.txt):n.txt.autosize.update();var r=ge("fc_msg"+l);if(r)return r.appendChild(ce("span",{className:"fc_msg_error",innerHTML:Object(u.getLang)("global_error")})),FastChat.scroll(e),!0},showProgress:function(){n.sending=!0,n.sendProgressTO=setTimeout((function(){var e=ge("fc_msg"+l);e&&FastChat.createProgress(e,l,e.firstChild)}),2e3)},hideProgress:function(){n.sending=!1,clearTimeout(n.sendProgressTO),FastChat.removeProgress(l)}}),re("fc_error"+e),t||(val(n.txt,""),n.imMedia&&n.imMedia.unchooseMedia()),FastChat.addMessage(FastChat.prepareMessageData({messageId:l,text:clean(a).replace(/\n/g,"<br>"),peerId:e,flags:3,randomId:d.random_id,attaches:[]})),delete curFastChat.myTypingEvents[e],n.editable?FastChat.checkEditable(n.emojiId,n.txt):n.txt.autosize.update(!1,!0),elfocus(n.txt),FastChat.scroll(e),FastChat.trackActivity("send")}else n.editable?Emoji.editableFocus(n.txt,!1,!0):elfocus(n.txt)},saveDraft:function(e){var t=curFastChat.tabs[e],r=(t||{}).txt;if(r&&t){var n=Emoji.editableVal(r),a=Object(d.loadDraftForPeer)(curFastChat.ldb,e);a.setText(trim(n)||""),a.destroy()}},restoreDraft:function(e){var t=curFastChat.tabs[e],r=t.txt,n=Object(d.loadDraftForPeer)(curFastChat.ldb,e);return!(!r||!t||val(r).length>n.dData.txt.length&&!n.hasAttaches())&&(t.editable?r.innerHTML=Emoji.emojiToHTML(clean(n.dData.txt),1):val(r,clean(n.dData.txt)),setTimeout(()=>{for(var e=n.dData.attaches,r=0;r<e.length;r++)t.imMedia&&t.imMedia.chooseMedia(e[r].type,e[r].id,e[r].object||{});n.destroy()},40),FastChat.checkEditable(t.emojiId,r),setTimeout((function(){r.scrollTop=r.scrollHeight}),10),!0)},error:function(e,t){e=e||curFastChat.peer;var r=curFastChat.tabs[e];re("fc_error"+e),r.log.appendChild(ce("div",{id:"fc_error"+e,className:"fc_msgs_error",innerHTML:t||Object(u.getLang)("global_error")})),FastChat.scroll(e)},scroll:function(e){e=e||curFastChat.peer;var t=curFastChat.tabs[e];t&&(t.logWrap.scrollTop=t.logWrap.scrollHeight,t.scroll&&t.scroll.update(!1,!0))},mkdate:function(e){var t=new Date(1e3*e),r=new Date,n=function(e){return(e+"").length<2?"0"+e:e};if(t.getDay()==r.getDay())return n(t.getHours())+":"+n(t.getMinutes());var a=n(t.getDate())+"."+n(t.getMonth()+1);return t.getFullYear()!=r.getFullYear()&&(a+="."+(t.getFullYear()+"").substr(2)),a},prepareMessageData(e){var t=e.peerId,r=e.flags,n=e.messageId,a=e.text,i=e.date,o=Object(b.getUserId)(e),s=y(this.getMessageMedia(e),2),c=s[0],l=s[1],d="",_=e.randomId;Object(b.isServiceMsg)(e)&&(d=this.renderServiceMessage(e));var f=Object(b.isServiceMsg)(e)?d:Object(b.isExpiredCasperMessage)(e)?Object(u.getLang)("mail_expired_message"):this.getMessageText(a,t)+c;return-1!==String(n).indexOf("rid")&&(_=Number(n.slice(3))),Object.assign({id:n,peer:t,from_id:o,text:f,out:Object(b.isOut)(e),unread:Boolean(1&r),date:i,date_str:FastChat.mkdate(i),randomId:_,isServiceMessage:Object(b.isServiceMsg)(e)},this.getMessageAuthor(e),l)},getMessageAuthor(e){var t=e.peerId,r=Object(b.getUserId)(e),n=this.getTab(e.peerId);if(!n||!r)return{};var a=Object(b.isOut)(e)?curFastChat.me:Object(v.isChatPeer)(t)?n.data.members[r]:n,i=a.name,o=a.link,s=a.photo,c=a.fname,u=a.first_name;return{fname:Object(v.isChatPeer)(t)?c||u:"",from_id:r,name:i,link:o,photo:s}},getMessageMedia(e){var t=e.peerId,r=e.messageId,n="",a={};return!Object(b.isServiceMsg)(e)&&Array.isArray(e.attaches)&&(e.attaches.forEach(e=>{switch(e.type){case"sticker":n+=r?this.renderSticker(e.id,e.productId,e.kind,r):this.renderSticker(e.id,e.productId),a.sticker=!0;break;case"mail":var i=e.object?e.object.fwd_count:e.id.split(";").length;n+=rs(curFastChat.tpl.msg_fwd,{msg_id:r,peerId_nice:Object(v.convertPeerToUrl)(t),label:Object(u.getLang)(i>1?"mail_im_fwd_msgs":"mail_im_fwd_msg")});break;default:n+=rs(vk.pr_tpl,{id:"",cls:""}),r>0&&setTimeout(FastChat.needMsgMedia.pbind(t,r),5)}}),n&&(n=`<div class="fc_msg_attachments" id="fc_msg_attachments${r}">${n}</div>`)),[n,a]},renderSticker(e,t,r,n){var a,i=window.devicePixelRatio>=2?"256":"128";return"animation"===r?(a=rs(curFastChat.tpl.animatedSticker,{id:e,size:i,productId:t,messageId:n}),Number.isInteger(n)&&this.loadStickersModuleIfNeed().then(()=>{window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer("animatedSticker"+n,10)})):a=rs(curFastChat.tpl.sticker,{id:e,size:i}),a},loadStickersModuleIfNeed:()=>new Promise(e=>{var t=Boolean(window.StickersSettings&&window.StickersAnimation);curFastChat.stickersLoading||t?e():(curFastChat.stickersLoading=!0,stManager.add([jsc("web/stickers.js")],()=>{curFastChat.stickersLoading=!1,e()}))}),renderServiceMessage(e){var t=e.kludges,r=e.peerId,n=t.source_act,a=Number(t.source_mid),i=intval(Object(v.isChatPeer)(e.peerId)?t.from:e.userId),o=this.getMember(r,i),s="",c=i===a;switch(n){case v.CREATE_CHAT_ACTION:s="mail_im_chat_created";break;case v.CHAT_TITLE_ACTION:s=t.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case v.CHAT_INVITE_USER:s=c?"mail_im_returned_to_chat":"mail_im_invited";break;case v.CHAT_KICK_USER:s=c?"mail_im_left":"mail_im_kicked_from_chat";break;case v.CHAT_PHOTO_UPDATE:s="mail_im_photo_set";break;case v.CHAT_PHOTO_REMOVE:s=t.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case v.CHAT_PIN_MESSAGE:s=t.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case v.CHAT_UNPIN_MESSAGE:s=t.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case v.CHAT_INVITE_BY_LINK:s="mail_im_invite_by_link";break;case v.CHAT_SCREENSHOT:s=vk.id===a?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;default:return"mail_no_support"}if(s=(s=langSex(o.sex,Object(u.getLang)(s,"raw"))).replace("{from}",Object(v.serviceLink)(o.link,o.name,!0)),a&&a!==i){var l=t.source_email;if(l)s=s.replace("{user}",Object(v.serviceLink)("/im?email="+encodeURIComponent(l),"email",!0));else{var d=this.getMember(r,a)||{name_inv_case:"",name_kick_case:"",link:""},_=n===v.CHAT_KICK_USER?d.name_kick_case:d.name_inv_case;s=s.replace("{user}",Object(v.serviceLink)(d.link,_,!0))}}if(t.source_text){var f=t.source_old_text?`«<b class="im_srv_lnk">${t.source_old_text}</b>» &rarr; `:"";s=s.replace("{title}",f+`«<b class="im_srv_lnk">${t.source_text}</b>»`)}if(t.source_act===v.CHAT_PIN_MESSAGE||t.source_act===v.CHAT_UNPIN_MESSAGE)if(t.source_message){var h=Object(v.replaceSpecialSymbols)(Emoji.emojiToHTML(stripHTML(t.source_message.replace(/<br\s?\/?>/gi," ")),!0)),p=Object(v.serviceLink)("",h,!1,"im_srv_mess_link");s=s.replace("{msg}",p)}else s=s.replace(/{link}(.+){\/link}/i,(e,t)=>Object(v.serviceLink)("",t,!1,"im_srv_mess_link"));return s},getMember(e,t){var r=this.getTab(e);return Object(v.isChatPeer)(e)&&r?r.data.members[t]:r||null},needMsgMedia:function(e,t){t<=0||(FastChat.lcSend("needMedia",{msgId:t}),curFastChat.needMedia[t]=[e,setTimeout(FastChat.loadMsgMedia.pbind(e,t),curNotifier.is_server?0:irand(150,250))])},loadMsgMedia:function(e,t){t<=0||void 0!==curFastChat.gotMedia[t]&&0!==curFastChat.gotMedia[t]||(FastChat.lcSend("fetchingMedia",{msgId:t}),curFastChat.gotMedia[t]=0,ajax.post("al_im.php",{act:"a_get_media",id:t,from:"fc"},{onDone:function(r){var n=y(r,4),a=(n[0],n[1]),i=(n[2],n[3]);FastChat.lcSend("gotMedia",{msgId:t,peer:e,text:a,msgOpts:i}),FastChat.gotMsgMedia(e,t,a,i)}}))},gotMsgMedia:function(e,t,r,n){if(val("fc_msg_attachments"+t,r),n&&n.sticker){var a=ge("fc_msg"+t),i=a&&a.parentNode;a&&addClass(i.parentNode,"fc_msg_sticker"),window.StickersAnimation&&window.StickersAnimation.checkSettingsAndLoadInWeb(t,!1,!1,!0)}FastChat.scroll(e),curFastChat.gotMedia[t]=[e,r,n],n&&n.stickers&&window.Emoji&&Emoji.updateTabs(n.stickers,n.keywords),void 0!==curFastChat.needMedia[t]&&(clearTimeout(curFastChat.needMedia[t][1]),delete curFastChat.needMedia[t])},replaceSpecialSymbols:function(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,"$1$4")},addMessage:function(e){var t,r=e.peer,n=this.getTab(r),a=n.log;if(!n||e.out||!n.box.visible||n.iman.is_idle||curNotifier.idle_manager.is_idle||(e.unread=!1,FastChat.markRead(e.peer,[e.id])),e.randomId&&re(document.querySelector(`[data-random-id="${e.randomId}"]`)),n.msgs[e.id]=[e.out,e.unread],this.isNewStack(e)){re("fc_log_empty"+r);var i=(e.out?"fc_msgs_out ":"")+(e.unread?"fc_msgs_unread":"");e.sticker&&(i+=" fc_msg_sticker"),e.isServiceMessage&&(i+=" fc_srv_msg");var o=e.isServiceMessage?curFastChat.tpl.msgs_service:e.out?curFastChat.tpl.msgs_out:curFastChat.tpl.msgs;t=se(rs(o,{from_id:e.from_id,link:e.link,photo:Notifier.fixPhoto(e.photo),name:e.from_id==curFastChat.me.id?Object(u.getLang)("mail_im_thats_u"):stripHTML(e.name),classname:i,date:e.date,date_str:e.date_str,msgs:"",randomId:e.randomId||0,messageId:e.id})),a.appendChild(t)}else e.unread||removeClass(t,"fc_msgs_unread");var s=geByClass1("fc_msgs_list",t,"div"),c=geByClass1("fc_msgs_date",s),l=geByClass1("fc_msg_last",s);l&&removeClass(l,"fc_msg_last");var d=se(rs(curFastChat.tpl.msg,{msg_id:e.id,classname:(e.unread?"fc_msg_unread":"")+(e.isServiceMessage?" fc_srv_msg":"")+" fc_msg_last",text:FastChat.replaceSpecialSymbols(e.text)}));domFC(s)&&"BR"==domFC(s).tagName&&re(domFC(s)),c?s.insertBefore(d,c):s.appendChild(d),vk.id!=e.from_id&&(delete curFastChat.typingEvents[r],FastChat.updateTyping(r,1)),n.scroll&&n.scroll.update()},getTab:e=>curFastChat.tabs[e],isTabLoaded(e){return Boolean(curFastChat.tabs&&this.getTab(e))},isNewStack(e){var t=this.getTab(e.peer).log.lastChild;return t&&"fc_msgs_error"==t.className&&(t=t.previousSibling),!t||(!hasClass(t,"fc_msgs_wrap")||(!hasClass(t,"fc_msgs_unread")&&!0===e.unread||(t.getAttribute("data-from")!==e.from_id||(e.date-intval(t.getAttribute("data-date"))>=300||!(!e.sticker&&!hasClass(t,"fc_msg_sticker"))))))},editMessage(e){var t=e.id,r=ge("fc_msg"+t);if(r){var n=se(rs(curFastChat.tpl.msg,{msg_id:t,classname:r.getAttribute("class"),text:FastChat.replaceSpecialSymbols(e.text)}));r.parentNode.replaceChild(n,r)}},deleteMessage(e){var t=e.id,r=ge("fc_msg"+t);if(r){var n=!domNS(r)&&!domPS(r),a=domClosest("fc_tab_log_msgs",r);for(re(n?domClosest("fc_msgs_wrap",r):r);hasClass(domLC(a),"fc_msgs_date");)re(domLC(a))}},updateTabUnreadCounter(e,t){if(!e){var r=document.querySelector("#chat_tab_icon_"+t.peerId),n=r&&r.querySelector(".chat_tab_counter");e={unread:n&&Math.max(+n.innerHTML,0)||0}}Object(b.isOut)(t)?e.unread=0:e.unread++,this.updateTabUnreadCounterElement(e,t.peerId)},updateTabUnreadCounterElement(e,t){if(e){var r=document.querySelector("#chat_tab_icon_"+t),n=r&&r.querySelector(".chat_tab_counter");n&&(n.innerHTML=e.unread>0?e.unread:""),e.title&&e.name&&(val(e.title,e.name+(e.unread?' <span class="fc_tab_count">('+e.unread+")</span>":"")),val("fc_contact_unread"+t,e.unread?" <b>+"+e.unread+"</b>":""))}},showMsgFwd:function(e){return!showBox("al_im.php",{act:"a_show_forward_box",id:vk.id+"_"+e,from:"mail"},{stat:["im.css"],dark:1,params:{onHide:function(){AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)}}})},closeTab:function(e){curFastChat.tabs[e].box.close()},trackActivity(e){Object(m.statlogsValueEvent)("im_fastchat_location",e,window.cur.module)},toggleFastChats(e){var t=!e;toggleClass(ge("chat_onl_wrap"),"fast_chats_toggle_hide",t),toggleClass(ge("rb_box_fc_clist"),"fast_chats_toggle_hide",t),each(geByClass("rb_box_wrap"),()=>toggleClass(this,"fast_chats_toggle_hide",t))},tplBox:'<div class="fc_tab_wrap"><div class="fc_tab_head clear_fix"><a class="fc_tab_close_wrap"><div class="chats_sp fc_tab_close"></div></a><a class="fc_tab_max_wrap" href="/im?sel=%id%" onmousedown="event.cancelBubble = true;" onclick="return nav.go(this, event);"><div class="chats_sp fc_tab_max"></div></a><a class="fc_tab_pin_wrap" onmousedown="event.cancelBubble = true;" onclick="return FastChat.pinTab(%id%, event);"><div class="chats_sp fc_tab_pin"></div></a><div class="fc_tab_title noselect">%name%</div></div><div class="fc_tab"><div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><a class="fc_tab_attach"></a><div class="fc_tab_txt">%cont%<div class="fc_tab_preview"></div></div></div></div><div class="fc_pointer_offset"><div class="fc_tab_pointer fc_tab_pointer_peer"></div></div></div>',tplTab:'<div class="fc_tab_log_wrap"><div class="fc_tab_notify_wrap"></div><div class="fc_tab_log"><div class="fc_tab_log_msgs"></div><div class="fc_tab_typing" id="fc_tab_typing%id%"><div class="pr fc_tab_typing_icon _fc_tab_typing_progress" id=""><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><div class="fc_tab_typing_name _fc_tab_typing_name"></div></div></div></div><div class="fc_tab_txt_wrap"><div class="fc_tab_txt">%cont%</div></div>'},window.DesktopNotifications={supported:function(){return!(!window.webkitNotifications&&!window.Notification)},checkPermission:function(){return window.webkitNotifications?webkitNotifications.checkPermission():"granted"==Notification.permission?0:1},requestPermission:function(e){(window.webkitNotifications||window.Notification).requestPermission(e)},createNotification:function(e,t,r){var n;return window.webkitNotifications?n=webkitNotifications.createNotification(e,t,r):((n=new Notification(t,{icon:e,body:r})).cancel=function(){this.close()},n.show=function(){}),vk.id%100<10&&statlogsValueEvent("browser_notification",0),n}};r("j0Lq");window.getWndInner=function(){var e=lastWindowWidth,t=lastWindowHeight,r=Object(n.sbWidth)();return(!1!==lastWndScroll[0]?lastWndScroll[0]:htmlNode.scrollHeight>htmlNode.clientHeight)&&(e-=r+(r?1:0)),[t,e]},window.lastWndScroll=[!1,!1],window.updateWndVScroll=function(){var e=window,t=!1;t=e.boxLayerWrap&&isVisible(boxLayerWrap)?boxLayerWrap.scrollHeight>boxLayerWrap.clientHeight?1:0:e.layerWrap&&isVisible(layerWrap)?layerWrap.scrollHeight>layerWrap.clientHeight?1:0:!(!e.mvLayerWrap||!isVisible(mvLayerWrap))&&(mvLayerWrap.scrollHeight>mvLayerWrap.clientHeight?1:0),each(curRBox.tabs,(function(e){this.options.marginFixedToLayer&&setStyle(this.wrap,{marginRight:hasClass(document.body,"layers_shown")?Object(n.sbWidth)():0})})),t!==lastWndScroll[0]&&(lastWndScroll[0]=t,each(curRBox.tabs,(function(e){this.toRight&&!this.options.marginFixedToLayer&&setStyle(this.wrap,{marginRight:t?Object(n.sbWidth)():0})})))},window.defBox=function(e,t){var r,n='<div class="'+(e.subClass||"")+'"><div class="fc_tab_head"><a class="fc_tab_close_wrap fl_r"><div class="chats_sp fc_tab_close"></div></a><div class="fc_tab_title noselect">%title%</div></div><div id="fc_ctabs_cont"><div class="fc_ctab fc_ctab_active">%content%</div></div></div></div>';r=e.content?'<div class="fc_content_wrap"><div class="fc_content">'+e.content+"</div></div>":e.innerHTML;var a=se(rs(n,{title:e.title,content:r}));r=geByClass1("fc_content",a,"div");var i,o={movable:geByClass1("fc_tab_head",a),hider:geByClass1("fc_tab_close_wrap",a,"a"),startLeft:e.x,startTop:e.y,startHeight:e.height,startWidth:e.width,resizeableH:r,resize:!1,minH:e.minH,onBeforeHide:e.onBeforeHide||function(){},onHide:e.onHide||function(){},onDragEnd:function(e,t){},onResize:function(e,t){}},s=new RBox(a,extend(o,e));return e.content&&(i=new Scrollbar(r,{prefix:"fc_",more:debugLog,nomargin:!0,global:!0,nokeys:!0,right:vk.rtl?"auto":0,left:vk.rtl?0:"auto",onHold:e.onHold})),t({id:s.id,cont:r,update:function(){i&&i.update()}}),s};try{stManager.done("notifier.js")}catch(e){}},"BN/X":function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return s}));r("91GP"),r("ioFf"),r("rGqo"),r("Btvt");var n=r("q1tI"),a=(r("17x9"),r("pemR"));function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}class s extends n.Component{render(){var e=this.props,t=e.hovered,r=e.className,s=e.children,c=o(e,["hovered","className","children"]),u=Object(a.classNames)("Link",{"Link--hovered":!!t},r);return this.props.href?n.createElement("a",i({},c,{className:u}),s):n.createElement("span",i({},c,{className:u}),s)}}s.defaultProps={href:void 0,hovered:!1}},BxOC:function(e,t,r){"use strict";r.r(t),r.d(t,"post",(function(){return a})),r.d(t,"plainget",(function(){return i})),r.d(t,"plaingetCancelable",(function(){return o}));r("VRzm"),r("Btvt");var n=r("cGUQ");function a(e,t,r){return t&&(t.im_v=3),new Promise((n,a)=>{ajax.post(e,t,{timeout:r,onDone(){n.apply(null,[[...arguments]])},onFail(){return a.apply(null,arguments),!0}})})}function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=o(e,t,r),a=n.request;return a}function o(e,t){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function i(){r.abort()}r=window.XDomainRequest?new XDomainRequest:ajax._getreq();var o=new Promise((i,o)=>{var s,c=Date.now(),u=a.timeout||60,l=Object(n.toQueryString)(t);if(window.XDomainRequest)r.open("get",`${e}?${l}`),r.ontimeout=function(e){o([e,{}])},r.onerror=function(e){o([e,{}])},r.onload=function(){i([r.responseText,{}])},setTimeout((function(){r.send()}),0);else{r.onreadystatechange=function(){4==r.readyState&&(clearInterval(s),r.status>=200&&r.status<300?i([r.responseText,r]):o([r.responseText,r]))};try{r.open("GET",`${e}?${l}`,!0)}catch(e){return o([e,r])}r.send()}s=setInterval((function(){Date.now()-c>1e3*u&&(window.browser.safari&&r.abort(),o(["",{}]),clearInterval(s))}),1e3)});return{request:o,cancel:i}}},ERyv:function(e,t,r){"use strict";r.r(t),r.d(t,"isWeirdLogging",(function(){return u})),r.d(t,"imWeirdLog",(function(){return l})),r.d(t,"imWeirdCatch",(function(){return d})),r.d(t,"startLoggingAllUnhandled",(function(){return _})),r.d(t,"stopLoggingAllUnhandled",(function(){return f}));r("VRzm"),r("Btvt");var n,a=r("BxOC"),i=r("DM26"),o=1;function s(e,t,r,a,i){if("Script error."!==e){var o=i?i.stack||i.message:null;l("unhandled_error",o?{err:e,stack:o}:{err:e})}n&&n.apply(this,arguments)}function c(e){e.preventDefault()}function u(){return!!window.imwl}function l(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];u()&&(r&&window.console&&(console.error(e,t),console.trace&&console.trace()),Object(i.retryFn)(a.post,3,()=>2)("al_im.php",{act:"a_weird_log",kind:e,data:JSON.stringify(extend({errIdx:o++,ua:navigator.userAgent},t))}))}function d(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return l(e,extend({err:t&&t.message||t},r)),Promise.reject(t)}function _(){n=window.onerror,window.onerror=s,window.addEventListener("unhandledrejection",c)}function f(){window.onerror=n,n=void 0,window.removeEventListener("unhandledrejection",c)}},MhhX:function(e,t,r){"use strict";r.r(t),r.d(t,"isUnread",(function(){return i})),r.d(t,"isServiceMsg",(function(){return o})),r.d(t,"isCallMessage",(function(){return s})),r.d(t,"isOut",(function(){return c})),r.d(t,"hasReply",(function(){return u})),r.d(t,"isGraffiti",(function(){return d})),r.d(t,"isAudioMsg",(function(){return _})),r.d(t,"isSticker",(function(){return f})),r.d(t,"isGift",(function(){return h})),r.d(t,"isMoney",(function(){return p})),r.d(t,"isMoneyRequest",(function(){return g})),r.d(t,"isVKPay",(function(){return m})),r.d(t,"isImportant",(function(){return b})),r.d(t,"getUserId",(function(){return v})),r.d(t,"getAuthorId",(function(){return C})),r.d(t,"getAdminId",(function(){return y})),r.d(t,"wasEdited",(function(){return T})),r.d(t,"isMessageSelected",(function(){return E})),r.d(t,"isCasperMessage",(function(){return O})),r.d(t,"isMessageToBlockedCommunity",(function(){return w})),r.d(t,"hasPrivateStory",(function(){return k})),r.d(t,"isMessageEmpty",(function(){return N})),r.d(t,"getMessageTTL",(function(){return I})),r.d(t,"isExpiredCasperMessage",(function(){return S})),r.d(t,"MARKED_TYPE_MENTIONS",(function(){return j})),r.d(t,"MARKED_TYPE_CASPER",(function(){return A})),r.d(t,"getFromMessageMarkedDataByType",(function(){return M})),r.d(t,"getMentionsFromMessage",(function(){return P})),r.d(t,"hasUserMentions",(function(){return F}));r("OEbY");var n=r("f01n"),a=r("aong");function i(e,t){return"number"!=typeof t.messageId||(c(t)?t.messageId>e.out_up_to:t.messageId>e.in_up_to)}function o(e){return e.kludges&&void 0!==e.kludges.source_act}function s(e){return"call"==e.kludges.attach1_type}function c(e){return e.flags&n.FLAG_OUTBOUND}function u(e){var t=e.attaches.filter(e=>"mail"===e.type).length>0;return e.attaches.filter(e=>"reply"===e.type).length>0||e.flags&n.FLAG_HAS_REPLY&&t}function l(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.attaches[0];return n&&(n.type===t||n.type===r)}function d(e){return l(e,"doc")&&"graffiti"===e.attaches[0].kind}function _(e){return Boolean(e.attaches.find(e=>"doc"===e.type&&"audiomsg"===e.kind))}function f(e){return Boolean(e.attaches.find(e=>"sticker"===e.type))}function h(e){return l(e,"gift")}function p(e){return l(e,"money_transfer","money_request")}function g(e){return l(e,"money_request")}function m(e){return l(e,"link","vkpay")&&6217559==e.kludges.attach1_app_id}function b(e){return e.flags&n.FLAG_IMPORTANT}function v(e){return c(e)?vk.id:e.userId}function C(e,t){var r=Object(a.unpackStore)(e);return c(t)?r.id:t.userId}function y(e,t){var r=Object(a.unpackStore)(e);return r.gid&&c(t)?+t.kludges.from_admin||-r.gid:0}function T(e){return e.update_time>0}function E(e,t){return(e.get().selectedMessages||[]).indexOf(t)>=0}function O(e){return Boolean(e.kludges.is_expired||e.kludges.expire_ttl||e.kludges.ttl&&e.flags&n.FLAG_DELETE_BY_TTL)}function w(e,t){return!(!e.blocked_community||!c(t))}function k(e){return!(!e||!e.kludges.has_private_story)}function N(e){return e.messageId<=0}function I(e){var t=e.kludges.ttl||e.kludges.expire_ttl;return t?Number(t):void 0}function S(e){return!(!e.kludges||!e.kludges.is_expired)}var j=1,A=2;function M(e,t){var r=e.kludges&&e.kludges.marked_users,n=r&&r.find(e=>e[0]===t);return n?n[1]:void 0}function P(e){if(!e.kludges&&!e.kludges.marked_users)return[];var t=M(e,j);return t?Array.isArray(t)?t:[t]:[]}function F(e,t){if(!e.kludges&&!e.kludges.mentions&&!e.kludges.marked_users)return!1;var r=e.kludges.marked_users?P(e):e.kludges.mentions;return!!r&&r.findIndex(e=>e===t||"all"===e)>-1}},N4ZS:function(e,t,r){"use strict";function n(e){return"https://vk.com/web/away.php?to="+e}function a(e,t){var r=decodeURIComponent(e);return/^\/[^/]/.test(r)||/^(https?:\/\/)?([a-z0-9_\-.]+\.)?vk.com(\/.*)?/.test(r)?e:"/away.php?to="+encodeURIComponent(r)+(t?"&utf=1":"")}r.r(t),r.d(t,"wrapAway",(function(){return n})),r.d(t,"wrapAwayIfExternal",(function(){return a}))},O8ze:function(e,t,r){"use strict";r.r(t),r.d(t,"statlogsForwardEvent",(function(){return o})),r.d(t,"statlogsForwardFromCommunityEvent",(function(){return s})),r.d(t,"statlogsCommunityTemplatesClickEvent",(function(){return c})),r.d(t,"statlogsForwardFromChannel",(function(){return u})),r.d(t,"statlogsSendingTime",(function(){return d})),r.d(t,"statlogsSendingTimeStart",(function(){return _})),r.d(t,"statlogsSendingTimeEnd",(function(){return f})),r.d(t,"statlogsSendingError",(function(){return h})),r.d(t,"statlogsSendingQueueLength",(function(){return g})),r.d(t,"statlogsSendingRetry",(function(){return m})),r.d(t,"statlogsBrowserNotificationsUser",(function(){return b})),r.d(t,"statlogsBrowserNotificationsOn",(function(){return v})),r.d(t,"statlogsBrowserNotificationsOff",(function(){return C})),r.d(t,"statlogsCoronaBotLinkClickEvent",(function(){return y}));r("pIFo");var n=r("1y80"),a=r("aong"),i={};function o(e){Object(n.statlogsProbValueEvent)(.1,"im_forward_stat",l(e),!!e.get().gid)}function s(e,t){Object(n.statlogsProbValueEvent)(.1,"im_forward_from_community_stat",l(e),!!e.get().gid,+t)}function c(){Object(n.statlogsProbValueEvent)(1,"im_apply_community_template_stat",1)}function u(){Object(n.statlogsProbValueEvent)(1,"messages_channel_forward_click",1)}function l(e){var t=e.get().pendingForward;return+(t&&t.msgIds&&t.msgIds.length)}function d(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=1;if(!Object(n.randEnabled)(i))return()=>{};var o=+new Date,s=p(e);return function(){var e=+new Date-o;Object(n.statlogsValueEvent)("messages_send_time_web",e,t,r,s,a)}}function _(e,t,r,n){if(t.messageId&&-1!==String(t.messageId).indexOf("rid")){var a=[t.messageId.replace("rid",""),r,n].join("_"),o=t.attaches.length>0;i[a]=d(e,r,n,o)}}function f(e,t,r,n){var a=[t.randomId,r,n].join("_"),o=i[a];o&&(o(),delete i[a])}function h(e,t,r,a){var i=p(e),o=""===t?"network":"unknown";Object(n.randEnabled)(1)&&Object(n.statlogsValueEvent)("messages_send_errors_web",o,r,a,i)}function p(e){var t=Object(a.unpackStore)(e);return Boolean(t.longpoll&&t.longpoll.isEnabled&&t.longpoll.isEnabled())}function g(e){var t=Object(a.unpackStore)(e),r=t.imQueue(t.peer).length;Object(n.randEnabled)(1)&&Object(n.statlogsValueEvent)("messages_send_queue_size",r)}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown",r=1;Object(n.randEnabled)(r)&&Object(n.statlogsValueEvent)("messages_send_retry",1,t,e)}function b(){var e="im_browser_notifications_users";ls.get(e)||ls.get("im_ui_notify_off")||(ls.set(e,1),Object(n.statlogsValueEvent)(e,1))}function v(){Object(n.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)}function C(){Object(n.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}function y(){Object(n.statlogsValueEvent)("messages_corona_bot_entrypoint_click",1)}},P13b:function(e,t,r){"use strict";r.r(t),r.d(t,"getFirstUnread",(function(){return o.getFirstUnread})),r.d(t,"isSearchShown",(function(){return o.isSearchShown})),r.d(t,"getPeer",(function(){return o.getPeer})),r.d(t,"getCurrentKeyboard",(function(){return o.getCurrentKeyboard})),r.d(t,"getKeyboard",(function(){return o.getKeyboard})),r.d(t,"getTab",(function(){return o.getTab})),r.d(t,"getCurrentTab",(function(){return o.getCurrentTab})),r.d(t,"getSelectedMessages",(function(){return o.getSelectedMessages})),r.d(t,"getMessageRangeFromSelection",(function(){return o.getMessageRangeFromSelection})),r.d(t,"countUnread",(function(){return o.countUnread})),r.d(t,"getMessageByRid",(function(){return o.getMessageByRid})),r.d(t,"isRidExist",(function(){return o.isRidExist})),r.d(t,"getLocalId",(function(){return o.getLocalId})),r.d(t,"getLastMessage",(function(){return o.getLastMessage})),r.d(t,"parserMessage",(function(){return o.parserMessage})),r.d(t,"getAuthorFullName",(function(){return o.getAuthorFullName})),r.d(t,"getMessage",(function(){return o.getMessage})),r.d(t,"getPreviousMessage",(function(){return o.getPreviousMessage})),r.d(t,"isClassicInterface",(function(){return o.isClassicInterface})),r.d(t,"isLocksAvailable",(function(){return o.isLocksAvailable})),r.d(t,"isFoldersAvailable",(function(){return o.isFoldersAvailable})),r.d(t,"isCommunityInterface",(function(){return o.isCommunityInterface})),r.d(t,"isChannelPeer",(function(){return o.isChannelPeer})),r.d(t,"getBareTab",(function(){return o.getBareTab})),r.d(t,"isReversedDialogs",(function(){return o.isReversedDialogs})),r.d(t,"isFullyLoadedTab",(function(){return o.isFullyLoadedTab})),r.d(t,"makeTabNotFullyLoaded",(function(){return o.makeTabNotFullyLoaded})),r.d(t,"isGoToEndVisible",(function(){return o.isGoToEndVisible})),r.d(t,"isGoToMentionVisible",(function(){return o.isGoToMentionVisible})),r.d(t,"getUnreadScrollBottom",(function(){return o.getUnreadScrollBottom})),r.d(t,"isSendingAvailable",(function(){return o.isSendingAvailable})),r.d(t,"isCommunityPeer",(function(){return o.isCommunityPeer})),r.d(t,"isCommunityBlocked",(function(){return o.isCommunityBlocked})),r.d(t,"checkVoiceMessageAvailable",(function(){return o.checkVoiceMessageAvailable})),r.d(t,"isSearching",(function(){return o.isSearching})),r.d(t,"getSearchText",(function(){return o.getSearchText})),r.d(t,"isSearchingValue",(function(){return o.isSearchingValue})),r.d(t,"isRecentSearchesActive",(function(){return o.isRecentSearchesActive})),r.d(t,"getPinnedMessage",(function(){return o.getPinnedMessage})),r.d(t,"doPopularSuggExist",(function(){return o.doPopularSuggExist})),r.d(t,"isAnyMessageBeingEdited",(function(){return o.isAnyMessageBeingEdited})),r.d(t,"getGroupId",(function(){return o.getGroupId})),r.d(t,"getTabDraft",(function(){return o.getTabDraft})),r.d(t,"getTemplates",(function(){return o.getTemplates})),r.d(t,"tabIsMessageRequest",(function(){return o.tabIsMessageRequest})),r.d(t,"tabIsMessageRequestToChat",(function(){return o.tabIsMessageRequestToChat})),r.d(t,"removeMessageRequestFolderFlags",(function(){return o.removeMessageRequestFolderFlags})),r.d(t,"isMessageRequestFolder",(function(){return o.isMessageRequestFolder})),r.d(t,"tabIsOutgoingMessageRequest",(function(){return o.tabIsOutgoingMessageRequest})),r.d(t,"existsIncomingMessageRequest",(function(){return o.existsIncomingMessageRequest})),r.d(t,"isMessageRequestChangedEvent",(function(){return o.isMessageRequestChangedEvent})),r.d(t,"isCommunityChat",(function(){return o.isCommunityChat})),r.d(t,"isCommunityChatDeleted",(function(){return o.isCommunityChatDeleted})),r.d(t,"isClosedChat",(function(){return o.isClosedChat})),r.d(t,"isCasperChat",(function(){return o.isCasperChat})),r.d(t,"isCasperChatTab",(function(){return o.isCasperChatTab})),r.d(t,"isChatActive",(function(){return o.isChatActive})),r.d(t,"SENDING_CLASS",(function(){return P})),r.d(t,"FAILED_CLASS",(function(){return F})),r.d(t,"ORIGINAL_CLASS",(function(){return L})),r.d(t,"RESTORE_CLASS",(function(){return x})),r.d(t,"TYPING_CLASS",(function(){return D})),r.d(t,"MESSAGE_KEYBOARD_BUTTON_CLASS",(function(){return R})),r.d(t,"MESSAGE_STACK_CLASS",(function(){return B})),r.d(t,"MESSAGE_CLASS",(function(){return H})),r.d(t,"CREATE_CHAT_ACTION",(function(){return U})),r.d(t,"CHAT_TITLE_ACTION",(function(){return q})),r.d(t,"CHAT_INVITE_USER",(function(){return W})),r.d(t,"CHAT_KICK_USER",(function(){return G})),r.d(t,"CHAT_PHOTO_UPDATE",(function(){return z})),r.d(t,"CHAT_PHOTO_REMOVE",(function(){return K})),r.d(t,"CHAT_PIN_MESSAGE",(function(){return V})),r.d(t,"CHAT_UNPIN_MESSAGE",(function(){return $})),r.d(t,"CHAT_INVITE_BY_LINK",(function(){return Y})),r.d(t,"CHAT_SCREENSHOT",(function(){return Q})),r.d(t,"DESELECT_ALL_CLASS",(function(){return X})),r.d(t,"HIDE_TOP_NOTICE_CLASS",(function(){return J})),r.d(t,"HIDE_ASIDE_NOTICE_CLASS",(function(){return Z})),r.d(t,"HIDE_ASIDE_PROMO_BLOCK_CLASS",(function(){return ee})),r.d(t,"INSTALL_VKADMIN_LINK",(function(){return te})),r.d(t,"CLEAR_RECENT_CLASS",(function(){return ne})),r.d(t,"TOGGLE_MR_TAB",(function(){return ae})),r.d(t,"MESSAGE_SEARCH_CLASS",(function(){return ie})),r.d(t,"PINNED_CONTAINER_CLASS",(function(){return oe})),r.d(t,"getClassicChatHeight",(function(){return ce})),r.d(t,"setClassicChatHeight",(function(){return ue})),r.d(t,"applyInnerHtml",(function(){return le})),r.d(t,"compensateHistoryHeightChange",(function(){return de})),r.d(t,"renderSticker",(function(){return _e})),r.d(t,"isAlreadyDeleted",(function(){return fe})),r.d(t,"replaceMessageAttrs",(function(){return he})),r.d(t,"isVoiceMessageAvailable",(function(){return pe})),r.d(t,"getAvailableMicrophones",(function(){return ge})),r.d(t,"renderAttach",(function(){return me})),r.d(t,"dayFromVal",(function(){return be})),r.d(t,"showInvisibleBar",(function(){return ve})),r.d(t,"updateMessageInCache",(function(){return Ce})),r.d(t,"editAndReplaceMessage",(function(){return ye})),r.d(t,"setCasperMessageExpiringStatusDOM",(function(){return Te})),r.d(t,"renderMessage",(function(){return Ee})),r.d(t,"renderMessageMedia",(function(){return Oe})),r.d(t,"ensureDomHasActions",(function(){return we})),r.d(t,"renderCallMessage",(function(){return ke})),r.d(t,"appendToHistory",(function(){return Ne})),r.d(t,"restoreQueue",(function(){return Ie})),r.d(t,"markMessagesAsRead",(function(){return Se})),r.d(t,"replaceAttaches",(function(){return je})),r.d(t,"MSG_NEW",(function(){return Ae})),r.d(t,"MSG_DUPLICATE",(function(){return Me})),r.d(t,"MSG_LOCAL_DUPLICATE",(function(){return Pe})),r.d(t,"getMessageStoreStatus",(function(){return Fe})),r.d(t,"isChatPeer",(function(){return u.isChatPeer})),r.d(t,"isUserPeer",(function(){return u.isUserPeer})),r.d(t,"isReservedPeer",(function(){return u.isReservedPeer})),r.d(t,"isContactPeer",(function(){return xe})),r.d(t,"isEmailPeer",(function(){return Le})),r.d(t,"isPeerActive",(function(){return De})),r.d(t,"isFvkcomgroup",(function(){return Re})),r.d(t,"isTabLoaded",(function(){return Be})),r.d(t,"isTabLoadedWithMessage",(function(){return He})),r.d(t,"parseMessage",(function(){return We})),r.d(t,"convertPeerToUrl",(function(){return Ge})),r.d(t,"unUrlPeer",(function(){return ze})),r.d(t,"simplifyCounter",(function(){return Ke})),r.d(t,"chatActions",(function(){return Ve})),r.d(t,"renderPhotos",(function(){return Qe})),r.d(t,"renderPhotosFromTab",(function(){return Xe})),r.d(t,"renderBtnSearchOnlyMessages",(function(){return Je})),r.d(t,"renderMessagesSep",(function(){return Ze})),r.d(t,"renderConversationsSep",(function(){return et})),r.d(t,"renderPopularSuggSep",(function(){return tt})),r.d(t,"renderClearRecent",(function(){return rt})),r.d(t,"renderPopularSuggestions",(function(){return nt})),r.d(t,"setMessageError",(function(){return at})),r.d(t,"startResendMessage",(function(){return it})),r.d(t,"removeMessages",(function(){return ot})),r.d(t,"removeExpiredMessagesStub",(function(){return st})),r.d(t,"removeStartingFromMessage",(function(){return ut})),r.d(t,"removeMessagesWithRestore",(function(){return lt})),r.d(t,"restoreMessage",(function(){return dt})),r.d(t,"formatTyper",(function(){return _t})),r.d(t,"loadSummaryActivityType",(function(){return ft})),r.d(t,"renderEmptySearch",(function(){return pt})),r.d(t,"serviceLink",(function(){return gt})),r.d(t,"renderServiceMsg",(function(){return mt})),r.d(t,"addChatPhotoToUpdate",(function(){return bt})),r.d(t,"replaceSpecialSymbols",(function(){return vt})),r.d(t,"isSelfMessage",(function(){return Ct})),r.d(t,"showVerifiedTooltip",(function(){return yt})),r.d(t,"wrapLoading",(function(){return Tt})),r.d(t,"tabFromIds",(function(){return Et})),r.d(t,"checkSelectClick",(function(){return Ot})),r.d(t,"renderGoTo",(function(){return wt})),r.d(t,"showFlushChat",(function(){return kt})),r.d(t,"showLeaveDialog",(function(){return Nt})),r.d(t,"showUnpinDialog",(function(){return It})),r.d(t,"showMsgDeleteDialog",(function(){return St})),r.d(t,"cleanHistory",(function(){return jt})),r.d(t,"inviteUser",(function(){return At})),r.d(t,"toggleMessageRequestsTab",(function(){return Mt})),r.d(t,"showUnreadOnly",(function(){return Pt})),r.d(t,"changeTab",(function(){return Ft})),r.d(t,"isImportant",(function(){return Lt})),r.d(t,"isUnrespond",(function(){return xt})),r.d(t,"isPeerBlocked",(function(){return Dt})),r.d(t,"isPendingForward",(function(){return Rt})),r.d(t,"isPeerBlockedByMe",(function(){return Bt})),r.d(t,"blockLatencyCompensation",(function(){return Ht})),r.d(t,"showSpamLayer",(function(){return Ut})),r.d(t,"getLastSeenTextInHeader",(function(){return qt})),r.d(t,"getLastSeenText",(function(){return Wt})),r.d(t,"showBlacklistBoxUser",(function(){return zt})),r.d(t,"showBlacklistBox",(function(){return Kt})),r.d(t,"getBaseLink",(function(){return Vt})),r.d(t,"showFavvedBox",(function(){return $t})),r.d(t,"isEditableFocused",(function(){return Yt})),r.d(t,"updateStar",(function(){return Qt})),r.d(t,"removewNewUnreadBarAndMerge",(function(){return Xt})),r.d(t,"isMessagesVisible",(function(){return Jt})),r.d(t,"hideTopNotice",(function(){return Zt})),r.d(t,"hideAsideNotice",(function(){return er})),r.d(t,"hideAsidePromoBlock",(function(){return tr})),r.d(t,"installVKAdminApp",(function(){return rr})),r.d(t,"renderShortText",(function(){return ar})),r.d(t,"attachToText",(function(){return ir})),r.d(t,"lockButton",(function(){return or})),r.d(t,"unlockButton",(function(){return sr})),r.d(t,"renderPinnedMessage",(function(){return cr})),r.d(t,"renderPinnedMedia",(function(){return ur})),r.d(t,"showMessageInfoTooltip",(function(){return lr})),r.d(t,"showEditTimeTooltip",(function(){return dr})),r.d(t,"showCasperExpiringTooltip",(function(){return _r})),r.d(t,"getHistoryTopIndent",(function(){return fr})),r.d(t,"getPinnedMessageHeight",(function(){return hr})),r.d(t,"boxHandleMessagesLabelsTooltips",(function(){return pr})),r.d(t,"showPinnedBox",(function(){return gr})),r.d(t,"showRepliedBox",(function(){return mr})),r.d(t,"isUserAliveInChat",(function(){return br})),r.d(t,"getAliveMembersCount",(function(){return vr})),r.d(t,"normalizeTab",(function(){return Cr})),r.d(t,"normalizeTabsGotFromServer",(function(){return yr})),r.d(t,"splitMessageToParts",(function(){return Tr})),r.d(t,"isMessageTooLong",(function(){return Er})),r.d(t,"showInvitationBox",(function(){return Or})),r.d(t,"showWaitUntilUploadedBox",(function(){return kr})),r.d(t,"canMessageBeDeletedForAll",(function(){return Nr})),r.d(t,"getTopChatMembers",(function(){return Ir})),r.d(t,"getChatMembersByIds",(function(){return Sr})),r.d(t,"getChatMembers",(function(){return jr})),r.d(t,"formatTimespan",(function(){return Ar})),r.d(t,"focusOnMessage",(function(){return Mr})),r.d(t,"getNowEditingMessage",(function(){return Pr})),r.d(t,"checkMessageRequestsTab",(function(){return Fr})),r.d(t,"updateMessageRequestsCounterInDOM",(function(){return Lr})),r.d(t,"hideAllBoxes",(function(){return xr})),r.d(t,"getMessageRequestDateText",(function(){return Dr})),r.d(t,"canPinMessage",(function(){return Rr})),r.d(t,"canForwardMessages",(function(){return Br})),r.d(t,"canMarkImportant",(function(){return Hr})),r.d(t,"removeExpiredMessageIfNeed",(function(){return Ur})),r.d(t,"isPeerCurrentUser",(function(){return qr})),r.d(t,"isGiftOptionAvailableForPeer",(function(){return Wr})),r.d(t,"isMoneyOptionAvailableForPeer",(function(){return Gr})),r.d(t,"replaceExpiredMessageWithPlaceholder",(function(){return zr})),r.d(t,"replaceExpiredRepliedMessageWithPlaceholder",(function(){return Yr})),r.d(t,"getChatMemberCount",(function(){return Qr})),r.d(t,"startCallFromIm",(function(){return Xr})),r.d(t,"isCallToPeerAvailable",(function(){return Jr}));r("rE2o"),r("ioFf"),r("HEwt"),r("Vd3H"),r("rGqo"),r("a1Th"),r("91GP"),r("pIFo"),r("KKXr"),r("VRzm"),r("Btvt");var n=r("f01n"),a=r("h++7"),i=r("bIHZ"),o=r("rHUl"),s=r("MhhX"),c=r("S2bU"),u=r("rudk"),l=r("pemR"),d=r("FWc3"),_=r("EasH"),f=r("1BRX"),h=r("v+DW"),p=r("vT4u"),g=r("ofcU");function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e){return e.parentNode.getAttribute("data-receiver-chat-peer-id")}function C(e,t,r){var a=Object(g.createModule)({handlers:(a,i)=>{i(e,"click","_im_join_chat",e=>function(e,t){var r=domData(t,"chat-id"),a=domData(t,"hash");return Object(h.lockButton)(t),Object(p.joinChat)(r,a,e.get()).then(r=>{var a=m(r,1)[0];Object(h.unlockButton)(t);var i=e.get();i.longpoll.push([Object(n.changePeer)(a)]),i.onJoinChat&&i.onJoinChat(a)}).catch(e=>{Object(_.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_accept_mr",e=>function(e,t){var r=v(t);return Object(h.lockButton)(t),e.set(p.acceptMessageRequest.bind(null,r)).then(()=>{Object(h.unlockButton)(t),e.get().longpoll.push([Object(n.changePeer)(r)])}).catch(e=>{xr(),Object(_.showFastBox)(getLang("mail_join_invite_error_title"),e),Object(h.unlockButton)(t)})}(t,e.target)),i(e,"click","_im_reject_mr",e=>function(e,t,r){var n=v(r);return Object(h.lockButton)(r),e.set(p.rejectMessageRequest.bind(null,n)).then(()=>{t.updateMenu(),t.updateList(),Object(h.unlockButton)(r),xr()}).catch(e=>{xr(),Object(_.showFastBox)(getLang("mail_error"),e),Object(h.unlockButton)(r)})}(t,r,e.target))}});return{unmount(){Object(g.destroyModule)(a)}}}var y=r("aong"),T=r("86+7"),E=r("Wu9C"),O=r("wSs/"),w=r("ERyv"),k=r("lJdi"),N=r("t7n3");var I=r("/eGY"),S=r("ambf"),j=r("Syd7");function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var P="_im_mess_sending",F="_im_mess_failed",L="_im_mess_original",x="_im_mess_restore",D="_im_typing",R="_im_mess_btn",B="_im_mess_stack",H="_im_mess",U="chat_create",q="chat_title_update",W="chat_invite_user",G="chat_kick_user",z="chat_photo_update",K="chat_photo_remove",V="chat_pin_message",$="chat_unpin_message",Y="chat_invite_user_by_link",Q="chat_screenshot",X="_im_deselect_all",J="_im_top_notice_hide",Z="_im_aside_notice_hide",ee="_im_aside_promo_block_hide",te="_im_vkadmin_promo_link",ne="_im_clear_recent",ae="_im_toggle_mr_tab",ie="_im_mess_search",oe="_im_pinned";function ce(){return ls.get("chatPosition")||0}function ue(e){e>=window.clientHeight()-30&&(e=0),ls.set("chatPosition",e)}function le(e,t){e&&e.innerHTML!==t&&(e.innerHTML=t)}function de(e,t,r,n){var a=t&&!r?1:!t&&r?-1:0;a&&!Object(o.isClassicInterface)(e)&&n().compensateHistoryHeightChange(a)}function _e(e,t,r,n){var a=window.devicePixelRatio>=2?"256":"128",i="animation"===r,o="im_gift";i&&(o+=" sticker_img");var s=`<img height="128" class="${o}" src="${Stickers.getStickerUrl(intval(e),a)}"/>`;if(i){var c="animatedSticker"+n;s=`<div id="${c}" data-loop-count=3 data-animation-path="${"/stickers.php?act=proxy_animation&product_id="+t+"&sticker_id="+e}" onmouseenter="StickersAnimation.loadAndPlaySticker(this);"\n     data-uniq-id="${n}" data-sticker-id="${intval(e)}" class="sticker_animation sticker_animation_128 im_gift">${s}</div>`;var u=!1;browser.msie?(0^n)===n&&(u=!0):u=Number.isInteger(n),u&&window.StickersSettings.getAutoplay()&&window.StickersAnimation&&window.StickersAnimation.loadAndPlayStickerWithTimer(c,10)}return t&&(s=`<a onmouseover="return Emoji.stickerOver(${intval(e)}, this);"\n        onclick="return Emoji.clickSticker(${intval(t)}, this, event);">${s}</a>`),s=`<div class="im_sticker_row">${s}</div>`}function fe(e,t,r){var n=e.get?e.get():e;if(Be(n,t)){var a=n.tabs[t].deleted||[];return inArray(r,a)}return!1}function he(e,t,r){var n=r.randomId,a=geByClass1("_im_mess_rid"+n,t);return a&&(t=Ne(e,r,t=ct([a],t),!0,!1)),t}function pe(e){var t=Object(o.checkVoiceMessageAvailable)(e);return browser.mobile&&browser.safari?Promise.resolve(!1):void 0!==t?Promise.resolve(t):ge().then(e=>e.length>0).catch(e=>!1)}function ge(){return window.AudioContext&&navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],r=0;r<e.length;r++)"audioinput"==e[r].kind&&t.push(e[r]);return t})):Promise.reject(new Error("NotSupported"))}function me(e){return getTemplate("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:"im-preloader_attach im-preloader_visible im-preloader_"+e})}function be(e){var t=e.split(".");return(t[0]<10?"0":"")+t[0]+(t[1]<10?"0":"")+t[1]+t[2]}function ve(e){var t=geByClass1("_im_invisible_bar",e);t&&(removeClass(t,"_im_invisible_bar"),removeClass(t,"im-page--history-new-bar_hide"))}function Ce(e,t,r){var n=domData(r,"msgid"),a=geByClass1("_im_mess_"+n,t),i=r.cloneNode(!0);return a&&(a.parentNode.replaceChild(i,a),we(t)),t}function ye(e,t,r){var n=Ee(e,t),a=geByClass1("_im_mess_"+t.messageId,r);return a&&(a.parentNode.replaceChild(se(n),a),we(r)),r}function Te(e,t,r){var n=geByClass1("_im_mess_"+r,e);if(n){var a=n.closest("._im_mess_stack"),i=a&&a.querySelector(".im-mess-stack--bomb");i&&i.classList.add(t?"im-mess-stack--bomb_expiring-soon":"im-mess-stack--bomb_expiring")}return e}function Ee(e,t){var r=[],n=Object(s.isUnread)(e.tabs[t.peerId],t),a=Object(s.isCallMessage)(t),i=Object(s.hasReply)(t)?getTemplate("im_message_media",{type:"reply",messageId:t.messageId,attaches:me("reply"),text:""}):"";a||r.push("_im_mess"),Object(s.isOut)(t)&&n&&!a&&r.push("im-mess_unread _im_mess_unread"),Object(s.isOut)(t)&&!a&&r.push("im-mess_out"),Object(s.wasEdited)(t)&&r.push("im-mess_was_edited"),Object(O.canMessageBeEdited)(e,t)&&r.push("im-mess_editable"),Object(s.isImportant)(t)&&r.push("im-mess_fav"),-1!=(e.selectedMessages||[]).indexOf(t.messageId)&&r.push("im-mess_selected");var l=Date.now()-1e3*t.date>1e3;t.local&&l&&r.push("im-mess_sending"),t.local&&r.push(""+P),t.local&&Object(s.wasEdited)(t)&&!n&&r.push("im-mess_unread im-mess_nobg"),t.failed&&r.push("im-mess_failed "+F),Object(s.isGift)(t)&&r.push("im-mess_gift"),a&&r.push("_im_mess_callsnippet"),Object(s.isCasperMessage)(t)&&r.push("im-mess_casper");var d=Oe(t).concat(function(e){if(e.kludges.keyboard&&e.kludges.keyboard.inline){var t=e.kludges.keyboard.buttons;return[].concat(getTemplate("sImMessageKeyboard",{content:t.map(e=>getTemplate("sImMessageKeyboardRow",{content:e.map(e=>getTemplate("sImMessageKeyboardButton",{label:Object(I.getButtonLabel)(e),appearance:Object(I.getButtonAppearance)(e),type:e.action.type,modifier:e.action.type.replace("_","-"),attributes:Object(I.getAttributesFromActionObject)(e.action),tagName:e.action.type===I.BUTTON_TYPE_OPEN_LINK?"a":"button"})).join("")})).join("")}))}return[]}(t)),_=function(e,t){var r="",n=Object(y.unpackStore)(e).sourceEnabled&&t.kludges&&t.kludges.from_widget&&t.kludges.ref_source;Object(s.wasEdited)(t)&&(r+=getTemplate("sImLblWasEdited",{update_time:t.update_time}));if(Object(o.isCommunityInterface)(e)&&n){var a=t.kludges.ref_source,i={};try{(i=JSON.parse(Object(N.unclean)(a))).link&&i.info&&(i.link=Object(c.replaceHyperLinks)(Object(N.clean)(i.link),c.linksReplacer.bind(null,!1)),i=Object(N.clean)(langStr(getLang("mail_source_info"),"link",i.link,"info",Object(N.clean)(i.info))),r+=getTemplate("sImLblWasSourceInfo",{source:i}))}catch(e){}}return r}(e,t),f=i+We(e,t.text,t.kludges,!1,t.peerId);t.subject&&"..."!==t.subject.trim()&&!Object(u.isChatPeer)(t.peerId)&&(f=getTemplate("im_topic",{topic:t.subject})+f);var h=Object(s.isGift)(t)?`<div class="im-mess--gift-lbl">${f}</div>`:"",p=d.length>0?getTemplate("im_message_media",{type:"media",messageId:t.messageId,attaches:d.join(""),text:h}):"";if(Object(s.isGift)(t)||(p=f+p),Object(s.isCallMessage)(t)){var g=ke(t,!1,!0,e),m=e.isCallsEnabled?"sImCallSnippet":"sImCallSnippetWithStub";p+=getTemplate(m,g)}return p+=_,getTemplate("im_msg_row",{msg_id:t.messageId,from_id:t.peerId,aria_hidden:t.local&&!t.failed?"true":"false",ts:t.date,marker_params:t.failed?`aria-label="${getLang("mail_send_message_error")}" role="link"`:"",unread_params:n?`aria-label="${getLang("mail_unread_message")}"`:"",cls:r.join(" ")}).replace("%text%",()=>p)}function Oe(e){return e.attaches.reduce((t,r)=>!Object(s.hasReply)(e)||"mail"!==r.type&&"reply"!==r.type?("call"===r.type||("sticker"===r.type?e.messageId?t.push(_e(r.id,r.productId,r.kind,e.messageId)):t.push(_e(r.id,r.productId)):t.push(me(r.type))),t):t,[])}function we(e){for(var t=e.querySelectorAll("._im_mess_noa:not(._im_mess_callsnippet):not(._im_mess_srv)"),r=t.length;r--;)hasClass(t[r],"im-mess_fwd")||t[r].insertAdjacentHTML("afterbegin",getTemplate("sImHistoryRowActions")),removeClass(t[r],"_im_mess_noa")}function ke(e,t,r,n){var a,i,o,s,c,u,l=vk.id,d=e.attaches[0],_=d.initiatorId,f=d.state,h=d.receiverId,p=l===_,g=Boolean(e.kludges.attach1_call_video),m={title:"",description:"",modifier:""},b=g?getLang("mail_call_snippet_outgoing_video"):getLang("mail_call_snippet_outgoing"),v=g?getLang("mail_call_snippet_incoming_video"):getLang("mail_call_snippet_incoming");switch(f){case"reached":var C=t?"":(i=d.duration,o=Math.floor(i/3600),s=Math.floor(i/60)-60*o,c=!1,u=!1,[o,s,i-3600*o-60*s].reduce((e,t)=>{if(0===t&&!u)return u=!0,e;c&&(t=t<10?"0"+t:t);var r=`${e}${""!==e?":":""}${t}`;return c=!0,u=!0,r},""));a=(a=p?getLang("mail_call_outgoing"):getLang("mail_call_incoming")).replace("{duration}",C),m.title=p?b:v,m.description=C;break;case"canceled_by_initiator":p?(a=getLang("mail_call_canceled"),m={title:b,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_canceled")})}):(a=getLang("mail_call_missed"),m=n.isCallsEnabled?{title:v,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_missed")})}:{title:getLang("mail_call_snippet_missed_call"),description:getTemplate("sImCallSnippetDMLink")});break;case"canceled_by_receiver":if(p){if(t)return getLang("mail_call_declined");var y=Object(T.oCacheGet)(n,h);a=y?langSex(y.sex,getLang("mail_call_declined_by","raw")).replace("{user_name}",y.first_name):getLang("mail_call_declined"),m={title:b,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_declined")})}}else a=getLang("mail_call_canceled"),m={title:v,description:getTemplate("sImCallSnippetCanceled",{text:getLang("mail_call_snippet_canceled")})};break;default:a=getLang("mail_added_call"),m.title=getLang("mail_added_call")}return g&&(m.modifier="im-call-snippet_video"),m.type=g?"video":"audio",r?m:getTemplate("im_calls_link",{text:a})}function Ne(e,t,r){!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Date.now()-1e3*t.date>1e3,c=e.tabs[t.peerId];if(!r||geByClass1("_im_mess",r)||geByClass1("_im_bar_date",r)||(r.innerHTML=""),c.skipped>0)return r;var l=[];t.local||(l=e.imQueue(t.peerId,n)),l.length>0&&ct(l.map(e=>geByClass1("_im_mess_rid"+e.rid,r),r).filter(e=>e));var d=Ee(e,t),_=domLC(r);hasClass(_,"_im_mess_stack")||(_=domClosestSibling(_,"._im_mess_stack",-1));for(var h=Object(o.getLastMessage)(e,t.peerId,t.messageId);t.peerId===e.peer&&h&&!geByClass1("_im_mess_"+h.messageId);)h=Object(o.getLastMessage)(e,t.peerId,h.messageId);var p=geByClass1("_im_unread_bar_row",r),g=h?Ue(h.date,e):0,m=Object(u.isChatPeer)(t.peerId)&&Object(o.isCasperChat)(e,t.peerId);if(!h||qe(c,h,t,e,a)){var b="",v=!1;if(p&&Object(s.isOut)(t)&&Xt(e,r,t.peerId),1===c.unread&&!Object(s.isOut)(t)&&a&&(b+=getTemplate("im_mess_bar",{}),v=!0,Xt(e,r,t.peerId)),!Object(f.isToday)(new Date(g))&&!m){var C=new Date,T=v?"im-page--history-new-bar_hide _im_invisible_bar":"";b+=getTemplate("im_day_bar",{day:getShortDate(t.date,e.timeshift,!0,getLang("months_of","raw"),!0),date:t.date,day_class:C.getDate()+C.getMonth()+C.getFullYear()+" "+T})}if(Object(s.isServiceMsg)(t))b+=getTemplate("im_service_row",{text:mt(e,t,c),type:"",date:t.date,from_id:"",message_id:t.messageId});else{var E=$r(e,t);b+=getTemplate("im_mess_stack",Object.assign(E,{messages:d}))}Object(y.toArray)(sech(b)).forEach(e=>r&&r.appendChild(e))}else p&&e.peer===t.peerId&&!c.inplaceSearch&&Object(s.isOut)(t)&&Xt(e,r,t.peerId),geByClass1("_im_stack_messages",_).appendChild(se(d));return Object(s.isOut)(t)&&!i&&setTimeout(()=>{var e=geByClass1("_im_mess_"+t.messageId,r);hasClass(e,P)&&addClass(e,"im-mess_sending")},500),l=l.filter(e=>e.rid!==t.randomId),we(r),Ie(l,e,r)}function Ie(e,t,r){var n;return(n="object"==typeof e?e:t.imQueue(e,!1)).length>0&&n.map(e=>(e.mess.failed=!!e.failed,e.mess)).filter(e=>Object(o.getMessage)(t,e.peerId,e.messageId)).forEach(e=>Ne(t,e,r,!1)),r}function Se(e,t,r){var n=e.tabs[t];return Object(y.toArray)(geByClass("_im_mess_unread",r)).forEach(e=>{var t,r=intval(domData(e,"msgid"));r>0&&n.out_up_to>=r&&(removeClass(e,"_im_mess_unread"),removeClass(e,"im-mess_unread"),(t=geByClass1("_im_mess_blind_unread_marker",e))&&(t.removeAttribute("aria-label"),t.removeAttribute("role"),t.removeAttribute("tabindex")))}),r}function je(e,t,r){var n=t.peerId,a=t.messageId,i=geByClass1("_im_msg_reply"+a,e),o=geByClass1("_im_msg_media"+a,e),s=r.tabs[n].mediacontent[a][0];return i&&(i.innerHTML=s[0]),o&&(o.innerHTML=s[1]),e}var Ae=0,Me=1,Pe=2;function Fe(e,t){if(!Object(o.isFullyLoadedTab)(t,e.peerId))return Ae;var r=t.tabs[e.peerId];return r.msgs[e.messageId]?Me:r.msgs["rid"+e.randomId]?Pe:Ae}function Le(e){return e<-2e9}function xe(e){return e>19e8&&e<2e9}function De(e,t){return e===t.peer}function Re(e,t){return Object(k.doesChatTabHaveFlag)(Object(o.getTab)(e,t),1024)}function Be(e,t){return!!e.tabs[t]}function He(e,t){return!!Be(e,t)&&null!==e.tabs[t].lastmsg}function Ue(e,t){return 1e3*e+1e3*t.timeshift}function qe(e,t,r,n,a){if(Object(s.getUserId)(t)!==Object(s.getUserId)(r))return!0;var i=Ue(t.date,n),c=Ue(r.date,n);if(!isSameDate(i,c))return!0;if(Object(o.isCommunityInterface)(n)&&intval(t.kludges.from_admin)!==intval(r.kludges.from_admin))return!0;if(r.date-t.date>300)return!0;if(Object(s.isServiceMsg)(t)||Object(s.isServiceMsg)(r))return!0;var u=Object(s.isCasperMessage)(t),l=Object(s.isCasperMessage)(r);if(u!==l)return!0;var d=t.kludges.is_expired,_=r.kludges.is_expired;return!(!u||!l||d===_)||(!(!u||!l||d||_)||!(u&&l&&d&&_)&&(!(!Object(s.isCallMessage)(r)&&!Object(s.isCallMessage)(t))||(!(!Object(s.isGift)(t)&&!Object(s.isGift)(r))||(!(!Object(s.isGraffiti)(t)&&!Object(s.isGraffiti)(r))||(!!Object(s.hasReply)(r)||!(Object(s.isUnread)(e,t)===Object(s.isUnread)(e,r)||!a||Object(s.isOut)(r)||Ct(r.peerId,n.gid)))))))}function We(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Math.round(1e9*Math.random()).toString(16),s={},u=0;return t=(t=Object(c.replaceHyperLinks)(t||"",c.linksReplacer.bind(null,n))).replace(/(<a.+?<\/a>)/gi,e=>{var t=`!link_${u}_${i}!`;return s[t]=e,u++,t}),t=Object(c.replaceMentions)(t),e.isMassMentionsMessageAllowed&&(t=Object(c.replaceMassMentions)(t)),t=Object(c.replaceEmailLinks)(t),t=Object(c.replaceHashtags)(t,t=>{var r=Object(o.getGroupId)(e);return`<a href="/${r?"gim"+r:"im"}?sel=${a||Object(o.getPeer)(e)}&st=${encodeURIComponent(t)}">${t}</a>`}),Object.keys(s).forEach(e=>{t=t.replace(e,()=>s[e])}),r.emoji&&(t=Emoji.emojiToHTML(t,!0)),t}function Ge(e){return Object(u.isChatPeer)(e)?"c"+(e-2e9):Le(e)?"e"+Math.abs(e+2e9):xe(e)?"mr"+(e-19e8):e}function ze(e){switch(e.substr(0,1)){case"e":return-2e9-intval(e.substr(1));case"c":return 2e9+intval(e.substr(1));default:return intval(e)}}function Ke(e){return e>9999999?Math.floor(e/1e6)+"M":e>9999?Math.floor(e/1e3)+"K":e>0?e.toString():""}function Ve(e,t){return{[p.CHAT_ACTION_SEARCH]:{name:getLang("mail_im_peer_search"),icon:"search"},[p.CHAT_ACTION_BLOCK_COMMUNITY]:{icon:"block",name:getLang("mail_block_comm_messages")},[p.CHAT_ACTION_BLOCK_NOTIFY]:{icon:"block",name:getLang("mail_block_notify_messages")},[p.CHAT_ACTION_ALLOW_COMMUNITY]:{icon:"unblock",name:getLang("mail_allow_comm_messages")},[p.CHAT_ACTION_CLEAR]:{name:Le(e.peer)?getLang("mail_im_delete_email_contact"):getLang("mail_im_delete_all_history"),icon:"clear"},[p.CHAT_ACTION_MUTE]:{name:getLang("mail_im_mute"),icon:"mute"},[p.CHAT_ACTION_UNMUTE]:{name:getLang("mail_im_unmute"),icon:"unmute"},[p.CHAT_ACTION_MEDIA]:{name:Object(o.isCommunityInterface)(e)?getLang("mail_im_show_media_history_group"):getLang("mail_im_show_media_history"),icon:"media"},[p.CHAT_ACTION_BLOCK]:{icon:"block",name:getLang("mail_block_user")},[p.CHAT_ACTION_INVITE]:{icon:"invite",name:getLang("mail_im_create_chat_with")},[p.CHAT_ACTION_LEAVE]:{icon:"leave",name:t?getLang("mail_leave_channel"):getLang("mail_leave_chat")},[p.CHAT_ACTION_RETURN]:{icon:"return",name:t?getLang("mail_return_to_vkcomgroup"):getLang("mail_return_to_chat")},[p.CHAT_ACTION_PIN_HIDE]:{icon:"pin_hide",name:getLang("mail_menu_pin_hide")},[p.CHAT_ACTION_PIN_UNHIDE]:{icon:"pin_unhide",name:getLang("mail_menu_pin_show")},[p.CHAT_ACTION_UNPIN]:{icon:"unpin",name:getLang("mail_menu_unpin")},[p.CHAT_ACTION_SETTINGS]:{icon:"settings",name:t?getLang("mail_vkcomgroup_settings"):getLang("mail_settings")},[p.CHAT_ACTION_CALL_AUDIO]:{icon:"call_audio",name:"Аудиозвонок"},[p.CHAT_ACTION_CALL_VIDEO]:{icon:"call_video",name:"Видеозвонок"}}}function $e(e,t){var r=`<img src="${e}" alt="" class="dialogs_inline_chatter dialogs_inline_chatter_half"/>`;return t&&(r=getTemplate("im_dialogs_link",{href:t,photo:r})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter dialogs_inline_chatter_half">\n      ${r}\n    </div>\n  </div>`}function Ye(e,t){var r=`<img src="${e}" alt="" class="dialogs_inline_chatter"/>`;return t&&(r=getTemplate("im_dialogs_link",{href:t,photo:r})),`<div class="im_grid">\n    <div class="dialogs_inline_chatter">\n      ${r}\n    </div>\n  </div>`}function Qe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if("string"==typeof e)return`<div class="im_grid"><img src="${e}" alt=""/></div>`;switch(e.length){case 1:return`<div class="im_grid"><img src="${e[0]}" alt=""/></div>`;case 2:return e.map((e,r)=>$e(e,t[r])).join("");case 3:return $e(e[0],t[0])+e.slice(1).map((e,r)=>Ye(e,t[r+1])).join("");case 4:return e.map((e,r)=>Ye(e,t[r])).join("")}}function Xe(e,t,r){if("string"==typeof t.photo&&t.photo)return`<div class="im_grid"><img src="${t.photo}" alt=""></div>`;if(Object(u.isChatPeer)(t.peerId)&&t.membersCount<2)return`<div class="im_grid"><img src="${e.get().default_chat_photo}" alt=""></div>`;if(Array.isArray(t.photo))return Qe(t.photo);var n=t.data.active.slice(0,4).map(T.oCacheGet.bind(null,e)).filter(e=>!!e);return Qe(n.map(e=>e.photo),r?[]:n.map(e=>e.link))}function Je(e){var t=e.get().gid?getLang("mail_search_only_messages_comm"):getLang("mail_search_only_messages");return`<li class="im-page--mess-search-w">\n    <div class="im-page--mess-search ${ie}">\n      <button type="button" class="im-i--messages-search"></button>${t}\n    </div>\n  </li>`}function Ze(){return`<li class="im-search-results-head">${getLang("mail_search_messages")}</li>`}function et(){return`<li class="im-search-results-head">${getLang("mail_search_conversations_sep")}</li>`}function tt(){return`<li class="im-search-results-head">${getLang("mail_search_dialogs_sep")}</li>`}function rt(){return`<li class="im-search-results-head _im_recent_bar">\n    ${getLang("mail_recent_searches")}\n    <button type="button" class="${ne} im-page--clear-recent">${getLang("mail_clear_recent")}</button>\n  </li>`}function nt(e){var t=e.get().popular_sugg,r=Object(o.isClassicInterface)(e)?8:5;return t.length>r&&(t=t.slice(0,r)),'<li class="im-popular clear_fix">'+t.map(t=>{var r=t.peerId,n=Object(T.oCacheGet)(e,r)||t,a=e.get().tabs[r]||t,i=(e.get().mutedPeers||[]).indexOf(r)>=0;return`<div class="${["im-popular--item","fl_l","_im_dialog","_dont_add_recent","_im_sugg_"+r,a.unread>0&&"sugg-is_unread",i&&"sugg-is_muted"].filter(e=>!!e).join(" ")}" data-peer="${r}">\n    <a class="im-popular--avatar-w ${onlinePlatformClass(a.online)}" href="${n.link}"><img class="im-popular--avatar" src="${n.photo}"/></a>\n    <div class="im-popular--name-w"><a class="im-popular--name" href="${n.link}">${n.first_name||n.name}</a></div>\n    <span class="im-popular--unread _sugg_unread_ct">${Ke(a.unread)}</span>\n</div>`}).join("")+"</li>"}function at(e,t,r){var n=geByClass1("_im_mess_"+t.messageId,r);if(n){attr(n,"aria-hidden","false"),addClass(n,"im-mess_failed "+F);var a=geByClass1("_im_mess_marker",n);attr(a,"aria-label",getLang("mail_send_message_error")),attr(a,"role","link")}return r}function it(e,t,r){var n=geByClass1("_im_mess_"+t,r);if(n){removeClass(n,"im-mess_failed"),attr(n,"aria-hidden","true"),removeClass(n,F);var a=geByClass1("_im_mess_marker",n);attr(a,"aria-label",""),attr(a,"role","")}return r}function ot(e,t){return ct(e.map(e=>geByClass1("_im_mess_"+e,t)).filter(e=>e),t)}function st(e,t){var r=t||document,n=[];return e.forEach(e=>{var t=r.querySelector("._im_expired_message_"+e);if(t){var a=+t.dataset.count;if(t.dataset.count=a-1,t.classList.remove("_im_expired_message_"+e),1===a)(!domNS(t)||hasClass(domNS(t),"_im_bar_date"))&&(hasClass(domPS(t),"_im_bar_date")&&re(domPS(t)),hasClass(domPS(t),"_im_unread_bar_row")&&re(domPS(t))),re(t);else n.includes(t)||n.push(t)}}),n.length&&n.forEach(e=>{var t=+e.dataset.count;if(t>0){var r=Kr(t),n=se(r);n.classList.add(...e.classList),e.replaceWith(n)}}),t}function ct(e,t){var r=e.filter(e=>!hasClass(e,"im-mess_srv")).map(e=>e.parentNode);return e.forEach(e=>{hasClass(e,"im-mess_srv")?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode&&e.parentNode.removeChild(e)}),r.filter(e=>0===domChildren(e).length).map(e=>gpeByClass("_im_mess_stack",e)).forEach(e=>{hasClass(domPS(e),"_im_bar_date")&&re(domPS(e)),hasClass(domPS(e),"_im_unread_bar_row")&&re(domPS(e)),re(e)}),t}function ut(e){for(var t=e;t;){var r=t;if(null===(t=t.previousElementSibling)){hasClass(r,"mess_srv")&&(t=r.parentNode);var n=gpeByClass("_im_mess_stack",r);n&&(t=n.previousElementSibling,1===domChildren(r.parentNode).length&&n.parentNode.removeChild(n))}hasClass(r,"_im_unread_bar_row")||r.parentNode.removeChild(r)}}function lt(e,t,r,n){return e.map(e=>geByClass1("_im_mess_"+e,n)).filter(e=>e).forEach(e=>{val(e,function(e,t,r){var n=t.innerHTML;return`<div class="im-mess--text">\n    ${getLang("delete"===r?"mail_deleted_stop":"mail_marked_as_spam")} <button type="button" data-peer="${e}" class="${x} im-mess--btn">${getLang("mail_restore")}</button>\n    <div class="${L} im-mess--original">${n}</div>\n  </div>`}(t,e,r)),addClass(e,"im-mess_light")}),n}function dt(e,t,r){var n=geByClass1("_im_mess_"+e,r);if(n){var a=geByClass1(L,n);val(n,a.innerHTML),removeClass(n,"im-mess_light")}return r}function _t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(i)return ht(e,t,r,n,!0,a);var o=60,s=ht(e,t,r,n,!1,a);return s.length>o?ht(e,t,r,n,!0,a):s}function ft(e){var t={[p.ACTIVITY_TYPE_TYPING]:1,[p.ACTIVITY_TYPE_RECORDING_AUDIO]:2},r=Object.keys(e).sort((e,r)=>t[r]-t[e]),n={},a=r.reduce((t,r)=>{var a=(e[r]||{}).userIds;return(void 0===a?[]:a).forEach(e=>{n[e]||(n[e]=!0,t[r]=!0)}),t},{}),i=r.filter(e=>!!a[e]);return i.length>1?"":i[0]}function ht(e,t,r,n,a,i){var s=function(e,t,r){var n=[],a={};return Object.keys(t).map(r=>{((t[r]||{}).userIds||[]).forEach(t=>{Object(T.oCacheExists)(e,t)?parseInt(t,10)!==e.id&&(a[t]=r):n.push(t)})}),n.length&&Object(p.loadChatMember)({[r]:n},e),Object.keys(a).sort((e,r)=>t[a[e]].ts-t[a[r]].ts)}(n,e,t);if(0===s.length)return"";var c=Object(u.isUserPeer)(t)||Object(o.isCommunityPeer)(t)?"first_name":a?"short_name":"name",l=ft(e),d="";l===p.ACTIVITY_TYPE_RECORDING_AUDIO?d=getLang("mail_recording_audio_several",s.length):l===p.ACTIVITY_TYPE_TYPING&&(d=getLang("mail_typing_several",s.length));var _=s.slice(0,Math.min(s.length-1,i)),f=_.map(e=>Object(T.oCacheGet)(n,e)[c]).join(", ");if(s.length>i+1){var h=function(e){var t={};return Object.keys(e).forEach(r=>{var n=e[r].userIds;(void 0===n?[]:n).forEach(e=>{t[e]=1})}),Object.keys(t).length}(e);f+=" "+getLang("mail_and_peer").replace("{count}",h-i).replace("{typing}",d)}else{if(s.length>1&&(f+=" "+getLang("mail_and_peer_one")),!Object(u.isChatPeer)(t)&&r)f+=" "+d;else f+=` ${Object(T.oCacheGet)(n,s[_.length])[c]} ${d}`}return f.trim()}function pt(){return`<div class="im-page--chat-search-empty">\n    ${getLang("mail_im_search_empty")}\n  </div>`}function gt(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return r?`<a class="im_srv_lnk ${n}" target="_blank" rel="noopener" href="${e}">${t}</a>`:`<span class="${n}">${t}</span>`}function mt(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.kludges,i=a.source_act,o=intval(a.source_mid),s=intval(Object(u.isChatPeer)(r.peerId)?a.from:t.userId),c=s===o,l=Object(T.oCacheGet)(e,s),d="";switch(i){case U:d="mail_im_chat_created";break;case q:d=a.source_is_channel?"mail_im_title_updated_channel":"mail_im_title_updated_dot";break;case W:d=c?"mail_im_returned_to_chat":"mail_im_invited";break;case G:d=c?"mail_im_left":"mail_im_kicked_from_chat";break;case z:d="mail_im_photo_set";break;case K:d=a.source_is_channel?"mail_im_photo_removed_channel":"mail_im_photo_removed";break;case V:d=a.source_message?"mail_im_pin_message":"mail_im_pin_message_empty2";break;case $:d=a.source_message?"mail_im_unpin_message":"mail_im_unpin_message_empty2";break;case Y:d="mail_im_invite_by_link";break;case Q:d=Object(y.unpackStore)(e).id===o?"mail_im_chat_own_screenshot":"mail_im_chat_screenshot";break;default:return"mail_no_support"}if(d=(d=langSex(l.sex,getLang(d,"raw"))).replace("{from}",gt(l.link,l.name,n)),o&&!c){var _=a.source_email;if(_)d=d.replace("{user}",gt("/im?email="+encodeURIComponent(_),"email",n));else{var f=Object(T.oCacheGet)(e,o),h=i===G?f.inv_name:f.kick_name;d=d.replace("{user}",gt(f.link,h,n))}}if(a.source_text){var p=a.source_old_text?`«<b class="im_srv_lnk">${a.source_old_text}</b>» &rarr; `:"";d=d.replace("{title}",p+`«<b class="im_srv_lnk">${a.source_text}</b>»`)}if(a.source_act===V||a.source_act===$)if(a.source_message){var g=vt(Emoji.emojiToHTML(stripHTML(a.source_message.replace(/<br\s?\/?>/gi," ")),!0)),m=gt("",g,!1,"im_srv_mess_link");d=d.replace("{msg}",m)}else d=d.replace(/{link}(.+){\/link}/i,(e,t)=>gt("",t,!1,"im_srv_mess_link"));return d}function bt(e,t,r,n){if(t===z){var a=geByClass1("_im_mess_"+e.messageId,n);if(a){var i=r.tabs[e.peerId];a.parentNode.innerHTML=getTemplate("im_msg_row",{msg_id:e.messageId,from_id:e.peerId,text:mt(r,e,i)+r.chat_photo_msg,ts:e.date,cls:"im-mess_srv _im_mess_srv"})}}return n}function vt(e){return e.replace(/&lt;&lt;/g,"&laquo;").replace(/&gt;&gt;/g,"&raquo;").replace(/ \-\-/g," &mdash;").replace(/\-\- /g,"&mdash; ").replace(a.MENTION_RAW,"$1$4")}function Ct(e,t){return!t&&e===vk.id}function yt(e,t){return Object(d.showTooltip)(e,{url:Object(o.isCommunityPeer)(t)?"al_groups.php":"al_profile.php",params:{act:"verified_tt",mid:t,gid:t},slide:15,ajxdt:200,showdt:200,hidedt:200,dir:"auto",shift:[94,7,7],className:"verified_tt"})}function Tt(e){return function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=se(getTemplate("im_preloader",{preloader:rs(vk.pr_tpl,{id:""}),cls:["bottom"===r?"im-preloader_bottom":"im-preloader_top",n].join(" ")})),i=!1;function o(){i=!0,removeClass(a,"im-preloader_visible"),a.parentNode&&a.parentNode.removeChild(a)}setTimeout(()=>{i||("bottom"===r?e.appendChild(a):e.insertBefore(a,domFC(e)),addClass(a,"im-preloader_visible"))},0),t.then(o).catch(e=>{Object(w.imWeirdCatch)("wrapLoading",e),o()})}}function Et(e,t){return{0:{msgs:e.reduce((e,t)=>(e[t]=[t,n.FLAG_IMPORTANT,0,0,"",{},{},0,0,0],e),{}),hash:t,history:1}}}function Ot(e,t){if(!t&&!e)return!1;var r=e.target||e.srcElement,n=8,a=!1,i=/_im_mess|im_log_act|im_log_ract|_im_log_body|im_log_rspacer|_im_graffiti_w|_wall_post_cont/;do{if(!r||r.onclick||r.onmousedown||"A"==r.tagName||hasClass(r,"_im_no_select")||hasClass(r,"im_msg_media_link")||"IMG"==r.tagName&&!hasClass(r,"_im_graffiti")&&!hasClass(r,"emoji")&&!hasClass(r,"emoji_css")&&!hasClass(r,"im_gift")||"TEXTAREA"==r.tagName||hasClass(r,"play_new")||hasClass(r,"videoplayer")||(a=i.test(r.className)))break}while(n--&&(r=r.parentNode));return!a||!!trim((window.getSelection&&window.getSelection()||document.getSelection&&document.getSelection()||"").toString())}function wt(e,t){return`<div class="im-mess--text">\n      <span>${getLang("mail_restored")}</span>\n      <a class="_im_go_to" href="/im?sel=${Ge(e)}&msgid=${t}">${getLang("mail_im_goto_conversation")}</a>\n    </div>`}function kt(e,t,r){var n=getLang("mail_deleteall1"),a=getLang("mail_sure_to_delete_all"),i=getLang("mail_delete");return Object(u.isChatPeer)(t)&&(Object(k.doesChatTabHaveFlag)(e,1024)?(n=getLang("mail_leave_channel"),a=getLang("mail_unfollow_channel_confirmation"),i=getLang("mail_unfollow_channel")):a=getLang("mail_chat_sure_to_delete_all")),Object(o.isCommunityPeer)(t)&&(a=getLang("mail_group_sure_to_delete_all")),Object(_.showFastBox)(n,a,i,r,getLang("global_cancel"))}function Nt(e,t,r){var n=Object(o.getTab)(e,t),a=Object(u.isChatPeer)(t),i=a&&Object(o.isChannelPeer)(n),s=a&&Object(o.tabIsMessageRequestToChat)(n),c=getLang("mail_deleteall1"),l=getLang("mail_sure_to_delete_all"),d=getLang("mail_delete");if(a){if(!Object(o.isChatActive)(n))return kt(n,t,r.bind(null,!0));i?(c=getLang("mail_leave_channel"),l=getLang("mail_vkcomgroup_leave_confirm"),d=getLang("mail_leave_channel")):s?(c=getLang("mail_reject_mr_confirmation_title"),l=getLang("mail_reject_mr_confirmation_text"),d=getLang("mail_message_request_reject")):(c=getLang("mail_leave_chat"),l=getLang("mail_chat_leave_confirm"),d=getLang("mail_leave_chat"))}Object(o.isCommunityPeer)(t)&&(l=getLang("mail_group_sure_to_delete_all"));var _=new MessageBox({title:c,width:i?450:500}).content(l).setButtons(d,()=>r(!!isChecked(geByClass1("_check_is_delete"))||!a),getLang("global_cancel")).show();return!a||i||s||_.setControlsText(`<div class="checkbox im-delete-forall-checkbox _check_is_delete" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_deleteall1")}</div>`),_}function It(e){return Object(_.showFastBox)(getLang("mail_unpin_title"),getLang("mail_unpin_text"),getLang("mail_unpin"),e,getLang("global_cancel"))}function St(e,t,r,n){var a=getLang("mail_dialog_msg_delete_N",t),i=Object(_.showFastBox)(getLang("mail_dialog_msg_delete_title"),a,getLang("mail_delete"),()=>n(isChecked(geByClass1("_check_forall"))),getLang("global_cancel")),o="",s=!1;return r&&(o=`<div class="checkbox im-delete-forall-checkbox _check_forall" onclick="checkbox(this);" role="checkbox" aria-checked="false">${getLang("mail_delete_for_all")}</div>`,s=cur.imDb.selectByKey("del_forall_checked")),i.setControlsText(o),s&&checkbox(geByClass1("_check_forall")),i}function jt(e,t,r,n,a){t.showProgress(),e.set(n.bind(null,a)).then(()=>{t.hideProgress(),t.hide(),r().removePeer(e,a),r().updateDialogFilters(e)})}function At(e,t,r,n){var a=e.get().tabs[t].memberIds;e.set(n.bind(null,"add_member",a)).then(r().showCreation)}function Mt(e,t,r){var n=e.get();if(n.active_tab===a.FOLDER_ALL&&0===n.dialog_tab_cts.mr)return!1;var i=n.active_tab===a.FOLDER_MESSAGE_REQUEST?a.FOLDER_ALL:a.FOLDER_MESSAGE_REQUEST;return e.set(r.bind(null,i)).then(e=>{t().restoreDialogs(e,!0)})}function Pt(e,t,r){if(e.get().active_tab===a.FOLDER_ALL&&0===e.get().unread_cnt)return!1;var n=e.get().active_tab===a.FOLDER_UNREAD?a.FOLDER_ALL:a.FOLDER_UNREAD;return e.set(r.bind(null,n)).then(e=>{t().restoreDialogs(e,!0)})}function Ft(e,t,r,n){if(t.get().active_tab===e)return Promise.resolve(t);var a=Object(o.isReversedDialogs)(t);return t.set(n.bind(null,e)).then(e=>(r().restoreDialogs(e,!0,a!==Object(o.isReversedDialogs)(e)),e))}function Lt(e,t){void 0===t&&(t=e.get().peer);var r=e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_IMPORTANT]&r.folders}function xt(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t&&(t=e.get().peer),!Object(o.isFoldersAvailable)(e))return!1;var n=r||e.get().tabs[t];return a.FOLDER_MASKS[a.FOLDER_UNRESPOND]&n.folders}function Dt(e,t){return!1===((t.get().block_states||{})[e]||{}).free}function Rt(e){return null!=e.get().pendingForward}function Bt(e,t){return(t.get().block_states[e]||{}).who===vk.id}function Ht(e,t){var r=e.get().block_states;Object.keys(r).forEach(a=>{r[a].time?!1===r[a].free&&Date.now()-r[a].time>=5e4&&t.push([n.mutexEvent([,1,"gim"+e.get().gid,a,0,""])]):r[a].time=Date.now()})}function Ut(e,t,r){var n;return!showTabbedBox("al_im.php",{act:"a_spam",offset:"0",gid:e.get().gid},{onDone:(r,a)=>{a&&(n=t(r,e,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0),n.unmount()}}},r)}function qt(e,t){return Wt(e.get(),t,Object(o.getTab)(e,t).last_seen)}function Wt(e,t,r,n){if(r.platform)return getLang("mail_header_online_status")+(r.mobile?Gt(t,!1,!1,!0):"");if(!r.can_see){var a=Object(T.oCacheGet)(e,t),i=a||e.tabs[t];return function(e,t){var r;switch(e){case"recently":r=getLang("global_online_was_recently","raw");break;case"last_week":r=getLang("global_online_was_week","raw");break;case"last_month":r=getLang("global_online_this_month","raw");break;case"long_ago":r=getLang("global_online_long_ago","raw");break;default:return""}return langSex(t,r)}(r.status,i.sex)}if(!r.time||Date.now()-1e3*r.time>7776e6)return"";var o=getDateText(r.time,e.timeshift),s=langSex(Object(T.oCacheGet)(e,t).sex,getLang("mail_last_activity_tip","raw")).replace("{user}","").replace("{time}",o);return r.mobile&&(s+=Gt(t,!1,!1,n)),s}function Gt(e,t,r,n){var a={mid:e};r||(a.was=1),t?a.forcetoup=!0:a.forcetodown=!0,a=Object.assign(a,n);var i=JSON.stringify(a).slice(1,-1).replace(/"/g,"&quot;");return getTemplate("im_wrap_mobile",{class:"im_status_mob_onl",params:i})}function zt(e,t){var r=t.get().tabs[e];return showBox("al_settings.php",{act:"blacklist_box",q:r.href},{stat:[jsc("web/settings.js"),"settings.css"],dark:1})}function Kt(e,t){return showBox("groupsedit.php",{act:"bl_edit",name:"/id"+e,gid:t.get().gid},{stat:["page.css","ui_controls.js","ui_controls.css"],dark:1})}function Vt(e){return e.get().gid?"/gim"+e.get().gid:"/im"}function $t(e,t,r,n){var a;pr(showTabbedBox("al_im.php",{act:"a_important",offset:"0"},{onDone:(n,i)=>{i&&(a=r(n,e,t,i))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{a&&a.unmount()}}},n),e)}function Yt(){var e=document.activeElement;return null!==e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable"))}function Qt(e,t,r){var n=geByClass1("_im_mess_"+e,r);return n&&toggleClass(n,"im-mess_fav",t),r}function Xt(e,t,r){var n=geByClass1("_im_unread_bar_row",t);if(!n)return t;var a=domClosestSibling(n,"._im_mess_stack",-1),i=domClosestSibling(n,"._im_mess_stack"),s=a?geByClass("_im_mess",a).pop():null,c=i?geByClass1("_im_mess",i):null;if(re(n),ve(t),!c||!s)return t;var u=domData(c,"msgid"),l=Object(o.getPreviousMessage)(e,r,u),d=Object(o.getMessage)(e,r,u);if(!l||qe(e.tabs[r],l,d,e))return t;var _=geByClass1("_im_stack_messages",a),f=geByClass1("_im_stack_messages",i).children;return Object(y.toArray)(f).forEach(e=>{re(e),_.appendChild(e)}),re(i),t}function Jt(e,t,r){var n=Object(o.getFirstUnread)(e,e.get().peer);if(!n)return[!1,0];var a=geByClass1("_im_mess_"+n,t);if(!a){var i=Object(o.getLastMessage)(e,e.get().peer,n);if(!i)return[!0,0];a=geByClass1("_im_mess_"+i.messageId,t)}var s=hasClass(a,"_im_mess_srv")?a:gpeByClass("_im_mess_stack",a);if(!s)return[!0,0];var c=a?a.offsetTop:0,u=s.offsetTop+c,l=r.contHeight();return u<=r.scrollTop()+r.getScrollHeight()?[!0,0]:[!1,Math.max(0,l-u)]}function Zt(e,t,r){cancelEvent(t);var n=gpeByClass("_im_top_notice",r);fadeOut(n,200,re.pbind(n));var a=gpeByClass("_im_page_dialogs",n);a&&hasClass(a,"im-page--dialogs-notice")&&removeClass(a,"im-page--dialogs-notice"),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function er(e,t,r){cancelEvent(t);var n=gpeByClass("_im_aside_notice",r);slideUp(n,200,re.pbind(n)),ajax.post("al_im.php",{act:"a_hide_top_notice",type:n.getAttribute("data-type"),hash:n.getAttribute("data-hash")})}function tr(e,t){cancelEvent(e);var r=gpeByClass("_im_aside_promo_block",t);slideUp(r,200,re.pbind(r)),ajax.post("al_im.php",{act:"a_hide_promo_block",type:r.getAttribute("data-type"),hash:r.getAttribute("data-hash")})}function rr(e,t){gpeByClass("_im_aside_promo_block",t).classList.add("--action-called"),ajax.post("al_im.php",{act:"a_vkadmin_app_install",hash:domData(t,"hash"),platform:domData(t,"platform")})}function nr(e){return e.length>1?function(e){return[].concat(e).sort((e,t)=>"mail"!==e.type?"mail"===t.type?-1:1:0)}(e):e}function ar(e,t,r,n,a){if(r=r.replace(/\<br\s*\/?\>(\n)?/gi," ").replace(/[\n\r]/gi," "),r=Object(c.replaceMentions)(r,(e,t,r,n,a)=>a),n&&(r=Emoji.emojiToHTML(r,!0)),t&&"..."!==t.trim()&&!Object(u.isChatPeer)(e)&&(r=getTemplate("im_topic",{topic:t,cls:"im-topic_dialog"})+r),!r&&a.length>0){var i=nr(a);r=getTemplate("im_dialog_media",{name:ir(i[0],i)})}return r}function ir(e,t){var r={photo:getLang("mail_added_photos","raw"),video:getLang("mail_added_videos","raw"),audio:getLang("mail_added_audios","raw")};switch(e.type){case"mail":var n=e.object?e.object.fwd_count:e.id.split(";").length;return langNumeric(n,getLang("mail_fwd_msgs","raw"),!0);case"photo":case"video":case"audio":var a=t.filter(t=>t.type===e.type).length;return langNumeric(a,r[e.type],!0);case"audio_playlist":return"audio_album"===e.kind?getLang("mail_added_audio_album"):getLang("mail_added_audio_playlist");case"artist":return getLang("mail_added_artist");case"doc":switch(e.kind){case"graffiti":return getLang("mail_added_graffiti");case"audiomsg":return getLang("mail_added_audiomsg");default:return getLang("mail_added_docs")}case"geo":case"map":return getLang("mail_added_geo");case"wall":return getLang("mail_added_wall");case"wall_reply":return getLang("mail_added_wall_reply");case"gift":return getLang("mail_added_gift");case"link":case"share":return getLang("mail_added_link");case"sticker":return getLang("mail_added_sticker");case"market":return getLang("mail_added_market_item");case"money_transfer":return getLang("mail_added_money_transfer");case"money_request":return getLang("mail_added_money_request");case"story":return getLang("mail_added_story");case"mask":return getLang("mail_added_mask");case"article":return getLang("mail_added_article");case"call":return getLang("mail_added_call");case"poll":return getLang("mail_added_poll");case"podcast":return getLang("mail_added_podcast");default:return getLang("mail_added_"+e.type)}return""}function or(e){addClass(e,"im-send-btn_loading")}function sr(e){removeClass(e,"im-send-btn_loading")}function cr(e){var t=e.get(),r=Object(o.getPinnedMessage)(e);if(!r||!Object(E.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e)))return"";var n=Object(T.oCacheGet)(e,r.userId);if(!n)return"";var a=ur(e,r);if(!a)if(!(a=r.text)&&r.attaches.length){var i=nr(r.attaches);a=getTemplate("im_pinned_message_media",{text:ir(i[0],i)})}else a=We(e,a,r&&r.kludges||{})||"";return a=a.replace(/<br\s?\/?>/gi," "),getTemplate("im_pinned_message",{date:getSmDate(r.date,t.timeshift),content:a,link:n.link,name:n.name})}function ur(e,t){var r="";if(t&&Object(s.isMoneyRequest)(t)&&void 0!==t.kludges.attach1_tr_amount){var n="%s "+t.kludges.attach1_currency;if("RUB"===t.kludges.attach1_currency&&(n=getLang("mail_money_amount_rub","raw")),t.kludges.attach1_total_amount){var a=langNumeric(t.kludges.attach1_tr_amount/1e3,"%s",!0),i=langNumeric(t.kludges.attach1_total_amount/1e3,n,!0);r=getLang("mail_money_request_collected_amount_from").replace("{amount}",a).replace("{total_amount}",i)}else{var o=langNumeric(t.kludges.attach1_tr_amount/1e3,n,!0);r=getLang("mail_money_request_collected_amount").replace("{amount}",o)}if(intval(t.kludges.attach1_held_amount)){var c=langNumeric(t.kludges.attach1_held_amount/1e3,n,!0);r+=" "+getLang("mail_money_request_held_amount").replace("{amount}",c)}t.text&&(r+='<span class="divider"></span>'+We(e,t.text,t.kludges)),t.kludges.attach1_total_amount&&(r+=getTemplate("im_pinned_message_media_bar",{percent:Math.min(100,Math.floor(t.kludges.attach1_tr_amount/t.kludges.attach1_total_amount*100))}))}return r}function lr(e,t,r){var n=r.getAttribute("data-info");n&&Object(d.showTooltip)(r,{text:n,className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,hidedt:1e3,shift:[0,4]})}function dr(e,t,r){var n=+r.getAttribute("data-time");n&&Object(d.showTooltip)(r,{text:getLang("mail_message_edited")+" "+getSmDate(n,e.get().timeshift),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[0,4]})}function _r(e,t,r){var n=r.target,a=n.closest("."+B),i=a.querySelector("."+H);if(i){var o,s=Number(i.getAttribute("data-msgid")),c=S.casperMessagesStore.getExpireTime(s),u="_im_bomb_tooltip_"+Math.round(1e4*Math.random()).toString(16);if(window.tooltips){var l=t.querySelectorAll(".im-mess-stack--bomb");Array.from(l).forEach(e=>{e!==n&&tooltips.hide(e,{fasthide:!0})})}var _=fr(e);Object(d.showTooltip)(n,{text:h(formatTime(c)),className:"_im_history_tooltip "+u,appendParentCls:B,black:1,shift:[12,4],onShowStart:f,onShowEnd(){o=setTimeout(f,500)},onHide(){clearTimeout(o)},force:!0,toup:n.getBoundingClientRect().top>_+37,hasover:!0}),setTimeout(f,500)}function f(){var e=a.querySelector(`.${u} .tt_text`);e&&(e.innerHTML=h(formatTime(S.casperMessagesStore.getExpireTime(s)))),o=setTimeout(f,500)}function h(e){return`<div class="wrapped">${e}</div>`}}function fr(e){var t=Object(o.getPeer)(e),r=Object(o.getTab)(e,t),n=Object(E.isPinnedMessageVisibleInTab)(e,Object(o.getPeer)(e))||r&&r.top_banner,a=Object(j.getPeerProfileHeight)();return 105+(n?hr(e):0)+a}function hr(e){var t=Object(o.getPinnedMessage)(e);return t&&Object(s.isMoneyRequest)(t)?62:52}function pr(e,t){e.bodyNode.addEventListener("mouseover",e=>{hasClass(e.target,"_im_edit_time")?dr(t,0,e.target):hasClass(e.target,"_im_page_info")&&lr(0,0,e.target)})}function gr(e,t,r,n,a){var i,o=e.get();pr(showTabbedBox("al_im.php",{act:"a_get_pinned_message_box",chat:r,gid:e.get().gid,hash:o.tabs[r].hash},{onDone:(r,a)=>{a&&(i=n(r,e,t,a))},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{i&&i.unmount()}}},a),e)}function mr(e,t,r){var n=e.get();pr(showTabbedBox("al_im.php",{act:"a_get_replied_message_box",chat:n.peer,msgid:t,gid:n.gid,hash:n.tabs[n.peer].hash},{onDone:(e,t)=>{},params:{width:638,onHide:()=>{AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(!0)},onDestroy:()=>{}}},r),e)}function br(e,t){return!(!Object(u.isChatPeer)(e.peerId)||!e.memberIds)&&e.memberIds.indexOf(t)>=0}function vr(e){return!Object(u.isChatPeer)(e.peerId)||e.data.kicked?0:e.membersCount}function Cr(e,t){var r=Object(T.oCacheGet)(e,t.peerId),n=Object(o.getTab)(e,t.peerId)||{};return r&&(t.photo=t.photo||r.photo,t.name=t.name||r.name,t.href=t.link||r.link,t.sex=t.sex||r.sex),t.last_touched=n.last_touched||0,t.verified=!!t.verified,t.lastmsg=t.lastmsg||t.lastmsg_meta&&t.lastmsg_meta[0]||!1,t.folders=t.folders||null,t.unread=t.unread||0,t.last_seen=t.last_seen||{platform:0,time:0,mobile:0,can_see:0},t.online=t.last_seen&&t.last_seen.platform||0,t.out_up_to=null!=t.out_up_to?t.out_up_to:t.in_up_to||0,Object(u.isChatPeer)(t.peerId)&&(t.memberIds=t.memberIds||n.memberIds||null),t}function yr(e,t){for(var r in t)t.hasOwnProperty(r)&&Cr(e,t[r])}function Tr(e,t){var r=[],n=t.find(e=>"mail"===e[0]),a=n?n[1].split(";"):[];for(a.length>100&&(n[1]=a.slice(0,100).join(";"));e.length>4096;){var i=e.substr(0,4096).lastIndexOf(" ");-1==i&&(i=4096),r.push({msgText:trim(e.substr(0,i))}),e=trim(e.substr(i))}for(e.length&&r.push({msgText:e,attaches:t}),r.length||r.push({attaches:t}),a=a.slice(100);a.length;a=a.slice(100))r.push({attaches:[["mail",a.slice(0,100).join(";")]]});return r}function Er(e){return e.length>4096}function Or(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=Object.assign(wr(t,n),{act:"a_chat_preview"}),o=!1;showBox("al_im.php",i,{stat:["boxes.css"],params:{dark:1,hideButtons:!0,onHide(){e.set(r),o&&o.unmount()}},onFail:e=>(setTimeout(()=>Object(_.showFastBox)(getLang("global_error"),e),0),!0),onDone(t){o=C(t.bodyNode,e,a)}},{})}function wr(e,t){return t?{chat_id:e.invite_chat_id,hash:e.invite_hash}:e}function kr(){Object(_.showFastBox)(getLang("global_error"),getLang("mail_message_wait_until_uploaded"))}function Nr(e,t){var r=Object(o.getTab)(e,t.peerId)||{},n=e.get(),a=Object(u.isChatPeer)(t.peerId)&&Object(k.isUserAdminInChat)(r,n.id),i=Object(u.isChatPeer)(t.peerId)&&Object(k.isUserAdminInChat)(r,t.userId);if(!t)return!1;if(!Object(s.isOut)(t)&&(!a||i))return!1;if(333==t.peerId)return!1;if(Date.now()/1e3-t.date>86400)return!1;if(fe(e,t.peerId,t.messageId))return!1;if(Object(u.isChatPeer)(t.peerId)){if(!Object(o.isChatActive)(r))return!1}else if(r.block_error>0)return!1;return!0}function Ir(e,t){var r=Object(o.getTab)(e,t),n=-1!==r.memberIds.indexOf(r.ownerId),a=n?[r.ownerId]:[];return(a=a.concat(r.memberIds.filter(t=>t!==r.ownerId&&Object(T.oCacheExists)(e,t)).slice(0,n?4:5))).map(t=>Object(T.oCacheGet)(e,t))}function Sr(e,t){return t.map(t=>Object(T.oCacheGet)(e,t))}function jr(e,t){return Object(o.getTab)(e,t).memberIds.reduce((t,r)=>{var n=Object(T.oCacheGet)(e,r);return t[n.id]=n,t},{})}function Ar(e,t){if("number"!=typeof e||0===e)return"";var r,n=[[31536e3,t?getLang("global_years_accusative","raw"):getLang("global_age_years","raw")],[2592e3,t?getLang("global_months_accusative","raw"):getLang("global_age_months","raw")],[604800,t?getLang("global_weeks_accusative","raw"):getLang("global_age_weeks","raw")],[86400,t?getLang("global_days_accusative","raw"):getLang("global_age_days","raw")],[3600,t?getLang("global_hours_accusative","raw"):getLang("global_hours","raw")],[60,t?getLang("global_minutes_accusative","raw"):getLang("global_minutes","raw")],[1,t?getLang("global_seconds_accusative","raw"):getLang("global_age_seconds","raw")]],a=e,i=[];if(n.forEach(e=>{var t=A(e,2),r=t[0],n=t[1],o=Math.floor(a/r);a%=r,o>=1&&i.push(langNumeric(o,n))}),1===(r=i.length))return i.pop();var o=i.slice(0,r-1).join(", "),s=i.pop();return getLang("global_and").replace(/{before}/gi,o).replace(/{after}/gi,s)}function Mr(e,t,r,a){a&&!fe(e,r,a)&&(Object(o.getMessage)(e,r,a)?(e.setState({msgid:a}),Object(i.updateLocation)({msgid:a}),t()):e.get().longpoll.push([n.changePeer(r,a)]))}function Pr(e){var t=geByClass1("im-mess_is_editing");if(!t)return null;var r=e.get().tabs[e.get().peer],n=Object(o.parserMessage)(r.msgs[domData(t,"msgid")]);return n&&n.peerId==e.get().peer?n:null}function Fr(e,t){if(Object(o.isClassicInterface)(e)){var r=document.getElementById("ui_rmenu_mr");r&&(Object(o.existsIncomingMessageRequest)(e)?r.classList.remove("unshown"):r.classList.add("unshown"))}else t(e)}function Lr(e){var t=Object(y.unpackStore)(e),r=Number(t.dialog_tab_cts[a.FOLDER_MESSAGE_REQUEST]),n=r>0?r:"",i=document.querySelector('._im_right_menu_counter[data-tab="mr"]');i&&(i.innerHTML=n)}function xr(){for(var e=curBox();e;)e.hide(),e=curBox()}function Dr(e,t){return getLang("mail_invitation_sended_ago").replace("{when}",getDateText(e,t))}function Rr(e,t){var r=Object(o.getPeer)(e),n=Object(o.getMessage)(e,r,t);return Object(k.canPinOrUnpin)(e,r)&&!Object(s.hasPrivateStory)(n)&&!Object(s.isCasperMessage)(n)}function Br(e,t){var r=Object(o.getPeer)(e);return!t.find(t=>{var n=Object(o.getMessage)(e,r,t);return Object(s.hasPrivateStory)(n)||Object(s.isCasperMessage)(n)})}function Hr(e,t){var r=Object(o.getPeer)(e);return!t.find(t=>{var n=Object(o.getMessage)(e,r,t);return Object(s.isCasperMessage)(n)})}function Ur(e,t){var r=S.casperMessagesStore.isProcessed(e.messageId),n=S.casperMessagesStore.has(e.messageId),a=S.casperMessagesStore.getExpireTime(e.messageId)>S.MAX_DEVIATION;(!n&&!r||n&&a)&&t(e),n&&a&&S.casperMessagesStore.remove(e.messageId)}function qr(e){return e===vk.id}function Wr(e,t){return Object(u.isUserPeer)(t)&&!qr(t)&&!Object(o.isCommunityInterface)(e)&&!xe(t)}function Gr(e,t){var r=e.get(),n=Object(o.isCommunityInterface)(e);return Object(u.isUserPeer)(t)&&!qr(t)&&!n&&!inArray(t,r.moneyTransferExcept)&&!xe(t)||Object(o.isCommunityPeer)(t)&&r.moneyTransferCommAvail&&Object(o.getCurrentTab)(e).moneyTransferAvail&&!n||n&&r.moneyRequestAvail&&!Object(u.isChatPeer)(t)||Object(u.isChatPeer)(t)&&Object(o.getCurrentTab)(e).moneyRequestAvail&&!Object(o.isCasperChat)(e,t)}function zr(e,t,r){var n=geByClass1("_im_mess_"+r.messageId,t),a=n&&n.closest("._im_mess_stack");if(!n||!a)return t;var i,o,s,c=Array.from(a.querySelectorAll("._im_mess")),u=A((o=(i=a).previousElementSibling,s=i.nextElementSibling,[o&&1===o.nodeType?o:null,s&&1===s.nodeType?s:null]),2),l=u[0],d=u[1],_=l&&l.classList.contains("im-expired-message"),f=d&&d.classList.contains("im-expired-message"),h=_&&0===c.findIndex(e=>+e.getAttribute("data-msgid")===r.messageId),p=f&&c.findIndex(e=>+e.getAttribute("data-msgid")===r.messageId)===c.length-1,g=Kr((h?+l.getAttribute("data-count"):0)+(p?+d.getAttribute("data-count"):0)+1,"_im_expired_message_"+r.messageId),m=se(g);if(h&&(m.classList.add(...l.classList),l.remove()),p&&(m.classList.add(...d.classList),d.remove()),1===c.length)a.replaceWith(m);else{var b=A(c.reduce((e,t)=>{var n=+t.getAttribute("data-msgid");return n<r.messageId&&e[0].push(t),n>r.messageId&&e[1].push(t),e},[[],[]]),2),v=b[0],C=b[1];a.replaceWith(se(Vr(e,v))||"",m,se(Vr(e,C))||"")}return t}function Kr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return getTemplate("sImExpiredMessagePlaceholder",{text:langNumeric(e,getLang("mail_messages_expired","raw")).replace("{count}",e),count:e,id_classes:Object(l.classNames)(t)})}function Vr(e,t){if(0===t.length)return"";var r=+t[0].getAttribute("data-peer"),n=+t[0].getAttribute("data-msgid"),a=Object(o.getMessage)(e,r,n);return getTemplate("im_mess_stack",Object.assign($r(e,a),{messages:t.reduce((e,t)=>e+t.outerHTML,"")}))}function $r(e,t){var r=Object(y.unpackStore)(e),n=t.peerId,a=t.messageId,i=Object(o.getTab)(e,n),c=Object(s.getUserId)(t),d=Object(s.getAdminId)(e,t),_=Object(T.oCacheGet)(r,d?-r.gid:c)||i,f=Object(u.isChatPeer)(n)?_.name:_.first_name,h=_.link||i.href,p=Object(u.isChatPeer)(n)&&_.covid_status?_.covid_status:"",g=getTemplate("im_mess_stack_name",{name:f+p,link:h,class:Object(s.isMoney)(t)?" im-mess-stack--lnk-money-transfer":""});if(Object(s.isGift)(t)&&(g+=getTemplate("sImGiftLabel",{content:langSex(_.sex||0,getLang("mail_gift_message_sent","raw"))})),Object(s.isMoney)(t)){var m=Object(s.isMoneyRequest)(t)?getLang("mail_money_request_message_sent","raw"):getLang("mail_money_tranfer_message_sent","raw");g+=getTemplate("sImMoneyTransferLabel",{content:langSex(_.sex||0,m)})}var b=function(e,t){var r=Object(y.unpackStore)(e),n=t.peerId,a=t.messageId,i=Object(u.isChatPeer)(n)&&Object(o.isCasperChat)(r,n)?"":(f=t.date,h=r.timeshift,langDate(1e3*f,"{hour}:{minute} {am_pm}",1e3*h,[],!0)),c=Object(s.getAdminId)(e,t),d=Object(o.isCommunityInterface)(e)?"/gim"+r.gid:"/im",_=t.local?getTemplate("im_stack_date",{date:i,link:`${d}?sel=${n}&msgid=${a}`}):i;var f,h;if(c&&r.admins[c]){var p=r.admins[c],g=c===vk.id?getLang("mail_by_you"):p[0];_+=" "+getTemplate("im_admin_link",{name:g,href:p[1]})}return _+function(e,t){if(!Object(s.isCasperMessage)(t))return"";var r=A(S.casperMessagesStore.getTimings(t.messageId),3),n=r[0],a=r[1],i=r[2],c=Math.max(n+a-i,0);return getTemplate("sImBomb",{classnames:Object(l.classNames)({"im-mess-stack--bomb_hidden":Object(o.isCasperChat)(e,t.peerId),"im-mess-stack--bomb_expiring":c<=S.EXPIRING_TIME,"im-mess-stack--bomb_expiring-soon":c<=S.EXPIRING_SOON_TIME})})}(r,t)}(e,t);return{photo:_.photo,href:h,cls:"",date_attr:"",link:`/im?sel=${n}&msgid=${a}`,name:stripHTML(g),stack_name:g,peerId:c,messageMeta:b,admin:d}}function Yr(e,t){var r=`._im_replied_message[data-msgid="${t.messageId}"] .im-replied--text`;Array.from(e.querySelectorAll(r)).forEach(e=>{e.innerHTML=getTemplate("im_dialog_media",{name:getLang("mail_expired_message")})})}function Qr(e){return Object(u.isChatPeer)(e.peerId)&&e.membersCount?langNumeric(e.membersCount,getLang("mail_im_n_chat_members","raw")):""}function Xr(e,t,r){if(e.get().isCallsEnabled&&window.Calls&&window.Calls.call){var n=Object(T.oCacheGet)(e,t);window.Calls.call(t,r,n).catch(e=>Object(_.showFastBox)(getLang("global_error"),e))}}function Jr(e,t){var r=e.get(),n=Object(o.getTab)(e,t);return!!r.isCallsEnabled&&(!Object(o.isCommunityInterface)(e)&&(!!Object(u.isUserPeer)(t)&&!!n.can_start_call))}},PU8N:function(e,t,r){"use strict";function n(){return!!window.isMVK}function a(e){return void 0===e&&(e=""),new Promise((function(t,r){var n=document.createElement("video");n.addEventListener("loadedmetadata",(function(){return t(n.duration)}),{once:!0}),n.addEventListener("error",r,{once:!0}),n.crossOrigin="anonymous",n.preload="metadata",n.src=e}))}function i(e){return new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){if(404===n.response.status)return r();t(n.response)},n.onerror=r,n.send()}))}function o(e){try{return e.type.split("/").splice(-1)[0]}catch(e){return null}}r.r(t),r.d(t,"isMvk",(function(){return n})),r.d(t,"getVideoDuration",(function(){return a})),r.d(t,"getMediaBlob",(function(){return i})),r.d(t,"getBlobType",(function(){return o})),r.d(t,"noop",(function(){return s})),r.d(t,"getAverageRGB",(function(){return c})),r.d(t,"loadImage",(function(){return u}));var s=function(){};function c(e){var t,r={r:0,g:0,b:0};try{t=e.getImageData(0,0,e.canvas.width,e.canvas.height)}catch(e){return r}for(var n=-4,a=0;(n+=20)<t.data.length;)++a,r.r+=t.data[n],r.g+=t.data[n+1],r.b+=t.data[n+2];return r.r=~~(r.r/a),r.g=~~(r.g/a),r.b=~~(r.b/a),r}function u(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="anonymous",n.onerror=function(){return r(new Error("Failed to load image's URL: "+e))},n.onload=function(){return t(n)},n.src=e}))}},S2bU:function(e,t,r){"use strict";r.r(t),r.d(t,"replaceHyperLinks",(function(){return o})),r.d(t,"replaceEmailLinks",(function(){return s})),r.d(t,"replaceMentions",(function(){return c})),r.d(t,"replaceMassMentions",(function(){return u})),r.d(t,"replaceHashtags",(function(){return _})),r.d(t,"linksReplacer",(function(){return f}));var n,a=r("h++7"),i=r("t7n3");function o(e,t){for(var r,n=0,i=e;null!==(r=a.MESSAGE_REGEXP.exec(e));){var o=(r=l(r))[0].length,s=r.index+o,c=e[r.index-1],u=e[s-1],_=void 0!==c&&/([\w\$А-Яа-яёЁєЄҐґЇїІіЈј\—\-\_@;.])/i.test(c),f=void 0!==u&&/([:;$])/i.test(u);if(!_&&!f){var h=d(r),p=h.domain.toLowerCase();if(p.length<=a.MAX_DOMAIN_LENGTH&&a.TOP_DOMAINS.includes(p)){var g=t(h);i=i.slice(0,r.index+n)+g+i.slice(s+n),n+=g.length-o}}}return i}function s(e,t){return e.replace(a.EMAIL,t||function(e){return'<a href="mailto:'+e+'">'+e+"</a>"})}function c(e,t){return e.replace(a.MENTION,t||function(e,t,r,n,a){return'<a href="/'+(t+r)+'" class="mem_link" mention="'+Object(i.clean)(n||"")+'" mention_id="'+Object(i.clean)(t+r)+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">'+a+"</a>"})}function u(e,t){return e.replace(a.RE_MASSMENTION,(function(e){return t?t(e,"","",e,e):'<span class="mem_pseudolink">'+e+"</span>"}))}function l(e){if(!e[0]||!e[6])return e;var t=e[0].length-1,r=e[6].length-1;return"."===e[0][t]&&"."===e[6][r]&&(e[0]=e[0].slice(0,t),e[6]=e[6].slice(0,r)),e}function d(e){return{full:e[0],protocol:e[1]||"http://",url:e[2],domain:e[4],query:e[6]||""}}function _(e,t){return e.replace((n||(n=new RegExp(a.RE_HASHTAG_EXTRACTION_PATTERN,"ig")),n),(function(e,r,n,a,i){return(r||"")+t(n+(i||""))}))}function f(e,t){var r=t.url,n=t.full,o=t.protocol,s=t.query,c=t.domain;try{n=decodeURIComponent(n)}catch(e){}if(n.length>55&&(n=n.substr(0,53)+".."),n=Object(i.clean)(n).replace(/&amp;/g,"&"),!e&&c.match(a.OUR_DOMAINS)){var u=r=Object(i.replaceEntities)(r).replace(a.ENTITIES,encodeURIComponent),l=r.indexOf("#/"),d="";l>=0?u=r.substr(l+1):(l=r.indexOf("#!"))>=0&&(u="/"+r.substr(l+2).replace(/^\//,""));var _=u.match(a.VK_DOMAIN);return _&&_[1].length<32&&(d=' mention_id="'+_[1]+'" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)"'),'<a href="'+function(e){return e.replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}(o+r+s)+'" target="_blank" rel="noopener"'+d+">"+n+"</a>"}var f=Object(i.replaceEntities)(r+s).toString();return'<a href="'+("away.php?utf=1&to="+encodeURIComponent(o+f))+'" target="_blank" rel="noopener" onclick="'+("return goAway('"+Object(i.clean)((o+r+s).replace(/'/g,"\\'"))+"', {}, event);")+'">'+n+"</a>"}},Syd7:function(e,t,r){"use strict";r.r(t),r.d(t,"getPeerProfileHeight",(function(){return K})),r.d(t,"mount",(function(){return $}));var n=r("q1tI"),a=r("i8i4"),i=r("rHUl"),o=r("P13b"),s=(r("91GP"),r("17x9"),r("pemR")),c=r("ErRf"),u=r("nAFc"),l=r("ERyv"),d=r("4+be"),_=r("6krn"),f=r("BN/X"),h=r("6aSF"),p=r("XpgC"),g=r("vT4u"),m=r("EasH"),b=_.default.getLang;class v extends n.Component{constructor(){super(...arguments),this.onAdTagAlertClick=()=>{Object(m.showFastBox)(b("mail_ad_tag_no_access_box_title"),b("mail_ad_tag_no_access_box_text"))}}render(){var e=this.props.data;if(e.adId){var t=`ads?act=office&union_id=${e.adId}&utm_medium=community_messages_ad_tag&utm_source=dialog`;return n.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--adTag"},e.hasAdAccess&&n.createElement(f.default,{className:"PeerProfileTagsListItem__adTagLink",href:t,target:"_blank"},n.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},b("mail_ad_tag_text_prefix")," ",e.adId)),!e.hasAdAccess&&n.createElement("button",{className:"PeerProfileTagsListItem__adTagAlert",onClick:this.onAdTagAlertClick},n.createElement("span",{className:"PeerProfileTagsListItem__adTagText"},b("mail_ad_tag_no_access_text"))))}return n.createElement("div",{className:"PeerProfileTagsListItem",style:{backgroundColor:e.color}},n.createElement("span",null,Object(u.decodeHTMLEntities)(e.name)))}}var C=v,y=_.default.getLang;class T extends n.Component{constructor(e){super(e),this.onExtraClick=()=>{this.setState({isTagsCollapsed:!1})},this.state={isTagsCollapsed:!0}}render(){var e=this.props,t=e.peerTags,r=e.tags,a=e.isPeerProfileCollapsed,i=e.adId,o=e.hasAdAccess,s=e.toggleProfile,c=r.filter(e=>t.includes(e.id));i&&c.unshift({adId:i,hasAdAccess:o});var u=0;a&&this.state.isTagsCollapsed&&c.length>5&&(u=c.splice(5).length);return c=c.map((e,t)=>n.createElement(C,{key:t,data:e})),n.createElement("div",{className:"PeerProfileTagsList"},c.length>0&&c,u>0&&n.createElement("div",{className:"PeerProfileTagsListItem PeerProfileTagsListItem--extra",onClick:this.onExtraClick},"+ "+y("mail_im_peer_profile_extra_tags",u)),!c.length&&n.createElement("div",{className:"PeerProfileTagsListItem--empty"},y("mail_im_peer_profile_tags_empty")," ",n.createElement("span",{className:"PeerProfileTagsList__linkDivider"},"·")," ",n.createElement(f.default,{href:"#",className:"PeerProfileTagsList__toggleProfileLink",onClick:s},y(a?"mail_im_peer_profile_toggle_tags_on":"mail_im_peer_profile_toggle_tags_off"))))}}var E=T,O=r("0Rlc");var w=function(e){var t=e.data,r=e.onCheckboxChange;return n.createElement("div",{className:"PeerProfileTagsGridItem"},n.createElement(O.default,{className:"PeerProfileTagsGridItem__checkbox",onChange:(e,n)=>r(t.id,n),checked:t.isChecked}),n.createElement("span",{className:"PeerProfileTagsGridItem__color",style:{backgroundColor:t.color}}),n.createElement("span",{className:"PeerProfileTagsGridItem__name",title:t.name},Object(u.decodeHTMLEntities)(t.name)))};class k extends n.Component{constructor(){super(...arguments),this.onCheckboxChange=(e,t)=>{this.props.onPeerTagsChange(e,t)}}render(){var e=this.props.tags;return n.createElement("div",{className:"PeerProfileTagsGrid"},e.map((e,t)=>n.createElement(w,{key:t,data:e,onCheckboxChange:this.onCheckboxChange})))}}var N=k,I=r("r7nW"),S=r("Ht+d"),j=r("6raB"),A=r("0toi"),M=_.default.getLang;class P extends n.Component{constructor(e){super(e),this.onKeyDown=e=>"Enter"!==e.key||(e.preventDefault(),!1),this.inputRef=n.createRef()}componentDidMount(){this.props.data.id||this.inputRef.current.focus()}render(){var e=this.props,t=e.index,r=e.data,a=e.onNameChange,i=e.onRemove;return n.createElement("div",{className:"PeerProfileTagsModalField"},n.createElement("input",{type:"hidden",value:r.id?r.id:""}),n.createElement("input",{type:"text",className:"PeerProfileTagsModalField__input",value:Object(u.decodeHTMLEntities)(r.name),ref:this.inputRef,onChange:e=>a(e,t),onKeyDown:this.onKeyDown,maxLength:20,placeholder:M("mail_im_peer_profile_manage_tags_placeholder")}),n.createElement("span",{className:"PeerProfileTagsModalField__color",style:{backgroundColor:r.color}}),n.createElement(p.default,{position:"t",text:M("mail_im_peer_profile_manage_tags_remove")},n.createElement("span",{className:"PeerProfileTagsModalField__remove",onClick:()=>i(t)})))}}var F=P;function L(){return(L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var x=_.default.getLang,D=["#4bb34b","#5c9ce6","#e64646","#792ec0","#63b9ba","#ffa000","#ffc107","#76787a","#9e8d6b","#45678f","#539b9c","#454647","#7a6c4f","#6bc76b","#5181b8","#ff5c5c","#a162de","#7ececf","#aaaeb3","#bbaa84"],R=D[0];class B extends n.Component{constructor(e){super(e),this.generateEmptyTag=()=>({name:"",color:this.state&&this.state.tags.length?this.getAvailableColor():R,state:"new"}),this.getAvailableColor=()=>{var e=[...this.state.tags].reduce((e,t)=>("deleted"!==t.state&&(e[t.color]=!0),e),{});return D.find(t=>!e[t])},this.onAddLinkClick=e=>{e&&e.preventDefault(),this.state.tags.filter(e=>"deleted"!==e.state).length>=20||this.setState(e=>({tags:[...e.tags,this.generateEmptyTag()]}),()=>{this.inputsRef.current.scrollIntoView({block:"end"})})},this.onNameChange=(e,t)=>{var r=e.target.value;this.setState({tags:this.state.tags.map((e,n)=>n===t?L({},e,{name:r,state:e.state||"changed"}):e)})},this.onRemove=e=>{var t=this.state.tags[e];this.setState({tags:this.state.tags.filter((t,r)=>r!==e),deletedTags:[...this.state.deletedTags,L({},t,{state:"deleted"})]})},this.onSubmit=e=>{e&&e.preventDefault();var t=[...this.state.tags,...this.state.deletedTags].reduce((e,t)=>(t.name.trim()&&t.state&&e.push({id:t.id,name:t.name,color:t.color,state:t.state}),e),[]);this.setState({isLoading:!0}),this.props.onSave(t)},this.state={tags:e.tags.length?e.tags.map(e=>L({},e)):[this.generateEmptyTag()],deletedTags:[],isLoading:!1},this.inputsRef=n.createRef()}render(){return n.createElement(I.default,{onClose:this.props.onClose,className:"PeerProfileTagsModal",disableBackdropClick:!0,disableEscapeClose:!0},n.createElement("form",{onSubmit:this.onSubmit},n.createElement(A.default.Header,{title:x("mail_im_peer_profile_manage_tags_box_title"),onClose:this.props.onClose,appearance:"blue"}),n.createElement(A.default.Body,null,n.createElement(h.default,{className:"PeerProfileTagsModal__scroll",neverHide:!0},n.createElement("div",{className:"PeerProfileTagsModal__tagsInputs",ref:this.inputsRef},this.state.tags.map((e,t)=>n.createElement(F,{index:t,key:t,data:e,onNameChange:this.onNameChange,onRemove:this.onRemove})),this.state.tags.length<20?n.createElement(f.default,{href:"#",className:"PeerProfileTagsModal__addLink",onClick:this.onAddLinkClick},x("mail_im_peer_profile_manage_tags_add_link")):""))),n.createElement(A.default.Footer,{actionButtons:[n.createElement(S.default,{key:"cancel",appearance:"secondary",onClick:this.props.onClose},x("global_cancel")),n.createElement(j.default,{key:"save",onClick:this.onSubmit,loading:this.state.isLoading},x("global_save"))]})))}}var H=B;function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var q=_.default.getLang;class W extends n.PureComponent{constructor(e){super(e),this.toggleProfile=()=>{this.setState({isCollapsed:!this.state.isCollapsed})},this.onPeerTagsChange=(e,t)=>{var r=this.props.store,n=r.get().peer;this.setState(r=>({peerTags:t?[].concat(r.peerTags,e):r.peerTags.filter(t=>t!==e)}),()=>{r.set(g.peerProfileToggleTag.bind(null,e,t?"bind":"unbind",n,[...this.state.peerTags])).catch(e=>Object(l.imWeirdCatch)("PeerProfile.toggleTag",e))})},this.onSave=e=>{this.setState({tags:e},()=>{this.props.store.set(g.peerProfileManageTags.bind(null,[...this.state.tags])).then(e=>{var t=e.get().peer_profile_tags;this.setState({isCollapsed:0===t.length,tags:t,isModalOpened:!1}),showDoneBox(q("mail_im_peer_profile_manage_tags_success"),{out:1e3})}).catch(e=>Object(l.imWeirdCatch)("PeerProfile.manageTags",e))})},this.toggleModal=(e,t)=>{e&&e.preventDefault(),this.setState({isModalOpened:t}),t&&Object(c.cancelStackPush)("peer_profile_tags_modal",()=>{Object(c.cancelStackFilter)("peer_profile_tags_modal"),this.toggleModal(null,!1)})};var t=e.store.get(),r=t.peer,n=Object(i.getTab)(t,r);this.state={isCollapsed:!0,tags:t.peer_profile_tags||[],peerTags:n.peer_tags||[],isModalOpened:!1}}render(){var e=this.props.store.get(),t=Object(i.getTab)(e,e.peer),r=this.state,a=r.isCollapsed,o=r.tags,c=r.peerTags,l=r.isModalOpened,_=o.length>0,g=_?o.reduce((e,t)=>(e[t.id]=!0,e),{}):[],m=c.filter(e=>g[e]),b=t.peer_profile_info,v=b&&(b.city||b.age),C=Object(s.classNames)("PeerProfile__wrapper",{"PeerProfile__wrapper--collapsed":a});return n.createElement("div",{className:C},n.createElement(h.default,{className:"PeerProfile__scroll",neverHide:!0},n.createElement("dl",{className:"PeerProfile__container"},n.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_tags_label"),":"),n.createElement("dd",{className:"PeerProfile__content PeerProfile__tags"},a&&!_&&!t.ad_id&&n.createElement(f.default,{href:"#",className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0)},q("mail_im_peer_profile_manage_tags")),(_||t.ad_id)&&n.createElement(E,{tags:o,peerTags:m,isPeerProfileCollapsed:a,adId:t.ad_id,hasAdAccess:t.has_ad_access,toggleProfile:this.toggleProfile}),!a&&n.createElement(N,{tags:[...o].map(e=>U({},e,{isChecked:c.includes(e.id)})),onPeerTagsChange:this.onPeerTagsChange}),!a&&n.createElement(f.default,{href:"#",className:"PeerProfile__manageTagsLink",onClick:e=>this.toggleModal(e,!0)},q("mail_im_peer_profile_manage_tags")),l&&n.createElement(H,{tags:o,onSave:this.onSave,onClose:e=>this.toggleModal(e,!1)})),n.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_info_label"),":"),n.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},v&&n.createElement(n.Fragment,null,b.city&&n.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(b.city)),b.age&&n.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(b.age)),b.likes_cnt&&n.createElement(p.default,{className:"PeerProfile__infoTooltip",position:"t",text:q("mail_peer_profile_likes_replies_tooltip"),appearance:"light"},n.createElement("span",{className:"PeerProfile__infoItem"},b.likes_cnt&&n.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(b.likes_cnt)),b.replies_cnt&&n.createElement("span",{className:"PeerProfile__infoItem"},Object(u.decodeHTMLEntities)(b.replies_cnt))))),!v&&n.createElement("span",null,q("mail_im_peer_profile_info_empty"))),n.createElement("dt",{className:"PeerProfile__label"},q("mail_im_peer_profile_join_date_label"),":"),n.createElement("dd",{className:"PeerProfile__content PeerProfile__info"},b&&b.join_date?Object(u.decodeHTMLEntities)(b.join_date):Object(d.langSex)(t.sex,q("mail_im_peer_profile_join_date_empty_text","raw"))))),(_||t.ad_id)&&n.createElement("button",{className:"PeerProfile__toggler",onClick:this.toggleProfile}))}}var G=W;function z(){return document.querySelector("#PeerProfile")}function K(){var e=z();return e?e.offsetHeight:0}function V(e,t){if(t){var r=parseInt(getStyle(e,"padding-top"));e.style.paddingTop=r+K()+"px"}else e.style.removeProperty("padding-top")}function $(e){return{render(t){var r=t.get(),s=z(),c=r.peer,u=Object(i.getTab)(r,c);r.is_peer_profile_enabled&&s&&Object(o.isFullyLoadedTab)(r,c)&&!Object(i.isChannelPeer)(u)&&!Object(i.isCommunityChat)(t,c)&&(s.innerHTML&&a.unmountComponentAtNode(s),a.render(n.createElement(G,{store:t}),s,()=>{V(e,!0)}))},destroy(){var t=z();t&&(a.unmountComponentAtNode(t),V(e,!1))}}}},V1Nw:function(e,t,r){"use strict";function n(e,t,r){var n=0,a=e,i=[],o=!1;function s(){!i.length||n>0||o||(t(i),i=[])}return{pause:function(){n++},resume:function(){n>0&&(n--,s())},onLp:function(e,t,n){o||(a>=e?(a=t,i.push.apply(i,n),s()):r&&(o=!0,r(a).then((function(e){var t=e[1],r=e[2];a=t,o=!1,i.push.apply(i,r),s()}))))}}}r.r(t),r.d(t,"createLongpollEventsQueue",(function(){return n}))},Wu9C:function(e,t,r){"use strict";r.r(t),r.d(t,"isPinnedMessageVisibleInTab",(function(){return _})),r.d(t,"pinnedMessageHide",(function(){return f})),r.d(t,"pinnedMessageUnHide",(function(){return h})),r.d(t,"pinnedMessageUnpin",(function(){return p})),r.d(t,"mount",(function(){return C}));var n=r("ofcU"),a=r("vT4u"),i=r("P13b");function o(e){return{unmount(){Object(n.destroyModule)(e)}}}function s(e,t,r,a){var s=Object(n.createMutations)(o).bindMutations,c=t=>{r().messageKeyboardButtonClick(t),e.hide()};return s(Object(n.createModule)({handlers:(t,r)=>{r(e.bodyNode,"click",i.MESSAGE_KEYBOARD_BUTTON_CLASS,c)}}))}var c=r("rHUl"),u=r("aong"),l=r("uytb"),d=r("FWc3");function _(e,t){if(Object(u.unpackStore)(e).searchShown)return!1;var r=Object(c.getTab)(e,t),n=r&&Object(c.parserMessage)(r.pinned);return!!n&&r.pinHideId!=n.chat_local_id}function f(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t),i=a&&Object(c.parserMessage)(a.pinned);a&&i&&(a.pinHideId=i.chat_local_id,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[a.peerId,a.pinHideId]),m(r,t,e),re(geByClass1("_im_pinned_tt")),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:1,peer:t}),statlogsValueEvent("im_pinned_messages","hide"))}function h(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Object(c.getTab)(e,t);a&&a.pinHideId&&(delete a.pinHideId,cur.imDb.update(l.PIN_HIDDEN_ID_OP,[a.peerId,void 0]),m(r,t,e),n&&window.Notifier&&Notifier.lcSend("pin_hide",{hide:0,peer:t}),statlogsValueEvent("im_pinned_messages","show"))}function p(e,t,r){var n=m.bind(null,r,t),o=Object(i.showUnpinDialog)(()=>{o.hideProgress(),o.hide(),e.set(a.unpinMessageOptimistic.bind(null,t)).then(n).then(e=>e.set(a.unpinMessage.bind(null,t))).then(n)})}function g(e,t,r){var n=e.get().peer,a=Object(c.parserMessage)(Object(c.getTab)(e,n).pinned);if(r.target.classList.contains("_im_pin_hide"))a&&f(e,n,t);else if("A"!==r.target.tagName){var o=a&&a.messageId;o&&!Object(i.isAlreadyDeleted)(e,n,o)?Object(i.focusOnMessage)(e,t().focusOnMessage,n,o):Object(i.showPinnedBox)(e,t,n,s,r),statlogsValueEvent("im_pinned_messages","open")}}function m(e,t,r){return e().updateChatTopic(t,r),Object(a.setActions)(r.get()),e().updateActions(r),r}function b(e){Object(d.showTooltip)(e.target,{text:getLang("mail_hide_unpin_hover"),black:1,needLeft:1,shift:[8,4],forcetoup:!0,className:"_im_pinned_tt",appendEl:bodyNode})}function v(e){return{unmount(){Object(n.destroyModule)(e)}}}function C(e,t,r){var a=Object(n.createMutations)(v).bindMutations,i=g.bind(null,t,r),o=b.bind(null);return a(Object(n.createModule)({handlers:(t,r)=>{r(e,"click","_im_pinned_message",i),r(e,"mouseover","_im_pin_hide",o)}}))}},XpgC:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return u}));r("91GP");var n=r("q1tI"),a=r("i8i4"),i=(r("17x9"),r("pemR")),o=r("clTp");function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var c=e=>{var t=e.position,r=e.align,n=e.text,a=e.rect,i=e.marginTop,o=e.marginLeft,s=e.maxWidth,c=e.appearance,u=e.className,l=a.left,d=a.top;switch(t){case"t":l+=.5*a.width;break;case"r":l+=a.width,d+=.5*a.height;break;case"b":l+=.5*a.width,d+=a.height;break;case"l":d+=.5*a.height}return{tooltip:{position:t,align:r,text:n,x:l=Math.round(l+o),y:d=Math.round(d+i),maxWidth:s,appearance:c,className:u}}};class u extends n.Component{constructor(e){super(e),this.onMouseEnter=e=>{if(this.state.el){var t=this.props,r=t.text,n=t.position,a=t.align,i=t.marginTop,s=t.marginLeft,c=t.maxWidth,u=t.appearance,l=t.className,d=Object(o.default)(this.state.el);this.update({text:r,position:n,align:a,rect:d,marginTop:i,marginLeft:s,maxWidth:c,appearance:u,className:l})}},this.onMouseLeave=e=>this.update(),this.onTransitionEnd=e=>{"visibility"===e.propertyName&&this.state.tooltip&&this.setState({tooltip:void 0})},this.renderTooltip=()=>{if(!this.state.tooltip)return null;var e=this.state.tooltip,t=e.x,r=e.y,a=e.position,o=e.align,s=e.text,c=e.removed,u=e.maxWidth,l=e.appearance,d=e.className,_=Object(i.classNames)("Tooltip","Tooltip--"+a,"Tooltip--"+l,{"Tooltip--removed":!!c,["Tooltip--align-"+o]:"t"===a||"b"===a},d);return n.createElement("div",{className:_,style:{top:r,left:t},onTransitionEnd:this.onTransitionEnd},n.createElement("div",{className:"Tooltip__in",style:{maxWidth:u},dangerouslySetInnerHTML:{__html:s}}))},this.state={}}componentDidMount(){var e=a.findDOMNode(this);this.setState({el:e}),e.addEventListener("mouseenter",this.onMouseEnter),e.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.state.el.removeEventListener("mouseenter",this.onMouseEnter),this.state.el.removeEventListener("mouseleave",this.onMouseLeave)}static getDerivedStateFromProps(e,t){return t.tooltip&&["text","position","align","maxWidth","appearance"].some(r=>e[r]!==t.tooltip[r])?c(s({},e,{rect:Object(o.default)(t.el)})):null}update(e){if(!e)return this.setState({tooltip:Object.assign({},this.state.tooltip,{removed:!0})});this.setState(c(e))}render(){var e=this.renderTooltip();return e?(this.defaultNode||"undefined"==typeof window||(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),n.createElement(n.Fragment,null,this.props.children,a.createPortal(e,this.defaultNode))):this.props.children}}u.defaultProps={position:"b",align:"center",marginTop:0,marginLeft:0,appearance:"dark"}},ambf:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_DEVIATION",(function(){return o})),r.d(t,"EXPIRING_TIME",(function(){return s})),r.d(t,"EXPIRING_SOON_TIME",(function(){return c})),r.d(t,"EXPIRING",(function(){return u})),r.d(t,"EXPIRING_SOON",(function(){return l})),r.d(t,"EXPIRED",(function(){return d})),r.d(t,"casperMessagesStore",(function(){return g}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("MhhX");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o=2e3,s=6e4,c=1e4,u="expiring",l="expiring_soon",d="expired",_=[],f={},h={},p=0,g={add(e){var t=a(b(e),3),r=t[0],n=t[1],i=t[2],o=Math.max(r+n-s-i,0),_=Math.max(r+n-c-i,0),p=Math.max(r+n-i,0),g=setTimeout(()=>{m({type:u,message:e})},o),v=setTimeout(()=>{m({type:l,message:e})},_),C=setTimeout(()=>{m({type:d,message:e}),h[e.messageId]=!0,delete f[e.messageId]},p);f[e.messageId]={message:e,expiringTime:o,expiredTime:p,timers:[g,v,C]}},remove(e){this.has(e)&&(f[e].timers.forEach(clearTimeout),delete f[e])},setTimeshift(e){p=1e3*(e||0)},getTimings:e=>f[e]?b(f[e].message):[0,0,0],getExpireTime(e){if(!f[e])return 0;var t=a(b(f[e].message),3),r=t[0],n=t[1],i=t[2];return Math.max(Math.floor((r+n-i)/1e3),0)},isProcessed:e=>!!h[e],subscribe(e){_.push(e)},unsubscribe(e){_=_.filter(t=>t!==e)},has:e=>!!f[e],destroy(){f={},_=[],h={}}};function m(e){_.forEach(t=>t(e))}function b(e){return[1e3*e.date+p,1e3*(Object(n.getMessageTTL)(e)||0),Date.now()]}},bIHZ:function(e,t,r){"use strict";r.r(t),r.d(t,"updateLocation",(function(){return a})),r.d(t,"updateLazyLocation",(function(){return i}));var n=r("t7n3");function a(e){var t=Object(n.extend)({},window.nav.objLoc,e);Object.keys(t).filter((function(e){return""===t[e]})).forEach((function(e){delete t[e]}));var r=window.nav.toStr(t);window.nav.setLoc(r)}function i(){var e={};return{scheduleNav:function(t){e=Object(n.extend)(e,t)},commitNav:function(){a(e),e={}},scheduleNavWithTimeOut:function(t,r){void 0===r&&(r=100),e=Object(n.extend)(e,t),setTimeout((function(){a(e),e={}}),r)}}}},bP5l:function(e,t,r){"use strict";r.r(t),r.d(t,"lpLogFc",(function(){return i})),r.d(t,"longpollTestingOnFcEvents",(function(){return _})),r.d(t,"longpollTestingOnImEvents",(function(){return f}));var n=r("ERyv"),a=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)n[a]=i[o];return n};function i(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(window.vk.lpConfig.debug){var i="background: "+e+"; color: white",o=new Date,s=function(e){return e<10?"0"+e.toString():e.toString()};console.log.apply(console,a(["%c "+o.getHours()+":"+s(o.getMinutes())+":"+s(o.getSeconds())+":"+o.getMilliseconds()+" "+t+" ",i],r))}}function o(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function s(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function c(e,t){window.lpWeird||(window.lpWeird=[]),window.lpWeird.push({msg:e,ev:t,is_master:window.curNotifier.is_server}),setTimeout(u,1e4)}function u(){window.lpWeird&&window.lpWeird.length&&(Object(n.imWeirdLog)("fc_im_differ",{diff:window.lpWeird},!1),window.lpWeird=[])}function l(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function d(){var e;l()&&(s().forEach((function(e){!o().find((function(t){return e.ev===t.ev}))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,i("red","im not fc",e.ev),Object(n.isWeirdLogging)()&&c("im not fc",e.ev))})),o().forEach((function(e){var t=s().find((function(t){return t.ev===e.ev}));t&&t.warned&&!e.warned&&(e.warned=!0,i("red","now fc like im",e.ev),Object(n.isWeirdLogging)()&&c("now fc like im",e.ev))}))),e=Date.now()-3e4,window.lpBufferFc=o().filter((function(t){return t.time>e})),window.lpBufferIm=s().filter((function(t){return t.time>e}))}function _(e){var t;l()&&((t=o()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(d,0)),i.apply(void 0,a(["green","fc"],e))}function f(e){var t;l()&&((t=s()).push.apply(t,e.map((function(e){return{time:Date.now(),ev:JSON.stringify(e),warned:!1}}))),setTimeout(d,1100)),i.apply(void 0,a(["blue","im"],e))}window.longpollTestingOnImEvents=f},clTp:function(e,t,r){"use strict";function n(e){var t=e.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,i=window.pageXOffset||n.scrollLeft||r.scrollLeft,o=n.clientTop||r.clientTop||0,s=n.clientLeft||r.clientLeft||0;return{top:Math.round(t.top+a-o),left:Math.round(t.left+i-s),width:e.offsetWidth,height:e.offsetHeight}}r.r(t),r.d(t,"default",(function(){return n}))},f01n:function(e,t,r){"use strict";r.r(t),r.d(t,"DELETE",(function(){return o})),r.d(t,"SET_FLAGS",(function(){return s})),r.d(t,"REPLACE_FLAGS",(function(){return c})),r.d(t,"RESET_FLAGS",(function(){return u})),r.d(t,"ADD_MESSAGE",(function(){return l})),r.d(t,"READ_INBOUND",(function(){return d})),r.d(t,"READ_OUTBOUND",(function(){return _})),r.d(t,"GOT_ONLINE",(function(){return f})),r.d(t,"GOT_OFFLINE",(function(){return h})),r.d(t,"CHAT_CHANGED",(function(){return p})),r.d(t,"CONVERSATION_UPDATED",(function(){return g})),r.d(t,"TYPING",(function(){return m})),r.d(t,"RECORDING_AUDIO",(function(){return b})),r.d(t,"VIDEO_CALL",(function(){return v})),r.d(t,"UNREAD_COUNT",(function(){return C})),r.d(t,"NOTIFY_SETTINGS_CHANGED",(function(){return y})),r.d(t,"KEYBOARD_CALLBACK_RECEIVED",(function(){return T})),r.d(t,"EMPTY",(function(){return E})),r.d(t,"RESET_DIRECTORIES",(function(){return O})),r.d(t,"REPLACE_DIRECTORIES",(function(){return w})),r.d(t,"SET_DIRECTORIES",(function(){return k})),r.d(t,"RESYNC",(function(){return N})),r.d(t,"REFRESH_LP_KEY",(function(){return I})),r.d(t,"TRANSITION",(function(){return S})),r.d(t,"RESET_PEER",(function(){return j})),r.d(t,"MUTEX",(function(){return A})),r.d(t,"CHANGE_PEER",(function(){return M})),r.d(t,"CHANGE_TAB",(function(){return P})),r.d(t,"FAILED_MESSAGE",(function(){return F})),r.d(t,"RESEND",(function(){return L})),r.d(t,"DELETE_DIALOG",(function(){return x})),r.d(t,"EDIT_MESSAGE",(function(){return D})),r.d(t,"REPLACE_MESSAGE",(function(){return R})),r.d(t,"INVALIDATE_MESSAGE",(function(){return B})),r.d(t,"AUDIO_START",(function(){return H})),r.d(t,"WAITING_FOR_RECONNECT",(function(){return U})),r.d(t,"RECONNECTING",(function(){return q})),r.d(t,"RECONNECTED",(function(){return W})),r.d(t,"INCOMING_CALL",(function(){return G})),r.d(t,"FLAG_UNREAD",(function(){return z})),r.d(t,"FLAG_OUTBOUND",(function(){return K})),r.d(t,"FLAG_IMPORTANT",(function(){return V})),r.d(t,"FLAG_CHAT",(function(){return $})),r.d(t,"FLAG_FRIENDS",(function(){return Y})),r.d(t,"FLAG_SPAM",(function(){return Q})),r.d(t,"FLAG_DELETED",(function(){return X})),r.d(t,"FLAG_MEDIA",(function(){return J})),r.d(t,"FLAG_STEALTH",(function(){return Z})),r.d(t,"FLAG_HAS_REPLY",(function(){return ee})),r.d(t,"FLAG_AUDIO_MESSAGE_LISTENED",(function(){return te})),r.d(t,"FLAG_DELETE_BY_TTL",(function(){return re})),r.d(t,"FOLDER_IMPORTANT",(function(){return ne})),r.d(t,"FOLDER_UNRESPOND",(function(){return ae})),r.d(t,"FOLDER_HAS_BANNER",(function(){return ie})),r.d(t,"FOLDER_AD_TAG",(function(){return oe})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_TITLE_CHANGED",(function(){return se})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_AVATAR_CHANGED",(function(){return ce})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED",(function(){return ue})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED",(function(){return le})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_PINNED",(function(){return de})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_JOINED",(function(){return _e})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_LEFT",(function(){return fe})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_USER_KICKED",(function(){return he})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED",(function(){return pe})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED",(function(){return ge})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED",(function(){return me})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED",(function(){return be})),r.d(t,"MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED",(function(){return ve})),r.d(t,"MESSAGE_REQUEST_STATUS_NEW",(function(){return Ce})),r.d(t,"deleteEvent",(function(){return ye})),r.d(t,"replaceFlagsEvent",(function(){return Te})),r.d(t,"setFlagsEvent",(function(){return Ee})),r.d(t,"resetFlagsEvent",(function(){return Oe})),r.d(t,"addMessageEvent",(function(){return we})),r.d(t,"editMessageEvent",(function(){return ke})),r.d(t,"replaceMessageEvent",(function(){return Ne})),r.d(t,"invalidateMessageEvent",(function(){return Ie})),r.d(t,"editMessageLocallyEvent",(function(){return Se})),r.d(t,"readInboundEvent",(function(){return je})),r.d(t,"readOutboundEvent",(function(){return Ae})),r.d(t,"gotOnlineEvent",(function(){return Me})),r.d(t,"gotOfflineEvent",(function(){return Pe})),r.d(t,"resetDirectoriesEvent",(function(){return Fe})),r.d(t,"replaceDirectoriesEvent",(function(){return Le})),r.d(t,"setDirectoriesEvent",(function(){return xe})),r.d(t,"deleteDialogEvent",(function(){return De})),r.d(t,"chatChangedEvent",(function(){return Re})),r.d(t,"chatUpdatedEvent",(function(){return Be})),r.d(t,"typingEvent",(function(){return He})),r.d(t,"recordingAudioEvent",(function(){return Ue})),r.d(t,"videoCallEvent",(function(){return qe})),r.d(t,"unreadCountEvent",(function(){return We})),r.d(t,"notifySettingsChangedEvent",(function(){return Ge})),r.d(t,"incomingCallEvent",(function(){return ze})),r.d(t,"refreshMessageEvent",(function(){return Ke})),r.d(t,"audioStartEvent",(function(){return Ve})),r.d(t,"keyboardCallbackReceivedEvent",(function(){return $e})),r.d(t,"emptyEvent",(function(){return Ye})),r.d(t,"transitionEvent",(function(){return Qe})),r.d(t,"resyncEvent",(function(){return Xe})),r.d(t,"refreshLpKeyEvent",(function(){return Je})),r.d(t,"waitingForReconnectEvent",(function(){return Ze})),r.d(t,"reconnectingEvent",(function(){return et})),r.d(t,"reconnectedEvent",(function(){return tt})),r.d(t,"resetPeer",(function(){return rt})),r.d(t,"changePeer",(function(){return nt})),r.d(t,"changeTab",(function(){return at})),r.d(t,"failedMessage",(function(){return it})),r.d(t,"mutexEvent",(function(){return ot})),r.d(t,"resendEvent",(function(){return st}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf"),r("OEbY");var n=r("rudk");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o="event_delete",s="event_set_flags",c="event_replace_flags",u="event_reset_flags",l="event_add_message",d="event_read_inbound",_="event_read_outbound",f="event_got_online",h="event_got_offline",p="event_chat_changed",g="event_chat_updated",m="event_typing",b="event_recoding_audio",v="event_video_call",C="event_unread_count",y="event_notify_settings_changed",T="event_keyboard_callback_received",E="event_empty",O="event_reset_directories",w="event_replace_directories",k="event_set_directories",N="event_resync",I="event_refresh_lp_key",S="transition_event",j="reset_peer",A="mutex",M="change_peer",P="event_change_tab",F="event_failed_message",L="event_resend",x="event_delete_dialog",D="event_edit_message",R="event_replace_message",B="event_invalidate_event",H="event_audio_start",U="event_waiting_for_reconnect",q="event_reconnecting",W="event_reconnected",G="incoming_call",z=1,K=2,V=8,$=16,Y=32,Q=64,X=128,J=512,Z=65536,ee=1<<21,te=4096,re=1<<22,ne=1,ae=2,ie=8,oe=32768,se=1,ce=2,ue=3,le=4,de=5,_e=6,fe=7,he=8,pe=9,ge=10,me=11,be=12,ve=13,Ce=3;function ye(e){var t=a(e,2)[1];return{type:o,localId:t}}function Te(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:c,messageId:r,mask:n,peerId:i}}function Ee(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:s,messageId:r,flags:n,peerId:i}}function Oe(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:u,messageId:r,flags:n,peerId:i}}function we(e){var t=a(e,11),r=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],d=t[7],_=t[8],f=t[9],h=t[10],p=extend(u,d||void 0);return{type:l,messageId:intval(r),flags:intval(i),peerId:intval(o),date:intval(s),attaches:Object(n.convertKludgesToAttaches)(p,r),subject:u.title||"",text:c,kludges:p,randomId:intval(_),userId:Object(n.isChatPeer)(o)?intval(p.from):intval(o),update_time:h,chat_local_id:f}}function ke(e){var t=we(e);return t.type=D,t}function Ne(e){var t=we(e);return t.type=R,t}function Ie(e){var t=we(e);return t.type=B,t}function Se(e){return extend({},e,{type:D})}function je(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:d,peerId:r,upToId:n,unread:i}}function Ae(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:_,peerId:r,upToId:n,unread:i}}function Me(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:f,userId:-r,platform:n,lastSeenTs:i}}function Pe(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:h,userId:-r,reason:n,lastSeenTs:i}}function Fe(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:O,peerId:r,mask:n,local:void 0!==i&&i}}function Le(e){var t=a(e,3),r=t[1],n=t[2];return{type:w,peerId:r,mask:n}}function xe(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:k,peerId:r,mask:n,local:void 0!==i&&i}}function De(e){var t=a(e,3),r=t[1],n=t[2];return{type:x,peerId:r,localId:n}}function Re(e){var t=a(e,3),r=t[1],n=t[2];return{type:p,chatId:r,self:n}}function Be(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:g,peerId:n,updateType:r,updateArg:i}}function He(e){var t=a(e,5),r=t[1],n=t[2],i=t[3],o=t[4];return{type:m,peerId:r,userIds:n,totalCount:i,ts:o}}function Ue(e){var t=a(e,5),r=t[1],n=t[2],i=t[3],o=t[4];return{type:b,peerId:r,userIds:n,totalCount:i,ts:o}}function qe(e){var t=a(e,3),r=t[1],n=t[2];return{type:v,userId:r,callId:n}}function We(e){var t=a(e,4),r=t[1],n=t[2],i=t[3];return{type:C,count:r,countNotMuted:n,showOnlyNotMuted:i}}function Ge(e){var t=a(e,2)[1],r=void 0===t?{}:t;return{type:y,peerId:r.peer_id,sound:r.sound,disabledUntil:r.disabled_until}}function ze(e){var t=a(e,2)[1];return{type:G,payload:t}}function Ke(e){var t=a(e,2)[1],r=void 0===t?{}:t,n=we([!1,r.id,r.flags,r.peer_id,r.date,r.message,extend(r.kludges,{title:r.title||""}),{},r.random_id,r.chat_local_id,r.update_time]);return n.type=D,n}function Ve(e){var t=a(e,2)[1],r=void 0===t?{}:t;return{type:H,uuid:r.uuid,deviceName:r.device_name||""}}function $e(e){var t=a(e,2)[1],r=t.event_id,n=t.owner_id,i=t.peer_id,o=t.action;return{type:T,event_id:r,owner_id:n,peer_id:i,action:o}}function Ye(e){return{type:E,params:e}}function Qe(e){return{type:S,state:e}}function Xe(){return{type:N}}function Je(e){var t=a(e,3),r=t[1],n=t[2];return{type:I,key:r,url:n}}function Ze(e){var t=a(e,2)[1];return{type:U,timeout:t}}function et(){return{type:q}}function tt(){return{type:W}}function rt(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:j,cancelSearch:e,removeActivePeer:t}}function nt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return{type:M,peerId:e,msgid:t,forward:r,cancelSearch:n,entryPoint:a}}function at(e){return{type:P,tab:e}}function it(e,t,r){return{type:F,message:t,peer:e,error:r}}function ot(e){var t=a(e,6),r=(t[0],t[1]),n=t[2],i=t[3],o=t[4],s=t[5];return{type:A,free:!!intval(r)||intval(o)===vk.id,resource:n,peerId:intval(i),who:intval(o),name:s}}function st(e,t){return{type:L,message:t,peerId:e}}},gF8j:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return o})),r.d(t,"getVisibilityState",(function(){return u})),r.d(t,"getVisiblityEvent",(function(){return l}));var n=r("uQjJ"),a=r("PU8N"),i=browser.iphone||browser.ipad||browser.ipod;function o(e){this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.cbActiveB=this.cbActive.bind(this),this.cbInactiveB=this.cbInactive.bind(this),this.onVisiblityChange=this.onVisiblityChange.bind(this),this.opts=extend({triggerEvents:"mousemove keydown",onIdleCb:function(){},onUnIdleCb:function(){},focusElement:e.element,element:null,idleTimeout:3e4},e)}function s(e,t,r){Object(a.isMvk)()?window.addEvent(e,t,r,{passive:!0}):window.addEvent(e,t,r)}function c(e,t,r){Object(a.isMvk)()?window.removeEvent(e,t,r,{passive:!0}):window.removeEvent(e,t,r)}function u(){return document.visibilityState||document.webkitVisibilityState}function l(){var e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}extend(o.prototype,n.default.prototype),extend(o.prototype,{stop:function(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&c(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(c(this.opts.focusElement,"focus",this.cbActiveB),c(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactiveB)},idle:function(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")},unidle:function(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")},start:function(){this.started=!0,!Object(a.isMvk)()&&browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactiveB),Object(a.isMvk)()&&this._isTopLevel()&&l()&&s(document,l(),this.onVisiblityChange),Object(a.isMvk)()&&i||(s(this.opts.focusElement,"focus",this.cbActiveB),s(this.opts.focusElement,"blur",this.cbInactiveB)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},checkIdleCb:function(){this.started&&(s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactiveB,this.opts.idleTimeout))},cbActive:function(){this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}.bind(this),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb.bind(this),this.opts.idleTimeout))},cbInactive:function(){this.started&&(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout(function(){this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}.bind(this),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActiveB),s(this.opts.element,this.opts.triggerEvents,this.cbActiveB),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},getActiveTime(){return!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0},onVisiblityChange(){"visible"===u()?this.cbActiveB():this.cbInactiveB()},_isTopLevel(){var e=this.opts.focusElement;return e===window||e===document},_isFocused(){var e=this.opts.focusElement;if(this._isTopLevel()){var t=u();return"string"==typeof t&&"visible"===t}return document.activeElement===e}})},"h++7":function(e,t,r){"use strict";r.r(t),r.d(t,"OUR_DOMAINS",(function(){return n})),r.d(t,"ENTITIES",(function(){return a})),r.d(t,"VK_DOMAIN",(function(){return i})),r.d(t,"MENTION",(function(){return o})),r.d(t,"MENTION_RAW",(function(){return s})),r.d(t,"ARROW_UP",(function(){return c})),r.d(t,"ARROW_DOWN",(function(){return u})),r.d(t,"PAGE_UP",(function(){return l})),r.d(t,"PAGE_DOWN",(function(){return d})),r.d(t,"END_KEY",(function(){return _})),r.d(t,"HOME",(function(){return f})),r.d(t,"ENTER",(function(){return h})),r.d(t,"ESC",(function(){return p})),r.d(t,"UNPRINTABLE_KEYS",(function(){return g})),r.d(t,"UP_DOWN_CONTROLS",(function(){return m})),r.d(t,"PRINTABLE",(function(){return b})),r.d(t,"FOLDER_UNREAD",(function(){return v})),r.d(t,"FOLDER_ALL",(function(){return C})),r.d(t,"FOLDER_UNRESPOND",(function(){return y})),r.d(t,"FOLDER_IMPORTANT",(function(){return T})),r.d(t,"FOLDER_MESSAGE_REQUEST",(function(){return E})),r.d(t,"FOLDER_MESSAGE_REQUEST_REJECTED",(function(){return O})),r.d(t,"FOLDER_AD_TAG",(function(){return w})),r.d(t,"FOLDERS",(function(){return k})),r.d(t,"FOLDER_MASKS",(function(){return N})),r.d(t,"TOP_DOMAINS",(function(){return I})),r.d(t,"MAX_DOMAIN_LENGTH",(function(){return S})),r.d(t,"EMAIL",(function(){return j})),r.d(t,"MESSAGE_REGEXP",(function(){return A})),r.d(t,"RE_HASHTAG_EXTRACTION_PATTERN",(function(){return P})),r.d(t,"RE_MASSMENTION",(function(){return F})),r.d(t,"LINE_FEED",(function(){return L}));r("Oyvg");var n=/^([a-zA-Z0-9\.\_\-]+\.)?(vkontakte\.ru|vk\.com|vkadre\.ru|vshtate\.ru|userapi\.com|vk\.me)$/,a=/([^a-zA-Z0-9#%;_\-.\/?&=\[\]])/g,i=/^(?:https?:\/\/)?(?:vk\.com|vkontakte\.ru)?\/([a-zA-Z0-9\._]+)\??$/,o=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,s=/(^|[\s.,:\'\";>\)\(])(\*|@)([A-Za-z0-9_\.]{2,32})\s*\((.+?)\)/g,c=38,u=40,l=33,d=34,_=35,f=36,h=13,p=27,g=[c,u,l,d,h,p,_,f],m=[l,d,u,c,f,_],b="printable",v="unread",C="all",y="unrespond",T="important",E="mr",O="mr_rejected",w="ad_tag",k=[C,v,y,T,E,w],N={[y]:2,[T]:1,[E]:256,[O]:512,[w]:32768},I=[].concat("aaa,aarp,abarth,abb,abbott,abbvie,abc,able,abogado,abudhabi,ac,academy,accenture,accountant,accountants,aco,active,actor,ad,adac,ads,adult,ae,aeg,aero,aetna,af,afamilycompany,afl,africa,ag,agakhan,agency,ai,aig,aigo,airbus,airforce,airtel,akdn,al,alfaromeo,alibaba,alipay,allfinanz,allstate,ally,alsace,alstom,am,americanexpress,americanfamily,amex,amfam,amica,amsterdam,an,analytics,android,anquan,anz,ao,aol,apartments,app,apple,aq,aquarelle,ar,aramco,archi,army,arpa,art,arte,as,asda,asia,associates,at,athleta,attorney,au,auction,audi,audible,audio,auspost,author,auto,autos,avianca,aw,aws,ax,axa,az,azure,ba,baby,baidu,banamex,bananarepublic,band,bank,bar,barcelona,barclaycard,barclays,barefoot,bargains,baseball,basketball,bauhaus,bayern,bb,bbc,bbt,bbva,bcg,bcn,bd,be,beats,beauty,beer,bentley,berlin,best,bestbuy,bet,bf,bg,bh,bharti,bi,bible,bid,bike,bing,bingo,bio,biz,bj,bl,black,blackfriday,blanco,blockbuster,blog,bloomberg,blue,bm,bms,bmw,bn,bnl,bnpparibas,bo,boats,boehringer,bofa,bom,bond,boo,book,booking,boots,bosch,bostik,boston,bot,boutique,box,bq,br,bradesco,bridgestone,broadway,broker,brother,brussels,bs,bt,budapest,bugatti,build,builders,business,buy,buzz,bv,bw,by,bz,bzh,ca,cab,cafe,cal,call,calvinklein,cam,camera,camp,cancerresearch,canon,capetown,capital,capitalone,car,caravan,cards,care,career,careers,cars,cartier,casa,case,caseih,cash,casino,cat,catering,catholic,cba,cbn,cbre,cbs,cc,cd,ceb,center,ceo,cern,cf,cfa,cfd,cg,ch,chanel,channel,chase,chat,cheap,chintai,chloe,christmas,chrome,chrysler,church,ci,cipriani,circle,cisco,citadel,citi,citic,city,cityeats,ck,cl,claims,cleaning,click,clinic,clinique,clothing,cloud,club,clubmed,cm,cn,co,coach,codes,coffee,college,cologne,com,comcast,commbank,community,company,compare,computer,comsec,condos,construction,consulting,contact,contractors,cooking,cookingchannel,cool,coop,corsica,country,coupon,coupons,courses,cr,credit,creditcard,creditunion,cricket,crown,crs,cruise,cruises,csc,cu,cuisinella,cv,cw,cx,cy,cymru,cyou,cz,dabur,dad,dance,data,date,dating,datsun,day,dclk,dds,de,deal,dealer,deals,degree,delivery,dell,deloitte,delta,democrat,dental,dentist,desi,design,dev,dhl,diamonds,diet,digital,direct,directory,discount,discover,dish,diy,dj,dk,dm,dnp,do,docs,doctor,dodge,dog,doha,domains,dot,download,drive,dtv,dubai,duck,dunlop,duns,dupont,durban,dvag,dvr,dz,earth,eat,ec,eco,edeka,edu,education,ee,eg,eh,email,emerck,energy,engineer,engineering,enterprises,epost,epson,equipment,er,ericsson,erni,es,esq,estate,esurance,et,eu,eurovision,eus,events,everbank,exchange,expert,exposed,express,extraspace,fage,fail,fairwinds,faith,family,fan,fans,farm,farmers,fashion,fast,fedex,feedback,ferrari,ferrero,fi,fiat,fidelity,fido,film,final,finance,financial,fire,firestone,firmdale,fish,fishing,fit,fitness,fj,fk,flickr,flights,flir,florist,flowers,fly,fm,fo,foo,food,foodnetwork,football,ford,forex,forsale,forum,foundation,fox,fr,free,fresenius,frl,frogans,frontdoor,frontier,ftr,fujitsu,fujixerox,fun,fund,furniture,futbol,fyi,ga,gal,gallery,gallo,gallup,game,games,gap,garden,gb,gbiz,gd,gdn,ge,gea,gent,genting,george,gf,gg,ggee,gh,gi,gift,gifts,gives,giving,gl,glade,glass,gle,global,globo,gm,gmail,gmbh,gmo,gmx,gn,godaddy,gold,goldpoint,golf,goo,goodhands,goodyear,goog,google,gop,got,gov,gp,gq,gr,grainger,graphics,gratis,green,gripe,group,gs,gt,gu,guardian,gucci,guge,guide,guitars,guru,gw,gy,hair,hamburg,hangout,haus,hbo,hdfc,hdfcbank,health,healthcare,help,helsinki,here,hermes,hgtv,hiphop,hisamitsu,hitachi,hiv,hk,hkt,hm,hn,hockey,holdings,holiday,homedepot,homegoods,homes,homesense,honda,honeywell,horse,hospital,host,hosting,hot,hoteles,hotmail,house,how,hr,hsbc,ht,htc,hu,hughes,hyatt,hyundai,ibm,icbc,ice,icu,id,ie,ieee,ifm,ikano,il,im,imamat,imdb,immo,immobilien,in,industries,infiniti,info,ing,ink,institute,insurance,insure,int,intel,international,intuit,investments,io,ipiranga,iq,ir,irish,is,iselect,ismaili,ist,istanbul,it,itau,itv,iveco,iwc,jaguar,java,jcb,jcp,je,jeep,jetzt,jewelry,jio,jlc,jll,jm,jmp,jnj,jo,jobs,joburg,jot,joy,jp,jpmorgan,jprs,juegos,juniper,kaufen,kddi,ke,kerryhotels,kerrylogistics,kerryproperties,kfh,kg,kh,ki,kia,kim,kinder,kindle,kitchen,kiwi,km,kn,koeln,komatsu,kosher,kp,kpmg,kpn,kr,krd,kred,kuokgroup,kw,ky,kyoto,kz,la,lacaixa,ladbrokes,lamborghini,lamer,lancaster,lancia,lancome,land,landrover,lanxess,lasalle,lat,latino,latrobe,law,lawyer,lb,lc,lds,lease,leclerc,lefrak,legal,lego,lexus,lgbt,li,liaison,lidl,life,lifeinsurance,lifestyle,lighting,like,lilly,limited,limo,lincoln,linde,link,lipsy,live,living,lixil,lk,loan,loans,local,locker,locus,loft,lol,london,lotte,lotto,love,lpl,lplfinancial,lr,ls,lt,ltd,ltda,lu,lundbeck,lupin,luxe,luxury,lv,ly,ma,macys,madrid,maif,maison,makeup,man,management,mango,market,marketing,markets,marriott,marshalls,maserati,mattel,mba,mc,mcd,mcdonalds,mckinsey,md,me,med,media,meet,melbourne,meme,memorial,men,menu,meo,metlife,mf,mg,mh,miami,microsoft,mil,mini,mint,mit,mitsubishi,mk,ml,mlb,mls,mm,mma,mn,mo,mobi,mobile,mobily,moda,moe,moi,mom,monash,money,monster,montblanc,mopar,mormon,mortgage,moscow,moto,motorcycles,mov,movie,movistar,mp,mq,mr,ms,msd,mt,mtn,mtpc,mtr,mu,museum,mutual,mv,mw,mx,my,mz,na,nab,nadex,nagoya,name,nationwide,natura,navy,nba,nc,ne,nec,net,netbank,netflix,network,neustar,new,newholland,news,next,nextdirect,nexus,nf,nfl,ng,ngo,nhk,ni,nico,nike,nikon,ninja,nissan,nissay,nl,no,nokia,northwesternmutual,norton,now,nowruz,nowtv,np,nr,nra,nrw,ntt,nu,nyc,nz,obi,observer,off,office,okinawa,olayan,olayangroup,oldnavy,ollo,om,omega,one,ong,onl,online,onyourside,ooo,open,oracle,orange,org,organic,orientexpress,origins,osaka,otsuka,ott,ovh,pa,page,pamperedchef,panasonic,panerai,paris,pars,partners,parts,party,passagens,pay,pccw,pe,pet,pf,pfizer,pg,ph,pharmacy,philips,phone,photo,photography,photos,physio,piaget,pics,pictet,pictures,pid,pin,ping,pink,pioneer,pizza,pk,pl,place,play,playstation,plumbing,plus,pm,pn,pnc,pohl,poker,politie,porn,post,pr,pramerica,praxi,press,prime,pro,prod,productions,prof,progressive,promo,properties,property,protection,pru,prudential,ps,pt,pub,pw,pwc,py,qa,qpon,quebec,quest,qvc,racing,radio,raid,re,read,realestate,realtor,realty,recipes,red,redstone,redumbrella,rehab,reise,reisen,reit,reliance,ren,rent,rentals,repair,report,republican,rest,restaurant,review,reviews,rexroth,rich,richardli,ricoh,rightathome,ril,rio,rip,rmit,ro,rocher,rocks,rodeo,rogers,room,rs,rsvp,ru,ruhr,run,rw,rwe,ryukyu,sa,saarland,safe,safety,sakura,sale,salon,samsclub,samsung,sandvik,sandvikcoromant,sanofi,sap,sapo,sarl,sas,save,saxo,sb,sbi,sbs,sc,sca,scb,schaeffler,schmidt,scholarships,school,schule,schwarz,science,scjohnson,scor,scot,sd,se,seat,secure,security,seek,select,sener,services,ses,seven,sew,sex,sexy,sfr,sg,sh,shangrila,sharp,shaw,shell,shia,shiksha,shoes,shop,shopping,shouji,show,showtime,shriram,si,silk,sina,singles,site,sj,sk,ski,skin,sky,skype,sl,sling,sm,smart,smile,sn,sncf,so,soccer,social,softbank,software,sohu,solar,solutions,song,sony,soy,space,spiegel,spot,spreadbetting,sr,srl,srt,ss,st,stada,staples,star,starhub,statebank,statefarm,statoil,stc,stcgroup,stockholm,storage,store,stream,studio,study,style,su,sucks,supplies,supply,support,surf,surgery,suzuki,sv,swatch,swiftcover,swiss,sx,sy,sydney,symantec,systems,sz,tab,taipei,talk,taobao,target,tatamotors,tatar,tattoo,tax,taxi,tc,tci,td,tdk,team,tech,technology,tel,telecity,telefonica,temasek,tennis,teva,tf,tg,th,thd,theater,theatre,tiaa,tickets,tienda,tiffany,tips,tires,tirol,tj,tjmaxx,tjx,tk,tkmaxx,tl,tm,tmall,tn,to,today,tokyo,tools,top,toray,toshiba,total,tours,town,toyota,toys,tp,tr,trade,trading,training,travel,travelchannel,travelers,travelersinsurance,trust,trv,tt,tube,tui,tunes,tushu,tv,tvs,tw,tz,ua,ubank,ubs,uconnect,ug,uk,um,unicom,university,uno,uol,ups,us,uy,uz,va,vacations,vana,vanguard,vc,ve,vegas,ventures,verisign,vermögensberater,vermögensberatung,versicherung,vet,vg,vi,viajes,video,vig,viking,villas,vin,vip,virgin,visa,vision,vista,vistaprint,viva,vivo,vlaanderen,vn,vodka,volkswagen,volvo,vote,voting,voto,voyage,vu,vuelos,wales,walmart,walter,wang,wanggou,warman,watch,watches,weather,weatherchannel,webcam,weber,website,wed,wedding,weibo,weir,wf,whoswho,wien,wiki,williamhill,win,windows,wine,winners,wme,wolterskluwer,woodside,work,works,world,wow,ws,wtc,wtf,xbox,xerox,xfinity,xihuan,xin,xperia,xxx,xyz,yachts,yahoo,yamaxun,yandex,ye,yodobashi,yoga,yokohama,you,youtube,yt,yu,yun,za,zappos,zara,zero,zip,zippo,zm,zone,zuerich,zw".split(","),"бг,бел,дети,ею,католик,ком,мкд,мон,москва,онлайн,орг,рус,рф,сайт,срб,укр".split(","),"qxam,90ae,90ais,d1acj3b,e1a4c,80aqecdr1a,j1aef,d1alf,l1acc,80adxhks,80asehdb,c1avg,p1acf,p1ai,80aswg,90a3ac,j1amh,80ao21a,y9a3aq,9dbq2a,mgbca7dzdo,mgba3a3ejt,mgbayh7gpa,lgbbat1ad8j,mgberp4a5d4ar,mgba7c0bbn0a,mgbc0a9azcg,mgb2ddes,mgbaam7a8h,mgba3a4f16a,mgbbh1a,mgbab2bd,ngbe9e0a,mgbbh1a71e,pgbs0dh,mgbpl2fh,ogbpf8fl,ngbc5azd,mgbtx2b,mgb9awbf,ygbi2ammx,wgbl6a,mgbi4ecexp,fhbei,wgbh1c,mgbx4cd0ab,mgbb9fbpob,4gbrim,mgbt3dhd,mgbai9azgqp6j,mgbgu82a,11b4c3d,c2br7g,h2brj9c,h2breg3eve,h2brj9c8c,i1b6b1a6a2e,54b7fta0cc,45brj9c,45br5cyl,s9brj9c,gecrj9c,3hcrj9c,xkc2dl3a5ee0h,xkc2al3hye2a,clchc0ea0b2g2a9gcd,fpcrj9c3d,2scrj9c,rvc1e0am3e,fzc2c9e2c,42c2d9a,o3cw4h,node,q9jyb4c,gckr3f0f,qcka1pmc,tckwe,cck2b3b,1ck2e1b,bck1b9a5dre4c,eckvdtc9d,rhqv96g,fiq64b,fiqs8s,fiqz9s,fiq228c5hs,vhquv,1qqw23a,vuq861b,nyqy26a,45q11c,55qx5d,55qw42g,kprw13d,kpry57d,czru2d,czrs0t,czr694b,w4rs40l,w4r85el8fhu5dnra,3ds443g,3oq18vl8pn36a,pssy2u,tiq49xqyj,fjq720a,fct429k,estv75g,xhq521b,9krt00a,30rr7y,6qq986b3xl,kput3i,kpu716f,zfr164b,mxtq1m,yfro4i67o,efvy88h,9et52u,rovu88b,nqv7f,b4w605ferd,unup4y,mix891f,mix082f,3pxu8k,pbt977c,6frz82g,nqv7fs00ema,ses554g,hxt814e,5tzm5g,io0a7i,8y0a063a,jlq61u9w7b,flw351e,g2xx48c,gk3at1e,3bst00m,fzys8d69uvgm,kcrx77d1x4a,jvr189m,imr513n,5su34j936bgsg,j6w193g,t60b56a,mk1bu44c,cg4bki,3e0b707e".split(",").map(e=>"xn--"+e)),S=I.reduce((e,t)=>Math.max(e,t.length),0),j=new RegExp("([a-zA-Zа-яА-Я\\-_\\.0-9\\+]+@(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})))","ig"),A=new RegExp("(https?:\\/\\/)?(((?:[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\—\\-\\_]+\\.){1,5})([A-Za-zа-яА-Я\\-\\d]{2,22})(?:\\:(\\d{2,5}))?)(([\\/?#])(?:\\&amp;|\\&#\\d{2,6};|,[_%]|!|,*[\\wА-Яа-я\\xa8\\xb8\\xc0-\\xffєЄҐґЇїІіЈј\\—\\-\\_@#%?+\\/\\$.~=;:'ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛱ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢄᢇ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿕ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞮꞰ-ꞷꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ　-〿＀-￯*]+|(?:\\(|\\[)[\\w\\$А-Яа-яёЁєЄҐґЇїІіЈј\\d&#%;,]+(?:\\)|\\])){0,200})?","ig"),M="(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’_\\d]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))",P=`(^|[s.,:'";>)(]?)(${`(#${M}{0,100}(?:[a-zA-Zа-яА-ЯёіјєїґўЁІЈЄЇҐЎ’]|(?:&#(?:19[2-9]|(?:[2-9]|1[0-3])[0-9][0-9]);?))${M}{0,100})`})(@((?:[a-z0-9_]*[a-z0-9])?(?:(?:.[a-z](?:[a-z0-9_]+[a-z0-9])?)*.[a-z][a-z0-9_]{2,40}[a-z0-9])?))?(?=$|[s.,:'"&;?<)(]?)`,F=/@all|@everyone|@все|@online|@here|@здесь|@тут/gi,L=10},hOuX:function(e,t,r){"use strict";r.r(t),r.d(t,"MAX_SAFE_INTEGER",(function(){return n})),r.d(t,"MAX_INTERGER",(function(){return a})),r.d(t,"random",(function(){return i}));r("tuSo");var n=9007199254740991,a=2147483647;function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce((e,t)=>e+t))}}catch(e){}return intval(rand(0,a).toFixed(0))}},j0Lq:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("KKXr"),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("a1Th"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("Btvt"),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("Egk5"),_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("v+DW"),_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("EasH"),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("FWc3"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("98sY"),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("W9Tc"),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("HLtZ"),_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("7jxN"),_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("Bj12");window.TopNotifierCur||(window.TopNotifierCur={link:"top_notify_btn",count:"top_notify_count",_qParams:{section:"notifications",_tb:1,list:""},loaded:!1,loading:!1,from:"",viewsObserver:null,viewedNotifications:[]}),window.TopNotifier={onBellMouseDown:function(e){return!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onBellClick:function(e){return!!checkEvent(e)||!!Object(_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_5__.checkKeyboardEvent)(e)&&TopNotifier.show(e)},onLoad:function onLoad(rows,js,from,header){if(!from||TopNotifierCur.from!==from){void 0!==rows&&"undefined"!==rows||Object(_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_11__.logError)("TopNotifier load undefinded response",{environment:"top_notify"});var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,evalExpr)}TopNotifierCur.loaded=!0,val(TopNotifier.getContentNode(),rows),TopNotifier.trackViews(),show(geByClass1("top_notify_show_all")),TopNotifier.refreshHeader(header),TopNotifier.cleanCount(),TopNotifier.refreshCounters(),TopNotifierCur.from=from}},trackViews:function(){var e=ge("top_notify_cont");"IntersectionObserver"in window&&(TopNotifierCur.viewsObserver&&TopNotifierCur.viewsObserver.disconnect(),TopNotifierCur.viewsObserver=new IntersectionObserver((function(e){e.forEach(e=>{var t=e.target.parentNode.dataset.notification_id;e.isIntersecting&&-1===TopNotifierCur.viewedNotifications.indexOf(t)&&(TopNotifierCur.viewedNotifications.push(t),Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__.partConfigEnabled)("notifications_view_new")?Object(_shared_lib_web_stats__WEBPACK_IMPORTED_MODULE_13__.saveStatlogEvents)({name:"notifications_views",value:t,keys:[]}):statlogsValueEvent("notifications_views",t))})}),{root:e,threshold:.6}),geByClass("feedback_row",e).forEach((function(e){TopNotifierCur.viewsObserver.observe(e)})))},refreshHeader:function(e){var t,r=geByClass1("_notify_unread"),n=e&&!geByClass1("_top_notify_header"),a=r&&r.offsetHeight;if(n?(TopNotifierCur.header=se(e),t=ce("div",{className:"top_notify_header_label"}),TopNotifierCur.header.appendChild(t)):t=geByClass1("top_notify_header_label",TopNotifierCur.header),n){val(t,"");var i="";TopNotifierCur.notify_sources.forEach((function(e){""!==e.list&&e.list===TopNotifierCur._qParams.list&&(i=e.name)})),""===i&&(i=getLang("global_notifications_user"));var o,s=ce("div",{className:"top_notify_header_sup_label"}),c=ce("span",{className:"top_notify_header_label_user",innerHTML:i}),u=ce("span",{className:"top_notify_header_label_groups"}),l=ce("a",{onmouseover:function(e){TopNotifier.getSourcesTip(this,e)},className:"top_notify_header_label_groups_link",innerHTML:getLang("global_notifications_groups")});if(u.appendChild(l),o=ce("span",{className:"top_notify_header_label_groups_counter",innerHTML:""}),s.appendChild(c),cur.user_has_admined_groups>0&&(s.appendChild(u),s.appendChild(o)),t.appendChild(s),a){var d=ce("div",{className:"top_notify_header_sub_label",innerHTML:getLang("global_viewed_notifications")});t.appendChild(d)}}n&&TopNotifierCur.wrapper.insertBefore(TopNotifierCur.header,TopNotifierCur.wrapper.firstChild),TopNotifierCur.header_unread=geByClass1("_notify_header"),TopNotifierCur.header_unread&&(a?(TopNotifierCur.header_unread_hidden&&slideDown(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!1,TopNotifierCur.header_unread_handler||(TopNotifierCur.header_unread_height=TopNotifierCur.header_unread.offsetHeight,TopNotifierCur.header_unread_handler=function(e){if(TopNotifierCur.header_unread){var t=TopNotifierCur.header_unread.offsetTop+TopNotifierCur.header_unread_height<e.data.scrollTop;t!=TopNotifierCur.swaped&&(toggleClass(TopNotifierCur.header,"top_notify_header_swap_labels",t),TopNotifierCur.swaped=t)}},TopNotifierCur.scrollbar.emitter.addListener("update",TopNotifierCur.header_unread_handler))):(TopNotifierCur.header_unread_hidden||slideUp(TopNotifierCur.header_unread,100),TopNotifierCur.header_unread_hidden=!0,TopNotifierCur.header_unread_handler&&(TopNotifierCur.scrollbar.emitter.removeListener("update",TopNotifierCur.header_unread_handler),TopNotifierCur.header_unread_handler=null)))},preload:function(){TopNotifier.shown()||vk.isBanned||TopNotifierCur.loaded||ajax.post("/al_feed.php",extend(clone(TopNotifierCur._qParams),{_preload:1}),{cache:1,onDone:function(e,t,r,n){TopNotifier.shown()&&geByClass1("pr","top_notify_cont")&&(TopNotifier.onLoad(e,t,r,n),TopNotifierCur.loaded=!0)},stat:["feed.css","page.css","post.css"]})},loadMore:function loadMore(){var btn=ge("ui_top_notify_load_more");btn&&!Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(btn)&&(TopNotifierCur.ajax=ajax.post("/al_feed.php",extend(clone(TopNotifierCur._qParams),{from:TopNotifierCur.from,more:1,need_header:intval(!(geByClass1("_notify_header")||!geByClass1("_notify_sticky")&&!geByClass1("_notify_unread")))}),{onDone:function onDone(rows,js,newFrom){if(TopNotifierCur.scrollbar){var evalExpr=`(function(){${js};})()`;try{eval(evalExpr)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_9__.logEvalError)(e,evalExpr)}if(rows){for(var row=null,cont=TopNotifier.getContentNode(),au=cf(rows);row=au.firstChild;)cont.insertBefore(row,btn);TopNotifier.refreshHeader(),TopNotifier.trackViews()}newFrom?TopNotifierCur.from=newFrom:re(btn)}},showProgress:function(){show(btn),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(btn)},hideProgress:function(){hide(btn),Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(btn)}}))},updateTime:function(e){each(geByClass("rel_date_needs_update",e,"span"),(function(e,t){if(t){var r=intval(t.getAttribute("time")),n=60*((new Date).getTimezoneOffset()+180),a=getDateText(r,n);!0===hasClass(this,"ucfirst")&&(a=a.charAt(0).toUpperCase()+a.slice(1)),t.innerHTML=a}}))},createNewEventsBox:function(e){if(Object(_shared_user_user_env__WEBPACK_IMPORTED_MODULE_10__.partConfigEnabled)("notify_new_events_box")){var t=TopNotifier.getContentNode();if(t){var r=geByClass1("notifications_new_events",t);e>0?(r||((r=document.createElement("div")).className="feed_row _feed_row notifications_new_events",r.onclick=function(e){r.onclick=null,showProgress(r),TopNotifierCur._qParams.list="",TopNotifier.refresh(e,!1)}),r.innerHTML=langStr(getLang("notifications_new_events",e),"count",e),t.insertBefore(r,t.children[0])):r&&!TopNotifierCur.loading&&re(r)}}},show:function(e){if(gpeByClass("top_notify_cont",e.target))return!0;if(!0!==checkEvent(e)&&!vk.isBanned){if(TopNotifier.shown())return gpeByClass("top_notify_wrap",e.target,ge("top_nav"))||TopNotifier.hide(),cancelEvent(e);var t=ge(TopNotifierCur.link),r=ge("top_notify_cont");TopNotifier.updateTime(r),TopNotifierCur.timeUpdateInt=setInterval((function(){TopNotifier.updateTime(r)}),1e4),cur.introNotifyTooltipHide&&(cur.introNotifyTooltipHide(),delete cur.introNotifyTooltipHide),t.tt&&t.tt.hide&&t.tt.hide(),r||(TopNotifierCur.wrapper=ce("div",{innerHTML:'<div id="top_notify_cont" class="top_notify_cont wall_module" ontouchstart="event.cancelBubble = true;" onmousedown="event.cancelBubble = true;"></div><a href="/feed?section=notifications'+(TopNotifierCur._qParams.list?"&list="+TopNotifierCur._qParams.list:"")+'" class="top_notify_show_all" onmousedown="event.cancelBubble = true;" onclick="TopNotifier.hide(); return nav.go(this, event);">'+getLang("global_notify_show_all")+"</a>",id:"top_notify_wrap",className:"scroll_fix_wrap top_notify_wrap"}),t.appendChild(TopNotifierCur.wrapper),r=ge("top_notify_cont"));var n=window.innerHeight||document.documentElement.clientHeight;setStyle(r,{maxHeight:Math.min(Math.max(n-200,300),600)}),addClass(TopNotifierCur.link,"active");var a=uiScroll;return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.container.__uiScroll__||(TopNotifierCur.scrollbar=new a(r,{global:!0,stopScrollPropagationAlways:!0,onmore:TopNotifier.loadMore})),TopNotifierCur.loaded?TopNotifier.trackViews():TopNotifier.refresh(),window.pushNotifier&&window.pushNotifier.cleanNotification(),cancelStackPush("top_notifier",TopNotifier.hide.bind(TopNotifier),!0),cancelEvent(e)}},hide:function(){TopNotifier.shown()&&(TopNotifierCur.viewedNotifications=[],removeClass(TopNotifierCur.link,"active"),clearInterval(TopNotifierCur.timeUpdateInt),cancelStackFilter("top_notifier",!0),""!==TopNotifierCur._qParams.list&&(TopNotifierCur._qParams.list="",TopNotifier.invalidate()))},shown:function(){return hasClass(TopNotifierCur.link,"active")},getContentNode:function(){return TopNotifierCur.scrollbar&&TopNotifierCur.scrollbar.content&&TopNotifierCur.scrollbar.container.__uiScroll__?TopNotifierCur.scrollbar.content:ge("top_notify_cont")},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=TopNotifier.getContentNode();geByClass1("pr",e)||(val(e,""),showProgress(e))})),hideProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=TopNotifier.getContentNode();val(e,""),hideProgress(e)})),showTooltip:function(e,t){if(!TopNotifier.shown()&&!isVisible("dev_top_nav")){var r=ge(TopNotifierCur.link),n={};if(r){if("shownow"==r.tt&&removeAttr(r,"tt"),e)n.text=function(){return e},t&&(n.onHide=o.pbind(t));else{r.tt&&r.tt.destroy&&r.tt.destroy();var a=ls.get("ntfseen")||{},i=[];each(a,(function(e,t){i.push(e+":"+t)})),n=extend(n,{url:"al_feed.php",params:{act:"a_last_notify",seen:i.join(";")},ajaxdt:2e3,noload:1,onHide:o})}Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__.showTooltip)(r,extend(n,{typeClass:"top_notify_tt",dir:"up",width:250,shift:[1,0],nohideover:1,nohide:1,onShowStart:function(e){TopNotifier.shown()&&(e.opts.onHide=!1,e.hide()),addEvent(e.container,"mousedown",(function(e){if(!e||!inArray(e.target.tagName,["A","IMG"]))return TopNotifier.show(e),cancelEvent(e)})),function e(t){setTimeout((function(){window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?e(t):(t&&t.hide(),Notifier.lcSend("hide_notify_tt"))}),6e3)}(e),Notifier.setRecvClbk("hide_notify_tt",e.hide)}}))}}function o(e){if(!e&&cur.topNotifyTTKey&&(e=cur.topNotifyTTKey,delete cur.topNotifyTTKey),e){var t=e.split(":"),r=ls.get("ntfseen")||{};2===t.length&&(r[0]=parseInt((new Date).getTime()/1e3),r[t[0]]=t[1],ls.set("ntfseen",r))}}},invalidate:function(){TopNotifierCur.loaded=!1,TopNotifierCur.from="",ajax.invalidate("/al_feed.php",TopNotifierCur._qParams),TopNotifierCur.ajax&&TopNotifierCur.ajax.abort()},setCount:function(e,t){isString(e)&&(e=trim(e)),parseInt(e)>=100&&(e="+99"),hasClass(TopNotifierCur.link,"has_notify")&&e?Object(_web_lib_fx__WEBPACK_IMPORTED_MODULE_12__.animateCount)(TopNotifierCur.count,e,{str:"auto"}):val(TopNotifierCur.count,e),toggleClass(TopNotifierCur.link,"has_notify",!!e),t||TopNotifier.invalidate()},cleanCount:function(){if(cur.topNotifyHash){var e=cur.groupNotify_readGids||[];cur.groupNotify_readGids=[],TopNotifierCur.notify_sources.forEach((function(t,r){var n=parseInt(t.list.replace("group-",""));t.list!==TopNotifierCur._qParams.list&&-1===e.indexOf(n)||(TopNotifierCur.notify_sources[r].counter=0)})),ajax.post("/al_feed.php",{act:"a_clean_notify",hash:cur.topNotifyHash,list:TopNotifierCur._qParams.list,gn_readGids:e})}},refresh:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null!==e&&cancelEvent(e),TopNotifier.invalidate(),TopNotifierCur.wrapper&&!TopNotifierCur.loading&&(TopNotifierCur.loading=!0,t&&(re(geByClass1("_notify_header")),re(geByClass1("_top_notify_header"))),TopNotifierCur.from=0,ajax.post("/al_feed.php",TopNotifierCur._qParams,{cache:1,onDone:(e,t,r,n)=>{TopNotifierCur.loading=!1,TopNotifier.onLoad(e,t,r,n)},showProgress:()=>{t&&TopNotifier.showProgress()},stat:["feed.css"],onFail(){TopNotifierCur.loading=!1,hide(geByClass1("top_notify_show_all")),TopNotifier.hideProgress(),val(TopNotifier.getContentNode(),'<div class="top_notify_empty no_rows error_message"><div>'+getLang("global_notify_error_occured")+'</div><button class="flat_button button_small secondary" onclick="TopNotifier.refresh(event);">'+getLang("global_notify_refresh")+"</button></div>")},no_ads_params:!0}))},unifiedDeleteRow:function(e,t,r,n,a){cancelEvent(e);var i=gpeByClass("feed_row",a),o=geByClass1("post_actions",i),s=geByClass1("feedback_row_wrap",i);ajax.post("al_feed.php",{act:"a_feedback_unified_delete",query:t,hash:r,from:"top_notifier"},{onDone:function(e){"."!==n.substr(-1)&&(n+=".");var a=getLang("global_cancel"),o=`${n} <a onclick="TopNotifier.unifiedRestoreRow('${t}', '${r}', this);return cancelEvent(event);">${a}</a>`;e&&(o+="<br>"+e);var c=ce("div",{className:"feedback_deleted_container"});c.appendChild(ce("div",{className:"feedback_row dld _feedback_deleted _top_feedback_deleted",innerHTML:o})),i.appendChild(c),hide(s),hasClass(i,"feedback_row_clickable")&&addClass(i,"feedback_row_touched")},showProgress:addClass.pbind(o,"post_actions_progress"),hideProgress:removeClass.pbind(o,"post_actions_progress")})},unifiedRestoreRow:function(e,t,r){var n=gpeByClass("feed_row",r),a=gpeByClass("feedback_deleted_container",geByClass1("_feedback_deleted",n)),i=geByClass1("feedback_row_wrap",n);if(a&&i){var o=ce("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_unified_restore",query:e,hash:t,from:"top_notifier"},{onDone:function(){show(i),re(a),removeClass(n,"feedback_row_touched")},showProgress:()=>r.parentNode.replaceChild(o,r),hideProgress:()=>o.parentNode.replaceChild(r,o)})}},notifyMarkSpam:function(e,t){ajax.post("al_feed.php",{act:"a_feedback_mark_spam",item:e,hash:t},{onDone:function(t){ge("notify_mark_spam_"+e).innerHTML=t}})},notifyDeleteAll:function(e,t,r,n){if(cur.notifyDeletingAll||(cur.notifyDeletingAll={}),!cur.notifyDeletingAll[e]){cur.notifyDeletingAll[e]=1;var a=ce("span",{className:"progress_inline"});ajax.post("al_feed.php",{act:"a_feedback_delete_all",uid:e,item:r,hash:t},{onDone:function(t,r){var a=gpeByClass("_feedback_deleted",n);if(1!=r){var i,o=!1;if((o=hasClass(a,"_top_feedback_deleted")?ge("top_notify_cont"):cur.rowsCont)&&(i=o.firstChild)){var s,c,u=!1,l=scrollGetY();do{i.className&&hasClass(i,"_feed_row")&&i.firstChild&&e==i.firstChild.getAttribute("author")&&(s=i.offsetHeight,c=i.offsetTop,!1===u&&(u=getXY(i.offsetParent)[1]),hide(i),c+u<l&&(l-=s,scrollToY(l,0)))}while(i=i.nextSibling);(0===cur.wasScroll||cur.wasScroll>0)&&(cur.wasScroll=l)}a.innerHTML='<span class="dld_inner">'+t+"</span>"}else re(gpeByClass("_feed_row",a))},showProgress:function(){n&&"button"===n.tagName.toLowerCase()?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(n):n.parentNode.replaceChild(a,n)},hideProgress:function(){n&&"button"===n.tagName.toLowerCase()?Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(n):a.parentNode.replaceChild(n,a)}})}},checkClick:function(e,t){if(t=t||window.event,!e||!t)return!0;TopNotifier.trackClick(t.target);var r=t.target||t.srcElement,n=8,a=!1,i=/(feedback_row)/;do{if(!r||r===e||r.onclick||r.onmousedown||inArray(r.tagName,["A","IMG","TEXTAREA","EMBED","OBJECT"])||(a=r.className.match(i)))break}while(n--&&(r=r.parentNode));return!!a&&(r||!0)},detectClickRegion:function(e){switch(e.tagName){case"BUTTON":for(var t=e.parentNode.childNodes,r=1,n=0;n<t.length;++n)t[n]===e&&(r=n+1);return"button"+r;case"IMG":return e.dataset.elementName;default:return e.parentNode.closest(".feedback_attachments")?"attachments":"cell"}},trackClick:function(e){var t=e.closest(".feedback_row");if(t){for(var r=t.parentNode,n=TopNotifier.detectClickRegion(e),a=-1,i=geByClass("feedback_row"),o=0;o<i.length;++o)if(i[o]===t){a=o;break}statlogsValueEvent("notifications_click",0,r.dataset.notification_type,a,r.dataset.notification_id,n)}},loadMoreUngrouped:(e,t,r)=>{ajax.post("/al_feed.php",{act:"ungroup_notifications",query:t,from:r},{onDone:(r,n,a)=>{if(!n&&a){if(!r)return TopNotifier.loadMoreUngrouped(e,t,a),!1;r+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+t+"', '"+a+"')\">"+getLang("notifications_show_more")+"</div>"}e.outerHTML=r},showProgress:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(()=>{e.innerHTML="",showProgress(e)}),hideProgress:()=>e.innerHTML=getLang("notifications_show_more"),no_ads_params:!0})},ungroupUnified:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(null!==r){var a=gpeByClass("feed_row",e),i=geByClass1("post_actions",a);ajax.post("/al_feed.php",{act:"ungroup_notifications",query:r,from:n},{onDone:(n,a,i)=>{if(!a&&i){if(!n)return TopNotifier.ungroupUnified(e,t,r,i),!1;n+='<div class="feedback_group_loadmore_button" onclick="TopNotifier.loadMoreUngrouped(this, \''+r+"', '"+i+"')\">"+getLang("notifications_show_more")+"</div>"}e.parentNode.outerHTML=n},showProgress:addClass.pbind(i,"post_actions_progress"),hideProgress:removeClass.pbind(i,"post_actions_progress"),no_ads_params:!0})}else e=domClosest("_feed_row",e),show(domNS(e)),re(e);t.stopPropagation(),t.preventDefault()},showActionsMenu:function(e){var t=!1,r=domClosest("_feed_row",e),n=domPN(r);hasClass(n,"_notify_unread")&&(n=domPN(n)),n.lastChild!=r||hasClass(n,"feed_row_fb_hidden")||hasClass(n,"feedback_sticky_rows")&&domPN(n).lastChild!=n||(t={appendParentCls:"top_notify_wrap",processHoverCls:hasClass(domPN(e),"post_actions")?"feedback_row":"feedback_sticky_row"}),uiActionsMenu.show(e,!1,t)},hideActionsMenu:function(e){uiActionsMenu.hide(e)},frProcess:function(e,t,r,n){var a;Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(r)||(a=n?{act:"add",mid:e,hash:t,request:1,from:"top_notifier"}:{act:"remove",mid:e,hash:t,report_spam:1,from:"top_notifier"},statlogsValueEvent("feed_top_notify",0,"friends",a.act),ajax.post("/al_friends.php",a,{onDone:function(t){var a=domPN(r);val(a,t),addClass(a,"feedback_buttons_response"),"friends"==cur.module&&window.Friends&&(val("request_controls_"+e,t),window.Friends.processRequest(e,n))},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(r),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(r)}))},apiCallProcess:function(e,t,r,n,a,i,o,s){if(Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(s))return!1;var c=function(){ajax.post("/al_feed.php",{act:"a_api_call",hash:cur.topNotifyHash,query:e},{onDone:function(e){var n=domPN(s);val(n,`<div class="feedback_apicallText">${r?`<div class="feedback_apicallIcon ${r}Icon"></div>`:""}${t}</div>`)},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(s),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(s)})};return a?(n=n||getLang("global_action_confirmation"),cur.confirmBox=Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(n,a,i,(function(){c(),cur.confirmBox.hide()}),o)):c(),!0},grProcess:function(e,t,r,n){if(!(hasClass(r,"flat_button")&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(r)||domFC(r)&&"progress_inline"==domFC(r))){var a=-2==n?"spam":n?"enter":"leave",i=-1==n?"_decline":"";ajax.post("/al_groups.php",{act:a,gid:e,hash:t,from:"top_notifier",context:i},{onDone:function(e){var t=domPN(r);val(t,e),addClass(t,"feedback_buttons_response")},onFail:function(e){if(e)return setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!0},showProgress:function(){if(-2==n){r.oldhtml=r.innerHTML;var e=getSize(r)[0];r.innerHTML='<span class="progress_inline"></span>',setStyle(domFC(r),{width:e})}else Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(r)},hideProgress:function(){-2==n?r.innerHTML=r.oldhtml:Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(r)}})}},gn_grProcess:function(e,t,r,n,a,i){return a.stopPropagation(),hasClass(n,"flat_button")&&Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.isButtonLocked)(n)||domFC(n)&&"progress_inline"==domFC(n)||ajax.post("groupsedit.php",{act:"user_action",id:e,addr:t,hash:r,from:"top_notifier",action:i},{onDone:function(e){var t=domPN(n);return val(t,e),addClass(t,"feedback_buttons_response"),!1},onFail:function(e){return!!e&&(setTimeout(Object(_web_lib_message_box__WEBPACK_IMPORTED_MODULE_7__.showFastBox)(getLang("global_error"),e).hide,3e3),!1)},showProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton)(n)},hideProgress:function(){Object(_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton)(n)}}),!1},showGiftBox:function(e,t,r){return!showBox("al_gifts.php",{act:"get_gift_box",fids:e,fr:1,ref:r},{stat:["gifts.css","wide_dd.js","wide_dd.css"],cache:1,dark:1},t)},getSourcesTip:function(e,t){return cancelEvent(t),Object(_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_8__.showTooltip)(e,{url:"/al_page.php",params:{act:"notify_get_sources",cur_list:TopNotifierCur._qParams.list},slide:15,ajxdt:200,hidedt:200,dir:"bottom",shift:[100,10],id:"notify_sources",className:"notify_sources",onShowStart:function(){TopNotifierCur.notify_sources.forEach((function(e){val(geByClass1("notify_tooltip_counter"+e.list),e.counter>0?e.counter:"")})),TopNotifier.refreshTooltip()}}),!1},changeSource:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==r&&cancelEvent(r),e!==TopNotifierCur._qParams.list?(re(geByClass1("notify_sources")),t&&val(geByClass1("ui_rmenu_count",t),""),geByClass1("top_notify_show_all")&&attr(geByClass1("top_notify_show_all"),"href","/feed?section=notifications"+(e?"&list="+e:"")),TopNotifierCur._qParams.list=e,TopNotifier.refresh()):hide(geByClass1("notify_sources"))},changeSourceFullCallback:function(){TopNotifier.refreshCounters(),TopNotifierCur.notify_sources.forEach((function(e){e.list&&val(geByClass1("ui_rmenu_count",geByClass1("feed_section_"+e.list)),e.counter>0?e.counter:"")}));var e=geByTag1("a",geByClass1("header_side_link",geByClass1("feed_notifications")));""===TopNotifierCur.settings_url?hide(e):(show(e),attr(e,"href",TopNotifierCur.settings_url)),TopNotifierCur.source_name||(TopNotifierCur.source_name=getLang("news_title_notifications")),val(geByClass1("page_block_header_inner",geByClass1("feed_notifications")),TopNotifierCur.source_name)},hideBanner:function(e,t,r){ajax.post("al_feed.php",{act:"a_feedback_hide_banner",group_id:r,hash:t}),hide(ge("internal_notification131"))},addNewSource:function(e,t,r){return ajax.post("al_settings.php",{act:"a_group_notify_add_source",gid:e,from:r,hash:t},{onDone:function(t){nav.go("/settings?act=group_notify&gid="+e),TopNotifier.changeSource("group-"+e,null,null)},showProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.lockButton.pbind(cur.popupSubmitBtnEl),hideProgress:_web_lib_ui__WEBPACK_IMPORTED_MODULE_6__.unlockButton.pbind(cur.popupSubmitBtnEl)}),!0},refreshCounters:function(){var e=0,t=0,r=0,n=geByClass1("top_notify_header_label_groups_counter");TopNotifierCur.notify_sources.forEach((function(n){""!==n.list&&n.counter>0&&(1===n.unmuted?t++:e++),""===n.list&&(r=n.counter)})),vk.counts.ntf=r+t,TopNotifier.setCount(r+t,!0),TopNotifier.createNewEventsBox(r),t>0?(addClass(n,"unmuted"),val(n,t)):(removeClass(n,"unmuted"),val(n,e>0?e:""))},refreshTooltip:function(){var e=geByClass1("groups",geByClass1("notify_sources")),t=[],r=[],n=ce("div");e&&(geByClass("line_cell",e).forEach((function(e,n){val(geByClass1("ui_rmenu_count",e))>0?t.push(e):r.push(e)})),t.concat(r).forEach((function(e){n.appendChild(e)})),val(e,""),e.appendChild(n))},showCommonFriendsBox:function(e,t){return showTabbedBox("al_page.php",{act:"box",oid:t,tab:"common"},{cache:1},e),!1}}},lJdi:function(e,t,r){"use strict";r.r(t),r.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_INVITE",(function(){return o})),r.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_PIN",(function(){return s})),r.d(t,"MAIL_CHAT_FLAG_ONLY_ADMINS_CAN_CHANGE_TITLE",(function(){return c})),r.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_ADD_ADMINS",(function(){return u})),r.d(t,"MAIL_CHAT_FLAG_ADMINS_CAN_INVITE_LINK",(function(){return l})),r.d(t,"MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE",(function(){return d})),r.d(t,"MAIL_CHAT_FLAG_IS_CASPER",(function(){return _})),r.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT",(function(){return f})),r.d(t,"MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED",(function(){return h})),r.d(t,"MAIL_CHATS_ACTION_SEE_INVITE_LINK",(function(){return p})),r.d(t,"MAIL_CHATS_ACTION_CHANGE_INVITE_LINK",(function(){return g})),r.d(t,"MAIL_CHATS_ACTION_INVITE_USER",(function(){return m})),r.d(t,"MAIL_CHATS_ACTION_PIN_OR_UNPIN",(function(){return b})),r.d(t,"MAIL_CHATS_ACTION_CHANGE_TITLE",(function(){return v})),r.d(t,"MAIL_CHATS_ACTION_ADD_ADMIN",(function(){return C})),r.d(t,"canSeeInviteLink",(function(){return T})),r.d(t,"canChangeInviteLink",(function(){return E})),r.d(t,"canAddAdmin",(function(){return O})),r.d(t,"canInviteUser",(function(){return w})),r.d(t,"canKickUser",(function(){return k})),r.d(t,"canPinOrUnpin",(function(){return N})),r.d(t,"canChangeTitle",(function(){return I})),r.d(t,"canChangeAvatar",(function(){return S})),r.d(t,"canSeeAllMessages",(function(){return j})),r.d(t,"canSeeSettingsItem",(function(){return A})),r.d(t,"canCloseChat",(function(){return M})),r.d(t,"checkChatRights",(function(){return P})),r.d(t,"doesChatTabHaveFlag",(function(){return F})),r.d(t,"isUserAdminInChat",(function(){return L})),r.d(t,"isUserOwnerInChat",(function(){return x})),r.d(t,"isUserInvitedByMe",(function(){return D}));r("OEbY");var n=r("rHUl"),a=r("aong"),i=r("P13b"),o=1,s=4,c=8,u=16,l=32,d=16384,_=32768,f=1<<17,h=1<<18,p="see_invite_link",g="change_invite_link",m="invite_user",b="pin_unpin",v="change_title",C="add_admin",y={[p]:l,[g]:l,[C]:u,[m]:o,[b]:s,[v]:c};function T(e,t,r){return P(e,p,t,r)}function E(e,t,r){return P(e,g,t,r)}function O(e,t,r,i){var o=Object(a.unpackStore)(e);return!x(Object(n.getTab)(o,r||o.peer),t)&&P(e,C,r,i)}function w(e,t,r){return P(e,m,t,r)}function k(e,t,r,o){var s=Object(a.unpackStore)(e);if(function(e,t){var r=Object(a.unpackStore)(e);return void 0!==r.service&&(r.service&t)>0}(e,1))return!0;var c=Object(n.getTab)(s,r||s.peer);return!(c.data.kicked&&!c.data.closed)&&(!Object(i.isFvkcomgroup)(e,r)&&(!x(c,t)&&(!!x(c,o=void 0===o?window.vk.id:o)||(L(c,o)||D(c,t))&&!L(c,t))))}function N(e,t,r){return P(e,b,t,r)}function I(e,t,r){return P(e,v,t,r)}function S(e,t,r){return I(e,t,r)&&!Object(i.isFvkcomgroup)(e,t)}function j(e,t,r){return!Object(n.isCommunityPeer)(r)||!!Object(n.getTab)(e,t).caccess[r]}function A(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,o=Object(a.unpackStore)(e),s=Object(i.isFvkcomgroup)(o,t),c=o.tabs[o.peer];if(Object(n.isCommunityChat)(o,t)){var u=c&&c.data&&Object(n.isChatActive)(c),l=x(c,-o.gid)&&u,_=l||L(c,r)&&u,f=c.allowedUpdateFlags?c.allowedUpdateFlags.filter(e=>e!==d):[];return!(!_||!f.length)}return x(c,r)&&!s}function M(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.vk.id,i=Object(a.unpackStore)(e),o=Object(n.isCommunityChat)(i,t),s=Object(n.isCommunityChatDeleted)(i,t),c=i.tabs[i.peer],u=c&&c.data&&Object(n.isChatActive)(c),l=x(c,-i.gid)&&u,_=l||L(c,r)&&u;return o&&!s&&_&&c.allowedUpdateFlags&&c.allowedUpdateFlags.includes(d)}function P(e,t,r,o){var s=Object(a.unpackStore)(e);o=void 0===o?window.vk.id:o,r=void 0===r?s.peer:r;var c=Object(n.getTab)(s,r),u=c&&c.data&&Object(n.isChatActive)(c),l=y[t];if(Object(i.isFvkcomgroup)(e,r))switch(t){case C:case m:return!1;case p:return u;default:return s.gid>0}else if(Object(n.isCommunityChat)(e,r)){if(Object(n.isClosedChat)(e,r))return!1;var d=x(c,-s.gid)&&u,_=d||L(c,o)&&u;switch(t){case p:case g:case C:return F(c,l)?_:d;case m:return!d&&(F(c,l)?_:u);case b:case v:return _;default:return!1}}switch(t){case p:case g:case C:return F(c,l)?L(c,o)&&u:x(c,o);case m:case b:case v:return F(c,l)?L(c,o)&&u:u}return!1}function F(e,t){return((e&&e.data&&e.data.flags||0)&t)>0}function L(e,t){return(e&&e.adminIds||[]).indexOf(+t)>-1}function x(e,t){return e.ownerId===t}function D(e,t){return-1!==e.invitedByMe.indexOf(t)}},nJdr:function(e,t,r){"use strict";r.r(t),r.d(t,"createLongpoll",(function(){return g}));var n=r("DM26"),a=r("BxOC"),i=r("f01n");function o(e,t){e.waitAbortFns.push(t)}function s(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});var t=Object(a.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode}),r=t.request,i=t.cancel;return e.stopFn=i,r.then((function(t){var r=t[0],n=t[1];return e.onData(e,n),e.waitTimeout=2,JSON.parse(r)})).catch((function(t){var r=t[1];return e.onData(e,r),Promise.reject(new Error(""))})).then((function(t){return function(e,t){var r=t.failed?Object(n.abortablePause)(4,null):{abort:function(){},pause:function(){return Promise.resolve()}},a=r.abort,i=r.pause;switch(t.failed){case 1:return o(e,a),e.onHistoryLost(e,t).then((function(){return e.onResult({ts:t.ts,updates:[[-1]]})})).then(i).then((function(){return s(e)}));case 2:return o(e,a),e.onKeyExpired(e,t).then((function(t){var r=t[0],n=t[1],a=t[2],i=t[3];return e.onResult({ts:+i,updates:[[-2,r,n+"/"+a],[-1]]})})).then(i).then((function(){return s(e)}));case 3:return e.onLpBroken(e,t);default:return Promise.resolve(t)}}(e,t)}))}function c(e){e.isStoppedFn()||s(e).then(e.onResult.bind(e)).then((function(){return e.isReconnecting&&u(e,-5)})).catch((function(t){return function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);var r=Object(n.abortablePause)(e.waitTimeout,null),a=r.abort,i=r.pause;return o(e,a),i().then((function(){return u(e,-4)}))}(e,t)})).then((function(){return c(e)}))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function l(e,t){var r=!!e.stopped,n={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||9,mode:202,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:function(){return r},onResult:function(e){e.ts&&o(n.ts,e.ts,e.updates.map((function(e){switch(e[0]){case 0:return i.deleteEvent(e);case 1:return i.replaceFlagsEvent(e);case 2:return i.setFlagsEvent(e);case 3:return i.resetFlagsEvent(e);case 4:return i.addMessageEvent(e);case 5:return i.editMessageEvent(e);case 6:return i.readInboundEvent(e);case 7:return i.readOutboundEvent(e);case 8:return i.gotOnlineEvent(e);case 9:return i.gotOfflineEvent(e);case 10:return i.resetDirectoriesEvent(e);case 11:return i.replaceDirectoriesEvent(e);case 12:return i.setDirectoriesEvent(e);case 13:return i.deleteDialogEvent(e);case 18:return i.replaceMessageEvent(e);case 51:return i.chatChangedEvent(e);case 52:return i.chatUpdatedEvent(e);case 63:return i.typingEvent(e);case 64:return i.recordingAudioEvent(e);case 70:return i.videoCallEvent(e);case 80:return i.unreadCountEvent(e);case 114:return i.notifySettingsChangedEvent(e);case 115:return i.incomingCallEvent(e);case 116:return i.refreshMessageEvent(e);case 117:return i.audioStartEvent(e);case 119:return i.keyboardCallbackReceivedEvent(e);case-1:return i.resyncEvent();case-2:return i.refreshLpKeyEvent(e);case-3:return i.waitingForReconnectEvent(e);case-4:return i.reconnectingEvent();case-5:return i.reconnectedEvent();default:return i.emptyEvent(e)}})))},onData:d(t.onData),onRequestError:d(t.onRequestError),onHistoryLost:_(t.onHistoryLost),onKeyExpired:_(t.onKeyExpired),onLpBroken:_(t.onHistoryLost)},a=t.onEvents;function o(e,t,r){n.ts=t;for(var o=0;o<r.length;++o)r[o].type===i.REFRESH_LP_KEY&&(n.key=r[o].key||"",n.url=r[o].url||"");a(e,t,r)}var s={options:n,isStopped:function(){return r},stopConnection:function(){r=!0,n.stopFn&&n.stopFn(),n.stopFn=void 0,document.removeEventListener("resume",l),this.abortWaiting()},reinitConnection:function(){this.stopConnection(),document.addEventListener("resume",l),u(n,-4),r=!1,c(n)},abortWaiting:function(){n.waitAbortFns.forEach((function(e){return e()})),n.waitAbortFns=[],n.waitTimeout=2},onLp:o};function l(){s.abortWaiting()}return document.addEventListener("resume",l),c(n),s}function d(e){return e||function(){}}function _(e){return e?function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Promise.resolve(e.apply(void 0,t))}:function(){return Promise.reject()}}var f=r("bP5l"),h=r("vT4u"),p=r("XzvV");function g(e,t){return l(e,{onEvents:t,onData:v,onRequestError:C,onHistoryLost:y,onKeyExpired:T,onLpBroken:E})}var m={},b=Date.now();function v(e,t){if(t&&t.status&&e.lpstat){var r=t.status.toString();t.status>=500&&t.status<600&&Object(p.statlogsValueEvent)("fc_longpoll",1,r,t.getResponseHeader("x-frontend")||""),m[r]=r in m?m[r]+1:1,Date.now()-b>=3e4&&(Object.keys(m).forEach((function(e){Object(p.statlogsValueEvent)("fc_longpoll",m[e],e,t.getResponseHeader("x-frontend")||"")})),m={},b=Date.now())}}function C(e){Object(f.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function y(e,t){Object(f.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function T(e){return Object(f.lpLogFc)("red","LP failed: key is incorrect; refresh key"),Object(a.post)(h.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0})}function E(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},ofcU:function(e,t,r){"use strict";r.r(t),r.d(t,"createMutations",(function(){return c})),r.d(t,"createModule",(function(){return d})),r.d(t,"destroyModule",(function(){return _}));r("HEwt"),r("a1Th"),r("rE2o"),r("ioFf"),r("rGqo"),r("Btvt"),r("KKXr");function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var i=new window.Map;function o(e){var t=i.get(e.currentTarget);if(t){var r=t[e.type];if(r)for(var a,o=0;o<r.length;o++){var s=n(r[o],2),c=s[0],u=s[1],l=void 0;if(hasClass(e.target,c)?l=u(e,e.target):(a=gpeByClass(c,e.target,e.currentTarget))&&(l=u(e,a)),!1===l)break}}}var s=r("Egk5");function c(e){return{callMutations:function(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e.apply(void 0,t)}}}function u(e,t,r,n){Object(s.addEvent)(t,r,n),e._registeredHandlers.push({handlerType:"bind",elem:t,types:r,handler:n})}function l(e,t,r,n,a){!function(e,t,r,n){var a=i.get(e);a||(i.set(e,{}),a=i.get(e));for(var s=t.split(" "),c=0;c<s.length;c++){var u=s[c];a[u]||(a[u]=[],addEvent(e,u,o)),a[u].push([r,n])}}(t,r,n,a),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:r,selector:n,handler:a})}function d(e){var t={_registeredHandlers:[]};return e.handlers(u.bind(null,t),l.bind(null,t)),t}function _(e){e._registeredHandlers.forEach((function(e){var t,r,n,a,c;"delegate"===e.handlerType?(t=e.elem,r=e.types,n=e.selector,a=e.handler,(c=i.get(t))&&(r.split(" ").forEach(e=>{c[e]&&(c[e]=c[e].filter(e=>e[0]!==n||e[1]!==a),0===c[e].length&&removeEvent(t,e,o))}),0===Object.keys(c).map(e=>c[e].length).reduce((e,t)=>e+t)&&i.delete(t))):Object(s.removeEvent)(e.elem,e.types,e.handler)})),e._registeredHandlers=[]}},r7nW:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),a=r("i8i4"),i=(r("17x9"),r("pemR"));class o extends n.Component{constructor(){super(...arguments),this.getScrollbarWidth=()=>{var e=document.createElement("div");e.classList.add("BaseModal__scrollbarMeasure"),document.body.appendChild(e);var t=e.getBoundingClientRect().width-e.clientWidth;return document.body.removeChild(e),t},this.hideScrollBar=()=>{var e=document.body.getBoundingClientRect(),t=e.left+e.right<window.innerWidth,r=this.getScrollbarWidth();this.calculatedPadding=window.getComputedStyle(document.body)["padding-right"],t&&(document.body.style.paddingRight=parseFloat(this.calculatedPadding)+r+"px"),document.body.classList.add("BaseModal__bodyHiddenOverflow")},this.showScrollBar=()=>{document.body.style.paddingRight=this.calculatedPadding,document.body.classList.remove("BaseModal__bodyHiddenOverflow")},this.onDocumentKeyDown=e=>{var t=this.props.onClose;"Escape"===e.key&&t()},this.onBackdropClick=()=>{var e=this.props,t=e.onClose;!e.disableBackdropClick&&t()}}componentDidMount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.addEventListener("keydown",this.onDocumentKeyDown),r&&this.hideScrollBar()}componentWillUnmount(){var e=this.props,t=e.disableEscapeClose,r=e.disableBodyScroll;t||document.body.removeEventListener("keydown",this.onDocumentKeyDown),r&&this.showScrollBar()}renderModal(){var e=this.props.className,t=Object(i.classNames)("BaseModal",e);return n.createElement("div",{className:t,"aria-modal":"true"},n.createElement("div",{className:"BaseModal__backdrop",onClick:this.onBackdropClick}),n.createElement("div",{className:"BaseModal__content"},this.props.children))}render(){return a.createPortal(this.renderModal(),document.body)}}o.defaultProps={className:"",children:null,disableBackdropClick:!1,disableEscapeClose:!1,disableBodyScroll:!1},t.default=o},rHUl:function(e,t,r){"use strict";r.r(t),r.d(t,"getFirstUnread",(function(){return d})),r.d(t,"isSearchShown",(function(){return _})),r.d(t,"getPeer",(function(){return f})),r.d(t,"getCurrentKeyboard",(function(){return h})),r.d(t,"getKeyboard",(function(){return p})),r.d(t,"getTab",(function(){return g})),r.d(t,"getCurrentTab",(function(){return m})),r.d(t,"getSelectedMessages",(function(){return b})),r.d(t,"getMessageRangeFromSelection",(function(){return v})),r.d(t,"countUnread",(function(){return C})),r.d(t,"getMessageByRid",(function(){return y})),r.d(t,"isRidExist",(function(){return T})),r.d(t,"getLocalId",(function(){return E})),r.d(t,"getLastMessage",(function(){return O})),r.d(t,"parserMessage",(function(){return w})),r.d(t,"getAuthorFullName",(function(){return k})),r.d(t,"getMessage",(function(){return N})),r.d(t,"getPreviousMessage",(function(){return I})),r.d(t,"isClassicInterface",(function(){return S})),r.d(t,"isLocksAvailable",(function(){return j})),r.d(t,"isFoldersAvailable",(function(){return A})),r.d(t,"isCommunityInterface",(function(){return M})),r.d(t,"isChannelPeer",(function(){return P})),r.d(t,"getBareTab",(function(){return F})),r.d(t,"isReversedDialogs",(function(){return L})),r.d(t,"isFullyLoadedTab",(function(){return x})),r.d(t,"makeTabNotFullyLoaded",(function(){return D})),r.d(t,"isGoToEndVisible",(function(){return R})),r.d(t,"isGoToMentionVisible",(function(){return B})),r.d(t,"getUnreadScrollBottom",(function(){return H})),r.d(t,"isSendingAvailable",(function(){return U})),r.d(t,"isCommunityPeer",(function(){return q})),r.d(t,"isCommunityBlocked",(function(){return W})),r.d(t,"checkVoiceMessageAvailable",(function(){return G})),r.d(t,"isSearching",(function(){return z})),r.d(t,"getSearchText",(function(){return K})),r.d(t,"isSearchingValue",(function(){return V})),r.d(t,"isRecentSearchesActive",(function(){return $})),r.d(t,"getPinnedMessage",(function(){return Y})),r.d(t,"doPopularSuggExist",(function(){return Q})),r.d(t,"isAnyMessageBeingEdited",(function(){return X})),r.d(t,"getGroupId",(function(){return J})),r.d(t,"getTabDraft",(function(){return Z})),r.d(t,"getTemplates",(function(){return ee})),r.d(t,"tabIsMessageRequest",(function(){return te})),r.d(t,"tabIsMessageRequestToChat",(function(){return re})),r.d(t,"removeMessageRequestFolderFlags",(function(){return ne})),r.d(t,"isMessageRequestFolder",(function(){return ae})),r.d(t,"tabIsOutgoingMessageRequest",(function(){return ie})),r.d(t,"existsIncomingMessageRequest",(function(){return oe})),r.d(t,"isMessageRequestChangedEvent",(function(){return se})),r.d(t,"isCommunityChat",(function(){return ce})),r.d(t,"isCommunityChatDeleted",(function(){return ue})),r.d(t,"isClosedChat",(function(){return le})),r.d(t,"isCasperChat",(function(){return de})),r.d(t,"isCasperChatTab",(function(){return _e})),r.d(t,"isChatActive",(function(){return fe}));r("Vd3H"),r("rGqo"),r("Btvt");var n=r("MhhX"),a=r("f01n"),i=r("h++7"),o=r("86+7"),s=r("rjmT"),c=r("aong"),u=r("lJdi"),l=r("rudk");function d(e,t){var r=Object(c.unpackStore)(e),a=r.tabs[r.peer];return Object.keys(a.msgs).filter(r=>{var i=N(e,t,r);return!Object(n.isOut)(i)&&intval(r)>a.in_up_to})[0]}function _(e){return Object(c.unpackStore)(e).searchShown}function f(e){return Object(c.unpackStore)(e).peer}function h(e){return p(e,f(e))}function p(e,t){var r=(g(e,t)||{}).keyboard;if(!r||!r.buttons||r.buttons.length)return r}function g(e,t){var r=Object(c.unpackStore)(e);return r.tabs&&r.tabs[t]}function m(e){var t=Object(c.unpackStore)(e);return t.peer?t.tabs[t.peer]:null}function b(e){return Object(c.unpackStore)(e).selectedMessages}function v(e,t,r){var a=g(e,t),i=b(e)[0];if(void 0===i)return[r];var o=Math.min(r,i),s=Math.max(r,i);return Object.keys(a.msgs).filter(e=>e>=o&&e<=s).filter(t=>{var r=N(e,e.get().peer,t);return!Object(n.isServiceMsg)(r)&&!Object(n.isCallMessage)(r)}).map(intval)}function C(e,t){var r=g(Object(c.unpackStore)(t),e),a=0;for(var i in r.msgs)if(r.msgs.hasOwnProperty(i)){var o=N(t,e,i);Object(n.isOut)(o)||(a+=Object(n.isUnread)(r,o)?1:0)}return a}function y(e,t,r){var n=g(e,t);return Object.keys(n.msgs).filter(n=>intval(N(e,t,n).randomId)===r).length>0}function T(e,t,r){return!!y(e,t,r)}function E(e,t){var r=Object(c.unpackStore)(e),n=r.msg_local_ids_sort&&r.msg_local_ids_sort[t];return void 0!==n?2e9+n:t}function O(e,t,r){var n=g(e,t),i=N(e,t,r),o=Object.keys(n.msgs).filter(r=>{var n=N(e,t,r),o=n.local&&n.type!==a.EDIT_MESSAGE;return!(!i.local&&o)&&(!(!i.local||o)||E(e,i.messageId)>E(e,n.messageId))}).pop();return o?N(e,t,o):null}function w(e){return e&&e.length>0?a.addMessageEvent([0].concat(e)):e}function k(e,t,r){var a=g(e,t),i=N(e,t,r),s=Object(c.unpackStore)(e);return Object(n.isOut)(i)?Object(o.oCacheGet)(e,s.id).name:i.userId!==i.peerId?!!Object(o.oCacheExists)(e,i.userId)&&Object(o.oCacheGet)(e,i.userId).name:a.tab}function N(e,t,r){var n=g(e,t),a=n&&n.msgs&&n.msgs[r];return a?w(a):null}function I(e,t,r){var n=g(e,t),a=n&&n.msgs&&Object.keys(n.msgs).sort((e,t)=>+e-t);if(!a)return null;var i=a&&a.indexOf(""+r),o=i>-1?a[i-1]:null;return n.msgs[o]}function S(e){var t=Object(c.unpackStore)(e);return t.gid||t.isClassic}function j(e){return Object(c.unpackStore)(e).gid}function A(e){return Object(c.unpackStore)(e).gid}function M(e){return!!Object(c.unpackStore)(e).gid}function P(e){return!!(e.peerId>2e9&&Object(u.doesChatTabHaveFlag)(e,1024))}function F(e,t){var r=Object(c.unpackStore)(t);return r.tabs[e]||r.mapped_index[e]}function L(e){var t=Object(c.unpackStore)(e);return!!M(e)&&((19542789===t.gid||103416369==t.gid)&&(t.active_tab===i.FOLDER_UNRESPOND||t.active_tab===i.FOLDER_UNREAD))}function x(e,t){var r=(e=Object(c.unpackStore)(e)).tabs;return!(!r||!r[t]||void 0===r[t].history||!r[t].msgs)}function D(e,t){var r=g(e,t);r&&(r.msgs=void 0,r.msgid=void 0,r.scrollTop=void 0,r.scrollBottom=void 0,r.contHeight=void 0,r.offset=void 0,r.skipped=void 0)}function R(e){var t=e.get().go_to_end_visible;return!!t&&t[0]}function B(e){var t=e.get().go_to_mentions_visible;return!!t&&t[0]}function H(e){var t=e.get().go_to_end_visible;return t?t[1]:0}function U(e){return!Object(c.unpackStore)(e).lockedSending}function q(e){return e>-2e9&&e<0}function W(e,t){return!!q(t)&&!!g(e,t).blocked_community}function G(e){return Object(c.unpackStore)(e).voice_message_available}function z(e){var t=Object(c.unpackStore)(e);return!(!K(t)&&!t.recentSearch)}function K(e){return Object(c.unpackStore)(e).searchText}function V(e,t){var r=Object(c.unpackStore)(e);return!!(t&&t!==K(e)||r.recentSearch)}function $(e){return Object(c.unpackStore)(e).recentSearch}function Y(e){var t=m(e);return t&&t.pinned&&w(t.pinned)}function Q(e){var t=e.get().popular_sugg;return t&&t.length>0}function X(e){return 1==Object(c.unpackStore)(e).isEditing}function J(e){return Object(c.unpackStore)(e).gid}function Z(e){return e.draft||(e.draft=Object(s.loadDraftForPeer)(cur.imDb,e.peerId)),e.draft}function ee(e){return(Object(c.unpackStore)(e).templates||[]).filter(e=>!e.deleted)}function te(e){return!!e&&Boolean(e.is_message_request||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]||e.folders&i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED])}function re(e){return Object(l.isChatPeer)(e.peerId)&&te(e)}function ne(e){return e&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST]&~i.FOLDER_MASKS[i.FOLDER_MESSAGE_REQUEST_REJECTED]}function ae(e){return Object(c.unpackStore)(e).active_tab===i.FOLDER_MESSAGE_REQUEST}function ie(e){return e.peerId>19e8&&e.peerId<2e9}function oe(e){return!!Object(c.unpackStore)(e).dialog_tab_cts[i.FOLDER_MESSAGE_REQUEST]}function se(e){var t=e.type,r=e.updateType;return t===a.CONVERSATION_UPDATED&&(r===a.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED||r===a.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED)}function ce(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT)}function ue(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_COMMUNITY_CHAT_DELETED)}function le(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_DENY_ANYONE_TO_WRITE)}function de(e,t){return Object(u.doesChatTabHaveFlag)(g(e,t),u.MAIL_CHAT_FLAG_IS_CASPER)}function _e(e){return Object(u.doesChatTabHaveFlag)(e,u.MAIL_CHAT_FLAG_IS_CASPER)}function fe(e){return!e.data.closed&&!e.data.kicked}},rjmT:function(e,t,r){"use strict";r.r(t),r.d(t,"ImDraft",(function(){return c})),r.d(t,"loadDraftForPeer",(function(){return l}));r("HEwt"),r("a1Th"),r("rGqo"),r("rE2o"),r("ioFf"),r("KKXr"),r("VRzm"),r("Btvt"),r("OEbY"),r("pIFo");var n=r("BxOC"),a=r("f01n"),i=r("vT4u");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){this._db=e,this._key=t,this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.load()}function u(e){switch(e.type){case"mail":case"reply":return e.id<0&&1==e.object.fwd_count;default:return!e.object}}function l(e,t){return new c(e,"draft_"+t)}c.prototype.dump=function(){var e;this._key&&this._db.updateByKey(this._key,{txt:(e=this.dData).txt,attaches:e.attaches.length?e.attaches:void 0,urlBinds:e.urlBinds.length?e.urlBinds:void 0,cancelled:e.cancelled.length?e.cancelled:void 0})},c.prototype.load=function(){if(this._key){var e=this._db.selectByKey(this._key);e&&(this.dData=function(e){return{txt:e.txt,attaches:e.attaches||[],urlBinds:e.urlBinds||[],cancelled:e.cancelled||[]}}(e))}},c.prototype.clear=function(){this.dData={txt:"",attaches:[],urlBinds:[],cancelled:[]},this.dump()},c.prototype.setText=function(e){this.dData.txt=trim(e),this.dump()},c.prototype.addAttach=function(e,t,r){if(("share"===e&&this.removeAttachByType(e),"mail"!==e&&"reply"!==e||(this.removeAttachByType("mail"),this.removeAttachByType("reply")),"audio_playlist"===e||"artist"===e)&&this.dData.attaches.find(t=>t.type===e))return!1;if(!e||!t&&"poll"!==e)return!1;var n=this.dData.attaches.findIndex(r=>r.type===e&&r.id===t);-1===n?(this.dData.attaches.push({type:e,id:t,object:r}),this.dump()):"video"!==e&&"poll"!==e||(this.dData.attaches[n]={type:e,id:t,object:r},this.dump())},c.prototype.syncWithSelector=function(e){var t=this.getFwdRaw();this.dData.attaches=(t?[t]:[]).concat(e.getMedias().map(e=>{var t=o(e,2),r=t[0],n=t[1];return this.dData.attaches.find(e=>e.type==r&&e.id==n)||{type:r,id:n}})),this.dump()},c.prototype.removeAttachByType=function(e){for(var t=this.dData.attaches.length;t--;)this.dData.attaches[t].type===e&&this.dData.attaches.splice(t,1);this.dump()},c.prototype.removeAllAttaches=function(){this.dData.attaches=[],this.dData.cancelled=[],this.dump()},c.prototype.addBindUrl=function(e,t,r){this.getBoundAttach(e)||(this.dData.urlBinds.push({url:e,type:t,id:r}),this.dump())},c.prototype.getBoundAttach=function(e){var t=this.dData.urlBinds.find(t=>t.url===e);return t&&this.dData.attaches.find(e=>e.type===t.type&&e.id===t.id)||null},c.prototype.getShareUrl=function(){var e=this.dData.attaches.find(e=>"share"===e.type);if(e&&e.object)return e.object.url.replace(/&amp;/g,"&")},c.prototype.hasOnlyReplies=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?e.flags&a.FLAG_HAS_REPLY&&!this.dData.attaches.find(e=>"mail"!==e.type):this.hasAttaches()&&!this.dData.attaches.find(e=>"reply"!==e.type)},c.prototype.getCancelledShares=function(){return this.dData.cancelled.length?this.dData.cancelled:void 0},c.prototype.hasAttaches=function(){return this.dData.attaches.length>0},c.prototype.destroy=function(){this.dData={},this._key=this._db=null},c.prototype.prepareObjects=function(e,t){return this.dData.attaches.find(u)?Object(n.post)(i.CONTROLLER,{act:"draft_medias",gid:e,messageId:t||0,media:t?void 0:this.dData.attaches.map(e=>[e.type,e.id]).join("*")}).then(e=>{var t=o(e,1)[0];this.dData.attaches=t.map(e=>({type:e[0],id:e[1],object:e[2]}))}):Promise.resolve()},c.prototype.getFwdRaw=function(){return this.dData.attaches.find(e=>"mail"===e.type||"reply"===e.type)},c.prototype.getFwdCount=function(){var e=this.getFwdRaw();return e?e.id<0?e.object.fwd_count:e.id.split(";").length:0}},rudk:function(e,t,r){"use strict";r.r(t),r.d(t,"parseFwd",(function(){return o})),r.d(t,"convertKludgesToAttaches",(function(){return s})),r.d(t,"isReservedPeer",(function(){return c})),r.d(t,"isUserPeer",(function(){return u})),r.d(t,"isChatPeer",(function(){return l})),r.d(t,"convertAttachesToPhpMedia",(function(){return d}));var n=r("jE6c");function a(e,t){void 0===t&&(t=[]);var r=e.split("_");return[r[0],r[1],t]}var i={};function o(e){if(i[e])return i[e];for(var t=e?e.length:0,r=[],n=[],o="",s=0;s<t;s++){var c=e[s],u=c.charCodeAt(0);u>=48&&u<=57||"_"===c||"-"===c?o+=c:"("!==c&&")"!==c&&":"!==c&&","!==c||(""!==o&&(n.push(o),r.push("id"),o=""),n.push(c),r.push(c))}o.length>0&&(n.push(o),r.push("id"));var l=function e(t,r,n,i){if(void 0===n&&(n=0),void 0===i&&(i=0),i>50)return[[],t.length];for(var o=[],s="";n<t.length;){var c=t[n];if("id"===c)s=r[n];else if(","===c&&s)o.push(a(s)),s="";else if("("===c){var u=e(t,r,n+1,i+1),l=u[0];n=u[1],o.push(a(s,l)),s=""}else if(")"===c)return""!==s&&o.push(a(s)),[o,n];n++}return s&&o.push(a(s)),[o,n]}(r,n)[0];return Object.keys(i).length>300&&(i={}),i[e]=l,l}function s(e,t){var r=[];e.fwd_count?r.push({type:"mail",id:-t,object:{fwd_count:e.fwd_count}}):e.fwd&&r.push({type:"mail",id:-t,object:{fwd_count:o(e.fwd).length}});for(var a=1;e["attach"+a+"_type"];++a)"call"===e["attach"+a+"_type"]?r.push({type:e["attach"+a+"_type"],id:e["attach"+a],initiatorId:Object(n.intval)(e["attach"+a+"_call_initiator_id"]),state:e["attach"+a+"_call_state"],duration:Object(n.intval)(e["attach"+a+"_call_duration"]),receiverId:Object(n.intval)(e["attach"+a+"_call_receiver_id"])}):r.push({type:e["attach"+a+"_type"],id:e["attach"+a],kind:e["attach"+a+"_kind"],productId:e["attach"+a+"_product_id"]});return e.geo&&r.push({type:"geo",id:e.geo}),r}function c(e){return 0==e}function u(e){return e>0&&e<2e9}function l(e){return e>2e9}function d(e){return e.map((function(e){var t="audiomsg"===e[2]?"audio_message":e[2];return e[0]+":"+e[1]+":"+t})).join(",")}},tuSo:function(e,t,r){r("7DDg")("Int32",4,(function(e){return function(t,r,n){return e(this,t,r,n)}}))},uytb:function(e,t,r){"use strict";r.r(t),r.d(t,"RECENT_SEARCH_OP",(function(){return o})),r.d(t,"PIN_HIDDEN_ID_OP",(function(){return s})),r.d(t,"deleteOldStoredFormat",(function(){return d})),r.d(t,"mount",(function(){return f}));r("HEwt"),r("a1Th"),r("Btvt"),r("rGqo"),r("rE2o"),r("ioFf");var n=r("BJj/");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var o="recent_search",s="pin_hide";function c(e){return"im_store_"+e}function u(e){return ls.get(c(e))||{}}function l(e,t,r){if(ls.checkVersion()){var n=JSON.stringify(t);rand(0,1e5)<=1&&statlogsValueEvent("im_local_store_size",n.length),r(c(e),n)}}function d(e,t){for(var r=["fwd","draft","bind_attach"],n=u(e),a=!1,i=r.length;i--;)r[i]in n&&(delete n[r[i]],a=!0);a&&l(e,n,t)}function _(e,t,r){r.key===c(e)&&(t.db=JSON.parse(r.newValue),t.checkTime=Date.now())}function f(e){var t=Object(n.debounce)((e,t)=>{localStorage.setItem(e,t)},300);ls.checkVersion()&&d(e,t);var r={db:u(e),checkTime:Date.now()},i=_.bind(null,e,r);return window.addEventListener("storage",i,!1),{select:(t,n)=>(Date.now()-r.checkTime>1e3&&(r.db=u(e)),function(e,t,r){return t===o?e[t]||[]:t===s?e[t]&&e[t][r]:e[t]?extend(!0,{},e[t][r]):null}(r.db,t,n)),selectByKey:t=>(Date.now()-r.checkTime>1e3&&(r.db=u(e)),r.db[t]),update(n,i){var c=function(e,t,r){switch(e[t]||(e[t]={}),t){case o:var n=r;n&&n.length>0?e[t]=n:delete e[t];break;case s:var i=a(r,2),c=i[0],u=i[1];u?e[t][c]=+u:delete e[t][c]}return e}(r.db,n,i);return r.db=c,r.checkTime=Date.now(),l(e,c,t)},updateByKey:(n,a)=>(r.db[n]=a,r.checkTime=Date.now(),l(e,r.db,t)),unmount(){window.removeEventListener("storage",i,!1)}}}},vT4u:function(e,t,r){"use strict";r.r(t),r.d(t,"CONTROLLER",(function(){return w})),r.d(t,"ACTIVITY_PERIOD",(function(){return k})),r.d(t,"ACTIVITY_TYPE_TYPING",(function(){return N})),r.d(t,"ACTIVITY_TYPE_RECORDING_AUDIO",(function(){return I})),r.d(t,"CHAT_ACTION_SETTINGS",(function(){return P})),r.d(t,"CHAT_ACTION_BLOCK",(function(){return F})),r.d(t,"CHAT_ACTION_INVITE",(function(){return L})),r.d(t,"CHAT_ACTION_MEDIA",(function(){return x})),r.d(t,"CHAT_ACTION_SEARCH",(function(){return D})),r.d(t,"CHAT_ACTION_PIN_HIDE",(function(){return R})),r.d(t,"CHAT_ACTION_PIN_UNHIDE",(function(){return B})),r.d(t,"CHAT_ACTION_UNPIN",(function(){return H})),r.d(t,"CHAT_ACTION_MUTE",(function(){return U})),r.d(t,"CHAT_ACTION_UNMUTE",(function(){return q})),r.d(t,"CHAT_ACTION_CLEAR",(function(){return W})),r.d(t,"CHAT_ACTION_LEAVE",(function(){return G})),r.d(t,"CHAT_ACTION_RETURN",(function(){return z})),r.d(t,"CHAT_ACTION_BLOCK_COMMUNITY",(function(){return K})),r.d(t,"CHAT_ACTION_ALLOW_COMMUNITY",(function(){return V})),r.d(t,"CHAT_ACTION_BLOCK_NOTIFY",(function(){return $})),r.d(t,"CHAT_ACTION_CALL_AUDIO",(function(){return Y})),r.d(t,"CHAT_ACTION_CALL_VIDEO",(function(){return Q})),r.d(t,"ACTION_PRIORITIES",(function(){return X})),r.d(t,"loadHashes",(function(){return J})),r.d(t,"strHistory",(function(){return re})),r.d(t,"updateBlockStates",(function(){return ne})),r.d(t,"loadPeer",(function(){return ae})),r.d(t,"restoreHistoryQueue",(function(){return ie})),r.d(t,"removeFailed",(function(){return oe})),r.d(t,"removeExpiredFailed",(function(){return se})),r.d(t,"selectPeer",(function(){return ue})),r.d(t,"selectPeerOnMessage",(function(){return de})),r.d(t,"changePeer",(function(){return _e})),r.d(t,"updateMentions",(function(){return fe})),r.d(t,"setActions",(function(){return he})),r.d(t,"loadMoreHistory",(function(){return pe})),r.d(t,"loadLessHistory",(function(){return ge})),r.d(t,"readLastMessages",(function(){return be})),r.d(t,"readTillSpecificMessage",(function(){return ve})),r.d(t,"markAudioMessageAsListened",(function(){return Ce})),r.d(t,"loadLongPollKey",(function(){return ye})),r.d(t,"loadLongPollTs",(function(){return Te})),r.d(t,"setMessageErrored",(function(){return Ee})),r.d(t,"resendMessage",(function(){return Oe})),r.d(t,"loadAdmins",(function(){return ke})),r.d(t,"updateVideoThumb",(function(){return Se})),r.d(t,"editMessage",(function(){return je})),r.d(t,"addMessage",(function(){return Ae})),r.d(t,"markInboundMessagesAsRead",(function(){return Le})),r.d(t,"markOutboundMessagesAsRead",(function(){return xe})),r.d(t,"initTextStore",(function(){return De})),r.d(t,"processFwd",(function(){return Re})),r.d(t,"mergeTabs",(function(){return Be})),r.d(t,"updateOnline",(function(){return He})),r.d(t,"setActivity",(function(){return Ue})),r.d(t,"updateActivity",(function(){return qe})),r.d(t,"waitActivity",(function(){return We})),r.d(t,"sendMessage",(function(){return ze})),r.d(t,"deliverMessage",(function(){return Ke})),r.d(t,"deliverEditedMessage",(function(){return Ve})),r.d(t,"addSelection",(function(){return $e})),r.d(t,"cleanSelected",(function(){return Ye})),r.d(t,"dropSelection",(function(){return Qe})),r.d(t,"replaceMessage",(function(){return Xe})),r.d(t,"saveMedia",(function(){return Je})),r.d(t,"loadMedia",(function(){return Ze})),r.d(t,"addAttachmentsToStoreData",(function(){return et})),r.d(t,"replaceMediaAttachesStore",(function(){return tt})),r.d(t,"setCurrentSearchDate",(function(){return rt})),r.d(t,"setInplaceSearch",(function(){return nt})),r.d(t,"setCurrentSearch",(function(){return at})),r.d(t,"searchHints",(function(){return it})),r.d(t,"searchHintsIndex",(function(){return ot})),r.d(t,"localIndexToDialog",(function(){return st})),r.d(t,"searchTopConv",(function(){return ut})),r.d(t,"searchImTopConv",(function(){return lt})),r.d(t,"searchLocalHints",(function(){return dt})),r.d(t,"preloadSearchIndex",(function(){return _t})),r.d(t,"loadDialogs",(function(){return ft})),r.d(t,"searchMessages",(function(){return ht})),r.d(t,"isSearchAllLoaded",(function(){return pt})),r.d(t,"isSearchingInplace",(function(){return gt})),r.d(t,"cancelSearch",(function(){return mt})),r.d(t,"clearDate",(function(){return bt})),r.d(t,"searchInplaceStart",(function(){return vt})),r.d(t,"searchMessagesInplace",(function(){return Ct})),r.d(t,"loadImportant",(function(){return yt})),r.d(t,"loadActualLastMessage",(function(){return Tt})),r.d(t,"removeUnreadDeletedMsgsFromTab",(function(){return Et})),r.d(t,"removeMessagesMarkDeleted",(function(){return Ot})),r.d(t,"removeMessages",(function(){return wt})),r.d(t,"removeMessageSend",(function(){return kt})),r.d(t,"removeMessagesWithRestore",(function(){return Nt})),r.d(t,"restoreMessage",(function(){return It})),r.d(t,"restoreMessageSend",(function(){return St})),r.d(t,"acceptMessageRequest",(function(){return At})),r.d(t,"rejectMessageRequest",(function(){return Mt})),r.d(t,"cancelMessageRequest",(function(){return Pt})),r.d(t,"sendTyping",(function(){return Ft})),r.d(t,"sendRecordingAudio",(function(){return Lt})),r.d(t,"forwardMessages",(function(){return xt})),r.d(t,"prepareForward",(function(){return Dt})),r.d(t,"deletedDialog",(function(){return Rt})),r.d(t,"flushHistory",(function(){return Bt})),r.d(t,"updateChatTopic",(function(){return Ht})),r.d(t,"loadChatInfo",(function(){return Ut})),r.d(t,"addNewMemberOptimisticly",(function(){return qt})),r.d(t,"addNewMember",(function(){return Wt})),r.d(t,"loadChatMember",(function(){return Gt})),r.d(t,"checkNewPeople",(function(){return zt})),r.d(t,"loadNewPeople",(function(){return Kt})),r.d(t,"updateChatPhoto",(function(){return Vt})),r.d(t,"updateActions",(function(){return $t})),r.d(t,"leaveChat",(function(){return Yt})),r.d(t,"returnToChat",(function(){return Qt})),r.d(t,"toggleMutePeer",(function(){return Xt})),r.d(t,"toggleMuteMentionsPeer",(function(){return Jt})),r.d(t,"setMutedPeer",(function(){return Zt})),r.d(t,"setExecStack",(function(){return er})),r.d(t,"favMessage",(function(){return tr})),r.d(t,"updateFavMessage",(function(){return rr})),r.d(t,"updateImportant",(function(){return nr})),r.d(t,"loadSpam",(function(){return ar})),r.d(t,"flushSpam",(function(){return ir})),r.d(t,"setCreationType",(function(){return or})),r.d(t,"getOwnerPhoto",(function(){return sr})),r.d(t,"presetAvatar",(function(){return cr})),r.d(t,"setChatPhoto",(function(){return ur})),r.d(t,"createChat",(function(){return lr})),r.d(t,"createCommunityChat",(function(){return dr})),r.d(t,"resync",(function(){return _r})),r.d(t,"toggleSendingAbility",(function(){return fr})),r.d(t,"setDelayedMessage",(function(){return hr})),r.d(t,"isAnythingLoading",(function(){return pr})),r.d(t,"updateUnreadCount",(function(){return gr})),r.d(t,"changeSubmitSettings",(function(){return mr})),r.d(t,"updateFavAndTitle",(function(){return br})),r.d(t,"saveHistoryScroll",(function(){return vr})),r.d(t,"filterFromTab",(function(){return Cr})),r.d(t,"changeDialogsTab",(function(){return yr})),r.d(t,"updateFolderState",(function(){return Er})),r.d(t,"toggleDialogImportant",(function(){return Or})),r.d(t,"markDialogAnswered",(function(){return wr})),r.d(t,"getMutexQueue",(function(){return kr})),r.d(t,"releaseBlock",(function(){return Nr})),r.d(t,"toggleCommunityMute",(function(){return Ir})),r.d(t,"deleteDialog",(function(){return Sr})),r.d(t,"restoreDialog",(function(){return jr})),r.d(t,"spamDialog",(function(){return Ar})),r.d(t,"updateTabbedPeers",(function(){return Mr})),r.d(t,"isEverythingLoaded",(function(){return Pr})),r.d(t,"cleanTab",(function(){return Fr})),r.d(t,"stringifyTab",(function(){return Lr})),r.d(t,"updateGoToEndVisibility",(function(){return xr})),r.d(t,"updateGoToMentionVisibility",(function(){return Dr})),r.d(t,"toggleCommunityMessages",(function(){return Rr})),r.d(t,"updateHistory",(function(){return Br})),r.d(t,"syncHistory",(function(){return Hr})),r.d(t,"startRecording",(function(){return Ur})),r.d(t,"cancelRecording",(function(){return qr})),r.d(t,"setVoiceMessageAvail",(function(){return Wr})),r.d(t,"toggleConversation",(function(){return Gr})),r.d(t,"updateSearchQuery",(function(){return zr})),r.d(t,"initializeChatResize",(function(){return Kr})),r.d(t,"joinChat",(function(){return Vr})),r.d(t,"getInviteLink",(function(){return $r})),r.d(t,"resetInviteLink",(function(){return Yr})),r.d(t,"leaveInvitation",(function(){return Qr})),r.d(t,"saveRecentSearchPeer",(function(){return Xr})),r.d(t,"resetRecentSearch",(function(){return Jr})),r.d(t,"removeFromRecentSearch",(function(){return Zr})),r.d(t,"pinMessageOptimistic",(function(){return en})),r.d(t,"unpinMessageOptimistic",(function(){return tn})),r.d(t,"pinMessage",(function(){return rn})),r.d(t,"unpinMessage",(function(){return nn})),r.d(t,"getPinnedMessage",(function(){return an})),r.d(t,"getMessageLocalId",(function(){return on})),r.d(t,"getChatMembers",(function(){return sn})),r.d(t,"getChatDetails",(function(){return cn})),r.d(t,"updateFlags",(function(){return un})),r.d(t,"removeChatPhoto",(function(){return ln})),r.d(t,"kickUserOptimisticly",(function(){return dn})),r.d(t,"kickUser",(function(){return _n})),r.d(t,"toggleAdminOptimisticly",(function(){return fn})),r.d(t,"toggleAdmin",(function(){return hn})),r.d(t,"checkChatMember",(function(){return pn})),r.d(t,"hidePromoTooltip",(function(){return gn})),r.d(t,"videoAutoPlayHandler",(function(){return mn})),r.d(t,"hideTopBannerAction",(function(){return bn})),r.d(t,"callbackTopBannerAction",(function(){return vn})),r.d(t,"loadBanner",(function(){return Cn})),r.d(t,"setKeyboard",(function(){return yn})),r.d(t,"deleteKeyboard",(function(){return Tn})),r.d(t,"toggleKeyboard",(function(){return En})),r.d(t,"loadKeyboard",(function(){return On})),r.d(t,"changeCommunityAccess",(function(){return wn})),r.d(t,"deleteTemplate",(function(){return kn})),r.d(t,"createTemplate",(function(){return Nn})),r.d(t,"updateTemplate",(function(){return In})),r.d(t,"resetTabAll",(function(){return Sn})),r.d(t,"updateMessageRequestsCounter",(function(){return jn})),r.d(t,"updateCasperMessageExpiringStatus",(function(){return An})),r.d(t,"prepareCasperMessagesFromMessages",(function(){return Mn})),r.d(t,"peerProfileToggleTag",(function(){return Pn})),r.d(t,"peerProfileManageTags",(function(){return Fn}));r("HEwt"),r("rE2o"),r("ioFf"),r("hhXQ"),r("a1Th"),r("OG14"),r("OEbY"),r("Vd3H"),r("91GP"),r("SRfc"),r("rGqo"),r("VRzm"),r("Btvt");var n=r("BxOC"),a=r("bIHZ"),i=r("f01n"),o=r("DM26"),s=r("rudk"),c=r("aong"),u=r("uytb"),l=r("P13b"),d=r("h++7"),_=r("rHUl"),f=r("MhhX"),h=r("86+7"),p=r("ERyv"),g=r("Wu9C"),m=r("lJdi"),b=r("O8ze"),v=r("zxIV"),C=r("XzvV"),y=r("ambf");function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var w="al_im.php",k=5,N="typing",I="audiomessage",S=Object(a.updateLazyLocation)(),j=S.scheduleNav,A=S.commitNav,M=S.scheduleNavWithTimeOut;var P="settings",F="block",L="invite",x="media",D="search",R="pin_hide",B="pin_unhide",H="unpin",U="mute",q="unmute",W="clear",G="leave",z="return",K="block_community",V="allow_community",$="block_notify",Y="call_audio",Q="call_video",X={[P]:0,[F]:1,[L]:2,[x]:3,[D]:6,[R]:7,[B]:7,[H]:8,[U]:10,[q]:10,[W]:11,[G]:12,[z]:12,[K]:12,[V]:12,[$]:12};function J(e,t,r){return Object(n.post)(w,{act:"a_renew_hash",peers:e.join(","),gid:t.hidegid?void 0:r.gid})}function Z(e,t,r){return function(e){return e.resync_in_process?e.resync_in_process:Promise.resolve(!1)}(e).then(n=>n?t(...r):function(e){if(!e.renew_hashes){var t=e.last_hashes_update||0;if(Date.now()-t<1e4)return Promise.resolve();var r=Object.keys(e.tabs).filter(t=>Object(l.isFullyLoadedTab)(e,t));e.renew_hashes=J(r,{},e).then(t=>{var n=E(t,3),a=n[0],i=n[1],o=n[2];return r.forEach(t=>{e.tabs[t].hash=a[t]}),e.writeHash=i,e.manageTagsHash=o,delete e.renew_hashes,e.last_hashes_update=Date.now(),e})}return e.renew_hashes}(e).then(e=>t(...r)))}function ee(e){return function(){var t=arguments,r=t[t.length-1];return e(...t).catch(n=>{if(n&&n.match&&n.match(/1001;/))return Z(r,e,t);throw n})}}function te(e){return"string"==typeof e?Object(v.se)(`<div>${e}</div>`):e}function re(e){return"string"==typeof e?e:e.innerHTML}function ne(e,t){return t.block_states=extend(t.block_states,e),Promise.resolve(t)}function ae(e,t,r,a,i){return i.tabHistoryNotChanged=!1,Object(o.retryFn)(n.post,3,e=>e-1)(w,{act:"a_start",peer:e,msgid:r,history:t,prevpeer:i.prevPeer,gid:i.gid,block:a}).then(t=>{var n=E(t,6),a=n[0],o=n[1],s=n[2],c=n[3],u=n[4],_=n[5];if(o.forEach(e=>Object(h.oCacheAdd)(i,e)),i.tabs||(i.tabs={}),i.dialog_tab_cts=Object.assign({},u,{[d.FOLDER_MESSAGE_REQUEST]:i.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),i.tabs[e]||(i.tabs[e]=Object(l.normalizeTab)(i,a)),ne(c,i),r){if(i.tabs[e]){var f=i.tabs[e].lastmsg,p=i.tabs[e].lastmsg_meta;extend(i.tabs[e],a),i.tabs[e].lastmsg=f,i.tabs[e].lastmsg_meta=p}}else extend(i.tabs[e],a);return i.admins=extend(i.admins,s),i.imQueue(e,!1),mn(),_&&(i.tabs[e].peer_profile_info=_),ie(e,i)}).catch(e=>Object(p.imWeirdCatch)("loadPeer",e))}function ie(e,t){var r=t.imQueue(e,!1),n=t.tabs[e],a=r.filter(r=>!Object(_.isRidExist)(t,e,r.rid));return n.msgs=a.reduce((e,t)=>(e["rid"+t.rid]=t.mess,e),n.msgs),t.imQueueSet(e,a),t.tabs[e].history=Object(l.restoreQueue)(a,t,te(t.tabs[e].history)),Promise.resolve(t)}function oe(e,t,r,n){var a=n.imQueue(t),i=[],o=[];return a.forEach(e=>{e.failed&&r&&e.mess.messageId!==r&&o.push(e),!e.failed||r&&e.mess.messageId!==r||i.push("rid"+e.rid)}),n.imQueueSet(t,o),n.tabs[t].history=Object(l.removeMessages)(i,te(n.tabs[t].history)),Object(l.removeMessages)(i,e),Promise.resolve(n)}function se(e,t,r){var n=r.imQueue(t),a=[],i=[],o=Date.now();return n.forEach(e=>{e.failed&&o-e.ts<864e5&&i.push(e),e.failed&&o-e.ts>=864e5&&a.push("rid"+e.rid)}),r.imQueueSet(t,i),r.tabs[t].history=Object(l.removeMessages)(a,te(r.tabs[t].history)),Object(l.removeMessages)(a,e),Promise.resolve(r)}function ce(e,t){return!1===(t.block_states[e]||{}).free?Promise.resolve(t):Object(n.post)(w,{act:"a_block",peer:e,prevPeer:t.prevPeer,gid:t.gid}).then(e=>ne(E(e,1)[0],t))}function ue(e,t){var r=t.peer;return Promise.resolve(t).then(t=>(t.tabHistoryNotChanged=!1,Object(l.isFullyLoadedTab)(t,r)&&!t.tabs[r].msgid?(t.gid&&ce(r,t),Promise.resolve(t).then(he)):(Object(l.isFullyLoadedTab)(t,r)&&(t.tabs[r].msgid=!1),ae(r,e,!1,!0,t)))).then(he).then(le.bind(null,r))}function le(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(l.isTabLoaded)(t,e)&&(t.tabs[e].last_touched=Date.now()),Object(l.isTabLoaded)(t,e)&&r&&(t.tabs[e].last_visited=Date.now()),t}function de(e,t,r){var n=r.msgid,a=r.peer;return!e&&Object(l.isFullyLoadedTab)(r,a)&&r.tabs[a].msgs[n]?(t===r.peer?r.tabHistoryNotChanged=!0:r.tabHistoryNotChanged=!1,r.gid&&ce(a,r),Promise.resolve(r).then(he).then(le.bind(null,a))):ae(a,!0,n,!0,r).then(he).then(()=>(Object(_.getTab)(r,a).msgid=n,r)).then(le.bind(null,a))}function _e(e,t,r,n){if(pr(n))throw Object(l.showWaitUntilUploadedBox)(),new Error("Cant change peer while loading something");var a=n.gid?"gim"+n.gid:"im";if(n.prevPeer=n.peer,n.peer=e,n.msgid=t||"",n.currentEntryPoint=r,cur.peer=e,j({sel:e?Object(l.convertPeerToUrl)(e):null,msgid:n.msgid,email:"",0:a}),0!=n.prevPeer&&le(n.prevPeer,n,!0),0!==e){Object(l.isTabLoaded)(n,e)&&le(e,n,!0),Mr(n.tabbedPeers.map(e=>e.peer).indexOf(e)<0?[{peer:e,type:"perm"}].concat(n.tabbedPeers):n.tabbedPeers.map(t=>(t.peer==e&&"perm"!==t.type&&(t.type="perm"),t)),!1,n)}else Mr(n.tabbedPeers,!1,n);return A(),mt(n.prevPeer,n)}function fe(e){var t=e.isMassMentionsMessageAllowed;cur.wallMentions=()=>new Promise((r,n)=>{if(cur.wallMentions=[],!Object(l.isChatPeer)(e.peer)||!Object(l.isFullyLoadedTab)(e,e.peer)||Object(l.isFvkcomgroup)(e,e.peer))return n();var a=e.tabs[e.peer];function i(){var n=[];Object.keys(a.msgs||{}).reverse().forEach(e=>{var t=Object(_.parserMessage)(a.msgs[e]),r=t&&t.userId;r&&r!=vk.id&&-1===n.indexOf(r)&&Object(l.isUserAliveInChat)(a,r)&&n.push(r)}),(a.memberIds||[]).forEach(e=>{-1===n.indexOf(e)&&n.push(e)});var i=[];n.forEach(t=>{if(Object(h.oCacheExists)(e,t)){var r=Object(h.oCacheGet)(e,t),n=r.link.substring(1);i.push([r.id,r.name,"@"+n,r.photo,void 0,void 0,void 0,n,r.first_name,""])}});var o=getLang("mail_im_mention_all"),s=getLang("mail_im_mention_online");t&&i&&i.length>1&&i.push(["online",s,"@online","/images/mention_online.svg",void 0,void 0,void 0,"online","online","here"],["all",o,"@all","/images/mention_all.svg",void 0,void 0,void 0,"all","all","everyone"]),r(i)}a.membersLoaded?i():sn(e.peer,e).then(i)})}function he(e){var t=e.peer;if(0===t)return Promise.resolve(e);var r=e.tabs[t],n=Object(l.isChatPeer)(t),a=Object(_.isChannelPeer)(r),i=Object(_.isCommunityChat)(e,t),o=n&&!Object(_.isChatActive)(r),s=!!r.offset,c=[];s&&c.push(x),s&&c.push(D),!Object(l.isEmailPeer)(t)&&!s||a||c.push(W),!Object(l.isCommunityInterface)(e)||a||i||c.push(F),a&&!o&&c.push(P),Object(l.isCommunityPeer)(t)&&(r.can_send_notify?c.push($):c.push(r.blocked_community?V:K)),!Object(l.isCommunityInterface)(e)&&(n||Object(l.isUserPeer)(t)||Object(l.isCommunityPeer)(t))&&(!n||!o)&&c.push(inArray(t,e.mutedPeers)?q:U);var u=!Object(l.isCommunityInterface)(e)&&Object(l.isUserPeer)(t)&&r.is_friend&&!r.block_error,d=n&&!o&&Object(m.canInviteUser)(e);(u||d)&&c.push(L),!n||o||Object(l.isCommunityInterface)(e)||c.push(G),n&&r.data.closed&&!r.data.kicked&&c.push(z),n&&r.pinned&&(c.push(Object(g.isPinnedMessageVisibleInTab)(e,t)?R:B),Object(m.canPinOrUnpin)(e)&&c.push(H));var f=Object(l.chatActions)(e,a);return e.curActions=c.sort((e,t)=>X[e]-X[t]).reduce((e,t)=>(e[t]=f[t],e),{}),Promise.resolve(e)}function pe(e,t,r){var a=r.tabs[r.peer];return Object(n.post)(w,{peer:r.peer,whole:e,act:"a_history",offset:a.offset+(a.skipped||0),toend:t,gid:r.gid}).then(e=>{var t=E(e,4),n=t[0],i=t[1],o=t[2],s=t[3];return a.allShown=o,r.admins=extend(r.admins,s),a.history=n+re(a.history),a.historyToAppend=n,a.offset+=Object.keys(i).length,a.msgs=extend(a.msgs,i),r})}function ge(e){var t=e.tabs[e.peer];return Object(n.post)(w,{peer:e.peer,act:"a_history",rev:1,offset:t.skipped,gid:e.gid}).then(r=>{var n=E(r,5),a=n[0],i=n[1],o=n[2];n[3],n[4];t.allShown=t.allShown||o,t.history=re(t.history)+a,t.historyToAppend=a;var s=Object.keys(i).length;return t.skipped-=s,t.offset+=s,t.msgs=extend(t.msgs,i),e})}function me(e,t,r,n){var a=e.tabs[t];return n===i.FLAG_OUTBOUND&&a.out_up_to>r||(n===i.FLAG_OUTBOUND?a.out_up_to=r:a.in_up_to=r),e}var be=ee((function(e,t){if(Object(l.tabIsMessageRequest)(t.tabs[e]))return Promise.resolve(t);var r=t.tabs[e],a=r.msgs||{},o=Object.keys(a).map(r=>Object(_.getMessage)(t,e,r)).filter(e=>!Object(f.isOut)(e)).map(e=>e.messageId).sort((e,t)=>t-e);return r.skipped>0&&(o=o.filter(e=>intval(e)<=r.lastmsg-r.skipped)),(o=intval(o.shift()))<=r.in_up_to?Promise.resolve(t):(t.longpoll.push([i.readInboundEvent([6,e,o,null])]),Object(n.post)(w,{peer:e,ids:[o],hash:r.hash,act:"a_mark_read",gid:t.gid}).then(()=>me(t,e,o,i.FLAG_OUTBOUND)).catch(()=>t))})),ve=ee((function(e,t,r){if(Object(l.tabIsMessageRequest)(r.tabs[t]))return Promise.resolve(r);var a=r.tabs[t];return e<=a.in_up_to?Promise.resolve(r):(r.longpoll.push([i.readInboundEvent([6,t,e,null])]),Object(n.post)(w,{peer:t,ids:[e],hash:a.hash,act:"a_mark_read",gid:r.gid}).then(()=>me(r,t,e,i.FLAG_OUTBOUND)))})),Ce=ee((function(e,t,r){var a=r.tabs[e];return Object(n.post)(w,{peer:e,id:t,hash:a.hash,act:"a_mark_listened",gid:r.gid})}));function ye(e){return Object(n.post)(w,{act:"a_get_key",uid:e.id,gid:e.gid}).then(t=>{var r=E(t,3),n=r[0],a=r[1],i=r[2];return extend({},e,{imKey:n,imUrl:a,imPart:i})})}function Te(e){return Object(n.post)(w,{act:"a_get_ts",gid:e.gid}).then(t=>{var r=E(t,1)[0];return extend({},e,{imTs:r})})}function Ee(e,t,r){var n=r.tabs[e];return n.msgs[t.messageId]&&(n.msgs[t.messageId].errored=1,n.history=Object(l.setMessageError)(e,t,te(n.history))),Promise.resolve(r)}function Oe(e,t,r,n){var a=n.tabs[e];return a.msgs[t]&&(a.msgs[t].errored=0,a.lastmsg_meta=r,a.lastmsg=t,a.history=Object(l.startResendMessage)(e,t,te(a.history))),Promise.resolve(n)}function we(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];t.deletedDialog||(e.dialog_tabs=Object.keys(e.dialog_tabs).reduce((e,i)=>(!r&&!Cr(i)(t)||a&&!a(i,e[i],t)||(e[i]=Object(c.arrayUnique)(n(e[i],i))),e),e.dialog_tabs))}function ke(e,t){return 0===e.length?Promise.resolve(t):Object(n.post)(w,{act:"a_get_admin",admins:e.join(","),gid:t.gid}).then(e=>{var r=E(e,1)[0];return t.admins=extend(t.admins,r),t})}function Ne(e,t){if(!inArray(e,t.tabbedPeers.map(e=>e.peer))&&(0!==t.peer||t.searchText)&&!inArray(e,t.mutedPeers)){var r={peer:e,type:"temp"};Mr(t.tabbedPeers.concat([r]),!1,t)}}function Ie(e,t,r){return Object(l.isReversedDialogs)(r)?t.concat([e]):[e].concat(t)}function Se(e,t){var r=e.get().peer,n=Object(_.getTab)(e,r);if(Object(l.isFullyLoadedTab)(e,r)){var a=te(n.history);n.history=Object(l.updateMessageInCache)(e,a,t)}}function je(e,t){var r=Object(_.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var n=te(r.history);r.msgs[e.messageId]=extend(!0,{},e),r.history=Object(l.editAndReplaceMessage)(t,e,n)}r&&r.lastmsg===e.messageId&&(r.lastmsg_meta=e);var a=r&&r.pinned&&Object(_.parserMessage)(r.pinned);a&&a.messageId===e.messageId&&(r.pinned=e);var i=!Object(f.isOut)(e)&&Object(f.isUnread)(r,e),o=r.mentions&&r.mentions.includes(e.messageId),s=i&&Object(f.hasUserMentions)(e,t.id)&&!o,c=i&&!Object(f.hasUserMentions)(e,t.id)&&o;return s?(r.mentions||(r.mentions=[]),r.mentions.push(e.messageId)):c&&Fe(e.peerId,t=>t!==e.messageId,t),Promise.resolve(t)}function Ae(e,t){var r=e.flags&i.FLAG_OUTBOUND,n=e.peerId;if(Object(l.isTabLoaded)(t,n)){var a=t.tabs[n];if(a.deletedDialog=!1,!t.msg_local_ids_sort&&e.local?t.msg_local_ids_sort={[e.messageId]:0}:e.local&&(t.msg_local_ids_sort[e.messageId]=Object.keys(t.msg_local_ids_sort).length),r||Object(l.tabIsMessageRequest)(a)?a.unread=0:(a.lastmsg===e.messageId&&a.unread?Me(t,1,e.peerId):(!a.unread&&Me(t,1,e.peerId),a.unread++),y.casperMessagesStore.has(e.messageId)&&!Object(_.isCasperChatTab)(a)&&(a.expiring_messages||(a.expiring_messages=[]),a.expiring_messages.push(e.messageId)),Object(f.hasUserMentions)(e,t.id)&&(a.mentions||(a.mentions=[]),a.mentions.push(e.messageId)),Ne(e.peerId,t)),Object(l.isFullyLoadedTab)(t,n)){var o=Object(f.isMessageToBlockedCommunity)(a,e),s=o||0===a.offset;o&&(a.blocked_community=0),a.skipped>0&&a.skipped++,a.offset++,a.msgs[e.messageId]=extend(!0,{},e);var c=te(a.history);a.history=Object(l.appendToHistory)(t,e,c,!0,!0,!0),s&&he(t)}if(a.typing){var u=a.typing.userIds.indexOf(e.userId);u>=0&&a.typing.userIds.splice(u,1)}return a.lastmsg=e.messageId,a.lastmsg_meta=e,Number.isInteger(e.messageId)&&e.messageId>(a.minor_sort_id||0)&&(a.minor_sort_id=e.messageId),le(e.peerId,t),we(t,a,!1,Ie.bind(null,n),Tr.bind(null,t)),Promise.resolve(t)}return ae(n,0,0,0,t).then(t=>(we(t,t.tabs[n],!1,Ie.bind(null,n),Tr.bind(null,t)),le(e.peerId,t),r||Ne(e.peerId,t),t))}function Me(e,t,r){e.cur_unread_cnt||(e.cur_unread_cnt={}),-1===t&&delete e.cur_unread_cnt[r],e.unread_cnt+=t}function Pe(e,t,r){var n=r.tabs[e];return n.expiring_messages&&(n.expiring_messages=n.expiring_messages.filter(t),n.expiring_messages.length||delete n.expiring_messages),r}function Fe(e,t,r){var n=r.tabs[e];return n.mentions&&(n.mentions=n.mentions.filter(t),n.mentions.length||delete n.mentions),r}function Le(e,t){var r=Object(_.getTab)(t,e.peerId);if(Object(l.isFullyLoadedTab)(t,e.peerId)){var n=r.unread;if(t=me(t,e.peerId,e.upToId,0),null!==e.unread?r.unread=e.unread:r.unread=e.upToId>=r.lastmsg?0:Object(_.countUnread)(e.peerId,t)+(r.unread>0?+r.skipped:0),n>0&&!r.unread&&Me(t,-1,e.peerId),!r.skipped){var a=te(r.history);r.history=Object(l.removewNewUnreadBarAndMerge)(t,a,e.peerId)}}else Object(l.isTabLoaded)(t,e.peerId)&&(t.tabs[e.peerId].unread>0&&Me(t,-1,e.peerId),t.tabs[e.peerId].unread=0,t.tabs[e.peerId].in_up_to=e.upToId);return Object(l.isTabLoaded)(t,e.peerId)&&e.upToId>=r.lastmsg&&(t.dialog_tabs[d.FOLDER_UNREAD]=t.dialog_tabs[d.FOLDER_UNREAD].filter(t=>intval(t)!==e.peerId)),Object(l.isTabLoaded)(t,e.peerId)&&(Pe(e.peerId,t=>t>e.upToId,t),Fe(e.peerId,t=>t>e.upToId,t)),0!==t.unread_cnt||t.active_tab!==d.FOLDER_UNREAD||t.gid?Promise.resolve(t):yr(d.FOLDER_ALL,t)}function xe(e,t){var r=t.tabs[e.peerId];if(Object(l.isTabLoaded)(t,e.peerId)&&me(t,e.peerId,e.upToId,i.FLAG_OUTBOUND),Object(l.isFullyLoadedTab)(t,e.peerId)){var n=te(r.history);r.history=Object(l.markMessagesAsRead)(t,e.peerId,n)}return Promise.resolve(t)}function De(e,t,r,n,a){return a.text={},a.imQueue=e,a.imQueueResend=t,a.imQueueSet=r,a.imQueueComplete=n,Promise.resolve(a)}function Re(e,t,r){function n(e,t){return{id:e.messageId,text:e.text,date:e.date,kludges:e.kludges,authorName:t}}if(1===e.length){var a=e[0],i=Object(_.getMessage)(r,t,a),o=Object(_.getAuthorFullName)(r,t,a);return!1===o?r.set(Gt.bind(null,{[t]:[i.userId]})).then(r=>{var o=Object(_.getAuthorFullName)(r,t,a);return{msgIds:e,object:n(i,o)}}):Promise.resolve({msgIds:e,object:n(i,o)})}return Promise.resolve({msgIds:e})}function Be(e,t){Object(l.normalizeTabsGotFromServer)(t,e);var r=t.tabs[t.peer];return t.tabs=Object.keys(e).reduce((r,n)=>{var a=t.tabs[n]?t.tabs[n].msgs:{},i=extend({},a||{},e[n].msgs||{});return r[n]=extend(t.tabs[n]||{},e[n]),i&&(r[n].msgs=i),e[n].lastmsg||(r[n].lastmsg=!1),r},t.tabs),r&&(t.tabs[t.peer]=r),Promise.resolve(t)}function He(e,t,r,n){var a=Object(_.getTab)(n,e);if(a&&a.last_seen&&a.last_seen.can_see){var i=!1!==t?mobPlatforms[t]?1:0:a.last_seen.mobile;a.online=t,a.last_seen={platform:t,time:r||a.last_seen.time,mobile:i,can_see:a.last_seen.can_see}}return Promise.resolve(n)}function Ue(e,t,r){var n=Object(_.getTab)(r,e.peerId);return n&&(e.ts=Date.now()/1e3,n.activity||(n.activity={}),n.activity[t]=e,n.typing===N&&(n.typing=e)),Promise.resolve(r)}function qe(e,t){var r=Object(_.getTab)(t,e.peerId),n=Object(f.isAudioMsg)(e)?"audiomessage":"typing";return r&&r.activity&&r.activity[n]&&(r.activity[n].userIds=r.activity[n].userIds.filter(t=>t!==e.userId)),Promise.resolve(t)}function We(e,t,r){var n=e.peerId;return Object(o.pause)(k+2).then(()=>{if(Object(l.isTabLoaded)(r,n)){var e=r.tabs[n];if((e.activity||{})[t])Date.now()-1e3*e.activity[t].ts>=1e3*k&&(delete e.activity[t],0===Object.keys(e.activity)&&delete e.activity);if(e.typing)Date.now()-1e3*e.typing.ts>=1e3*k&&(e.typing=void 0)}return r})}function Ge(e){var t={},r=e.find(e=>"poll"===e[0]);if(r){var n=E(r,3)[2];Object.assign(t,n)}return t}var ze=function(e,t,r,a){var i=Date.now()+rand(0,100).toFixed(0),o=a.ref_id,c=a.ref_source;a.ref_source=void 0,a.ref_id=void 0,(c||o)&&(j({ref_source:null,ref:null}),A()),Object(b.statlogsSendingQueueLength)(a);var u=t.attaches.length>0,l=Object(b.statlogsSendingTime)(a,"send","server",u),d=Object.assign({act:"a_send",to:e,hash:r.hash,ref_source:c,ref:o,msg:t.message,payload:t.payload,media:Object(s.convertAttachesToPhpMedia)(t.attaches),guid:i,share_url:t.share_url,cancelled_shares:t.cancelled_shares,random_id:t.rid,gid:r.hidegid?void 0:a.gid,entrypoint:a.currentEntryPoint||"",sticker_referrer:t.sticker_referrer},r.external,Ge(t.attaches));return Object(n.post)(w,d,2e4).then(e=>{var t=E(e,1)[0];return l(),a.version!==t.version&&nav.reload({force:!0}),a.currentEntryPoint="",a}).catch(e=>{throw Object(b.statlogsSendingError)(a,e,"send","server_send"),e})},Ke=ee((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,a=n.tabs[e];return ze(e,t,T({hash:a.hash},r),n)})),Ve=ee((function(e,t,r){var a=t.attaches.length>0,i=Object(b.statlogsSendingTime)(r,"edit","server",a);return Object(n.post)(w,Object.assign({act:"a_edit_message",hash:e.hash,id:t.messageId,peerId:e.peerId,gid:r.gid,msg:t.origText,media:Object(s.convertAttachesToPhpMedia)(t.attaches),share_url:t.share_url,cancelled_shares:t.cancelled_shares},Ge(t.attaches)),2e4).then(e=>{E(e,1)[0];return i(),r}).catch(e=>{throw Object(b.statlogsSendingError)(r,e,"edit","server_send"),e})}));function $e(e,t){if(t.selectedMessages||(t.selectedMessages=[]),1===e.length&&inArray(e[0],t.selectedMessages))t.selectedMessages=t.selectedMessages.filter(t=>t!==e[0]);else{var r=t.selectedMessages.concat(e);t.selectedMessages=Object(c.arrayUnique)(r).sort((e,t)=>e-t)}return Promise.resolve(t)}function Ye(e){return e.selectedMessages=[],Promise.resolve(e)}function Qe(e){return e.selectedMessages=[],Promise.resolve(e)}function Xe(e,t){if(Object(l.isFullyLoadedTab)(t,e.peerId)){var r=t.tabs[e.peerId],n=t.imQueue(e.peerId).filter(t=>t.failed&&t.rid!==e.randomId);t.imQueueSet(e.peerId,n),t.imQueueComplete(e.peerId,e.randomId),r.lastmsg_meta=e,r.lastmsg=e.messageId,Number.isInteger(e.messageId)&&e.messageId>r.minor_sort_id&&(r.minor_sort_id=e.messageId),r.msgs["rid"+e.randomId]&&(r.msgs[e.messageId]=e,delete r.msgs["rid"+e.randomId]),r.history=Object(l.replaceMessageAttrs)(t,te(r.history),e)}return Promise.resolve(t)}function Je(e,t){return Promise.resolve()}function Ze(e,t){var r=Object(b.statlogsSendingTime)(t,"unknown","attach"),a={act:"a_get_media",id:e.messageId,gid:t.gid};return Object(o.retryFn)(n.post,3,e=>e*e)(w,a).then(n=>(r(),et(e,n,t))).catch(r=>(Object(b.statlogsSendingError)(t,r,"unknown","server_load_attach"),et(e,null,t)))}function et(e,t,r){var n=r.tabs[e.peerId],a=t[2];return n.mediacontent||(n.mediacontent={}),n.mediacontent[e.messageId]=t||[getTemplate("im_retry_link")],a&&(a.no_forward&&(n.msgs[e.messageId].kludges.no_forward=!0),a.no_pin&&(n.msgs[e.messageId].kludges.no_pin=!0)),tt(e,r)}function tt(e,t){var r=t.tabs[e.peerId];return r.history=Object(l.replaceAttaches)(te(r.history),e,t),Promise.resolve(t)}function rt(e,t,r){var n=Object(l.dayFromVal)(t),a=r.tabs[e];return a.searchDay=n,a.searchOffset=0,a.searchAllLoaded=!1,a.searchMsgs=[],Promise.resolve(r)}function nt(e,t,r){return r.tabs[t].searchText=e,vt(t,r),r}function at(e,t,r){if(t){var n=r.tabs[t];n.searchText=e,n.searchOffset=0,n.searchAllLoaded=!1}else r.searchText=e,r.searchOffset=0,r.searchAllLoaded=!1;return Promise.resolve(r)}function it(e,t,r,a,i){var o=+new Date;return Object(n.post)(w,{act:"a_hints",str:e,gid:a.hidegid?0:i.gid,query:r,peerIds:t.join(",")}).then(t=>{var r=E(t,3),n=r[0],a=r[1];return ne(r[2],i),a.forEach(e=>Object(h.oCacheAdd)(i,e)),Be(n,i),Object(C.saveSearchAttemptStats)(C.serviceMessages,o,n&&n.length,e),Object.keys(n).sort((e,t)=>n[e].order-n[t].order).map(e=>n[e])})}function ot(e,t,r,n){return it(e,t,r,{},n).then(e=>e.map(e=>({peerId:e.peerId,name:e.tab,photo:e.photo,online:e.online,is_friend:"friends"===r})))}function st(e){var t={peerId:e[0],name:e[1],tab:e[1],photo:e[2],href:e[3],online:e[4],is_friend:e[5],local_index:!0};return e[6]&&(t.data={flags:e[6]}),t}function ct(e){return(t,r)=>e(r).then(e=>{var n=(t?e.search(t):e.list).map(st);return r.mapped_index||(r.mapped_index={}),n.forEach(e=>{r.mapped_index[e.peerId]=e}),n})}var ut=ct(e=>e.topConvTree),lt=ct(e=>e.imTopConvTree),dt=ct(e=>e.hintsTree);function _t(e,t){var r,a,i;t.topConvTree=new Promise(e=>{r=e}),t.hintsTree=new Promise(e=>{a=e}),t.imTopConvTree=new Promise(e=>{i=e});var s=e.select(u.RECENT_SEARCH_OP);return Object(o.retryFn)(n.post,1,()=>4)(w,{act:"a_dialogs_preload",rs:s.join(","),gid:t.gid}).catch(e=>[[],[],[]]).then(e=>{var n=E(e,4),o=n[0],s=n[1],c=n[2],u=n[3];return t.popular_sugg=c,new vkIndexer(o,e=>e[1],r),new vkIndexer(s,e=>e[1],a),u&&u.length>0?new vkIndexer(u,e=>e[1],i):i(),t})}function ft(e){var t,r,a=e.active_tab,i=e.dialog_tabs[a];return i.length>0?i.forEach(n=>{var a=e.tabs[n],i=a.minor_sort_id,o=a.major_sort_id;void 0===t||t>o?(t=o,r=i):t===o&&r>i&&(r=i)}):(t=0,r=0),Object(n.post)(w,{act:"a_get_dialogs",start_message_id:r,major_sort_id:t,tab:a,gid:e.gid}).then(t=>{var r=E(t,4),n=r[0],o=r[1],s=r[2],c=r[3];return s.forEach(t=>Object(h.oCacheAdd)(e,t)),ne(c,e),Be(o,e),e.dialog_tabs[a]=i.concat(Object.keys(o).map(intval)),e.dialog_tabs_all[a]=!n.has_more,Promise.resolve(e)})}var ht=ee((function(e,t){return Object(n.post)(w,{act:"a_search",q:e,from:"all",gid:t.gid,hash:t.writeHash,offset:t.searchOffset||0}).then(r=>{var n=E(r,5),a=n[0],i=n[1],o=n[2],s=n[3],c=n[4];return i.forEach(e=>Object(h.oCacheAdd)(t,e)),Object(l.normalizeTabsGotFromServer)(t,a),e===t.searchText&&(t.searchOffset=s,t.searchAllLoaded=c),Object.keys(a).filter(e=>!t.tabs[e]).forEach(e=>{t.tabs[e]=a[e]}),[a,o]})}));function pt(e,t){return t.tabs[e].searchAllLoaded}function gt(e,t){return!(t.peer!==e||!Object(l.isFullyLoadedTab)(t,e))&&t.tabs[e].inplaceSearch}function mt(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var r=t.tabs[e];delete r.inplaceSearch,delete r.searchOffset,delete r.searchAllLoaded,delete r.searchText,delete r.searchDay,delete r.searchMsgs,j({st:""}),A()}return Promise.resolve(t)}function bt(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var r=t.tabs[e];delete r.searchDay,r.searchOffset=0,r.searchAllLoaded=!1,r.searchMsgs=[]}return Promise.resolve(t)}function vt(e,t){return t.tabs[e].inplaceSearch=!0,Promise.resolve(t)}var Ct=ee((function(e,t){var r=t.tabs[e],a="";if(vt(e,t),r.searchDay&&(a="day:"+r.searchDay),!a&&!r.searchText)return Promise.reject();var i=`in:${e} ${a} ${r.searchText||""}`;return j({st:r.searchText}),A(),Object(n.post)(w,{act:"a_search",q:i,from:"in",gid:t.gid,hash:t.writeHash,offset:r.searchOffset||0}).then(e=>{var t=E(e,4),n=t[0],a=t[1],i=t[2],o=t[3];return r.searchOffset=a,r.searchAllLoaded=i,r.searchMsgs=(r.searchMsgs||[]).concat(o),n})}));function yt(e){return Object(n.post)(w,{act:"a_important",offset:e,part:e>0})}function Tt(e,t){var r=Object(_.getTab)(e,t);return Object(n.post)(w,{act:"a_load_lastmsg",peerId:t,gid:e.get().gid}).then(n=>{var a=E(n,4),i=a[0],o=a[1],s=a[2],c=a[3],u=intval(i[0]);r.lastmsg=u||!1,r.lastmsg_meta=i,(!Object(_.isCasperChat)(e,t)||u>r.minor_sort_id)&&(r.minor_sort_id=u);var l=E(o,3);r.unread=l[0],r.in_up_to=l[1],r.out_up_to=l[2],s?r.mentions=s:r.mentions&&delete r.mentions,c?r.expiring_messages=c:r.expiring_messages&&delete r.expiring_messages,r.unread||(e.get().dialog_tabs[d.FOLDER_UNREAD]=e.get().dialog_tabs[d.FOLDER_UNREAD].filter(e=>e!=t)),we(e.get(),r,!1,Ie.bind(null,t),Tr.bind(null,e.get()))})}function Et(e,t,r){r.tabs[e].unread-=t.length;var n=t.reduce((e,t)=>(e[t]=!0,e),{});return Pe(e,e=>!n[e],r),Fe(e,e=>!n[e],r),Promise.resolve(r)}function Ot(e,t,r){if(Object(l.isFullyLoadedTab)(r,t)){var n=r.tabs[t];n.deleted=n.deleted?n.deleted.concat(e):e}return Promise.resolve(r)}function wt(e,t,r){if(Object(l.isFullyLoadedTab)(r,t)){var n=r.tabs[t];if(n.history=Object(l.removeMessages)(e,te(n.history)),n.offset-=e.filter(e=>n.msgs[e]).length,e.forEach(e=>delete n.msgs[e]),e.forEach(e=>{var t=(r.selectedMessages||[]).indexOf(e);-1!=t&&r.selectedMessages.splice(t,1)}),n.inplaceSearch){var a=e.reduce((e,t)=>(e[t]=!0,e),{});n.searchMsgs=n.searchMsgs.filter(e=>!a[e]),n.searchOffset=n.searchMsgs.length}}return Promise.resolve(r)}var kt=ee((function(e,t,r,a,i){return Object(n.post)(w,{act:"a_mark",peer:t,hash:r||i.tabs[t].hash,gid:i.gid,msgs_ids:e.join(","),mark:a})}));function Nt(e,t,r,n){if(Object(l.isFullyLoadedTab)(n,t)){var a=n.tabs[t];a.deleted=a.deleted?a.deleted.concat(e):e,a.history=Object(l.removeMessagesWithRestore)(e,t,r,te(a.history)),a.offset-=e.filter(e=>a.msgs[e]).length}return Promise.resolve(n)}function It(e,t,r){if(Object(l.isFullyLoadedTab)(r,t)){var n=r.tabs[t];n.deleted&&(n.deleted=n.deleted.filter(t=>t!==e)),n.history=Object(l.restoreMessage)(e,t,te(n.history)),n.offset++}return Promise.resolve(r)}function St(e,t,r,a){return Object(n.post)(w,{act:"a_restore",id:e,peer:t,hash:r,gid:a})}var jt=ee((function(e,t,r){return Object(l.tabIsMessageRequest)(r.tabs[e])?Promise.resolve(r):(r.tabs[e].lastTyping=Date.now(),Object(n.post)(w,{act:"a_activity",type:t,peer:e,gid:r.gid,hash:r.tabs[e].hash}).then(()=>r,()=>r))})),At=ee((e,t)=>Object(n.post)(w,{act:"a_accept_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>{var r=t.tabs[e];return r.is_message_request=!1,r.folders=Object(_.removeMessageRequestFolderFlags)(r.folders),t})),Mt=ee((e,t)=>Object(n.post)(w,{act:"a_reject_message_request",peer_id:e,hash:t.tabs[e].hash}).then(()=>(we(t,t.tabs[e],!0,t=>t.filter(t=>t!==Number(e))),Mr(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t))),Pt=ee((e,t,r)=>Object(n.post)(w,{act:"a_cancel_message_request",peer_id:e,contact_id:t,hash:r.tabs[e].hash}).then(()=>{var n=r.tabs[e];return n&&n.invitedByMessageRequest&&(n.invitedByMessageRequest=n.invitedByMessageRequest.filter(e=>e.id!==t)),r})),Ft=ee((function(e,t){return jt(e,N,t)})),Lt=ee((function(e,t){return jt(e,I,t)}));function xt(e,t,r,n){return t&&(n.pendingForward=null,e||(e={msgIds:[]}),t.addAttach(r?"reply":"mail",e.msgIds.join(";"),e.object||null)),Promise.resolve(n)}function Dt(e,t){return t.pendingForward=e,Promise.resolve(t)}function Rt(e,t,r){if(!Object(l.isTabLoaded)(r,e))return r;r.blockedFlagUpdates||(r.blockedFlagUpdates={}),r.blockedFlagUpdates[e]=!0;var n=r.tabs[e];return we(r,n,!0,t=>t.filter(t=>t!==e)),n.unread>0&&!Object(l.tabIsMessageRequest)(n)&&Me(r,-1,e),n.deletedDialog=!0,Mr(r.tabbedPeers.filter(t=>t.peer!==e),!0,r),t.then(t=>{var a=E(t,2);a[0],a[1];return delete r.blockedFlagUpdates[e],n.msgs=null,n.history=null,n.unread=0,n.lastmsg=!1,n.lastmsg_meta=null,n.minor_sort_id=0,r})}var Bt=ee((function(e,t){return Rt(e,Object(n.post)("al_im.php",{act:"a_flush_history",id:e,from:"im",gid:t.gid,hash:t.tabs[e].hash}),t)})),Ht=ee((function(e,t,r){return Object(n.post)(w,{act:"a_set_chat_title",peer:e,new_title:t,gid:r.gid,hash:r.tabs[e].hash}).then(()=>(r.onUpdate&&r.onUpdate(),r))})),Ut=ee((function(e,t){return Object(n.post)(w,{act:"a_load_chat_info",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>{var n=E(r,1)[0];return t.tabs[e]=extend(t.tabs[e],n),t})}));function qt(e,t,r){var n=r.tabs[e];return n.memberIds=[].concat(n.memberIds,t).filter((e,t,r)=>r.indexOf(e)===t),n.membersCount=n.memberIds.length,Promise.resolve(r)}var Wt=ee((function(e,t,r,a){return Object(n.post)(w,{act:"a_add_chat_members",peer:e,new_peer:t.join(","),gid:a.gid,hash:a.tabs[e].hash,show_history:r?1:0}).then(e=>a)}));function Gt(e,t){if(isEmpty(e))return Promise.resolve(t);var r=Object.keys(e).map(t=>`${t}:${e[t].join(",")}`).join(";");return Object(n.post)(w,{act:"a_load_member",need:r,gid:t.gid}).then(e=>(E(e,1)[0].forEach(e=>Object(h.oCacheAdd)(t,e)),t))}function zt(e,t,r){var n={},a=r.get();function o(e,t){Object(l.isChatPeer)(e)&&t&&!Object(h.oCacheExists)(a,t)&&(n[e]?-1===n[e].indexOf(t)&&n[e].push(t):n[e]=[t])}var s=t.filter(e=>!Object(l.isTabLoaded)(a,e.peerId)).map(e=>e.peerId);t.forEach(e=>{o(e.peerId,e.userId)}),e.forEach(e=>{o(e.peerId,+e.kludges.source_mid)});var c=t.filter(e=>e.flags&i.FLAG_OUTBOUND&&!e.local).map(e=>e.kludges.from_admin).filter(e=>e&&!a.admins[e]);return 0===Object.keys(n).length&&0===c.length&&0===s.length?Promise.resolve(a):{shouldLoad:Object.keys(n).length>0||c.length>0||s.length>0,needMembers:n,needAdminIds:c,needPeers:s}}function Kt(e,t,r){var n=e.needMembers,a=e.needAdminIds,i=e.needPeers;return t.pause(),Promise.all([Gt(n,r),ke(a,r),Promise.all(i.map(e=>ae(e,0,0,0,r)))]).catch(()=>r).then(()=>t.resume()).then(()=>r)}var Vt=ee((function(e,t){return e.kludges.source_act===l.CHAT_PHOTO_REMOVE?(delete t.tabs[e.peerId].photo,delete t.tabs[e.peerId].photoLarge,Promise.resolve(t)):(t.onUpdate&&t.onUpdate(),Object(n.post)(w,{act:"a_get_chat_photo",msg_id:e.messageId}).then(r=>{var n=E(r,2),a=n[0],i=n[1];t.chat_photo_msg=i;var o=t.tabs[e.peerId];if(t.tabs[e.peerId].photo=a[0],t.tabs[e.peerId].photoLarge=a[1],Object(l.isFullyLoadedTab)(t,e.peerId)){var s=e.kludges.source_act;o.history=Object(l.addChatPhotoToUpdate)(e,s,t,te(o.history))}return t}))}));function $t(e,t,r,n){return t!==vk.id||Object(l.isTabLoaded)(n,r)&&n.peer==r&&(n=he(n)),Promise.resolve(n)}var Yt=ee((function(e,t){return Object(n.post)(w,{act:"a_leave_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then($t.bind(null,l.CHAT_KICK_USER,vk.id,e,t))})),Qt=ee((function(e,t){return Object(n.post)(w,{act:"a_return_to_chat",chat:e-2e9,gid:t.gid,hash:t.tabs[e].hash}).then($t.bind(null,l.CHAT_INVITE_USER,vk.id,e,t))})),Xt=ee((function(e,t,r,a){return Object(n.post)(w,{act:"a_mute",peer:e,hash:a.tabs[e].hash,gid:a.gid,value:Number(t),until:r}).then(()=>{var r=t?"mute":"unmute";return window.Notifier&&Notifier.lcSend("im",{act:r,peer:e}),a}).then(Zt.bind(null,e,t))})),Jt=ee((function(e,t,r){return Object(n.post)(w,{act:"a_mute_mentions",peer:e,hash:r.tabs[e].hash,gid:r.gid,value:Number(t)}).then(()=>r)}));function Zt(e,t,r){var n=r.mutedPeers.filter(t=>t!==e);return t&&n.push(e),r.mutedPeers=n,cur.mutedPeers=r.mutedPeers,he(r)}function er(e,t){return t.stack=e,Promise.resolve(t)}var tr=ee((function(e,t,r,a){return rr(e,r,t,a),Object(n.post)(w,{act:"a_mark_important",ids:e,val:t?1:0,from:"im",gid:a.gid,peer:r,hash:a.tabs[r].hash}).then(()=>a)}));function rr(e,t,r,n){if(Object(l.isFullyLoadedTab)(n,t)){var a=n.tabs[t];e.filter(e=>a.msgs[e]).forEach(e=>{var o=Object(_.getMessage)(n,t,e),s=r?o.flags|i.FLAG_IMPORTANT:o.flags&~i.FLAG_IMPORTANT;o.flags=s,a.msgs[e]=o,a.history=Object(l.updateStar)(e,r,te(a.history))})}return Promise.resolve(n)}function nr(e,t,r){return r.importants||(r.importants={}),(r.importants[t]||0)!==e&&(r.important_cnt+=e,r.importants[t]=e),Promise.resolve(r)}function ar(e,t){return Object(n.post)(w,{act:"a_spam",offset:e,gid:t,part:e>0})}function ir(e,t){return Object(n.post)(w,{act:"a_flush_spam",gid:t,hash:e})}function or(e,t,r){return r.creationType=e,r.creationFilter=t,Promise.resolve(r)}function sr(e,t){return Object(n.post)(w,{act:"a_owner_photo",photo:JSON.parse(e).data[0],peer:t})}function cr(e,t){return t.next_chat_avatar=e,Promise.resolve(t)}function ur(e,t,r){return Object(n.post)("al_page.php",{act:"owner_photo_save",peer:e,_query:t,gid:r.gid}).then(e=>r)}var lr=ee((function(e,t,r,a){return a.creating=!0,a.longpoll.pause(),Object(n.post)(w,{act:"a_multi_start",hash:a.writeHash,peers:t.join(","),title:r}).then(e=>{var t=E(e,1)[0];return a.next_peer=t.peerId,a.tabs[t.peerId]=t,we(a,t,!1,e=>[t.peerId].concat(e)),a.longpoll.resume(),a}).then(t=>e?ur(t.next_peer,e,t):t).then(e=>(e.creating=!1,e)).catch(e=>{throw a.creating=!1,a.longpoll.resume(),e})})),dr=ee((function(e,t,r){return r.creating=!0,Object(n.post)(w,{act:"a_multi_start",hash:r.writeHash,peers:[],title:t,gid:r.gid,is_community_chat:1}).then(t=>{var n=E(t,1)[0].peer_id;if(!n)throw new Error("No peer_id");return e?ur(n,e,r):r}).then(e=>(e.creating=!1,e)).catch(e=>{throw r.creating=!1,e})}));function _r(e){var t;e.resync_in_process=new Promise(e=>{t=e});var r=Object.keys(e.tabs).length,a=e.active_tab;return Object(n.post)(w,{act:"a_resync",sel:e.peer,gid:e.gid,loaded:r,tab:a,add_peers:e.tabbedPeers.map(e=>e.peer).join(",")}).then(r=>{var n=E(r,5),i=n[0],o=n[1],s=n[2],u=n[3],_=n[4];o.forEach(t=>Object(h.oCacheAdd)(e,t)),Object(l.normalizeTabsGotFromServer)(e,i),s.user_unread&&handlePageCount("msg",s.user_unread),Object(c.lplog)("Resync success","success");var f,p=e.peer;if(Object(l.isReservedPeer)(p))f=Promise.resolve(!1);else{var g={tabs:{[p]:e.tabs[p]},oCache:{}};f=Be({[p]:i[p]},g)}return f.then(r=>{e.tabs=i,e.admins=extend(e.admins,u),r&&(e.tabs[p]=r.tabs[p],e.tabs[p].history=Object(l.restoreQueue)(p,e,te(e.tabs[p].history))),e.loadingDialogs=!1,e.mutedPeers=s.mutedPeers,e.lastDialogsOptions={has_more:s.has_more},e.dialog_tab_cts=Object.assign({},s.folder_cts,{[d.FOLDER_MESSAGE_REQUEST]:e.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]}),e.dialog_tabs[a]=_.map(intval);var n=e.dialog_tabs[a].map(t=>e.tabs[t]);return Object.keys(e.dialog_tabs).filter(e=>e!=a).forEach(t=>{a==d.FOLDER_ALL?e.dialog_tabs[t]=n.filter(Cr(t)).map(e=>e.peerId):e.dialog_tabs[t]=[]}),delete e.resync_in_process,setTimeout(t.bind(null,!0),0),gr(intval(s.unread),e)})}).catch(t=>(Object(c.lplog)("Resync error: "+t.message+" "+t.stack,"error"),Object(o.pause)(2).then(_r.bind(null,e))))}function fr(e,t){return t.lockedSending=e,Promise.resolve(t)}function hr(e,t,r){return e&&!r.delayed_message?(r.delayed_message=e,r.delayed_ts=t):e||(r.delayed_message=e,r.delayed_ts=t),Promise.resolve(r)}function pr(e){return!!e.textMediaSelector.urlAttachmentLoading||!!(window.Upload&&Upload.options&&Upload.isSomethingUploading)&&Object.keys(Upload.options).filter(e=>Upload.isSomethingUploading(e)).length>0}function gr(e,t){return t.unread_cnt=e,t.dialog_tab_cts[d.FOLDER_UNREAD]=e,Promise.resolve(t)}function mr(e,t){return t.ctrl_submit=!!e,Object(n.post)(w,{act:"a_save_ctrl_submit",to:t.peer,hash:t.tabs[t.peer].hash,value:e?1:0}).then(e=>t)}function br(e,t,r){r.cur_unread_cnt||(r.cur_unread_cnt={}),t&&!inArray(e,r.mutedPeers)&&(r.cur_unread_cnt[e]=!0);var n=document.title,a=window.devicePixelRatio>=2?"_2x":"";if(t&&!r.update_title_to){var i=function(e,t,r){return function(){r.update_old_title=e;var n=Object.keys(r.cur_unread_cnt).length;if(0===n)return Object(v.setDocumentTitle)(e||document.title),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),clearInterval(r.update_title_to),void(r.update_title_to=!1);e?(Object(v.setDocumentTitle)(e),setFavIcon("/images/icons/favicons/fav_im"+t+".ico"),e=!1):(e=document.title,setFavIcon("/images/icons/favicons/fav_im"+(n>9?10:n)+t+".ico"),Object(v.setDocumentTitle)(winToUtf(getLang("mail_im_new_messages",n))))}}(n,a,r);r.update_title_to=setInterval(i,1e3),i()}else!t&&r.update_old_title&&(Object(v.setDocumentTitle)(r.update_old_title),r.cur_unread_cnt={},n=!1,r.update_old_title=!1,setFavIcon("/images/icons/favicons/fav_im"+a+".ico"),clearInterval(r.update_title_to),r.update_title_to=!1);return Promise.resolve(r)}function vr(e,t,r,n,a){return Object(l.isFullyLoadedTab)(a,e)&&(a.tabs[e].scrollTop=intval(t),a.tabs[e].scrollBottom=intval(r),a.tabs[e].contHeight=intval(n)),Promise.resolve(a)}function Cr(e){return e===d.FOLDER_ALL?e=>!Object(l.tabIsMessageRequest)(e):e===d.FOLDER_UNREAD?e=>!Object(l.tabIsMessageRequest)(e)&&e.unread>0:e===d.FOLDER_MESSAGE_REQUEST?e=>Object(l.tabIsMessageRequest)(e):t=>t.folders&d.FOLDER_MASKS[e]}function yr(e,t){t.active_tab=e,Object(a.updateLocation)({tab:e===d.FOLDER_ALL?null:e});var r=[];if(e!==d.FOLDER_ALL&&!Object(l.isReversedDialogs)(t)){var n=t.dialog_tabs[e];r=t.dialog_tabs[d.FOLDER_ALL].map(e=>t.tabs[e]).filter(Cr(e)).map(e=>e.peerId),t.dialog_tabs[e]=n.length>=r.length?n:r}return Promise.resolve(t)}function Tr(e,t,r,n){var a=e.dialog_tabs_all;return!(!a[d.FOLDER_ALL]&&!a[t])||(!!r.includes(n.peerId)||("r"===n.lastmsg[0]||r.map(t=>e.tabs[t.toString()]).filter(t=>Object(l.isReversedDialogs)(e)?t.minor_sort_id>n.minor_sort_id:t.minor_sort_id<n.minor_sort_id).length>0))}function Er(e,t,r,n,a,o){if(Object(l.isTabLoaded)(o,e)&&!a){var s=o.tabs[e];return r===i.REPLACE_DIRECTORIES&&(t^=s.folders),function(e,t,r){return!(e===i.SET_DIRECTORIES&&r.folders&t)&&(!!(e!==i.RESET_DIRECTORIES||r.folders&t)&&!Object(l.tabIsMessageRequest)(r))}(r,t,s)&&Object.keys(d.FOLDER_MASKS).filter(e=>d.FOLDER_MASKS[e]&t).forEach(e=>{o.dialog_tab_cts[e]+=function(e,t,r){return t!==i.RESET_DIRECTORIES||e.folders&d.FOLDER_MASKS[r]?t===i.REPLACE_DIRECTORIES?e.folders&d.FOLDER_MASKS[r]?-1:1:t===i.SET_DIRECTORIES?1:-1:0}(s,r,e)}),r===i.SET_DIRECTORIES?o.tabs[e].folders|=t:r===i.RESET_DIRECTORIES?o.tabs[e].folders&=~t:o.tabs[e].folders=t^=s.folders,we(o,o.tabs[e],!0,(t,r)=>t.concat([e]).map(e=>o.tabs[e]).filter(Cr(r)).map(e=>e.peerId),Tr.bind(null,o)),Promise.resolve(o)}return ae(e,0,0,0,o).then(Er.bind(null,e,t,r,null,!1,o))}var Or=ee((function(e,t){var r=d.FOLDER_MASKS[d.FOLDER_IMPORTANT],a=t.tabs[e].folders&r,o=a?i.resetDirectoriesEvent:i.setDirectoriesEvent;return t.longpoll.push([o([0,e,r,!0])]),Object(n.post)(w,{act:"a_dialog_star",val:a?0:1,peer:e,hash:t.tabs[e].hash,gid:t.gid}).then(()=>t)})),wr=ee((function(e,t,r){var a=d.FOLDER_MASKS[d.FOLDER_UNRESPOND];return r.longpoll.push([i.resetDirectoriesEvent([0,e,a,!0]),i.readInboundEvent([6,e,t,null])]),Object(n.post)(w,{act:"a_mark_answered",peer:e,lastmsg:t,hash:r.tabs[e].hash,gid:r.gid}).then(()=>r)}));function kr(e){return Object(n.post)(w,{act:"a_get_mutex_key",gid:e})}function Nr(e,t){return ne({[e]:{free:!0}},t),Object(n.post)(w,{act:"a_block_release",peer:e,gid:t.gid}).then(()=>t)}function Ir(e,t){var r=ls.get("comm_mute_"+t.gid)?1:0;return e&&(r^=1),ls.set("comm_mute_"+t.gid,r),t.mute=r,Promise.resolve(t)}var Sr=ee((function(e,t){return we(t,t.tabs[e],!0,t=>t.filter(t=>t!==e)),t.tabs[e].deletedDialog=!0,Object(n.post)(w,{act:"a_delete_dialog",peer:e,gid:t.gid,hash:t.tabs[e].hash}).then(r=>(r[0]?(Mr(t.tabbedPeers.filter(t=>t.peer!==e),!0,t),t.tabs[e].unread=0,t.tabs[e].lastmsg=!1,t.tabs[e].lastmsg_meta=null):(t.tabs[e].deletedDialog=!1,we(t,t.tabs[e],!1,Ie.bind(null,e),Tr.bind(null,t))),r))}));function jr(e,t,r,a){return Object(n.post)(w,{act:"a_restore_dialog",hash:t,gid:a.gid,spam:r?1:0,peer:e}).then(t=>(a.tabs[e].deletedDialog=!1,we(a,a.tabs[e],!1,t=>[e].concat(t)),a.tabs[e].unread=t,a))}function Ar(e,t,r){return Object(n.post)(w,{act:"a_spam_dialog",peer:e,gid:r.gid,hash:t})}function Mr(e,t,r){return r.tabbedPeers=e,Object(l.isClassicInterface)(r)&&(j({peers:r.tabbedPeers.filter(e=>{var t=e.peer,n=e.type;return t!==r.peer&&"perm"===n}).map(e=>Object(l.getBareTab)(e.peer,r)).filter(e=>!e.deletedDialog).map(e=>e.peerId).map(l.convertPeerToUrl).join("_"),to:""}),t&&A()),Promise.resolve(r)}function Pr(e){return!e.peer||(gt(e.peer,e)?pt(e.peer,e):!!Object(l.isFullyLoadedTab)(e,e.peer)&&e.tabs[e.peer].allShown)}function Fr(e,t){var r=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(r.skipped=null,r.msgs=null,r.offset=null,r.allShown=null,r.history=null),Promise.resolve(t)}function Lr(e,t){var r=t.tabs[e];return Object(l.isFullyLoadedTab)(t,e)&&(r.history=re(r.history)),Promise.resolve(t)}function xr(e,t){return t.go_to_end_visible=e,Promise.resolve(t)}function Dr(e,t){return t.go_to_mentions_visible=e,Promise.resolve(t)}function Rr(e,t,r){if(!Object(l.isCommunityPeer)(t))return Promise.resolve(r);var a=Object(_.getTab)(r,t);return a.blocked_community=!e,!1===e&&(a.can_send_notify=!1),Object(n.post)(w,{act:"a_toggle_community",peer_id:t,hash:a.hash,state:e?1:0}).then(()=>he(r))}function Br(e,t){if(0!==t.peer&&Object(l.isFullyLoadedTab)(t,t.peer)){var r=Object(_.getTab)(t,t.peer);r.history=te(r.history),e(r.history)}return Promise.resolve(t)}function Hr(e,t){if(0!==t.peer&&Object(l.isFullyLoadedTab)(t,t.peer)){var r=Object(_.getTab)(t,t.peer),n=geByClass1("_im_peer_history");n&&(r.history=te(n.innerHTML)),e(r.history)}return Promise.resolve(t)}function Ur(e){return e.audio_msg.isRecording?Promise.reject():(e.audio_msg.isRecording=!0,Promise.resolve(e))}function qr(e){return e.audio_msg.isRecording=!1,Promise.resolve(e)}function Wr(e,t){return t.voice_message_available=e,Promise.resolve(t)}function Gr(e){j({act:e?"create":null}),A()}function zr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;j({q:e}),A()}function Kr(e){return void 0===e.chatResizeInitialized&&(e.chatResizeInitialized=!0,Object(l.getClassicChatHeight)()>window.clientHeight()&&Object(l.setClassicChatHeight)(0)),Promise.resolve(e)}var Vr=ee((function(e,t,r){return Object(n.post)(w,{act:"a_join_chat",chat_id:e,hash:t,write_hash:r.writeHash}).then(e=>{var t=E(e,4),n=t[0],a=t[1],i=t[2],o=t[3];return i.forEach(e=>Object(h.oCacheAdd)(r,e)),r.tabs[n]=a,we(r,a,!1,Ie.bind(null,n),Tr.bind(null,r)),r.admins=extend(r.admins,o),[n]})}));function $r(e,t){return Object(n.post)(w,{act:"a_get_link",gid:t.gid,chat_id:e})}var Yr=ee((function(e,t){var r=t.tabs[e];return Object(n.post)(w,{act:"a_reset_link",chat_id:e-2e9,write_hash:t.writeHash,gid:t.gid}).then(e=>(r.inviteLink=e[0],e))}));function Qr(e){return M({invite_chat_id:null,invite_hash:null,mr:null}),e.invitation=void 0,Promise.resolve(e)}function Xr(e,t){var r=Object(c.arrayUnique)([e].concat(t.select(u.RECENT_SEARCH_OP))).slice(0,500);t.update(u.RECENT_SEARCH_OP,r)}function Jr(e){e.update(u.RECENT_SEARCH_OP,[])}function Zr(e,t){var r=t.select(u.RECENT_SEARCH_OP).filter(t=>t!==e);return t.update(u.RECENT_SEARCH_OP,r),r}function en(e,t,r){var n=r.tabs[t],a=Object(_.getMessage)(r,t,e);return Object(_.isChatActive)(n)&&!a.kludges.source_act&&(n.pinned=a),Promise.resolve(r)}function tn(e,t){return t.tabs[e].pinned=null,Promise.resolve(t)}var rn=ee((function(e,t,r){var a=r.tabs[t];return Object(_.isChatActive)(a)?Object(n.post)(w,{act:"a_pin_message",msgid:e,chat:t,gid:r.gid,hash:r.tabs[t].hash}).then(e=>{var n=E(e,1)[0];return r.tabs[t]=Object.assign({},a,n),r}):Promise.resolve(r)})),nn=ee((function(e,t){var r=t.tabs[e];return Object(_.isChatActive)(r)?Object(n.post)(w,{act:"a_unpin_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(n=>{var a=E(n,1)[0];return t.tabs[e]=Object.assign({},r,a),t}):Promise.resolve(t)})),an=ee((function(e,t){var r=t.tabs[e];return Object(n.post)(w,{act:"a_get_pinned_message",chat:e,gid:t.gid,hash:t.tabs[e].hash}).then(e=>{var n=E(e,1)[0];return r.pinned=n||null,t})})),on=ee((function(e,t,r){var a=r.tabs[e];return Object(n.post)(w,{act:"a_get_message_local_id",chat:e,chat_local_id:t,hash:a.hash})})),sn=ee((function(e,t){var r=t.tabs[e];return r.membersLoaded?Promise.resolve(t):Object(n.post)(w,{act:"a_get_chat_members",chat:e,gid:t.gid,hash:r.hash}).then(e=>{var n=E(e,1),a=E(n[0],3),i=a[0],o=a[1],s=a[2];return r.memberIds=i,r.adminIds=o,s.forEach(e=>Object(h.oCacheAdd)(t,e)),r.membersLoaded=!0,t})})),cn=ee((function(e,t){return Promise.all([sn(e,t),function(e,t){var r=t.tabs[e];return Object(n.post)(w,{act:"a_get_chat_details",chat:e,gid:t.gid,hash:r.hash}).then(e=>{var n=E(e,1)[0];return r.photoGrid=n.grid,r.photoLarge=n.photo,r.membersLastSeen=n.lastSeen||null,r.inviters=n.inviters,r.caccess=n.caccess,r.invitedByMe=n.invitedByMe||[],r.inviteLink=n.link||null,r.invitedByMessageRequest=n.invitedByMessageRequest,r.serverSettings=n.serverSettings||null,r.isDefaultPhotoOwner=n.isDefaultPhotoOwner||null,r.owner=n.owner||null,r.allowedUpdateFlags=n.allowedUpdateFlags,r.canInvite=n.canInvite||null,r.notifications=n.notifications,t})}(e,t)]).then(()=>t)})),un=ee((function(e,t,r){var a=r.tabs[e];return Object(n.post)(w,{act:"a_update_flags",chat:e,gid:r.gid,hash:a.hash,flags:t}).then(e=>(r.onUpdate&&r.onUpdate(),e))})),ln=ee((function(e,t){var r=t.tabs[e];return Object(n.post)("al_page.php",{act:"owner_photo_remove",oid:e,gid:t.gid,hash:r.photoHash}).then(()=>(r.photo=null,r.photoLarge=null,t.onUpdate&&t.onUpdate(),t))}));function dn(e,t,r){var n=r.tabs[e];return n.memberIds=n.memberIds.filter(e=>e!==t),n.adminIds=n.adminIds.filter(e=>e!==t),n.membersCount=n.memberIds.length,Promise.resolve(r)}var _n=ee((function(e,t,r){var a=r.tabs[e];return Object(n.post)(w,{act:"a_kick_user",chat:e,hash:a.hash,mid:t,gid:r.gid}).then(()=>(a.memberIds=a.memberIds.filter(e=>e!==t),a.adminIds=a.adminIds.filter(e=>e!==t),a.membersCount=a.memberIds.length,r))}));function fn(e,t,r,n){var a=n.tabs[e];return a.adminIds=r?[].concat(a.adminIds,t).filter((e,t,r)=>r.indexOf(e)===t):a.adminIds.filter(e=>e!==t),Promise.resolve(n)}var hn=ee((function(e,t,r,a){var i=a.tabs[e];return Object(n.post)(w,{act:"a_toggle_admin",chat:e,hash:i.hash,mid:t,is_admin:+r,gid:a.gid}).then(()=>fn(e,t,r,a))}));function pn(e,t,r,n){var a=Object(_.getMessage)(e,r,t).userId;return Object(h.oCacheGet)(n,a)?Promise.resolve(n):Gt({[r]:[a]},n)}function gn(){ajax.post("al_im.php",{act:"a_hide_promo_tooltip"})}function mn(){cur.videoAutoplayScrollHandler&&cur.videoAutoplayScrollHandler()}var bn=ee((function(e,t){return t.tabs[e].top_banner=void 0,Object(n.post)(w,{act:"a_hide_banner",peer_id:e,gid:t.gid,hash:t.tabs[e].hash}).then(()=>t)})),vn=ee((function(e,t,r){r.tabs[e].top_banner=void 0;var a=r.tabs[e];return Object(n.post)(w,{act:"a_callback_banner",peer_id:e,callback_data:t,hash:a.hash}).then(()=>r)}));function Cn(e,t){return Object(n.post)(w,{act:"a_load_banner",peer_id:e,gid:t.gid}).then(r=>{var n=E(r,1)[0];return t.tabs[e].top_banner=n,t})}function yn(e,t,r){return r.tabs[e].keyboard=t&&t.buttons?t:null,En(e,!1,!0,r)}function Tn(e,t){return yn(e,null,t)}function En(e,t,r,n){return((n.tabs||{})[e]||{}).keyboard&&(n.tabs[e].keyboard.hide=t,r&&ls.set("is_keyboards_hide",Object.assign(ls.get("is_keyboards_hide")||{},{[e]:t}))),Promise.resolve(n)}var On=ee((function(e,t){var r=t.tabs[e];return Object(n.post)(w,{act:"a_get_keyboard",peer_id:e,hash:r.hash}).then(r=>{var n=E(r,1)[0];return yn(e,n,t)})}));function wn(e,t,r,a){var i=a.tabs[e];return i.caccess[t]=r,Object(n.post)(w,{act:"a_change_caccess",peer_id:e,member_id:t,hash:i.hash,access:r?1:0,gid:a.gid}).then(()=>a).catch(e=>{throw i.caccess[t]=!r,e})}var kn=ee((function(e,t){var r=t.tabs[t.peer];return Object(n.post)(w,{act:"a_delete_template",template_id:e,hash:r.hash,gid:t.gid,peer_id:t.peer}).then(()=>{var r=t.templates.find(t=>t.id===e);return r&&(r.deleted=!0),t})}));function Nn(e,t,r){var a=r.tabs[r.peer];return Object(n.post)(w,{act:"a_create_template",hash:a.hash,gid:r.gid,peer_id:r.peer,name:e,text:t}).then(e=>(r.templates.unshift(e[0]),r))}function In(e,t,r,a){var i=a.tabs[a.peer];return Object(n.post)(w,{act:"a_update_template",template_id:e,hash:i.hash,gid:a.gid,peer_id:a.peer,group_id:a.gid,name:t,text:r}).then(t=>{var r=a.templates.find(t=>t.id===e);return r&&Object.assign(r,t[0]),a})}function Sn(e,t){if(Object(l.isFullyLoadedTab)(t,e)){var r=Object(_.getTab)(t,e);r.allShown=!1,r.lastReset=Date.now()}return t}function jn(e,t){var r=e.updateType,n=e.updateArg,a=0;return r===i.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED&&(a=n===i.MESSAGE_REQUEST_STATUS_NEW?1:-1),r===i.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED&&(a=-1),t.dialog_tab_cts[d.FOLDER_MESSAGE_REQUEST]+=a,Promise.resolve(t)}function An(e,t,r){if(Object(l.isFullyLoadedTab)(r,e.peerId)){var n=Object(_.getTab)(r,e.peerId);n.history=Object(l.setCasperMessageExpiringStatusDOM)(n.history,t,e.messageId)}return Promise.resolve(r)}function Mn(e,t){return Promise.resolve().then(()=>{if(Object(l.isFullyLoadedTab)(t,e)){var r=Object(_.getTab)(t,e);Object.values(r.msgs).forEach(e=>{var t=Object(_.parserMessage)(e);Object(f.isCasperMessage)(t)&&!y.casperMessagesStore.has(t.messageId)&&y.casperMessagesStore.add(t)})}return Promise.resolve(t)})}var Pn=ee((function(e,t,r,a,i){return Object(n.post)(w,{act:"a_peer_profile_toggle_tag",hash:i.manage_tags_hash,group_id:i.gid,peer_id:r,tag_id:e,action:t}).then(()=>(i.tabs[r].peer_tags=a,i))})),Fn=ee((function(e,t){return Object(n.post)(w,{act:"a_peer_profile_manage_tags",hash:t.manage_tags_hash,group_id:t.gid,tags:JSON.stringify(e)}).then(e=>(t.peer_profile_tags=e[0].tags,t))}))},"wSs/":function(e,t,r){"use strict";r.r(t),r.d(t,"canMessageBeEdited",(function(){return c})),r.d(t,"convertEmojiHtmlToRegularText",(function(){return u})),r.d(t,"findLastMessageToEdit",(function(){return l})),r.d(t,"wasMessageReallyModified",(function(){return d})),r.d(t,"replaceMsgAfterEdit",(function(){return _}));r("Vd3H"),r("rGqo"),r("Btvt"),r("pIFo");var n=r("rHUl"),a=r("MhhX"),i=r("P13b"),o=r("rudk"),s=r("aong");function c(e,t){t=Object(n.parserMessage)(t);var r=vk.id==t.peerId&&!Object(s.unpackStore)(e).gid;return 333!=t.peerId&&(!(!r&&!Object(a.isOut)(t))&&(!Object(a.isServiceMsg)(t)&&(!(Date.now()/1e3-t.date>86400)&&(!(Object(a.isGift)(t)||Object(a.isSticker)(t)||Object(a.isAudioMsg)(t)||Object(a.isGraffiti)(t)||Object(a.isMoney)(t)||Object(a.isVKPay)(t)||Object(a.isCallMessage)(t))&&!Object(i.isAlreadyDeleted)(e,t.peerId,t.messageId)))))}function u(e){var t=document.createElement("div");return e=e.replace(/\[((id|club)\d+)\|(.+?)]/g,(function(){var e=arguments.length<=1?void 0:arguments[1],t=arguments.length<=3?void 0:arguments[3];return/^\@/.test(t)?t:`@${e} (${t})`})),t.innerHTML=e,Emoji.val(t)}function l(e,t){return+(t&&t.msgs?Object.keys(t.msgs):[]).filter(e=>e>0).sort((e,t)=>t-e).find(r=>c(e,t.msgs[r]))||null}function d(e,t,r){var n=Object(o.convertKludgesToAttaches)(t.kludges,t.messageId),a=r.dData.attaches;if(u(t.text)!==r.dData.txt||n.length!==a.length)return!0;for(var i=n.length;i--;){var s=n[i],c=a[i];if(s.id!=c.id||s.type!=c.type||"poll"==s.type&&c.object&&c.object.poll_is_edited)return!0}return!1}function _(e,t,r,n,a,o){t.origText=r,t.text=Object(i.replaceSpecialSymbols)(clean(r)).replace(/\n/gi,"<br>"),t.attaches=n,t.kludges.emoji=1,t.local=1,t.share_url=a,t.cancelled_shares=o,t.update_time=Math.floor(Date.now()/1e3),e.get().tabs[t.peerId].msgs[t.messageId]=t}},zNZe:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var core_js_modules_es6_promise__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("VRzm"),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Btvt"),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("SRfc"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("KKXr"),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("98sY"),_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("QGEU"),_shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("gF8j"),_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("cGUQ"),_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("jE6c"),_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("4KwC"),ACTIVE_TAB_SWITCH_SERVER_TIMEOUT=browser.safari?3e3:1e4,LC_SERVER_SWITCH_TO_ACTIVE_FLAG="lc_server_switch_to_active_flag",NOTIFICATION_FADE_TIMEOUT=7e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE=35e3,NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE=5e3,NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE=3e4;function showEventThumb(e){var t="",r="";return e.author_photo&&(t="video_process_ready"===e.type?`<div class="notifier_video_thumb" style="background-image: url('${Notifier.fixPhoto(e.author_photo)}')"></div>`:`<img alt="" src="${Notifier.fixPhoto(e.author_photo)}" class="notifier_image" />`,e.icon_type&&(t='<div class="feedback_photo_icon"></div>'+t,r=` feedback_${e.icon_type}_row`),e.author_link&&(t=`<a href="${e.author_link}">${t}</a>`),t=`<div class="notifier_image_wrap${r}">${t}</div>`),t}function showEventAddPhoto(e){var t="";return e.add_photo&&(t=`<div class="notifier_add_image_wrap"><img src="${e.add_photo}" class="notifier_add_image"></div>`),t}function loadCallsModule(){return new Promise(e=>{stManager.add([jsc("web/calls.js"),"calls.css"],()=>{e()})})}window.curNotifier||(window.curNotifier={addQueues:{},recvClbks:{},recvData:{},onConnectionId:[]}),window.Notifier={debug:!1,init:function(e){if(!window.curNotifier||!curNotifier.connection_id){if(Notifier.notificationsGc(),curNotifier=extend({q_events:[],q_prior_events:[],q_shown:[],q_closed:[],negotiations:{},currentIm:{},q_max:3,uiNotifications:[],q_idle_max:5,browser_shown:{},done_events:{},addQueues:curNotifier.addQueues||{},recvClbks:curNotifier.recvClbks||{},recvData:curNotifier.recvData||{},error_timeout:1,request_timeout:1e3,sound:new Sound("mp3/bb1"),sound_im:new Sound("mp3/bb2"),sound_im_current:new Sound("mp3/bb3"),onConnectionId:[],showDoneBoxLastId:-1},e),!this.initFrameTransport())return!1;this.initIdleMan(),this.initCommunityQueues(),Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonOnTabInitialLoaded)(),(curNotifier.cont=ge("notifiers_wrap"))||bodyNode.insertBefore(curNotifier.cont=ce("div",{id:"notifiers_wrap",className:"fixed"}),ge("page_wrap")),e.callsEnabled&&loadCallsModule().then(()=>{window.Calls.init(e.callsCredentials,e.imHash)})}},initCommunityQueues:function(e){var t=ls.get("im_m_comms_key"),r=t&&t.split?t.split(";"):[];if("empty"===r[0]&&r[1]&&Date.now()-r[1]<6e4?t="empty":"empty"===r[0]&&(t=!1),t)return Notifier.proccessCommunityQueues(t,e||0);ajax.post("al_im.php",{act:"a_get_comms_key"},{onDone:function(t){"empty"===t?t+=";"+Date.now():Notifier.proccessCommunityQueues(t,e||0),ls.set("im_m_comms_key",t)},onFail:function(){return!0}})},notificationsGc:function(){curNotifier.uiGcTo=setTimeout((function(){for(var e=curNotifier.uiNotifications,t=[],r=0;r<e.length;r++){var n=e[r];Date.now()-n[1]>1e4?n[0].close():t.push(n)}curNotifier.uiNotifications=t,Notifier.notificationsGc()}),5e3)},resetCommConnection:function(e){var t=ls.get("im_m_comms_key");t&&delete curNotifier.addQueues[t.queue],ls.set("im_m_comms_key",!1),Notifier.initCommunityQueues(e||0)},proccessCommunityQueues:function(e,t){if("empty"===e||!e)return!1;Notifier.addKey(e,(function(e,r){if(r.failed)++t<50&&setTimeout(Notifier.resetCommConnection.pbind(t),100);else{(e=ls.get("im_m_comms_key"))&&(e.ts=r.ts,ls.set("im_m_comms_key",e));var n=r.events;n&&n.map((function(e){return e.split("<!>")})).forEach((function(e){if("update_cnt"===e[1]){var t=e[5],r=e[4];handlePageCount("mgid"+t,r)}}))}}))},destroy:function(){Notifier.hideAllEvents(),curNotifier.idle_manager.stop(),curNotifier.uiGcTo&&clearTimeout(curNotifier.uiGcTo),curNotifier={},re("notifiers_wrap"),re("queue_transport_wrap")},reinit:function(){ajax.post("notifier.php?act=a_get_params",{},{onDone:function(e){e?(curNotifier.error_timeout=1,this.init(e)):(curNotifier.error_timeout=curNotifier.error_timeout||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<256&&(curNotifier.error_timeout*=2))}.bind(this),onFail:function(){return curNotifier.error_timeout=curNotifier.error_timeout||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<256&&(curNotifier.error_timeout*=2),!0}.bind(this)})},standby:function(e){this.destroy(),curNotifier.error_timeout=e||1,setTimeout(this.reinit.bind(this),1e3*curNotifier.error_timeout)},freezeEvents:function(){curNotifier.frozen=!0,curNotifier.unfreezeAfterTooltipHide=!1,each(curNotifier.q_shown,(function(){clearTimeout(this.fadeTO),getStyle(this.baloonEl,"opacity")<1&&animate(this.baloonEl,{opacity:1},100)}))},unfreezeEvents:function(){curNotifier.tooltipShown?curNotifier.unfreezeAfterTooltipHide=!0:(curNotifier.frozen=!1,each(curNotifier.q_shown,(function(e,t){t.timeoutConf?t.fadeTO=setTimeout(t.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?t.timeoutConf.unfreeze_am:t.timeoutConf.unfreeze):t.fadeTO=setTimeout(t.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?3e4:5e3)})))},getTransportWrap:function(){return ge("queue_transport_wrap")||utilsNode.appendChild(ce("div",{id:"queue_transport_wrap"}))},setFocus:function(e){var t=(e?"1":"0")+curNotifier.instance_id;"flash"==curNotifier.transport&&curNotifier.flash_transport?curNotifier.flash_transport.setInstanceFocused(t):"frame"==curNotifier.transport&&(Notifier.lcSend("focus",{instance_id:t}),this.onInstanceFocus(t))},initIdleMan:function(){curNotifier.idle_manager&&curNotifier.idle_manager.started||(curNotifier.idle_manager=new _shared_lib_idle_manager__WEBPACK_IMPORTED_MODULE_7__.default({onIdleCb:function(){Notifier.freezeEvents(),Notifier.setFocus(0),cur.onIdle&&each(cur.onIdle,(function(e,t){t()}))},onUnIdleCb:function(){Notifier.unfreezeEvents(),Notifier.setFocus(1),cur.onUnidle&&each(cur.onUnidle,(function(e,t){t()})),FastChat&&FastChat.onUnidle(),vk.spentLastSendTS=Date.now()},id:"window",element:document,focusElement:window}),curNotifier.idle_manager.start())},initFrameTransport:function(){if(!ls.checkVersion()||browser.msie8||!("onmessage"in window)&&!("postMessage"in window))return!1;curNotifier.connection_id="queue_connection_"+curNotifier.queue_id,curNotifier.lc_prev_value="",curNotifier.is_server=!1,curNotifier.lp_connected=!1,curNotifier.error_timeout=1;var e=browser.version.split("."),t=intval(e[0]),r=intval(e[1]);for(var n in curNotifier.post_message=Notifier.debug||!(browser.opera&&intval(browser.version)<15||browser.msie||browser.mozilla&&t>=31||browser.safari&&(t>7||7==t&&r>=1)),curNotifier.transport="frame",this.lcInit(),curNotifier.onConnectionId)curNotifier.onConnectionId[n]();return curNotifier.onConnectionId=[],!0},onActivated:function(){curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?curNotifier.idle_manager.is_idle=!1:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle||Notifier.setFocus(1),removeEvent(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionInit:function(){addEvent(document,"mousemove keydown touchstart",Notifier.onActivated)},onConnectionFailed:function(){},onRelogin:function(){setTimeout((function(){Notifier.standby()}),0)},onMessage:function onMessage(msg){if(!curNotifier.focus_instance||curNotifier.focus_instance==curNotifier.instance_id)try{var events=eval("("+msg+")");Notifier.pushEvents(events)}catch(e){debugLog(e.message)}},onInstanceFocus:function(e){var t=e.charAt(0);e=e.substr(1),"1"==t?(curNotifier.focus_instance=e,e!=curNotifier.instance_id&&(curNotifier.idle_manager.is_idle||curNotifier.idle_manager.idle(),Notifier.hideAllEvents())):curNotifier.focus_instance==e&&(curNotifier.focus_instance="")},onInstanceServer:function(e){curNotifier.is_server=!!e,Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonSyncWithNotifier)()},getLpInstance:()=>Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonGetInstance)(),pushEvents:function(e,t){var r=0;each(e,(function(e,n){r|=Notifier.pushEvent(n,t)})),r&&!ls.get("sound_notify_off")&&curNotifier.is_server&&(2&r?curNotifier.sound_im.play():curNotifier.sound.play())},pushEvent:function pushEvent(ev,cnt){if("nop"!==ev){if("string"==typeof ev)try{ev=JSON.parse(ev)}catch(e){return void Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev)}ev.timeoutConf={default:ev.timeout?ev.timeout:NOTIFICATION_FADE_TIMEOUT,default_am:ev.timeout?5*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE,unfreeze:ev.timeout?.7*ev.timeout:NOTIFICATION_FADE_TIMEOUT_AFTER_UNFREEZE,unfreeze_am:ev.timeout?4.4*ev.timeout:NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE_AFTER_UNFREEZE};var push=cnt?0:1,push_prioritized=!1;if(ev.version!==curNotifier.version&&-1!==ev.version)return debugLog("Notifier old version: "+ev.version+" !== "+curNotifier.version),!1;if("update_cnt"===ev.type)return ev.add&&ev.add.section&&handlePageCount(ev.add.section_id,ev.add.count,ev.add.section_link,ev.add.section_add),0;if(!curNotifier.done_events[ev.id]){switch(curNotifier.done_events[ev.id]=1,void 0!==ev.top_count&&-1!==ev.top_count&&handlePageCount("ntf",ev.top_count),ev.type){case"video_process_ready":if(ev.add.video_raw&&window.Video&&Video.isVideoPlayerOpen(ev.add.video_raw))return;if(ev.add&&window.Video&&Video.isVideoPlayerOpen(ev.add))return;break;case"mail":ev.add&&null!==ev.add.count&&void 0!==ev.add.count&&handlePageCount("msg",ev.add.count);break;case"friend_request":ev.add.fr_count?handlePageCount("fr",ev.add.fr_count):handlePageCount("fr",ev.add);break;case"friend_request_counter":handlePageCount("fr",ev.add.fr_count),push=0;break;case"ach_achieved":ev.add.cnt&&handlePageCount("ach",ev.add.cnt);break;case"ach_achieved_upd":handlePageCount("ach",ev.add),push=0;break;case"bt_upd":if(ev.add.cnt){handlePageCount("bt",ev.add.cnt);var bt=ge("bt_tab_updates");bt&&val(geByClass1("ui_tab_count",bt),ev.add.cnt>0?ev.add.cnt:"")}break;case"bt_upd_upd":ev.add&&ev.add.section&&handlePageCount("bt",ev.add.count,ev.add.section,ev.add.prefix),push=0;var bt=ge("bt_tab_updates");bt&&val(geByClass1("ui_tab_count",bt),ev.add>0?ev.add:"");break;case"push_settings":push=0;var muted=JSON.parse(ev.add);curNotifier.mutedPeers=curNotifier.mutedPeers.filter((function(e){return e!==muted.peer_id})),0!==muted.disabled_until&&curNotifier.mutedPeers.push(muted.peer_id);break;case"mail_cnt":handlePageCount("msg",ev.add),push=0;break;case"clear_notify":TopNotifier&&TopNotifier.invalidate(),Notifier.hideAllEvents(),push=0;break;case"support_reply":handlePageCount("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),toggle("l_spr",ev.add>0);break;case"support_cnt":handlePageCount("spr",ev.add,"support",ev.author_id?"act=show&id="+ev.author_id:"act=show"),toggle("l_spr",ev.add>0),push=0;break;case"balance_changed":parseInt(ev.add.balance)?updateMoney(parseInt(ev.add.balance)):parseInt(ev.add)&&updateMoney(parseInt(ev.add));break;case"gift_sent":re("left_block10_0");var left_block=ev.add;if(left_block){var leftBlocksElem=ge("left_blocks"),left_unpaid_gifts=se(left_block);leftBlocksElem&&(leftBlocksElem.firstChild?leftBlocksElem.insertBefore(left_unpaid_gifts,leftBlocksElem.firstChild):leftBlocksElem.appendChild(left_unpaid_gifts))}break;case"notify_tt":case"login_attempt":if(ev.add.text&&ev.add.key){var evalText=`(${ev.add})`;try{ev.add=eval(evalText),TopNotifier.showTooltip(ev.add.text,ev.add.key)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,evalText)}push=0}break;case"reload_stickers":window.Emoji&&window.Emoji.stickers&&(Emoji.stickers=!1),push=0;break;case"reload_stickers_keywords":window.stickersKeywordsData=null,ls.remove("stickers_keywords"),window.Emoji&&Emoji.updateTabs(),push=0;break;case"any_counter":handlePageCount(ev.add.section_id,ev.add.count,ev.add.link,ev.add.add),push=0;break;case"done_box":push=0,push_prioritized=!0}if("mail"===ev.type&&(push=this.sendMailNotification(ev)),ev.add&&ev.add.tooltip_text){var html='<div class="notify_tt_wrap">'+(ev.author_photo?`<img class="notify_tt_img" src="${ev.author_photo}" />`:'<div class="notify_tt_thumb"></div>')+'<h4 class="notify_tt_text">'+ev.add.tooltip_text+"</h4></div>";TopNotifier.showTooltip(html,0),push=0}return 1&push&&(curNotifier.q_events.push(ev),curNotifier.q_events.length>30&&curNotifier.q_events.splice(0,curNotifier.q_events.length-30),this.checkEvents()),push_prioritized&&(curNotifier.q_prior_events.push(ev),curNotifier.q_prior_events.length>5&&curNotifier.q_prior_events.splice(0,curNotifier.q_prior_events.length-5),this.checkEvents()),push}}},isActive:function(){return window.curNotifier&&curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle},sendImProxy:function(e){e.text=winToUtf(e.text),curNotifier.browser_shown[e.id]||(curNotifier.browser_shown[e.id]=!0,Notifier.trySendBrowserNotification(e,!0),setTimeout((function(){curNotifier.browser_shown[e.id]=void 0}),2e3))},shouldShowNotification:function(e){return"im"!==cur.module&&!FastChat.isChatOpen(e.author_id)},sendSimpleNotification:function(e){return Notifier.playSound(e),Notifier.shouldShowNotification(e)?3:0},sendBrowserNotification:function(e){"im"!==cur.module?Notifier.negotiate({message:"send_im_notification",onSuccess:function(t){Notifier.lcSend("negotiate_back",{token:t.msg,ev:e})},onFail:function(){Notifier.showBrowserNotification(e)}}):(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showBrowserNotification(e))},shouldPlaySound:function(e){return!ls.get("sound_notify_off")&&Notifier.shouldDisturb(e)},shouldDisturb:e=>!cur.noDisturbMode&&(cur.focused!=e.author_id&&!inArray(e.author_id,cur.mutedPeers)&&!inArray(e.author_id,curNotifier.mutedPeers)),shouldPlayCurrentSound:function(e){return!ls.get("sound_notify_off")&&cur.focused==e.author_id&&Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()&&!inArray(e.author_id,cur.mutedPeers)},playSound:function(e){curNotifier.sound_im&&curNotifier.sound_im.play&&Notifier.shouldPlaySound(e)?e.author_id==cur.peer&&Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?curNotifier.sound_im_current.play():curNotifier.sound_im.play():Notifier.shouldPlayCurrentSound(e)&&curNotifier.sound_im_current&&curNotifier.sound_im_current.play()},trySendBrowserNotification:function(e,t){Notifier.negotiate({message:"who_is_active",msg:e.author_id,onFail:function(){!Notifier.canNotifyUi()||cur.peer==e.author_id&&Notifier.isActive()?(t||(Notifier.lcSend("show_notification",e),Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0)),Notifier.playSound(e)):Notifier.sendBrowserNotification(e)}})},showBrowserNotification:function(e){Notifier.showEventUi(e),Notifier.playSound(e)},proxyIm:function(e){if(this.isActive())return this.playSound(e),void(Notifier.canNotifyUi()&&cur.peer!=e.author_id&&Notifier.shouldDisturb(e)&&(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",Notifier.showEventUi(e)));curNotifier.is_server?(e.onclick="IMBRIDGE.activateTab("+e.author_id+");",this.sendImProxy(e)):curNotifier.is_server||this.lcSend("message_from_im",e)},sendMailNotification:function(e){if(e.add.is_call)return 0;if("im"==cur.module?e.onclick="IMBRIDGE.activateTab('"+e.author_id+"');":e.onclick="FastChat.selectPeer('"+e.author_id+"');",this.isActive()&&Notifier.canNotifyUi())this.playSound(e),this.shouldDisturb(e)&&cur.peer!=e.author_id&&this.showEventUi(e);else{if(this.isActive()&&this.shouldDisturb(e))return this.sendSimpleNotification(e);curNotifier.is_server&&this.shouldDisturb(e)&&this.trySendBrowserNotification(e)}return 0},checkEvents:function(){var e;(!curNotifier.q_events.length||curNotifier.q_shown.length>=(curNotifier.idle_manager.is_idle?curNotifier.q_idle_max:curNotifier.q_max))&&!curNotifier.q_prior_events.length||!curNotifier.idle_manager.is_idle&&curNotifier.frozen||(cur.noDisturbMode||(e=curNotifier.q_prior_events.length?curNotifier.q_prior_events.shift():curNotifier.q_events.shift())&&this.showEvent(e))},showEvent:function showEvent(ev,force){"mail"!==ev.type&&Math.random()<.1&&statlogsValueEvent("feed_top_notify_popup",1,"show",ev.type),curNotifier.q_shown.push(ev);var thumbEl=showEventThumb(ev),addPhoto=showEventAddPhoto(ev);ev.baloonWrapEl=ce("div",{className:"notifier_baloon_wrap",innerHTML:`\n        <div class="notifier_baloon notifier_type_${ev.type}">\n          <div class="notifier_baloon_head clear_fix">\n            <a class="notifier_close_wrap" role="link" title="${getLang("global_close")}" aria-label="${getLang("global_close")}"></a>\n            <h4 class="notifier_baloon_title">${ev.title||""}</h4>\n          </div>\n          <div class="notifier_baloon_body clear_fix">\n            ${thumbEl}\n            ${addPhoto}\n            <div class="notifier_baloon_msg wrapped">${ev.text||""}</div>\n          </div>\n        </div>`}),!ge("notifier_popup_icon_mask")&&ev.icon_type&&(utilsNode.appendChild(document.createElement("div")).outerHTML='<svg style="display: block;" width="0" height="0"><defs><clipPath id="notifier_popup_icon_mask"><path d="M48.254 34.197A9.958 9.958 0 0 0 42 32c-5.523 0-10 4.477-10 10 0 2.367.822 4.542 2.197 6.254A24.934 24.934 0 0 1 25 50C11.193 50 0 38.807 0 25S11.193 0 25 0s25 11.193 25 25c0 3.247-.62 6.35-1.746 9.197z"/></clipPath></defs></svg>'),ev.baloonEl=geByClass1("notifier_baloon",ev.baloonWrapEl),ev.closeEl=geByClass1("notifier_close_wrap",ev.baloonEl),addEvent(ev.baloonEl,"mouseover mouseout",(function(e){ev.over="mouseover"==e.type,ev.over?Notifier.freezeEvents():Notifier.unfreezeEvents()})),addEvent(ev.baloonEl,"mousedown click",(function(event){event=event.originalEvent||event||window.event;var btn=event.which,nohide=!1;if(1==btn&&(event.ctrlKey||browser.mac&&event.metaKey)&&(btn=2,browser.mac&&(nohide=!0)),"A"!=(event.target||event.srcElement).tagName){switch("mail"!==ev.type&&Math.random()<.1&&statlogsValueEvent("feed_top_notify_popup",1,"click",ev.type),btn){case 1:try{eval(ev.onclick)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev.onclick)}Notifier.trackEvent("click",{event_id:ev.id}),ev.preventHideByClick||Notifier.hideEvent(ev);break;case 2:if(!ev.link)return;var wnd=window.open(ev.link,"_blank");try{wnd.blur(),window.focus()}catch(e){}Notifier.trackEvent("click",{event_id:ev.id}),nohide||Notifier.hideEvent(ev);break;case 3:if(browser.mozilla)return}return cancelEvent(event)}})),addEvent(ev.baloonEl,"contextmenu",(function(e){return setTimeout((function(){Notifier.hideEvent(ev,!1,!1,!0)}),10),cancelEvent(e)})),addEvent(ev.closeEl,"mousedown click",(function(e){return Notifier.hideEvent(ev,!1,!1,!0),cancelEvent(e)})),ev.startFading=function(){ev.fading=animate(ev.baloonEl,{opacity:0},1e3,Notifier.hideEvent.bind(Notifier).pbind(ev,!1)),ev.over&&ev.fading.stop()},curNotifier.cont.insertBefore(ev.baloonWrapEl,curNotifier.cont.firstChild);var h=ev.baloonWrapEl.offsetHeight;re(ev.baloonWrapEl),curNotifier.cont.appendChild(ev.baloonWrapEl),setStyle(curNotifier.cont,{bottom:-h}),setStyle(ev.baloonWrapEl,{visibility:"visible"}),animate(curNotifier.cont,{bottom:0},200),curNotifier.idle_manager.is_idle&&!force||(ev.timeoutConf?ev.fadeTO=setTimeout(ev.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?ev.timeoutConf.default_am:ev.timeoutConf.default):ev.fadeTO=setTimeout(ev.startFading,Object(_web_lib_accessibility__WEBPACK_IMPORTED_MODULE_6__.hasAccessibilityMode)()?NOTIFICATION_FADE_TIMEOUT_ACCESSIBILITY_MODE:NOTIFICATION_FADE_TIMEOUT)),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(ev.tooltipHandler)&&ev.tooltipHandler(ev.baloonWrapEl)},trackEvent:function(e,t){ajax.post("al_feed.php",extend({act:"a_feedback_track_event",event:e},t||{}))},canNotifyUi:function(){if(window.pushNotifier&&window.pushNotifier.loadEndpoint())return!1;var e=!ls.get("im_ui_notify_off")&&DesktopNotifications.supported()&&DesktopNotifications.checkPermission()<=0;return!ls.get("im_notify_flag")&&e&&ls.set("im_notify_flag",1),e&&!cur.noDisturbMode},showEventUi:function showEventUi(ev){if(!this.canNotifyUi())return!1;var title,text;if("mail"===ev.type){var div=ce("div");div.innerHTML=ev.text,title=div.firstChild.textContent.trim(),text=stripHTML(replaceEntities(ev.text.replace(/<br\/?>/g,"\n")).replace(/<span class='notifier_author_quote'.*<\/span>(.*?)/,"$1").replace(/<img.*?alt="(.*?)".*?>/gi,"$1")).replace(/&laquo;|&raquo;/gi,'"').trim()}else title=ev.title,text=ev.text;var notification=ev.uiNotification=DesktopNotifications.createNotification(ev.author_photo,title,text);return curNotifier.uiNotifications.push([notification,Date.now()]),notification.onclick=function(e){if(window.focus(),ev.onclick||("im"===cur.module?ev.onclick="IMBRIDGE.activateTab("+ev.author_id+");":ev.onclick="FastChat.selectPeer('"+ev.author_id+"');"),"IM"===ev.onclick.substr(0,2)&&"im"!==cur.module)FastChat.selectPeer(intval(ev.author_id));else try{eval(ev.onclick)}catch(e){Object(_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,ev.onclick)}Notifier.hideEvent(ev)},notification.onclose=function(){Notifier.hideEvent(ev,!0)},notification.show(),ev.closeTO=setTimeout(Notifier.hideEvent.bind(Notifier).pbind(ev),5e3),!0},hideEvent:function(e,t,r,n){clearTimeout(e.closeTO),clearTimeout(e.fadeTO),e.fading&&e.fading.stop();var a,i=indexOf(curNotifier.q_shown,e);-1!=i&&curNotifier.q_shown.splice(i,1),Notifier.unfreezeEvents(),t||(e.baloonWrapEl?(cleanElems(e.closeEl,e.baloonEl),re(e.baloonWrapEl)):e.uiNotification&&e.uiNotification.cancel()),!0===n&&isArray(curNotifier.q_closed)&&(curNotifier.q_closed.unshift(vkNow()),(a=curNotifier.q_closed.length)>3&&(curNotifier.q_closed.splice(3,a-3),a=3),3==a&&curNotifier.q_closed[0]-curNotifier.q_closed[2]<700&&Notifier.hideAllEvents()),-1!=n&&this.checkEvents(),"frame"!=curNotifier.transport||r||this.lcSend("hide",{event_id:e.id}),!0!==n&&curNotifier.idle_manager.is_idle||curNotifier.q_events.length||curNotifier.q_shown.length||ajax.post("notifier.php",{act:"a_clear_notifier"}),Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(e.onHide)&&e.onHide()},hideAllEvents:function(){curNotifier.q_events=[],each(clone(curNotifier.q_shown),(function(){Notifier.hideEvent(this,!1,!0,-1)})),curNotifier.q_shown=[],curNotifier.q_closed=[]},onEventHide:function(e){e&&(each(curNotifier.q_shown,(function(){if(this.id==e)return Notifier.hideEvent(this,!1,!0),!1})),each(curNotifier.q_events,(function(t){if(this.id==e)return curNotifier.q_events.splice(t,1),!1})))},lcInit:function(){if(curNotifier.post_message){addEvent(window,"message",this.lcOnMessage.bind(this));var e=curNotifier.storage_el=ce("iframe",{id:"queue_storage_frame",name:"queue_storage_frame",src:"/notifier.php?act=storage_frame&from="+location.host+(Notifier.debug?"&debug="+vkNow():"&4")+"#"+curNotifier.connection_id});Notifier.getTransportWrap().appendChild(e),curNotifier.storage_frame=e.contentWindow,curNotifier.storage_frame_origin=location.protocol+"//"+locHost}else browser.msie&&intval(browser.version)<9?addEvent(document,"storage",this.lcOnStorage.bind(this)):addEvent(window,"storage",this.lcOnStorage.bind(this)),this.lcStart()},lcStart:function(){Notifier.lcCheckServer()?this.lcServer():(this.lcSend("check"),clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=setTimeout(this.lcServer.bind(this).pbind(!0),500)),curNotifier.checkServerInt=setInterval(function(){curNotifier.is_server||(curNotifier.idle_manager&&!curNotifier.idle_manager.is_idle&&curNotifier.idle_manager.getActiveTime()>ACTIVE_TAB_SWITCH_SERVER_TIMEOUT&&(Notifier.debug&&debugLog("this tab wants to become server"),ls.set(LC_SERVER_SWITCH_TO_ACTIVE_FLAG,!0),this.lcServer(!0)),vkNow()-curNotifier.last_succ>8e3&&Notifier.lcCheckServer()&&(Notifier.debug&&debugLog("timeout"),this.lcServer(!0)))}.bind(this),1e3+intval(rand(-100,100))),curNotifier.isServerBroadcastInt=setInterval(function(){curNotifier.is_server&&(Notifier.lcCheckServer()?this.lcSend("check_ok"):(Notifier.debug&&debugLog("no server from server broadcast"),this.lcNoServer()))}.bind(this),5e3+intval(rand(-100,100))),void 0!==curNotifier.fc&&stManager.add([jsc("web/emoji.js")],(function(){FastChat.init(curNotifier.fc)}))},lcStop:function(){clearInterval(curNotifier.isServerBroadcastInt),clearInterval(curNotifier.checkServerInt),clearTimeout(curNotifier.becomeServerTO)},lcSend:function(e,t){if(!curNotifier.connection_id)return curNotifier.onConnectionId&&curNotifier.onConnectionId.push(Notifier.lcSend.pbind(e,t)),!1;Notifier.debug&&debugLog(curNotifier.instance_id+": sending",e,t||"");var r=extend({__client:curNotifier.instance_id,__act:e,__rnd:Math.random()},t||{});if(curNotifier.post_message)try{curNotifier.storage_frame.postMessage(curNotifier.connection_id+":"+JSON.stringify(r),curNotifier.storage_frame_origin)}catch(e){debugLog(e,e.message,e.stack)}else ls.set(curNotifier.connection_id,r)},lcRecv:function(e){if(e&&!isEmpty(e)&&e.__client!=curNotifier.instance_id){var t=e.__act;switch(delete e.__client,delete e.__act,delete e.__rnd,Notifier.debug&&debugLog(curNotifier.instance_id+": recv",t,e),t){case"new_server":curNotifier.last_succ=vkNow()+1e3;break;case"feed":curNotifier.timestamp=e.ts,curNotifier.key=e.key,Notifier.pushEvents(e.events,!e.full);break;case"addfeed":Notifier.addFeed(e[0],e[1]);break;case"new_key":debugLog("new key",e),curNotifier.timestamp=e.ts,curNotifier.key=e.key;break;case"new_addkey":var r=e.queue||e.key,n=curNotifier.addQueues[r],a=!n&&curNotifier.is_server;n?n[0]=Date.now():curNotifier.addQueues[r]=[Date.now(),e.ts,e.key],a&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier));break;case"clear_addkeys":curNotifier.addQueues={};break;case"check_ok":curNotifier.last_succ=Date.now(),curNotifier.becomeServerTO&&(clearTimeout(curNotifier.becomeServerTO),curNotifier.becomeServerTO=!1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit());break;case"focus":Notifier.onInstanceFocus(e.instance_id);break;case"hide":Notifier.onEventHide(e.event_id);break;case"check_playlist":var i=ls.get("pad_playlist");i&&i.instance==curNotifier.instance_id&&ls.set("pad_pltime",vkNow());break;case"who_is_active":Notifier.isActive()&&(intval(e.msg)>2e9&&"im"===cur.module||intval(e.msg)<2e9)&&this.lcSend("negotiate_back",e);break;case"show_notification":Notifier.shouldShowNotification(e)&&Notifier.showEvent(e,!0);break;case"send_im_notification":if("im"===cur.module){var o=Notifier.createNegotiationSlot({onSuccess:function(e){e.ev.onclick="IMBRIDGE.activateTab("+e.ev.author_id+");",Notifier.showBrowserNotification(e.ev)}});Notifier.lcSend("negotiate_back",{msg:o.token,token:e.token})}break;case"negotiate_back":Notifier.endNegotiation(e);break;case"recent_emoji_set":window.Emoji&&Emoji.setRecentEmojiList(e);break;case"lp_data":Object(_longpoll_singleton__WEBPACK_IMPORTED_MODULE_10__.lpSingletonOnNotifierRecv)(e);break;default:if(curNotifier.recvClbks&&curNotifier.recvClbks[t])for(var s in curNotifier.recvClbks[t])curNotifier.recvClbks[t][s](e);else curNotifier.recvData[t]=e}if(curNotifier.is_server)switch(t){case"new_server":case"new_key":case"check_ok":Notifier.debug&&debugLog("no server from lcRecv",t),Notifier.lcNoServer();break;case"check":this.lcSend("check_ok");break;case"message_from_im":Notifier.sendImProxy(e)}}},negotiate:function(e){e=this.createNegotiationSlot(e),this.lcSend(e.message,{token:e.token,msg:e.msg})},createNegotiationSlot:function(e){var t="negotiations_"+Date.now()+Math.round(rand(0,1e4));return e=extend({timeout:3e3,token:t,msg:""},e),curNotifier.negotiations[e.token]={},curNotifier.negotiations[e.token].timer=setTimeout((function(){e.onFail&&e.onFail(),curNotifier.negotiations[e.token]&&(curNotifier.negotiations[e.token]=void 0)}),e.timeout),curNotifier.negotiations[e.token].success=e.onSuccess,e},endNegotiation:function(e){var t=e.token,r=curNotifier.negotiations[t];r&&(clearTimeout(r.timer),curNotifier.negotiations[t].success&&curNotifier.negotiations[t].success(e),curNotifier.negotiations[t]=void 0)},lcOnStorage:function(e){e=e||window.event,Notifier.debug&&debugLog("onstorage",e.key,e.newValue,e);var t=e.key,r=e.newValue;if(r){if(t){if(e.key!=curNotifier.connection_id)return}else{if(t=curNotifier.connection_id,(r=localStorage.getItem(t))==curNotifier.lc_prev_value)return;curNotifier.lc_prev_value=r}this.lcRecv(JSON.parse(r)||{})}},lcOnMessage:function(e){if(e=e||window.event,Notifier.debug&&debugLog("onmessage",e.data,e.origin,e),!(e.origin&&e.origin!=curNotifier.storage_frame_origin||"string"!=typeof e.data||e.data.indexOf("q_st"))){var t,r=e.data.substr(4);if("ready"==r)curNotifier.storage_frame=e.source,this.lcStart();else{if(-1==(t=r.indexOf(":"))||r.substr(0,t)!=curNotifier.connection_id||!r.substr(t+1))return;this.lcRecv(JSON.parse(r.substr(t+1)))}}},lcServer:function(e){Notifier.debug&&debugLog("becoming server"),this.lpInit(),this.lcSend("new_server"),Notifier.lcCheckServer(!0),Notifier.onInstanceServer(1),curNotifier.lp_connected||(curNotifier.lp_connected=!0,Notifier.onConnectionInit()),this.lpStop(),e?this.lpReset(this.lpStart.bind(this)):this.lpStart()},lcNoServer:function(){this.lpStop(),curNotifier.is_server&&(Notifier.debug&&debugLog("not server now"),this.onInstanceServer(0))},lcCheckServer:function(e){var t,r="server_"+curNotifier.connection_id,n=vkNow();return!(!e&&isArray(t=ls.get(r))&&t[0]!=curNotifier.instance_id&&n-t[1]<8e3)&&(ls.set(r,[curNotifier.instance_id,n]),!0)},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,re("queue_transport_frame"),Notifier.getTransportWrap().appendChild(ce("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,curNotifier.lpInvalid?Notifier.lpGetKey():Notifier.lpCheck()},lpStop:function(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to),clearTimeout(curNotifier.lp_req_check_to)},lpCheck:function lpCheck(){if(curNotifier.lp_started&&!curNotifier.lpActive&&!curNotifier.lpInvalid){if(!curNotifier.lpMakeRequest)return clearTimeout(curNotifier.lp_check_to),void(curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3));if(!Notifier.lcCheckServer())return Notifier.debug&&debugLog("no server from check"),void this.lcNoServer();var now=vkNow(),add_queues=[],completed=!1,params={act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25};each(curNotifier.addQueues,(function(e,t){if(now-t[0]>3e4&&!e.match(/nccts/))return debugLog("drop key",e,now-t[0]),void delete curNotifier.addQueues[e];add_queues.push(e),params.ts+="_"+t[1],params.key+=t[2]}));var onFail=function(e){completed||(completed=!0,curNotifier.lpActive=!1,clearTimeout(curNotifier.lp_req_check_to),curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout+irand(1e3,1e4)),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2))}.bind(this);curNotifier.lpActive=!0,clearTimeout(curNotifier.lp_req_check_to),curNotifier.lp_req_check_to=setTimeout(onFail,1e3*(params.wait+5)),curNotifier.lpMakeRequest(curNotifier.frame_url,params,function(text){if(!completed&&(completed=!0,curNotifier.lpActive=!1,curNotifier.lp_started)){this.lcSend("check_ok");try{var response=eval("("+text+")"),main_response=response,add_response,add_queue,busy=0;if(isArray(response))for(main_response=response.shift();(add_response=response.shift())&&(add_queue=add_queues.shift(),add_queue);)2!=add_response.failed||4!=add_response.err?(this.lcSend("addfeed",[add_queue,add_response]),this.addFeed(add_queue,add_response),add_response.failed&&delete curNotifier.addQueues[add_queue]):(Notifier.debug&&debugLog("!!notifier key busy!! "+curNotifier.instance_id),busy|=1);else if(response.failed){for(;add_queue=add_queues.shift();)this.lcSend("addfeed",[add_queue,response]),this.addFeed(add_queue,response),delete curNotifier.addQueues[add_queue];this.lcSend("clear_addkeys")}switch(this.lpChecked(main_response)){case 0:break;case 1:return;case 2:busy|=2;break;default:return}busy?ls.get(LC_SERVER_SWITCH_TO_ACTIVE_FLAG)?ls.remove(LC_SERVER_SWITCH_TO_ACTIVE_FLAG):this.lcNoServer():(clearTimeout(curNotifier.lpCheckTO),curNotifier.lpCheckTO=setTimeout(this.lpCheck.bind(this),curNotifier.request_timeout||1e3),curNotifier.error_timeout=Math.max(1,(curNotifier.error_timeout||1)/1.5))}catch(e){text&&-1==text.indexOf("Ad Muncher")&&(topError("Notifier error: "+e.message,{dt:-1,type:5,stack:e.stack,answer:text+"\n\nbusy:"+busy+"\nserver:"+curNotifier.is_server+"\ninstance:"+curNotifier.instance_id,url:curNotifier.frame_url,query:params&&Object(_shared_lib_convert__WEBPACK_IMPORTED_MODULE_8__.toQueryString)(params)}),debugLog(e.message,e.stack,e)),curNotifier.error_timeout=curNotifier.error_timeout||1,clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}}.bind(this),onFail)}},lpChecked:function(e){var t=e.failed;if(2==t)return 4==e.err?2:(curNotifier.lpInvalid=!0,debugLog("notifier lpCheck error",e),clearTimeout(curNotifier.lp_error_to),curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),1==e.err?1:3);if(t)throw new Error(getLang("global_unknown_error"));return this.lcSend("feed",extend({full:curNotifier.idle_manager&&curNotifier.idle_manager.is_idle&&!this.canNotifyUi(),key:curNotifier.key},e)),curNotifier.timestamp=e.ts,Notifier.pushEvents(e.events),0},lpOnReset:function(){curNotifier.lpOnReset&&curNotifier.lpOnReset()},lpReset:function(e){curNotifier.lpOnReset=e,clearTimeout(curNotifier.resetTO),curNotifier.resetTO=setTimeout((function(){if(!curNotifier.is_server||curNotifier.lp_started)if(curNotifier.lpMakeRequest&&!curNotifier.lpInvalid){var e=curNotifier.key,t=curNotifier.timestamp;each(curNotifier.addQueues,(function(r,n){e+=n[2],t+="_"+n[1]})),curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_release",key:e,ts:t,id:curNotifier.uid,wait:25},Notifier.lpOnReset,Notifier.lpOnReset)}else ajax.post("notifier.php?act=a_reset",!1,{onDone:Notifier.lpOnReset,onFail:function(){return Notifier.lpOnReset(),!0}});else Notifier.lpStart()}),100)},lpGetKey:function(){ajax.post("notifier.php?act=a_get_key",{id:curNotifier.uid},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,curNotifier.lpInvalid=!1,debugLog("notifier lpGetKey done"),this.lcSend("new_key",{ts:t,key:e}),this.lpCheck()}.bind(this),onFail:function(e){switch(debugLog("notifier lpGetKey fail",e),e){case 1:case 3:return void Notifier.standby();case 4:return void Notifier.standby(300);case 2:return void Notifier.onRelogin()}return curNotifier.error_timeout=64,clearTimeout(this.lp_error_to),this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),!0}.bind(this)})},addKey:function(e,t,r){if(curNotifier.flash_transport||!e)return!1;var n=e.queue||e.key,a=curNotifier.addQueues[n],i=!a&&curNotifier.is_server;return a?(a[0]=vkNow(),a[3]=t,a[4]=r):curNotifier.addQueues[n]=[vkNow(),e.ts,e.key,t,r],r||Notifier.lcSend("new_addkey",e),i&&Notifier.lpReset(Notifier.lpCheck.bind(Notifier)),!0},addFeed:function(e,t){var r=curNotifier.addQueues[e];isArray(r)&&r.length&&(r[1]=t.ts,Object(_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isFunction)(r[3])&&r[3](e,t))},addRecvClbk:function(e,t,r,n){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]||(curNotifier.recvClbks[e]={}),curNotifier.recvClbks[e][t]&&!n||(curNotifier.recvClbks[e][t]=r)},setRecvClbk:function(e,t){curNotifier.recvClbks||(curNotifier.recvClbks={}),curNotifier.recvClbks[e]=[t]},fixPhoto:function(e,t){return-1==(e=clean(e)).indexOf("question_c.gif")?e:t?"/images/question_inv_xc.png":"/images/question_inv_c.png"}}}});